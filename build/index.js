/******/ (function() { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./local_modules/react-pintura/PinturaEditor.js":
/*!******************************************************!*\
  !*** ./local_modules/react-pintura/PinturaEditor.js ***!
  \******************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _pqina_pintura__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @pqina/pintura */ "./local_modules/pintura/pintura.js");
/* harmony import */ var _events__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./events */ "./local_modules/react-pintura/events.js");
function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }
function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return _typeof(key) === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }
function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }
function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return _assertThisInitialized(self); }
function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }



var PinturaEditor = /*#__PURE__*/function (_React$Component) {
  _inherits(PinturaEditor, _React$Component);
  var _super = _createSuper(PinturaEditor);
  function PinturaEditor(props) {
    var _this;
    _classCallCheck(this, PinturaEditor);
    _this = _super.call(this, props);
    _this.elementRef = /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createRef();
    _this.editor = undefined;
    return _this;
  }
  _createClass(PinturaEditor, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      if (!this.elementRef.current) return;
      var props = _objectSpread({}, this.props);
      this.editor = (0,_pqina_pintura__WEBPACK_IMPORTED_MODULE_1__.appendEditor)(this.elementRef.current, props);
      (0,_events__WEBPACK_IMPORTED_MODULE_2__.sub)(this, props);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      var props = _objectSpread({}, this.props);
      Object.assign(this.editor, props);
      (0,_events__WEBPACK_IMPORTED_MODULE_2__.sub)(this, props);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      if (!this.editor) return;
      (0,_events__WEBPACK_IMPORTED_MODULE_2__.unsub)(this);
      this.editor.destroy();
      this.editor = undefined;
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement('div', {
        className: "PinturaRootWrapper ".concat(this.props.className ? this.props.className : '').trim(),
        ref: this.elementRef
      });
    }
  }]);
  return PinturaEditor;
}((react__WEBPACK_IMPORTED_MODULE_0___default().Component));
/* harmony default export */ __webpack_exports__["default"] = (PinturaEditor);

/***/ }),

/***/ "./local_modules/react-pintura/PinturaEditorModal.js":
/*!***********************************************************!*\
  !*** ./local_modules/react-pintura/PinturaEditorModal.js ***!
  \***********************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _pqina_pintura__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @pqina/pintura */ "./local_modules/pintura/pintura.js");
/* harmony import */ var _events__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./events */ "./local_modules/react-pintura/events.js");
function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }
function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return _typeof(key) === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }
function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }
function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return _assertThisInitialized(self); }
function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }



var PinturaEditorModal = /*#__PURE__*/function (_React$Component) {
  _inherits(PinturaEditorModal, _React$Component);
  var _super = _createSuper(PinturaEditorModal);
  function PinturaEditorModal(props) {
    var _this;
    _classCallCheck(this, PinturaEditorModal);
    _this = _super.call(this, props);
    _this.editor = undefined;
    return _this;
  }
  _createClass(PinturaEditorModal, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      // We'll wrap the module in a container so we can use the container as a CSS module target
      this.el = document.createElement('div');
      if (this.props.className) this.el.className = this.props.className;
      document.body.append(this.el);

      // create editor and proxy events
      var props = _objectSpread({}, this.props);
      this.editor = (0,_pqina_pintura__WEBPACK_IMPORTED_MODULE_1__.openEditor)(_objectSpread(_objectSpread({}, props), {}, {
        enableAutoDestroy: false
      }), this.el);
      (0,_events__WEBPACK_IMPORTED_MODULE_2__.sub)(this, props);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      var props = _objectSpread({}, this.props);
      Object.assign(this.editor, props);
      (0,_events__WEBPACK_IMPORTED_MODULE_2__.sub)(this, props);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      if (!this.editor) return;
      (0,_events__WEBPACK_IMPORTED_MODULE_2__.unsub)(this);
      this.editor.destroy();
      this.editor = undefined;
      this.el.remove();
    }
  }, {
    key: "show",
    value: function show() {
      this.editor.show();
    }
  }, {
    key: "hide",
    value: function hide() {
      this.editor.hide();
    }
  }, {
    key: "render",
    value: function render() {
      return null;
    }
  }]);
  return PinturaEditorModal;
}((react__WEBPACK_IMPORTED_MODULE_0___default().Component));
/* harmony default export */ __webpack_exports__["default"] = (PinturaEditorModal);

/***/ }),

/***/ "./local_modules/react-pintura/PinturaEditorOverlay.js":
/*!*************************************************************!*\
  !*** ./local_modules/react-pintura/PinturaEditorOverlay.js ***!
  \*************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _pqina_pintura__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @pqina/pintura */ "./local_modules/pintura/pintura.js");
/* harmony import */ var _events__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./events */ "./local_modules/react-pintura/events.js");
function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }
function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return _typeof(key) === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }
function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }
function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return _assertThisInitialized(self); }
function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }



var PinturaEditorOverlay = /*#__PURE__*/function (_React$Component) {
  _inherits(PinturaEditorOverlay, _React$Component);
  var _super = _createSuper(PinturaEditorOverlay);
  function PinturaEditorOverlay(props) {
    var _this;
    _classCallCheck(this, PinturaEditorOverlay);
    _this = _super.call(this, props);
    _this.elementRef = /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createRef();
    _this.editor = undefined;
    return _this;
  }
  _createClass(PinturaEditorOverlay, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      if (!this.elementRef.current) return;
      var props = _objectSpread({}, this.props);
      this.editor = (0,_pqina_pintura__WEBPACK_IMPORTED_MODULE_1__.overlayEditor)(this.elementRef.current, props);
      (0,_events__WEBPACK_IMPORTED_MODULE_2__.sub)(this, props);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      var props = _objectSpread({}, this.props);
      Object.assign(this.editor, props);
      (0,_events__WEBPACK_IMPORTED_MODULE_2__.sub)(this, props);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      if (!this.editor) return;
      (0,_events__WEBPACK_IMPORTED_MODULE_2__.unsub)(this);
      this.editor.destroy();
      this.editor = undefined;
    }
  }, {
    key: "render",
    value: function render() {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement('div', {
        className: "PinturaRootWrapper ".concat(this.props.className ? this.props.className : '').trim(),
        ref: this.elementRef
      });
    }
  }]);
  return PinturaEditorOverlay;
}((react__WEBPACK_IMPORTED_MODULE_0___default().Component));
/* harmony default export */ __webpack_exports__["default"] = (PinturaEditorOverlay);

/***/ }),

/***/ "./local_modules/react-pintura/events.js":
/*!***********************************************!*\
  !*** ./local_modules/react-pintura/events.js ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "sub": function() { return /* binding */ sub; },
/* harmony export */   "unsub": function() { return /* binding */ unsub; }
/* harmony export */ });
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
var isEvent = function isEvent(key) {
  return /^on[A-Z]/.test(key);
};
var getEventsFromProps = function getEventsFromProps(props) {
  return Object.keys(props).filter(isEvent).map(getEventFromKey);
};
var getEventFromKey = function getEventFromKey(key) {
  return key.substr(2).toLowerCase();
};
var unsub = function unsub(component) {
  var events = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;
  (component.unsubs || []
  // events not supplied, or event is in events list
  ).filter(function (_ref) {
    var _ref2 = _slicedToArray(_ref, 1),
      event = _ref2[0];
    return !events || events.includes(event);
  }).forEach(function (_ref3) {
    var _ref4 = _slicedToArray(_ref3, 2),
      unsub = _ref4[1];
    return unsub();
  });
};
var sub = function sub(component, props) {
  // unsub existing subscriptions
  unsub(component, getEventsFromProps(props));

  // subscribe
  component.unsubs = Object.keys(props).filter(isEvent).map(function (key) {
    var type = getEventFromKey(key);
    return [type, component.editor.on(type, props[key])];
  });
};

/***/ }),

/***/ "./local_modules/react-pintura/index.js":
/*!**********************************************!*\
  !*** ./local_modules/react-pintura/index.js ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "PinturaEditor": function() { return /* reexport safe */ _PinturaEditor__WEBPACK_IMPORTED_MODULE_0__["default"]; },
/* harmony export */   "PinturaEditorModal": function() { return /* reexport safe */ _PinturaEditorModal__WEBPACK_IMPORTED_MODULE_1__["default"]; },
/* harmony export */   "PinturaEditorOverlay": function() { return /* reexport safe */ _PinturaEditorOverlay__WEBPACK_IMPORTED_MODULE_2__["default"]; }
/* harmony export */ });
/* harmony import */ var _PinturaEditor__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./PinturaEditor */ "./local_modules/react-pintura/PinturaEditor.js");
/* harmony import */ var _PinturaEditorModal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./PinturaEditorModal */ "./local_modules/react-pintura/PinturaEditorModal.js");
/* harmony import */ var _PinturaEditorOverlay__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./PinturaEditorOverlay */ "./local_modules/react-pintura/PinturaEditorOverlay.js");




/***/ }),

/***/ "./src/blocks/photo-block/edit.js":
/*!****************************************!*\
  !*** ./src/blocks/photo-block/edit.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _editor_scss__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./editor.scss */ "./src/blocks/photo-block/editor.scss");
/* harmony import */ var _pqina_pintura_pintura_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @pqina/pintura/pintura.css */ "./local_modules/pintura/pintura.css");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! classnames */ "./node_modules/classnames/index.js");
/* harmony import */ var classnames__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @wordpress/i18n */ "@wordpress/i18n");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @wordpress/components */ "@wordpress/components");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _wordpress_block_editor__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @wordpress/block-editor */ "@wordpress/block-editor");
/* harmony import */ var _wordpress_block_editor__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_wordpress_block_editor__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _wordpress_compose__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @wordpress/compose */ "@wordpress/compose");
/* harmony import */ var _wordpress_compose__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_wordpress_compose__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _pqina_pintura__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @pqina/pintura */ "./local_modules/pintura/pintura.js");
/* harmony import */ var _pqina_react_pintura__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @pqina/react-pintura */ "./local_modules/react-pintura/index.js");
/* harmony import */ var _contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../contexts/UploaderContext */ "./src/contexts/UploaderContext.js");
/* harmony import */ var _screens_Initial__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../screens/Initial */ "./src/screens/Initial/index.js");
/* harmony import */ var _screens_Edit__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../screens/Edit */ "./src/screens/Edit/index.js");
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/crop.js");
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/image.js");
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/accessibility.js");
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/link.js");
function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }










var editorConfig = (0,_pqina_pintura__WEBPACK_IMPORTED_MODULE_8__.getEditorDefaults)();




var PhotoBlock = function PhotoBlock(props) {
  var generatedUniqueId = (0,_wordpress_compose__WEBPACK_IMPORTED_MODULE_7__.useInstanceId)(PhotoBlock, 'photo-block');
  var _useState = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_3__.useState)(false),
    _useState2 = _slicedToArray(_useState, 2),
    showPinturaEditor = _useState2[0],
    setShowPinturaEditor = _useState2[1];

  // Read in context values.
  var _useContext = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_3__.useContext)(_contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_10__["default"]),
    imageFile = _useContext.imageFile,
    screen = _useContext.screen,
    setScreen = _useContext.setScreen,
    isUploading = _useContext.isUploading,
    setIsUploading = _useContext.setIsUploading,
    isProcessingUpload = _useContext.isProcessingUpload,
    setIsProcessingUpload = _useContext.setIsProcessingUpload,
    isUploadError = _useContext.isUploadError;
  var blockProps = (0,_wordpress_block_editor__WEBPACK_IMPORTED_MODULE_6__.useBlockProps)({
    className: classnames__WEBPACK_IMPORTED_MODULE_2___default()("dlx-photo-block", "align".concat(align), "dlx-screen-".concat(screen))
  });

  // Store the filepond upload ref.
  var filepondRef = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_3__.useRef)(null);
  var imageRef = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_3__.useRef)(null);
  var attributes = props.attributes,
    setAttributes = props.setAttributes,
    clientId = props.clientId;
  var uniqueId = attributes.uniqueId,
    photo = attributes.photo,
    align = attributes.align,
    caption = attributes.caption,
    altText = attributes.altText,
    overlayText = attributes.overlayText,
    overlayTextPosition = attributes.overlayTextPosition,
    paddingSize = attributes.paddingSize,
    marginSize = attributes.marginSize,
    borderWidth = attributes.borderWidth,
    borderRadiusSize = attributes.borderRadiusSize,
    typographyCaption = attributes.typographyCaption;

  /**
   * Get a unique ID for the block for inline styling if necessary.
   */
  (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_3__.useEffect)(function () {
    // Set unique ID for block (for styling).
    setAttributes({
      uniqueId: generatedUniqueId
    });
  }, []);

  /**
   * Get the screen to display.
   *
   * @return {Element} The screen to display.
   */
  var getCurrentScreen = function getCurrentScreen() {
    switch (screen) {
      case 'initial':
        return /*#__PURE__*/React.createElement(_screens_Initial__WEBPACK_IMPORTED_MODULE_11__["default"], {
          forwardRef: filepondRef,
          attributes: attributes,
          setAttributes: setAttributes
        });
      case 'edit':
        return /*#__PURE__*/React.createElement(_screens_Edit__WEBPACK_IMPORTED_MODULE_12__["default"], {
          ref: imageRef,
          attributes: attributes,
          setAttributes: setAttributes
        });
      // case 'edit':
      // 	return getEditScreen();
      // case 'crop':
      // 	return getCropScreen();
      // case 'preview':
      // 	return getPreviewScreen();
    }

    return null;
  };

  /**
   * Get the current toolbar for the screen.
   *
   * @return {Element} The toolbar to display.
   */
  var getCurrentToolbar = function getCurrentToolbar() {
    switch (screen) {
      case 'edit':
        return /*#__PURE__*/React.createElement(_wordpress_block_editor__WEBPACK_IMPORTED_MODULE_6__.BlockControls, null, /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_5__.ToolbarGroup, null, /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_5__.ToolbarButton, {
          icon: /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_13__["default"], null),
          label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_4__.__)('Crop and Edit', 'photo-block'),
          onClick: function onClick() {
            setShowPinturaEditor(true);
          }
        }, (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_4__.__)('Crop and Edit', 'photo-block')), /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_5__.ToolbarButton, {
          icon: /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_14__["default"], null),
          label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_4__.__)('Replace Image', 'photo-block'),
          onClick: function onClick() {
            setScreen('initial');
          }
        }, (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_4__.__)('Replace Image', 'photo-block'))), /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_5__.ToolbarGroup, null, /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_5__.ToolbarButton, {
          icon: /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_15__["default"], null),
          label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_4__.__)('Set Accessibility Options', 'photo-block'),
          onClick: function onClick() {}
        }), /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_5__.ToolbarButton, {
          icon: /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_16__["default"], null),
          label: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_4__.__)('Set Link Options', 'photo-block'),
          onClick: function onClick() {}
        })));
      // case 'edit':
      // 	return getEditScreen();
      // case 'crop':
      // 	return getCropScreen();
      // case 'preview':
      // 	return getPreviewScreen();
    }

    return null;
  };
  var getPinturaEditor = function getPinturaEditor() {
    if (!showPinturaEditor) {
      return null;
    }
    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_pqina_react_pintura__WEBPACK_IMPORTED_MODULE_9__.PinturaEditor, _extends({}, editorConfig, {
      src: imageRef.current,
      onProcess: function onProcess(imageWriterResult) {
        console.log('imageWriterResult', imageWriterResult);
        // setAttributes( { photo: imageWriterResult } );
        // setShowPinturaEditor( false );
      }
    })));
  };

  var block = /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("section", {
    className: "dlx-photo-block__container"
  }, getPinturaEditor(), getCurrentToolbar(), getCurrentScreen()));
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", blockProps, block));
};
/* harmony default export */ __webpack_exports__["default"] = (PhotoBlock);

/***/ }),

/***/ "./src/blocks/photo-block/icons/filepond.js":
/*!**************************************************!*\
  !*** ./src/blocks/photo-block/icons/filepond.js ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "processSvg": function() { return /* binding */ processSvg; },
/* harmony export */   "redoSvg": function() { return /* binding */ redoSvg; }
/* harmony export */ });
var redoSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-redo-2"><path d="m15 14 5-5-5-5"></path><path d="M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13"></path></svg>';
var processSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>';

/***/ }),

/***/ "./src/blocks/photo-block/index.js":
/*!*****************************************!*\
  !*** ./src/blocks/photo-block/index.js ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _block_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./block.json */ "./src/blocks/photo-block/block.json");
/* harmony import */ var _wordpress_blocks__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @wordpress/blocks */ "@wordpress/blocks");
/* harmony import */ var _wordpress_blocks__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_wordpress_blocks__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @wordpress/i18n */ "@wordpress/i18n");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../contexts/UploaderContext */ "./src/contexts/UploaderContext.js");
/* harmony import */ var _edit__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./edit */ "./src/blocks/photo-block/edit.js");
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }






var PhotoBlock = function PhotoBlock(props) {
  var _useState = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_3__.useState)(null),
    _useState2 = _slicedToArray(_useState, 2),
    imageFile = _useState2[0],
    setImageFile = _useState2[1];
  var _useState3 = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_3__.useState)(props.attributes.screen),
    _useState4 = _slicedToArray(_useState3, 2),
    screen = _useState4[0],
    setScreen = _useState4[1]; // Can be initial, edit, crop, preview, data.
  var _useState5 = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_3__.useState)(false),
    _useState6 = _slicedToArray(_useState5, 2),
    isUploading = _useState6[0],
    setIsUploading = _useState6[1];
  var _useState7 = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_3__.useState)(false),
    _useState8 = _slicedToArray(_useState7, 2),
    isProcessingUpload = _useState8[0],
    setIsProcessingUpload = _useState8[1];
  var _useState9 = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_3__.useState)(false),
    _useState10 = _slicedToArray(_useState9, 2),
    isUploadError = _useState10[0],
    setIsUploadError = _useState10[1];
  return /*#__PURE__*/React.createElement(_contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_4__["default"].Provider, {
    value: {
      imageFile: imageFile,
      setImageFile: setImageFile,
      screen: screen,
      setScreen: setScreen,
      isUploading: isUploading,
      setIsUploading: setIsUploading,
      isProcessingUpload: isProcessingUpload,
      setIsProcessingUpload: setIsProcessingUpload,
      isUploadError: isUploadError,
      setIsUploadError: setIsUploadError
    }
  }, /*#__PURE__*/React.createElement(_edit__WEBPACK_IMPORTED_MODULE_5__["default"], props));
};

// Import JS

var PhotoBlockIcon = /*#__PURE__*/React.createElement("svg", {
  xmlns: "http://www.w3.org/2000/svg",
  xmlSpace: "preserve",
  style: {
    fillRule: 'evenodd',
    clipRule: 'evenodd',
    strokeLinejoin: 'round',
    strokeMiterlimit: 2
  },
  viewBox: "0 0 866 866"
}, /*#__PURE__*/React.createElement("path", {
  d: "M1336.22 851.626c0 162.564-131.79 294.354-294.35 294.354-162.567 0-294.352-131.79-294.352-294.354 0-162.565 131.785-294.35 294.352-294.35 162.56 0 294.35 131.785 294.35 294.35Z",
  style: {
    fillRule: 'nonzero'
  },
  transform: "translate(-609.242 -419)"
}), /*#__PURE__*/React.createElement("path", {
  d: "m716.848 775.416-23.495-5.485c22.958-98.308 87.015-182.793 175.743-231.797l11.663 21.121c-82.76 45.707-142.503 124.495-163.911 216.161Z",
  style: {
    fillRule: 'nonzero'
  },
  transform: "translate(-609.242 -419)"
}), /*#__PURE__*/React.createElement("path", {
  d: "M708.112 851.626h-24.127c0-27.586 3.152-55.07 9.368-81.695l23.495 5.485c-5.796 24.829-8.736 50.469-8.736 76.21ZM1371.97 990.117l-22.24-9.345c17.18-40.915 25.9-84.367 25.9-129.146 0-11.811-.63-23.705-1.85-35.354l23.99-2.526a361.662 361.662 0 0 1 1.98 37.88c0 48.005-9.34 94.6-27.78 138.491Z",
  style: {
    fillRule: 'nonzero'
  },
  transform: "translate(-609.242 -419)"
}), /*#__PURE__*/React.createElement("path", {
  d: "M1041.87 1241.84c-215.163 0-390.212-175.05-390.212-390.214 0-165.407 104.783-313.383 260.742-368.216l4.802 13.657C767.03 549.866 666.134 692.352 666.134 851.626c0 207.184 168.553 375.734 375.736 375.734 144.05 0 277.23-84.05 339.3-214.12l13.07 6.23c-64.46 135.08-202.77 222.37-352.37 222.37Z",
  style: {
    fillRule: 'nonzero'
  },
  transform: "translate(-609.242 -419)"
}), /*#__PURE__*/React.createElement("path", {
  d: "M1041.87 1168.39c-174.663 0-316.761-142.1-316.761-316.764 0-58.162 15.899-115.027 45.983-164.453l8.242 5.019c-29.16 47.912-44.574 103.044-44.574 159.434 0 169.344 137.769 307.104 307.11 307.104 145.26 0 271.79-103.12 300.87-245.208l9.45 1.937c-29.99 146.551-160.5 252.931-310.32 252.931Z",
  style: {
    fillRule: 'nonzero'
  },
  transform: "translate(-609.242 -419)"
}), /*#__PURE__*/React.createElement("path", {
  d: "M1041.87 438.118c-228.012 0-413.51 185.498-413.51 413.508 0 228.014 185.498 413.504 413.51 413.504 228.01 0 413.51-185.49 413.51-413.504 0-228.01-185.5-413.508-413.51-413.508Zm0 846.132c-238.551 0-432.628-194.07-432.628-432.624C609.242 613.077 803.319 419 1041.87 419c238.55 0 432.62 194.077 432.62 432.626 0 238.554-194.07 432.624-432.62 432.624Z",
  style: {
    fillRule: 'nonzero'
  },
  transform: "translate(-609.242 -419)"
}), /*#__PURE__*/React.createElement("path", {
  d: "M1041.87 605.808c-135.547 0-245.819 110.273-245.819 245.818 0 135.545 110.272 245.814 245.819 245.814 135.54 0 245.82-110.269 245.82-245.814s-110.28-245.818-245.82-245.818Zm0 506.112c-143.529 0-260.296-116.766-260.296-260.294 0-143.528 116.767-260.294 260.296-260.294 143.53 0 260.29 116.766 260.29 260.294 0 143.528-116.76 260.294-260.29 260.294Z",
  style: {
    fill: '#fff',
    fillRule: 'nonzero'
  },
  transform: "translate(-609.242 -419)"
}), /*#__PURE__*/React.createElement("path", {
  d: "M1290.38 689.685c0 38.714-31.39 70.098-70.1 70.098-38.71 0-70.1-31.384-70.1-70.098s31.39-70.098 70.1-70.098c38.71 0 70.1 31.384 70.1 70.098ZM1145.61 851.626c0 57.298-46.44 103.747-103.74 103.747-57.299 0-103.748-46.449-103.748-103.747 0-57.297 46.449-103.746 103.748-103.746 57.3 0 103.74 46.449 103.74 103.746Z",
  style: {
    fill: '#fff',
    fillRule: 'nonzero'
  },
  transform: "translate(-609.242 -419)"
}), /*#__PURE__*/React.createElement("path", {
  d: "M1002.57 933.972c0 16.337-13.239 29.581-29.576 29.581-16.338 0-29.581-13.244-29.581-29.581s13.243-29.581 29.581-29.581c16.337 0 29.576 13.244 29.576 29.581ZM1027.28 894.167c0 9.01-7.31 16.313-16.32 16.313-9 0-16.308-7.303-16.308-16.313 0-9.009 7.308-16.312 16.308-16.312 9.01 0 16.32 7.303 16.32 16.312Z",
  style: {
    fillRule: 'nonzero'
  },
  transform: "translate(-609.242 -419)"
}));
(0,_wordpress_blocks__WEBPACK_IMPORTED_MODULE_1__.registerBlockType)(_block_json__WEBPACK_IMPORTED_MODULE_0__, {
  icon: PhotoBlockIcon,
  edit: PhotoBlock,
  // Render via PHP
  save: function save() {
    return null;
  }
});

/***/ }),

/***/ "./src/components/UploadStatus/index.js":
/*!**********************************************!*\
  !*** ./src/components/UploadStatus/index.js ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _editor_scss__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./editor.scss */ "./src/components/UploadStatus/editor.scss");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @wordpress/components */ "@wordpress/components");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/x-circle.js");
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/redo-2.js");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @wordpress/i18n */ "@wordpress/i18n");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../contexts/UploaderContext */ "./src/contexts/UploaderContext.js");
/**
 * Upload data row including Upload|Media Library|URL|Data.
 */






var UploadStatus = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_2__.forwardRef)(function (props, ref) {
  // Read in context values.
  var _useContext = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_2__.useContext)(_contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_4__["default"]),
    imageFile = _useContext.imageFile,
    setIsUploading = _useContext.setIsUploading,
    setIsProcessingUpload = _useContext.setIsProcessingUpload,
    isUploadError = _useContext.isUploadError,
    setIsUploadError = _useContext.setIsUploadError;
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
    className: "dlx-photo-block__upload-status"
  }, /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
    variant: "secondary",
    icon: /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_5__["default"], null),
    onClick: function onClick() {
      setIsUploadError(false);
      setIsUploading(false);
      setIsProcessingUpload(false);
      ref.current.removeFile();
    }
  }, (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_3__.__)('Cancel', 'photo-block')), isUploadError && /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
    variant: "secondary",
    icon: /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_6__["default"], null),
    onClick: function onClick() {
      setIsUploading(true);
      setIsUploadError(false);
      ref.current.addFile(imageFile.file);
    }
  }, (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_3__.__)('Retry Image', 'photo-block'))));
});
/* harmony default export */ __webpack_exports__["default"] = (UploadStatus);

/***/ }),

/***/ "./src/components/UploadTarget/index.js":
/*!**********************************************!*\
  !*** ./src/components/UploadTarget/index.js ***!
  \**********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _editor_scss__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./editor.scss */ "./src/components/UploadTarget/editor.scss");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @wordpress/components */ "@wordpress/components");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var react_filepond__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react-filepond */ "./node_modules/react-filepond/dist/react-filepond.js");
/* harmony import */ var filepond_plugin_image_preview__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! filepond-plugin-image-preview */ "./node_modules/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js");
/* harmony import */ var filepond_plugin_image_preview__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(filepond_plugin_image_preview__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var filepond_plugin_image_exif_orientation__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! filepond-plugin-image-exif-orientation */ "./node_modules/filepond-plugin-image-exif-orientation/dist/filepond-plugin-image-exif-orientation.js");
/* harmony import */ var filepond_plugin_image_exif_orientation__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(filepond_plugin_image_exif_orientation__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var filepond_plugin_file_validate_type__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! filepond-plugin-file-validate-type */ "./node_modules/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js");
/* harmony import */ var filepond_plugin_file_validate_type__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(filepond_plugin_file_validate_type__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var filepond_plugin_image_preview_dist_filepond_plugin_image_preview_css__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css */ "./node_modules/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css");
/* harmony import */ var filepond_dist_filepond_min_css__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! filepond/dist/filepond.min.css */ "./node_modules/filepond/dist/filepond.min.css");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/upload.js");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @wordpress/i18n */ "@wordpress/i18n");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_9__);
/* harmony import */ var _contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../contexts/UploaderContext */ "./src/contexts/UploaderContext.js");
/* harmony import */ var _blocks_photo_block_icons_filepond__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../blocks/photo-block/icons/filepond */ "./src/blocks/photo-block/icons/filepond.js");
/**
 * Upload data row including Upload|Media Library|URL|Data.
 */













// Register filepond plugins.
(0,react_filepond__WEBPACK_IMPORTED_MODULE_2__.registerPlugin)((filepond_plugin_image_preview__WEBPACK_IMPORTED_MODULE_3___default()), (filepond_plugin_image_exif_orientation__WEBPACK_IMPORTED_MODULE_4___default()), (filepond_plugin_file_validate_type__WEBPACK_IMPORTED_MODULE_5___default()));

var UploadTarget = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_8__.forwardRef)(function (props, ref) {
  var _useContext = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_8__.useContext)(_contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_10__["default"]),
    setImageFile = _useContext.setImageFile,
    isUploading = _useContext.isUploading,
    setIsUploading = _useContext.setIsUploading,
    isProcessingUpload = _useContext.isProcessingUpload,
    setIsProcessingUpload = _useContext.setIsProcessingUpload,
    setIsUploadError = _useContext.setIsUploadError,
    setScreen = _useContext.setScreen;
  var setAttributes = props.setAttributes;
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
    className: "dlx-photo-block__upload-target__container"
  }, /*#__PURE__*/React.createElement("div", {
    className: "dlx-photo-block__upload-target__filepond"
  }, /*#__PURE__*/React.createElement(react_filepond__WEBPACK_IMPORTED_MODULE_2__.FilePond, {
    allowMultiple: false,
    maxFiles: 1,
    server: {
      process: function process(fieldName, file, metadata, load, error, progress, _abort, transfer, options) {
        // todo - Need error checking and handling here.
        var formData = new FormData();
        formData.append('file', file, file.name);
        var request = new XMLHttpRequest();
        request.open('POST', photoBlock.restUrl + '/add-image');
        request.setRequestHeader('X-WP-Nonce', photoBlock.restNonce);
        request.upload.onprogress = function (e) {
          progress(e.lengthComputable, e.loaded, e.total);
        };
        request.onload = function () {
          if (request.status >= 200 && request.status < 300) {
            setAttributes({
              photo: JSON.parse(request.responseText)
            });
            setImageFile(JSON.parse(request.responseText));
            load(request.responseText);
          } else {
            error('oh no');
          }
        };
        request.send(formData);
        return {
          abort: function abort() {
            request.abort();
            _abort();
          }
        };
      }
    },
    credits: false,
    stylePanelLayout: "integrated",
    labelIdle: "",
    labelFileLoading: false,
    allowRemove: false,
    allowRevert: false,
    ref: ref,
    labelFileTypeNotAllowed: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_9__.__)('Invalid file type', 'photo-block'),
    labelTapToCancel: (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_9__.__)('Click to cancel', 'photo-block'),
    acceptedFileTypes: ['image/*'],
    onaddfilestart: function onaddfilestart() {
      setIsUploading(true);
    },
    onprocessfileabort: function onprocessfileabort() {
      setIsUploading(false);
      setIsProcessingUpload(false);
    },
    onerror: function onerror(error) {
      setIsUploadError(true);
      setIsUploading(false);
      setIsProcessingUpload(false);
    },
    imagePreviewMaxFileSize: "4MB",
    iconRetry: _blocks_photo_block_icons_filepond__WEBPACK_IMPORTED_MODULE_11__.redoSvg,
    iconProcess: _blocks_photo_block_icons_filepond__WEBPACK_IMPORTED_MODULE_11__.processSvg,
    onprocessfile: function onprocessfile(error, file) {
      setIsProcessingUpload(false);
      setIsUploading(false);
      setScreen('edit');
      setAttributes({
        screen: 'edit'
      });
    }
  })), !isUploading && !isProcessingUpload && /*#__PURE__*/React.createElement("div", {
    className: "dlx-photo-block__upload-target__label"
  }, /*#__PURE__*/React.createElement("div", {
    className: "dlx-photo-block__upload-target__label-svg"
  }, /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_12__["default"], null)), /*#__PURE__*/React.createElement("div", {
    className: "dlx-photo-block__upload-target__label-text"
  }, (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_9__.__)('Drag Photo Here or Upload', 'photo-block')))));
});
/* harmony default export */ __webpack_exports__["default"] = (UploadTarget);

/***/ }),

/***/ "./src/components/UploadTypes/index.js":
/*!*********************************************!*\
  !*** ./src/components/UploadTypes/index.js ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _editor_scss__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./editor.scss */ "./src/components/UploadTypes/editor.scss");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @wordpress/components */ "@wordpress/components");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/upload.js");
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/image.js");
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/link.js");
/* harmony import */ var lucide_react__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! lucide-react */ "./node_modules/lucide-react/dist/esm/icons/database.js");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @wordpress/i18n */ "@wordpress/i18n");
/* harmony import */ var _wordpress_i18n__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_wordpress_i18n__WEBPACK_IMPORTED_MODULE_3__);
/**
 * Upload data row including Upload|Media Library|URL|Data.
 */





var UploadTypes = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_2__.forwardRef)(function (props, ref) {
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
    className: "dlx-photo-block__upload-types__container"
  }, /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
    variant: "secondary",
    icon: /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_4__["default"], null),
    onClick: function onClick() {
      ref.current.browse();
    }
  }, (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_3__.__)('Upload', 'photo-block')), /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
    variant: "secondary",
    icon: /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_5__["default"], null)
  }, (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_3__.__)('Media Library', 'photo-block')), /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
    variant: "secondary",
    icon: /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_6__["default"], null)
  }, (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_3__.__)('URL', 'photo-block')), /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_1__.Button, {
    variant: "secondary",
    icon: /*#__PURE__*/React.createElement(lucide_react__WEBPACK_IMPORTED_MODULE_7__["default"], null)
  }, (0,_wordpress_i18n__WEBPACK_IMPORTED_MODULE_3__.__)('Data', 'photo-block'))));
});
/* harmony default export */ __webpack_exports__["default"] = (UploadTypes);

/***/ }),

/***/ "./src/contexts/UploaderContext.js":
/*!*****************************************!*\
  !*** ./src/contexts/UploaderContext.js ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_0__);

var UploaderContext = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.createContext)();
/* harmony default export */ __webpack_exports__["default"] = (UploaderContext);

/***/ }),

/***/ "./src/screens/Edit/index.js":
/*!***********************************!*\
  !*** ./src/screens/Edit/index.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _editor_scss__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./editor.scss */ "./src/screens/Edit/editor.scss");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @wordpress/components */ "@wordpress/components");
/* harmony import */ var _wordpress_components__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_wordpress_components__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../contexts/UploaderContext */ "./src/contexts/UploaderContext.js");
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _iterableToArrayLimit(arr, i) { var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }
function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }




var EditScreen = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_1__.forwardRef)(function (props, ref) {
  var attributes = props.attributes,
    setAttributes = props.setAttributes;
  var photo = attributes.photo;
  var url = photo.url,
    id = photo.id,
    width = photo.width,
    height = photo.height;
  var _useState = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_1__.useState)(true),
    _useState2 = _slicedToArray(_useState, 2),
    imageLoading = _useState2[0],
    setImageLoading = _useState2[1];
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
    className: "dlx-photo-block__screen-edit"
  }, imageLoading && /*#__PURE__*/React.createElement("div", {
    className: "dlx-photo-block__screen-edit-spinner"
  }, /*#__PURE__*/React.createElement(_wordpress_components__WEBPACK_IMPORTED_MODULE_2__.Spinner, null)), /*#__PURE__*/React.createElement("img", {
    src: url,
    width: width,
    height: height,
    alt: "",
    onLoad: function onLoad() {
      setImageLoading(false);
    },
    ref: ref
  })));
});
/* harmony default export */ __webpack_exports__["default"] = (EditScreen);

/***/ }),

/***/ "./src/screens/Initial/index.js":
/*!**************************************!*\
  !*** ./src/screens/Initial/index.js ***!
  \**************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @wordpress/element */ "@wordpress/element");
/* harmony import */ var _wordpress_element__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_wordpress_element__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../contexts/UploaderContext */ "./src/contexts/UploaderContext.js");
/* harmony import */ var _components_UploadTypes__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../components/UploadTypes */ "./src/components/UploadTypes/index.js");
/* harmony import */ var _components_UploadTarget__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../components/UploadTarget */ "./src/components/UploadTarget/index.js");
/* harmony import */ var _components_UploadStatus__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../components/UploadStatus */ "./src/components/UploadStatus/index.js");





var InitialScreen = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(function (props, ref) {
  var _useContext = (0,_wordpress_element__WEBPACK_IMPORTED_MODULE_0__.useContext)(_contexts_UploaderContext__WEBPACK_IMPORTED_MODULE_1__["default"]),
    isUploading = _useContext.isUploading,
    isProcessingUpload = _useContext.isProcessingUpload,
    isUploadError = _useContext.isUploadError;
  return /*#__PURE__*/React.createElement("div", {
    className: "dlx-photo-block__screen-initial"
  }, !isUploading && !isProcessingUpload && !isUploadError && /*#__PURE__*/React.createElement(_components_UploadTypes__WEBPACK_IMPORTED_MODULE_2__["default"], {
    ref: ref
  }), (isUploading || isProcessingUpload || isUploadError) && /*#__PURE__*/React.createElement(_components_UploadStatus__WEBPACK_IMPORTED_MODULE_4__["default"], {
    ref: ref
  }), /*#__PURE__*/React.createElement(_components_UploadTarget__WEBPACK_IMPORTED_MODULE_3__["default"], {
    ref: ref,
    attributes: props.attributes,
    setAttributes: props.setAttributes
  }));
});
/* harmony default export */ __webpack_exports__["default"] = (InitialScreen);

/***/ }),

/***/ "./node_modules/classnames/index.js":
/*!******************************************!*\
  !*** ./node_modules/classnames/index.js ***!
  \******************************************/
/***/ (function(module, exports) {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/
/* global define */

(function () {
	'use strict';

	var hasOwn = {}.hasOwnProperty;
	var nativeCodeString = '[native code]';

	function classNames() {
		var classes = [];

		for (var i = 0; i < arguments.length; i++) {
			var arg = arguments[i];
			if (!arg) continue;

			var argType = typeof arg;

			if (argType === 'string' || argType === 'number') {
				classes.push(arg);
			} else if (Array.isArray(arg)) {
				if (arg.length) {
					var inner = classNames.apply(null, arg);
					if (inner) {
						classes.push(inner);
					}
				}
			} else if (argType === 'object') {
				if (arg.toString !== Object.prototype.toString && !arg.toString.toString().includes('[native code]')) {
					classes.push(arg.toString());
					continue;
				}

				for (var key in arg) {
					if (hasOwn.call(arg, key) && arg[key]) {
						classes.push(key);
					}
				}
			}
		}

		return classes.join(' ');
	}

	if ( true && module.exports) {
		classNames.default = classNames;
		module.exports = classNames;
	} else if (true) {
		// register as 'classnames', consistent with npm package name
		!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = (function () {
			return classNames;
		}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
	} else {}
}());


/***/ }),

/***/ "./node_modules/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js":
/*!****************************************************************************************************!*\
  !*** ./node_modules/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js ***!
  \****************************************************************************************************/
/***/ (function(module) {

/*!
 * FilePondPluginFileValidateType 1.2.8
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

(function(global, factory) {
   true
    ? (module.exports = factory())
    : 0;
})(this, function() {
  'use strict';

  var plugin = function plugin(_ref) {
    var addFilter = _ref.addFilter,
      utils = _ref.utils;
    // get quick reference to Type utils
    var Type = utils.Type,
      isString = utils.isString,
      replaceInString = utils.replaceInString,
      guesstimateMimeType = utils.guesstimateMimeType,
      getExtensionFromFilename = utils.getExtensionFromFilename,
      getFilenameFromURL = utils.getFilenameFromURL;

    var mimeTypeMatchesWildCard = function mimeTypeMatchesWildCard(
      mimeType,
      wildcard
    ) {
      var mimeTypeGroup = (/^[^/]+/.exec(mimeType) || []).pop(); // image/png -> image
      var wildcardGroup = wildcard.slice(0, -2); // image/* -> image
      return mimeTypeGroup === wildcardGroup;
    };

    var isValidMimeType = function isValidMimeType(
      acceptedTypes,
      userInputType
    ) {
      return acceptedTypes.some(function(acceptedType) {
        // accepted is wildcard mime type
        if (/\*$/.test(acceptedType)) {
          return mimeTypeMatchesWildCard(userInputType, acceptedType);
        }

        // is normal mime type
        return acceptedType === userInputType;
      });
    };

    var getItemType = function getItemType(item) {
      // if the item is a url we guess the mime type by the extension
      var type = '';
      if (isString(item)) {
        var filename = getFilenameFromURL(item);
        var extension = getExtensionFromFilename(filename);
        if (extension) {
          type = guesstimateMimeType(extension);
        }
      } else {
        type = item.type;
      }

      return type;
    };

    var validateFile = function validateFile(
      item,
      acceptedFileTypes,
      typeDetector
    ) {
      // no types defined, everything is allowed \o/
      if (acceptedFileTypes.length === 0) {
        return true;
      }

      // gets the item type
      var type = getItemType(item);

      // no type detector, test now
      if (!typeDetector) {
        return isValidMimeType(acceptedFileTypes, type);
      }

      // use type detector
      return new Promise(function(resolve, reject) {
        typeDetector(item, type)
          .then(function(detectedType) {
            if (isValidMimeType(acceptedFileTypes, detectedType)) {
              resolve();
            } else {
              reject();
            }
          })
          .catch(reject);
      });
    };

    var applyMimeTypeMap = function applyMimeTypeMap(map) {
      return function(acceptedFileType) {
        return map[acceptedFileType] === null
          ? false
          : map[acceptedFileType] || acceptedFileType;
      };
    };

    // setup attribute mapping for accept
    addFilter('SET_ATTRIBUTE_TO_OPTION_MAP', function(map) {
      return Object.assign(map, {
        accept: 'acceptedFileTypes'
      });
    });

    // filtering if an item is allowed in hopper
    addFilter('ALLOW_HOPPER_ITEM', function(file, _ref2) {
      var query = _ref2.query;
      // if we are not doing file type validation exit
      if (!query('GET_ALLOW_FILE_TYPE_VALIDATION')) {
        return true;
      }

      // we validate the file against the accepted file types
      return validateFile(file, query('GET_ACCEPTED_FILE_TYPES'));
    });

    // called for each file that is loaded
    // right before it is set to the item state
    // should return a promise
    addFilter('LOAD_FILE', function(file, _ref3) {
      var query = _ref3.query;
      return new Promise(function(resolve, reject) {
        if (!query('GET_ALLOW_FILE_TYPE_VALIDATION')) {
          resolve(file);
          return;
        }

        var acceptedFileTypes = query('GET_ACCEPTED_FILE_TYPES');

        // custom type detector method
        var typeDetector = query('GET_FILE_VALIDATE_TYPE_DETECT_TYPE');

        // if invalid, exit here
        var validationResult = validateFile(
          file,
          acceptedFileTypes,
          typeDetector
        );

        var handleRejection = function handleRejection() {
          var acceptedFileTypesMapped = acceptedFileTypes
            .map(
              applyMimeTypeMap(
                query('GET_FILE_VALIDATE_TYPE_LABEL_EXPECTED_TYPES_MAP')
              )
            )
            .filter(function(label) {
              return label !== false;
            });

          var acceptedFileTypesMapped_unique = acceptedFileTypesMapped.filter(
            function(item, index) {
              return acceptedFileTypesMapped.indexOf(item) === index;
            }
          );

          reject({
            status: {
              main: query('GET_LABEL_FILE_TYPE_NOT_ALLOWED'),
              sub: replaceInString(
                query('GET_FILE_VALIDATE_TYPE_LABEL_EXPECTED_TYPES'),
                {
                  allTypes: acceptedFileTypesMapped_unique.join(', '),
                  allButLastType: acceptedFileTypesMapped_unique
                    .slice(0, -1)
                    .join(', '),
                  lastType:
                    acceptedFileTypesMapped_unique[
                      acceptedFileTypesMapped.length - 1
                    ]
                }
              )
            }
          });
        };

        // has returned new filename immidiately
        if (typeof validationResult === 'boolean') {
          if (!validationResult) {
            return handleRejection();
          }
          return resolve(file);
        }

        // is promise
        validationResult
          .then(function() {
            resolve(file);
          })
          .catch(handleRejection);
      });
    });

    // expose plugin
    return {
      // default options
      options: {
        // Enable or disable file type validation
        allowFileTypeValidation: [true, Type.BOOLEAN],

        // What file types to accept
        acceptedFileTypes: [[], Type.ARRAY],
        // - must be comma separated
        // - mime types: image/png, image/jpeg, image/gif
        // - extensions: .png, .jpg, .jpeg ( not enabled yet )
        // - wildcards: image/*

        // label to show when a type is not allowed
        labelFileTypeNotAllowed: ['File is of invalid type', Type.STRING],

        // nicer label
        fileValidateTypeLabelExpectedTypes: [
          'Expects {allButLastType} or {lastType}',
          Type.STRING
        ],

        // map mime types to extensions
        fileValidateTypeLabelExpectedTypesMap: [{}, Type.OBJECT],

        // Custom function to detect type of file
        fileValidateTypeDetectType: [null, Type.FUNCTION]
      }
    };
  };

  // fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags
  var isBrowser =
    typeof window !== 'undefined' && typeof window.document !== 'undefined';
  if (isBrowser) {
    document.dispatchEvent(
      new CustomEvent('FilePond:pluginloaded', { detail: plugin })
    );
  }

  return plugin;
});


/***/ }),

/***/ "./node_modules/filepond-plugin-image-exif-orientation/dist/filepond-plugin-image-exif-orientation.js":
/*!************************************************************************************************************!*\
  !*** ./node_modules/filepond-plugin-image-exif-orientation/dist/filepond-plugin-image-exif-orientation.js ***!
  \************************************************************************************************************/
/***/ (function(module) {

/*!
 * FilePondPluginImageExifOrientation 1.0.11
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

(function(global, factory) {
   true
    ? (module.exports = factory())
    : 0;
})(this, function() {
  'use strict';

  // test if file is of type image
  var isJPEG = function isJPEG(file) {
    return /^image\/jpeg/.test(file.type);
  };

  var Marker = {
    JPEG: 0xffd8,
    APP1: 0xffe1,
    EXIF: 0x45786966,
    TIFF: 0x4949,
    Orientation: 0x0112,
    Unknown: 0xff00
  };

  var getUint16 = function getUint16(view, offset) {
    var little =
      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    return view.getUint16(offset, little);
  };
  var getUint32 = function getUint32(view, offset) {
    var little =
      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    return view.getUint32(offset, little);
  };

  var getImageOrientation = function getImageOrientation(file) {
    return new Promise(function(resolve, reject) {
      var reader = new FileReader();
      reader.onload = function(e) {
        var view = new DataView(e.target.result);

        // Every JPEG file starts from binary value '0xFFD8'
        if (getUint16(view, 0) !== Marker.JPEG) {
          // This aint no JPEG
          resolve(-1);
          return;
        }

        var length = view.byteLength;
        var offset = 2;

        while (offset < length) {
          var marker = getUint16(view, offset);
          offset += 2;

          // There's our APP1 Marker
          if (marker === Marker.APP1) {
            if (getUint32(view, (offset += 2)) !== Marker.EXIF) {
              // no EXIF info defined
              break;
            }

            // Get TIFF Header
            var little = getUint16(view, (offset += 6)) === Marker.TIFF;
            offset += getUint32(view, offset + 4, little);

            var tags = getUint16(view, offset, little);
            offset += 2;

            for (var i = 0; i < tags; i++) {
              // found the orientation tag
              if (
                getUint16(view, offset + i * 12, little) === Marker.Orientation
              ) {
                resolve(getUint16(view, offset + i * 12 + 8, little));

                return;
              }
            }
          } else if ((marker & Marker.Unknown) !== Marker.Unknown) {
            // Invalid
            break;
          } else {
            offset += getUint16(view, offset);
          }
        }

        // Nothing found
        resolve(-1);
      };

      // we don't need to read the entire file to get the orientation
      reader.readAsArrayBuffer(file.slice(0, 64 * 1024));
    });
  };

  var IS_BROWSER = (function() {
    return (
      typeof window !== 'undefined' && typeof window.document !== 'undefined'
    );
  })();
  var isBrowser = function isBrowser() {
    return IS_BROWSER;
  };

  // 2x1 pixel image 90CW rotated with orientation header
  var testSrc =
    'data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=';

  // should correct orientation if is presented in landscape, in which case the browser doesn't autocorrect
  var shouldCorrect = undefined;
  var testImage = isBrowser() ? new Image() : {};
  testImage.onload = function() {
    return (shouldCorrect = testImage.naturalWidth > testImage.naturalHeight);
  };
  testImage.src = testSrc;

  var shouldCorrectImageExifOrientation = function shouldCorrectImageExifOrientation() {
    return shouldCorrect;
  };

  /**
   * Read Image Orientation Plugin
   */
  var plugin = function plugin(_ref) {
    var addFilter = _ref.addFilter,
      utils = _ref.utils;
    var Type = utils.Type,
      isFile = utils.isFile;

    // subscribe to file load and append required info
    addFilter('DID_LOAD_ITEM', function(item, _ref2) {
      var query = _ref2.query;
      return new Promise(function(resolve, reject) {
        // get file reference
        var file = item.file;

        // if this is not a jpeg image we are not interested
        if (
          !isFile(file) ||
          !isJPEG(file) ||
          !query('GET_ALLOW_IMAGE_EXIF_ORIENTATION') ||
          !shouldCorrectImageExifOrientation()
        ) {
          // continue with the unaltered dataset
          return resolve(item);
        }

        // get orientation from exif data
        getImageOrientation(file).then(function(orientation) {
          item.setMetadata('exif', { orientation: orientation });
          resolve(item);
        });
      });
    });

    // Expose plugin options
    return {
      options: {
        // Enable or disable image orientation reading
        allowImageExifOrientation: [true, Type.BOOLEAN]
      }
    };
  };

  // fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags
  var isBrowser$1 =
    typeof window !== 'undefined' && typeof window.document !== 'undefined';
  if (isBrowser$1) {
    document.dispatchEvent(
      new CustomEvent('FilePond:pluginloaded', { detail: plugin })
    );
  }

  return plugin;
});


/***/ }),

/***/ "./node_modules/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js":
/*!******************************************************************************************!*\
  !*** ./node_modules/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js ***!
  \******************************************************************************************/
/***/ (function(module) {

/*!
 * FilePondPluginImagePreview 4.6.11
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

(function(global, factory) {
   true
    ? (module.exports = factory())
    : 0;
})(this, function() {
  'use strict';

  // test if file is of type image and can be viewed in canvas
  var isPreviewableImage = function isPreviewableImage(file) {
    return /^image/.test(file.type);
  };

  function _typeof(obj) {
    if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {
      _typeof = function(obj) {
        return typeof obj;
      };
    } else {
      _typeof = function(obj) {
        return obj &&
          typeof Symbol === 'function' &&
          obj.constructor === Symbol &&
          obj !== Symbol.prototype
          ? 'symbol'
          : typeof obj;
      };
    }

    return _typeof(obj);
  }

  var REACT_ELEMENT_TYPE;

  function _jsx(type, props, key, children) {
    if (!REACT_ELEMENT_TYPE) {
      REACT_ELEMENT_TYPE =
        (typeof Symbol === 'function' &&
          Symbol.for &&
          Symbol.for('react.element')) ||
        0xeac7;
    }

    var defaultProps = type && type.defaultProps;
    var childrenLength = arguments.length - 3;

    if (!props && childrenLength !== 0) {
      props = {
        children: void 0
      };
    }

    if (props && defaultProps) {
      for (var propName in defaultProps) {
        if (props[propName] === void 0) {
          props[propName] = defaultProps[propName];
        }
      }
    } else if (!props) {
      props = defaultProps || {};
    }

    if (childrenLength === 1) {
      props.children = children;
    } else if (childrenLength > 1) {
      var childArray = new Array(childrenLength);

      for (var i = 0; i < childrenLength; i++) {
        childArray[i] = arguments[i + 3];
      }

      props.children = childArray;
    }

    return {
      $$typeof: REACT_ELEMENT_TYPE,
      type: type,
      key: key === undefined ? null : '' + key,
      ref: null,
      props: props,
      _owner: null
    };
  }

  function _asyncIterator(iterable) {
    var method;

    if (typeof Symbol === 'function') {
      if (Symbol.asyncIterator) {
        method = iterable[Symbol.asyncIterator];
        if (method != null) return method.call(iterable);
      }

      if (Symbol.iterator) {
        method = iterable[Symbol.iterator];
        if (method != null) return method.call(iterable);
      }
    }

    throw new TypeError('Object is not async iterable');
  }

  function _AwaitValue(value) {
    this.wrapped = value;
  }

  function _AsyncGenerator(gen) {
    var front, back;

    function send(key, arg) {
      return new Promise(function(resolve, reject) {
        var request = {
          key: key,
          arg: arg,
          resolve: resolve,
          reject: reject,
          next: null
        };

        if (back) {
          back = back.next = request;
        } else {
          front = back = request;
          resume(key, arg);
        }
      });
    }

    function resume(key, arg) {
      try {
        var result = gen[key](arg);
        var value = result.value;
        var wrappedAwait = value instanceof _AwaitValue;
        Promise.resolve(wrappedAwait ? value.wrapped : value).then(
          function(arg) {
            if (wrappedAwait) {
              resume('next', arg);
              return;
            }

            settle(result.done ? 'return' : 'normal', arg);
          },
          function(err) {
            resume('throw', err);
          }
        );
      } catch (err) {
        settle('throw', err);
      }
    }

    function settle(type, value) {
      switch (type) {
        case 'return':
          front.resolve({
            value: value,
            done: true
          });
          break;

        case 'throw':
          front.reject(value);
          break;

        default:
          front.resolve({
            value: value,
            done: false
          });
          break;
      }

      front = front.next;

      if (front) {
        resume(front.key, front.arg);
      } else {
        back = null;
      }
    }

    this._invoke = send;

    if (typeof gen.return !== 'function') {
      this.return = undefined;
    }
  }

  if (typeof Symbol === 'function' && Symbol.asyncIterator) {
    _AsyncGenerator.prototype[Symbol.asyncIterator] = function() {
      return this;
    };
  }

  _AsyncGenerator.prototype.next = function(arg) {
    return this._invoke('next', arg);
  };

  _AsyncGenerator.prototype.throw = function(arg) {
    return this._invoke('throw', arg);
  };

  _AsyncGenerator.prototype.return = function(arg) {
    return this._invoke('return', arg);
  };

  function _wrapAsyncGenerator(fn) {
    return function() {
      return new _AsyncGenerator(fn.apply(this, arguments));
    };
  }

  function _awaitAsyncGenerator(value) {
    return new _AwaitValue(value);
  }

  function _asyncGeneratorDelegate(inner, awaitWrap) {
    var iter = {},
      waiting = false;

    function pump(key, value) {
      waiting = true;
      value = new Promise(function(resolve) {
        resolve(inner[key](value));
      });
      return {
        done: false,
        value: awaitWrap(value)
      };
    }

    if (typeof Symbol === 'function' && Symbol.iterator) {
      iter[Symbol.iterator] = function() {
        return this;
      };
    }

    iter.next = function(value) {
      if (waiting) {
        waiting = false;
        return value;
      }

      return pump('next', value);
    };

    if (typeof inner.throw === 'function') {
      iter.throw = function(value) {
        if (waiting) {
          waiting = false;
          throw value;
        }

        return pump('throw', value);
      };
    }

    if (typeof inner.return === 'function') {
      iter.return = function(value) {
        return pump('return', value);
      };
    }

    return iter;
  }

  function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
    try {
      var info = gen[key](arg);
      var value = info.value;
    } catch (error) {
      reject(error);
      return;
    }

    if (info.done) {
      resolve(value);
    } else {
      Promise.resolve(value).then(_next, _throw);
    }
  }

  function _asyncToGenerator(fn) {
    return function() {
      var self = this,
        args = arguments;
      return new Promise(function(resolve, reject) {
        var gen = fn.apply(self, args);

        function _next(value) {
          asyncGeneratorStep(
            gen,
            resolve,
            reject,
            _next,
            _throw,
            'next',
            value
          );
        }

        function _throw(err) {
          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);
        }

        _next(undefined);
      });
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError('Cannot call a class as a function');
    }
  }

  function _defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ('value' in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  function _createClass(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties(Constructor, staticProps);
    return Constructor;
  }

  function _defineEnumerableProperties(obj, descs) {
    for (var key in descs) {
      var desc = descs[key];
      desc.configurable = desc.enumerable = true;
      if ('value' in desc) desc.writable = true;
      Object.defineProperty(obj, key, desc);
    }

    if (Object.getOwnPropertySymbols) {
      var objectSymbols = Object.getOwnPropertySymbols(descs);

      for (var i = 0; i < objectSymbols.length; i++) {
        var sym = objectSymbols[i];
        var desc = descs[sym];
        desc.configurable = desc.enumerable = true;
        if ('value' in desc) desc.writable = true;
        Object.defineProperty(obj, sym, desc);
      }
    }

    return obj;
  }

  function _defaults(obj, defaults) {
    var keys = Object.getOwnPropertyNames(defaults);

    for (var i = 0; i < keys.length; i++) {
      var key = keys[i];
      var value = Object.getOwnPropertyDescriptor(defaults, key);

      if (value && value.configurable && obj[key] === undefined) {
        Object.defineProperty(obj, key, value);
      }
    }

    return obj;
  }

  function _defineProperty(obj, key, value) {
    if (key in obj) {
      Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
      });
    } else {
      obj[key] = value;
    }

    return obj;
  }

  function _extends() {
    _extends =
      Object.assign ||
      function(target) {
        for (var i = 1; i < arguments.length; i++) {
          var source = arguments[i];

          for (var key in source) {
            if (Object.prototype.hasOwnProperty.call(source, key)) {
              target[key] = source[key];
            }
          }
        }

        return target;
      };

    return _extends.apply(this, arguments);
  }

  function _objectSpread(target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i] != null ? arguments[i] : {};
      var ownKeys = Object.keys(source);

      if (typeof Object.getOwnPropertySymbols === 'function') {
        ownKeys = ownKeys.concat(
          Object.getOwnPropertySymbols(source).filter(function(sym) {
            return Object.getOwnPropertyDescriptor(source, sym).enumerable;
          })
        );
      }

      ownKeys.forEach(function(key) {
        _defineProperty(target, key, source[key]);
      });
    }

    return target;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== 'function' && superClass !== null) {
      throw new TypeError('Super expression must either be null or a function');
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        writable: true,
        configurable: true
      }
    });
    if (superClass) _setPrototypeOf(subClass, superClass);
  }

  function _inheritsLoose(subClass, superClass) {
    subClass.prototype = Object.create(superClass.prototype);
    subClass.prototype.constructor = subClass;
    subClass.__proto__ = superClass;
  }

  function _getPrototypeOf(o) {
    _getPrototypeOf = Object.setPrototypeOf
      ? Object.getPrototypeOf
      : function _getPrototypeOf(o) {
          return o.__proto__ || Object.getPrototypeOf(o);
        };
    return _getPrototypeOf(o);
  }

  function _setPrototypeOf(o, p) {
    _setPrototypeOf =
      Object.setPrototypeOf ||
      function _setPrototypeOf(o, p) {
        o.__proto__ = p;
        return o;
      };

    return _setPrototypeOf(o, p);
  }

  function isNativeReflectConstruct() {
    if (typeof Reflect === 'undefined' || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === 'function') return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function() {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  function _construct(Parent, args, Class) {
    if (isNativeReflectConstruct()) {
      _construct = Reflect.construct;
    } else {
      _construct = function _construct(Parent, args, Class) {
        var a = [null];
        a.push.apply(a, args);
        var Constructor = Function.bind.apply(Parent, a);
        var instance = new Constructor();
        if (Class) _setPrototypeOf(instance, Class.prototype);
        return instance;
      };
    }

    return _construct.apply(null, arguments);
  }

  function _isNativeFunction(fn) {
    return Function.toString.call(fn).indexOf('[native code]') !== -1;
  }

  function _wrapNativeSuper(Class) {
    var _cache = typeof Map === 'function' ? new Map() : undefined;

    _wrapNativeSuper = function _wrapNativeSuper(Class) {
      if (Class === null || !_isNativeFunction(Class)) return Class;

      if (typeof Class !== 'function') {
        throw new TypeError(
          'Super expression must either be null or a function'
        );
      }

      if (typeof _cache !== 'undefined') {
        if (_cache.has(Class)) return _cache.get(Class);

        _cache.set(Class, Wrapper);
      }

      function Wrapper() {
        return _construct(Class, arguments, _getPrototypeOf(this).constructor);
      }

      Wrapper.prototype = Object.create(Class.prototype, {
        constructor: {
          value: Wrapper,
          enumerable: false,
          writable: true,
          configurable: true
        }
      });
      return _setPrototypeOf(Wrapper, Class);
    };

    return _wrapNativeSuper(Class);
  }

  function _instanceof(left, right) {
    if (
      right != null &&
      typeof Symbol !== 'undefined' &&
      right[Symbol.hasInstance]
    ) {
      return right[Symbol.hasInstance](left);
    } else {
      return left instanceof right;
    }
  }

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule
      ? obj
      : {
          default: obj
        };
  }

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc =
              Object.defineProperty && Object.getOwnPropertyDescriptor
                ? Object.getOwnPropertyDescriptor(obj, key)
                : {};

            if (desc.get || desc.set) {
              Object.defineProperty(newObj, key, desc);
            } else {
              newObj[key] = obj[key];
            }
          }
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function _newArrowCheck(innerThis, boundThis) {
    if (innerThis !== boundThis) {
      throw new TypeError('Cannot instantiate an arrow function');
    }
  }

  function _objectDestructuringEmpty(obj) {
    if (obj == null) throw new TypeError('Cannot destructure undefined');
  }

  function _objectWithoutPropertiesLoose(source, excluded) {
    if (source == null) return {};
    var target = {};
    var sourceKeys = Object.keys(source);
    var key, i;

    for (i = 0; i < sourceKeys.length; i++) {
      key = sourceKeys[i];
      if (excluded.indexOf(key) >= 0) continue;
      target[key] = source[key];
    }

    return target;
  }

  function _objectWithoutProperties(source, excluded) {
    if (source == null) return {};

    var target = _objectWithoutPropertiesLoose(source, excluded);

    var key, i;

    if (Object.getOwnPropertySymbols) {
      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);

      for (i = 0; i < sourceSymbolKeys.length; i++) {
        key = sourceSymbolKeys[i];
        if (excluded.indexOf(key) >= 0) continue;
        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;
        target[key] = source[key];
      }
    }

    return target;
  }

  function _assertThisInitialized(self) {
    if (self === void 0) {
      throw new ReferenceError(
        "this hasn't been initialised - super() hasn't been called"
      );
    }

    return self;
  }

  function _possibleConstructorReturn(self, call) {
    if (call && (typeof call === 'object' || typeof call === 'function')) {
      return call;
    }

    return _assertThisInitialized(self);
  }

  function _superPropBase(object, property) {
    while (!Object.prototype.hasOwnProperty.call(object, property)) {
      object = _getPrototypeOf(object);
      if (object === null) break;
    }

    return object;
  }

  function _get(target, property, receiver) {
    if (typeof Reflect !== 'undefined' && Reflect.get) {
      _get = Reflect.get;
    } else {
      _get = function _get(target, property, receiver) {
        var base = _superPropBase(target, property);

        if (!base) return;
        var desc = Object.getOwnPropertyDescriptor(base, property);

        if (desc.get) {
          return desc.get.call(receiver);
        }

        return desc.value;
      };
    }

    return _get(target, property, receiver || target);
  }

  function set(target, property, value, receiver) {
    if (typeof Reflect !== 'undefined' && Reflect.set) {
      set = Reflect.set;
    } else {
      set = function set(target, property, value, receiver) {
        var base = _superPropBase(target, property);

        var desc;

        if (base) {
          desc = Object.getOwnPropertyDescriptor(base, property);

          if (desc.set) {
            desc.set.call(receiver, value);
            return true;
          } else if (!desc.writable) {
            return false;
          }
        }

        desc = Object.getOwnPropertyDescriptor(receiver, property);

        if (desc) {
          if (!desc.writable) {
            return false;
          }

          desc.value = value;
          Object.defineProperty(receiver, property, desc);
        } else {
          _defineProperty(receiver, property, value);
        }

        return true;
      };
    }

    return set(target, property, value, receiver);
  }

  function _set(target, property, value, receiver, isStrict) {
    var s = set(target, property, value, receiver || target);

    if (!s && isStrict) {
      throw new Error('failed to set property');
    }

    return value;
  }

  function _taggedTemplateLiteral(strings, raw) {
    if (!raw) {
      raw = strings.slice(0);
    }

    return Object.freeze(
      Object.defineProperties(strings, {
        raw: {
          value: Object.freeze(raw)
        }
      })
    );
  }

  function _taggedTemplateLiteralLoose(strings, raw) {
    if (!raw) {
      raw = strings.slice(0);
    }

    strings.raw = raw;
    return strings;
  }

  function _temporalRef(val, name) {
    if (val === _temporalUndefined) {
      throw new ReferenceError(name + ' is not defined - temporal dead zone');
    } else {
      return val;
    }
  }

  function _readOnlyError(name) {
    throw new Error('"' + name + '" is read-only');
  }

  function _classNameTDZError(name) {
    throw new Error(
      'Class "' + name + '" cannot be referenced in computed property keys.'
    );
  }

  var _temporalUndefined = {};

  function _slicedToArray(arr, i) {
    return (
      _arrayWithHoles(arr) ||
      _iterableToArrayLimit(arr, i) ||
      _nonIterableRest()
    );
  }

  function _slicedToArrayLoose(arr, i) {
    return (
      _arrayWithHoles(arr) ||
      _iterableToArrayLimitLoose(arr, i) ||
      _nonIterableRest()
    );
  }

  function _toArray(arr) {
    return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();
  }

  function _toConsumableArray(arr) {
    return (
      _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()
    );
  }

  function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) {
      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++)
        arr2[i] = arr[i];

      return arr2;
    }
  }

  function _arrayWithHoles(arr) {
    if (Array.isArray(arr)) return arr;
  }

  function _iterableToArray(iter) {
    if (
      Symbol.iterator in Object(iter) ||
      Object.prototype.toString.call(iter) === '[object Arguments]'
    )
      return Array.from(iter);
  }

  function _iterableToArrayLimit(arr, i) {
    var _arr = [];
    var _n = true;
    var _d = false;
    var _e = undefined;

    try {
      for (
        var _i = arr[Symbol.iterator](), _s;
        !(_n = (_s = _i.next()).done);
        _n = true
      ) {
        _arr.push(_s.value);

        if (i && _arr.length === i) break;
      }
    } catch (err) {
      _d = true;
      _e = err;
    } finally {
      try {
        if (!_n && _i['return'] != null) _i['return']();
      } finally {
        if (_d) throw _e;
      }
    }

    return _arr;
  }

  function _iterableToArrayLimitLoose(arr, i) {
    var _arr = [];

    for (
      var _iterator = arr[Symbol.iterator](), _step;
      !(_step = _iterator.next()).done;

    ) {
      _arr.push(_step.value);

      if (i && _arr.length === i) break;
    }

    return _arr;
  }

  function _nonIterableSpread() {
    throw new TypeError('Invalid attempt to spread non-iterable instance');
  }

  function _nonIterableRest() {
    throw new TypeError('Invalid attempt to destructure non-iterable instance');
  }

  function _skipFirstGeneratorNext(fn) {
    return function() {
      var it = fn.apply(this, arguments);
      it.next();
      return it;
    };
  }

  function _toPrimitive(input, hint) {
    if (typeof input !== 'object' || input === null) return input;
    var prim = input[Symbol.toPrimitive];

    if (prim !== undefined) {
      var res = prim.call(input, hint || 'default');
      if (typeof res !== 'object') return res;
      throw new TypeError('@@toPrimitive must return a primitive value.');
    }

    return (hint === 'string' ? String : Number)(input);
  }

  function _toPropertyKey(arg) {
    var key = _toPrimitive(arg, 'string');

    return typeof key === 'symbol' ? key : String(key);
  }

  function _initializerWarningHelper(descriptor, context) {
    throw new Error(
      'Decorating class property failed. Please ensure that ' +
        'proposal-class-properties is enabled and set to use loose mode. ' +
        'To use proposal-class-properties in spec mode with decorators, wait for ' +
        'the next major version of decorators in stage 2.'
    );
  }

  function _initializerDefineProperty(target, property, descriptor, context) {
    if (!descriptor) return;
    Object.defineProperty(target, property, {
      enumerable: descriptor.enumerable,
      configurable: descriptor.configurable,
      writable: descriptor.writable,
      value: descriptor.initializer
        ? descriptor.initializer.call(context)
        : void 0
    });
  }

  function _applyDecoratedDescriptor(
    target,
    property,
    decorators,
    descriptor,
    context
  ) {
    var desc = {};
    Object.keys(descriptor).forEach(function(key) {
      desc[key] = descriptor[key];
    });
    desc.enumerable = !!desc.enumerable;
    desc.configurable = !!desc.configurable;

    if ('value' in desc || desc.initializer) {
      desc.writable = true;
    }

    desc = decorators
      .slice()
      .reverse()
      .reduce(function(desc, decorator) {
        return decorator(target, property, desc) || desc;
      }, desc);

    if (context && desc.initializer !== void 0) {
      desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
      desc.initializer = undefined;
    }

    if (desc.initializer === void 0) {
      Object.defineProperty(target, property, desc);
      desc = null;
    }

    return desc;
  }

  var id = 0;

  function _classPrivateFieldLooseKey(name) {
    return '__private_' + id++ + '_' + name;
  }

  function _classPrivateFieldLooseBase(receiver, privateKey) {
    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {
      throw new TypeError('attempted to use private field on non-instance');
    }

    return receiver;
  }

  function _classPrivateFieldGet(receiver, privateMap) {
    if (!privateMap.has(receiver)) {
      throw new TypeError('attempted to get private field on non-instance');
    }

    var descriptor = privateMap.get(receiver);

    if (descriptor.get) {
      return descriptor.get.call(receiver);
    }

    return descriptor.value;
  }

  function _classPrivateFieldSet(receiver, privateMap, value) {
    if (!privateMap.has(receiver)) {
      throw new TypeError('attempted to set private field on non-instance');
    }

    var descriptor = privateMap.get(receiver);

    if (descriptor.set) {
      descriptor.set.call(receiver, value);
    } else {
      if (!descriptor.writable) {
        throw new TypeError('attempted to set read only private field');
      }

      descriptor.value = value;
    }

    return value;
  }

  function _classStaticPrivateFieldSpecGet(
    receiver,
    classConstructor,
    descriptor
  ) {
    if (receiver !== classConstructor) {
      throw new TypeError('Private static access of wrong provenance');
    }

    return descriptor.value;
  }

  function _classStaticPrivateFieldSpecSet(
    receiver,
    classConstructor,
    descriptor,
    value
  ) {
    if (receiver !== classConstructor) {
      throw new TypeError('Private static access of wrong provenance');
    }

    if (!descriptor.writable) {
      throw new TypeError('attempted to set read only private field');
    }

    descriptor.value = value;
    return value;
  }

  function _classStaticPrivateMethodGet(receiver, classConstructor, method) {
    if (receiver !== classConstructor) {
      throw new TypeError('Private static access of wrong provenance');
    }

    return method;
  }

  function _classStaticPrivateMethodSet() {
    throw new TypeError('attempted to set read only static private field');
  }

  function _decorate(decorators, factory, superClass, mixins) {
    var api = _getDecoratorsApi();

    if (mixins) {
      for (var i = 0; i < mixins.length; i++) {
        api = mixins[i](api);
      }
    }

    var r = factory(function initialize(O) {
      api.initializeInstanceElements(O, decorated.elements);
    }, superClass);
    var decorated = api.decorateClass(
      _coalesceClassElements(r.d.map(_createElementDescriptor)),
      decorators
    );
    api.initializeClassElements(r.F, decorated.elements);
    return api.runClassFinishers(r.F, decorated.finishers);
  }

  function _getDecoratorsApi() {
    _getDecoratorsApi = function() {
      return api;
    };

    var api = {
      elementsDefinitionOrder: [['method'], ['field']],
      initializeInstanceElements: function(O, elements) {
        ['method', 'field'].forEach(function(kind) {
          elements.forEach(function(element) {
            if (element.kind === kind && element.placement === 'own') {
              this.defineClassElement(O, element);
            }
          }, this);
        }, this);
      },
      initializeClassElements: function(F, elements) {
        var proto = F.prototype;
        ['method', 'field'].forEach(function(kind) {
          elements.forEach(function(element) {
            var placement = element.placement;

            if (
              element.kind === kind &&
              (placement === 'static' || placement === 'prototype')
            ) {
              var receiver = placement === 'static' ? F : proto;
              this.defineClassElement(receiver, element);
            }
          }, this);
        }, this);
      },
      defineClassElement: function(receiver, element) {
        var descriptor = element.descriptor;

        if (element.kind === 'field') {
          var initializer = element.initializer;
          descriptor = {
            enumerable: descriptor.enumerable,
            writable: descriptor.writable,
            configurable: descriptor.configurable,
            value: initializer === void 0 ? void 0 : initializer.call(receiver)
          };
        }

        Object.defineProperty(receiver, element.key, descriptor);
      },
      decorateClass: function(elements, decorators) {
        var newElements = [];
        var finishers = [];
        var placements = {
          static: [],
          prototype: [],
          own: []
        };
        elements.forEach(function(element) {
          this.addElementPlacement(element, placements);
        }, this);
        elements.forEach(function(element) {
          if (!_hasDecorators(element)) return newElements.push(element);
          var elementFinishersExtras = this.decorateElement(
            element,
            placements
          );
          newElements.push(elementFinishersExtras.element);
          newElements.push.apply(newElements, elementFinishersExtras.extras);
          finishers.push.apply(finishers, elementFinishersExtras.finishers);
        }, this);

        if (!decorators) {
          return {
            elements: newElements,
            finishers: finishers
          };
        }

        var result = this.decorateConstructor(newElements, decorators);
        finishers.push.apply(finishers, result.finishers);
        result.finishers = finishers;
        return result;
      },
      addElementPlacement: function(element, placements, silent) {
        var keys = placements[element.placement];

        if (!silent && keys.indexOf(element.key) !== -1) {
          throw new TypeError('Duplicated element (' + element.key + ')');
        }

        keys.push(element.key);
      },
      decorateElement: function(element, placements) {
        var extras = [];
        var finishers = [];

        for (
          var decorators = element.decorators, i = decorators.length - 1;
          i >= 0;
          i--
        ) {
          var keys = placements[element.placement];
          keys.splice(keys.indexOf(element.key), 1);
          var elementObject = this.fromElementDescriptor(element);
          var elementFinisherExtras = this.toElementFinisherExtras(
            (0, decorators[i])(elementObject) || elementObject
          );
          element = elementFinisherExtras.element;
          this.addElementPlacement(element, placements);

          if (elementFinisherExtras.finisher) {
            finishers.push(elementFinisherExtras.finisher);
          }

          var newExtras = elementFinisherExtras.extras;

          if (newExtras) {
            for (var j = 0; j < newExtras.length; j++) {
              this.addElementPlacement(newExtras[j], placements);
            }

            extras.push.apply(extras, newExtras);
          }
        }

        return {
          element: element,
          finishers: finishers,
          extras: extras
        };
      },
      decorateConstructor: function(elements, decorators) {
        var finishers = [];

        for (var i = decorators.length - 1; i >= 0; i--) {
          var obj = this.fromClassDescriptor(elements);
          var elementsAndFinisher = this.toClassDescriptor(
            (0, decorators[i])(obj) || obj
          );

          if (elementsAndFinisher.finisher !== undefined) {
            finishers.push(elementsAndFinisher.finisher);
          }

          if (elementsAndFinisher.elements !== undefined) {
            elements = elementsAndFinisher.elements;

            for (var j = 0; j < elements.length - 1; j++) {
              for (var k = j + 1; k < elements.length; k++) {
                if (
                  elements[j].key === elements[k].key &&
                  elements[j].placement === elements[k].placement
                ) {
                  throw new TypeError(
                    'Duplicated element (' + elements[j].key + ')'
                  );
                }
              }
            }
          }
        }

        return {
          elements: elements,
          finishers: finishers
        };
      },
      fromElementDescriptor: function(element) {
        var obj = {
          kind: element.kind,
          key: element.key,
          placement: element.placement,
          descriptor: element.descriptor
        };
        var desc = {
          value: 'Descriptor',
          configurable: true
        };
        Object.defineProperty(obj, Symbol.toStringTag, desc);
        if (element.kind === 'field') obj.initializer = element.initializer;
        return obj;
      },
      toElementDescriptors: function(elementObjects) {
        if (elementObjects === undefined) return;
        return _toArray(elementObjects).map(function(elementObject) {
          var element = this.toElementDescriptor(elementObject);
          this.disallowProperty(
            elementObject,
            'finisher',
            'An element descriptor'
          );
          this.disallowProperty(
            elementObject,
            'extras',
            'An element descriptor'
          );
          return element;
        }, this);
      },
      toElementDescriptor: function(elementObject) {
        var kind = String(elementObject.kind);

        if (kind !== 'method' && kind !== 'field') {
          throw new TypeError(
            'An element descriptor\'s .kind property must be either "method" or' +
              ' "field", but a decorator created an element descriptor with' +
              ' .kind "' +
              kind +
              '"'
          );
        }

        var key = _toPropertyKey(elementObject.key);

        var placement = String(elementObject.placement);

        if (
          placement !== 'static' &&
          placement !== 'prototype' &&
          placement !== 'own'
        ) {
          throw new TypeError(
            'An element descriptor\'s .placement property must be one of "static",' +
              ' "prototype" or "own", but a decorator created an element descriptor' +
              ' with .placement "' +
              placement +
              '"'
          );
        }

        var descriptor = elementObject.descriptor;
        this.disallowProperty(
          elementObject,
          'elements',
          'An element descriptor'
        );
        var element = {
          kind: kind,
          key: key,
          placement: placement,
          descriptor: Object.assign({}, descriptor)
        };

        if (kind !== 'field') {
          this.disallowProperty(
            elementObject,
            'initializer',
            'A method descriptor'
          );
        } else {
          this.disallowProperty(
            descriptor,
            'get',
            'The property descriptor of a field descriptor'
          );
          this.disallowProperty(
            descriptor,
            'set',
            'The property descriptor of a field descriptor'
          );
          this.disallowProperty(
            descriptor,
            'value',
            'The property descriptor of a field descriptor'
          );
          element.initializer = elementObject.initializer;
        }

        return element;
      },
      toElementFinisherExtras: function(elementObject) {
        var element = this.toElementDescriptor(elementObject);

        var finisher = _optionalCallableProperty(elementObject, 'finisher');

        var extras = this.toElementDescriptors(elementObject.extras);
        return {
          element: element,
          finisher: finisher,
          extras: extras
        };
      },
      fromClassDescriptor: function(elements) {
        var obj = {
          kind: 'class',
          elements: elements.map(this.fromElementDescriptor, this)
        };
        var desc = {
          value: 'Descriptor',
          configurable: true
        };
        Object.defineProperty(obj, Symbol.toStringTag, desc);
        return obj;
      },
      toClassDescriptor: function(obj) {
        var kind = String(obj.kind);

        if (kind !== 'class') {
          throw new TypeError(
            'A class descriptor\'s .kind property must be "class", but a decorator' +
              ' created a class descriptor with .kind "' +
              kind +
              '"'
          );
        }

        this.disallowProperty(obj, 'key', 'A class descriptor');
        this.disallowProperty(obj, 'placement', 'A class descriptor');
        this.disallowProperty(obj, 'descriptor', 'A class descriptor');
        this.disallowProperty(obj, 'initializer', 'A class descriptor');
        this.disallowProperty(obj, 'extras', 'A class descriptor');

        var finisher = _optionalCallableProperty(obj, 'finisher');

        var elements = this.toElementDescriptors(obj.elements);
        return {
          elements: elements,
          finisher: finisher
        };
      },
      runClassFinishers: function(constructor, finishers) {
        for (var i = 0; i < finishers.length; i++) {
          var newConstructor = (0, finishers[i])(constructor);

          if (newConstructor !== undefined) {
            if (typeof newConstructor !== 'function') {
              throw new TypeError('Finishers must return a constructor.');
            }

            constructor = newConstructor;
          }
        }

        return constructor;
      },
      disallowProperty: function(obj, name, objectType) {
        if (obj[name] !== undefined) {
          throw new TypeError(
            objectType + " can't have a ." + name + ' property.'
          );
        }
      }
    };
    return api;
  }

  function _createElementDescriptor(def) {
    var key = _toPropertyKey(def.key);

    var descriptor;

    if (def.kind === 'method') {
      descriptor = {
        value: def.value,
        writable: true,
        configurable: true,
        enumerable: false
      };
    } else if (def.kind === 'get') {
      descriptor = {
        get: def.value,
        configurable: true,
        enumerable: false
      };
    } else if (def.kind === 'set') {
      descriptor = {
        set: def.value,
        configurable: true,
        enumerable: false
      };
    } else if (def.kind === 'field') {
      descriptor = {
        configurable: true,
        writable: true,
        enumerable: true
      };
    }

    var element = {
      kind: def.kind === 'field' ? 'field' : 'method',
      key: key,
      placement: def.static
        ? 'static'
        : def.kind === 'field'
        ? 'own'
        : 'prototype',
      descriptor: descriptor
    };
    if (def.decorators) element.decorators = def.decorators;
    if (def.kind === 'field') element.initializer = def.value;
    return element;
  }

  function _coalesceGetterSetter(element, other) {
    if (element.descriptor.get !== undefined) {
      other.descriptor.get = element.descriptor.get;
    } else {
      other.descriptor.set = element.descriptor.set;
    }
  }

  function _coalesceClassElements(elements) {
    var newElements = [];

    var isSameElement = function(other) {
      return (
        other.kind === 'method' &&
        other.key === element.key &&
        other.placement === element.placement
      );
    };

    for (var i = 0; i < elements.length; i++) {
      var element = elements[i];
      var other;

      if (
        element.kind === 'method' &&
        (other = newElements.find(isSameElement))
      ) {
        if (
          _isDataDescriptor(element.descriptor) ||
          _isDataDescriptor(other.descriptor)
        ) {
          if (_hasDecorators(element) || _hasDecorators(other)) {
            throw new ReferenceError(
              'Duplicated methods (' + element.key + ") can't be decorated."
            );
          }

          other.descriptor = element.descriptor;
        } else {
          if (_hasDecorators(element)) {
            if (_hasDecorators(other)) {
              throw new ReferenceError(
                "Decorators can't be placed on different accessors with for " +
                  'the same property (' +
                  element.key +
                  ').'
              );
            }

            other.decorators = element.decorators;
          }

          _coalesceGetterSetter(element, other);
        }
      } else {
        newElements.push(element);
      }
    }

    return newElements;
  }

  function _hasDecorators(element) {
    return element.decorators && element.decorators.length;
  }

  function _isDataDescriptor(desc) {
    return (
      desc !== undefined &&
      !(desc.value === undefined && desc.writable === undefined)
    );
  }

  function _optionalCallableProperty(obj, name) {
    var value = obj[name];

    if (value !== undefined && typeof value !== 'function') {
      throw new TypeError("Expected '" + name + "' to be a function");
    }

    return value;
  }

  function _classPrivateMethodGet(receiver, privateSet, fn) {
    if (!privateSet.has(receiver)) {
      throw new TypeError('attempted to get private field on non-instance');
    }

    return fn;
  }

  function _classPrivateMethodSet() {
    throw new TypeError('attempted to reassign private method');
  }

  function _wrapRegExp(re, groups) {
    _wrapRegExp = function(re, groups) {
      return new BabelRegExp(re, groups);
    };

    var _RegExp = _wrapNativeSuper(RegExp);

    var _super = RegExp.prototype;

    var _groups = new WeakMap();

    function BabelRegExp(re, groups) {
      var _this = _RegExp.call(this, re);

      _groups.set(_this, groups);

      return _this;
    }

    _inherits(BabelRegExp, _RegExp);

    BabelRegExp.prototype.exec = function(str) {
      var result = _super.exec.call(this, str);

      if (result) result.groups = buildGroups(result, this);
      return result;
    };

    BabelRegExp.prototype[Symbol.replace] = function(str, substitution) {
      if (typeof substitution === 'string') {
        var groups = _groups.get(this);

        return _super[Symbol.replace].call(
          this,
          str,
          substitution.replace(/\$<([^>]+)>/g, function(_, name) {
            return '$' + groups[name];
          })
        );
      } else if (typeof substitution === 'function') {
        var _this = this;

        return _super[Symbol.replace].call(this, str, function() {
          var args = [];
          args.push.apply(args, arguments);

          if (typeof args[args.length - 1] !== 'object') {
            args.push(buildGroups(args, _this));
          }

          return substitution.apply(this, args);
        });
      } else {
        return _super[Symbol.replace].call(this, str, substitution);
      }
    };

    function buildGroups(result, re) {
      var g = _groups.get(re);

      return Object.keys(g).reduce(function(groups, name) {
        groups[name] = result[g[name]];
        return groups;
      }, Object.create(null));
    }

    return _wrapRegExp.apply(this, arguments);
  }

  var vectorMultiply = function vectorMultiply(v, amount) {
    return createVector(v.x * amount, v.y * amount);
  };

  var vectorAdd = function vectorAdd(a, b) {
    return createVector(a.x + b.x, a.y + b.y);
  };

  var vectorNormalize = function vectorNormalize(v) {
    var l = Math.sqrt(v.x * v.x + v.y * v.y);
    if (l === 0) {
      return {
        x: 0,
        y: 0
      };
    }
    return createVector(v.x / l, v.y / l);
  };

  var vectorRotate = function vectorRotate(v, radians, origin) {
    var cos = Math.cos(radians);
    var sin = Math.sin(radians);
    var t = createVector(v.x - origin.x, v.y - origin.y);
    return createVector(
      origin.x + cos * t.x - sin * t.y,
      origin.y + sin * t.x + cos * t.y
    );
  };

  var createVector = function createVector() {
    var x =
      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
    var y =
      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    return { x: x, y: y };
  };

  var getMarkupValue = function getMarkupValue(value, size) {
    var scalar =
      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
    var axis = arguments.length > 3 ? arguments[3] : undefined;
    if (typeof value === 'string') {
      return parseFloat(value) * scalar;
    }
    if (typeof value === 'number') {
      return value * (axis ? size[axis] : Math.min(size.width, size.height));
    }
    return;
  };

  var getMarkupStyles = function getMarkupStyles(markup, size, scale) {
    var lineStyle = markup.borderStyle || markup.lineStyle || 'solid';
    var fill = markup.backgroundColor || markup.fontColor || 'transparent';
    var stroke = markup.borderColor || markup.lineColor || 'transparent';
    var strokeWidth = getMarkupValue(
      markup.borderWidth || markup.lineWidth,
      size,
      scale
    );
    var lineCap = markup.lineCap || 'round';
    var lineJoin = markup.lineJoin || 'round';
    var dashes =
      typeof lineStyle === 'string'
        ? ''
        : lineStyle
            .map(function(v) {
              return getMarkupValue(v, size, scale);
            })
            .join(',');
    var opacity = markup.opacity || 1;
    return {
      'stroke-linecap': lineCap,
      'stroke-linejoin': lineJoin,
      'stroke-width': strokeWidth || 0,
      'stroke-dasharray': dashes,
      stroke: stroke,
      fill: fill,
      opacity: opacity
    };
  };

  var isDefined = function isDefined(value) {
    return value != null;
  };

  var getMarkupRect = function getMarkupRect(rect, size) {
    var scalar =
      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;

    var left =
      getMarkupValue(rect.x, size, scalar, 'width') ||
      getMarkupValue(rect.left, size, scalar, 'width');
    var top =
      getMarkupValue(rect.y, size, scalar, 'height') ||
      getMarkupValue(rect.top, size, scalar, 'height');
    var width = getMarkupValue(rect.width, size, scalar, 'width');
    var height = getMarkupValue(rect.height, size, scalar, 'height');
    var right = getMarkupValue(rect.right, size, scalar, 'width');
    var bottom = getMarkupValue(rect.bottom, size, scalar, 'height');

    if (!isDefined(top)) {
      if (isDefined(height) && isDefined(bottom)) {
        top = size.height - height - bottom;
      } else {
        top = bottom;
      }
    }

    if (!isDefined(left)) {
      if (isDefined(width) && isDefined(right)) {
        left = size.width - width - right;
      } else {
        left = right;
      }
    }

    if (!isDefined(width)) {
      if (isDefined(left) && isDefined(right)) {
        width = size.width - left - right;
      } else {
        width = 0;
      }
    }

    if (!isDefined(height)) {
      if (isDefined(top) && isDefined(bottom)) {
        height = size.height - top - bottom;
      } else {
        height = 0;
      }
    }

    return {
      x: left || 0,
      y: top || 0,
      width: width || 0,
      height: height || 0
    };
  };

  var pointsToPathShape = function pointsToPathShape(points) {
    return points
      .map(function(point, index) {
        return ''
          .concat(index === 0 ? 'M' : 'L', ' ')
          .concat(point.x, ' ')
          .concat(point.y);
      })
      .join(' ');
  };

  var setAttributes = function setAttributes(element, attr) {
    return Object.keys(attr).forEach(function(key) {
      return element.setAttribute(key, attr[key]);
    });
  };

  var ns = 'http://www.w3.org/2000/svg';
  var svg = function svg(tag, attr) {
    var element = document.createElementNS(ns, tag);
    if (attr) {
      setAttributes(element, attr);
    }
    return element;
  };

  var updateRect = function updateRect(element) {
    return setAttributes(
      element,
      Object.assign({}, element.rect, element.styles)
    );
  };

  var updateEllipse = function updateEllipse(element) {
    var cx = element.rect.x + element.rect.width * 0.5;
    var cy = element.rect.y + element.rect.height * 0.5;
    var rx = element.rect.width * 0.5;
    var ry = element.rect.height * 0.5;
    return setAttributes(
      element,
      Object.assign(
        {
          cx: cx,
          cy: cy,
          rx: rx,
          ry: ry
        },
        element.styles
      )
    );
  };

  var IMAGE_FIT_STYLE = {
    contain: 'xMidYMid meet',
    cover: 'xMidYMid slice'
  };

  var updateImage = function updateImage(element, markup) {
    setAttributes(
      element,
      Object.assign({}, element.rect, element.styles, {
        preserveAspectRatio: IMAGE_FIT_STYLE[markup.fit] || 'none'
      })
    );
  };

  var TEXT_ANCHOR = {
    left: 'start',
    center: 'middle',
    right: 'end'
  };

  var updateText = function updateText(element, markup, size, scale) {
    var fontSize = getMarkupValue(markup.fontSize, size, scale);
    var fontFamily = markup.fontFamily || 'sans-serif';
    var fontWeight = markup.fontWeight || 'normal';
    var textAlign = TEXT_ANCHOR[markup.textAlign] || 'start';

    setAttributes(
      element,
      Object.assign({}, element.rect, element.styles, {
        'stroke-width': 0,
        'font-weight': fontWeight,
        'font-size': fontSize,
        'font-family': fontFamily,
        'text-anchor': textAlign
      })
    );

    // update text
    if (element.text !== markup.text) {
      element.text = markup.text;
      element.textContent = markup.text.length ? markup.text : ' ';
    }
  };

  var updateLine = function updateLine(element, markup, size, scale) {
    setAttributes(
      element,
      Object.assign({}, element.rect, element.styles, {
        fill: 'none'
      })
    );

    var line = element.childNodes[0];
    var begin = element.childNodes[1];
    var end = element.childNodes[2];

    var origin = element.rect;

    var target = {
      x: element.rect.x + element.rect.width,
      y: element.rect.y + element.rect.height
    };

    setAttributes(line, {
      x1: origin.x,
      y1: origin.y,
      x2: target.x,
      y2: target.y
    });

    if (!markup.lineDecoration) return;

    begin.style.display = 'none';
    end.style.display = 'none';

    var v = vectorNormalize({
      x: target.x - origin.x,
      y: target.y - origin.y
    });

    var l = getMarkupValue(0.05, size, scale);

    if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {
      var arrowBeginRotationPoint = vectorMultiply(v, l);
      var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);
      var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);
      var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);

      setAttributes(begin, {
        style: 'display:block;',
        d: 'M'
          .concat(arrowBeginA.x, ',')
          .concat(arrowBeginA.y, ' L')
          .concat(origin.x, ',')
          .concat(origin.y, ' L')
          .concat(arrowBeginB.x, ',')
          .concat(arrowBeginB.y)
      });
    }

    if (markup.lineDecoration.indexOf('arrow-end') !== -1) {
      var arrowEndRotationPoint = vectorMultiply(v, -l);
      var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);
      var arrowEndA = vectorRotate(target, 2, arrowEndCenter);
      var arrowEndB = vectorRotate(target, -2, arrowEndCenter);

      setAttributes(end, {
        style: 'display:block;',
        d: 'M'
          .concat(arrowEndA.x, ',')
          .concat(arrowEndA.y, ' L')
          .concat(target.x, ',')
          .concat(target.y, ' L')
          .concat(arrowEndB.x, ',')
          .concat(arrowEndB.y)
      });
    }
  };

  var updatePath = function updatePath(element, markup, size, scale) {
    setAttributes(
      element,
      Object.assign({}, element.styles, {
        fill: 'none',
        d: pointsToPathShape(
          markup.points.map(function(point) {
            return {
              x: getMarkupValue(point.x, size, scale, 'width'),
              y: getMarkupValue(point.y, size, scale, 'height')
            };
          })
        )
      })
    );
  };

  var createShape = function createShape(node) {
    return function(markup) {
      return svg(node, { id: markup.id });
    };
  };

  var createImage = function createImage(markup) {
    var shape = svg('image', {
      id: markup.id,
      'stroke-linecap': 'round',
      'stroke-linejoin': 'round',
      opacity: '0'
    });

    shape.onload = function() {
      shape.setAttribute('opacity', markup.opacity || 1);
    };
    shape.setAttributeNS(
      'http://www.w3.org/1999/xlink',
      'xlink:href',
      markup.src
    );
    return shape;
  };

  var createLine = function createLine(markup) {
    var shape = svg('g', {
      id: markup.id,
      'stroke-linecap': 'round',
      'stroke-linejoin': 'round'
    });

    var line = svg('line');
    shape.appendChild(line);

    var begin = svg('path');
    shape.appendChild(begin);

    var end = svg('path');
    shape.appendChild(end);

    return shape;
  };

  var CREATE_TYPE_ROUTES = {
    image: createImage,
    rect: createShape('rect'),
    ellipse: createShape('ellipse'),
    text: createShape('text'),
    path: createShape('path'),
    line: createLine
  };

  var UPDATE_TYPE_ROUTES = {
    rect: updateRect,
    ellipse: updateEllipse,
    image: updateImage,
    text: updateText,
    path: updatePath,
    line: updateLine
  };

  var createMarkupByType = function createMarkupByType(type, markup) {
    return CREATE_TYPE_ROUTES[type](markup);
  };

  var updateMarkupByType = function updateMarkupByType(
    element,
    type,
    markup,
    size,
    scale
  ) {
    if (type !== 'path') {
      element.rect = getMarkupRect(markup, size, scale);
    }
    element.styles = getMarkupStyles(markup, size, scale);
    UPDATE_TYPE_ROUTES[type](element, markup, size, scale);
  };

  var MARKUP_RECT = [
    'x',
    'y',
    'left',
    'top',
    'right',
    'bottom',
    'width',
    'height'
  ];

  var toOptionalFraction = function toOptionalFraction(value) {
    return typeof value === 'string' && /%/.test(value)
      ? parseFloat(value) / 100
      : value;
  };

  // adds default markup properties, clones markup
  var prepareMarkup = function prepareMarkup(markup) {
    var _markup = _slicedToArray(markup, 2),
      type = _markup[0],
      props = _markup[1];

    var rect = props.points
      ? {}
      : MARKUP_RECT.reduce(function(prev, curr) {
          prev[curr] = toOptionalFraction(props[curr]);
          return prev;
        }, {});

    return [
      type,
      Object.assign(
        {
          zIndex: 0
        },
        props,
        rect
      )
    ];
  };

  var sortMarkupByZIndex = function sortMarkupByZIndex(a, b) {
    if (a[1].zIndex > b[1].zIndex) {
      return 1;
    }
    if (a[1].zIndex < b[1].zIndex) {
      return -1;
    }
    return 0;
  };

  var createMarkupView = function createMarkupView(_) {
    return _.utils.createView({
      name: 'image-preview-markup',
      tag: 'svg',
      ignoreRect: true,
      mixins: {
        apis: ['width', 'height', 'crop', 'markup', 'resize', 'dirty']
      },

      write: function write(_ref) {
        var root = _ref.root,
          props = _ref.props;

        if (!props.dirty) return;
        var crop = props.crop,
          resize = props.resize,
          markup = props.markup;

        var viewWidth = props.width;
        var viewHeight = props.height;

        var cropWidth = crop.width;
        var cropHeight = crop.height;

        if (resize) {
          var _size = resize.size;

          var outputWidth = _size && _size.width;
          var outputHeight = _size && _size.height;
          var outputFit = resize.mode;
          var outputUpscale = resize.upscale;

          if (outputWidth && !outputHeight) outputHeight = outputWidth;
          if (outputHeight && !outputWidth) outputWidth = outputHeight;

          var shouldUpscale =
            cropWidth < outputWidth && cropHeight < outputHeight;

          if (!shouldUpscale || (shouldUpscale && outputUpscale)) {
            var scalarWidth = outputWidth / cropWidth;
            var scalarHeight = outputHeight / cropHeight;

            if (outputFit === 'force') {
              cropWidth = outputWidth;
              cropHeight = outputHeight;
            } else {
              var scalar;
              if (outputFit === 'cover') {
                scalar = Math.max(scalarWidth, scalarHeight);
              } else if (outputFit === 'contain') {
                scalar = Math.min(scalarWidth, scalarHeight);
              }
              cropWidth = cropWidth * scalar;
              cropHeight = cropHeight * scalar;
            }
          }
        }

        var size = {
          width: viewWidth,
          height: viewHeight
        };

        root.element.setAttribute('width', size.width);
        root.element.setAttribute('height', size.height);

        var scale = Math.min(viewWidth / cropWidth, viewHeight / cropHeight);

        // clear
        root.element.innerHTML = '';

        // get filter
        var markupFilter = root.query('GET_IMAGE_PREVIEW_MARKUP_FILTER');

        // draw new
        markup
          .filter(markupFilter)
          .map(prepareMarkup)
          .sort(sortMarkupByZIndex)
          .forEach(function(markup) {
            var _markup = _slicedToArray(markup, 2),
              type = _markup[0],
              settings = _markup[1];

            // create
            var element = createMarkupByType(type, settings);

            // update
            updateMarkupByType(element, type, settings, size, scale);

            // add
            root.element.appendChild(element);
          });
      }
    });
  };

  var createVector$1 = function createVector(x, y) {
    return { x: x, y: y };
  };

  var vectorDot = function vectorDot(a, b) {
    return a.x * b.x + a.y * b.y;
  };

  var vectorSubtract = function vectorSubtract(a, b) {
    return createVector$1(a.x - b.x, a.y - b.y);
  };

  var vectorDistanceSquared = function vectorDistanceSquared(a, b) {
    return vectorDot(vectorSubtract(a, b), vectorSubtract(a, b));
  };

  var vectorDistance = function vectorDistance(a, b) {
    return Math.sqrt(vectorDistanceSquared(a, b));
  };

  var getOffsetPointOnEdge = function getOffsetPointOnEdge(length, rotation) {
    var a = length;

    var A = 1.5707963267948966;
    var B = rotation;
    var C = 1.5707963267948966 - rotation;

    var sinA = Math.sin(A);
    var sinB = Math.sin(B);
    var sinC = Math.sin(C);
    var cosC = Math.cos(C);
    var ratio = a / sinA;
    var b = ratio * sinB;
    var c = ratio * sinC;

    return createVector$1(cosC * b, cosC * c);
  };

  var getRotatedRectSize = function getRotatedRectSize(rect, rotation) {
    var w = rect.width;
    var h = rect.height;

    var hor = getOffsetPointOnEdge(w, rotation);
    var ver = getOffsetPointOnEdge(h, rotation);

    var tl = createVector$1(rect.x + Math.abs(hor.x), rect.y - Math.abs(hor.y));

    var tr = createVector$1(
      rect.x + rect.width + Math.abs(ver.y),
      rect.y + Math.abs(ver.x)
    );

    var bl = createVector$1(
      rect.x - Math.abs(ver.y),
      rect.y + rect.height - Math.abs(ver.x)
    );

    return {
      width: vectorDistance(tl, tr),
      height: vectorDistance(tl, bl)
    };
  };

  var calculateCanvasSize = function calculateCanvasSize(
    image,
    canvasAspectRatio
  ) {
    var zoom =
      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;

    var imageAspectRatio = image.height / image.width;

    // determine actual pixels on x and y axis
    var canvasWidth = 1;
    var canvasHeight = canvasAspectRatio;
    var imgWidth = 1;
    var imgHeight = imageAspectRatio;
    if (imgHeight > canvasHeight) {
      imgHeight = canvasHeight;
      imgWidth = imgHeight / imageAspectRatio;
    }

    var scalar = Math.max(canvasWidth / imgWidth, canvasHeight / imgHeight);
    var width = image.width / (zoom * scalar * imgWidth);
    var height = width * canvasAspectRatio;

    return {
      width: width,
      height: height
    };
  };

  var getImageRectZoomFactor = function getImageRectZoomFactor(
    imageRect,
    cropRect,
    rotation,
    center
  ) {
    // calculate available space round image center position
    var cx = center.x > 0.5 ? 1 - center.x : center.x;
    var cy = center.y > 0.5 ? 1 - center.y : center.y;
    var imageWidth = cx * 2 * imageRect.width;
    var imageHeight = cy * 2 * imageRect.height;

    // calculate rotated crop rectangle size
    var rotatedCropSize = getRotatedRectSize(cropRect, rotation);

    // calculate scalar required to fit image
    return Math.max(
      rotatedCropSize.width / imageWidth,
      rotatedCropSize.height / imageHeight
    );
  };

  var getCenteredCropRect = function getCenteredCropRect(
    container,
    aspectRatio
  ) {
    var width = container.width;
    var height = width * aspectRatio;
    if (height > container.height) {
      height = container.height;
      width = height / aspectRatio;
    }
    var x = (container.width - width) * 0.5;
    var y = (container.height - height) * 0.5;

    return {
      x: x,
      y: y,
      width: width,
      height: height
    };
  };

  var getCurrentCropSize = function getCurrentCropSize(imageSize) {
    var crop =
      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    var zoom = crop.zoom,
      rotation = crop.rotation,
      center = crop.center,
      aspectRatio = crop.aspectRatio;

    if (!aspectRatio) aspectRatio = imageSize.height / imageSize.width;

    var canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);

    var canvasCenter = {
      x: canvasSize.width * 0.5,
      y: canvasSize.height * 0.5
    };

    var stage = {
      x: 0,
      y: 0,
      width: canvasSize.width,
      height: canvasSize.height,
      center: canvasCenter
    };

    var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;

    var stageZoomFactor = getImageRectZoomFactor(
      imageSize,
      getCenteredCropRect(stage, aspectRatio),
      rotation,
      shouldLimit ? center : { x: 0.5, y: 0.5 }
    );

    var scale = zoom * stageZoomFactor;

    // start drawing
    return {
      widthFloat: canvasSize.width / scale,
      heightFloat: canvasSize.height / scale,
      width: Math.round(canvasSize.width / scale),
      height: Math.round(canvasSize.height / scale)
    };
  };

  var IMAGE_SCALE_SPRING_PROPS = {
    type: 'spring',
    stiffness: 0.5,
    damping: 0.45,
    mass: 10
  };

  // does horizontal and vertical flipping
  var createBitmapView = function createBitmapView(_) {
    return _.utils.createView({
      name: 'image-bitmap',
      ignoreRect: true,
      mixins: { styles: ['scaleX', 'scaleY'] },
      create: function create(_ref) {
        var root = _ref.root,
          props = _ref.props;
        root.appendChild(props.image);
      }
    });
  };

  // shifts and rotates image
  var createImageCanvasWrapper = function createImageCanvasWrapper(_) {
    return _.utils.createView({
      name: 'image-canvas-wrapper',
      tag: 'div',
      ignoreRect: true,
      mixins: {
        apis: ['crop', 'width', 'height'],

        styles: [
          'originX',
          'originY',
          'translateX',
          'translateY',
          'scaleX',
          'scaleY',
          'rotateZ'
        ],

        animations: {
          originX: IMAGE_SCALE_SPRING_PROPS,
          originY: IMAGE_SCALE_SPRING_PROPS,
          scaleX: IMAGE_SCALE_SPRING_PROPS,
          scaleY: IMAGE_SCALE_SPRING_PROPS,
          translateX: IMAGE_SCALE_SPRING_PROPS,
          translateY: IMAGE_SCALE_SPRING_PROPS,
          rotateZ: IMAGE_SCALE_SPRING_PROPS
        }
      },

      create: function create(_ref2) {
        var root = _ref2.root,
          props = _ref2.props;
        props.width = props.image.width;
        props.height = props.image.height;
        root.ref.bitmap = root.appendChildView(
          root.createChildView(createBitmapView(_), { image: props.image })
        );
      },
      write: function write(_ref3) {
        var root = _ref3.root,
          props = _ref3.props;
        var flip = props.crop.flip;
        var bitmap = root.ref.bitmap;
        bitmap.scaleX = flip.horizontal ? -1 : 1;
        bitmap.scaleY = flip.vertical ? -1 : 1;
      }
    });
  };

  // clips canvas to correct aspect ratio
  var createClipView = function createClipView(_) {
    return _.utils.createView({
      name: 'image-clip',
      tag: 'div',
      ignoreRect: true,
      mixins: {
        apis: [
          'crop',
          'markup',
          'resize',
          'width',
          'height',
          'dirty',
          'background'
        ],

        styles: ['width', 'height', 'opacity'],
        animations: {
          opacity: { type: 'tween', duration: 250 }
        }
      },

      didWriteView: function didWriteView(_ref4) {
        var root = _ref4.root,
          props = _ref4.props;
        if (!props.background) return;
        root.element.style.backgroundColor = props.background;
      },
      create: function create(_ref5) {
        var root = _ref5.root,
          props = _ref5.props;

        root.ref.image = root.appendChildView(
          root.createChildView(
            createImageCanvasWrapper(_),
            Object.assign({}, props)
          )
        );

        root.ref.createMarkup = function() {
          if (root.ref.markup) return;
          root.ref.markup = root.appendChildView(
            root.createChildView(createMarkupView(_), Object.assign({}, props))
          );
        };

        root.ref.destroyMarkup = function() {
          if (!root.ref.markup) return;
          root.removeChildView(root.ref.markup);
          root.ref.markup = null;
        };

        // set up transparency grid
        var transparencyIndicator = root.query(
          'GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR'
        );
        if (transparencyIndicator === null) return;

        // grid pattern
        if (transparencyIndicator === 'grid') {
          root.element.dataset.transparencyIndicator = transparencyIndicator;
        }
        // basic color
        else {
          root.element.dataset.transparencyIndicator = 'color';
        }
      },
      write: function write(_ref6) {
        var root = _ref6.root,
          props = _ref6.props,
          shouldOptimize = _ref6.shouldOptimize;
        var crop = props.crop,
          markup = props.markup,
          resize = props.resize,
          dirty = props.dirty,
          width = props.width,
          height = props.height;

        root.ref.image.crop = crop;

        var stage = {
          x: 0,
          y: 0,
          width: width,
          height: height,
          center: {
            x: width * 0.5,
            y: height * 0.5
          }
        };

        var image = {
          width: root.ref.image.width,
          height: root.ref.image.height
        };

        var origin = {
          x: crop.center.x * image.width,
          y: crop.center.y * image.height
        };

        var translation = {
          x: stage.center.x - image.width * crop.center.x,
          y: stage.center.y - image.height * crop.center.y
        };

        var rotation = Math.PI * 2 + (crop.rotation % (Math.PI * 2));

        var cropAspectRatio = crop.aspectRatio || image.height / image.width;

        var shouldLimit =
          typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;

        var stageZoomFactor = getImageRectZoomFactor(
          image,
          getCenteredCropRect(stage, cropAspectRatio),

          rotation,
          shouldLimit ? crop.center : { x: 0.5, y: 0.5 }
        );

        var scale = crop.zoom * stageZoomFactor;

        // update markup view
        if (markup && markup.length) {
          root.ref.createMarkup();
          root.ref.markup.width = width;
          root.ref.markup.height = height;
          root.ref.markup.resize = resize;
          root.ref.markup.dirty = dirty;
          root.ref.markup.markup = markup;
          root.ref.markup.crop = getCurrentCropSize(image, crop);
        } else if (root.ref.markup) {
          root.ref.destroyMarkup();
        }

        // update image view
        var imageView = root.ref.image;

        // don't update clip layout
        if (shouldOptimize) {
          imageView.originX = null;
          imageView.originY = null;
          imageView.translateX = null;
          imageView.translateY = null;
          imageView.rotateZ = null;
          imageView.scaleX = null;
          imageView.scaleY = null;
          return;
        }

        imageView.originX = origin.x;
        imageView.originY = origin.y;
        imageView.translateX = translation.x;
        imageView.translateY = translation.y;
        imageView.rotateZ = rotation;
        imageView.scaleX = scale;
        imageView.scaleY = scale;
      }
    });
  };

  var createImageView = function createImageView(_) {
    return _.utils.createView({
      name: 'image-preview',
      tag: 'div',
      ignoreRect: true,
      mixins: {
        apis: ['image', 'crop', 'markup', 'resize', 'dirty', 'background'],

        styles: ['translateY', 'scaleX', 'scaleY', 'opacity'],

        animations: {
          scaleX: IMAGE_SCALE_SPRING_PROPS,
          scaleY: IMAGE_SCALE_SPRING_PROPS,
          translateY: IMAGE_SCALE_SPRING_PROPS,
          opacity: { type: 'tween', duration: 400 }
        }
      },

      create: function create(_ref7) {
        var root = _ref7.root,
          props = _ref7.props;
        root.ref.clip = root.appendChildView(
          root.createChildView(createClipView(_), {
            id: props.id,
            image: props.image,
            crop: props.crop,
            markup: props.markup,
            resize: props.resize,
            dirty: props.dirty,
            background: props.background
          })
        );
      },
      write: function write(_ref8) {
        var root = _ref8.root,
          props = _ref8.props,
          shouldOptimize = _ref8.shouldOptimize;
        var clip = root.ref.clip;
        var image = props.image,
          crop = props.crop,
          markup = props.markup,
          resize = props.resize,
          dirty = props.dirty;

        clip.crop = crop;
        clip.markup = markup;
        clip.resize = resize;
        clip.dirty = dirty;

        // don't update clip layout
        clip.opacity = shouldOptimize ? 0 : 1;

        // don't re-render if optimizing or hidden (width will be zero resulting in weird animations)
        if (shouldOptimize || root.rect.element.hidden) return;

        // calculate scaled preview image size
        var imageAspectRatio = image.height / image.width;
        var aspectRatio = crop.aspectRatio || imageAspectRatio;

        // calculate container size
        var containerWidth = root.rect.inner.width;
        var containerHeight = root.rect.inner.height;

        var fixedPreviewHeight = root.query('GET_IMAGE_PREVIEW_HEIGHT');
        var minPreviewHeight = root.query('GET_IMAGE_PREVIEW_MIN_HEIGHT');
        var maxPreviewHeight = root.query('GET_IMAGE_PREVIEW_MAX_HEIGHT');

        var panelAspectRatio = root.query('GET_PANEL_ASPECT_RATIO');
        var allowMultiple = root.query('GET_ALLOW_MULTIPLE');

        if (panelAspectRatio && !allowMultiple) {
          fixedPreviewHeight = containerWidth * panelAspectRatio;
          aspectRatio = panelAspectRatio;
        }

        // determine clip width and height
        var clipHeight =
          fixedPreviewHeight !== null
            ? fixedPreviewHeight
            : Math.max(
                minPreviewHeight,
                Math.min(containerWidth * aspectRatio, maxPreviewHeight)
              );

        var clipWidth = clipHeight / aspectRatio;
        if (clipWidth > containerWidth) {
          clipWidth = containerWidth;
          clipHeight = clipWidth * aspectRatio;
        }

        if (clipHeight > containerHeight) {
          clipHeight = containerHeight;
          clipWidth = containerHeight / aspectRatio;
        }

        clip.width = clipWidth;
        clip.height = clipHeight;
      }
    });
  };

  var SVG_MASK =
    '<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n    <defs>\n        <radialGradient id="gradient-__UID__" cx=".5" cy="1.25" r="1.15">\n            <stop offset=\'50%\' stop-color=\'#000000\'/>\n            <stop offset=\'56%\' stop-color=\'#0a0a0a\'/>\n            <stop offset=\'63%\' stop-color=\'#262626\'/>\n            <stop offset=\'69%\' stop-color=\'#4f4f4f\'/>\n            <stop offset=\'75%\' stop-color=\'#808080\'/>\n            <stop offset=\'81%\' stop-color=\'#b1b1b1\'/>\n            <stop offset=\'88%\' stop-color=\'#dadada\'/>\n            <stop offset=\'94%\' stop-color=\'#f6f6f6\'/>\n            <stop offset=\'100%\' stop-color=\'#ffffff\'/>\n        </radialGradient>\n        <mask id="mask-__UID__">\n            <rect x="0" y="0" width="500" height="200" fill="url(#gradient-__UID__)"></rect>\n        </mask>\n    </defs>\n    <rect x="0" width="500" height="200" fill="currentColor" mask="url(#mask-__UID__)"></rect>\n</svg>';

  var SVGMaskUniqueId = 0;

  var createImageOverlayView = function createImageOverlayView(fpAPI) {
    return fpAPI.utils.createView({
      name: 'image-preview-overlay',
      tag: 'div',
      ignoreRect: true,
      create: function create(_ref) {
        var root = _ref.root,
          props = _ref.props;
        var mask = SVG_MASK;
        if (document.querySelector('base')) {
          var url = new URL(
            window.location.href.replace(window.location.hash, '')
          ).href;
          mask = mask.replace(/url\(\#/g, 'url(' + url + '#');
        }

        SVGMaskUniqueId++;
        root.element.classList.add(
          'filepond--image-preview-overlay-'.concat(props.status)
        );

        root.element.innerHTML = mask.replace(/__UID__/g, SVGMaskUniqueId);
      },
      mixins: {
        styles: ['opacity'],
        animations: {
          opacity: { type: 'spring', mass: 25 }
        }
      }
    });
  };

  /**
   * Bitmap Worker
   */
  var BitmapWorker = function BitmapWorker() {
    self.onmessage = function(e) {
      createImageBitmap(e.data.message.file).then(function(bitmap) {
        self.postMessage({ id: e.data.id, message: bitmap }, [bitmap]);
      });
    };
  };

  /**
   * ColorMatrix Worker
   */
  var ColorMatrixWorker = function ColorMatrixWorker() {
    self.onmessage = function(e) {
      var imageData = e.data.message.imageData;
      var matrix = e.data.message.colorMatrix;

      var data = imageData.data;
      var l = data.length;

      var m11 = matrix[0];
      var m12 = matrix[1];
      var m13 = matrix[2];
      var m14 = matrix[3];
      var m15 = matrix[4];

      var m21 = matrix[5];
      var m22 = matrix[6];
      var m23 = matrix[7];
      var m24 = matrix[8];
      var m25 = matrix[9];

      var m31 = matrix[10];
      var m32 = matrix[11];
      var m33 = matrix[12];
      var m34 = matrix[13];
      var m35 = matrix[14];

      var m41 = matrix[15];
      var m42 = matrix[16];
      var m43 = matrix[17];
      var m44 = matrix[18];
      var m45 = matrix[19];

      var index = 0,
        r = 0.0,
        g = 0.0,
        b = 0.0,
        a = 0.0;

      for (; index < l; index += 4) {
        r = data[index] / 255;
        g = data[index + 1] / 255;
        b = data[index + 2] / 255;
        a = data[index + 3] / 255;
        data[index] = Math.max(
          0,
          Math.min((r * m11 + g * m12 + b * m13 + a * m14 + m15) * 255, 255)
        );
        data[index + 1] = Math.max(
          0,
          Math.min((r * m21 + g * m22 + b * m23 + a * m24 + m25) * 255, 255)
        );
        data[index + 2] = Math.max(
          0,
          Math.min((r * m31 + g * m32 + b * m33 + a * m34 + m35) * 255, 255)
        );
        data[index + 3] = Math.max(
          0,
          Math.min((r * m41 + g * m42 + b * m43 + a * m44 + m45) * 255, 255)
        );
      }

      self.postMessage({ id: e.data.id, message: imageData }, [
        imageData.data.buffer
      ]);
    };
  };

  var getImageSize = function getImageSize(url, cb) {
    var image = new Image();
    image.onload = function() {
      var width = image.naturalWidth;
      var height = image.naturalHeight;
      image = null;
      cb(width, height);
    };
    image.src = url;
  };

  var transforms = {
    1: function _() {
      return [1, 0, 0, 1, 0, 0];
    },
    2: function _(width) {
      return [-1, 0, 0, 1, width, 0];
    },
    3: function _(width, height) {
      return [-1, 0, 0, -1, width, height];
    },
    4: function _(width, height) {
      return [1, 0, 0, -1, 0, height];
    },
    5: function _() {
      return [0, 1, 1, 0, 0, 0];
    },
    6: function _(width, height) {
      return [0, 1, -1, 0, height, 0];
    },
    7: function _(width, height) {
      return [0, -1, -1, 0, height, width];
    },
    8: function _(width) {
      return [0, -1, 1, 0, 0, width];
    }
  };

  var fixImageOrientation = function fixImageOrientation(
    ctx,
    width,
    height,
    orientation
  ) {
    // no orientation supplied
    if (orientation === -1) {
      return;
    }

    ctx.transform.apply(ctx, transforms[orientation](width, height));
  };

  // draws the preview image to canvas
  var createPreviewImage = function createPreviewImage(
    data,
    width,
    height,
    orientation
  ) {
    // can't draw on half pixels
    width = Math.round(width);
    height = Math.round(height);

    // draw image
    var canvas = document.createElement('canvas');
    canvas.width = width;
    canvas.height = height;
    var ctx = canvas.getContext('2d');

    // if is rotated incorrectly swap width and height
    if (orientation >= 5 && orientation <= 8) {
      var _ref = [height, width];
      width = _ref[0];
      height = _ref[1];
    }

    // correct image orientation
    fixImageOrientation(ctx, width, height, orientation);

    // draw the image
    ctx.drawImage(data, 0, 0, width, height);

    return canvas;
  };

  var isBitmap = function isBitmap(file) {
    return /^image/.test(file.type) && !/svg/.test(file.type);
  };

  var MAX_WIDTH = 10;
  var MAX_HEIGHT = 10;

  var calculateAverageColor = function calculateAverageColor(image) {
    var scalar = Math.min(MAX_WIDTH / image.width, MAX_HEIGHT / image.height);

    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext('2d');
    var width = (canvas.width = Math.ceil(image.width * scalar));
    var height = (canvas.height = Math.ceil(image.height * scalar));
    ctx.drawImage(image, 0, 0, width, height);
    var data = null;
    try {
      data = ctx.getImageData(0, 0, width, height).data;
    } catch (e) {
      return null;
    }
    var l = data.length;

    var r = 0;
    var g = 0;
    var b = 0;
    var i = 0;

    for (; i < l; i += 4) {
      r += data[i] * data[i];
      g += data[i + 1] * data[i + 1];
      b += data[i + 2] * data[i + 2];
    }

    r = averageColor(r, l);
    g = averageColor(g, l);
    b = averageColor(b, l);

    return { r: r, g: g, b: b };
  };

  var averageColor = function averageColor(c, l) {
    return Math.floor(Math.sqrt(c / (l / 4)));
  };

  var cloneCanvas = function cloneCanvas(origin, target) {
    target = target || document.createElement('canvas');
    target.width = origin.width;
    target.height = origin.height;
    var ctx = target.getContext('2d');
    ctx.drawImage(origin, 0, 0);
    return target;
  };

  var cloneImageData = function cloneImageData(imageData) {
    var id;
    try {
      id = new ImageData(imageData.width, imageData.height);
    } catch (e) {
      var canvas = document.createElement('canvas');
      var ctx = canvas.getContext('2d');
      id = ctx.createImageData(imageData.width, imageData.height);
    }
    id.data.set(new Uint8ClampedArray(imageData.data));
    return id;
  };

  var loadImage = function loadImage(url) {
    return new Promise(function(resolve, reject) {
      var img = new Image();
      img.crossOrigin = 'Anonymous';
      img.onload = function() {
        resolve(img);
      };
      img.onerror = function(e) {
        reject(e);
      };
      img.src = url;
    });
  };

  var createImageWrapperView = function createImageWrapperView(_) {
    // create overlay view
    var OverlayView = createImageOverlayView(_);

    var ImageView = createImageView(_);
    var createWorker = _.utils.createWorker;

    var applyFilter = function applyFilter(root, filter, target) {
      return new Promise(function(resolve) {
        // will store image data for future filter updates
        if (!root.ref.imageData) {
          root.ref.imageData = target
            .getContext('2d')
            .getImageData(0, 0, target.width, target.height);
        }

        // get image data reference
        var imageData = cloneImageData(root.ref.imageData);

        if (!filter || filter.length !== 20) {
          target.getContext('2d').putImageData(imageData, 0, 0);
          return resolve();
        }

        var worker = createWorker(ColorMatrixWorker);
        worker.post(
          {
            imageData: imageData,
            colorMatrix: filter
          },

          function(response) {
            // apply filtered colors
            target.getContext('2d').putImageData(response, 0, 0);

            // stop worker
            worker.terminate();

            // done!
            resolve();
          },
          [imageData.data.buffer]
        );
      });
    };

    var removeImageView = function removeImageView(root, imageView) {
      root.removeChildView(imageView);
      imageView.image.width = 1;
      imageView.image.height = 1;
      imageView._destroy();
    };

    // remove an image
    var shiftImage = function shiftImage(_ref) {
      var root = _ref.root;
      var imageView = root.ref.images.shift();
      imageView.opacity = 0;
      imageView.translateY = -15;
      root.ref.imageViewBin.push(imageView);
      return imageView;
    };

    // add new image
    var pushImage = function pushImage(_ref2) {
      var root = _ref2.root,
        props = _ref2.props,
        image = _ref2.image;
      var id = props.id;
      var item = root.query('GET_ITEM', { id: id });
      if (!item) return;

      var crop = item.getMetadata('crop') || {
        center: {
          x: 0.5,
          y: 0.5
        },

        flip: {
          horizontal: false,
          vertical: false
        },

        zoom: 1,
        rotation: 0,
        aspectRatio: null
      };

      var background = root.query(
        'GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR'
      );

      var markup;
      var resize;
      var dirty = false;
      if (root.query('GET_IMAGE_PREVIEW_MARKUP_SHOW')) {
        markup = item.getMetadata('markup') || [];
        resize = item.getMetadata('resize');
        dirty = true;
      }

      // append image presenter
      var imageView = root.appendChildView(
        root.createChildView(ImageView, {
          id: id,
          image: image,
          crop: crop,
          resize: resize,
          markup: markup,
          dirty: dirty,
          background: background,
          opacity: 0,
          scaleX: 1.15,
          scaleY: 1.15,
          translateY: 15
        }),

        root.childViews.length
      );

      root.ref.images.push(imageView);

      // reveal the preview image
      imageView.opacity = 1;
      imageView.scaleX = 1;
      imageView.scaleY = 1;
      imageView.translateY = 0;

      // the preview is now ready to be drawn
      setTimeout(function() {
        root.dispatch('DID_IMAGE_PREVIEW_SHOW', { id: id });
      }, 250);
    };

    var updateImage = function updateImage(_ref3) {
      var root = _ref3.root,
        props = _ref3.props;
      var item = root.query('GET_ITEM', { id: props.id });
      if (!item) return;
      var imageView = root.ref.images[root.ref.images.length - 1];
      imageView.crop = item.getMetadata('crop');
      imageView.background = root.query(
        'GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR'
      );

      if (root.query('GET_IMAGE_PREVIEW_MARKUP_SHOW')) {
        imageView.dirty = true;
        imageView.resize = item.getMetadata('resize');
        imageView.markup = item.getMetadata('markup');
      }
    };

    // replace image preview
    var didUpdateItemMetadata = function didUpdateItemMetadata(_ref4) {
      var root = _ref4.root,
        props = _ref4.props,
        action = _ref4.action;
      // only filter and crop trigger redraw
      if (!/crop|filter|markup|resize/.test(action.change.key)) return;

      // no images to update, exit
      if (!root.ref.images.length) return;

      // no item found, exit
      var item = root.query('GET_ITEM', { id: props.id });
      if (!item) return;

      // for now, update existing image when filtering
      if (/filter/.test(action.change.key)) {
        var imageView = root.ref.images[root.ref.images.length - 1];
        applyFilter(root, action.change.value, imageView.image);
        return;
      }

      if (/crop|markup|resize/.test(action.change.key)) {
        var crop = item.getMetadata('crop');
        var image = root.ref.images[root.ref.images.length - 1];

        // if aspect ratio has changed, we need to create a new image
        if (
          crop &&
          crop.aspectRatio &&
          image.crop &&
          image.crop.aspectRatio &&
          Math.abs(crop.aspectRatio - image.crop.aspectRatio) > 0.00001
        ) {
          var _imageView = shiftImage({ root: root });
          pushImage({
            root: root,
            props: props,
            image: cloneCanvas(_imageView.image)
          });
        }
        // if not, we can update the current image
        else {
          updateImage({ root: root, props: props });
        }
      }
    };

    var canCreateImageBitmap = function canCreateImageBitmap(file) {
      // Firefox versions before 58 will freeze when running createImageBitmap
      // in a Web Worker so we detect those versions and return false for support
      var userAgent = window.navigator.userAgent;
      var isFirefox = userAgent.match(/Firefox\/([0-9]+)\./);
      var firefoxVersion = isFirefox ? parseInt(isFirefox[1]) : null;
      if (firefoxVersion <= 58) return false;

      return 'createImageBitmap' in window && isBitmap(file);
    };

    /**
     * Write handler for when preview container has been created
     */
    var didCreatePreviewContainer = function didCreatePreviewContainer(_ref5) {
      var root = _ref5.root,
        props = _ref5.props;
      var id = props.id;

      // we need to get the file data to determine the eventual image size
      var item = root.query('GET_ITEM', id);
      if (!item) return;

      // get url to file (we'll revoke it later on when done)
      var fileURL = URL.createObjectURL(item.file);

      // determine image size of this item
      getImageSize(fileURL, function(width, height) {
        // we can now scale the panel to the final size
        root.dispatch('DID_IMAGE_PREVIEW_CALCULATE_SIZE', {
          id: id,
          width: width,
          height: height
        });
      });
    };

    var drawPreview = function drawPreview(_ref6) {
      var root = _ref6.root,
        props = _ref6.props;
      var id = props.id;

      // we need to get the file data to determine the eventual image size
      var item = root.query('GET_ITEM', id);
      if (!item) return;

      // get url to file (we'll revoke it later on when done)
      var fileURL = URL.createObjectURL(item.file);

      // fallback
      var loadPreviewFallback = function loadPreviewFallback() {
        // let's scale the image in the main thread :(
        loadImage(fileURL).then(previewImageLoaded);
      };

      // image is now ready
      var previewImageLoaded = function previewImageLoaded(imageData) {
        // the file url is no longer needed
        URL.revokeObjectURL(fileURL);

        // draw the scaled down version here and use that as source so bitmapdata can be closed
        // orientation info
        var exif = item.getMetadata('exif') || {};
        var orientation = exif.orientation || -1;

        // get width and height from action, and swap if orientation is incorrect
        var width = imageData.width,
          height = imageData.height;

        // if no width or height, just return early.
        if (!width || !height) return;

        if (orientation >= 5 && orientation <= 8) {
          var _ref7 = [height, width];
          width = _ref7[0];
          height = _ref7[1];
        }

        // scale canvas based on pixel density
        // we multiply by .75 as that creates smaller but still clear images on screens with high res displays
        var pixelDensityFactor = Math.max(1, window.devicePixelRatio * 0.75);

        // we want as much pixels to work with as possible,
        // this multiplies the minimum image resolution,
        // so when zooming in it doesn't get too blurry
        var zoomFactor = root.query('GET_IMAGE_PREVIEW_ZOOM_FACTOR');

        // imaeg scale factor
        var scaleFactor = zoomFactor * pixelDensityFactor;

        // calculate scaled preview image size
        var previewImageRatio = height / width;

        // calculate image preview height and width
        var previewContainerWidth = root.rect.element.width;
        var previewContainerHeight = root.rect.element.height;

        var imageWidth = previewContainerWidth;
        var imageHeight = imageWidth * previewImageRatio;

        if (previewImageRatio > 1) {
          imageWidth = Math.min(width, previewContainerWidth * scaleFactor);
          imageHeight = imageWidth * previewImageRatio;
        } else {
          imageHeight = Math.min(height, previewContainerHeight * scaleFactor);
          imageWidth = imageHeight / previewImageRatio;
        }

        // transfer to image tag so no canvas memory wasted on iOS
        var previewImage = createPreviewImage(
          imageData,
          imageWidth,
          imageHeight,
          orientation
        );

        // done
        var done = function done() {
          // calculate average image color, disabled for now
          var averageColor = root.query(
            'GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR'
          )
            ? calculateAverageColor(data)
            : null;
          item.setMetadata('color', averageColor, true);

          // data has been transferred to canvas ( if was ImageBitmap )
          if ('close' in imageData) {
            imageData.close();
          }

          // show the overlay
          root.ref.overlayShadow.opacity = 1;

          // create the first image
          pushImage({ root: root, props: props, image: previewImage });
        };

        // apply filter
        var filter = item.getMetadata('filter');
        if (filter) {
          applyFilter(root, filter, previewImage).then(done);
        } else {
          done();
        }
      };

      // if we support scaling using createImageBitmap we use a worker
      if (canCreateImageBitmap(item.file)) {
        // let's scale the image in a worker
        var worker = createWorker(BitmapWorker);

        worker.post(
          {
            file: item.file
          },

          function(imageBitmap) {
            // destroy worker
            worker.terminate();

            // no bitmap returned, must be something wrong,
            // try the oldschool way
            if (!imageBitmap) {
              loadPreviewFallback();
              return;
            }

            // yay we got our bitmap, let's continue showing the preview
            previewImageLoaded(imageBitmap);
          }
        );
      } else {
        // create fallback preview
        loadPreviewFallback();
      }
    };

    /**
     * Write handler for when the preview image is ready to be animated
     */
    var didDrawPreview = function didDrawPreview(_ref8) {
      var root = _ref8.root;
      // get last added image
      var image = root.ref.images[root.ref.images.length - 1];
      image.translateY = 0;
      image.scaleX = 1.0;
      image.scaleY = 1.0;
      image.opacity = 1;
    };

    /**
     * Write handler for when the preview has been loaded
     */
    var restoreOverlay = function restoreOverlay(_ref9) {
      var root = _ref9.root;
      root.ref.overlayShadow.opacity = 1;
      root.ref.overlayError.opacity = 0;
      root.ref.overlaySuccess.opacity = 0;
    };

    var didThrowError = function didThrowError(_ref10) {
      var root = _ref10.root;
      root.ref.overlayShadow.opacity = 0.25;
      root.ref.overlayError.opacity = 1;
    };

    var didCompleteProcessing = function didCompleteProcessing(_ref11) {
      var root = _ref11.root;
      root.ref.overlayShadow.opacity = 0.25;
      root.ref.overlaySuccess.opacity = 1;
    };

    /**
     * Constructor
     */
    var create = function create(_ref12) {
      var root = _ref12.root;
      // image view
      root.ref.images = [];

      // the preview image data (we need this to filter the image)
      root.ref.imageData = null;

      // image bin
      root.ref.imageViewBin = [];

      // image overlays
      root.ref.overlayShadow = root.appendChildView(
        root.createChildView(OverlayView, {
          opacity: 0,
          status: 'idle'
        })
      );

      root.ref.overlaySuccess = root.appendChildView(
        root.createChildView(OverlayView, {
          opacity: 0,
          status: 'success'
        })
      );

      root.ref.overlayError = root.appendChildView(
        root.createChildView(OverlayView, {
          opacity: 0,
          status: 'failure'
        })
      );
    };

    return _.utils.createView({
      name: 'image-preview-wrapper',
      create: create,
      styles: ['height'],
      apis: ['height'],
      destroy: function destroy(_ref13) {
        var root = _ref13.root;
        // we resize the image so memory on iOS 12 is released more quickly (it seems)
        root.ref.images.forEach(function(imageView) {
          imageView.image.width = 1;
          imageView.image.height = 1;
        });
      },
      didWriteView: function didWriteView(_ref14) {
        var root = _ref14.root;
        root.ref.images.forEach(function(imageView) {
          imageView.dirty = false;
        });
      },
      write: _.utils.createRoute(
        {
          // image preview stated
          DID_IMAGE_PREVIEW_DRAW: didDrawPreview,
          DID_IMAGE_PREVIEW_CONTAINER_CREATE: didCreatePreviewContainer,
          DID_FINISH_CALCULATE_PREVIEWSIZE: drawPreview,
          DID_UPDATE_ITEM_METADATA: didUpdateItemMetadata,

          // file states
          DID_THROW_ITEM_LOAD_ERROR: didThrowError,
          DID_THROW_ITEM_PROCESSING_ERROR: didThrowError,
          DID_THROW_ITEM_INVALID: didThrowError,
          DID_COMPLETE_ITEM_PROCESSING: didCompleteProcessing,
          DID_START_ITEM_PROCESSING: restoreOverlay,
          DID_REVERT_ITEM_PROCESSING: restoreOverlay
        },

        function(_ref15) {
          var root = _ref15.root;
          // views on death row
          var viewsToRemove = root.ref.imageViewBin.filter(function(imageView) {
            return imageView.opacity === 0;
          });

          // views to retain
          root.ref.imageViewBin = root.ref.imageViewBin.filter(function(
            imageView
          ) {
            return imageView.opacity > 0;
          });

          // remove these views
          viewsToRemove.forEach(function(imageView) {
            return removeImageView(root, imageView);
          });
          viewsToRemove.length = 0;
        }
      )
    });
  };

  /**
   * Image Preview Plugin
   */
  var plugin = function plugin(fpAPI) {
    var addFilter = fpAPI.addFilter,
      utils = fpAPI.utils;
    var Type = utils.Type,
      createRoute = utils.createRoute,
      isFile = utils.isFile;

    // imagePreviewView
    var imagePreviewView = createImageWrapperView(fpAPI);

    // called for each view that is created right after the 'create' method
    addFilter('CREATE_VIEW', function(viewAPI) {
      // get reference to created view
      var is = viewAPI.is,
        view = viewAPI.view,
        query = viewAPI.query;

      // only hook up to item view and only if is enabled for this cropper
      if (!is('file') || !query('GET_ALLOW_IMAGE_PREVIEW')) return;

      // create the image preview plugin, but only do so if the item is an image
      var didLoadItem = function didLoadItem(_ref) {
        var root = _ref.root,
          props = _ref.props;
        var id = props.id;
        var item = query('GET_ITEM', id);

        // item could theoretically have been removed in the mean time
        if (!item || !isFile(item.file) || item.archived) return;

        // get the file object
        var file = item.file;

        // exit if this is not an image
        if (!isPreviewableImage(file)) return;

        // test if is filtered
        if (!query('GET_IMAGE_PREVIEW_FILTER_ITEM')(item)) return;

        // exit if image size is too high and no createImageBitmap support
        // this would simply bring the browser to its knees and that is not what we want
        var supportsCreateImageBitmap = 'createImageBitmap' in (window || {});
        var maxPreviewFileSize = query('GET_IMAGE_PREVIEW_MAX_FILE_SIZE');
        if (
          !supportsCreateImageBitmap &&
          maxPreviewFileSize &&
          file.size > maxPreviewFileSize
        )
          return;

        // set preview view
        root.ref.imagePreview = view.appendChildView(
          view.createChildView(imagePreviewView, { id: id })
        );

        // update height if is fixed
        var fixedPreviewHeight = root.query('GET_IMAGE_PREVIEW_HEIGHT');
        if (fixedPreviewHeight) {
          root.dispatch('DID_UPDATE_PANEL_HEIGHT', {
            id: item.id,
            height: fixedPreviewHeight
          });
        }

        // now ready
        var queue =
          !supportsCreateImageBitmap &&
          file.size > query('GET_IMAGE_PREVIEW_MAX_INSTANT_PREVIEW_FILE_SIZE');
        root.dispatch('DID_IMAGE_PREVIEW_CONTAINER_CREATE', { id: id }, queue);
      };

      var rescaleItem = function rescaleItem(root, props) {
        if (!root.ref.imagePreview) return;
        var id = props.id;

        // get item
        var item = root.query('GET_ITEM', { id: id });
        if (!item) return;

        // if is fixed height or panel has aspect ratio, exit here, height has already been defined
        var panelAspectRatio = root.query('GET_PANEL_ASPECT_RATIO');
        var itemPanelAspectRatio = root.query('GET_ITEM_PANEL_ASPECT_RATIO');
        var fixedHeight = root.query('GET_IMAGE_PREVIEW_HEIGHT');
        if (panelAspectRatio || itemPanelAspectRatio || fixedHeight) return;

        // no data!
        var _root$ref = root.ref,
          imageWidth = _root$ref.imageWidth,
          imageHeight = _root$ref.imageHeight;
        if (!imageWidth || !imageHeight) return;

        // get height min and max
        var minPreviewHeight = root.query('GET_IMAGE_PREVIEW_MIN_HEIGHT');
        var maxPreviewHeight = root.query('GET_IMAGE_PREVIEW_MAX_HEIGHT');

        // orientation info
        var exif = item.getMetadata('exif') || {};
        var orientation = exif.orientation || -1;

        // get width and height from action, and swap of orientation is incorrect
        if (orientation >= 5 && orientation <= 8) {
          var _ref2 = [imageHeight, imageWidth];
          imageWidth = _ref2[0];
          imageHeight = _ref2[1];
        }

        // scale up width and height when we're dealing with an SVG
        if (!isBitmap(item.file) || root.query('GET_IMAGE_PREVIEW_UPSCALE')) {
          var scalar = 2048 / imageWidth;
          imageWidth *= scalar;
          imageHeight *= scalar;
        }

        // image aspect ratio
        var imageAspectRatio = imageHeight / imageWidth;

        // we need the item to get to the crop size
        var previewAspectRatio =
          (item.getMetadata('crop') || {}).aspectRatio || imageAspectRatio;

        // preview height range
        var previewHeightMax = Math.max(
          minPreviewHeight,
          Math.min(imageHeight, maxPreviewHeight)
        );

        var itemWidth = root.rect.element.width;
        var previewHeight = Math.min(
          itemWidth * previewAspectRatio,
          previewHeightMax
        );

        // request update to panel height
        root.dispatch('DID_UPDATE_PANEL_HEIGHT', {
          id: item.id,
          height: previewHeight
        });
      };

      var didResizeView = function didResizeView(_ref3) {
        var root = _ref3.root;
        // actions in next write operation
        root.ref.shouldRescale = true;
      };

      var didUpdateItemMetadata = function didUpdateItemMetadata(_ref4) {
        var root = _ref4.root,
          action = _ref4.action;
        if (action.change.key !== 'crop') return;

        // actions in next write operation
        root.ref.shouldRescale = true;
      };

      var didCalculatePreviewSize = function didCalculatePreviewSize(_ref5) {
        var root = _ref5.root,
          action = _ref5.action;
        // remember dimensions
        root.ref.imageWidth = action.width;
        root.ref.imageHeight = action.height;

        // actions in next write operation
        root.ref.shouldRescale = true;
        root.ref.shouldDrawPreview = true;

        // as image load could take a while and fire when draw loop is resting we need to give it a kick
        root.dispatch('KICK');
      };

      // start writing
      view.registerWriter(
        createRoute(
          {
            DID_RESIZE_ROOT: didResizeView,
            DID_STOP_RESIZE: didResizeView,
            DID_LOAD_ITEM: didLoadItem,
            DID_IMAGE_PREVIEW_CALCULATE_SIZE: didCalculatePreviewSize,
            DID_UPDATE_ITEM_METADATA: didUpdateItemMetadata
          },

          function(_ref6) {
            var root = _ref6.root,
              props = _ref6.props;
            // no preview view attached
            if (!root.ref.imagePreview) return;

            // don't do anything while hidden
            if (root.rect.element.hidden) return;

            // resize the item panel
            if (root.ref.shouldRescale) {
              rescaleItem(root, props);
              root.ref.shouldRescale = false;
            }

            if (root.ref.shouldDrawPreview) {
              // queue till next frame so we're sure the height has been applied this forces the draw image call inside the wrapper view to use the correct height
              requestAnimationFrame(function() {
                // this requestAnimationFrame nesting is horrible but it fixes an issue with 100hz displays on Chrome
                // https://github.com/pqina/filepond-plugin-image-preview/issues/57
                requestAnimationFrame(function() {
                  root.dispatch('DID_FINISH_CALCULATE_PREVIEWSIZE', {
                    id: props.id
                  });
                });
              });

              root.ref.shouldDrawPreview = false;
            }
          }
        )
      );
    });

    // expose plugin
    return {
      options: {
        // Enable or disable image preview
        allowImagePreview: [true, Type.BOOLEAN],

        // filters file items to determine which are shown as preview
        imagePreviewFilterItem: [
          function() {
            return true;
          },
          Type.FUNCTION
        ],

        // Fixed preview height
        imagePreviewHeight: [null, Type.INT],

        // Min image height
        imagePreviewMinHeight: [44, Type.INT],

        // Max image height
        imagePreviewMaxHeight: [256, Type.INT],

        // Max size of preview file for when createImageBitmap is not supported
        imagePreviewMaxFileSize: [null, Type.INT],

        // The amount of extra pixels added to the image preview to allow comfortable zooming
        imagePreviewZoomFactor: [2, Type.INT],

        // Should we upscale small images to fit the max bounding box of the preview area
        imagePreviewUpscale: [false, Type.BOOLEAN],

        // Max size of preview file that we allow to try to instant preview if createImageBitmap is not supported, else image is queued for loading
        imagePreviewMaxInstantPreviewFileSize: [1000000, Type.INT],

        // Style of the transparancy indicator used behind images
        imagePreviewTransparencyIndicator: [null, Type.STRING],

        // Enables or disables reading average image color
        imagePreviewCalculateAverageImageColor: [false, Type.BOOLEAN],

        // Enables or disables the previewing of markup
        imagePreviewMarkupShow: [true, Type.BOOLEAN],

        // Allows filtering of markup to only show certain shapes
        imagePreviewMarkupFilter: [
          function() {
            return true;
          },
          Type.FUNCTION
        ]
      }
    };
  };

  // fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags
  var isBrowser =
    typeof window !== 'undefined' && typeof window.document !== 'undefined';
  if (isBrowser) {
    document.dispatchEvent(
      new CustomEvent('FilePond:pluginloaded', { detail: plugin })
    );
  }

  return plugin;
});


/***/ }),

/***/ "./node_modules/filepond/dist/filepond.js":
/*!************************************************!*\
  !*** ./node_modules/filepond/dist/filepond.js ***!
  \************************************************/
/***/ (function(__unused_webpack_module, exports) {

/*!
 * FilePond 4.30.4
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

(function(global, factory) {
     true
        ? factory(exports)
        : 0;
})(this, function(exports) {
    'use strict';

    var isNode = function isNode(value) {
        return value instanceof HTMLElement;
    };

    var createStore = function createStore(initialState) {
        var queries = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
        var actions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
        // internal state
        var state = Object.assign({}, initialState);

        // contains all actions for next frame, is clear when actions are requested
        var actionQueue = [];
        var dispatchQueue = [];

        // returns a duplicate of the current state
        var getState = function getState() {
            return Object.assign({}, state);
        };

        // returns a duplicate of the actions array and clears the actions array
        var processActionQueue = function processActionQueue() {
            // create copy of actions queue
            var queue = [].concat(actionQueue);

            // clear actions queue (we don't want no double actions)
            actionQueue.length = 0;

            return queue;
        };

        // processes actions that might block the main UI thread
        var processDispatchQueue = function processDispatchQueue() {
            // create copy of actions queue
            var queue = [].concat(dispatchQueue);

            // clear actions queue (we don't want no double actions)
            dispatchQueue.length = 0;

            // now dispatch these actions
            queue.forEach(function(_ref) {
                var type = _ref.type,
                    data = _ref.data;
                dispatch(type, data);
            });
        };

        // adds a new action, calls its handler and
        var dispatch = function dispatch(type, data, isBlocking) {
            // is blocking action (should never block if document is hidden)
            if (isBlocking && !document.hidden) {
                dispatchQueue.push({ type: type, data: data });
                return;
            }

            // if this action has a handler, handle the action
            if (actionHandlers[type]) {
                actionHandlers[type](data);
            }

            // now add action
            actionQueue.push({
                type: type,
                data: data,
            });
        };

        var query = function query(str) {
            var _queryHandles;
            for (
                var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1;
                _key < _len;
                _key++
            ) {
                args[_key - 1] = arguments[_key];
            }
            return queryHandles[str]
                ? (_queryHandles = queryHandles)[str].apply(_queryHandles, args)
                : null;
        };

        var api = {
            getState: getState,
            processActionQueue: processActionQueue,
            processDispatchQueue: processDispatchQueue,
            dispatch: dispatch,
            query: query,
        };

        var queryHandles = {};
        queries.forEach(function(query) {
            queryHandles = Object.assign({}, query(state), {}, queryHandles);
        });

        var actionHandlers = {};
        actions.forEach(function(action) {
            actionHandlers = Object.assign({}, action(dispatch, query, state), {}, actionHandlers);
        });

        return api;
    };

    var defineProperty = function defineProperty(obj, property, definition) {
        if (typeof definition === 'function') {
            obj[property] = definition;
            return;
        }
        Object.defineProperty(obj, property, Object.assign({}, definition));
    };

    var forin = function forin(obj, cb) {
        for (var key in obj) {
            if (!obj.hasOwnProperty(key)) {
                continue;
            }

            cb(key, obj[key]);
        }
    };

    var createObject = function createObject(definition) {
        var obj = {};
        forin(definition, function(property) {
            defineProperty(obj, property, definition[property]);
        });
        return obj;
    };

    var attr = function attr(node, name) {
        var value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
        if (value === null) {
            return node.getAttribute(name) || node.hasAttribute(name);
        }
        node.setAttribute(name, value);
    };

    var ns = 'http://www.w3.org/2000/svg';
    var svgElements = ['svg', 'path']; // only svg elements used

    var isSVGElement = function isSVGElement(tag) {
        return svgElements.includes(tag);
    };

    var createElement = function createElement(tag, className) {
        var attributes = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
        if (typeof className === 'object') {
            attributes = className;
            className = null;
        }
        var element = isSVGElement(tag)
            ? document.createElementNS(ns, tag)
            : document.createElement(tag);
        if (className) {
            if (isSVGElement(tag)) {
                attr(element, 'class', className);
            } else {
                element.className = className;
            }
        }
        forin(attributes, function(name, value) {
            attr(element, name, value);
        });
        return element;
    };

    var appendChild = function appendChild(parent) {
        return function(child, index) {
            if (typeof index !== 'undefined' && parent.children[index]) {
                parent.insertBefore(child, parent.children[index]);
            } else {
                parent.appendChild(child);
            }
        };
    };

    var appendChildView = function appendChildView(parent, childViews) {
        return function(view, index) {
            if (typeof index !== 'undefined') {
                childViews.splice(index, 0, view);
            } else {
                childViews.push(view);
            }

            return view;
        };
    };

    var removeChildView = function removeChildView(parent, childViews) {
        return function(view) {
            // remove from child views
            childViews.splice(childViews.indexOf(view), 1);

            // remove the element
            if (view.element.parentNode) {
                parent.removeChild(view.element);
            }

            return view;
        };
    };

    var IS_BROWSER = (function() {
        return typeof window !== 'undefined' && typeof window.document !== 'undefined';
    })();
    var isBrowser = function isBrowser() {
        return IS_BROWSER;
    };

    var testElement = isBrowser() ? createElement('svg') : {};
    var getChildCount =
        'children' in testElement
            ? function(el) {
                  return el.children.length;
              }
            : function(el) {
                  return el.childNodes.length;
              };

    var getViewRect = function getViewRect(elementRect, childViews, offset, scale) {
        var left = offset[0] || elementRect.left;
        var top = offset[1] || elementRect.top;
        var right = left + elementRect.width;
        var bottom = top + elementRect.height * (scale[1] || 1);

        var rect = {
            // the rectangle of the element itself
            element: Object.assign({}, elementRect),

            // the rectangle of the element expanded to contain its children, does not include any margins
            inner: {
                left: elementRect.left,
                top: elementRect.top,
                right: elementRect.right,
                bottom: elementRect.bottom,
            },

            // the rectangle of the element expanded to contain its children including own margin and child margins
            // margins will be added after we've recalculated the size
            outer: {
                left: left,
                top: top,
                right: right,
                bottom: bottom,
            },
        };

        // expand rect to fit all child rectangles
        childViews
            .filter(function(childView) {
                return !childView.isRectIgnored();
            })
            .map(function(childView) {
                return childView.rect;
            })
            .forEach(function(childViewRect) {
                expandRect(rect.inner, Object.assign({}, childViewRect.inner));
                expandRect(rect.outer, Object.assign({}, childViewRect.outer));
            });

        // calculate inner width and height
        calculateRectSize(rect.inner);

        // append additional margin (top and left margins are included in top and left automatically)
        rect.outer.bottom += rect.element.marginBottom;
        rect.outer.right += rect.element.marginRight;

        // calculate outer width and height
        calculateRectSize(rect.outer);

        return rect;
    };

    var expandRect = function expandRect(parent, child) {
        // adjust for parent offset
        child.top += parent.top;
        child.right += parent.left;
        child.bottom += parent.top;
        child.left += parent.left;

        if (child.bottom > parent.bottom) {
            parent.bottom = child.bottom;
        }

        if (child.right > parent.right) {
            parent.right = child.right;
        }
    };

    var calculateRectSize = function calculateRectSize(rect) {
        rect.width = rect.right - rect.left;
        rect.height = rect.bottom - rect.top;
    };

    var isNumber = function isNumber(value) {
        return typeof value === 'number';
    };

    /**
     * Determines if position is at destination
     * @param position
     * @param destination
     * @param velocity
     * @param errorMargin
     * @returns {boolean}
     */
    var thereYet = function thereYet(position, destination, velocity) {
        var errorMargin = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0.001;
        return Math.abs(position - destination) < errorMargin && Math.abs(velocity) < errorMargin;
    };

    /**
     * Spring animation
     */
    var spring =
        // default options
        function spring() // method definition
        {
            var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
                _ref$stiffness = _ref.stiffness,
                stiffness = _ref$stiffness === void 0 ? 0.5 : _ref$stiffness,
                _ref$damping = _ref.damping,
                damping = _ref$damping === void 0 ? 0.75 : _ref$damping,
                _ref$mass = _ref.mass,
                mass = _ref$mass === void 0 ? 10 : _ref$mass;
            var target = null;
            var position = null;
            var velocity = 0;
            var resting = false;

            // updates spring state
            var interpolate = function interpolate(ts, skipToEndState) {
                // in rest, don't animate
                if (resting) return;

                // need at least a target or position to do springy things
                if (!(isNumber(target) && isNumber(position))) {
                    resting = true;
                    velocity = 0;
                    return;
                }

                // calculate spring force
                var f = -(position - target) * stiffness;

                // update velocity by adding force based on mass
                velocity += f / mass;

                // update position by adding velocity
                position += velocity;

                // slow down based on amount of damping
                velocity *= damping;

                // we've arrived if we're near target and our velocity is near zero
                if (thereYet(position, target, velocity) || skipToEndState) {
                    position = target;
                    velocity = 0;
                    resting = true;

                    // we done
                    api.onupdate(position);
                    api.oncomplete(position);
                } else {
                    // progress update
                    api.onupdate(position);
                }
            };

            /**
             * Set new target value
             * @param value
             */
            var setTarget = function setTarget(value) {
                // if currently has no position, set target and position to this value
                if (isNumber(value) && !isNumber(position)) {
                    position = value;
                }

                // next target value will not be animated to
                if (target === null) {
                    target = value;
                    position = value;
                }

                // let start moving to target
                target = value;

                // already at target
                if (position === target || typeof target === 'undefined') {
                    // now resting as target is current position, stop moving
                    resting = true;
                    velocity = 0;

                    // done!
                    api.onupdate(position);
                    api.oncomplete(position);

                    return;
                }

                resting = false;
            };

            // need 'api' to call onupdate callback
            var api = createObject({
                interpolate: interpolate,
                target: {
                    set: setTarget,
                    get: function get() {
                        return target;
                    },
                },

                resting: {
                    get: function get() {
                        return resting;
                    },
                },

                onupdate: function onupdate(value) {},
                oncomplete: function oncomplete(value) {},
            });

            return api;
        };

    var easeLinear = function easeLinear(t) {
        return t;
    };
    var easeInOutQuad = function easeInOutQuad(t) {
        return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
    };

    var tween =
        // default values
        function tween() // method definition
        {
            var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
                _ref$duration = _ref.duration,
                duration = _ref$duration === void 0 ? 500 : _ref$duration,
                _ref$easing = _ref.easing,
                easing = _ref$easing === void 0 ? easeInOutQuad : _ref$easing,
                _ref$delay = _ref.delay,
                delay = _ref$delay === void 0 ? 0 : _ref$delay;
            var start = null;
            var t;
            var p;
            var resting = true;
            var reverse = false;
            var target = null;

            var interpolate = function interpolate(ts, skipToEndState) {
                if (resting || target === null) return;

                if (start === null) {
                    start = ts;
                }

                if (ts - start < delay) return;

                t = ts - start - delay;

                if (t >= duration || skipToEndState) {
                    t = 1;
                    p = reverse ? 0 : 1;
                    api.onupdate(p * target);
                    api.oncomplete(p * target);
                    resting = true;
                } else {
                    p = t / duration;
                    api.onupdate((t >= 0 ? easing(reverse ? 1 - p : p) : 0) * target);
                }
            };

            // need 'api' to call onupdate callback
            var api = createObject({
                interpolate: interpolate,
                target: {
                    get: function get() {
                        return reverse ? 0 : target;
                    },
                    set: function set(value) {
                        // is initial value
                        if (target === null) {
                            target = value;
                            api.onupdate(value);
                            api.oncomplete(value);
                            return;
                        }

                        // want to tween to a smaller value and have a current value
                        if (value < target) {
                            target = 1;
                            reverse = true;
                        } else {
                            // not tweening to a smaller value
                            reverse = false;
                            target = value;
                        }

                        // let's go!
                        resting = false;
                        start = null;
                    },
                },

                resting: {
                    get: function get() {
                        return resting;
                    },
                },

                onupdate: function onupdate(value) {},
                oncomplete: function oncomplete(value) {},
            });

            return api;
        };

    var animator = {
        spring: spring,
        tween: tween,
    };

    /*
                       { type: 'spring', stiffness: .5, damping: .75, mass: 10 };
                       { translation: { type: 'spring', ... }, ... }
                       { translation: { x: { type: 'spring', ... } } }
                      */
    var createAnimator = function createAnimator(definition, category, property) {
        // default is single definition
        // we check if transform is set, if so, we check if property is set
        var def =
            definition[category] && typeof definition[category][property] === 'object'
                ? definition[category][property]
                : definition[category] || definition;

        var type = typeof def === 'string' ? def : def.type;
        var props = typeof def === 'object' ? Object.assign({}, def) : {};

        return animator[type] ? animator[type](props) : null;
    };

    var addGetSet = function addGetSet(keys, obj, props) {
        var overwrite = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
        obj = Array.isArray(obj) ? obj : [obj];
        obj.forEach(function(o) {
            keys.forEach(function(key) {
                var name = key;
                var getter = function getter() {
                    return props[key];
                };
                var setter = function setter(value) {
                    return (props[key] = value);
                };

                if (typeof key === 'object') {
                    name = key.key;
                    getter = key.getter || getter;
                    setter = key.setter || setter;
                }

                if (o[name] && !overwrite) {
                    return;
                }

                o[name] = {
                    get: getter,
                    set: setter,
                };
            });
        });
    };

    // add to state,
    // add getters and setters to internal and external api (if not set)
    // setup animators

    var animations = function animations(_ref) {
        var mixinConfig = _ref.mixinConfig,
            viewProps = _ref.viewProps,
            viewInternalAPI = _ref.viewInternalAPI,
            viewExternalAPI = _ref.viewExternalAPI;
        // initial properties
        var initialProps = Object.assign({}, viewProps);

        // list of all active animations
        var animations = [];

        // setup animators
        forin(mixinConfig, function(property, animation) {
            var animator = createAnimator(animation);
            if (!animator) {
                return;
            }

            // when the animator updates, update the view state value
            animator.onupdate = function(value) {
                viewProps[property] = value;
            };

            // set animator target
            animator.target = initialProps[property];

            // when value is set, set the animator target value
            var prop = {
                key: property,
                setter: function setter(value) {
                    // if already at target, we done!
                    if (animator.target === value) {
                        return;
                    }

                    animator.target = value;
                },
                getter: function getter() {
                    return viewProps[property];
                },
            };

            // add getters and setters
            addGetSet([prop], [viewInternalAPI, viewExternalAPI], viewProps, true);

            // add it to the list for easy updating from the _write method
            animations.push(animator);
        });

        // expose internal write api
        return {
            write: function write(ts) {
                var skipToEndState = document.hidden;
                var resting = true;
                animations.forEach(function(animation) {
                    if (!animation.resting) resting = false;
                    animation.interpolate(ts, skipToEndState);
                });
                return resting;
            },
            destroy: function destroy() {},
        };
    };

    var addEvent = function addEvent(element) {
        return function(type, fn) {
            element.addEventListener(type, fn);
        };
    };

    var removeEvent = function removeEvent(element) {
        return function(type, fn) {
            element.removeEventListener(type, fn);
        };
    };

    // mixin
    var listeners = function listeners(_ref) {
        var mixinConfig = _ref.mixinConfig,
            viewProps = _ref.viewProps,
            viewInternalAPI = _ref.viewInternalAPI,
            viewExternalAPI = _ref.viewExternalAPI,
            viewState = _ref.viewState,
            view = _ref.view;
        var events = [];

        var add = addEvent(view.element);
        var remove = removeEvent(view.element);

        viewExternalAPI.on = function(type, fn) {
            events.push({
                type: type,
                fn: fn,
            });

            add(type, fn);
        };

        viewExternalAPI.off = function(type, fn) {
            events.splice(
                events.findIndex(function(event) {
                    return event.type === type && event.fn === fn;
                }),
                1
            );

            remove(type, fn);
        };

        return {
            write: function write() {
                // not busy
                return true;
            },
            destroy: function destroy() {
                events.forEach(function(event) {
                    remove(event.type, event.fn);
                });
            },
        };
    };

    // add to external api and link to props

    var apis = function apis(_ref) {
        var mixinConfig = _ref.mixinConfig,
            viewProps = _ref.viewProps,
            viewExternalAPI = _ref.viewExternalAPI;
        addGetSet(mixinConfig, viewExternalAPI, viewProps);
    };

    var isDefined = function isDefined(value) {
        return value != null;
    };

    // add to state,
    // add getters and setters to internal and external api (if not set)
    // set initial state based on props in viewProps
    // apply as transforms each frame

    var defaults = {
        opacity: 1,
        scaleX: 1,
        scaleY: 1,
        translateX: 0,
        translateY: 0,
        rotateX: 0,
        rotateY: 0,
        rotateZ: 0,
        originX: 0,
        originY: 0,
    };

    var styles = function styles(_ref) {
        var mixinConfig = _ref.mixinConfig,
            viewProps = _ref.viewProps,
            viewInternalAPI = _ref.viewInternalAPI,
            viewExternalAPI = _ref.viewExternalAPI,
            view = _ref.view;
        // initial props
        var initialProps = Object.assign({}, viewProps);

        // current props
        var currentProps = {};

        // we will add those properties to the external API and link them to the viewState
        addGetSet(mixinConfig, [viewInternalAPI, viewExternalAPI], viewProps);

        // override rect on internal and external rect getter so it takes in account transforms
        var getOffset = function getOffset() {
            return [viewProps['translateX'] || 0, viewProps['translateY'] || 0];
        };

        var getScale = function getScale() {
            return [viewProps['scaleX'] || 0, viewProps['scaleY'] || 0];
        };
        var getRect = function getRect() {
            return view.rect
                ? getViewRect(view.rect, view.childViews, getOffset(), getScale())
                : null;
        };
        viewInternalAPI.rect = { get: getRect };
        viewExternalAPI.rect = { get: getRect };

        // apply view props
        mixinConfig.forEach(function(key) {
            viewProps[key] =
                typeof initialProps[key] === 'undefined' ? defaults[key] : initialProps[key];
        });

        // expose api
        return {
            write: function write() {
                // see if props have changed
                if (!propsHaveChanged(currentProps, viewProps)) {
                    return;
                }

                // moves element to correct position on screen
                applyStyles(view.element, viewProps);

                // store new transforms
                Object.assign(currentProps, Object.assign({}, viewProps));

                // no longer busy
                return true;
            },
            destroy: function destroy() {},
        };
    };

    var propsHaveChanged = function propsHaveChanged(currentProps, newProps) {
        // different amount of keys
        if (Object.keys(currentProps).length !== Object.keys(newProps).length) {
            return true;
        }

        // lets analyze the individual props
        for (var prop in newProps) {
            if (newProps[prop] !== currentProps[prop]) {
                return true;
            }
        }

        return false;
    };

    var applyStyles = function applyStyles(element, _ref2) {
        var opacity = _ref2.opacity,
            perspective = _ref2.perspective,
            translateX = _ref2.translateX,
            translateY = _ref2.translateY,
            scaleX = _ref2.scaleX,
            scaleY = _ref2.scaleY,
            rotateX = _ref2.rotateX,
            rotateY = _ref2.rotateY,
            rotateZ = _ref2.rotateZ,
            originX = _ref2.originX,
            originY = _ref2.originY,
            width = _ref2.width,
            height = _ref2.height;

        var transforms = '';
        var styles = '';

        // handle transform origin
        if (isDefined(originX) || isDefined(originY)) {
            styles += 'transform-origin: ' + (originX || 0) + 'px ' + (originY || 0) + 'px;';
        }

        // transform order is relevant
        // 0. perspective
        if (isDefined(perspective)) {
            transforms += 'perspective(' + perspective + 'px) ';
        }

        // 1. translate
        if (isDefined(translateX) || isDefined(translateY)) {
            transforms +=
                'translate3d(' + (translateX || 0) + 'px, ' + (translateY || 0) + 'px, 0) ';
        }

        // 2. scale
        if (isDefined(scaleX) || isDefined(scaleY)) {
            transforms +=
                'scale3d(' +
                (isDefined(scaleX) ? scaleX : 1) +
                ', ' +
                (isDefined(scaleY) ? scaleY : 1) +
                ', 1) ';
        }

        // 3. rotate
        if (isDefined(rotateZ)) {
            transforms += 'rotateZ(' + rotateZ + 'rad) ';
        }

        if (isDefined(rotateX)) {
            transforms += 'rotateX(' + rotateX + 'rad) ';
        }

        if (isDefined(rotateY)) {
            transforms += 'rotateY(' + rotateY + 'rad) ';
        }

        // add transforms
        if (transforms.length) {
            styles += 'transform:' + transforms + ';';
        }

        // add opacity
        if (isDefined(opacity)) {
            styles += 'opacity:' + opacity + ';';

            // if we reach zero, we make the element inaccessible
            if (opacity === 0) {
                styles += 'visibility:hidden;';
            }

            // if we're below 100% opacity this element can't be clicked
            if (opacity < 1) {
                styles += 'pointer-events:none;';
            }
        }

        // add height
        if (isDefined(height)) {
            styles += 'height:' + height + 'px;';
        }

        // add width
        if (isDefined(width)) {
            styles += 'width:' + width + 'px;';
        }

        // apply styles
        var elementCurrentStyle = element.elementCurrentStyle || '';

        // if new styles does not match current styles, lets update!
        if (styles.length !== elementCurrentStyle.length || styles !== elementCurrentStyle) {
            element.style.cssText = styles;
            // store current styles so we can compare them to new styles later on
            // _not_ getting the style value is faster
            element.elementCurrentStyle = styles;
        }
    };

    var Mixins = {
        styles: styles,
        listeners: listeners,
        animations: animations,
        apis: apis,
    };

    var updateRect = function updateRect() {
        var rect = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
        var element = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        var style = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

        if (!element.layoutCalculated) {
            rect.paddingTop = parseInt(style.paddingTop, 10) || 0;
            rect.marginTop = parseInt(style.marginTop, 10) || 0;
            rect.marginRight = parseInt(style.marginRight, 10) || 0;
            rect.marginBottom = parseInt(style.marginBottom, 10) || 0;
            rect.marginLeft = parseInt(style.marginLeft, 10) || 0;
            element.layoutCalculated = true;
        }

        rect.left = element.offsetLeft || 0;
        rect.top = element.offsetTop || 0;
        rect.width = element.offsetWidth || 0;
        rect.height = element.offsetHeight || 0;

        rect.right = rect.left + rect.width;
        rect.bottom = rect.top + rect.height;

        rect.scrollTop = element.scrollTop;

        rect.hidden = element.offsetParent === null;

        return rect;
    };

    var createView =
        // default view definition
        function createView() {
            var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
                _ref$tag = _ref.tag,
                tag = _ref$tag === void 0 ? 'div' : _ref$tag,
                _ref$name = _ref.name,
                name = _ref$name === void 0 ? null : _ref$name,
                _ref$attributes = _ref.attributes,
                attributes = _ref$attributes === void 0 ? {} : _ref$attributes,
                _ref$read = _ref.read,
                read = _ref$read === void 0 ? function() {} : _ref$read,
                _ref$write = _ref.write,
                write = _ref$write === void 0 ? function() {} : _ref$write,
                _ref$create = _ref.create,
                create = _ref$create === void 0 ? function() {} : _ref$create,
                _ref$destroy = _ref.destroy,
                destroy = _ref$destroy === void 0 ? function() {} : _ref$destroy,
                _ref$filterFrameActio = _ref.filterFrameActionsForChild,
                filterFrameActionsForChild =
                    _ref$filterFrameActio === void 0
                        ? function(child, actions) {
                              return actions;
                          }
                        : _ref$filterFrameActio,
                _ref$didCreateView = _ref.didCreateView,
                didCreateView = _ref$didCreateView === void 0 ? function() {} : _ref$didCreateView,
                _ref$didWriteView = _ref.didWriteView,
                didWriteView = _ref$didWriteView === void 0 ? function() {} : _ref$didWriteView,
                _ref$ignoreRect = _ref.ignoreRect,
                ignoreRect = _ref$ignoreRect === void 0 ? false : _ref$ignoreRect,
                _ref$ignoreRectUpdate = _ref.ignoreRectUpdate,
                ignoreRectUpdate = _ref$ignoreRectUpdate === void 0 ? false : _ref$ignoreRectUpdate,
                _ref$mixins = _ref.mixins,
                mixins = _ref$mixins === void 0 ? [] : _ref$mixins;
            return function(
                // each view requires reference to store
                store
            ) {
                var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
                // root element should not be changed
                var element = createElement(tag, 'filepond--' + name, attributes);

                // style reference should also not be changed
                var style = window.getComputedStyle(element, null);

                // element rectangle
                var rect = updateRect();
                var frameRect = null;

                // rest state
                var isResting = false;

                // pretty self explanatory
                var childViews = [];

                // loaded mixins
                var activeMixins = [];

                // references to created children
                var ref = {};

                // state used for each instance
                var state = {};

                // list of writers that will be called to update this view
                var writers = [
                    write, // default writer
                ];

                var readers = [
                    read, // default reader
                ];

                var destroyers = [
                    destroy, // default destroy
                ];

                // core view methods
                var getElement = function getElement() {
                    return element;
                };
                var getChildViews = function getChildViews() {
                    return childViews.concat();
                };
                var getReference = function getReference() {
                    return ref;
                };
                var createChildView = function createChildView(store) {
                    return function(view, props) {
                        return view(store, props);
                    };
                };
                var getRect = function getRect() {
                    if (frameRect) {
                        return frameRect;
                    }
                    frameRect = getViewRect(rect, childViews, [0, 0], [1, 1]);
                    return frameRect;
                };
                var getStyle = function getStyle() {
                    return style;
                };

                /**
                 * Read data from DOM
                 * @private
                 */
                var _read = function _read() {
                    frameRect = null;

                    // read child views
                    childViews.forEach(function(child) {
                        return child._read();
                    });

                    var shouldUpdate = !(ignoreRectUpdate && rect.width && rect.height);
                    if (shouldUpdate) {
                        updateRect(rect, element, style);
                    }

                    // readers
                    var api = { root: internalAPI, props: props, rect: rect };
                    readers.forEach(function(reader) {
                        return reader(api);
                    });
                };

                /**
                 * Write data to DOM
                 * @private
                 */
                var _write = function _write(ts, frameActions, shouldOptimize) {
                    // if no actions, we assume that the view is resting
                    var resting = frameActions.length === 0;

                    // writers
                    writers.forEach(function(writer) {
                        var writerResting = writer({
                            props: props,
                            root: internalAPI,
                            actions: frameActions,
                            timestamp: ts,
                            shouldOptimize: shouldOptimize,
                        });

                        if (writerResting === false) {
                            resting = false;
                        }
                    });

                    // run mixins
                    activeMixins.forEach(function(mixin) {
                        // if one of the mixins is still busy after write operation, we are not resting
                        var mixinResting = mixin.write(ts);
                        if (mixinResting === false) {
                            resting = false;
                        }
                    });

                    // updates child views that are currently attached to the DOM
                    childViews
                        .filter(function(child) {
                            return !!child.element.parentNode;
                        })
                        .forEach(function(child) {
                            // if a child view is not resting, we are not resting
                            var childResting = child._write(
                                ts,
                                filterFrameActionsForChild(child, frameActions),
                                shouldOptimize
                            );

                            if (!childResting) {
                                resting = false;
                            }
                        });

                    // append new elements to DOM and update those
                    childViews
                        //.filter(child => !child.element.parentNode)
                        .forEach(function(child, index) {
                            // skip
                            if (child.element.parentNode) {
                                return;
                            }

                            // append to DOM
                            internalAPI.appendChild(child.element, index);

                            // call read (need to know the size of these elements)
                            child._read();

                            // re-call write
                            child._write(
                                ts,
                                filterFrameActionsForChild(child, frameActions),
                                shouldOptimize
                            );

                            // we just added somthing to the dom, no rest
                            resting = false;
                        });

                    // update resting state
                    isResting = resting;

                    didWriteView({
                        props: props,
                        root: internalAPI,
                        actions: frameActions,
                        timestamp: ts,
                    });

                    // let parent know if we are resting
                    return resting;
                };

                var _destroy = function _destroy() {
                    activeMixins.forEach(function(mixin) {
                        return mixin.destroy();
                    });
                    destroyers.forEach(function(destroyer) {
                        destroyer({ root: internalAPI, props: props });
                    });
                    childViews.forEach(function(child) {
                        return child._destroy();
                    });
                };

                // sharedAPI
                var sharedAPIDefinition = {
                    element: {
                        get: getElement,
                    },

                    style: {
                        get: getStyle,
                    },

                    childViews: {
                        get: getChildViews,
                    },
                };

                // private API definition
                var internalAPIDefinition = Object.assign({}, sharedAPIDefinition, {
                    rect: {
                        get: getRect,
                    },

                    // access to custom children references
                    ref: {
                        get: getReference,
                    },

                    // dom modifiers
                    is: function is(needle) {
                        return name === needle;
                    },
                    appendChild: appendChild(element),
                    createChildView: createChildView(store),
                    linkView: function linkView(view) {
                        childViews.push(view);
                        return view;
                    },
                    unlinkView: function unlinkView(view) {
                        childViews.splice(childViews.indexOf(view), 1);
                    },
                    appendChildView: appendChildView(element, childViews),
                    removeChildView: removeChildView(element, childViews),
                    registerWriter: function registerWriter(writer) {
                        return writers.push(writer);
                    },
                    registerReader: function registerReader(reader) {
                        return readers.push(reader);
                    },
                    registerDestroyer: function registerDestroyer(destroyer) {
                        return destroyers.push(destroyer);
                    },
                    invalidateLayout: function invalidateLayout() {
                        return (element.layoutCalculated = false);
                    },

                    // access to data store
                    dispatch: store.dispatch,
                    query: store.query,
                });

                // public view API methods
                var externalAPIDefinition = {
                    element: {
                        get: getElement,
                    },

                    childViews: {
                        get: getChildViews,
                    },

                    rect: {
                        get: getRect,
                    },

                    resting: {
                        get: function get() {
                            return isResting;
                        },
                    },

                    isRectIgnored: function isRectIgnored() {
                        return ignoreRect;
                    },
                    _read: _read,
                    _write: _write,
                    _destroy: _destroy,
                };

                // mixin API methods
                var mixinAPIDefinition = Object.assign({}, sharedAPIDefinition, {
                    rect: {
                        get: function get() {
                            return rect;
                        },
                    },
                });

                // add mixin functionality
                Object.keys(mixins)
                    .sort(function(a, b) {
                        // move styles to the back of the mixin list (so adjustments of other mixins are applied to the props correctly)
                        if (a === 'styles') {
                            return 1;
                        } else if (b === 'styles') {
                            return -1;
                        }
                        return 0;
                    })
                    .forEach(function(key) {
                        var mixinAPI = Mixins[key]({
                            mixinConfig: mixins[key],
                            viewProps: props,
                            viewState: state,
                            viewInternalAPI: internalAPIDefinition,
                            viewExternalAPI: externalAPIDefinition,
                            view: createObject(mixinAPIDefinition),
                        });

                        if (mixinAPI) {
                            activeMixins.push(mixinAPI);
                        }
                    });

                // construct private api
                var internalAPI = createObject(internalAPIDefinition);

                // create the view
                create({
                    root: internalAPI,
                    props: props,
                });

                // append created child views to root node
                var childCount = getChildCount(element); // need to know the current child count so appending happens in correct order
                childViews.forEach(function(child, index) {
                    internalAPI.appendChild(child.element, childCount + index);
                });

                // call did create
                didCreateView(internalAPI);

                // expose public api
                return createObject(externalAPIDefinition);
            };
        };

    var createPainter = function createPainter(read, write) {
        var fps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 60;

        var name = '__framePainter';

        // set global painter
        if (window[name]) {
            window[name].readers.push(read);
            window[name].writers.push(write);
            return;
        }

        window[name] = {
            readers: [read],
            writers: [write],
        };

        var painter = window[name];

        var interval = 1000 / fps;
        var last = null;
        var id = null;
        var requestTick = null;
        var cancelTick = null;

        var setTimerType = function setTimerType() {
            if (document.hidden) {
                requestTick = function requestTick() {
                    return window.setTimeout(function() {
                        return tick(performance.now());
                    }, interval);
                };
                cancelTick = function cancelTick() {
                    return window.clearTimeout(id);
                };
            } else {
                requestTick = function requestTick() {
                    return window.requestAnimationFrame(tick);
                };
                cancelTick = function cancelTick() {
                    return window.cancelAnimationFrame(id);
                };
            }
        };

        document.addEventListener('visibilitychange', function() {
            if (cancelTick) cancelTick();
            setTimerType();
            tick(performance.now());
        });

        var tick = function tick(ts) {
            // queue next tick
            id = requestTick(tick);

            // limit fps
            if (!last) {
                last = ts;
            }

            var delta = ts - last;

            if (delta <= interval) {
                // skip frame
                return;
            }

            // align next frame
            last = ts - (delta % interval);

            // update view
            painter.readers.forEach(function(read) {
                return read();
            });
            painter.writers.forEach(function(write) {
                return write(ts);
            });
        };

        setTimerType();
        tick(performance.now());

        return {
            pause: function pause() {
                cancelTick(id);
            },
        };
    };

    var createRoute = function createRoute(routes, fn) {
        return function(_ref) {
            var root = _ref.root,
                props = _ref.props,
                _ref$actions = _ref.actions,
                actions = _ref$actions === void 0 ? [] : _ref$actions,
                timestamp = _ref.timestamp,
                shouldOptimize = _ref.shouldOptimize;
            actions
                .filter(function(action) {
                    return routes[action.type];
                })
                .forEach(function(action) {
                    return routes[action.type]({
                        root: root,
                        props: props,
                        action: action.data,
                        timestamp: timestamp,
                        shouldOptimize: shouldOptimize,
                    });
                });

            if (fn) {
                fn({
                    root: root,
                    props: props,
                    actions: actions,
                    timestamp: timestamp,
                    shouldOptimize: shouldOptimize,
                });
            }
        };
    };

    var insertBefore = function insertBefore(newNode, referenceNode) {
        return referenceNode.parentNode.insertBefore(newNode, referenceNode);
    };

    var insertAfter = function insertAfter(newNode, referenceNode) {
        return referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
    };

    var isArray = function isArray(value) {
        return Array.isArray(value);
    };

    var isEmpty = function isEmpty(value) {
        return value == null;
    };

    var trim = function trim(str) {
        return str.trim();
    };

    var toString = function toString(value) {
        return '' + value;
    };

    var toArray = function toArray(value) {
        var splitter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ',';
        if (isEmpty(value)) {
            return [];
        }
        if (isArray(value)) {
            return value;
        }
        return toString(value)
            .split(splitter)
            .map(trim)
            .filter(function(str) {
                return str.length;
            });
    };

    var isBoolean = function isBoolean(value) {
        return typeof value === 'boolean';
    };

    var toBoolean = function toBoolean(value) {
        return isBoolean(value) ? value : value === 'true';
    };

    var isString = function isString(value) {
        return typeof value === 'string';
    };

    var toNumber = function toNumber(value) {
        return isNumber(value)
            ? value
            : isString(value)
            ? toString(value).replace(/[a-z]+/gi, '')
            : 0;
    };

    var toInt = function toInt(value) {
        return parseInt(toNumber(value), 10);
    };

    var toFloat = function toFloat(value) {
        return parseFloat(toNumber(value));
    };

    var isInt = function isInt(value) {
        return isNumber(value) && isFinite(value) && Math.floor(value) === value;
    };

    var toBytes = function toBytes(value) {
        var base = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1000;
        // is in bytes
        if (isInt(value)) {
            return value;
        }

        // is natural file size
        var naturalFileSize = toString(value).trim();

        // if is value in megabytes
        if (/MB$/i.test(naturalFileSize)) {
            naturalFileSize = naturalFileSize.replace(/MB$i/, '').trim();
            return toInt(naturalFileSize) * base * base;
        }

        // if is value in kilobytes
        if (/KB/i.test(naturalFileSize)) {
            naturalFileSize = naturalFileSize.replace(/KB$i/, '').trim();
            return toInt(naturalFileSize) * base;
        }

        return toInt(naturalFileSize);
    };

    var isFunction = function isFunction(value) {
        return typeof value === 'function';
    };

    var toFunctionReference = function toFunctionReference(string) {
        var ref = self;
        var levels = string.split('.');
        var level = null;
        while ((level = levels.shift())) {
            ref = ref[level];
            if (!ref) {
                return null;
            }
        }
        return ref;
    };

    var methods = {
        process: 'POST',
        patch: 'PATCH',
        revert: 'DELETE',
        fetch: 'GET',
        restore: 'GET',
        load: 'GET',
    };

    var createServerAPI = function createServerAPI(outline) {
        var api = {};

        api.url = isString(outline) ? outline : outline.url || '';
        api.timeout = outline.timeout ? parseInt(outline.timeout, 10) : 0;
        api.headers = outline.headers ? outline.headers : {};

        forin(methods, function(key) {
            api[key] = createAction(key, outline[key], methods[key], api.timeout, api.headers);
        });

        // remove process if no url or process on outline
        api.process = outline.process || isString(outline) || outline.url ? api.process : null;

        // special treatment for remove
        api.remove = outline.remove || null;

        // remove generic headers from api object
        delete api.headers;

        return api;
    };

    var createAction = function createAction(name, outline, method, timeout, headers) {
        // is explicitely set to null so disable
        if (outline === null) {
            return null;
        }

        // if is custom function, done! Dev handles everything.
        if (typeof outline === 'function') {
            return outline;
        }

        // build action object
        var action = {
            url: method === 'GET' || method === 'PATCH' ? '?' + name + '=' : '',
            method: method,
            headers: headers,
            withCredentials: false,
            timeout: timeout,
            onload: null,
            ondata: null,
            onerror: null,
        };

        // is a single url
        if (isString(outline)) {
            action.url = outline;
            return action;
        }

        // overwrite
        Object.assign(action, outline);

        // see if should reformat headers;
        if (isString(action.headers)) {
            var parts = action.headers.split(/:(.+)/);
            action.headers = {
                header: parts[0],
                value: parts[1],
            };
        }

        // if is bool withCredentials
        action.withCredentials = toBoolean(action.withCredentials);

        return action;
    };

    var toServerAPI = function toServerAPI(value) {
        return createServerAPI(value);
    };

    var isNull = function isNull(value) {
        return value === null;
    };

    var isObject = function isObject(value) {
        return typeof value === 'object' && value !== null;
    };

    var isAPI = function isAPI(value) {
        return (
            isObject(value) &&
            isString(value.url) &&
            isObject(value.process) &&
            isObject(value.revert) &&
            isObject(value.restore) &&
            isObject(value.fetch)
        );
    };

    var getType = function getType(value) {
        if (isArray(value)) {
            return 'array';
        }

        if (isNull(value)) {
            return 'null';
        }

        if (isInt(value)) {
            return 'int';
        }

        if (/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(value)) {
            return 'bytes';
        }

        if (isAPI(value)) {
            return 'api';
        }

        return typeof value;
    };

    var replaceSingleQuotes = function replaceSingleQuotes(str) {
        return str
            .replace(/{\s*'/g, '{"')
            .replace(/'\s*}/g, '"}')
            .replace(/'\s*:/g, '":')
            .replace(/:\s*'/g, ':"')
            .replace(/,\s*'/g, ',"')
            .replace(/'\s*,/g, '",');
    };

    var conversionTable = {
        array: toArray,
        boolean: toBoolean,
        int: function int(value) {
            return getType(value) === 'bytes' ? toBytes(value) : toInt(value);
        },
        number: toFloat,
        float: toFloat,
        bytes: toBytes,
        string: function string(value) {
            return isFunction(value) ? value : toString(value);
        },
        function: function _function(value) {
            return toFunctionReference(value);
        },
        serverapi: toServerAPI,
        object: function object(value) {
            try {
                return JSON.parse(replaceSingleQuotes(value));
            } catch (e) {
                return null;
            }
        },
    };

    var convertTo = function convertTo(value, type) {
        return conversionTable[type](value);
    };

    var getValueByType = function getValueByType(newValue, defaultValue, valueType) {
        // can always assign default value
        if (newValue === defaultValue) {
            return newValue;
        }

        // get the type of the new value
        var newValueType = getType(newValue);

        // is valid type?
        if (newValueType !== valueType) {
            // is string input, let's attempt to convert
            var convertedValue = convertTo(newValue, valueType);

            // what is the type now
            newValueType = getType(convertedValue);

            // no valid conversions found
            if (convertedValue === null) {
                throw 'Trying to assign value with incorrect type to "' +
                    option +
                    '", allowed type: "' +
                    valueType +
                    '"';
            } else {
                newValue = convertedValue;
            }
        }

        // assign new value
        return newValue;
    };

    var createOption = function createOption(defaultValue, valueType) {
        var currentValue = defaultValue;
        return {
            enumerable: true,
            get: function get() {
                return currentValue;
            },
            set: function set(newValue) {
                currentValue = getValueByType(newValue, defaultValue, valueType);
            },
        };
    };

    var createOptions = function createOptions(options) {
        var obj = {};
        forin(options, function(prop) {
            var optionDefinition = options[prop];
            obj[prop] = createOption(optionDefinition[0], optionDefinition[1]);
        });
        return createObject(obj);
    };

    var createInitialState = function createInitialState(options) {
        return {
            // model
            items: [],

            // timeout used for calling update items
            listUpdateTimeout: null,

            // timeout used for stacking metadata updates
            itemUpdateTimeout: null,

            // queue of items waiting to be processed
            processingQueue: [],

            // options
            options: createOptions(options),
        };
    };

    var fromCamels = function fromCamels(string) {
        var separator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '-';
        return string
            .split(/(?=[A-Z])/)
            .map(function(part) {
                return part.toLowerCase();
            })
            .join(separator);
    };

    var createOptionAPI = function createOptionAPI(store, options) {
        var obj = {};
        forin(options, function(key) {
            obj[key] = {
                get: function get() {
                    return store.getState().options[key];
                },
                set: function set(value) {
                    store.dispatch('SET_' + fromCamels(key, '_').toUpperCase(), {
                        value: value,
                    });
                },
            };
        });
        return obj;
    };

    var createOptionActions = function createOptionActions(options) {
        return function(dispatch, query, state) {
            var obj = {};
            forin(options, function(key) {
                var name = fromCamels(key, '_').toUpperCase();

                obj['SET_' + name] = function(action) {
                    try {
                        state.options[key] = action.value;
                    } catch (e) {} // nope, failed

                    // we successfully set the value of this option
                    dispatch('DID_SET_' + name, { value: state.options[key] });
                };
            });
            return obj;
        };
    };

    var createOptionQueries = function createOptionQueries(options) {
        return function(state) {
            var obj = {};
            forin(options, function(key) {
                obj['GET_' + fromCamels(key, '_').toUpperCase()] = function(action) {
                    return state.options[key];
                };
            });
            return obj;
        };
    };

    var InteractionMethod = {
        API: 1,
        DROP: 2,
        BROWSE: 3,
        PASTE: 4,
        NONE: 5,
    };

    var getUniqueId = function getUniqueId() {
        return Math.random()
            .toString(36)
            .substring(2, 11);
    };

    function _typeof(obj) {
        if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {
            _typeof = function(obj) {
                return typeof obj;
            };
        } else {
            _typeof = function(obj) {
                return obj &&
                    typeof Symbol === 'function' &&
                    obj.constructor === Symbol &&
                    obj !== Symbol.prototype
                    ? 'symbol'
                    : typeof obj;
            };
        }

        return _typeof(obj);
    }

    var REACT_ELEMENT_TYPE;

    function _jsx(type, props, key, children) {
        if (!REACT_ELEMENT_TYPE) {
            REACT_ELEMENT_TYPE =
                (typeof Symbol === 'function' && Symbol['for'] && Symbol['for']('react.element')) ||
                0xeac7;
        }

        var defaultProps = type && type.defaultProps;
        var childrenLength = arguments.length - 3;

        if (!props && childrenLength !== 0) {
            props = {
                children: void 0,
            };
        }

        if (props && defaultProps) {
            for (var propName in defaultProps) {
                if (props[propName] === void 0) {
                    props[propName] = defaultProps[propName];
                }
            }
        } else if (!props) {
            props = defaultProps || {};
        }

        if (childrenLength === 1) {
            props.children = children;
        } else if (childrenLength > 1) {
            var childArray = new Array(childrenLength);

            for (var i = 0; i < childrenLength; i++) {
                childArray[i] = arguments[i + 3];
            }

            props.children = childArray;
        }

        return {
            $$typeof: REACT_ELEMENT_TYPE,
            type: type,
            key: key === undefined ? null : '' + key,
            ref: null,
            props: props,
            _owner: null,
        };
    }

    function _asyncIterator(iterable) {
        var method;

        if (typeof Symbol !== 'undefined') {
            if (Symbol.asyncIterator) {
                method = iterable[Symbol.asyncIterator];
                if (method != null) return method.call(iterable);
            }

            if (Symbol.iterator) {
                method = iterable[Symbol.iterator];
                if (method != null) return method.call(iterable);
            }
        }

        throw new TypeError('Object is not async iterable');
    }

    function _AwaitValue(value) {
        this.wrapped = value;
    }

    function _AsyncGenerator(gen) {
        var front, back;

        function send(key, arg) {
            return new Promise(function(resolve, reject) {
                var request = {
                    key: key,
                    arg: arg,
                    resolve: resolve,
                    reject: reject,
                    next: null,
                };

                if (back) {
                    back = back.next = request;
                } else {
                    front = back = request;
                    resume(key, arg);
                }
            });
        }

        function resume(key, arg) {
            try {
                var result = gen[key](arg);
                var value = result.value;
                var wrappedAwait = value instanceof _AwaitValue;
                Promise.resolve(wrappedAwait ? value.wrapped : value).then(
                    function(arg) {
                        if (wrappedAwait) {
                            resume('next', arg);
                            return;
                        }

                        settle(result.done ? 'return' : 'normal', arg);
                    },
                    function(err) {
                        resume('throw', err);
                    }
                );
            } catch (err) {
                settle('throw', err);
            }
        }

        function settle(type, value) {
            switch (type) {
                case 'return':
                    front.resolve({
                        value: value,
                        done: true,
                    });
                    break;

                case 'throw':
                    front.reject(value);
                    break;

                default:
                    front.resolve({
                        value: value,
                        done: false,
                    });
                    break;
            }

            front = front.next;

            if (front) {
                resume(front.key, front.arg);
            } else {
                back = null;
            }
        }

        this._invoke = send;

        if (typeof gen.return !== 'function') {
            this.return = undefined;
        }
    }

    if (typeof Symbol === 'function' && Symbol.asyncIterator) {
        _AsyncGenerator.prototype[Symbol.asyncIterator] = function() {
            return this;
        };
    }

    _AsyncGenerator.prototype.next = function(arg) {
        return this._invoke('next', arg);
    };

    _AsyncGenerator.prototype.throw = function(arg) {
        return this._invoke('throw', arg);
    };

    _AsyncGenerator.prototype.return = function(arg) {
        return this._invoke('return', arg);
    };

    function _wrapAsyncGenerator(fn) {
        return function() {
            return new _AsyncGenerator(fn.apply(this, arguments));
        };
    }

    function _awaitAsyncGenerator(value) {
        return new _AwaitValue(value);
    }

    function _asyncGeneratorDelegate(inner, awaitWrap) {
        var iter = {},
            waiting = false;

        function pump(key, value) {
            waiting = true;
            value = new Promise(function(resolve) {
                resolve(inner[key](value));
            });
            return {
                done: false,
                value: awaitWrap(value),
            };
        }

        if (typeof Symbol === 'function' && Symbol.iterator) {
            iter[Symbol.iterator] = function() {
                return this;
            };
        }

        iter.next = function(value) {
            if (waiting) {
                waiting = false;
                return value;
            }

            return pump('next', value);
        };

        if (typeof inner.throw === 'function') {
            iter.throw = function(value) {
                if (waiting) {
                    waiting = false;
                    throw value;
                }

                return pump('throw', value);
            };
        }

        if (typeof inner.return === 'function') {
            iter.return = function(value) {
                return pump('return', value);
            };
        }

        return iter;
    }

    function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
        try {
            var info = gen[key](arg);
            var value = info.value;
        } catch (error) {
            reject(error);
            return;
        }

        if (info.done) {
            resolve(value);
        } else {
            Promise.resolve(value).then(_next, _throw);
        }
    }

    function _asyncToGenerator(fn) {
        return function() {
            var self = this,
                args = arguments;
            return new Promise(function(resolve, reject) {
                var gen = fn.apply(self, args);

                function _next(value) {
                    asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'next', value);
                }

                function _throw(err) {
                    asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);
                }

                _next(undefined);
            });
        };
    }

    function _classCallCheck(instance, Constructor) {
        if (!(instance instanceof Constructor)) {
            throw new TypeError('Cannot call a class as a function');
        }
    }

    function _defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ('value' in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor);
        }
    }

    function _createClass(Constructor, protoProps, staticProps) {
        if (protoProps) _defineProperties(Constructor.prototype, protoProps);
        if (staticProps) _defineProperties(Constructor, staticProps);
        return Constructor;
    }

    function _defineEnumerableProperties(obj, descs) {
        for (var key in descs) {
            var desc = descs[key];
            desc.configurable = desc.enumerable = true;
            if ('value' in desc) desc.writable = true;
            Object.defineProperty(obj, key, desc);
        }

        if (Object.getOwnPropertySymbols) {
            var objectSymbols = Object.getOwnPropertySymbols(descs);

            for (var i = 0; i < objectSymbols.length; i++) {
                var sym = objectSymbols[i];
                var desc = descs[sym];
                desc.configurable = desc.enumerable = true;
                if ('value' in desc) desc.writable = true;
                Object.defineProperty(obj, sym, desc);
            }
        }

        return obj;
    }

    function _defaults(obj, defaults) {
        var keys = Object.getOwnPropertyNames(defaults);

        for (var i = 0; i < keys.length; i++) {
            var key = keys[i];
            var value = Object.getOwnPropertyDescriptor(defaults, key);

            if (value && value.configurable && obj[key] === undefined) {
                Object.defineProperty(obj, key, value);
            }
        }

        return obj;
    }

    function _defineProperty(obj, key, value) {
        if (key in obj) {
            Object.defineProperty(obj, key, {
                value: value,
                enumerable: true,
                configurable: true,
                writable: true,
            });
        } else {
            obj[key] = value;
        }

        return obj;
    }

    function _extends() {
        _extends =
            Object.assign ||
            function(target) {
                for (var i = 1; i < arguments.length; i++) {
                    var source = arguments[i];

                    for (var key in source) {
                        if (Object.prototype.hasOwnProperty.call(source, key)) {
                            target[key] = source[key];
                        }
                    }
                }

                return target;
            };

        return _extends.apply(this, arguments);
    }

    function _objectSpread(target) {
        for (var i = 1; i < arguments.length; i++) {
            var source = arguments[i] != null ? arguments[i] : {};
            var ownKeys = Object.keys(source);

            if (typeof Object.getOwnPropertySymbols === 'function') {
                ownKeys = ownKeys.concat(
                    Object.getOwnPropertySymbols(source).filter(function(sym) {
                        return Object.getOwnPropertyDescriptor(source, sym).enumerable;
                    })
                );
            }

            ownKeys.forEach(function(key) {
                _defineProperty(target, key, source[key]);
            });
        }

        return target;
    }

    function ownKeys(object, enumerableOnly) {
        var keys = Object.keys(object);

        if (Object.getOwnPropertySymbols) {
            var symbols = Object.getOwnPropertySymbols(object);
            if (enumerableOnly)
                symbols = symbols.filter(function(sym) {
                    return Object.getOwnPropertyDescriptor(object, sym).enumerable;
                });
            keys.push.apply(keys, symbols);
        }

        return keys;
    }

    function _objectSpread2(target) {
        for (var i = 1; i < arguments.length; i++) {
            var source = arguments[i] != null ? arguments[i] : {};

            if (i % 2) {
                ownKeys(source, true).forEach(function(key) {
                    _defineProperty(target, key, source[key]);
                });
            } else if (Object.getOwnPropertyDescriptors) {
                Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
            } else {
                ownKeys(source).forEach(function(key) {
                    Object.defineProperty(
                        target,
                        key,
                        Object.getOwnPropertyDescriptor(source, key)
                    );
                });
            }
        }

        return target;
    }

    function _inherits(subClass, superClass) {
        if (typeof superClass !== 'function' && superClass !== null) {
            throw new TypeError('Super expression must either be null or a function');
        }

        subClass.prototype = Object.create(superClass && superClass.prototype, {
            constructor: {
                value: subClass,
                writable: true,
                configurable: true,
            },
        });
        if (superClass) _setPrototypeOf(subClass, superClass);
    }

    function _inheritsLoose(subClass, superClass) {
        subClass.prototype = Object.create(superClass.prototype);
        subClass.prototype.constructor = subClass;
        subClass.__proto__ = superClass;
    }

    function _getPrototypeOf(o) {
        _getPrototypeOf = Object.setPrototypeOf
            ? Object.getPrototypeOf
            : function _getPrototypeOf(o) {
                  return o.__proto__ || Object.getPrototypeOf(o);
              };
        return _getPrototypeOf(o);
    }

    function _setPrototypeOf(o, p) {
        _setPrototypeOf =
            Object.setPrototypeOf ||
            function _setPrototypeOf(o, p) {
                o.__proto__ = p;
                return o;
            };

        return _setPrototypeOf(o, p);
    }

    function isNativeReflectConstruct() {
        if (typeof Reflect === 'undefined' || !Reflect.construct) return false;
        if (Reflect.construct.sham) return false;
        if (typeof Proxy === 'function') return true;

        try {
            Date.prototype.toString.call(Reflect.construct(Date, [], function() {}));
            return true;
        } catch (e) {
            return false;
        }
    }

    function _construct(Parent, args, Class) {
        if (isNativeReflectConstruct()) {
            _construct = Reflect.construct;
        } else {
            _construct = function _construct(Parent, args, Class) {
                var a = [null];
                a.push.apply(a, args);
                var Constructor = Function.bind.apply(Parent, a);
                var instance = new Constructor();
                if (Class) _setPrototypeOf(instance, Class.prototype);
                return instance;
            };
        }

        return _construct.apply(null, arguments);
    }

    function _isNativeFunction(fn) {
        return Function.toString.call(fn).indexOf('[native code]') !== -1;
    }

    function _wrapNativeSuper(Class) {
        var _cache = typeof Map === 'function' ? new Map() : undefined;

        _wrapNativeSuper = function _wrapNativeSuper(Class) {
            if (Class === null || !_isNativeFunction(Class)) return Class;

            if (typeof Class !== 'function') {
                throw new TypeError('Super expression must either be null or a function');
            }

            if (typeof _cache !== 'undefined') {
                if (_cache.has(Class)) return _cache.get(Class);

                _cache.set(Class, Wrapper);
            }

            function Wrapper() {
                return _construct(Class, arguments, _getPrototypeOf(this).constructor);
            }

            Wrapper.prototype = Object.create(Class.prototype, {
                constructor: {
                    value: Wrapper,
                    enumerable: false,
                    writable: true,
                    configurable: true,
                },
            });
            return _setPrototypeOf(Wrapper, Class);
        };

        return _wrapNativeSuper(Class);
    }

    function _instanceof(left, right) {
        if (right != null && typeof Symbol !== 'undefined' && right[Symbol.hasInstance]) {
            return !!right[Symbol.hasInstance](left);
        } else {
            return left instanceof right;
        }
    }

    function _interopRequireDefault(obj) {
        return obj && obj.__esModule
            ? obj
            : {
                  default: obj,
              };
    }

    function _interopRequireWildcard(obj) {
        if (obj && obj.__esModule) {
            return obj;
        } else {
            var newObj = {};

            if (obj != null) {
                for (var key in obj) {
                    if (Object.prototype.hasOwnProperty.call(obj, key)) {
                        var desc =
                            Object.defineProperty && Object.getOwnPropertyDescriptor
                                ? Object.getOwnPropertyDescriptor(obj, key)
                                : {};

                        if (desc.get || desc.set) {
                            Object.defineProperty(newObj, key, desc);
                        } else {
                            newObj[key] = obj[key];
                        }
                    }
                }
            }

            newObj.default = obj;
            return newObj;
        }
    }

    function _newArrowCheck(innerThis, boundThis) {
        if (innerThis !== boundThis) {
            throw new TypeError('Cannot instantiate an arrow function');
        }
    }

    function _objectDestructuringEmpty(obj) {
        if (obj == null) throw new TypeError('Cannot destructure undefined');
    }

    function _objectWithoutPropertiesLoose(source, excluded) {
        if (source == null) return {};
        var target = {};
        var sourceKeys = Object.keys(source);
        var key, i;

        for (i = 0; i < sourceKeys.length; i++) {
            key = sourceKeys[i];
            if (excluded.indexOf(key) >= 0) continue;
            target[key] = source[key];
        }

        return target;
    }

    function _objectWithoutProperties(source, excluded) {
        if (source == null) return {};

        var target = _objectWithoutPropertiesLoose(source, excluded);

        var key, i;

        if (Object.getOwnPropertySymbols) {
            var sourceSymbolKeys = Object.getOwnPropertySymbols(source);

            for (i = 0; i < sourceSymbolKeys.length; i++) {
                key = sourceSymbolKeys[i];
                if (excluded.indexOf(key) >= 0) continue;
                if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;
                target[key] = source[key];
            }
        }

        return target;
    }

    function _assertThisInitialized(self) {
        if (self === void 0) {
            throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        }

        return self;
    }

    function _possibleConstructorReturn(self, call) {
        if (call && (typeof call === 'object' || typeof call === 'function')) {
            return call;
        }

        return _assertThisInitialized(self);
    }

    function _superPropBase(object, property) {
        while (!Object.prototype.hasOwnProperty.call(object, property)) {
            object = _getPrototypeOf(object);
            if (object === null) break;
        }

        return object;
    }

    function _get(target, property, receiver) {
        if (typeof Reflect !== 'undefined' && Reflect.get) {
            _get = Reflect.get;
        } else {
            _get = function _get(target, property, receiver) {
                var base = _superPropBase(target, property);

                if (!base) return;
                var desc = Object.getOwnPropertyDescriptor(base, property);

                if (desc.get) {
                    return desc.get.call(receiver);
                }

                return desc.value;
            };
        }

        return _get(target, property, receiver || target);
    }

    function set(target, property, value, receiver) {
        if (typeof Reflect !== 'undefined' && Reflect.set) {
            set = Reflect.set;
        } else {
            set = function set(target, property, value, receiver) {
                var base = _superPropBase(target, property);

                var desc;

                if (base) {
                    desc = Object.getOwnPropertyDescriptor(base, property);

                    if (desc.set) {
                        desc.set.call(receiver, value);
                        return true;
                    } else if (!desc.writable) {
                        return false;
                    }
                }

                desc = Object.getOwnPropertyDescriptor(receiver, property);

                if (desc) {
                    if (!desc.writable) {
                        return false;
                    }

                    desc.value = value;
                    Object.defineProperty(receiver, property, desc);
                } else {
                    _defineProperty(receiver, property, value);
                }

                return true;
            };
        }

        return set(target, property, value, receiver);
    }

    function _set(target, property, value, receiver, isStrict) {
        var s = set(target, property, value, receiver || target);

        if (!s && isStrict) {
            throw new Error('failed to set property');
        }

        return value;
    }

    function _taggedTemplateLiteral(strings, raw) {
        if (!raw) {
            raw = strings.slice(0);
        }

        return Object.freeze(
            Object.defineProperties(strings, {
                raw: {
                    value: Object.freeze(raw),
                },
            })
        );
    }

    function _taggedTemplateLiteralLoose(strings, raw) {
        if (!raw) {
            raw = strings.slice(0);
        }

        strings.raw = raw;
        return strings;
    }

    function _temporalRef(val, name) {
        if (val === _temporalUndefined) {
            throw new ReferenceError(name + ' is not defined - temporal dead zone');
        } else {
            return val;
        }
    }

    function _readOnlyError(name) {
        throw new Error('"' + name + '" is read-only');
    }

    function _classNameTDZError(name) {
        throw new Error('Class "' + name + '" cannot be referenced in computed property keys.');
    }

    var _temporalUndefined = {};

    function _slicedToArray(arr, i) {
        return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();
    }

    function _slicedToArrayLoose(arr, i) {
        return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _nonIterableRest();
    }

    function _toArray(arr) {
        return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();
    }

    function _toConsumableArray(arr) {
        return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();
    }

    function _arrayWithoutHoles(arr) {
        if (Array.isArray(arr)) {
            for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];

            return arr2;
        }
    }

    function _arrayWithHoles(arr) {
        if (Array.isArray(arr)) return arr;
    }

    function _iterableToArray(iter) {
        if (
            Symbol.iterator in Object(iter) ||
            Object.prototype.toString.call(iter) === '[object Arguments]'
        )
            return Array.from(iter);
    }

    function _iterableToArrayLimit(arr, i) {
        var _arr = [];
        var _n = true;
        var _d = false;
        var _e = undefined;

        try {
            for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
                _arr.push(_s.value);

                if (i && _arr.length === i) break;
            }
        } catch (err) {
            _d = true;
            _e = err;
        } finally {
            try {
                if (!_n && _i['return'] != null) _i['return']();
            } finally {
                if (_d) throw _e;
            }
        }

        return _arr;
    }

    function _iterableToArrayLimitLoose(arr, i) {
        var _arr = [];

        for (var _iterator = arr[Symbol.iterator](), _step; !(_step = _iterator.next()).done; ) {
            _arr.push(_step.value);

            if (i && _arr.length === i) break;
        }

        return _arr;
    }

    function _nonIterableSpread() {
        throw new TypeError('Invalid attempt to spread non-iterable instance');
    }

    function _nonIterableRest() {
        throw new TypeError('Invalid attempt to destructure non-iterable instance');
    }

    function _skipFirstGeneratorNext(fn) {
        return function() {
            var it = fn.apply(this, arguments);
            it.next();
            return it;
        };
    }

    function _toPrimitive(input, hint) {
        if (typeof input !== 'object' || input === null) return input;
        var prim = input[Symbol.toPrimitive];

        if (prim !== undefined) {
            var res = prim.call(input, hint || 'default');
            if (typeof res !== 'object') return res;
            throw new TypeError('@@toPrimitive must return a primitive value.');
        }

        return (hint === 'string' ? String : Number)(input);
    }

    function _toPropertyKey(arg) {
        var key = _toPrimitive(arg, 'string');

        return typeof key === 'symbol' ? key : String(key);
    }

    function _initializerWarningHelper(descriptor, context) {
        throw new Error(
            'Decorating class property failed. Please ensure that ' +
                'proposal-class-properties is enabled and set to use loose mode. ' +
                'To use proposal-class-properties in spec mode with decorators, wait for ' +
                'the next major version of decorators in stage 2.'
        );
    }

    function _initializerDefineProperty(target, property, descriptor, context) {
        if (!descriptor) return;
        Object.defineProperty(target, property, {
            enumerable: descriptor.enumerable,
            configurable: descriptor.configurable,
            writable: descriptor.writable,
            value: descriptor.initializer ? descriptor.initializer.call(context) : void 0,
        });
    }

    function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
        var desc = {};
        Object.keys(descriptor).forEach(function(key) {
            desc[key] = descriptor[key];
        });
        desc.enumerable = !!desc.enumerable;
        desc.configurable = !!desc.configurable;

        if ('value' in desc || desc.initializer) {
            desc.writable = true;
        }

        desc = decorators
            .slice()
            .reverse()
            .reduce(function(desc, decorator) {
                return decorator(target, property, desc) || desc;
            }, desc);

        if (context && desc.initializer !== void 0) {
            desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
            desc.initializer = undefined;
        }

        if (desc.initializer === void 0) {
            Object.defineProperty(target, property, desc);
            desc = null;
        }

        return desc;
    }

    var id = 0;

    function _classPrivateFieldLooseKey(name) {
        return '__private_' + id++ + '_' + name;
    }

    function _classPrivateFieldLooseBase(receiver, privateKey) {
        if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {
            throw new TypeError('attempted to use private field on non-instance');
        }

        return receiver;
    }

    function _classPrivateFieldGet(receiver, privateMap) {
        var descriptor = privateMap.get(receiver);

        if (!descriptor) {
            throw new TypeError('attempted to get private field on non-instance');
        }

        if (descriptor.get) {
            return descriptor.get.call(receiver);
        }

        return descriptor.value;
    }

    function _classPrivateFieldSet(receiver, privateMap, value) {
        var descriptor = privateMap.get(receiver);

        if (!descriptor) {
            throw new TypeError('attempted to set private field on non-instance');
        }

        if (descriptor.set) {
            descriptor.set.call(receiver, value);
        } else {
            if (!descriptor.writable) {
                throw new TypeError('attempted to set read only private field');
            }

            descriptor.value = value;
        }

        return value;
    }

    function _classPrivateFieldDestructureSet(receiver, privateMap) {
        if (!privateMap.has(receiver)) {
            throw new TypeError('attempted to set private field on non-instance');
        }

        var descriptor = privateMap.get(receiver);

        if (descriptor.set) {
            if (!('__destrObj' in descriptor)) {
                descriptor.__destrObj = {
                    set value(v) {
                        descriptor.set.call(receiver, v);
                    },
                };
            }

            return descriptor.__destrObj;
        } else {
            if (!descriptor.writable) {
                throw new TypeError('attempted to set read only private field');
            }

            return descriptor;
        }
    }

    function _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {
        if (receiver !== classConstructor) {
            throw new TypeError('Private static access of wrong provenance');
        }

        return descriptor.value;
    }

    function _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {
        if (receiver !== classConstructor) {
            throw new TypeError('Private static access of wrong provenance');
        }

        if (!descriptor.writable) {
            throw new TypeError('attempted to set read only private field');
        }

        descriptor.value = value;
        return value;
    }

    function _classStaticPrivateMethodGet(receiver, classConstructor, method) {
        if (receiver !== classConstructor) {
            throw new TypeError('Private static access of wrong provenance');
        }

        return method;
    }

    function _classStaticPrivateMethodSet() {
        throw new TypeError('attempted to set read only static private field');
    }

    function _decorate(decorators, factory, superClass, mixins) {
        var api = _getDecoratorsApi();

        if (mixins) {
            for (var i = 0; i < mixins.length; i++) {
                api = mixins[i](api);
            }
        }

        var r = factory(function initialize(O) {
            api.initializeInstanceElements(O, decorated.elements);
        }, superClass);
        var decorated = api.decorateClass(
            _coalesceClassElements(r.d.map(_createElementDescriptor)),
            decorators
        );
        api.initializeClassElements(r.F, decorated.elements);
        return api.runClassFinishers(r.F, decorated.finishers);
    }

    function _getDecoratorsApi() {
        _getDecoratorsApi = function() {
            return api;
        };

        var api = {
            elementsDefinitionOrder: [['method'], ['field']],
            initializeInstanceElements: function(O, elements) {
                ['method', 'field'].forEach(function(kind) {
                    elements.forEach(function(element) {
                        if (element.kind === kind && element.placement === 'own') {
                            this.defineClassElement(O, element);
                        }
                    }, this);
                }, this);
            },
            initializeClassElements: function(F, elements) {
                var proto = F.prototype;
                ['method', 'field'].forEach(function(kind) {
                    elements.forEach(function(element) {
                        var placement = element.placement;

                        if (
                            element.kind === kind &&
                            (placement === 'static' || placement === 'prototype')
                        ) {
                            var receiver = placement === 'static' ? F : proto;
                            this.defineClassElement(receiver, element);
                        }
                    }, this);
                }, this);
            },
            defineClassElement: function(receiver, element) {
                var descriptor = element.descriptor;

                if (element.kind === 'field') {
                    var initializer = element.initializer;
                    descriptor = {
                        enumerable: descriptor.enumerable,
                        writable: descriptor.writable,
                        configurable: descriptor.configurable,
                        value: initializer === void 0 ? void 0 : initializer.call(receiver),
                    };
                }

                Object.defineProperty(receiver, element.key, descriptor);
            },
            decorateClass: function(elements, decorators) {
                var newElements = [];
                var finishers = [];
                var placements = {
                    static: [],
                    prototype: [],
                    own: [],
                };
                elements.forEach(function(element) {
                    this.addElementPlacement(element, placements);
                }, this);
                elements.forEach(function(element) {
                    if (!_hasDecorators(element)) return newElements.push(element);
                    var elementFinishersExtras = this.decorateElement(element, placements);
                    newElements.push(elementFinishersExtras.element);
                    newElements.push.apply(newElements, elementFinishersExtras.extras);
                    finishers.push.apply(finishers, elementFinishersExtras.finishers);
                }, this);

                if (!decorators) {
                    return {
                        elements: newElements,
                        finishers: finishers,
                    };
                }

                var result = this.decorateConstructor(newElements, decorators);
                finishers.push.apply(finishers, result.finishers);
                result.finishers = finishers;
                return result;
            },
            addElementPlacement: function(element, placements, silent) {
                var keys = placements[element.placement];

                if (!silent && keys.indexOf(element.key) !== -1) {
                    throw new TypeError('Duplicated element (' + element.key + ')');
                }

                keys.push(element.key);
            },
            decorateElement: function(element, placements) {
                var extras = [];
                var finishers = [];

                for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {
                    var keys = placements[element.placement];
                    keys.splice(keys.indexOf(element.key), 1);
                    var elementObject = this.fromElementDescriptor(element);
                    var elementFinisherExtras = this.toElementFinisherExtras(
                        (0, decorators[i])(elementObject) || elementObject
                    );
                    element = elementFinisherExtras.element;
                    this.addElementPlacement(element, placements);

                    if (elementFinisherExtras.finisher) {
                        finishers.push(elementFinisherExtras.finisher);
                    }

                    var newExtras = elementFinisherExtras.extras;

                    if (newExtras) {
                        for (var j = 0; j < newExtras.length; j++) {
                            this.addElementPlacement(newExtras[j], placements);
                        }

                        extras.push.apply(extras, newExtras);
                    }
                }

                return {
                    element: element,
                    finishers: finishers,
                    extras: extras,
                };
            },
            decorateConstructor: function(elements, decorators) {
                var finishers = [];

                for (var i = decorators.length - 1; i >= 0; i--) {
                    var obj = this.fromClassDescriptor(elements);
                    var elementsAndFinisher = this.toClassDescriptor(
                        (0, decorators[i])(obj) || obj
                    );

                    if (elementsAndFinisher.finisher !== undefined) {
                        finishers.push(elementsAndFinisher.finisher);
                    }

                    if (elementsAndFinisher.elements !== undefined) {
                        elements = elementsAndFinisher.elements;

                        for (var j = 0; j < elements.length - 1; j++) {
                            for (var k = j + 1; k < elements.length; k++) {
                                if (
                                    elements[j].key === elements[k].key &&
                                    elements[j].placement === elements[k].placement
                                ) {
                                    throw new TypeError(
                                        'Duplicated element (' + elements[j].key + ')'
                                    );
                                }
                            }
                        }
                    }
                }

                return {
                    elements: elements,
                    finishers: finishers,
                };
            },
            fromElementDescriptor: function(element) {
                var obj = {
                    kind: element.kind,
                    key: element.key,
                    placement: element.placement,
                    descriptor: element.descriptor,
                };
                var desc = {
                    value: 'Descriptor',
                    configurable: true,
                };
                Object.defineProperty(obj, Symbol.toStringTag, desc);
                if (element.kind === 'field') obj.initializer = element.initializer;
                return obj;
            },
            toElementDescriptors: function(elementObjects) {
                if (elementObjects === undefined) return;
                return _toArray(elementObjects).map(function(elementObject) {
                    var element = this.toElementDescriptor(elementObject);
                    this.disallowProperty(elementObject, 'finisher', 'An element descriptor');
                    this.disallowProperty(elementObject, 'extras', 'An element descriptor');
                    return element;
                }, this);
            },
            toElementDescriptor: function(elementObject) {
                var kind = String(elementObject.kind);

                if (kind !== 'method' && kind !== 'field') {
                    throw new TypeError(
                        'An element descriptor\'s .kind property must be either "method" or' +
                            ' "field", but a decorator created an element descriptor with' +
                            ' .kind "' +
                            kind +
                            '"'
                    );
                }

                var key = _toPropertyKey(elementObject.key);

                var placement = String(elementObject.placement);

                if (placement !== 'static' && placement !== 'prototype' && placement !== 'own') {
                    throw new TypeError(
                        'An element descriptor\'s .placement property must be one of "static",' +
                            ' "prototype" or "own", but a decorator created an element descriptor' +
                            ' with .placement "' +
                            placement +
                            '"'
                    );
                }

                var descriptor = elementObject.descriptor;
                this.disallowProperty(elementObject, 'elements', 'An element descriptor');
                var element = {
                    kind: kind,
                    key: key,
                    placement: placement,
                    descriptor: Object.assign({}, descriptor),
                };

                if (kind !== 'field') {
                    this.disallowProperty(elementObject, 'initializer', 'A method descriptor');
                } else {
                    this.disallowProperty(
                        descriptor,
                        'get',
                        'The property descriptor of a field descriptor'
                    );
                    this.disallowProperty(
                        descriptor,
                        'set',
                        'The property descriptor of a field descriptor'
                    );
                    this.disallowProperty(
                        descriptor,
                        'value',
                        'The property descriptor of a field descriptor'
                    );
                    element.initializer = elementObject.initializer;
                }

                return element;
            },
            toElementFinisherExtras: function(elementObject) {
                var element = this.toElementDescriptor(elementObject);

                var finisher = _optionalCallableProperty(elementObject, 'finisher');

                var extras = this.toElementDescriptors(elementObject.extras);
                return {
                    element: element,
                    finisher: finisher,
                    extras: extras,
                };
            },
            fromClassDescriptor: function(elements) {
                var obj = {
                    kind: 'class',
                    elements: elements.map(this.fromElementDescriptor, this),
                };
                var desc = {
                    value: 'Descriptor',
                    configurable: true,
                };
                Object.defineProperty(obj, Symbol.toStringTag, desc);
                return obj;
            },
            toClassDescriptor: function(obj) {
                var kind = String(obj.kind);

                if (kind !== 'class') {
                    throw new TypeError(
                        'A class descriptor\'s .kind property must be "class", but a decorator' +
                            ' created a class descriptor with .kind "' +
                            kind +
                            '"'
                    );
                }

                this.disallowProperty(obj, 'key', 'A class descriptor');
                this.disallowProperty(obj, 'placement', 'A class descriptor');
                this.disallowProperty(obj, 'descriptor', 'A class descriptor');
                this.disallowProperty(obj, 'initializer', 'A class descriptor');
                this.disallowProperty(obj, 'extras', 'A class descriptor');

                var finisher = _optionalCallableProperty(obj, 'finisher');

                var elements = this.toElementDescriptors(obj.elements);
                return {
                    elements: elements,
                    finisher: finisher,
                };
            },
            runClassFinishers: function(constructor, finishers) {
                for (var i = 0; i < finishers.length; i++) {
                    var newConstructor = (0, finishers[i])(constructor);

                    if (newConstructor !== undefined) {
                        if (typeof newConstructor !== 'function') {
                            throw new TypeError('Finishers must return a constructor.');
                        }

                        constructor = newConstructor;
                    }
                }

                return constructor;
            },
            disallowProperty: function(obj, name, objectType) {
                if (obj[name] !== undefined) {
                    throw new TypeError(objectType + " can't have a ." + name + ' property.');
                }
            },
        };
        return api;
    }

    function _createElementDescriptor(def) {
        var key = _toPropertyKey(def.key);

        var descriptor;

        if (def.kind === 'method') {
            descriptor = {
                value: def.value,
                writable: true,
                configurable: true,
                enumerable: false,
            };
        } else if (def.kind === 'get') {
            descriptor = {
                get: def.value,
                configurable: true,
                enumerable: false,
            };
        } else if (def.kind === 'set') {
            descriptor = {
                set: def.value,
                configurable: true,
                enumerable: false,
            };
        } else if (def.kind === 'field') {
            descriptor = {
                configurable: true,
                writable: true,
                enumerable: true,
            };
        }

        var element = {
            kind: def.kind === 'field' ? 'field' : 'method',
            key: key,
            placement: def.static ? 'static' : def.kind === 'field' ? 'own' : 'prototype',
            descriptor: descriptor,
        };
        if (def.decorators) element.decorators = def.decorators;
        if (def.kind === 'field') element.initializer = def.value;
        return element;
    }

    function _coalesceGetterSetter(element, other) {
        if (element.descriptor.get !== undefined) {
            other.descriptor.get = element.descriptor.get;
        } else {
            other.descriptor.set = element.descriptor.set;
        }
    }

    function _coalesceClassElements(elements) {
        var newElements = [];

        var isSameElement = function(other) {
            return (
                other.kind === 'method' &&
                other.key === element.key &&
                other.placement === element.placement
            );
        };

        for (var i = 0; i < elements.length; i++) {
            var element = elements[i];
            var other;

            if (element.kind === 'method' && (other = newElements.find(isSameElement))) {
                if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {
                    if (_hasDecorators(element) || _hasDecorators(other)) {
                        throw new ReferenceError(
                            'Duplicated methods (' + element.key + ") can't be decorated."
                        );
                    }

                    other.descriptor = element.descriptor;
                } else {
                    if (_hasDecorators(element)) {
                        if (_hasDecorators(other)) {
                            throw new ReferenceError(
                                "Decorators can't be placed on different accessors with for " +
                                    'the same property (' +
                                    element.key +
                                    ').'
                            );
                        }

                        other.decorators = element.decorators;
                    }

                    _coalesceGetterSetter(element, other);
                }
            } else {
                newElements.push(element);
            }
        }

        return newElements;
    }

    function _hasDecorators(element) {
        return element.decorators && element.decorators.length;
    }

    function _isDataDescriptor(desc) {
        return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);
    }

    function _optionalCallableProperty(obj, name) {
        var value = obj[name];

        if (value !== undefined && typeof value !== 'function') {
            throw new TypeError("Expected '" + name + "' to be a function");
        }

        return value;
    }

    function _classPrivateMethodGet(receiver, privateSet, fn) {
        if (!privateSet.has(receiver)) {
            throw new TypeError('attempted to get private field on non-instance');
        }

        return fn;
    }

    function _classPrivateMethodSet() {
        throw new TypeError('attempted to reassign private method');
    }

    function _wrapRegExp(re, groups) {
        _wrapRegExp = function(re, groups) {
            return new BabelRegExp(re, groups);
        };

        var _RegExp = _wrapNativeSuper(RegExp);

        var _super = RegExp.prototype;

        var _groups = new WeakMap();

        function BabelRegExp(re, groups) {
            var _this = _RegExp.call(this, re);

            _groups.set(_this, groups);

            return _this;
        }

        _inherits(BabelRegExp, _RegExp);

        BabelRegExp.prototype.exec = function(str) {
            var result = _super.exec.call(this, str);

            if (result) result.groups = buildGroups(result, this);
            return result;
        };

        BabelRegExp.prototype[Symbol.replace] = function(str, substitution) {
            if (typeof substitution === 'string') {
                var groups = _groups.get(this);

                return _super[Symbol.replace].call(
                    this,
                    str,
                    substitution.replace(/\$<([^>]+)>/g, function(_, name) {
                        return '$' + groups[name];
                    })
                );
            } else if (typeof substitution === 'function') {
                var _this = this;

                return _super[Symbol.replace].call(this, str, function() {
                    var args = [];
                    args.push.apply(args, arguments);

                    if (typeof args[args.length - 1] !== 'object') {
                        args.push(buildGroups(args, _this));
                    }

                    return substitution.apply(this, args);
                });
            } else {
                return _super[Symbol.replace].call(this, str, substitution);
            }
        };

        function buildGroups(result, re) {
            var g = _groups.get(re);

            return Object.keys(g).reduce(function(groups, name) {
                groups[name] = result[g[name]];
                return groups;
            }, Object.create(null));
        }

        return _wrapRegExp.apply(this, arguments);
    }

    var arrayRemove = function arrayRemove(arr, index) {
        return arr.splice(index, 1);
    };

    var run = function run(cb, sync) {
        if (sync) {
            cb();
        } else if (document.hidden) {
            Promise.resolve(1).then(cb);
        } else {
            setTimeout(cb, 0);
        }
    };

    var on = function on() {
        var listeners = [];
        var off = function off(event, cb) {
            arrayRemove(
                listeners,
                listeners.findIndex(function(listener) {
                    return listener.event === event && (listener.cb === cb || !cb);
                })
            );
        };
        var _fire = function fire(event, args, sync) {
            listeners
                .filter(function(listener) {
                    return listener.event === event;
                })
                .map(function(listener) {
                    return listener.cb;
                })
                .forEach(function(cb) {
                    return run(function() {
                        return cb.apply(void 0, _toConsumableArray(args));
                    }, sync);
                });
        };
        return {
            fireSync: function fireSync(event) {
                for (
                    var _len = arguments.length,
                        args = new Array(_len > 1 ? _len - 1 : 0),
                        _key = 1;
                    _key < _len;
                    _key++
                ) {
                    args[_key - 1] = arguments[_key];
                }
                _fire(event, args, true);
            },
            fire: function fire(event) {
                for (
                    var _len2 = arguments.length,
                        args = new Array(_len2 > 1 ? _len2 - 1 : 0),
                        _key2 = 1;
                    _key2 < _len2;
                    _key2++
                ) {
                    args[_key2 - 1] = arguments[_key2];
                }
                _fire(event, args, false);
            },
            on: function on(event, cb) {
                listeners.push({ event: event, cb: cb });
            },
            onOnce: function onOnce(event, _cb) {
                listeners.push({
                    event: event,
                    cb: function cb() {
                        off(event, _cb);
                        _cb.apply(void 0, arguments);
                    },
                });
            },
            off: off,
        };
    };

    var copyObjectPropertiesToObject = function copyObjectPropertiesToObject(
        src,
        target,
        excluded
    ) {
        Object.getOwnPropertyNames(src)
            .filter(function(property) {
                return !excluded.includes(property);
            })
            .forEach(function(key) {
                return Object.defineProperty(
                    target,
                    key,
                    Object.getOwnPropertyDescriptor(src, key)
                );
            });
    };

    var PRIVATE = [
        'fire',
        'process',
        'revert',
        'load',
        'on',
        'off',
        'onOnce',
        'retryLoad',
        'extend',
        'archive',
        'archived',
        'release',
        'released',
        'requestProcessing',
        'freeze',
    ];

    var createItemAPI = function createItemAPI(item) {
        var api = {};
        copyObjectPropertiesToObject(item, api, PRIVATE);
        return api;
    };

    var removeReleasedItems = function removeReleasedItems(items) {
        items.forEach(function(item, index) {
            if (item.released) {
                arrayRemove(items, index);
            }
        });
    };

    var ItemStatus = {
        INIT: 1,
        IDLE: 2,
        PROCESSING_QUEUED: 9,
        PROCESSING: 3,
        PROCESSING_COMPLETE: 5,
        PROCESSING_ERROR: 6,
        PROCESSING_REVERT_ERROR: 10,
        LOADING: 7,
        LOAD_ERROR: 8,
    };

    var FileOrigin = {
        INPUT: 1,
        LIMBO: 2,
        LOCAL: 3,
    };

    var getNonNumeric = function getNonNumeric(str) {
        return /[^0-9]+/.exec(str);
    };

    var getDecimalSeparator = function getDecimalSeparator() {
        return getNonNumeric((1.1).toLocaleString())[0];
    };

    var getThousandsSeparator = function getThousandsSeparator() {
        // Added for browsers that do not return the thousands separator (happend on native browser Android 4.4.4)
        // We check against the normal toString output and if they're the same return a comma when decimal separator is a dot
        var decimalSeparator = getDecimalSeparator();
        var thousandsStringWithSeparator = (1000.0).toLocaleString();
        var thousandsStringWithoutSeparator = (1000.0).toString();
        if (thousandsStringWithSeparator !== thousandsStringWithoutSeparator) {
            return getNonNumeric(thousandsStringWithSeparator)[0];
        }
        return decimalSeparator === '.' ? ',' : '.';
    };

    var Type = {
        BOOLEAN: 'boolean',
        INT: 'int',
        NUMBER: 'number',
        STRING: 'string',
        ARRAY: 'array',
        OBJECT: 'object',
        FUNCTION: 'function',
        ACTION: 'action',
        SERVER_API: 'serverapi',
        REGEX: 'regex',
    };

    // all registered filters
    var filters = [];

    // loops over matching filters and passes options to each filter, returning the mapped results
    var applyFilterChain = function applyFilterChain(key, value, utils) {
        return new Promise(function(resolve, reject) {
            // find matching filters for this key
            var matchingFilters = filters
                .filter(function(f) {
                    return f.key === key;
                })
                .map(function(f) {
                    return f.cb;
                });

            // resolve now
            if (matchingFilters.length === 0) {
                resolve(value);
                return;
            }

            // first filter to kick things of
            var initialFilter = matchingFilters.shift();

            // chain filters
            matchingFilters
                .reduce(
                    // loop over promises passing value to next promise
                    function(current, next) {
                        return current.then(function(value) {
                            return next(value, utils);
                        });
                    },

                    // call initial filter, will return a promise
                    initialFilter(value, utils)

                    // all executed
                )
                .then(function(value) {
                    return resolve(value);
                })
                .catch(function(error) {
                    return reject(error);
                });
        });
    };

    var applyFilters = function applyFilters(key, value, utils) {
        return filters
            .filter(function(f) {
                return f.key === key;
            })
            .map(function(f) {
                return f.cb(value, utils);
            });
    };

    // adds a new filter to the list
    var addFilter = function addFilter(key, cb) {
        return filters.push({ key: key, cb: cb });
    };

    var extendDefaultOptions = function extendDefaultOptions(additionalOptions) {
        return Object.assign(defaultOptions, additionalOptions);
    };

    var getOptions = function getOptions() {
        return Object.assign({}, defaultOptions);
    };

    var setOptions = function setOptions(opts) {
        forin(opts, function(key, value) {
            // key does not exist, so this option cannot be set
            if (!defaultOptions[key]) {
                return;
            }
            defaultOptions[key][0] = getValueByType(
                value,
                defaultOptions[key][0],
                defaultOptions[key][1]
            );
        });
    };

    // default options on app
    var defaultOptions = {
        // the id to add to the root element
        id: [null, Type.STRING],

        // input field name to use
        name: ['filepond', Type.STRING],

        // disable the field
        disabled: [false, Type.BOOLEAN],

        // classname to put on wrapper
        className: [null, Type.STRING],

        // is the field required
        required: [false, Type.BOOLEAN],

        // Allow media capture when value is set
        captureMethod: [null, Type.STRING],
        // - "camera", "microphone" or "camcorder",
        // - Does not work with multiple on apple devices
        // - If set, acceptedFileTypes must be made to match with media wildcard "image/*", "audio/*" or "video/*"

        // sync `acceptedFileTypes` property with `accept` attribute
        allowSyncAcceptAttribute: [true, Type.BOOLEAN],

        // Feature toggles
        allowDrop: [true, Type.BOOLEAN], // Allow dropping of files
        allowBrowse: [true, Type.BOOLEAN], // Allow browsing the file system
        allowPaste: [true, Type.BOOLEAN], // Allow pasting files
        allowMultiple: [false, Type.BOOLEAN], // Allow multiple files (disabled by default, as multiple attribute is also required on input to allow multiple)
        allowReplace: [true, Type.BOOLEAN], // Allow dropping a file on other file to replace it (only works when multiple is set to false)
        allowRevert: [true, Type.BOOLEAN], // Allows user to revert file upload
        allowRemove: [true, Type.BOOLEAN], // Allow user to remove a file
        allowProcess: [true, Type.BOOLEAN], // Allows user to process a file, when set to false, this removes the file upload button
        allowReorder: [false, Type.BOOLEAN], // Allow reordering of files
        allowDirectoriesOnly: [false, Type.BOOLEAN], // Allow only selecting directories with browse (no support for filtering dnd at this point)

        // Try store file if `server` not set
        storeAsFile: [false, Type.BOOLEAN],

        // Revert mode
        forceRevert: [false, Type.BOOLEAN], // Set to 'force' to require the file to be reverted before removal

        // Input requirements
        maxFiles: [null, Type.INT], // Max number of files
        checkValidity: [false, Type.BOOLEAN], // Enables custom validity messages

        // Where to put file
        itemInsertLocationFreedom: [true, Type.BOOLEAN], // Set to false to always add items to begin or end of list
        itemInsertLocation: ['before', Type.STRING], // Default index in list to add items that have been dropped at the top of the list
        itemInsertInterval: [75, Type.INT],

        // Drag 'n Drop related
        dropOnPage: [false, Type.BOOLEAN], // Allow dropping of files anywhere on page (prevents browser from opening file if dropped outside of Up)
        dropOnElement: [true, Type.BOOLEAN], // Drop needs to happen on element (set to false to also load drops outside of Up)
        dropValidation: [false, Type.BOOLEAN], // Enable or disable validating files on drop
        ignoredFiles: [['.ds_store', 'thumbs.db', 'desktop.ini'], Type.ARRAY],

        // Upload related
        instantUpload: [true, Type.BOOLEAN], // Should upload files immediately on drop
        maxParallelUploads: [2, Type.INT], // Maximum files to upload in parallel
        allowMinimumUploadDuration: [true, Type.BOOLEAN], // if true uploads take at least 750 ms, this ensures the user sees the upload progress giving trust the upload actually happened

        // Chunks
        chunkUploads: [false, Type.BOOLEAN], // Enable chunked uploads
        chunkForce: [false, Type.BOOLEAN], // Force use of chunk uploads even for files smaller than chunk size
        chunkSize: [5000000, Type.INT], // Size of chunks (5MB default)
        chunkRetryDelays: [[500, 1000, 3000], Type.ARRAY], // Amount of times to retry upload of a chunk when it fails

        // The server api end points to use for uploading (see docs)
        server: [null, Type.SERVER_API],

        // File size calculations, can set to 1024, this is only used for display, properties use file size base 1000
        fileSizeBase: [1000, Type.INT],

        // Labels and status messages
        labelFileSizeBytes: ['bytes', Type.STRING],
        labelFileSizeKilobytes: ['KB', Type.STRING],
        labelFileSizeMegabytes: ['MB', Type.STRING],
        labelFileSizeGigabytes: ['GB', Type.STRING],

        labelDecimalSeparator: [getDecimalSeparator(), Type.STRING], // Default is locale separator
        labelThousandsSeparator: [getThousandsSeparator(), Type.STRING], // Default is locale separator

        labelIdle: [
            'Drag & Drop your files or <span class="filepond--label-action">Browse</span>',
            Type.STRING,
        ],

        labelInvalidField: ['Field contains invalid files', Type.STRING],
        labelFileWaitingForSize: ['Waiting for size', Type.STRING],
        labelFileSizeNotAvailable: ['Size not available', Type.STRING],
        labelFileCountSingular: ['file in list', Type.STRING],
        labelFileCountPlural: ['files in list', Type.STRING],
        labelFileLoading: ['Loading', Type.STRING],
        labelFileAdded: ['Added', Type.STRING], // assistive only
        labelFileLoadError: ['Error during load', Type.STRING],
        labelFileRemoved: ['Removed', Type.STRING], // assistive only
        labelFileRemoveError: ['Error during remove', Type.STRING],
        labelFileProcessing: ['Uploading', Type.STRING],
        labelFileProcessingComplete: ['Upload complete', Type.STRING],
        labelFileProcessingAborted: ['Upload cancelled', Type.STRING],
        labelFileProcessingError: ['Error during upload', Type.STRING],
        labelFileProcessingRevertError: ['Error during revert', Type.STRING],

        labelTapToCancel: ['tap to cancel', Type.STRING],
        labelTapToRetry: ['tap to retry', Type.STRING],
        labelTapToUndo: ['tap to undo', Type.STRING],

        labelButtonRemoveItem: ['Remove', Type.STRING],
        labelButtonAbortItemLoad: ['Abort', Type.STRING],
        labelButtonRetryItemLoad: ['Retry', Type.STRING],
        labelButtonAbortItemProcessing: ['Cancel', Type.STRING],
        labelButtonUndoItemProcessing: ['Undo', Type.STRING],
        labelButtonRetryItemProcessing: ['Retry', Type.STRING],
        labelButtonProcessItem: ['Upload', Type.STRING],

        // make sure width and height plus viewpox are even numbers so icons are nicely centered
        iconRemove: [
            '<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M11.586 13l-2.293 2.293a1 1 0 0 0 1.414 1.414L13 14.414l2.293 2.293a1 1 0 0 0 1.414-1.414L14.414 13l2.293-2.293a1 1 0 0 0-1.414-1.414L13 11.586l-2.293-2.293a1 1 0 0 0-1.414 1.414L11.586 13z" fill="currentColor" fill-rule="nonzero"/></svg>',
            Type.STRING,
        ],

        iconProcess: [
            '<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M14 10.414v3.585a1 1 0 0 1-2 0v-3.585l-1.293 1.293a1 1 0 0 1-1.414-1.415l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.415L14 10.414zM9 18a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2H9z" fill="currentColor" fill-rule="evenodd"/></svg>',
            Type.STRING,
        ],

        iconRetry: [
            '<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M10.81 9.185l-.038.02A4.997 4.997 0 0 0 8 13.683a5 5 0 0 0 5 5 5 5 0 0 0 5-5 1 1 0 0 1 2 0A7 7 0 1 1 9.722 7.496l-.842-.21a.999.999 0 1 1 .484-1.94l3.23.806c.535.133.86.675.73 1.21l-.804 3.233a.997.997 0 0 1-1.21.73.997.997 0 0 1-.73-1.21l.23-.928v-.002z" fill="currentColor" fill-rule="nonzero"/></svg>',
            Type.STRING,
        ],

        iconUndo: [
            '<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M9.185 10.81l.02-.038A4.997 4.997 0 0 1 13.683 8a5 5 0 0 1 5 5 5 5 0 0 1-5 5 1 1 0 0 0 0 2A7 7 0 1 0 7.496 9.722l-.21-.842a.999.999 0 1 0-1.94.484l.806 3.23c.133.535.675.86 1.21.73l3.233-.803a.997.997 0 0 0 .73-1.21.997.997 0 0 0-1.21-.73l-.928.23-.002-.001z" fill="currentColor" fill-rule="nonzero"/></svg>',
            Type.STRING,
        ],

        iconDone: [
            '<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M18.293 9.293a1 1 0 0 1 1.414 1.414l-7.002 7a1 1 0 0 1-1.414 0l-3.998-4a1 1 0 1 1 1.414-1.414L12 15.586l6.294-6.293z" fill="currentColor" fill-rule="nonzero"/></svg>',
            Type.STRING,
        ],

        // event handlers
        oninit: [null, Type.FUNCTION],
        onwarning: [null, Type.FUNCTION],
        onerror: [null, Type.FUNCTION],
        onactivatefile: [null, Type.FUNCTION],
        oninitfile: [null, Type.FUNCTION],
        onaddfilestart: [null, Type.FUNCTION],
        onaddfileprogress: [null, Type.FUNCTION],
        onaddfile: [null, Type.FUNCTION],
        onprocessfilestart: [null, Type.FUNCTION],
        onprocessfileprogress: [null, Type.FUNCTION],
        onprocessfileabort: [null, Type.FUNCTION],
        onprocessfilerevert: [null, Type.FUNCTION],
        onprocessfile: [null, Type.FUNCTION],
        onprocessfiles: [null, Type.FUNCTION],
        onremovefile: [null, Type.FUNCTION],
        onpreparefile: [null, Type.FUNCTION],
        onupdatefiles: [null, Type.FUNCTION],
        onreorderfiles: [null, Type.FUNCTION],

        // hooks
        beforeDropFile: [null, Type.FUNCTION],
        beforeAddFile: [null, Type.FUNCTION],
        beforeRemoveFile: [null, Type.FUNCTION],
        beforePrepareFile: [null, Type.FUNCTION],

        // styles
        stylePanelLayout: [null, Type.STRING], // null 'integrated', 'compact', 'circle'
        stylePanelAspectRatio: [null, Type.STRING], // null or '3:2' or 1
        styleItemPanelAspectRatio: [null, Type.STRING],
        styleButtonRemoveItemPosition: ['left', Type.STRING],
        styleButtonProcessItemPosition: ['right', Type.STRING],
        styleLoadIndicatorPosition: ['right', Type.STRING],
        styleProgressIndicatorPosition: ['right', Type.STRING],
        styleButtonRemoveItemAlign: [false, Type.BOOLEAN],

        // custom initial files array
        files: [[], Type.ARRAY],

        // show support by displaying credits
        credits: [['https://pqina.nl/', 'Powered by PQINA'], Type.ARRAY],
    };

    var getItemByQuery = function getItemByQuery(items, query) {
        // just return first index
        if (isEmpty(query)) {
            return items[0] || null;
        }

        // query is index
        if (isInt(query)) {
            return items[query] || null;
        }

        // if query is item, get the id
        if (typeof query === 'object') {
            query = query.id;
        }

        // assume query is a string and return item by id
        return (
            items.find(function(item) {
                return item.id === query;
            }) || null
        );
    };

    var getNumericAspectRatioFromString = function getNumericAspectRatioFromString(aspectRatio) {
        if (isEmpty(aspectRatio)) {
            return aspectRatio;
        }
        if (/:/.test(aspectRatio)) {
            var parts = aspectRatio.split(':');
            return parts[1] / parts[0];
        }
        return parseFloat(aspectRatio);
    };

    var getActiveItems = function getActiveItems(items) {
        return items.filter(function(item) {
            return !item.archived;
        });
    };

    var Status = {
        EMPTY: 0,
        IDLE: 1, // waiting
        ERROR: 2, // a file is in error state
        BUSY: 3, // busy processing or loading
        READY: 4, // all files uploaded
    };

    var res = null;
    var canUpdateFileInput = function canUpdateFileInput() {
        if (res === null) {
            try {
                var dataTransfer = new DataTransfer();
                dataTransfer.items.add(new File(['hello world'], 'This_Works.txt'));
                var el = document.createElement('input');
                el.setAttribute('type', 'file');
                el.files = dataTransfer.files;
                res = el.files.length === 1;
            } catch (err) {
                res = false;
            }
        }
        return res;
    };

    var ITEM_ERROR = [
        ItemStatus.LOAD_ERROR,
        ItemStatus.PROCESSING_ERROR,
        ItemStatus.PROCESSING_REVERT_ERROR,
    ];

    var ITEM_BUSY = [
        ItemStatus.LOADING,
        ItemStatus.PROCESSING,
        ItemStatus.PROCESSING_QUEUED,
        ItemStatus.INIT,
    ];

    var ITEM_READY = [ItemStatus.PROCESSING_COMPLETE];

    var isItemInErrorState = function isItemInErrorState(item) {
        return ITEM_ERROR.includes(item.status);
    };
    var isItemInBusyState = function isItemInBusyState(item) {
        return ITEM_BUSY.includes(item.status);
    };
    var isItemInReadyState = function isItemInReadyState(item) {
        return ITEM_READY.includes(item.status);
    };

    var isAsync = function isAsync(state) {
        return (
            isObject(state.options.server) &&
            (isObject(state.options.server.process) || isFunction(state.options.server.process))
        );
    };

    var queries = function queries(state) {
        return {
            GET_STATUS: function GET_STATUS() {
                var items = getActiveItems(state.items);
                var EMPTY = Status.EMPTY,
                    ERROR = Status.ERROR,
                    BUSY = Status.BUSY,
                    IDLE = Status.IDLE,
                    READY = Status.READY;

                if (items.length === 0) return EMPTY;

                if (items.some(isItemInErrorState)) return ERROR;

                if (items.some(isItemInBusyState)) return BUSY;

                if (items.some(isItemInReadyState)) return READY;

                return IDLE;
            },

            GET_ITEM: function GET_ITEM(query) {
                return getItemByQuery(state.items, query);
            },

            GET_ACTIVE_ITEM: function GET_ACTIVE_ITEM(query) {
                return getItemByQuery(getActiveItems(state.items), query);
            },

            GET_ACTIVE_ITEMS: function GET_ACTIVE_ITEMS() {
                return getActiveItems(state.items);
            },

            GET_ITEMS: function GET_ITEMS() {
                return state.items;
            },

            GET_ITEM_NAME: function GET_ITEM_NAME(query) {
                var item = getItemByQuery(state.items, query);
                return item ? item.filename : null;
            },

            GET_ITEM_SIZE: function GET_ITEM_SIZE(query) {
                var item = getItemByQuery(state.items, query);
                return item ? item.fileSize : null;
            },

            GET_STYLES: function GET_STYLES() {
                return Object.keys(state.options)
                    .filter(function(key) {
                        return /^style/.test(key);
                    })
                    .map(function(option) {
                        return {
                            name: option,
                            value: state.options[option],
                        };
                    });
            },

            GET_PANEL_ASPECT_RATIO: function GET_PANEL_ASPECT_RATIO() {
                var isShapeCircle = /circle/.test(state.options.stylePanelLayout);
                var aspectRatio = isShapeCircle
                    ? 1
                    : getNumericAspectRatioFromString(state.options.stylePanelAspectRatio);
                return aspectRatio;
            },

            GET_ITEM_PANEL_ASPECT_RATIO: function GET_ITEM_PANEL_ASPECT_RATIO() {
                return state.options.styleItemPanelAspectRatio;
            },

            GET_ITEMS_BY_STATUS: function GET_ITEMS_BY_STATUS(status) {
                return getActiveItems(state.items).filter(function(item) {
                    return item.status === status;
                });
            },

            GET_TOTAL_ITEMS: function GET_TOTAL_ITEMS() {
                return getActiveItems(state.items).length;
            },

            SHOULD_UPDATE_FILE_INPUT: function SHOULD_UPDATE_FILE_INPUT() {
                return state.options.storeAsFile && canUpdateFileInput() && !isAsync(state);
            },

            IS_ASYNC: function IS_ASYNC() {
                return isAsync(state);
            },

            GET_FILE_SIZE_LABELS: function GET_FILE_SIZE_LABELS(query) {
                return {
                    labelBytes: query('GET_LABEL_FILE_SIZE_BYTES') || undefined,
                    labelKilobytes: query('GET_LABEL_FILE_SIZE_KILOBYTES') || undefined,
                    labelMegabytes: query('GET_LABEL_FILE_SIZE_MEGABYTES') || undefined,
                    labelGigabytes: query('GET_LABEL_FILE_SIZE_GIGABYTES') || undefined,
                };
            },
        };
    };

    var hasRoomForItem = function hasRoomForItem(state) {
        var count = getActiveItems(state.items).length;

        // if cannot have multiple items, to add one item it should currently not contain items
        if (!state.options.allowMultiple) {
            return count === 0;
        }

        // if allows multiple items, we check if a max item count has been set, if not, there's no limit
        var maxFileCount = state.options.maxFiles;
        if (maxFileCount === null) {
            return true;
        }

        // we check if the current count is smaller than the max count, if so, another file can still be added
        if (count < maxFileCount) {
            return true;
        }

        // no more room for another file
        return false;
    };

    var limit = function limit(value, min, max) {
        return Math.max(Math.min(max, value), min);
    };

    var arrayInsert = function arrayInsert(arr, index, item) {
        return arr.splice(index, 0, item);
    };

    var insertItem = function insertItem(items, item, index) {
        if (isEmpty(item)) {
            return null;
        }

        // if index is undefined, append
        if (typeof index === 'undefined') {
            items.push(item);
            return item;
        }

        // limit the index to the size of the items array
        index = limit(index, 0, items.length);

        // add item to array
        arrayInsert(items, index, item);

        // expose
        return item;
    };

    var isBase64DataURI = function isBase64DataURI(str) {
        return /^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*)\s*$/i.test(
            str
        );
    };

    var getFilenameFromURL = function getFilenameFromURL(url) {
        return url
            .split('/')
            .pop()
            .split('?')
            .shift();
    };

    var getExtensionFromFilename = function getExtensionFromFilename(name) {
        return name.split('.').pop();
    };

    var guesstimateExtension = function guesstimateExtension(type) {
        // if no extension supplied, exit here
        if (typeof type !== 'string') {
            return '';
        }

        // get subtype
        var subtype = type.split('/').pop();

        // is svg subtype
        if (/svg/.test(subtype)) {
            return 'svg';
        }

        if (/zip|compressed/.test(subtype)) {
            return 'zip';
        }

        if (/plain/.test(subtype)) {
            return 'txt';
        }

        if (/msword/.test(subtype)) {
            return 'doc';
        }

        // if is valid subtype
        if (/[a-z]+/.test(subtype)) {
            // always use jpg extension
            if (subtype === 'jpeg') {
                return 'jpg';
            }

            // return subtype
            return subtype;
        }

        return '';
    };

    var leftPad = function leftPad(value) {
        var padding = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
        return (padding + value).slice(-padding.length);
    };

    var getDateString = function getDateString() {
        var date = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Date();
        return (
            date.getFullYear() +
            '-' +
            leftPad(date.getMonth() + 1, '00') +
            '-' +
            leftPad(date.getDate(), '00') +
            '_' +
            leftPad(date.getHours(), '00') +
            '-' +
            leftPad(date.getMinutes(), '00') +
            '-' +
            leftPad(date.getSeconds(), '00')
        );
    };

    var getFileFromBlob = function getFileFromBlob(blob, filename) {
        var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
        var extension = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;
        var file =
            typeof type === 'string'
                ? blob.slice(0, blob.size, type)
                : blob.slice(0, blob.size, blob.type);
        file.lastModifiedDate = new Date();

        // copy relative path
        if (blob._relativePath) file._relativePath = blob._relativePath;

        // if blob has name property, use as filename if no filename supplied
        if (!isString(filename)) {
            filename = getDateString();
        }

        // if filename supplied but no extension and filename has extension
        if (filename && extension === null && getExtensionFromFilename(filename)) {
            file.name = filename;
        } else {
            extension = extension || guesstimateExtension(file.type);
            file.name = filename + (extension ? '.' + extension : '');
        }

        return file;
    };

    var getBlobBuilder = function getBlobBuilder() {
        return (window.BlobBuilder =
            window.BlobBuilder ||
            window.WebKitBlobBuilder ||
            window.MozBlobBuilder ||
            window.MSBlobBuilder);
    };

    var createBlob = function createBlob(arrayBuffer, mimeType) {
        var BB = getBlobBuilder();

        if (BB) {
            var bb = new BB();
            bb.append(arrayBuffer);
            return bb.getBlob(mimeType);
        }

        return new Blob([arrayBuffer], {
            type: mimeType,
        });
    };

    var getBlobFromByteStringWithMimeType = function getBlobFromByteStringWithMimeType(
        byteString,
        mimeType
    ) {
        var ab = new ArrayBuffer(byteString.length);
        var ia = new Uint8Array(ab);

        for (var i = 0; i < byteString.length; i++) {
            ia[i] = byteString.charCodeAt(i);
        }

        return createBlob(ab, mimeType);
    };

    var getMimeTypeFromBase64DataURI = function getMimeTypeFromBase64DataURI(dataURI) {
        return (/^data:(.+);/.exec(dataURI) || [])[1] || null;
    };

    var getBase64DataFromBase64DataURI = function getBase64DataFromBase64DataURI(dataURI) {
        // get data part of string (remove data:image/jpeg...,)
        var data = dataURI.split(',')[1];

        // remove any whitespace as that causes InvalidCharacterError in IE
        return data.replace(/\s/g, '');
    };

    var getByteStringFromBase64DataURI = function getByteStringFromBase64DataURI(dataURI) {
        return atob(getBase64DataFromBase64DataURI(dataURI));
    };

    var getBlobFromBase64DataURI = function getBlobFromBase64DataURI(dataURI) {
        var mimeType = getMimeTypeFromBase64DataURI(dataURI);
        var byteString = getByteStringFromBase64DataURI(dataURI);

        return getBlobFromByteStringWithMimeType(byteString, mimeType);
    };

    var getFileFromBase64DataURI = function getFileFromBase64DataURI(dataURI, filename, extension) {
        return getFileFromBlob(getBlobFromBase64DataURI(dataURI), filename, null, extension);
    };

    var getFileNameFromHeader = function getFileNameFromHeader(header) {
        // test if is content disposition header, if not exit
        if (!/^content-disposition:/i.test(header)) return null;

        // get filename parts
        var matches = header
            .split(/filename=|filename\*=.+''/)
            .splice(1)
            .map(function(name) {
                return name.trim().replace(/^["']|[;"']{0,2}$/g, '');
            })
            .filter(function(name) {
                return name.length;
            });

        return matches.length ? decodeURI(matches[matches.length - 1]) : null;
    };

    var getFileSizeFromHeader = function getFileSizeFromHeader(header) {
        if (/content-length:/i.test(header)) {
            var size = header.match(/[0-9]+/)[0];
            return size ? parseInt(size, 10) : null;
        }
        return null;
    };

    var getTranfserIdFromHeader = function getTranfserIdFromHeader(header) {
        if (/x-content-transfer-id:/i.test(header)) {
            var id = (header.split(':')[1] || '').trim();
            return id || null;
        }
        return null;
    };

    var getFileInfoFromHeaders = function getFileInfoFromHeaders(headers) {
        var info = {
            source: null,
            name: null,
            size: null,
        };

        var rows = headers.split('\n');
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;
        try {
            for (
                var _iterator = rows[Symbol.iterator](), _step;
                !(_iteratorNormalCompletion = (_step = _iterator.next()).done);
                _iteratorNormalCompletion = true
            ) {
                var header = _step.value;

                var name = getFileNameFromHeader(header);
                if (name) {
                    info.name = name;
                    continue;
                }

                var size = getFileSizeFromHeader(header);
                if (size) {
                    info.size = size;
                    continue;
                }

                var source = getTranfserIdFromHeader(header);
                if (source) {
                    info.source = source;
                    continue;
                }
            }
        } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
        } finally {
            try {
                if (!_iteratorNormalCompletion && _iterator.return != null) {
                    _iterator.return();
                }
            } finally {
                if (_didIteratorError) {
                    throw _iteratorError;
                }
            }
        }

        return info;
    };

    var createFileLoader = function createFileLoader(fetchFn) {
        var state = {
            source: null,
            complete: false,
            progress: 0,
            size: null,
            timestamp: null,
            duration: 0,
            request: null,
        };

        var getProgress = function getProgress() {
            return state.progress;
        };
        var abort = function abort() {
            if (state.request && state.request.abort) {
                state.request.abort();
            }
        };

        // load source
        var load = function load() {
            // get quick reference
            var source = state.source;

            api.fire('init', source);

            // Load Files
            if (source instanceof File) {
                api.fire('load', source);
            } else if (source instanceof Blob) {
                // Load blobs, set default name to current date
                api.fire('load', getFileFromBlob(source, source.name));
            } else if (isBase64DataURI(source)) {
                // Load base 64, set default name to current date
                api.fire('load', getFileFromBase64DataURI(source));
            } else {
                // Deal as if is external URL, let's load it!
                loadURL(source);
            }
        };

        // loads a url
        var loadURL = function loadURL(url) {
            // is remote url and no fetch method supplied
            if (!fetchFn) {
                api.fire('error', {
                    type: 'error',
                    body: "Can't load URL",
                    code: 400,
                });

                return;
            }

            // set request start
            state.timestamp = Date.now();

            // load file
            state.request = fetchFn(
                url,
                function(response) {
                    // update duration
                    state.duration = Date.now() - state.timestamp;

                    // done!
                    state.complete = true;

                    // turn blob response into a file
                    if (response instanceof Blob) {
                        response = getFileFromBlob(
                            response,
                            response.name || getFilenameFromURL(url)
                        );
                    }

                    api.fire(
                        'load',
                        // if has received blob, we go with blob, if no response, we return null
                        response instanceof Blob ? response : response ? response.body : null
                    );
                },
                function(error) {
                    api.fire(
                        'error',
                        typeof error === 'string'
                            ? {
                                  type: 'error',
                                  code: 0,
                                  body: error,
                              }
                            : error
                    );
                },
                function(computable, current, total) {
                    // collected some meta data already
                    if (total) {
                        state.size = total;
                    }

                    // update duration
                    state.duration = Date.now() - state.timestamp;

                    // if we can't compute progress, we're not going to fire progress events
                    if (!computable) {
                        state.progress = null;
                        return;
                    }

                    // update progress percentage
                    state.progress = current / total;

                    // expose
                    api.fire('progress', state.progress);
                },
                function() {
                    api.fire('abort');
                },
                function(response) {
                    var fileinfo = getFileInfoFromHeaders(
                        typeof response === 'string' ? response : response.headers
                    );
                    api.fire('meta', {
                        size: state.size || fileinfo.size,
                        filename: fileinfo.name,
                        source: fileinfo.source,
                    });
                }
            );
        };

        var api = Object.assign({}, on(), {
            setSource: function setSource(source) {
                return (state.source = source);
            },
            getProgress: getProgress, // file load progress
            abort: abort, // abort file load
            load: load, // start load
        });

        return api;
    };

    var isGet = function isGet(method) {
        return /GET|HEAD/.test(method);
    };

    var sendRequest = function sendRequest(data, url, options) {
        var api = {
            onheaders: function onheaders() {},
            onprogress: function onprogress() {},
            onload: function onload() {},
            ontimeout: function ontimeout() {},
            onerror: function onerror() {},
            onabort: function onabort() {},
            abort: function abort() {
                aborted = true;
                xhr.abort();
            },
        };

        // timeout identifier, only used when timeout is defined
        var aborted = false;
        var headersReceived = false;

        // set default options
        options = Object.assign(
            {
                method: 'POST',
                headers: {},
                withCredentials: false,
            },
            options
        );

        // encode url
        url = encodeURI(url);

        // if method is GET, add any received data to url

        if (isGet(options.method) && data) {
            url =
                '' +
                url +
                encodeURIComponent(typeof data === 'string' ? data : JSON.stringify(data));
        }

        // create request
        var xhr = new XMLHttpRequest();

        // progress of load
        var process = isGet(options.method) ? xhr : xhr.upload;
        process.onprogress = function(e) {
            // no progress event when aborted ( onprogress is called once after abort() )
            if (aborted) {
                return;
            }

            api.onprogress(e.lengthComputable, e.loaded, e.total);
        };

        // tries to get header info to the app as fast as possible
        xhr.onreadystatechange = function() {
            // not interesting in these states ('unsent' and 'openend' as they don't give us any additional info)
            if (xhr.readyState < 2) {
                return;
            }

            // no server response
            if (xhr.readyState === 4 && xhr.status === 0) {
                return;
            }

            if (headersReceived) {
                return;
            }

            headersReceived = true;

            // we've probably received some useful data in response headers
            api.onheaders(xhr);
        };

        // load successful
        xhr.onload = function() {
            // is classified as valid response
            if (xhr.status >= 200 && xhr.status < 300) {
                api.onload(xhr);
            } else {
                api.onerror(xhr);
            }
        };

        // error during load
        xhr.onerror = function() {
            return api.onerror(xhr);
        };

        // request aborted
        xhr.onabort = function() {
            aborted = true;
            api.onabort();
        };

        // request timeout
        xhr.ontimeout = function() {
            return api.ontimeout(xhr);
        };

        // open up open up!
        xhr.open(options.method, url, true);

        // set timeout if defined (do it after open so IE11 plays ball)
        if (isInt(options.timeout)) {
            xhr.timeout = options.timeout;
        }

        // add headers
        Object.keys(options.headers).forEach(function(key) {
            var value = unescape(encodeURIComponent(options.headers[key]));
            xhr.setRequestHeader(key, value);
        });

        // set type of response
        if (options.responseType) {
            xhr.responseType = options.responseType;
        }

        // set credentials
        if (options.withCredentials) {
            xhr.withCredentials = true;
        }

        // let's send our data
        xhr.send(data);

        return api;
    };

    var createResponse = function createResponse(type, code, body, headers) {
        return {
            type: type,
            code: code,
            body: body,
            headers: headers,
        };
    };

    var createTimeoutResponse = function createTimeoutResponse(cb) {
        return function(xhr) {
            cb(createResponse('error', 0, 'Timeout', xhr.getAllResponseHeaders()));
        };
    };

    var hasQS = function hasQS(str) {
        return /\?/.test(str);
    };
    var buildURL = function buildURL() {
        var url = '';
        for (var _len = arguments.length, parts = new Array(_len), _key = 0; _key < _len; _key++) {
            parts[_key] = arguments[_key];
        }
        parts.forEach(function(part) {
            url += hasQS(url) && hasQS(part) ? part.replace(/\?/, '&') : part;
        });
        return url;
    };

    var createFetchFunction = function createFetchFunction() {
        var apiUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
        var action = arguments.length > 1 ? arguments[1] : undefined;
        // custom handler (should also handle file, load, error, progress and abort)
        if (typeof action === 'function') {
            return action;
        }

        // no action supplied
        if (!action || !isString(action.url)) {
            return null;
        }

        // set onload hanlder
        var onload =
            action.onload ||
            function(res) {
                return res;
            };
        var onerror =
            action.onerror ||
            function(res) {
                return null;
            };

        // internal handler
        return function(url, load, error, progress, abort, headers) {
            // do local or remote request based on if the url is external
            var request = sendRequest(
                url,
                buildURL(apiUrl, action.url),
                Object.assign({}, action, {
                    responseType: 'blob',
                })
            );

            request.onload = function(xhr) {
                // get headers
                var headers = xhr.getAllResponseHeaders();

                // get filename
                var filename = getFileInfoFromHeaders(headers).name || getFilenameFromURL(url);

                // create response
                load(
                    createResponse(
                        'load',
                        xhr.status,
                        action.method === 'HEAD'
                            ? null
                            : getFileFromBlob(onload(xhr.response), filename),
                        headers
                    )
                );
            };

            request.onerror = function(xhr) {
                error(
                    createResponse(
                        'error',
                        xhr.status,
                        onerror(xhr.response) || xhr.statusText,
                        xhr.getAllResponseHeaders()
                    )
                );
            };

            request.onheaders = function(xhr) {
                headers(createResponse('headers', xhr.status, null, xhr.getAllResponseHeaders()));
            };

            request.ontimeout = createTimeoutResponse(error);
            request.onprogress = progress;
            request.onabort = abort;

            // should return request
            return request;
        };
    };

    var ChunkStatus = {
        QUEUED: 0,
        COMPLETE: 1,
        PROCESSING: 2,
        ERROR: 3,
        WAITING: 4,
    };

    /*
                                                       function signature:
                                                         (file, metadata, load, error, progress, abort, transfer, options) => {
                                                           return {
                                                           abort:() => {}
                                                         }
                                                       }
                                                       */

    // apiUrl, action, name, file, metadata, load, error, progress, abort, transfer, options
    var processFileChunked = function processFileChunked(
        apiUrl,
        action,
        name,
        file,
        metadata,
        load,
        error,
        progress,
        abort,
        transfer,
        options
    ) {
        // all chunks
        var chunks = [];
        var chunkTransferId = options.chunkTransferId,
            chunkServer = options.chunkServer,
            chunkSize = options.chunkSize,
            chunkRetryDelays = options.chunkRetryDelays;

        // default state
        var state = {
            serverId: chunkTransferId,
            aborted: false,
        };

        // set onload handlers
        var ondata =
            action.ondata ||
            function(fd) {
                return fd;
            };
        var onload =
            action.onload ||
            function(xhr, method) {
                return method === 'HEAD' ? xhr.getResponseHeader('Upload-Offset') : xhr.response;
            };
        var onerror =
            action.onerror ||
            function(res) {
                return null;
            };

        // create server hook
        var requestTransferId = function requestTransferId(cb) {
            var formData = new FormData();

            // add metadata under same name
            if (isObject(metadata)) formData.append(name, JSON.stringify(metadata));

            var headers =
                typeof action.headers === 'function'
                    ? action.headers(file, metadata)
                    : Object.assign({}, action.headers, {
                          'Upload-Length': file.size,
                      });

            var requestParams = Object.assign({}, action, {
                headers: headers,
            });

            // send request object
            var request = sendRequest(
                ondata(formData),
                buildURL(apiUrl, action.url),
                requestParams
            );

            request.onload = function(xhr) {
                return cb(onload(xhr, requestParams.method));
            };

            request.onerror = function(xhr) {
                return error(
                    createResponse(
                        'error',
                        xhr.status,
                        onerror(xhr.response) || xhr.statusText,
                        xhr.getAllResponseHeaders()
                    )
                );
            };

            request.ontimeout = createTimeoutResponse(error);
        };

        var requestTransferOffset = function requestTransferOffset(cb) {
            var requestUrl = buildURL(apiUrl, chunkServer.url, state.serverId);

            var headers =
                typeof action.headers === 'function'
                    ? action.headers(state.serverId)
                    : Object.assign({}, action.headers);

            var requestParams = {
                headers: headers,
                method: 'HEAD',
            };

            var request = sendRequest(null, requestUrl, requestParams);

            request.onload = function(xhr) {
                return cb(onload(xhr, requestParams.method));
            };

            request.onerror = function(xhr) {
                return error(
                    createResponse(
                        'error',
                        xhr.status,
                        onerror(xhr.response) || xhr.statusText,
                        xhr.getAllResponseHeaders()
                    )
                );
            };

            request.ontimeout = createTimeoutResponse(error);
        };

        // create chunks
        var lastChunkIndex = Math.floor(file.size / chunkSize);
        for (var i = 0; i <= lastChunkIndex; i++) {
            var offset = i * chunkSize;
            var data = file.slice(offset, offset + chunkSize, 'application/offset+octet-stream');
            chunks[i] = {
                index: i,
                size: data.size,
                offset: offset,
                data: data,
                file: file,
                progress: 0,
                retries: _toConsumableArray(chunkRetryDelays),
                status: ChunkStatus.QUEUED,
                error: null,
                request: null,
                timeout: null,
            };
        }

        var completeProcessingChunks = function completeProcessingChunks() {
            return load(state.serverId);
        };

        var canProcessChunk = function canProcessChunk(chunk) {
            return chunk.status === ChunkStatus.QUEUED || chunk.status === ChunkStatus.ERROR;
        };

        var processChunk = function processChunk(chunk) {
            // processing is paused, wait here
            if (state.aborted) return;

            // get next chunk to process
            chunk = chunk || chunks.find(canProcessChunk);

            // no more chunks to process
            if (!chunk) {
                // all done?
                if (
                    chunks.every(function(chunk) {
                        return chunk.status === ChunkStatus.COMPLETE;
                    })
                ) {
                    completeProcessingChunks();
                }

                // no chunk to handle
                return;
            }

            // now processing this chunk
            chunk.status = ChunkStatus.PROCESSING;
            chunk.progress = null;

            // allow parsing of formdata
            var ondata =
                chunkServer.ondata ||
                function(fd) {
                    return fd;
                };
            var onerror =
                chunkServer.onerror ||
                function(res) {
                    return null;
                };

            // send request object
            var requestUrl = buildURL(apiUrl, chunkServer.url, state.serverId);

            var headers =
                typeof chunkServer.headers === 'function'
                    ? chunkServer.headers(chunk)
                    : Object.assign({}, chunkServer.headers, {
                          'Content-Type': 'application/offset+octet-stream',
                          'Upload-Offset': chunk.offset,
                          'Upload-Length': file.size,
                          'Upload-Name': file.name,
                      });

            var request = (chunk.request = sendRequest(
                ondata(chunk.data),
                requestUrl,
                Object.assign({}, chunkServer, {
                    headers: headers,
                })
            ));

            request.onload = function() {
                // done!
                chunk.status = ChunkStatus.COMPLETE;

                // remove request reference
                chunk.request = null;

                // start processing more chunks
                processChunks();
            };

            request.onprogress = function(lengthComputable, loaded, total) {
                chunk.progress = lengthComputable ? loaded : null;
                updateTotalProgress();
            };

            request.onerror = function(xhr) {
                chunk.status = ChunkStatus.ERROR;
                chunk.request = null;
                chunk.error = onerror(xhr.response) || xhr.statusText;
                if (!retryProcessChunk(chunk)) {
                    error(
                        createResponse(
                            'error',
                            xhr.status,
                            onerror(xhr.response) || xhr.statusText,
                            xhr.getAllResponseHeaders()
                        )
                    );
                }
            };

            request.ontimeout = function(xhr) {
                chunk.status = ChunkStatus.ERROR;
                chunk.request = null;
                if (!retryProcessChunk(chunk)) {
                    createTimeoutResponse(error)(xhr);
                }
            };

            request.onabort = function() {
                chunk.status = ChunkStatus.QUEUED;
                chunk.request = null;
                abort();
            };
        };

        var retryProcessChunk = function retryProcessChunk(chunk) {
            // no more retries left
            if (chunk.retries.length === 0) return false;

            // new retry
            chunk.status = ChunkStatus.WAITING;
            clearTimeout(chunk.timeout);
            chunk.timeout = setTimeout(function() {
                processChunk(chunk);
            }, chunk.retries.shift());

            // we're going to retry
            return true;
        };

        var updateTotalProgress = function updateTotalProgress() {
            // calculate total progress fraction
            var totalBytesTransfered = chunks.reduce(function(p, chunk) {
                if (p === null || chunk.progress === null) return null;
                return p + chunk.progress;
            }, 0);

            // can't compute progress
            if (totalBytesTransfered === null) return progress(false, 0, 0);

            // calculate progress values
            var totalSize = chunks.reduce(function(total, chunk) {
                return total + chunk.size;
            }, 0);

            // can update progress indicator
            progress(true, totalBytesTransfered, totalSize);
        };

        // process new chunks
        var processChunks = function processChunks() {
            var totalProcessing = chunks.filter(function(chunk) {
                return chunk.status === ChunkStatus.PROCESSING;
            }).length;
            if (totalProcessing >= 1) return;
            processChunk();
        };

        var abortChunks = function abortChunks() {
            chunks.forEach(function(chunk) {
                clearTimeout(chunk.timeout);
                if (chunk.request) {
                    chunk.request.abort();
                }
            });
        };

        // let's go!
        if (!state.serverId) {
            requestTransferId(function(serverId) {
                // stop here if aborted, might have happened in between request and callback
                if (state.aborted) return;

                // pass back to item so we can use it if something goes wrong
                transfer(serverId);

                // store internally
                state.serverId = serverId;
                processChunks();
            });
        } else {
            requestTransferOffset(function(offset) {
                // stop here if aborted, might have happened in between request and callback
                if (state.aborted) return;

                // mark chunks with lower offset as complete
                chunks
                    .filter(function(chunk) {
                        return chunk.offset < offset;
                    })
                    .forEach(function(chunk) {
                        chunk.status = ChunkStatus.COMPLETE;
                        chunk.progress = chunk.size;
                    });

                // continue processing
                processChunks();
            });
        }

        return {
            abort: function abort() {
                state.aborted = true;
                abortChunks();
            },
        };
    };

    /*
                                                               function signature:
                                                                 (file, metadata, load, error, progress, abort) => {
                                                                   return {
                                                                   abort:() => {}
                                                                 }
                                                               }
                                                               */
    var createFileProcessorFunction = function createFileProcessorFunction(
        apiUrl,
        action,
        name,
        options
    ) {
        return function(file, metadata, load, error, progress, abort, transfer) {
            // no file received
            if (!file) return;

            // if was passed a file, and we can chunk it, exit here
            var canChunkUpload = options.chunkUploads;
            var shouldChunkUpload = canChunkUpload && file.size > options.chunkSize;
            var willChunkUpload = canChunkUpload && (shouldChunkUpload || options.chunkForce);
            if (file instanceof Blob && willChunkUpload)
                return processFileChunked(
                    apiUrl,
                    action,
                    name,
                    file,
                    metadata,
                    load,
                    error,
                    progress,
                    abort,
                    transfer,
                    options
                );

            // set handlers
            var ondata =
                action.ondata ||
                function(fd) {
                    return fd;
                };
            var onload =
                action.onload ||
                function(res) {
                    return res;
                };
            var onerror =
                action.onerror ||
                function(res) {
                    return null;
                };

            var headers =
                typeof action.headers === 'function'
                    ? action.headers(file, metadata) || {}
                    : Object.assign(
                          {},

                          action.headers
                      );

            var requestParams = Object.assign({}, action, {
                headers: headers,
            });

            // create formdata object
            var formData = new FormData();

            // add metadata under same name
            if (isObject(metadata)) {
                formData.append(name, JSON.stringify(metadata));
            }

            // Turn into an array of objects so no matter what the input, we can handle it the same way
            (file instanceof Blob ? [{ name: null, file: file }] : file).forEach(function(item) {
                formData.append(
                    name,
                    item.file,
                    item.name === null ? item.file.name : '' + item.name + item.file.name
                );
            });

            // send request object
            var request = sendRequest(
                ondata(formData),
                buildURL(apiUrl, action.url),
                requestParams
            );
            request.onload = function(xhr) {
                load(
                    createResponse(
                        'load',
                        xhr.status,
                        onload(xhr.response),
                        xhr.getAllResponseHeaders()
                    )
                );
            };

            request.onerror = function(xhr) {
                error(
                    createResponse(
                        'error',
                        xhr.status,
                        onerror(xhr.response) || xhr.statusText,
                        xhr.getAllResponseHeaders()
                    )
                );
            };

            request.ontimeout = createTimeoutResponse(error);
            request.onprogress = progress;
            request.onabort = abort;

            // should return request
            return request;
        };
    };

    var createProcessorFunction = function createProcessorFunction() {
        var apiUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
        var action = arguments.length > 1 ? arguments[1] : undefined;
        var name = arguments.length > 2 ? arguments[2] : undefined;
        var options = arguments.length > 3 ? arguments[3] : undefined;

        // custom handler (should also handle file, load, error, progress and abort)
        if (typeof action === 'function')
            return function() {
                for (
                    var _len = arguments.length, params = new Array(_len), _key = 0;
                    _key < _len;
                    _key++
                ) {
                    params[_key] = arguments[_key];
                }
                return action.apply(void 0, [name].concat(params, [options]));
            };

        // no action supplied
        if (!action || !isString(action.url)) return null;

        // internal handler
        return createFileProcessorFunction(apiUrl, action, name, options);
    };

    /*
                                                      function signature:
                                                      (uniqueFileId, load, error) => { }
                                                      */
    var createRevertFunction = function createRevertFunction() {
        var apiUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
        var action = arguments.length > 1 ? arguments[1] : undefined;
        // is custom implementation
        if (typeof action === 'function') {
            return action;
        }

        // no action supplied, return stub function, interface will work, but file won't be removed
        if (!action || !isString(action.url)) {
            return function(uniqueFileId, load) {
                return load();
            };
        }

        // set onload hanlder
        var onload =
            action.onload ||
            function(res) {
                return res;
            };
        var onerror =
            action.onerror ||
            function(res) {
                return null;
            };

        // internal implementation
        return function(uniqueFileId, load, error) {
            var request = sendRequest(
                uniqueFileId,
                apiUrl + action.url,
                action // contains method, headers and withCredentials properties
            );
            request.onload = function(xhr) {
                load(
                    createResponse(
                        'load',
                        xhr.status,
                        onload(xhr.response),
                        xhr.getAllResponseHeaders()
                    )
                );
            };

            request.onerror = function(xhr) {
                error(
                    createResponse(
                        'error',
                        xhr.status,
                        onerror(xhr.response) || xhr.statusText,
                        xhr.getAllResponseHeaders()
                    )
                );
            };

            request.ontimeout = createTimeoutResponse(error);

            return request;
        };
    };

    var getRandomNumber = function getRandomNumber() {
        var min = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
        var max = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
        return min + Math.random() * (max - min);
    };

    var createPerceivedPerformanceUpdater = function createPerceivedPerformanceUpdater(cb) {
        var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1000;
        var offset = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
        var tickMin = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 25;
        var tickMax = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 250;
        var timeout = null;
        var start = Date.now();

        var tick = function tick() {
            var runtime = Date.now() - start;
            var delay = getRandomNumber(tickMin, tickMax);

            if (runtime + delay > duration) {
                delay = runtime + delay - duration;
            }

            var progress = runtime / duration;
            if (progress >= 1 || document.hidden) {
                cb(1);
                return;
            }

            cb(progress);

            timeout = setTimeout(tick, delay);
        };

        if (duration > 0) tick();

        return {
            clear: function clear() {
                clearTimeout(timeout);
            },
        };
    };

    var createFileProcessor = function createFileProcessor(processFn, options) {
        var state = {
            complete: false,
            perceivedProgress: 0,
            perceivedPerformanceUpdater: null,
            progress: null,
            timestamp: null,
            perceivedDuration: 0,
            duration: 0,
            request: null,
            response: null,
        };
        var allowMinimumUploadDuration = options.allowMinimumUploadDuration;

        var process = function process(file, metadata) {
            var progressFn = function progressFn() {
                // we've not yet started the real download, stop here
                // the request might not go through, for instance, there might be some server trouble
                // if state.progress is null, the server does not allow computing progress and we show the spinner instead
                if (state.duration === 0 || state.progress === null) return;

                // as we're now processing, fire the progress event
                api.fire('progress', api.getProgress());
            };

            var completeFn = function completeFn() {
                state.complete = true;
                api.fire('load-perceived', state.response.body);
            };

            // let's start processing
            api.fire('start');

            // set request start
            state.timestamp = Date.now();

            // create perceived performance progress indicator
            state.perceivedPerformanceUpdater = createPerceivedPerformanceUpdater(
                function(progress) {
                    state.perceivedProgress = progress;
                    state.perceivedDuration = Date.now() - state.timestamp;

                    progressFn();

                    // if fake progress is done, and a response has been received,
                    // and we've not yet called the complete method
                    if (state.response && state.perceivedProgress === 1 && !state.complete) {
                        // we done!
                        completeFn();
                    }
                },
                // random delay as in a list of files you start noticing
                // files uploading at the exact same speed
                allowMinimumUploadDuration ? getRandomNumber(750, 1500) : 0
            );

            // remember request so we can abort it later
            state.request = processFn(
                // the file to process
                file,

                // the metadata to send along
                metadata,

                // callbacks (load, error, progress, abort, transfer)
                // load expects the body to be a server id if
                // you want to make use of revert
                function(response) {
                    // we put the response in state so we can access
                    // it outside of this method
                    state.response = isObject(response)
                        ? response
                        : {
                              type: 'load',
                              code: 200,
                              body: '' + response,
                              headers: {},
                          };

                    // update duration
                    state.duration = Date.now() - state.timestamp;

                    // force progress to 1 as we're now done
                    state.progress = 1;

                    // actual load is done let's share results
                    api.fire('load', state.response.body);

                    // we are really done
                    // if perceived progress is 1 ( wait for perceived progress to complete )
                    // or if server does not support progress ( null )
                    if (
                        !allowMinimumUploadDuration ||
                        (allowMinimumUploadDuration && state.perceivedProgress === 1)
                    ) {
                        completeFn();
                    }
                },

                // error is expected to be an object with type, code, body
                function(error) {
                    // cancel updater
                    state.perceivedPerformanceUpdater.clear();

                    // update others about this error
                    api.fire(
                        'error',
                        isObject(error)
                            ? error
                            : {
                                  type: 'error',
                                  code: 0,
                                  body: '' + error,
                              }
                    );
                },

                // actual processing progress
                function(computable, current, total) {
                    // update actual duration
                    state.duration = Date.now() - state.timestamp;

                    // update actual progress
                    state.progress = computable ? current / total : null;

                    progressFn();
                },

                // abort does not expect a value
                function() {
                    // stop updater
                    state.perceivedPerformanceUpdater.clear();

                    // fire the abort event so we can switch visuals
                    api.fire('abort', state.response ? state.response.body : null);
                },

                // register the id for this transfer
                function(transferId) {
                    api.fire('transfer', transferId);
                }
            );
        };

        var abort = function abort() {
            // no request running, can't abort
            if (!state.request) return;

            // stop updater
            state.perceivedPerformanceUpdater.clear();

            // abort actual request
            if (state.request.abort) state.request.abort();

            // if has response object, we've completed the request
            state.complete = true;
        };

        var reset = function reset() {
            abort();
            state.complete = false;
            state.perceivedProgress = 0;
            state.progress = 0;
            state.timestamp = null;
            state.perceivedDuration = 0;
            state.duration = 0;
            state.request = null;
            state.response = null;
        };

        var getProgress = allowMinimumUploadDuration
            ? function() {
                  return state.progress ? Math.min(state.progress, state.perceivedProgress) : null;
              }
            : function() {
                  return state.progress || null;
              };

        var getDuration = allowMinimumUploadDuration
            ? function() {
                  return Math.min(state.duration, state.perceivedDuration);
              }
            : function() {
                  return state.duration;
              };

        var api = Object.assign({}, on(), {
            process: process, // start processing file
            abort: abort, // abort active process request
            getProgress: getProgress,
            getDuration: getDuration,
            reset: reset,
        });

        return api;
    };

    var getFilenameWithoutExtension = function getFilenameWithoutExtension(name) {
        return name.substring(0, name.lastIndexOf('.')) || name;
    };

    var createFileStub = function createFileStub(source) {
        var data = [source.name, source.size, source.type];

        // is blob or base64, then we need to set the name
        if (source instanceof Blob || isBase64DataURI(source)) {
            data[0] = source.name || getDateString();
        } else if (isBase64DataURI(source)) {
            // if is base64 data uri we need to determine the average size and type
            data[1] = source.length;
            data[2] = getMimeTypeFromBase64DataURI(source);
        } else if (isString(source)) {
            // url
            data[0] = getFilenameFromURL(source);
            data[1] = 0;
            data[2] = 'application/octet-stream';
        }

        return {
            name: data[0],
            size: data[1],
            type: data[2],
        };
    };

    var isFile = function isFile(value) {
        return !!(value instanceof File || (value instanceof Blob && value.name));
    };

    var deepCloneObject = function deepCloneObject(src) {
        if (!isObject(src)) return src;
        var target = isArray(src) ? [] : {};
        for (var key in src) {
            if (!src.hasOwnProperty(key)) continue;
            var v = src[key];
            target[key] = v && isObject(v) ? deepCloneObject(v) : v;
        }
        return target;
    };

    var createItem = function createItem() {
        var origin = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
        var serverFileReference =
            arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
        var file = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
        // unique id for this item, is used to identify the item across views
        var id = getUniqueId();

        /**
         * Internal item state
         */
        var state = {
            // is archived
            archived: false,

            // if is frozen, no longer fires events
            frozen: false,

            // removed from view
            released: false,

            // original source
            source: null,

            // file model reference
            file: file,

            // id of file on server
            serverFileReference: serverFileReference,

            // id of file transfer on server
            transferId: null,

            // is aborted
            processingAborted: false,

            // current item status
            status: serverFileReference ? ItemStatus.PROCESSING_COMPLETE : ItemStatus.INIT,

            // active processes
            activeLoader: null,
            activeProcessor: null,
        };

        // callback used when abort processing is called to link back to the resolve method
        var abortProcessingRequestComplete = null;

        /**
         * Externally added item metadata
         */
        var metadata = {};

        // item data
        var setStatus = function setStatus(status) {
            return (state.status = status);
        };

        // fire event unless the item has been archived
        var fire = function fire(event) {
            if (state.released || state.frozen) return;
            for (
                var _len = arguments.length, params = new Array(_len > 1 ? _len - 1 : 0), _key = 1;
                _key < _len;
                _key++
            ) {
                params[_key - 1] = arguments[_key];
            }
            api.fire.apply(api, [event].concat(params));
        };

        // file data
        var getFileExtension = function getFileExtension() {
            return getExtensionFromFilename(state.file.name);
        };
        var getFileType = function getFileType() {
            return state.file.type;
        };
        var getFileSize = function getFileSize() {
            return state.file.size;
        };
        var getFile = function getFile() {
            return state.file;
        };

        //
        // logic to load a file
        //
        var load = function load(source, loader, onload) {
            // remember the original item source
            state.source = source;

            // source is known
            api.fireSync('init');

            // file stub is already there
            if (state.file) {
                api.fireSync('load-skip');
                return;
            }

            // set a stub file object while loading the actual data
            state.file = createFileStub(source);

            // starts loading
            loader.on('init', function() {
                fire('load-init');
            });

            // we'eve received a size indication, let's update the stub
            loader.on('meta', function(meta) {
                // set size of file stub
                state.file.size = meta.size;

                // set name of file stub
                state.file.filename = meta.filename;

                // if has received source, we done
                if (meta.source) {
                    origin = FileOrigin.LIMBO;
                    state.serverFileReference = meta.source;
                    state.status = ItemStatus.PROCESSING_COMPLETE;
                }

                // size has been updated
                fire('load-meta');
            });

            // the file is now loading we need to update the progress indicators
            loader.on('progress', function(progress) {
                setStatus(ItemStatus.LOADING);

                fire('load-progress', progress);
            });

            // an error was thrown while loading the file, we need to switch to error state
            loader.on('error', function(error) {
                setStatus(ItemStatus.LOAD_ERROR);

                fire('load-request-error', error);
            });

            // user or another process aborted the file load (cannot retry)
            loader.on('abort', function() {
                setStatus(ItemStatus.INIT);
                fire('load-abort');
            });

            // done loading
            loader.on('load', function(file) {
                // as we've now loaded the file the loader is no longer required
                state.activeLoader = null;

                // called when file has loaded succesfully
                var success = function success(result) {
                    // set (possibly) transformed file
                    state.file = isFile(result) ? result : state.file;

                    // file received
                    if (origin === FileOrigin.LIMBO && state.serverFileReference) {
                        setStatus(ItemStatus.PROCESSING_COMPLETE);
                    } else {
                        setStatus(ItemStatus.IDLE);
                    }

                    fire('load');
                };

                var error = function error(result) {
                    // set original file
                    state.file = file;
                    fire('load-meta');

                    setStatus(ItemStatus.LOAD_ERROR);
                    fire('load-file-error', result);
                };

                // if we already have a server file reference, we don't need to call the onload method
                if (state.serverFileReference) {
                    success(file);
                    return;
                }

                // no server id, let's give this file the full treatment
                onload(file, success, error);
            });

            // set loader source data
            loader.setSource(source);

            // set as active loader
            state.activeLoader = loader;

            // load the source data
            loader.load();
        };

        var retryLoad = function retryLoad() {
            if (!state.activeLoader) {
                return;
            }
            state.activeLoader.load();
        };

        var abortLoad = function abortLoad() {
            if (state.activeLoader) {
                state.activeLoader.abort();
                return;
            }
            setStatus(ItemStatus.INIT);
            fire('load-abort');
        };

        //
        // logic to process a file
        //
        var process = function process(processor, onprocess) {
            // processing was aborted
            if (state.processingAborted) {
                state.processingAborted = false;
                return;
            }

            // now processing
            setStatus(ItemStatus.PROCESSING);

            // reset abort callback
            abortProcessingRequestComplete = null;

            // if no file loaded we'll wait for the load event
            if (!(state.file instanceof Blob)) {
                api.on('load', function() {
                    process(processor, onprocess);
                });
                return;
            }

            // setup processor
            processor.on('load', function(serverFileReference) {
                // need this id to be able to revert the upload
                state.transferId = null;
                state.serverFileReference = serverFileReference;
            });

            // register transfer id
            processor.on('transfer', function(transferId) {
                // need this id to be able to revert the upload
                state.transferId = transferId;
            });

            processor.on('load-perceived', function(serverFileReference) {
                // no longer required
                state.activeProcessor = null;

                // need this id to be able to rever the upload
                state.transferId = null;
                state.serverFileReference = serverFileReference;

                setStatus(ItemStatus.PROCESSING_COMPLETE);
                fire('process-complete', serverFileReference);
            });

            processor.on('start', function() {
                fire('process-start');
            });

            processor.on('error', function(error) {
                state.activeProcessor = null;
                setStatus(ItemStatus.PROCESSING_ERROR);
                fire('process-error', error);
            });

            processor.on('abort', function(serverFileReference) {
                state.activeProcessor = null;

                // if file was uploaded but processing was cancelled during perceived processor time store file reference
                state.serverFileReference = serverFileReference;

                setStatus(ItemStatus.IDLE);
                fire('process-abort');

                // has timeout so doesn't interfere with remove action
                if (abortProcessingRequestComplete) {
                    abortProcessingRequestComplete();
                }
            });

            processor.on('progress', function(progress) {
                fire('process-progress', progress);
            });

            // when successfully transformed
            var success = function success(file) {
                // if was archived in the mean time, don't process
                if (state.archived) return;

                // process file!
                processor.process(file, Object.assign({}, metadata));
            };

            // something went wrong during transform phase
            var error = console.error;

            // start processing the file
            onprocess(state.file, success, error);

            // set as active processor
            state.activeProcessor = processor;
        };

        var requestProcessing = function requestProcessing() {
            state.processingAborted = false;
            setStatus(ItemStatus.PROCESSING_QUEUED);
        };

        var abortProcessing = function abortProcessing() {
            return new Promise(function(resolve) {
                if (!state.activeProcessor) {
                    state.processingAborted = true;

                    setStatus(ItemStatus.IDLE);
                    fire('process-abort');

                    resolve();
                    return;
                }

                abortProcessingRequestComplete = function abortProcessingRequestComplete() {
                    resolve();
                };

                state.activeProcessor.abort();
            });
        };

        //
        // logic to revert a processed file
        //
        var revert = function revert(revertFileUpload, forceRevert) {
            return new Promise(function(resolve, reject) {
                // a completed upload will have a serverFileReference, a failed chunked upload where
                // getting a serverId succeeded but >=0 chunks have been uploaded will have transferId set
                var serverTransferId =
                    state.serverFileReference !== null
                        ? state.serverFileReference
                        : state.transferId;

                // cannot revert without a server id for this process
                if (serverTransferId === null) {
                    resolve();
                    return;
                }

                // revert the upload (fire and forget)
                revertFileUpload(
                    serverTransferId,
                    function() {
                        // reset file server id and transfer id as now it's not available on the server
                        state.serverFileReference = null;
                        state.transferId = null;
                        resolve();
                    },
                    function(error) {
                        // don't set error state when reverting is optional, it will always resolve
                        if (!forceRevert) {
                            resolve();
                            return;
                        }

                        // oh no errors
                        setStatus(ItemStatus.PROCESSING_REVERT_ERROR);
                        fire('process-revert-error');
                        reject(error);
                    }
                );

                // fire event
                setStatus(ItemStatus.IDLE);
                fire('process-revert');
            });
        };

        // exposed methods
        var _setMetadata = function setMetadata(key, value, silent) {
            var keys = key.split('.');
            var root = keys[0];
            var last = keys.pop();
            var data = metadata;
            keys.forEach(function(key) {
                return (data = data[key]);
            });

            // compare old value against new value, if they're the same, we're not updating
            if (JSON.stringify(data[last]) === JSON.stringify(value)) return;

            // update value
            data[last] = value;

            // fire update
            fire('metadata-update', {
                key: root,
                value: metadata[root],
                silent: silent,
            });
        };

        var getMetadata = function getMetadata(key) {
            return deepCloneObject(key ? metadata[key] : metadata);
        };

        var api = Object.assign(
            {
                id: {
                    get: function get() {
                        return id;
                    },
                },
                origin: {
                    get: function get() {
                        return origin;
                    },
                    set: function set(value) {
                        return (origin = value);
                    },
                },
                serverId: {
                    get: function get() {
                        return state.serverFileReference;
                    },
                },
                transferId: {
                    get: function get() {
                        return state.transferId;
                    },
                },
                status: {
                    get: function get() {
                        return state.status;
                    },
                },
                filename: {
                    get: function get() {
                        return state.file.name;
                    },
                },
                filenameWithoutExtension: {
                    get: function get() {
                        return getFilenameWithoutExtension(state.file.name);
                    },
                },
                fileExtension: { get: getFileExtension },
                fileType: { get: getFileType },
                fileSize: { get: getFileSize },
                file: { get: getFile },
                relativePath: {
                    get: function get() {
                        return state.file._relativePath;
                    },
                },

                source: {
                    get: function get() {
                        return state.source;
                    },
                },

                getMetadata: getMetadata,
                setMetadata: function setMetadata(key, value, silent) {
                    if (isObject(key)) {
                        var data = key;
                        Object.keys(data).forEach(function(key) {
                            _setMetadata(key, data[key], value);
                        });
                        return key;
                    }
                    _setMetadata(key, value, silent);
                    return value;
                },

                extend: function extend(name, handler) {
                    return (itemAPI[name] = handler);
                },

                abortLoad: abortLoad,
                retryLoad: retryLoad,
                requestProcessing: requestProcessing,
                abortProcessing: abortProcessing,

                load: load,
                process: process,
                revert: revert,
            },

            on(),
            {
                freeze: function freeze() {
                    return (state.frozen = true);
                },

                release: function release() {
                    return (state.released = true);
                },
                released: {
                    get: function get() {
                        return state.released;
                    },
                },

                archive: function archive() {
                    return (state.archived = true);
                },
                archived: {
                    get: function get() {
                        return state.archived;
                    },
                },
            }
        );

        // create it here instead of returning it instantly so we can extend it later
        var itemAPI = createObject(api);

        return itemAPI;
    };

    var getItemIndexByQuery = function getItemIndexByQuery(items, query) {
        // just return first index
        if (isEmpty(query)) {
            return 0;
        }

        // invalid queries
        if (!isString(query)) {
            return -1;
        }

        // return item by id (or -1 if not found)
        return items.findIndex(function(item) {
            return item.id === query;
        });
    };

    var getItemById = function getItemById(items, itemId) {
        var index = getItemIndexByQuery(items, itemId);
        if (index < 0) {
            return;
        }
        return items[index] || null;
    };

    var fetchBlob = function fetchBlob(url, load, error, progress, abort, headers) {
        var request = sendRequest(null, url, {
            method: 'GET',
            responseType: 'blob',
        });

        request.onload = function(xhr) {
            // get headers
            var headers = xhr.getAllResponseHeaders();

            // get filename
            var filename = getFileInfoFromHeaders(headers).name || getFilenameFromURL(url);

            // create response
            load(
                createResponse('load', xhr.status, getFileFromBlob(xhr.response, filename), headers)
            );
        };

        request.onerror = function(xhr) {
            error(createResponse('error', xhr.status, xhr.statusText, xhr.getAllResponseHeaders()));
        };

        request.onheaders = function(xhr) {
            headers(createResponse('headers', xhr.status, null, xhr.getAllResponseHeaders()));
        };

        request.ontimeout = createTimeoutResponse(error);
        request.onprogress = progress;
        request.onabort = abort;

        // should return request
        return request;
    };

    var getDomainFromURL = function getDomainFromURL(url) {
        if (url.indexOf('//') === 0) {
            url = location.protocol + url;
        }
        return url
            .toLowerCase()
            .replace('blob:', '')
            .replace(/([a-z])?:\/\//, '$1')
            .split('/')[0];
    };

    var isExternalURL = function isExternalURL(url) {
        return (
            (url.indexOf(':') > -1 || url.indexOf('//') > -1) &&
            getDomainFromURL(location.href) !== getDomainFromURL(url)
        );
    };

    var dynamicLabel = function dynamicLabel(label) {
        return function() {
            return isFunction(label) ? label.apply(void 0, arguments) : label;
        };
    };

    var isMockItem = function isMockItem(item) {
        return !isFile(item.file);
    };

    var listUpdated = function listUpdated(dispatch, state) {
        clearTimeout(state.listUpdateTimeout);
        state.listUpdateTimeout = setTimeout(function() {
            dispatch('DID_UPDATE_ITEMS', { items: getActiveItems(state.items) });
        }, 0);
    };

    var optionalPromise = function optionalPromise(fn) {
        for (
            var _len = arguments.length, params = new Array(_len > 1 ? _len - 1 : 0), _key = 1;
            _key < _len;
            _key++
        ) {
            params[_key - 1] = arguments[_key];
        }
        return new Promise(function(resolve) {
            if (!fn) {
                return resolve(true);
            }

            var result = fn.apply(void 0, params);

            if (result == null) {
                return resolve(true);
            }

            if (typeof result === 'boolean') {
                return resolve(result);
            }

            if (typeof result.then === 'function') {
                result.then(resolve);
            }
        });
    };

    var sortItems = function sortItems(state, compare) {
        state.items.sort(function(a, b) {
            return compare(createItemAPI(a), createItemAPI(b));
        });
    };

    // returns item based on state
    var getItemByQueryFromState = function getItemByQueryFromState(state, itemHandler) {
        return function() {
            var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
            var query = _ref.query,
                _ref$success = _ref.success,
                success = _ref$success === void 0 ? function() {} : _ref$success,
                _ref$failure = _ref.failure,
                failure = _ref$failure === void 0 ? function() {} : _ref$failure,
                options = _objectWithoutProperties(_ref, ['query', 'success', 'failure']);
            var item = getItemByQuery(state.items, query);
            if (!item) {
                failure({
                    error: createResponse('error', 0, 'Item not found'),
                    file: null,
                });

                return;
            }
            itemHandler(item, success, failure, options || {});
        };
    };

    var actions = function actions(dispatch, query, state) {
        return {
            /**
             * Aborts all ongoing processes
             */
            ABORT_ALL: function ABORT_ALL() {
                getActiveItems(state.items).forEach(function(item) {
                    item.freeze();
                    item.abortLoad();
                    item.abortProcessing();
                });
            },

            /**
             * Sets initial files
             */
            DID_SET_FILES: function DID_SET_FILES(_ref2) {
                var _ref2$value = _ref2.value,
                    value = _ref2$value === void 0 ? [] : _ref2$value;
                // map values to file objects
                var files = value.map(function(file) {
                    return {
                        source: file.source ? file.source : file,
                        options: file.options,
                    };
                });

                // loop over files, if file is in list, leave it be, if not, remove
                // test if items should be moved
                var activeItems = getActiveItems(state.items);

                activeItems.forEach(function(item) {
                    // if item not is in new value, remove
                    if (
                        !files.find(function(file) {
                            return file.source === item.source || file.source === item.file;
                        })
                    ) {
                        dispatch('REMOVE_ITEM', { query: item, remove: false });
                    }
                });

                // add new files
                activeItems = getActiveItems(state.items);
                files.forEach(function(file, index) {
                    // if file is already in list
                    if (
                        activeItems.find(function(item) {
                            return item.source === file.source || item.file === file.source;
                        })
                    )
                        return;

                    // not in list, add
                    dispatch(
                        'ADD_ITEM',
                        Object.assign({}, file, {
                            interactionMethod: InteractionMethod.NONE,
                            index: index,
                        })
                    );
                });
            },

            DID_UPDATE_ITEM_METADATA: function DID_UPDATE_ITEM_METADATA(_ref3) {
                var id = _ref3.id,
                    action = _ref3.action,
                    change = _ref3.change;
                // don't do anything
                if (change.silent) return;

                // if is called multiple times in close succession we combined all calls together to save resources
                clearTimeout(state.itemUpdateTimeout);
                state.itemUpdateTimeout = setTimeout(function() {
                    var item = getItemById(state.items, id);

                    // only revert and attempt to upload when we're uploading to a server
                    if (!query('IS_ASYNC')) {
                        // should we update the output data
                        applyFilterChain('SHOULD_PREPARE_OUTPUT', false, {
                            item: item,
                            query: query,
                            action: action,
                            change: change,
                        }).then(function(shouldPrepareOutput) {
                            // plugins determined the output data should be prepared (or not), can be adjusted with beforePrepareOutput hook
                            var beforePrepareFile = query('GET_BEFORE_PREPARE_FILE');
                            if (beforePrepareFile)
                                shouldPrepareOutput = beforePrepareFile(item, shouldPrepareOutput);

                            if (!shouldPrepareOutput) return;

                            dispatch(
                                'REQUEST_PREPARE_OUTPUT',
                                {
                                    query: id,
                                    item: item,
                                    success: function success(file) {
                                        dispatch('DID_PREPARE_OUTPUT', { id: id, file: file });
                                    },
                                },

                                true
                            );
                        });

                        return;
                    }

                    // if is local item we need to enable upload button so change can be propagated to server
                    if (item.origin === FileOrigin.LOCAL) {
                        dispatch('DID_LOAD_ITEM', {
                            id: item.id,
                            error: null,
                            serverFileReference: item.source,
                        });
                    }

                    // for async scenarios
                    var upload = function upload() {
                        // we push this forward a bit so the interface is updated correctly
                        setTimeout(function() {
                            dispatch('REQUEST_ITEM_PROCESSING', { query: id });
                        }, 32);
                    };

                    var revert = function revert(doUpload) {
                        item.revert(
                            createRevertFunction(
                                state.options.server.url,
                                state.options.server.revert
                            ),
                            query('GET_FORCE_REVERT')
                        )
                            .then(doUpload ? upload : function() {})
                            .catch(function() {});
                    };

                    var abort = function abort(doUpload) {
                        item.abortProcessing().then(doUpload ? upload : function() {});
                    };

                    // if we should re-upload the file immediately
                    if (item.status === ItemStatus.PROCESSING_COMPLETE) {
                        return revert(state.options.instantUpload);
                    }

                    // if currently uploading, cancel upload
                    if (item.status === ItemStatus.PROCESSING) {
                        return abort(state.options.instantUpload);
                    }

                    if (state.options.instantUpload) {
                        upload();
                    }
                }, 0);
            },

            MOVE_ITEM: function MOVE_ITEM(_ref4) {
                var query = _ref4.query,
                    index = _ref4.index;
                var item = getItemByQuery(state.items, query);
                if (!item) return;
                var currentIndex = state.items.indexOf(item);
                index = limit(index, 0, state.items.length - 1);
                if (currentIndex === index) return;
                state.items.splice(index, 0, state.items.splice(currentIndex, 1)[0]);
            },

            SORT: function SORT(_ref5) {
                var compare = _ref5.compare;
                sortItems(state, compare);
                dispatch('DID_SORT_ITEMS', {
                    items: query('GET_ACTIVE_ITEMS'),
                });
            },

            ADD_ITEMS: function ADD_ITEMS(_ref6) {
                var items = _ref6.items,
                    index = _ref6.index,
                    interactionMethod = _ref6.interactionMethod,
                    _ref6$success = _ref6.success,
                    success = _ref6$success === void 0 ? function() {} : _ref6$success,
                    _ref6$failure = _ref6.failure,
                    failure = _ref6$failure === void 0 ? function() {} : _ref6$failure;
                var currentIndex = index;

                if (index === -1 || typeof index === 'undefined') {
                    var insertLocation = query('GET_ITEM_INSERT_LOCATION');
                    var totalItems = query('GET_TOTAL_ITEMS');
                    currentIndex = insertLocation === 'before' ? 0 : totalItems;
                }

                var ignoredFiles = query('GET_IGNORED_FILES');
                var isValidFile = function isValidFile(source) {
                    return isFile(source)
                        ? !ignoredFiles.includes(source.name.toLowerCase())
                        : !isEmpty(source);
                };
                var validItems = items.filter(isValidFile);

                var promises = validItems.map(function(source) {
                    return new Promise(function(resolve, reject) {
                        dispatch('ADD_ITEM', {
                            interactionMethod: interactionMethod,
                            source: source.source || source,
                            success: resolve,
                            failure: reject,
                            index: currentIndex++,
                            options: source.options || {},
                        });
                    });
                });

                Promise.all(promises)
                    .then(success)
                    .catch(failure);
            },

            /**
             * @param source
             * @param index
             * @param interactionMethod
             */
            ADD_ITEM: function ADD_ITEM(_ref7) {
                var source = _ref7.source,
                    _ref7$index = _ref7.index,
                    index = _ref7$index === void 0 ? -1 : _ref7$index,
                    interactionMethod = _ref7.interactionMethod,
                    _ref7$success = _ref7.success,
                    success = _ref7$success === void 0 ? function() {} : _ref7$success,
                    _ref7$failure = _ref7.failure,
                    failure = _ref7$failure === void 0 ? function() {} : _ref7$failure,
                    _ref7$options = _ref7.options,
                    options = _ref7$options === void 0 ? {} : _ref7$options;
                // if no source supplied
                if (isEmpty(source)) {
                    failure({
                        error: createResponse('error', 0, 'No source'),
                        file: null,
                    });

                    return;
                }

                // filter out invalid file items, used to filter dropped directory contents
                if (
                    isFile(source) &&
                    state.options.ignoredFiles.includes(source.name.toLowerCase())
                ) {
                    // fail silently
                    return;
                }

                // test if there's still room in the list of files
                if (!hasRoomForItem(state)) {
                    // if multiple allowed, we can't replace
                    // or if only a single item is allowed but we're not allowed to replace it we exit
                    if (
                        state.options.allowMultiple ||
                        (!state.options.allowMultiple && !state.options.allowReplace)
                    ) {
                        var error = createResponse('warning', 0, 'Max files');

                        dispatch('DID_THROW_MAX_FILES', {
                            source: source,
                            error: error,
                        });

                        failure({ error: error, file: null });

                        return;
                    }

                    // let's replace the item
                    // id of first item we're about to remove
                    var _item = getActiveItems(state.items)[0];

                    // if has been processed remove it from the server as well
                    if (
                        _item.status === ItemStatus.PROCESSING_COMPLETE ||
                        _item.status === ItemStatus.PROCESSING_REVERT_ERROR
                    ) {
                        var forceRevert = query('GET_FORCE_REVERT');
                        _item
                            .revert(
                                createRevertFunction(
                                    state.options.server.url,
                                    state.options.server.revert
                                ),
                                forceRevert
                            )
                            .then(function() {
                                if (!forceRevert) return;

                                // try to add now
                                dispatch('ADD_ITEM', {
                                    source: source,
                                    index: index,
                                    interactionMethod: interactionMethod,
                                    success: success,
                                    failure: failure,
                                    options: options,
                                });
                            })
                            .catch(function() {}); // no need to handle this catch state for now

                        if (forceRevert) return;
                    }

                    // remove first item as it will be replaced by this item
                    dispatch('REMOVE_ITEM', { query: _item.id });
                }

                // where did the file originate
                var origin =
                    options.type === 'local'
                        ? FileOrigin.LOCAL
                        : options.type === 'limbo'
                        ? FileOrigin.LIMBO
                        : FileOrigin.INPUT;

                // create a new blank item
                var item = createItem(
                    // where did this file come from
                    origin,

                    // an input file never has a server file reference
                    origin === FileOrigin.INPUT ? null : source,

                    // file mock data, if defined
                    options.file
                );

                // set initial meta data
                Object.keys(options.metadata || {}).forEach(function(key) {
                    item.setMetadata(key, options.metadata[key]);
                });

                // created the item, let plugins add methods
                applyFilters('DID_CREATE_ITEM', item, { query: query, dispatch: dispatch });

                // where to insert new items
                var itemInsertLocation = query('GET_ITEM_INSERT_LOCATION');

                // adjust index if is not allowed to pick location
                if (!state.options.itemInsertLocationFreedom) {
                    index = itemInsertLocation === 'before' ? -1 : state.items.length;
                }

                // add item to list
                insertItem(state.items, item, index);

                // sort items in list
                if (isFunction(itemInsertLocation) && source) {
                    sortItems(state, itemInsertLocation);
                }

                // get a quick reference to the item id
                var id = item.id;

                // observe item events
                item.on('init', function() {
                    dispatch('DID_INIT_ITEM', { id: id });
                });

                item.on('load-init', function() {
                    dispatch('DID_START_ITEM_LOAD', { id: id });
                });

                item.on('load-meta', function() {
                    dispatch('DID_UPDATE_ITEM_META', { id: id });
                });

                item.on('load-progress', function(progress) {
                    dispatch('DID_UPDATE_ITEM_LOAD_PROGRESS', { id: id, progress: progress });
                });

                item.on('load-request-error', function(error) {
                    var mainStatus = dynamicLabel(state.options.labelFileLoadError)(error);

                    // is client error, no way to recover
                    if (error.code >= 400 && error.code < 500) {
                        dispatch('DID_THROW_ITEM_INVALID', {
                            id: id,
                            error: error,
                            status: {
                                main: mainStatus,
                                sub: error.code + ' (' + error.body + ')',
                            },
                        });

                        // reject the file so can be dealt with through API
                        failure({ error: error, file: createItemAPI(item) });
                        return;
                    }

                    // is possible server error, so might be possible to retry
                    dispatch('DID_THROW_ITEM_LOAD_ERROR', {
                        id: id,
                        error: error,
                        status: {
                            main: mainStatus,
                            sub: state.options.labelTapToRetry,
                        },
                    });
                });

                item.on('load-file-error', function(error) {
                    dispatch('DID_THROW_ITEM_INVALID', {
                        id: id,
                        error: error.status,
                        status: error.status,
                    });

                    failure({ error: error.status, file: createItemAPI(item) });
                });

                item.on('load-abort', function() {
                    dispatch('REMOVE_ITEM', { query: id });
                });

                item.on('load-skip', function() {
                    dispatch('COMPLETE_LOAD_ITEM', {
                        query: id,
                        item: item,
                        data: {
                            source: source,
                            success: success,
                        },
                    });
                });

                item.on('load', function() {
                    var handleAdd = function handleAdd(shouldAdd) {
                        // no should not add this file
                        if (!shouldAdd) {
                            dispatch('REMOVE_ITEM', {
                                query: id,
                            });

                            return;
                        }

                        // now interested in metadata updates
                        item.on('metadata-update', function(change) {
                            dispatch('DID_UPDATE_ITEM_METADATA', { id: id, change: change });
                        });

                        // let plugins decide if the output data should be prepared at this point
                        // means we'll do this and wait for idle state
                        applyFilterChain('SHOULD_PREPARE_OUTPUT', false, {
                            item: item,
                            query: query,
                        }).then(function(shouldPrepareOutput) {
                            // plugins determined the output data should be prepared (or not), can be adjusted with beforePrepareOutput hook
                            var beforePrepareFile = query('GET_BEFORE_PREPARE_FILE');
                            if (beforePrepareFile)
                                shouldPrepareOutput = beforePrepareFile(item, shouldPrepareOutput);

                            var loadComplete = function loadComplete() {
                                dispatch('COMPLETE_LOAD_ITEM', {
                                    query: id,
                                    item: item,
                                    data: {
                                        source: source,
                                        success: success,
                                    },
                                });

                                listUpdated(dispatch, state);
                            };

                            // exit
                            if (shouldPrepareOutput) {
                                // wait for idle state and then run PREPARE_OUTPUT
                                dispatch(
                                    'REQUEST_PREPARE_OUTPUT',
                                    {
                                        query: id,
                                        item: item,
                                        success: function success(file) {
                                            dispatch('DID_PREPARE_OUTPUT', { id: id, file: file });
                                            loadComplete();
                                        },
                                    },

                                    true
                                );

                                return;
                            }

                            loadComplete();
                        });
                    };

                    // item loaded, allow plugins to
                    // - read data (quickly)
                    // - add metadata
                    applyFilterChain('DID_LOAD_ITEM', item, { query: query, dispatch: dispatch })
                        .then(function() {
                            optionalPromise(query('GET_BEFORE_ADD_FILE'), createItemAPI(item)).then(
                                handleAdd
                            );
                        })
                        .catch(function(e) {
                            if (!e || !e.error || !e.status) return handleAdd(false);
                            dispatch('DID_THROW_ITEM_INVALID', {
                                id: id,
                                error: e.error,
                                status: e.status,
                            });
                        });
                });

                item.on('process-start', function() {
                    dispatch('DID_START_ITEM_PROCESSING', { id: id });
                });

                item.on('process-progress', function(progress) {
                    dispatch('DID_UPDATE_ITEM_PROCESS_PROGRESS', { id: id, progress: progress });
                });

                item.on('process-error', function(error) {
                    dispatch('DID_THROW_ITEM_PROCESSING_ERROR', {
                        id: id,
                        error: error,
                        status: {
                            main: dynamicLabel(state.options.labelFileProcessingError)(error),
                            sub: state.options.labelTapToRetry,
                        },
                    });
                });

                item.on('process-revert-error', function(error) {
                    dispatch('DID_THROW_ITEM_PROCESSING_REVERT_ERROR', {
                        id: id,
                        error: error,
                        status: {
                            main: dynamicLabel(state.options.labelFileProcessingRevertError)(error),
                            sub: state.options.labelTapToRetry,
                        },
                    });
                });

                item.on('process-complete', function(serverFileReference) {
                    dispatch('DID_COMPLETE_ITEM_PROCESSING', {
                        id: id,
                        error: null,
                        serverFileReference: serverFileReference,
                    });

                    dispatch('DID_DEFINE_VALUE', { id: id, value: serverFileReference });
                });

                item.on('process-abort', function() {
                    dispatch('DID_ABORT_ITEM_PROCESSING', { id: id });
                });

                item.on('process-revert', function() {
                    dispatch('DID_REVERT_ITEM_PROCESSING', { id: id });
                    dispatch('DID_DEFINE_VALUE', { id: id, value: null });
                });

                // let view know the item has been inserted
                dispatch('DID_ADD_ITEM', {
                    id: id,
                    index: index,
                    interactionMethod: interactionMethod,
                });

                listUpdated(dispatch, state);

                // start loading the source
                var _ref8 = state.options.server || {},
                    url = _ref8.url,
                    load = _ref8.load,
                    restore = _ref8.restore,
                    fetch = _ref8.fetch;

                item.load(
                    source,

                    // this creates a function that loads the file based on the type of file (string, base64, blob, file) and location of file (local, remote, limbo)
                    createFileLoader(
                        origin === FileOrigin.INPUT
                            ? // input, if is remote, see if should use custom fetch, else use default fetchBlob
                              isString(source) && isExternalURL(source)
                                ? fetch
                                    ? createFetchFunction(url, fetch)
                                    : fetchBlob // remote url
                                : fetchBlob // try to fetch url
                            : // limbo or local
                            origin === FileOrigin.LIMBO
                            ? createFetchFunction(url, restore) // limbo
                            : createFetchFunction(url, load) // local
                    ),

                    // called when the file is loaded so it can be piped through the filters
                    function(file, success, error) {
                        // let's process the file
                        applyFilterChain('LOAD_FILE', file, { query: query })
                            .then(success)
                            .catch(error);
                    }
                );
            },

            REQUEST_PREPARE_OUTPUT: function REQUEST_PREPARE_OUTPUT(_ref9) {
                var item = _ref9.item,
                    success = _ref9.success,
                    _ref9$failure = _ref9.failure,
                    failure = _ref9$failure === void 0 ? function() {} : _ref9$failure;
                // error response if item archived
                var err = {
                    error: createResponse('error', 0, 'Item not found'),
                    file: null,
                };

                // don't handle archived items, an item could have been archived (load aborted) while waiting to be prepared
                if (item.archived) return failure(err);

                // allow plugins to alter the file data
                applyFilterChain('PREPARE_OUTPUT', item.file, { query: query, item: item }).then(
                    function(result) {
                        applyFilterChain('COMPLETE_PREPARE_OUTPUT', result, {
                            query: query,
                            item: item,
                        }).then(function(result) {
                            // don't handle archived items, an item could have been archived (load aborted) while being prepared
                            if (item.archived) return failure(err);

                            // we done!
                            success(result);
                        });
                    }
                );
            },

            COMPLETE_LOAD_ITEM: function COMPLETE_LOAD_ITEM(_ref10) {
                var item = _ref10.item,
                    data = _ref10.data;
                var success = data.success,
                    source = data.source;

                // sort items in list
                var itemInsertLocation = query('GET_ITEM_INSERT_LOCATION');
                if (isFunction(itemInsertLocation) && source) {
                    sortItems(state, itemInsertLocation);
                }

                // let interface know the item has loaded
                dispatch('DID_LOAD_ITEM', {
                    id: item.id,
                    error: null,
                    serverFileReference: item.origin === FileOrigin.INPUT ? null : source,
                });

                // item has been successfully loaded and added to the
                // list of items so can now be safely returned for use
                success(createItemAPI(item));

                // if this is a local server file we need to show a different state
                if (item.origin === FileOrigin.LOCAL) {
                    dispatch('DID_LOAD_LOCAL_ITEM', { id: item.id });
                    return;
                }

                // if is a temp server file we prevent async upload call here (as the file is already on the server)
                if (item.origin === FileOrigin.LIMBO) {
                    dispatch('DID_COMPLETE_ITEM_PROCESSING', {
                        id: item.id,
                        error: null,
                        serverFileReference: source,
                    });

                    dispatch('DID_DEFINE_VALUE', {
                        id: item.id,
                        value: item.serverId || source,
                    });

                    return;
                }

                // id we are allowed to upload the file immediately, lets do it
                if (query('IS_ASYNC') && state.options.instantUpload) {
                    dispatch('REQUEST_ITEM_PROCESSING', { query: item.id });
                }
            },

            RETRY_ITEM_LOAD: getItemByQueryFromState(state, function(item) {
                // try loading the source one more time
                item.retryLoad();
            }),

            REQUEST_ITEM_PREPARE: getItemByQueryFromState(state, function(item, _success, failure) {
                dispatch(
                    'REQUEST_PREPARE_OUTPUT',
                    {
                        query: item.id,
                        item: item,
                        success: function success(file) {
                            dispatch('DID_PREPARE_OUTPUT', { id: item.id, file: file });
                            _success({
                                file: item,
                                output: file,
                            });
                        },
                        failure: failure,
                    },

                    true
                );
            }),

            REQUEST_ITEM_PROCESSING: getItemByQueryFromState(state, function(
                item,
                success,
                failure
            ) {
                // cannot be queued (or is already queued)
                var itemCanBeQueuedForProcessing =
                    // waiting for something
                    item.status === ItemStatus.IDLE ||
                    // processing went wrong earlier
                    item.status === ItemStatus.PROCESSING_ERROR;

                // not ready to be processed
                if (!itemCanBeQueuedForProcessing) {
                    var processNow = function processNow() {
                        return dispatch('REQUEST_ITEM_PROCESSING', {
                            query: item,
                            success: success,
                            failure: failure,
                        });
                    };

                    var process = function process() {
                        return document.hidden ? processNow() : setTimeout(processNow, 32);
                    };

                    // if already done processing or tried to revert but didn't work, try again
                    if (
                        item.status === ItemStatus.PROCESSING_COMPLETE ||
                        item.status === ItemStatus.PROCESSING_REVERT_ERROR
                    ) {
                        item.revert(
                            createRevertFunction(
                                state.options.server.url,
                                state.options.server.revert
                            ),
                            query('GET_FORCE_REVERT')
                        )
                            .then(process)
                            .catch(function() {}); // don't continue with processing if something went wrong
                    } else if (item.status === ItemStatus.PROCESSING) {
                        item.abortProcessing().then(process);
                    }

                    return;
                }

                // already queued for processing
                if (item.status === ItemStatus.PROCESSING_QUEUED) return;

                item.requestProcessing();

                dispatch('DID_REQUEST_ITEM_PROCESSING', { id: item.id });

                dispatch('PROCESS_ITEM', { query: item, success: success, failure: failure }, true);
            }),

            PROCESS_ITEM: getItemByQueryFromState(state, function(item, success, failure) {
                var maxParallelUploads = query('GET_MAX_PARALLEL_UPLOADS');
                var totalCurrentUploads = query('GET_ITEMS_BY_STATUS', ItemStatus.PROCESSING)
                    .length;

                // queue and wait till queue is freed up
                if (totalCurrentUploads === maxParallelUploads) {
                    // queue for later processing
                    state.processingQueue.push({
                        id: item.id,
                        success: success,
                        failure: failure,
                    });

                    // stop it!
                    return;
                }

                // if was not queued or is already processing exit here
                if (item.status === ItemStatus.PROCESSING) return;

                var processNext = function processNext() {
                    // process queueud items
                    var queueEntry = state.processingQueue.shift();

                    // no items left
                    if (!queueEntry) return;

                    // get item reference
                    var id = queueEntry.id,
                        success = queueEntry.success,
                        failure = queueEntry.failure;
                    var itemReference = getItemByQuery(state.items, id);

                    // if item was archived while in queue, jump to next
                    if (!itemReference || itemReference.archived) {
                        processNext();
                        return;
                    }

                    // process queued item
                    dispatch(
                        'PROCESS_ITEM',
                        { query: id, success: success, failure: failure },
                        true
                    );
                };

                // we done function
                item.onOnce('process-complete', function() {
                    success(createItemAPI(item));
                    processNext();

                    // if origin is local, and we're instant uploading, trigger remove of original
                    // as revert will remove file from list
                    var server = state.options.server;
                    var instantUpload = state.options.instantUpload;
                    if (
                        instantUpload &&
                        item.origin === FileOrigin.LOCAL &&
                        isFunction(server.remove)
                    ) {
                        var noop = function noop() {};
                        item.origin = FileOrigin.LIMBO;
                        state.options.server.remove(item.source, noop, noop);
                    }

                    // All items processed? No errors?
                    var allItemsProcessed =
                        query('GET_ITEMS_BY_STATUS', ItemStatus.PROCESSING_COMPLETE).length ===
                        state.items.length;
                    if (allItemsProcessed) {
                        dispatch('DID_COMPLETE_ITEM_PROCESSING_ALL');
                    }
                });

                // we error function
                item.onOnce('process-error', function(error) {
                    failure({ error: error, file: createItemAPI(item) });
                    processNext();
                });

                // start file processing
                var options = state.options;
                item.process(
                    createFileProcessor(
                        createProcessorFunction(
                            options.server.url,
                            options.server.process,
                            options.name,
                            {
                                chunkTransferId: item.transferId,
                                chunkServer: options.server.patch,
                                chunkUploads: options.chunkUploads,
                                chunkForce: options.chunkForce,
                                chunkSize: options.chunkSize,
                                chunkRetryDelays: options.chunkRetryDelays,
                            }
                        ),

                        {
                            allowMinimumUploadDuration: query('GET_ALLOW_MINIMUM_UPLOAD_DURATION'),
                        }
                    ),

                    // called when the file is about to be processed so it can be piped through the transform filters
                    function(file, success, error) {
                        // allow plugins to alter the file data
                        applyFilterChain('PREPARE_OUTPUT', file, { query: query, item: item })
                            .then(function(file) {
                                dispatch('DID_PREPARE_OUTPUT', { id: item.id, file: file });

                                success(file);
                            })
                            .catch(error);
                    }
                );
            }),

            RETRY_ITEM_PROCESSING: getItemByQueryFromState(state, function(item) {
                dispatch('REQUEST_ITEM_PROCESSING', { query: item });
            }),

            REQUEST_REMOVE_ITEM: getItemByQueryFromState(state, function(item) {
                optionalPromise(query('GET_BEFORE_REMOVE_FILE'), createItemAPI(item)).then(function(
                    shouldRemove
                ) {
                    if (!shouldRemove) {
                        return;
                    }
                    dispatch('REMOVE_ITEM', { query: item });
                });
            }),

            RELEASE_ITEM: getItemByQueryFromState(state, function(item) {
                item.release();
            }),

            REMOVE_ITEM: getItemByQueryFromState(state, function(item, success, failure, options) {
                var removeFromView = function removeFromView() {
                    // get id reference
                    var id = item.id;

                    // archive the item, this does not remove it from the list
                    getItemById(state.items, id).archive();

                    // tell the view the item has been removed
                    dispatch('DID_REMOVE_ITEM', { error: null, id: id, item: item });

                    // now the list has been modified
                    listUpdated(dispatch, state);

                    // correctly removed
                    success(createItemAPI(item));
                };

                // if this is a local file and the `server.remove` function has been configured,
                // send source there so dev can remove file from server
                var server = state.options.server;
                if (
                    item.origin === FileOrigin.LOCAL &&
                    server &&
                    isFunction(server.remove) &&
                    options.remove !== false
                ) {
                    dispatch('DID_START_ITEM_REMOVE', { id: item.id });

                    server.remove(
                        item.source,
                        function() {
                            return removeFromView();
                        },
                        function(status) {
                            dispatch('DID_THROW_ITEM_REMOVE_ERROR', {
                                id: item.id,
                                error: createResponse('error', 0, status, null),
                                status: {
                                    main: dynamicLabel(state.options.labelFileRemoveError)(status),
                                    sub: state.options.labelTapToRetry,
                                },
                            });
                        }
                    );
                } else {
                    // if is requesting revert and can revert need to call revert handler (not calling request_ because that would also trigger beforeRemoveHook)
                    if (
                        (options.revert &&
                            item.origin !== FileOrigin.LOCAL &&
                            item.serverId !== null) ||
                        // if chunked uploads are enabled and we're uploading in chunks for this specific file
                        // or if the file isn't big enough for chunked uploads but chunkForce is set then call
                        // revert before removing from the view...
                        (state.options.chunkUploads && item.file.size > state.options.chunkSize) ||
                        (state.options.chunkUploads && state.options.chunkForce)
                    ) {
                        item.revert(
                            createRevertFunction(
                                state.options.server.url,
                                state.options.server.revert
                            ),
                            query('GET_FORCE_REVERT')
                        );
                    }

                    // can now safely remove from view
                    removeFromView();
                }
            }),

            ABORT_ITEM_LOAD: getItemByQueryFromState(state, function(item) {
                item.abortLoad();
            }),

            ABORT_ITEM_PROCESSING: getItemByQueryFromState(state, function(item) {
                // test if is already processed
                if (item.serverId) {
                    dispatch('REVERT_ITEM_PROCESSING', { id: item.id });
                    return;
                }

                // abort
                item.abortProcessing().then(function() {
                    var shouldRemove = state.options.instantUpload;
                    if (shouldRemove) {
                        dispatch('REMOVE_ITEM', { query: item.id });
                    }
                });
            }),

            REQUEST_REVERT_ITEM_PROCESSING: getItemByQueryFromState(state, function(item) {
                // not instant uploading, revert immediately
                if (!state.options.instantUpload) {
                    dispatch('REVERT_ITEM_PROCESSING', { query: item });
                    return;
                }

                // if we're instant uploading the file will also be removed if we revert,
                // so if a before remove file hook is defined we need to run it now
                var handleRevert = function handleRevert(shouldRevert) {
                    if (!shouldRevert) return;
                    dispatch('REVERT_ITEM_PROCESSING', { query: item });
                };

                var fn = query('GET_BEFORE_REMOVE_FILE');
                if (!fn) {
                    return handleRevert(true);
                }

                var requestRemoveResult = fn(createItemAPI(item));
                if (requestRemoveResult == null) {
                    // undefined or null
                    return handleRevert(true);
                }

                if (typeof requestRemoveResult === 'boolean') {
                    return handleRevert(requestRemoveResult);
                }

                if (typeof requestRemoveResult.then === 'function') {
                    requestRemoveResult.then(handleRevert);
                }
            }),

            REVERT_ITEM_PROCESSING: getItemByQueryFromState(state, function(item) {
                item.revert(
                    createRevertFunction(state.options.server.url, state.options.server.revert),
                    query('GET_FORCE_REVERT')
                )
                    .then(function() {
                        var shouldRemove = state.options.instantUpload || isMockItem(item);
                        if (shouldRemove) {
                            dispatch('REMOVE_ITEM', { query: item.id });
                        }
                    })
                    .catch(function() {});
            }),

            SET_OPTIONS: function SET_OPTIONS(_ref11) {
                var options = _ref11.options;
                // get all keys passed
                var optionKeys = Object.keys(options);

                // get prioritized keyed to include (remove once not in options object)
                var prioritizedOptionKeys = PrioritizedOptions.filter(function(key) {
                    return optionKeys.includes(key);
                });

                // order the keys, prioritized first, then rest
                var orderedOptionKeys = [].concat(
                    _toConsumableArray(prioritizedOptionKeys),
                    _toConsumableArray(
                        Object.keys(options).filter(function(key) {
                            return !prioritizedOptionKeys.includes(key);
                        })
                    )
                );

                // dispatch set event for each option
                orderedOptionKeys.forEach(function(key) {
                    dispatch('SET_' + fromCamels(key, '_').toUpperCase(), {
                        value: options[key],
                    });
                });
            },
        };
    };

    var PrioritizedOptions = ['server'];

    var formatFilename = function formatFilename(name) {
        return name;
    };

    var createElement$1 = function createElement(tagName) {
        return document.createElement(tagName);
    };

    var text = function text(node, value) {
        var textNode = node.childNodes[0];
        if (!textNode) {
            textNode = document.createTextNode(value);
            node.appendChild(textNode);
        } else if (value !== textNode.nodeValue) {
            textNode.nodeValue = value;
        }
    };

    var polarToCartesian = function polarToCartesian(centerX, centerY, radius, angleInDegrees) {
        var angleInRadians = (((angleInDegrees % 360) - 90) * Math.PI) / 180.0;
        return {
            x: centerX + radius * Math.cos(angleInRadians),
            y: centerY + radius * Math.sin(angleInRadians),
        };
    };

    var describeArc = function describeArc(x, y, radius, startAngle, endAngle, arcSweep) {
        var start = polarToCartesian(x, y, radius, endAngle);
        var end = polarToCartesian(x, y, radius, startAngle);
        return ['M', start.x, start.y, 'A', radius, radius, 0, arcSweep, 0, end.x, end.y].join(' ');
    };

    var percentageArc = function percentageArc(x, y, radius, from, to) {
        var arcSweep = 1;
        if (to > from && to - from <= 0.5) {
            arcSweep = 0;
        }
        if (from > to && from - to >= 0.5) {
            arcSweep = 0;
        }
        return describeArc(
            x,
            y,
            radius,
            Math.min(0.9999, from) * 360,
            Math.min(0.9999, to) * 360,
            arcSweep
        );
    };

    var create = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;
        // start at 0
        props.spin = false;
        props.progress = 0;
        props.opacity = 0;

        // svg
        var svg = createElement('svg');
        root.ref.path = createElement('path', {
            'stroke-width': 2,
            'stroke-linecap': 'round',
        });

        svg.appendChild(root.ref.path);

        root.ref.svg = svg;

        root.appendChild(svg);
    };

    var write = function write(_ref2) {
        var root = _ref2.root,
            props = _ref2.props;
        if (props.opacity === 0) {
            return;
        }

        if (props.align) {
            root.element.dataset.align = props.align;
        }

        // get width of stroke
        var ringStrokeWidth = parseInt(attr(root.ref.path, 'stroke-width'), 10);

        // calculate size of ring
        var size = root.rect.element.width * 0.5;

        // ring state
        var ringFrom = 0;
        var ringTo = 0;

        // now in busy mode
        if (props.spin) {
            ringFrom = 0;
            ringTo = 0.5;
        } else {
            ringFrom = 0;
            ringTo = props.progress;
        }

        // get arc path
        var coordinates = percentageArc(size, size, size - ringStrokeWidth, ringFrom, ringTo);

        // update progress bar
        attr(root.ref.path, 'd', coordinates);

        // hide while contains 0 value
        attr(root.ref.path, 'stroke-opacity', props.spin || props.progress > 0 ? 1 : 0);
    };

    var progressIndicator = createView({
        tag: 'div',
        name: 'progress-indicator',
        ignoreRectUpdate: true,
        ignoreRect: true,
        create: create,
        write: write,
        mixins: {
            apis: ['progress', 'spin', 'align'],
            styles: ['opacity'],
            animations: {
                opacity: { type: 'tween', duration: 500 },
                progress: {
                    type: 'spring',
                    stiffness: 0.95,
                    damping: 0.65,
                    mass: 10,
                },
            },
        },
    });

    var create$1 = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;
        root.element.innerHTML = (props.icon || '') + ('<span>' + props.label + '</span>');

        props.isDisabled = false;
    };

    var write$1 = function write(_ref2) {
        var root = _ref2.root,
            props = _ref2.props;
        var isDisabled = props.isDisabled;
        var shouldDisable = root.query('GET_DISABLED') || props.opacity === 0;

        if (shouldDisable && !isDisabled) {
            props.isDisabled = true;
            attr(root.element, 'disabled', 'disabled');
        } else if (!shouldDisable && isDisabled) {
            props.isDisabled = false;
            root.element.removeAttribute('disabled');
        }
    };

    var fileActionButton = createView({
        tag: 'button',
        attributes: {
            type: 'button',
        },

        ignoreRect: true,
        ignoreRectUpdate: true,
        name: 'file-action-button',
        mixins: {
            apis: ['label'],
            styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity'],
            animations: {
                scaleX: 'spring',
                scaleY: 'spring',
                translateX: 'spring',
                translateY: 'spring',
                opacity: { type: 'tween', duration: 250 },
            },

            listeners: true,
        },

        create: create$1,
        write: write$1,
    });

    var toNaturalFileSize = function toNaturalFileSize(bytes) {
        var decimalSeparator =
            arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '.';
        var base = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1000;
        var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
        var _options$labelBytes = options.labelBytes,
            labelBytes = _options$labelBytes === void 0 ? 'bytes' : _options$labelBytes,
            _options$labelKilobyt = options.labelKilobytes,
            labelKilobytes = _options$labelKilobyt === void 0 ? 'KB' : _options$labelKilobyt,
            _options$labelMegabyt = options.labelMegabytes,
            labelMegabytes = _options$labelMegabyt === void 0 ? 'MB' : _options$labelMegabyt,
            _options$labelGigabyt = options.labelGigabytes,
            labelGigabytes = _options$labelGigabyt === void 0 ? 'GB' : _options$labelGigabyt;

        // no negative byte sizes
        bytes = Math.round(Math.abs(bytes));

        var KB = base;
        var MB = base * base;
        var GB = base * base * base;

        // just bytes
        if (bytes < KB) {
            return bytes + ' ' + labelBytes;
        }

        // kilobytes
        if (bytes < MB) {
            return Math.floor(bytes / KB) + ' ' + labelKilobytes;
        }

        // megabytes
        if (bytes < GB) {
            return removeDecimalsWhenZero(bytes / MB, 1, decimalSeparator) + ' ' + labelMegabytes;
        }

        // gigabytes
        return removeDecimalsWhenZero(bytes / GB, 2, decimalSeparator) + ' ' + labelGigabytes;
    };

    var removeDecimalsWhenZero = function removeDecimalsWhenZero(value, decimalCount, separator) {
        return value
            .toFixed(decimalCount)
            .split('.')
            .filter(function(part) {
                return part !== '0';
            })
            .join(separator);
    };

    var create$2 = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;
        // filename
        var fileName = createElement$1('span');
        fileName.className = 'filepond--file-info-main';
        // hide for screenreaders
        // the file is contained in a fieldset with legend that contains the filename
        // no need to read it twice
        attr(fileName, 'aria-hidden', 'true');
        root.appendChild(fileName);
        root.ref.fileName = fileName;

        // filesize
        var fileSize = createElement$1('span');
        fileSize.className = 'filepond--file-info-sub';
        root.appendChild(fileSize);
        root.ref.fileSize = fileSize;

        // set initial values
        text(fileSize, root.query('GET_LABEL_FILE_WAITING_FOR_SIZE'));
        text(fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));
    };

    var updateFile = function updateFile(_ref2) {
        var root = _ref2.root,
            props = _ref2.props;
        text(
            root.ref.fileSize,
            toNaturalFileSize(
                root.query('GET_ITEM_SIZE', props.id),
                '.',
                root.query('GET_FILE_SIZE_BASE'),
                root.query('GET_FILE_SIZE_LABELS', root.query)
            )
        );

        text(root.ref.fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));
    };

    var updateFileSizeOnError = function updateFileSizeOnError(_ref3) {
        var root = _ref3.root,
            props = _ref3.props;
        // if size is available don't fallback to unknown size message
        if (isInt(root.query('GET_ITEM_SIZE', props.id))) {
            updateFile({ root: root, props: props });
            return;
        }

        text(root.ref.fileSize, root.query('GET_LABEL_FILE_SIZE_NOT_AVAILABLE'));
    };

    var fileInfo = createView({
        name: 'file-info',
        ignoreRect: true,
        ignoreRectUpdate: true,
        write: createRoute({
            DID_LOAD_ITEM: updateFile,
            DID_UPDATE_ITEM_META: updateFile,
            DID_THROW_ITEM_LOAD_ERROR: updateFileSizeOnError,
            DID_THROW_ITEM_INVALID: updateFileSizeOnError,
        }),

        didCreateView: function didCreateView(root) {
            applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));
        },
        create: create$2,
        mixins: {
            styles: ['translateX', 'translateY'],
            animations: {
                translateX: 'spring',
                translateY: 'spring',
            },
        },
    });

    var toPercentage = function toPercentage(value) {
        return Math.round(value * 100);
    };

    var create$3 = function create(_ref) {
        var root = _ref.root;

        // main status
        var main = createElement$1('span');
        main.className = 'filepond--file-status-main';
        root.appendChild(main);
        root.ref.main = main;

        // sub status
        var sub = createElement$1('span');
        sub.className = 'filepond--file-status-sub';
        root.appendChild(sub);
        root.ref.sub = sub;

        didSetItemLoadProgress({ root: root, action: { progress: null } });
    };

    var didSetItemLoadProgress = function didSetItemLoadProgress(_ref2) {
        var root = _ref2.root,
            action = _ref2.action;
        var title =
            action.progress === null
                ? root.query('GET_LABEL_FILE_LOADING')
                : root.query('GET_LABEL_FILE_LOADING') + ' ' + toPercentage(action.progress) + '%';

        text(root.ref.main, title);
        text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));
    };

    var didSetItemProcessProgress = function didSetItemProcessProgress(_ref3) {
        var root = _ref3.root,
            action = _ref3.action;
        var title =
            action.progress === null
                ? root.query('GET_LABEL_FILE_PROCESSING')
                : root.query('GET_LABEL_FILE_PROCESSING') +
                  ' ' +
                  toPercentage(action.progress) +
                  '%';

        text(root.ref.main, title);
        text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));
    };

    var didRequestItemProcessing = function didRequestItemProcessing(_ref4) {
        var root = _ref4.root;
        text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING'));
        text(root.ref.sub, root.query('GET_LABEL_TAP_TO_CANCEL'));
    };

    var didAbortItemProcessing = function didAbortItemProcessing(_ref5) {
        var root = _ref5.root;
        text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING_ABORTED'));
        text(root.ref.sub, root.query('GET_LABEL_TAP_TO_RETRY'));
    };

    var didCompleteItemProcessing = function didCompleteItemProcessing(_ref6) {
        var root = _ref6.root;
        text(root.ref.main, root.query('GET_LABEL_FILE_PROCESSING_COMPLETE'));
        text(root.ref.sub, root.query('GET_LABEL_TAP_TO_UNDO'));
    };

    var clear = function clear(_ref7) {
        var root = _ref7.root;
        text(root.ref.main, '');
        text(root.ref.sub, '');
    };

    var error = function error(_ref8) {
        var root = _ref8.root,
            action = _ref8.action;
        text(root.ref.main, action.status.main);
        text(root.ref.sub, action.status.sub);
    };

    var fileStatus = createView({
        name: 'file-status',
        ignoreRect: true,
        ignoreRectUpdate: true,
        write: createRoute({
            DID_LOAD_ITEM: clear,
            DID_REVERT_ITEM_PROCESSING: clear,
            DID_REQUEST_ITEM_PROCESSING: didRequestItemProcessing,
            DID_ABORT_ITEM_PROCESSING: didAbortItemProcessing,
            DID_COMPLETE_ITEM_PROCESSING: didCompleteItemProcessing,
            DID_UPDATE_ITEM_PROCESS_PROGRESS: didSetItemProcessProgress,
            DID_UPDATE_ITEM_LOAD_PROGRESS: didSetItemLoadProgress,
            DID_THROW_ITEM_LOAD_ERROR: error,
            DID_THROW_ITEM_INVALID: error,
            DID_THROW_ITEM_PROCESSING_ERROR: error,
            DID_THROW_ITEM_PROCESSING_REVERT_ERROR: error,
            DID_THROW_ITEM_REMOVE_ERROR: error,
        }),

        didCreateView: function didCreateView(root) {
            applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));
        },
        create: create$3,
        mixins: {
            styles: ['translateX', 'translateY', 'opacity'],
            animations: {
                opacity: { type: 'tween', duration: 250 },
                translateX: 'spring',
                translateY: 'spring',
            },
        },
    });

    /**
     * Button definitions for the file view
     */

    var Buttons = {
        AbortItemLoad: {
            label: 'GET_LABEL_BUTTON_ABORT_ITEM_LOAD',
            action: 'ABORT_ITEM_LOAD',
            className: 'filepond--action-abort-item-load',
            align: 'LOAD_INDICATOR_POSITION', // right
        },
        RetryItemLoad: {
            label: 'GET_LABEL_BUTTON_RETRY_ITEM_LOAD',
            action: 'RETRY_ITEM_LOAD',
            icon: 'GET_ICON_RETRY',
            className: 'filepond--action-retry-item-load',
            align: 'BUTTON_PROCESS_ITEM_POSITION', // right
        },
        RemoveItem: {
            label: 'GET_LABEL_BUTTON_REMOVE_ITEM',
            action: 'REQUEST_REMOVE_ITEM',
            icon: 'GET_ICON_REMOVE',
            className: 'filepond--action-remove-item',
            align: 'BUTTON_REMOVE_ITEM_POSITION', // left
        },
        ProcessItem: {
            label: 'GET_LABEL_BUTTON_PROCESS_ITEM',
            action: 'REQUEST_ITEM_PROCESSING',
            icon: 'GET_ICON_PROCESS',
            className: 'filepond--action-process-item',
            align: 'BUTTON_PROCESS_ITEM_POSITION', // right
        },
        AbortItemProcessing: {
            label: 'GET_LABEL_BUTTON_ABORT_ITEM_PROCESSING',
            action: 'ABORT_ITEM_PROCESSING',
            className: 'filepond--action-abort-item-processing',
            align: 'BUTTON_PROCESS_ITEM_POSITION', // right
        },
        RetryItemProcessing: {
            label: 'GET_LABEL_BUTTON_RETRY_ITEM_PROCESSING',
            action: 'RETRY_ITEM_PROCESSING',
            icon: 'GET_ICON_RETRY',
            className: 'filepond--action-retry-item-processing',
            align: 'BUTTON_PROCESS_ITEM_POSITION', // right
        },
        RevertItemProcessing: {
            label: 'GET_LABEL_BUTTON_UNDO_ITEM_PROCESSING',
            action: 'REQUEST_REVERT_ITEM_PROCESSING',
            icon: 'GET_ICON_UNDO',
            className: 'filepond--action-revert-item-processing',
            align: 'BUTTON_PROCESS_ITEM_POSITION', // right
        },
    };

    // make a list of buttons, we can then remove buttons from this list if they're disabled
    var ButtonKeys = [];
    forin(Buttons, function(key) {
        ButtonKeys.push(key);
    });

    var calculateFileInfoOffset = function calculateFileInfoOffset(root) {
        if (getRemoveIndicatorAligment(root) === 'right') return 0;
        var buttonRect = root.ref.buttonRemoveItem.rect.element;
        return buttonRect.hidden ? null : buttonRect.width + buttonRect.left;
    };

    var calculateButtonWidth = function calculateButtonWidth(root) {
        var buttonRect = root.ref.buttonAbortItemLoad.rect.element;
        return buttonRect.width;
    };

    // Force on full pixels so text stays crips
    var calculateFileVerticalCenterOffset = function calculateFileVerticalCenterOffset(root) {
        return Math.floor(root.ref.buttonRemoveItem.rect.element.height / 4);
    };
    var calculateFileHorizontalCenterOffset = function calculateFileHorizontalCenterOffset(root) {
        return Math.floor(root.ref.buttonRemoveItem.rect.element.left / 2);
    };

    var getLoadIndicatorAlignment = function getLoadIndicatorAlignment(root) {
        return root.query('GET_STYLE_LOAD_INDICATOR_POSITION');
    };
    var getProcessIndicatorAlignment = function getProcessIndicatorAlignment(root) {
        return root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION');
    };
    var getRemoveIndicatorAligment = function getRemoveIndicatorAligment(root) {
        return root.query('GET_STYLE_BUTTON_REMOVE_ITEM_POSITION');
    };

    var DefaultStyle = {
        buttonAbortItemLoad: { opacity: 0 },
        buttonRetryItemLoad: { opacity: 0 },
        buttonRemoveItem: { opacity: 0 },
        buttonProcessItem: { opacity: 0 },
        buttonAbortItemProcessing: { opacity: 0 },
        buttonRetryItemProcessing: { opacity: 0 },
        buttonRevertItemProcessing: { opacity: 0 },
        loadProgressIndicator: { opacity: 0, align: getLoadIndicatorAlignment },
        processProgressIndicator: { opacity: 0, align: getProcessIndicatorAlignment },
        processingCompleteIndicator: { opacity: 0, scaleX: 0.75, scaleY: 0.75 },
        info: { translateX: 0, translateY: 0, opacity: 0 },
        status: { translateX: 0, translateY: 0, opacity: 0 },
    };

    var IdleStyle = {
        buttonRemoveItem: { opacity: 1 },
        buttonProcessItem: { opacity: 1 },
        info: { translateX: calculateFileInfoOffset },
        status: { translateX: calculateFileInfoOffset },
    };

    var ProcessingStyle = {
        buttonAbortItemProcessing: { opacity: 1 },
        processProgressIndicator: { opacity: 1 },
        status: { opacity: 1 },
    };

    var StyleMap = {
        DID_THROW_ITEM_INVALID: {
            buttonRemoveItem: { opacity: 1 },
            info: { translateX: calculateFileInfoOffset },
            status: { translateX: calculateFileInfoOffset, opacity: 1 },
        },

        DID_START_ITEM_LOAD: {
            buttonAbortItemLoad: { opacity: 1 },
            loadProgressIndicator: { opacity: 1 },
            status: { opacity: 1 },
        },

        DID_THROW_ITEM_LOAD_ERROR: {
            buttonRetryItemLoad: { opacity: 1 },
            buttonRemoveItem: { opacity: 1 },
            info: { translateX: calculateFileInfoOffset },
            status: { opacity: 1 },
        },

        DID_START_ITEM_REMOVE: {
            processProgressIndicator: { opacity: 1, align: getRemoveIndicatorAligment },
            info: { translateX: calculateFileInfoOffset },
            status: { opacity: 0 },
        },

        DID_THROW_ITEM_REMOVE_ERROR: {
            processProgressIndicator: { opacity: 0, align: getRemoveIndicatorAligment },
            buttonRemoveItem: { opacity: 1 },
            info: { translateX: calculateFileInfoOffset },
            status: { opacity: 1, translateX: calculateFileInfoOffset },
        },

        DID_LOAD_ITEM: IdleStyle,
        DID_LOAD_LOCAL_ITEM: {
            buttonRemoveItem: { opacity: 1 },
            info: { translateX: calculateFileInfoOffset },
            status: { translateX: calculateFileInfoOffset },
        },

        DID_START_ITEM_PROCESSING: ProcessingStyle,
        DID_REQUEST_ITEM_PROCESSING: ProcessingStyle,
        DID_UPDATE_ITEM_PROCESS_PROGRESS: ProcessingStyle,
        DID_COMPLETE_ITEM_PROCESSING: {
            buttonRevertItemProcessing: { opacity: 1 },
            info: { opacity: 1 },
            status: { opacity: 1 },
        },

        DID_THROW_ITEM_PROCESSING_ERROR: {
            buttonRemoveItem: { opacity: 1 },
            buttonRetryItemProcessing: { opacity: 1 },
            status: { opacity: 1 },
            info: { translateX: calculateFileInfoOffset },
        },

        DID_THROW_ITEM_PROCESSING_REVERT_ERROR: {
            buttonRevertItemProcessing: { opacity: 1 },
            status: { opacity: 1 },
            info: { opacity: 1 },
        },

        DID_ABORT_ITEM_PROCESSING: {
            buttonRemoveItem: { opacity: 1 },
            buttonProcessItem: { opacity: 1 },
            info: { translateX: calculateFileInfoOffset },
            status: { opacity: 1 },
        },

        DID_REVERT_ITEM_PROCESSING: IdleStyle,
    };

    // complete indicator view
    var processingCompleteIndicatorView = createView({
        create: function create(_ref) {
            var root = _ref.root;
            root.element.innerHTML = root.query('GET_ICON_DONE');
        },
        name: 'processing-complete-indicator',
        ignoreRect: true,
        mixins: {
            styles: ['scaleX', 'scaleY', 'opacity'],
            animations: {
                scaleX: 'spring',
                scaleY: 'spring',
                opacity: { type: 'tween', duration: 250 },
            },
        },
    });

    /**
     * Creates the file view
     */
    var create$4 = function create(_ref2) {
        var root = _ref2.root,
            props = _ref2.props;
        // copy Buttons object
        var LocalButtons = Object.keys(Buttons).reduce(function(prev, curr) {
            prev[curr] = Object.assign({}, Buttons[curr]);
            return prev;
        }, {});
        var id = props.id;

        // allow reverting upload
        var allowRevert = root.query('GET_ALLOW_REVERT');

        // allow remove file
        var allowRemove = root.query('GET_ALLOW_REMOVE');

        // allow processing upload
        var allowProcess = root.query('GET_ALLOW_PROCESS');

        // is instant uploading, need this to determine the icon of the undo button
        var instantUpload = root.query('GET_INSTANT_UPLOAD');

        // is async set up
        var isAsync = root.query('IS_ASYNC');

        // should align remove item buttons
        var alignRemoveItemButton = root.query('GET_STYLE_BUTTON_REMOVE_ITEM_ALIGN');

        // enabled buttons array
        var buttonFilter;
        if (isAsync) {
            if (allowProcess && !allowRevert) {
                // only remove revert button
                buttonFilter = function buttonFilter(key) {
                    return !/RevertItemProcessing/.test(key);
                };
            } else if (!allowProcess && allowRevert) {
                // only remove process button
                buttonFilter = function buttonFilter(key) {
                    return !/ProcessItem|RetryItemProcessing|AbortItemProcessing/.test(key);
                };
            } else if (!allowProcess && !allowRevert) {
                // remove all process buttons
                buttonFilter = function buttonFilter(key) {
                    return !/Process/.test(key);
                };
            }
        } else {
            // no process controls available
            buttonFilter = function buttonFilter(key) {
                return !/Process/.test(key);
            };
        }

        var enabledButtons = buttonFilter ? ButtonKeys.filter(buttonFilter) : ButtonKeys.concat();

        // update icon and label for revert button when instant uploading
        if (instantUpload && allowRevert) {
            LocalButtons['RevertItemProcessing'].label = 'GET_LABEL_BUTTON_REMOVE_ITEM';
            LocalButtons['RevertItemProcessing'].icon = 'GET_ICON_REMOVE';
        }

        // remove last button (revert) if not allowed
        if (isAsync && !allowRevert) {
            var map = StyleMap['DID_COMPLETE_ITEM_PROCESSING'];
            map.info.translateX = calculateFileHorizontalCenterOffset;
            map.info.translateY = calculateFileVerticalCenterOffset;
            map.status.translateY = calculateFileVerticalCenterOffset;
            map.processingCompleteIndicator = { opacity: 1, scaleX: 1, scaleY: 1 };
        }

        // should align center
        if (isAsync && !allowProcess) {
            [
                'DID_START_ITEM_PROCESSING',
                'DID_REQUEST_ITEM_PROCESSING',
                'DID_UPDATE_ITEM_PROCESS_PROGRESS',
                'DID_THROW_ITEM_PROCESSING_ERROR',
            ].forEach(function(key) {
                StyleMap[key].status.translateY = calculateFileVerticalCenterOffset;
            });
            StyleMap['DID_THROW_ITEM_PROCESSING_ERROR'].status.translateX = calculateButtonWidth;
        }

        // move remove button to right
        if (alignRemoveItemButton && allowRevert) {
            LocalButtons['RevertItemProcessing'].align = 'BUTTON_REMOVE_ITEM_POSITION';
            var _map = StyleMap['DID_COMPLETE_ITEM_PROCESSING'];
            _map.info.translateX = calculateFileInfoOffset;
            _map.status.translateY = calculateFileVerticalCenterOffset;
            _map.processingCompleteIndicator = { opacity: 1, scaleX: 1, scaleY: 1 };
        }

        // show/hide RemoveItem button
        if (!allowRemove) {
            LocalButtons['RemoveItem'].disabled = true;
        }

        // create the button views
        forin(LocalButtons, function(key, definition) {
            // create button
            var buttonView = root.createChildView(fileActionButton, {
                label: root.query(definition.label),
                icon: root.query(definition.icon),
                opacity: 0,
            });

            // should be appended?
            if (enabledButtons.includes(key)) {
                root.appendChildView(buttonView);
            }

            // toggle
            if (definition.disabled) {
                buttonView.element.setAttribute('disabled', 'disabled');
                buttonView.element.setAttribute('hidden', 'hidden');
            }

            // add position attribute
            buttonView.element.dataset.align = root.query('GET_STYLE_' + definition.align);

            // add class
            buttonView.element.classList.add(definition.className);

            // handle interactions
            buttonView.on('click', function(e) {
                e.stopPropagation();
                if (definition.disabled) return;
                root.dispatch(definition.action, { query: id });
            });

            // set reference
            root.ref['button' + key] = buttonView;
        });

        // checkmark
        root.ref.processingCompleteIndicator = root.appendChildView(
            root.createChildView(processingCompleteIndicatorView)
        );

        root.ref.processingCompleteIndicator.element.dataset.align = root.query(
            'GET_STYLE_BUTTON_PROCESS_ITEM_POSITION'
        );

        // create file info view
        root.ref.info = root.appendChildView(root.createChildView(fileInfo, { id: id }));

        // create file status view
        root.ref.status = root.appendChildView(root.createChildView(fileStatus, { id: id }));

        // add progress indicators
        var loadIndicatorView = root.appendChildView(
            root.createChildView(progressIndicator, {
                opacity: 0,
                align: root.query('GET_STYLE_LOAD_INDICATOR_POSITION'),
            })
        );

        loadIndicatorView.element.classList.add('filepond--load-indicator');
        root.ref.loadProgressIndicator = loadIndicatorView;

        var progressIndicatorView = root.appendChildView(
            root.createChildView(progressIndicator, {
                opacity: 0,
                align: root.query('GET_STYLE_PROGRESS_INDICATOR_POSITION'),
            })
        );

        progressIndicatorView.element.classList.add('filepond--process-indicator');
        root.ref.processProgressIndicator = progressIndicatorView;

        // current active styles
        root.ref.activeStyles = [];
    };

    var write$2 = function write(_ref3) {
        var root = _ref3.root,
            actions = _ref3.actions,
            props = _ref3.props;
        // route actions
        route({ root: root, actions: actions, props: props });

        // select last state change action
        var action = actions
            .concat()
            .filter(function(action) {
                return /^DID_/.test(action.type);
            })
            .reverse()
            .find(function(action) {
                return StyleMap[action.type];
            });

        // a new action happened, let's get the matching styles
        if (action) {
            // define new active styles
            root.ref.activeStyles = [];

            var stylesToApply = StyleMap[action.type];
            forin(DefaultStyle, function(name, defaultStyles) {
                // get reference to control
                var control = root.ref[name];

                // loop over all styles for this control
                forin(defaultStyles, function(key, defaultValue) {
                    var value =
                        stylesToApply[name] && typeof stylesToApply[name][key] !== 'undefined'
                            ? stylesToApply[name][key]
                            : defaultValue;
                    root.ref.activeStyles.push({ control: control, key: key, value: value });
                });
            });
        }

        // apply active styles to element
        root.ref.activeStyles.forEach(function(_ref4) {
            var control = _ref4.control,
                key = _ref4.key,
                value = _ref4.value;
            control[key] = typeof value === 'function' ? value(root) : value;
        });
    };

    var route = createRoute({
        DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING: function DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING(
            _ref5
        ) {
            var root = _ref5.root,
                action = _ref5.action;
            root.ref.buttonAbortItemProcessing.label = action.value;
        },
        DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD: function DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD(_ref6) {
            var root = _ref6.root,
                action = _ref6.action;
            root.ref.buttonAbortItemLoad.label = action.value;
        },
        DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL: function DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL(
            _ref7
        ) {
            var root = _ref7.root,
                action = _ref7.action;
            root.ref.buttonAbortItemRemoval.label = action.value;
        },
        DID_REQUEST_ITEM_PROCESSING: function DID_REQUEST_ITEM_PROCESSING(_ref8) {
            var root = _ref8.root;
            root.ref.processProgressIndicator.spin = true;
            root.ref.processProgressIndicator.progress = 0;
        },
        DID_START_ITEM_LOAD: function DID_START_ITEM_LOAD(_ref9) {
            var root = _ref9.root;
            root.ref.loadProgressIndicator.spin = true;
            root.ref.loadProgressIndicator.progress = 0;
        },
        DID_START_ITEM_REMOVE: function DID_START_ITEM_REMOVE(_ref10) {
            var root = _ref10.root;
            root.ref.processProgressIndicator.spin = true;
            root.ref.processProgressIndicator.progress = 0;
        },
        DID_UPDATE_ITEM_LOAD_PROGRESS: function DID_UPDATE_ITEM_LOAD_PROGRESS(_ref11) {
            var root = _ref11.root,
                action = _ref11.action;
            root.ref.loadProgressIndicator.spin = false;
            root.ref.loadProgressIndicator.progress = action.progress;
        },
        DID_UPDATE_ITEM_PROCESS_PROGRESS: function DID_UPDATE_ITEM_PROCESS_PROGRESS(_ref12) {
            var root = _ref12.root,
                action = _ref12.action;
            root.ref.processProgressIndicator.spin = false;
            root.ref.processProgressIndicator.progress = action.progress;
        },
    });

    var file = createView({
        create: create$4,
        write: write$2,
        didCreateView: function didCreateView(root) {
            applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));
        },
        name: 'file',
    });

    /**
     * Creates the file view
     */
    var create$5 = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;

        // filename
        root.ref.fileName = createElement$1('legend');
        root.appendChild(root.ref.fileName);

        // file appended
        root.ref.file = root.appendChildView(root.createChildView(file, { id: props.id }));

        // data has moved to data.js
        root.ref.data = false;
    };

    /**
     * Data storage
     */
    var didLoadItem = function didLoadItem(_ref2) {
        var root = _ref2.root,
            props = _ref2.props;
        // updates the legend of the fieldset so screenreaders can better group buttons
        text(root.ref.fileName, formatFilename(root.query('GET_ITEM_NAME', props.id)));
    };

    var fileWrapper = createView({
        create: create$5,
        ignoreRect: true,
        write: createRoute({
            DID_LOAD_ITEM: didLoadItem,
        }),

        didCreateView: function didCreateView(root) {
            applyFilters('CREATE_VIEW', Object.assign({}, root, { view: root }));
        },
        tag: 'fieldset',
        name: 'file-wrapper',
    });

    var PANEL_SPRING_PROPS = { type: 'spring', damping: 0.6, mass: 7 };

    var create$6 = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;
        [
            {
                name: 'top',
            },

            {
                name: 'center',
                props: {
                    translateY: null,
                    scaleY: null,
                },

                mixins: {
                    animations: {
                        scaleY: PANEL_SPRING_PROPS,
                    },

                    styles: ['translateY', 'scaleY'],
                },
            },

            {
                name: 'bottom',
                props: {
                    translateY: null,
                },

                mixins: {
                    animations: {
                        translateY: PANEL_SPRING_PROPS,
                    },

                    styles: ['translateY'],
                },
            },
        ].forEach(function(section) {
            createSection(root, section, props.name);
        });

        root.element.classList.add('filepond--' + props.name);

        root.ref.scalable = null;
    };

    var createSection = function createSection(root, section, className) {
        var viewConstructor = createView({
            name: 'panel-' + section.name + ' filepond--' + className,
            mixins: section.mixins,
            ignoreRectUpdate: true,
        });

        var view = root.createChildView(viewConstructor, section.props);

        root.ref[section.name] = root.appendChildView(view);
    };

    var write$3 = function write(_ref2) {
        var root = _ref2.root,
            props = _ref2.props;

        // update scalable state
        if (root.ref.scalable === null || props.scalable !== root.ref.scalable) {
            root.ref.scalable = isBoolean(props.scalable) ? props.scalable : true;
            root.element.dataset.scalable = root.ref.scalable;
        }

        // no height, can't set
        if (!props.height) return;

        // get child rects
        var topRect = root.ref.top.rect.element;
        var bottomRect = root.ref.bottom.rect.element;

        // make sure height never is smaller than bottom and top seciton heights combined (will probably never happen, but who knows)
        var height = Math.max(topRect.height + bottomRect.height, props.height);

        // offset center part
        root.ref.center.translateY = topRect.height;

        // scale center part
        // use math ceil to prevent transparent lines because of rounding errors
        root.ref.center.scaleY = (height - topRect.height - bottomRect.height) / 100;

        // offset bottom part
        root.ref.bottom.translateY = height - bottomRect.height;
    };

    var panel = createView({
        name: 'panel',
        read: function read(_ref3) {
            var root = _ref3.root,
                props = _ref3.props;
            return (props.heightCurrent = root.ref.bottom.translateY);
        },
        write: write$3,
        create: create$6,
        ignoreRect: true,
        mixins: {
            apis: ['height', 'heightCurrent', 'scalable'],
        },
    });

    var createDragHelper = function createDragHelper(items) {
        var itemIds = items.map(function(item) {
            return item.id;
        });
        var prevIndex = undefined;
        return {
            setIndex: function setIndex(index) {
                prevIndex = index;
            },
            getIndex: function getIndex() {
                return prevIndex;
            },
            getItemIndex: function getItemIndex(item) {
                return itemIds.indexOf(item.id);
            },
        };
    };

    var ITEM_TRANSLATE_SPRING = {
        type: 'spring',
        stiffness: 0.75,
        damping: 0.45,
        mass: 10,
    };

    var ITEM_SCALE_SPRING = 'spring';

    var StateMap = {
        DID_START_ITEM_LOAD: 'busy',
        DID_UPDATE_ITEM_LOAD_PROGRESS: 'loading',
        DID_THROW_ITEM_INVALID: 'load-invalid',
        DID_THROW_ITEM_LOAD_ERROR: 'load-error',
        DID_LOAD_ITEM: 'idle',
        DID_THROW_ITEM_REMOVE_ERROR: 'remove-error',
        DID_START_ITEM_REMOVE: 'busy',
        DID_START_ITEM_PROCESSING: 'busy processing',
        DID_REQUEST_ITEM_PROCESSING: 'busy processing',
        DID_UPDATE_ITEM_PROCESS_PROGRESS: 'processing',
        DID_COMPLETE_ITEM_PROCESSING: 'processing-complete',
        DID_THROW_ITEM_PROCESSING_ERROR: 'processing-error',
        DID_THROW_ITEM_PROCESSING_REVERT_ERROR: 'processing-revert-error',
        DID_ABORT_ITEM_PROCESSING: 'cancelled',
        DID_REVERT_ITEM_PROCESSING: 'idle',
    };

    /**
     * Creates the file view
     */
    var create$7 = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;

        // select
        root.ref.handleClick = function(e) {
            return root.dispatch('DID_ACTIVATE_ITEM', { id: props.id });
        };

        // set id
        root.element.id = 'filepond--item-' + props.id;
        root.element.addEventListener('click', root.ref.handleClick);

        // file view
        root.ref.container = root.appendChildView(
            root.createChildView(fileWrapper, { id: props.id })
        );

        // file panel
        root.ref.panel = root.appendChildView(root.createChildView(panel, { name: 'item-panel' }));

        // default start height
        root.ref.panel.height = null;

        // by default not marked for removal
        props.markedForRemoval = false;

        // if not allowed to reorder file items, exit here
        if (!root.query('GET_ALLOW_REORDER')) return;

        // set to idle so shows grab cursor
        root.element.dataset.dragState = 'idle';

        var grab = function grab(e) {
            if (!e.isPrimary) return;

            var removedActivateListener = false;

            var origin = {
                x: e.pageX,
                y: e.pageY,
            };

            props.dragOrigin = {
                x: root.translateX,
                y: root.translateY,
            };

            props.dragCenter = {
                x: e.offsetX,
                y: e.offsetY,
            };

            var dragState = createDragHelper(root.query('GET_ACTIVE_ITEMS'));

            root.dispatch('DID_GRAB_ITEM', { id: props.id, dragState: dragState });

            var drag = function drag(e) {
                if (!e.isPrimary) return;

                e.stopPropagation();
                e.preventDefault();

                props.dragOffset = {
                    x: e.pageX - origin.x,
                    y: e.pageY - origin.y,
                };

                // if dragged stop listening to clicks, will re-add when done dragging
                var dist =
                    props.dragOffset.x * props.dragOffset.x +
                    props.dragOffset.y * props.dragOffset.y;
                if (dist > 16 && !removedActivateListener) {
                    removedActivateListener = true;
                    root.element.removeEventListener('click', root.ref.handleClick);
                }

                root.dispatch('DID_DRAG_ITEM', { id: props.id, dragState: dragState });
            };

            var drop = function drop(e) {
                if (!e.isPrimary) return;

                document.removeEventListener('pointermove', drag);
                document.removeEventListener('pointerup', drop);

                props.dragOffset = {
                    x: e.pageX - origin.x,
                    y: e.pageY - origin.y,
                };

                root.dispatch('DID_DROP_ITEM', { id: props.id, dragState: dragState });

                // start listening to clicks again
                if (removedActivateListener) {
                    setTimeout(function() {
                        return root.element.addEventListener('click', root.ref.handleClick);
                    }, 0);
                }
            };

            document.addEventListener('pointermove', drag);
            document.addEventListener('pointerup', drop);
        };

        root.element.addEventListener('pointerdown', grab);
    };

    var route$1 = createRoute({
        DID_UPDATE_PANEL_HEIGHT: function DID_UPDATE_PANEL_HEIGHT(_ref2) {
            var root = _ref2.root,
                action = _ref2.action;
            root.height = action.height;
        },
    });

    var write$4 = createRoute(
        {
            DID_GRAB_ITEM: function DID_GRAB_ITEM(_ref3) {
                var root = _ref3.root,
                    props = _ref3.props;
                props.dragOrigin = {
                    x: root.translateX,
                    y: root.translateY,
                };
            },
            DID_DRAG_ITEM: function DID_DRAG_ITEM(_ref4) {
                var root = _ref4.root;
                root.element.dataset.dragState = 'drag';
            },
            DID_DROP_ITEM: function DID_DROP_ITEM(_ref5) {
                var root = _ref5.root,
                    props = _ref5.props;
                props.dragOffset = null;
                props.dragOrigin = null;
                root.element.dataset.dragState = 'drop';
            },
        },
        function(_ref6) {
            var root = _ref6.root,
                actions = _ref6.actions,
                props = _ref6.props,
                shouldOptimize = _ref6.shouldOptimize;

            if (root.element.dataset.dragState === 'drop') {
                if (root.scaleX <= 1) {
                    root.element.dataset.dragState = 'idle';
                }
            }

            // select last state change action
            var action = actions
                .concat()
                .filter(function(action) {
                    return /^DID_/.test(action.type);
                })
                .reverse()
                .find(function(action) {
                    return StateMap[action.type];
                });

            // no need to set same state twice
            if (action && action.type !== props.currentState) {
                // set current state
                props.currentState = action.type;

                // set state
                root.element.dataset.filepondItemState = StateMap[props.currentState] || '';
            }

            // route actions
            var aspectRatio =
                root.query('GET_ITEM_PANEL_ASPECT_RATIO') || root.query('GET_PANEL_ASPECT_RATIO');
            if (!aspectRatio) {
                route$1({ root: root, actions: actions, props: props });
                if (!root.height && root.ref.container.rect.element.height > 0) {
                    root.height = root.ref.container.rect.element.height;
                }
            } else if (!shouldOptimize) {
                root.height = root.rect.element.width * aspectRatio;
            }

            // sync panel height with item height
            if (shouldOptimize) {
                root.ref.panel.height = null;
            }

            root.ref.panel.height = root.height;
        }
    );

    var item = createView({
        create: create$7,
        write: write$4,
        destroy: function destroy(_ref7) {
            var root = _ref7.root,
                props = _ref7.props;
            root.element.removeEventListener('click', root.ref.handleClick);
            root.dispatch('RELEASE_ITEM', { query: props.id });
        },
        tag: 'li',
        name: 'item',
        mixins: {
            apis: [
                'id',
                'interactionMethod',
                'markedForRemoval',
                'spawnDate',
                'dragCenter',
                'dragOrigin',
                'dragOffset',
            ],
            styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity', 'height'],

            animations: {
                scaleX: ITEM_SCALE_SPRING,
                scaleY: ITEM_SCALE_SPRING,
                translateX: ITEM_TRANSLATE_SPRING,
                translateY: ITEM_TRANSLATE_SPRING,
                opacity: { type: 'tween', duration: 150 },
            },
        },
    });

    var getItemsPerRow = function(horizontalSpace, itemWidth) {
        // add one pixel leeway, when using percentages for item width total items can be 1.99 per row

        return Math.max(1, Math.floor((horizontalSpace + 1) / itemWidth));
    };

    var getItemIndexByPosition = function getItemIndexByPosition(view, children, positionInView) {
        if (!positionInView) return;

        var horizontalSpace = view.rect.element.width;
        // const children = view.childViews;
        var l = children.length;
        var last = null;

        // -1, don't move items to accomodate (either add to top or bottom)
        if (l === 0 || positionInView.top < children[0].rect.element.top) return -1;

        // let's get the item width
        var item = children[0];
        var itemRect = item.rect.element;
        var itemHorizontalMargin = itemRect.marginLeft + itemRect.marginRight;
        var itemWidth = itemRect.width + itemHorizontalMargin;
        var itemsPerRow = getItemsPerRow(horizontalSpace, itemWidth);

        // stack
        if (itemsPerRow === 1) {
            for (var index = 0; index < l; index++) {
                var child = children[index];
                var childMid = child.rect.outer.top + child.rect.element.height * 0.5;
                if (positionInView.top < childMid) {
                    return index;
                }
            }
            return l;
        }

        // grid
        var itemVerticalMargin = itemRect.marginTop + itemRect.marginBottom;
        var itemHeight = itemRect.height + itemVerticalMargin;
        for (var _index = 0; _index < l; _index++) {
            var indexX = _index % itemsPerRow;
            var indexY = Math.floor(_index / itemsPerRow);

            var offsetX = indexX * itemWidth;
            var offsetY = indexY * itemHeight;

            var itemTop = offsetY - itemRect.marginTop;
            var itemRight = offsetX + itemWidth;
            var itemBottom = offsetY + itemHeight + itemRect.marginBottom;

            if (positionInView.top < itemBottom && positionInView.top > itemTop) {
                if (positionInView.left < itemRight) {
                    return _index;
                } else if (_index !== l - 1) {
                    last = _index;
                } else {
                    last = null;
                }
            }
        }

        if (last !== null) {
            return last;
        }

        return l;
    };

    var dropAreaDimensions = {
        height: 0,
        width: 0,
        get getHeight() {
            return this.height;
        },
        set setHeight(val) {
            if (this.height === 0 || val === 0) this.height = val;
        },
        get getWidth() {
            return this.width;
        },
        set setWidth(val) {
            if (this.width === 0 || val === 0) this.width = val;
        },
        setDimensions: function setDimensions(height, width) {
            if (this.height === 0 || height === 0) this.height = height;
            if (this.width === 0 || width === 0) this.width = width;
        },
    };

    var create$8 = function create(_ref) {
        var root = _ref.root;
        // need to set role to list as otherwise it won't be read as a list by VoiceOver
        attr(root.element, 'role', 'list');

        root.ref.lastItemSpanwDate = Date.now();
    };

    /**
     * Inserts a new item
     * @param root
     * @param action
     */
    var addItemView = function addItemView(_ref2) {
        var root = _ref2.root,
            action = _ref2.action;
        var id = action.id,
            index = action.index,
            interactionMethod = action.interactionMethod;

        root.ref.addIndex = index;

        var now = Date.now();
        var spawnDate = now;
        var opacity = 1;

        if (interactionMethod !== InteractionMethod.NONE) {
            opacity = 0;
            var cooldown = root.query('GET_ITEM_INSERT_INTERVAL');
            var dist = now - root.ref.lastItemSpanwDate;
            spawnDate = dist < cooldown ? now + (cooldown - dist) : now;
        }

        root.ref.lastItemSpanwDate = spawnDate;

        root.appendChildView(
            root.createChildView(
                // view type
                item,

                // props
                {
                    spawnDate: spawnDate,
                    id: id,
                    opacity: opacity,
                    interactionMethod: interactionMethod,
                }
            ),

            index
        );
    };

    var moveItem = function moveItem(item, x, y) {
        var vx = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
        var vy = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1;
        // set to null to remove animation while dragging
        if (item.dragOffset) {
            item.translateX = null;
            item.translateY = null;
            item.translateX = item.dragOrigin.x + item.dragOffset.x;
            item.translateY = item.dragOrigin.y + item.dragOffset.y;
            item.scaleX = 1.025;
            item.scaleY = 1.025;
        } else {
            item.translateX = x;
            item.translateY = y;

            if (Date.now() > item.spawnDate) {
                // reveal element
                if (item.opacity === 0) {
                    introItemView(item, x, y, vx, vy);
                }

                // make sure is default scale every frame
                item.scaleX = 1;
                item.scaleY = 1;
                item.opacity = 1;
            }
        }
    };

    var introItemView = function introItemView(item, x, y, vx, vy) {
        if (item.interactionMethod === InteractionMethod.NONE) {
            item.translateX = null;
            item.translateX = x;
            item.translateY = null;
            item.translateY = y;
        } else if (item.interactionMethod === InteractionMethod.DROP) {
            item.translateX = null;
            item.translateX = x - vx * 20;

            item.translateY = null;
            item.translateY = y - vy * 10;

            item.scaleX = 0.8;
            item.scaleY = 0.8;
        } else if (item.interactionMethod === InteractionMethod.BROWSE) {
            item.translateY = null;
            item.translateY = y - 30;
        } else if (item.interactionMethod === InteractionMethod.API) {
            item.translateX = null;
            item.translateX = x - 30;
            item.translateY = null;
        }
    };

    /**
     * Removes an existing item
     * @param root
     * @param action
     */
    var removeItemView = function removeItemView(_ref3) {
        var root = _ref3.root,
            action = _ref3.action;
        var id = action.id;

        // get the view matching the given id
        var view = root.childViews.find(function(child) {
            return child.id === id;
        });

        // if no view found, exit
        if (!view) {
            return;
        }

        // animate view out of view
        view.scaleX = 0.9;
        view.scaleY = 0.9;
        view.opacity = 0;

        // mark for removal
        view.markedForRemoval = true;
    };

    var getItemHeight = function getItemHeight(child) {
        return (
            child.rect.element.height +
            child.rect.element.marginBottom * 0.5 +
            child.rect.element.marginTop * 0.5
        );
    };
    var getItemWidth = function getItemWidth(child) {
        return (
            child.rect.element.width +
            child.rect.element.marginLeft * 0.5 +
            child.rect.element.marginRight * 0.5
        );
    };

    var dragItem = function dragItem(_ref4) {
        var root = _ref4.root,
            action = _ref4.action;
        var id = action.id,
            dragState = action.dragState;

        // reference to item
        var item = root.query('GET_ITEM', { id: id });

        // get the view matching the given id
        var view = root.childViews.find(function(child) {
            return child.id === id;
        });

        var numItems = root.childViews.length;
        var oldIndex = dragState.getItemIndex(item);

        // if no view found, exit
        if (!view) return;

        var dragPosition = {
            x: view.dragOrigin.x + view.dragOffset.x + view.dragCenter.x,
            y: view.dragOrigin.y + view.dragOffset.y + view.dragCenter.y,
        };

        // get drag area dimensions
        var dragHeight = getItemHeight(view);
        var dragWidth = getItemWidth(view);

        // get rows and columns (There will always be at least one row and one column if a file is present)
        var cols = Math.floor(root.rect.outer.width / dragWidth);
        if (cols > numItems) cols = numItems;

        // rows are used to find when we have left the preview area bounding box
        var rows = Math.floor(numItems / cols + 1);

        dropAreaDimensions.setHeight = dragHeight * rows;
        dropAreaDimensions.setWidth = dragWidth * cols;

        // get new index of dragged item
        var location = {
            y: Math.floor(dragPosition.y / dragHeight),
            x: Math.floor(dragPosition.x / dragWidth),
            getGridIndex: function getGridIndex() {
                if (
                    dragPosition.y > dropAreaDimensions.getHeight ||
                    dragPosition.y < 0 ||
                    dragPosition.x > dropAreaDimensions.getWidth ||
                    dragPosition.x < 0
                )
                    return oldIndex;
                return this.y * cols + this.x;
            },
            getColIndex: function getColIndex() {
                var items = root.query('GET_ACTIVE_ITEMS');
                var visibleChildren = root.childViews.filter(function(child) {
                    return child.rect.element.height;
                });
                var children = items.map(function(item) {
                    return visibleChildren.find(function(childView) {
                        return childView.id === item.id;
                    });
                });

                var currentIndex = children.findIndex(function(child) {
                    return child === view;
                });
                var dragHeight = getItemHeight(view);
                var l = children.length;
                var idx = l;
                var childHeight = 0;
                var childBottom = 0;
                var childTop = 0;
                for (var i = 0; i < l; i++) {
                    childHeight = getItemHeight(children[i]);
                    childTop = childBottom;
                    childBottom = childTop + childHeight;
                    if (dragPosition.y < childBottom) {
                        if (currentIndex > i) {
                            if (dragPosition.y < childTop + dragHeight) {
                                idx = i;
                                break;
                            }
                            continue;
                        }
                        idx = i;
                        break;
                    }
                }
                return idx;
            },
        };

        // get new index
        var index = cols > 1 ? location.getGridIndex() : location.getColIndex();
        root.dispatch('MOVE_ITEM', { query: view, index: index });

        // if the index of the item changed, dispatch reorder action
        var currentIndex = dragState.getIndex();

        if (currentIndex === undefined || currentIndex !== index) {
            dragState.setIndex(index);

            if (currentIndex === undefined) return;

            root.dispatch('DID_REORDER_ITEMS', {
                items: root.query('GET_ACTIVE_ITEMS'),
                origin: oldIndex,
                target: index,
            });
        }
    };

    /**
     * Setup action routes
     */
    var route$2 = createRoute({
        DID_ADD_ITEM: addItemView,
        DID_REMOVE_ITEM: removeItemView,
        DID_DRAG_ITEM: dragItem,
    });

    /**
     * Write to view
     * @param root
     * @param actions
     * @param props
     */
    var write$5 = function write(_ref5) {
        var root = _ref5.root,
            props = _ref5.props,
            actions = _ref5.actions,
            shouldOptimize = _ref5.shouldOptimize;
        // route actions
        route$2({ root: root, props: props, actions: actions });
        var dragCoordinates = props.dragCoordinates;

        // available space on horizontal axis
        var horizontalSpace = root.rect.element.width;

        // only draw children that have dimensions
        var visibleChildren = root.childViews.filter(function(child) {
            return child.rect.element.height;
        });

        // sort based on current active items
        var children = root
            .query('GET_ACTIVE_ITEMS')
            .map(function(item) {
                return visibleChildren.find(function(child) {
                    return child.id === item.id;
                });
            })
            .filter(function(item) {
                return item;
            });

        // get index
        var dragIndex = dragCoordinates
            ? getItemIndexByPosition(root, children, dragCoordinates)
            : null;

        // add index is used to reserve the dropped/added item index till the actual item is rendered
        var addIndex = root.ref.addIndex || null;

        // add index no longer needed till possibly next draw
        root.ref.addIndex = null;

        var dragIndexOffset = 0;
        var removeIndexOffset = 0;
        var addIndexOffset = 0;

        if (children.length === 0) return;

        var childRect = children[0].rect.element;
        var itemVerticalMargin = childRect.marginTop + childRect.marginBottom;
        var itemHorizontalMargin = childRect.marginLeft + childRect.marginRight;
        var itemWidth = childRect.width + itemHorizontalMargin;
        var itemHeight = childRect.height + itemVerticalMargin;
        var itemsPerRow = getItemsPerRow(horizontalSpace, itemWidth);

        // stack
        if (itemsPerRow === 1) {
            var offsetY = 0;
            var dragOffset = 0;

            children.forEach(function(child, index) {
                if (dragIndex) {
                    var dist = index - dragIndex;
                    if (dist === -2) {
                        dragOffset = -itemVerticalMargin * 0.25;
                    } else if (dist === -1) {
                        dragOffset = -itemVerticalMargin * 0.75;
                    } else if (dist === 0) {
                        dragOffset = itemVerticalMargin * 0.75;
                    } else if (dist === 1) {
                        dragOffset = itemVerticalMargin * 0.25;
                    } else {
                        dragOffset = 0;
                    }
                }

                if (shouldOptimize) {
                    child.translateX = null;
                    child.translateY = null;
                }

                if (!child.markedForRemoval) {
                    moveItem(child, 0, offsetY + dragOffset);
                }

                var itemHeight = child.rect.element.height + itemVerticalMargin;

                var visualHeight = itemHeight * (child.markedForRemoval ? child.opacity : 1);

                offsetY += visualHeight;
            });
        }
        // grid
        else {
            var prevX = 0;
            var prevY = 0;

            children.forEach(function(child, index) {
                if (index === dragIndex) {
                    dragIndexOffset = 1;
                }

                if (index === addIndex) {
                    addIndexOffset += 1;
                }

                if (child.markedForRemoval && child.opacity < 0.5) {
                    removeIndexOffset -= 1;
                }

                var visualIndex = index + addIndexOffset + dragIndexOffset + removeIndexOffset;

                var indexX = visualIndex % itemsPerRow;
                var indexY = Math.floor(visualIndex / itemsPerRow);

                var offsetX = indexX * itemWidth;
                var offsetY = indexY * itemHeight;

                var vectorX = Math.sign(offsetX - prevX);
                var vectorY = Math.sign(offsetY - prevY);

                prevX = offsetX;
                prevY = offsetY;

                if (child.markedForRemoval) return;

                if (shouldOptimize) {
                    child.translateX = null;
                    child.translateY = null;
                }

                moveItem(child, offsetX, offsetY, vectorX, vectorY);
            });
        }
    };

    /**
     * Filters actions that are meant specifically for a certain child of the list
     * @param child
     * @param actions
     */
    var filterSetItemActions = function filterSetItemActions(child, actions) {
        return actions.filter(function(action) {
            // if action has an id, filter out actions that don't have this child id
            if (action.data && action.data.id) {
                return child.id === action.data.id;
            }

            // allow all other actions
            return true;
        });
    };

    var list = createView({
        create: create$8,
        write: write$5,
        tag: 'ul',
        name: 'list',
        didWriteView: function didWriteView(_ref6) {
            var root = _ref6.root;
            root.childViews
                .filter(function(view) {
                    return view.markedForRemoval && view.opacity === 0 && view.resting;
                })
                .forEach(function(view) {
                    view._destroy();
                    root.removeChildView(view);
                });
        },
        filterFrameActionsForChild: filterSetItemActions,
        mixins: {
            apis: ['dragCoordinates'],
        },
    });

    var create$9 = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;
        root.ref.list = root.appendChildView(root.createChildView(list));
        props.dragCoordinates = null;
        props.overflowing = false;
    };

    var storeDragCoordinates = function storeDragCoordinates(_ref2) {
        var root = _ref2.root,
            props = _ref2.props,
            action = _ref2.action;
        if (!root.query('GET_ITEM_INSERT_LOCATION_FREEDOM')) return;
        props.dragCoordinates = {
            left: action.position.scopeLeft - root.ref.list.rect.element.left,
            top:
                action.position.scopeTop -
                (root.rect.outer.top + root.rect.element.marginTop + root.rect.element.scrollTop),
        };
    };

    var clearDragCoordinates = function clearDragCoordinates(_ref3) {
        var props = _ref3.props;
        props.dragCoordinates = null;
    };

    var route$3 = createRoute({
        DID_DRAG: storeDragCoordinates,
        DID_END_DRAG: clearDragCoordinates,
    });

    var write$6 = function write(_ref4) {
        var root = _ref4.root,
            props = _ref4.props,
            actions = _ref4.actions;

        // route actions
        route$3({ root: root, props: props, actions: actions });

        // current drag position
        root.ref.list.dragCoordinates = props.dragCoordinates;

        // if currently overflowing but no longer received overflow
        if (props.overflowing && !props.overflow) {
            props.overflowing = false;

            // reset overflow state
            root.element.dataset.state = '';
            root.height = null;
        }

        // if is not overflowing currently but does receive overflow value
        if (props.overflow) {
            var newHeight = Math.round(props.overflow);
            if (newHeight !== root.height) {
                props.overflowing = true;
                root.element.dataset.state = 'overflow';
                root.height = newHeight;
            }
        }
    };

    var listScroller = createView({
        create: create$9,
        write: write$6,
        name: 'list-scroller',
        mixins: {
            apis: ['overflow', 'dragCoordinates'],
            styles: ['height', 'translateY'],
            animations: {
                translateY: 'spring',
            },
        },
    });

    var attrToggle = function attrToggle(element, name, state) {
        var enabledValue = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';
        if (state) {
            attr(element, name, enabledValue);
        } else {
            element.removeAttribute(name);
        }
    };

    var resetFileInput = function resetFileInput(input) {
        // no value, no need to reset
        if (!input || input.value === '') {
            return;
        }

        try {
            // for modern browsers
            input.value = '';
        } catch (err) {}

        // for IE10
        if (input.value) {
            // quickly append input to temp form and reset form
            var form = createElement$1('form');
            var parentNode = input.parentNode;
            var ref = input.nextSibling;
            form.appendChild(input);
            form.reset();

            // re-inject input where it originally was
            if (ref) {
                parentNode.insertBefore(input, ref);
            } else {
                parentNode.appendChild(input);
            }
        }
    };

    var create$a = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;

        // set id so can be referenced from outside labels
        root.element.id = 'filepond--browser-' + props.id;

        // set name of element (is removed when a value is set)
        attr(root.element, 'name', root.query('GET_NAME'));

        // we have to link this element to the status element
        attr(root.element, 'aria-controls', 'filepond--assistant-' + props.id);

        // set label, we use labelled by as otherwise the screenreader does not read the "browse" text in the label (as it has tabindex: 0)
        attr(root.element, 'aria-labelledby', 'filepond--drop-label-' + props.id);

        // set configurable props
        setAcceptedFileTypes({
            root: root,
            action: { value: root.query('GET_ACCEPTED_FILE_TYPES') },
        });
        toggleAllowMultiple({ root: root, action: { value: root.query('GET_ALLOW_MULTIPLE') } });
        toggleDirectoryFilter({
            root: root,
            action: { value: root.query('GET_ALLOW_DIRECTORIES_ONLY') },
        });
        toggleDisabled({ root: root });
        toggleRequired({ root: root, action: { value: root.query('GET_REQUIRED') } });
        setCaptureMethod({ root: root, action: { value: root.query('GET_CAPTURE_METHOD') } });

        // handle changes to the input field
        root.ref.handleChange = function(e) {
            if (!root.element.value) {
                return;
            }

            // extract files and move value of webkitRelativePath path to _relativePath
            var files = Array.from(root.element.files).map(function(file) {
                file._relativePath = file.webkitRelativePath;
                return file;
            });

            // we add a little delay so the OS file select window can move out of the way before we add our file
            setTimeout(function() {
                // load files
                props.onload(files);

                // reset input, it's just for exposing a method to drop files, should not retain any state
                resetFileInput(root.element);
            }, 250);
        };

        root.element.addEventListener('change', root.ref.handleChange);
    };

    var setAcceptedFileTypes = function setAcceptedFileTypes(_ref2) {
        var root = _ref2.root,
            action = _ref2.action;
        if (!root.query('GET_ALLOW_SYNC_ACCEPT_ATTRIBUTE')) return;
        attrToggle(
            root.element,
            'accept',
            !!action.value,
            action.value ? action.value.join(',') : ''
        );
    };

    var toggleAllowMultiple = function toggleAllowMultiple(_ref3) {
        var root = _ref3.root,
            action = _ref3.action;
        attrToggle(root.element, 'multiple', action.value);
    };

    var toggleDirectoryFilter = function toggleDirectoryFilter(_ref4) {
        var root = _ref4.root,
            action = _ref4.action;
        attrToggle(root.element, 'webkitdirectory', action.value);
    };

    var toggleDisabled = function toggleDisabled(_ref5) {
        var root = _ref5.root;
        var isDisabled = root.query('GET_DISABLED');
        var doesAllowBrowse = root.query('GET_ALLOW_BROWSE');
        var disableField = isDisabled || !doesAllowBrowse;
        attrToggle(root.element, 'disabled', disableField);
    };

    var toggleRequired = function toggleRequired(_ref6) {
        var root = _ref6.root,
            action = _ref6.action;
        // want to remove required, always possible
        if (!action.value) {
            attrToggle(root.element, 'required', false);
        }
        // if want to make required, only possible when zero items
        else if (root.query('GET_TOTAL_ITEMS') === 0) {
            attrToggle(root.element, 'required', true);
        }
    };

    var setCaptureMethod = function setCaptureMethod(_ref7) {
        var root = _ref7.root,
            action = _ref7.action;
        attrToggle(
            root.element,
            'capture',
            !!action.value,
            action.value === true ? '' : action.value
        );
    };

    var updateRequiredStatus = function updateRequiredStatus(_ref8) {
        var root = _ref8.root;
        var element = root.element;
        // always remove the required attribute when more than zero items
        if (root.query('GET_TOTAL_ITEMS') > 0) {
            attrToggle(element, 'required', false);
            attrToggle(element, 'name', false);
        } else {
            // add name attribute
            attrToggle(element, 'name', true, root.query('GET_NAME'));

            // remove any validation messages
            var shouldCheckValidity = root.query('GET_CHECK_VALIDITY');
            if (shouldCheckValidity) {
                element.setCustomValidity('');
            }

            // we only add required if the field has been deemed required
            if (root.query('GET_REQUIRED')) {
                attrToggle(element, 'required', true);
            }
        }
    };

    var updateFieldValidityStatus = function updateFieldValidityStatus(_ref9) {
        var root = _ref9.root;
        var shouldCheckValidity = root.query('GET_CHECK_VALIDITY');
        if (!shouldCheckValidity) return;
        root.element.setCustomValidity(root.query('GET_LABEL_INVALID_FIELD'));
    };

    var browser = createView({
        tag: 'input',
        name: 'browser',
        ignoreRect: true,
        ignoreRectUpdate: true,
        attributes: {
            type: 'file',
        },

        create: create$a,
        destroy: function destroy(_ref10) {
            var root = _ref10.root;
            root.element.removeEventListener('change', root.ref.handleChange);
        },
        write: createRoute({
            DID_LOAD_ITEM: updateRequiredStatus,
            DID_REMOVE_ITEM: updateRequiredStatus,
            DID_THROW_ITEM_INVALID: updateFieldValidityStatus,

            DID_SET_DISABLED: toggleDisabled,
            DID_SET_ALLOW_BROWSE: toggleDisabled,
            DID_SET_ALLOW_DIRECTORIES_ONLY: toggleDirectoryFilter,
            DID_SET_ALLOW_MULTIPLE: toggleAllowMultiple,
            DID_SET_ACCEPTED_FILE_TYPES: setAcceptedFileTypes,
            DID_SET_CAPTURE_METHOD: setCaptureMethod,
            DID_SET_REQUIRED: toggleRequired,
        }),
    });

    var Key = {
        ENTER: 13,
        SPACE: 32,
    };

    var create$b = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;

        // create the label and link it to the file browser
        var label = createElement$1('label');
        attr(label, 'for', 'filepond--browser-' + props.id);

        // use for labeling file input (aria-labelledby on file input)
        attr(label, 'id', 'filepond--drop-label-' + props.id);

        // hide the label for screenreaders, the input element will read the contents of the label when it's focussed. If we don't set aria-hidden the screenreader will also navigate the contents of the label separately from the input.
        attr(label, 'aria-hidden', 'true');

        // handle keys
        root.ref.handleKeyDown = function(e) {
            var isActivationKey = e.keyCode === Key.ENTER || e.keyCode === Key.SPACE;
            if (!isActivationKey) return;
            // stops from triggering the element a second time
            e.preventDefault();

            // click link (will then in turn activate file input)
            root.ref.label.click();
        };

        root.ref.handleClick = function(e) {
            var isLabelClick = e.target === label || label.contains(e.target);

            // don't want to click twice
            if (isLabelClick) return;

            // click link (will then in turn activate file input)
            root.ref.label.click();
        };

        // attach events
        label.addEventListener('keydown', root.ref.handleKeyDown);
        root.element.addEventListener('click', root.ref.handleClick);

        // update
        updateLabelValue(label, props.caption);

        // add!
        root.appendChild(label);
        root.ref.label = label;
    };

    var updateLabelValue = function updateLabelValue(label, value) {
        label.innerHTML = value;
        var clickable = label.querySelector('.filepond--label-action');
        if (clickable) {
            attr(clickable, 'tabindex', '0');
        }
        return value;
    };

    var dropLabel = createView({
        name: 'drop-label',
        ignoreRect: true,
        create: create$b,
        destroy: function destroy(_ref2) {
            var root = _ref2.root;
            root.ref.label.addEventListener('keydown', root.ref.handleKeyDown);
            root.element.removeEventListener('click', root.ref.handleClick);
        },
        write: createRoute({
            DID_SET_LABEL_IDLE: function DID_SET_LABEL_IDLE(_ref3) {
                var root = _ref3.root,
                    action = _ref3.action;
                updateLabelValue(root.ref.label, action.value);
            },
        }),

        mixins: {
            styles: ['opacity', 'translateX', 'translateY'],
            animations: {
                opacity: { type: 'tween', duration: 150 },
                translateX: 'spring',
                translateY: 'spring',
            },
        },
    });

    var blob = createView({
        name: 'drip-blob',
        ignoreRect: true,
        mixins: {
            styles: ['translateX', 'translateY', 'scaleX', 'scaleY', 'opacity'],
            animations: {
                scaleX: 'spring',
                scaleY: 'spring',
                translateX: 'spring',
                translateY: 'spring',
                opacity: { type: 'tween', duration: 250 },
            },
        },
    });

    var addBlob = function addBlob(_ref) {
        var root = _ref.root;
        var centerX = root.rect.element.width * 0.5;
        var centerY = root.rect.element.height * 0.5;

        root.ref.blob = root.appendChildView(
            root.createChildView(blob, {
                opacity: 0,
                scaleX: 2.5,
                scaleY: 2.5,
                translateX: centerX,
                translateY: centerY,
            })
        );
    };

    var moveBlob = function moveBlob(_ref2) {
        var root = _ref2.root,
            action = _ref2.action;
        if (!root.ref.blob) {
            addBlob({ root: root });
            return;
        }

        root.ref.blob.translateX = action.position.scopeLeft;
        root.ref.blob.translateY = action.position.scopeTop;
        root.ref.blob.scaleX = 1;
        root.ref.blob.scaleY = 1;
        root.ref.blob.opacity = 1;
    };

    var hideBlob = function hideBlob(_ref3) {
        var root = _ref3.root;
        if (!root.ref.blob) {
            return;
        }
        root.ref.blob.opacity = 0;
    };

    var explodeBlob = function explodeBlob(_ref4) {
        var root = _ref4.root;
        if (!root.ref.blob) {
            return;
        }
        root.ref.blob.scaleX = 2.5;
        root.ref.blob.scaleY = 2.5;
        root.ref.blob.opacity = 0;
    };

    var write$7 = function write(_ref5) {
        var root = _ref5.root,
            props = _ref5.props,
            actions = _ref5.actions;
        route$4({ root: root, props: props, actions: actions });
        var blob = root.ref.blob;

        if (actions.length === 0 && blob && blob.opacity === 0) {
            root.removeChildView(blob);
            root.ref.blob = null;
        }
    };

    var route$4 = createRoute({
        DID_DRAG: moveBlob,
        DID_DROP: explodeBlob,
        DID_END_DRAG: hideBlob,
    });

    var drip = createView({
        ignoreRect: true,
        ignoreRectUpdate: true,
        name: 'drip',
        write: write$7,
    });

    var setInputFiles = function setInputFiles(element, files) {
        try {
            // Create a DataTransfer instance and add a newly created file
            var dataTransfer = new DataTransfer();
            files.forEach(function(file) {
                if (file instanceof File) {
                    dataTransfer.items.add(file);
                } else {
                    dataTransfer.items.add(
                        new File([file], file.name, {
                            type: file.type,
                        })
                    );
                }
            });

            // Assign the DataTransfer files list to the file input
            element.files = dataTransfer.files;
        } catch (err) {
            return false;
        }
        return true;
    };

    var create$c = function create(_ref) {
        var root = _ref.root;
        return (root.ref.fields = {});
    };

    var getField = function getField(root, id) {
        return root.ref.fields[id];
    };

    var syncFieldPositionsWithItems = function syncFieldPositionsWithItems(root) {
        root.query('GET_ACTIVE_ITEMS').forEach(function(item) {
            if (!root.ref.fields[item.id]) return;
            root.element.appendChild(root.ref.fields[item.id]);
        });
    };

    var didReorderItems = function didReorderItems(_ref2) {
        var root = _ref2.root;
        return syncFieldPositionsWithItems(root);
    };

    var didAddItem = function didAddItem(_ref3) {
        var root = _ref3.root,
            action = _ref3.action;
        var fileItem = root.query('GET_ITEM', action.id);
        var isLocalFile = fileItem.origin === FileOrigin.LOCAL;
        var shouldUseFileInput = !isLocalFile && root.query('SHOULD_UPDATE_FILE_INPUT');
        var dataContainer = createElement$1('input');
        dataContainer.type = shouldUseFileInput ? 'file' : 'hidden';
        dataContainer.name = root.query('GET_NAME');
        dataContainer.disabled = root.query('GET_DISABLED');
        root.ref.fields[action.id] = dataContainer;
        syncFieldPositionsWithItems(root);
    };

    var didLoadItem$1 = function didLoadItem(_ref4) {
        var root = _ref4.root,
            action = _ref4.action;
        var field = getField(root, action.id);
        if (!field) return;

        // store server ref in hidden input
        if (action.serverFileReference !== null) field.value = action.serverFileReference;

        // store file item in file input
        if (!root.query('SHOULD_UPDATE_FILE_INPUT')) return;

        var fileItem = root.query('GET_ITEM', action.id);
        setInputFiles(field, [fileItem.file]);
    };

    var didPrepareOutput = function didPrepareOutput(_ref5) {
        var root = _ref5.root,
            action = _ref5.action;
        // this timeout pushes the handler after 'load'
        if (!root.query('SHOULD_UPDATE_FILE_INPUT')) return;
        setTimeout(function() {
            var field = getField(root, action.id);
            if (!field) return;
            setInputFiles(field, [action.file]);
        }, 0);
    };

    var didSetDisabled = function didSetDisabled(_ref6) {
        var root = _ref6.root;
        root.element.disabled = root.query('GET_DISABLED');
    };

    var didRemoveItem = function didRemoveItem(_ref7) {
        var root = _ref7.root,
            action = _ref7.action;
        var field = getField(root, action.id);
        if (!field) return;
        if (field.parentNode) field.parentNode.removeChild(field);
        delete root.ref.fields[action.id];
    };

    // only runs for server files (so doesn't deal with file input)
    var didDefineValue = function didDefineValue(_ref8) {
        var root = _ref8.root,
            action = _ref8.action;
        var field = getField(root, action.id);
        if (!field) return;
        if (action.value === null) {
            // clear field value
            field.removeAttribute('value');
        } else {
            // set field value
            field.value = action.value;
        }
        syncFieldPositionsWithItems(root);
    };

    var write$8 = createRoute({
        DID_SET_DISABLED: didSetDisabled,
        DID_ADD_ITEM: didAddItem,
        DID_LOAD_ITEM: didLoadItem$1,
        DID_REMOVE_ITEM: didRemoveItem,
        DID_DEFINE_VALUE: didDefineValue,
        DID_PREPARE_OUTPUT: didPrepareOutput,
        DID_REORDER_ITEMS: didReorderItems,
        DID_SORT_ITEMS: didReorderItems,
    });

    var data = createView({
        tag: 'fieldset',
        name: 'data',
        create: create$c,
        write: write$8,
        ignoreRect: true,
    });

    var getRootNode = function getRootNode(element) {
        return 'getRootNode' in element ? element.getRootNode() : document;
    };

    var images = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg', 'tiff'];
    var text$1 = ['css', 'csv', 'html', 'txt'];
    var map = {
        zip: 'zip|compressed',
        epub: 'application/epub+zip',
    };

    var guesstimateMimeType = function guesstimateMimeType() {
        var extension = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
        extension = extension.toLowerCase();
        if (images.includes(extension)) {
            return (
                'image/' +
                (extension === 'jpg' ? 'jpeg' : extension === 'svg' ? 'svg+xml' : extension)
            );
        }
        if (text$1.includes(extension)) {
            return 'text/' + extension;
        }

        return map[extension] || '';
    };

    var requestDataTransferItems = function requestDataTransferItems(dataTransfer) {
        return new Promise(function(resolve, reject) {
            // try to get links from transfer, if found we'll exit immediately (unless a file is in the dataTransfer as well, this is because Firefox could represent the file as a URL and a file object at the same time)
            var links = getLinks(dataTransfer);
            if (links.length && !hasFiles(dataTransfer)) {
                return resolve(links);
            }
            // try to get files from the transfer
            getFiles(dataTransfer).then(resolve);
        });
    };

    /**
     * Test if datatransfer has files
     */
    var hasFiles = function hasFiles(dataTransfer) {
        if (dataTransfer.files) return dataTransfer.files.length > 0;
        return false;
    };

    /**
     * Extracts files from a DataTransfer object
     */
    var getFiles = function getFiles(dataTransfer) {
        return new Promise(function(resolve, reject) {
            // get the transfer items as promises
            var promisedFiles = (dataTransfer.items ? Array.from(dataTransfer.items) : [])
                // only keep file system items (files and directories)
                .filter(function(item) {
                    return isFileSystemItem(item);
                })

                // map each item to promise
                .map(function(item) {
                    return getFilesFromItem(item);
                });

            // if is empty, see if we can extract some info from the files property as a fallback
            if (!promisedFiles.length) {
                // TODO: test for directories (should not be allowed)
                // Use FileReader, problem is that the files property gets lost in the process
                resolve(dataTransfer.files ? Array.from(dataTransfer.files) : []);
                return;
            }

            // done!
            Promise.all(promisedFiles)
                .then(function(returnedFileGroups) {
                    // flatten groups
                    var files = [];
                    returnedFileGroups.forEach(function(group) {
                        files.push.apply(files, group);
                    });

                    // done (filter out empty files)!
                    resolve(
                        files
                            .filter(function(file) {
                                return file;
                            })
                            .map(function(file) {
                                if (!file._relativePath)
                                    file._relativePath = file.webkitRelativePath;
                                return file;
                            })
                    );
                })
                .catch(console.error);
        });
    };

    var isFileSystemItem = function isFileSystemItem(item) {
        if (isEntry(item)) {
            var entry = getAsEntry(item);
            if (entry) {
                return entry.isFile || entry.isDirectory;
            }
        }
        return item.kind === 'file';
    };

    var getFilesFromItem = function getFilesFromItem(item) {
        return new Promise(function(resolve, reject) {
            if (isDirectoryEntry(item)) {
                getFilesInDirectory(getAsEntry(item))
                    .then(resolve)
                    .catch(reject);
                return;
            }

            resolve([item.getAsFile()]);
        });
    };

    var getFilesInDirectory = function getFilesInDirectory(entry) {
        return new Promise(function(resolve, reject) {
            var files = [];

            // the total entries to read
            var dirCounter = 0;
            var fileCounter = 0;

            var resolveIfDone = function resolveIfDone() {
                if (fileCounter === 0 && dirCounter === 0) {
                    resolve(files);
                }
            };

            // the recursive function
            var readEntries = function readEntries(dirEntry) {
                dirCounter++;

                var directoryReader = dirEntry.createReader();

                // directories are returned in batches, we need to process all batches before we're done
                var readBatch = function readBatch() {
                    directoryReader.readEntries(function(entries) {
                        if (entries.length === 0) {
                            dirCounter--;
                            resolveIfDone();
                            return;
                        }

                        entries.forEach(function(entry) {
                            // recursively read more directories
                            if (entry.isDirectory) {
                                readEntries(entry);
                            } else {
                                // read as file
                                fileCounter++;

                                entry.file(function(file) {
                                    var correctedFile = correctMissingFileType(file);
                                    if (entry.fullPath)
                                        correctedFile._relativePath = entry.fullPath;
                                    files.push(correctedFile);
                                    fileCounter--;
                                    resolveIfDone();
                                });
                            }
                        });

                        // try to get next batch of files
                        readBatch();
                    }, reject);
                };

                // read first batch of files
                readBatch();
            };

            // go!
            readEntries(entry);
        });
    };

    var correctMissingFileType = function correctMissingFileType(file) {
        if (file.type.length) return file;
        var date = file.lastModifiedDate;
        var name = file.name;
        var type = guesstimateMimeType(getExtensionFromFilename(file.name));
        if (!type.length) return file;
        file = file.slice(0, file.size, type);
        file.name = name;
        file.lastModifiedDate = date;
        return file;
    };

    var isDirectoryEntry = function isDirectoryEntry(item) {
        return isEntry(item) && (getAsEntry(item) || {}).isDirectory;
    };

    var isEntry = function isEntry(item) {
        return 'webkitGetAsEntry' in item;
    };

    var getAsEntry = function getAsEntry(item) {
        return item.webkitGetAsEntry();
    };

    /**
     * Extracts links from a DataTransfer object
     */
    var getLinks = function getLinks(dataTransfer) {
        var links = [];
        try {
            // look in meta data property
            links = getLinksFromTransferMetaData(dataTransfer);
            if (links.length) {
                return links;
            }
            links = getLinksFromTransferURLData(dataTransfer);
        } catch (e) {
            // nope nope nope (probably IE trouble)
        }
        return links;
    };

    var getLinksFromTransferURLData = function getLinksFromTransferURLData(dataTransfer) {
        var data = dataTransfer.getData('url');
        if (typeof data === 'string' && data.length) {
            return [data];
        }
        return [];
    };

    var getLinksFromTransferMetaData = function getLinksFromTransferMetaData(dataTransfer) {
        var data = dataTransfer.getData('text/html');
        if (typeof data === 'string' && data.length) {
            var matches = data.match(/src\s*=\s*"(.+?)"/);
            if (matches) {
                return [matches[1]];
            }
        }
        return [];
    };

    var dragNDropObservers = [];

    var eventPosition = function eventPosition(e) {
        return {
            pageLeft: e.pageX,
            pageTop: e.pageY,
            scopeLeft: e.offsetX || e.layerX,
            scopeTop: e.offsetY || e.layerY,
        };
    };

    var createDragNDropClient = function createDragNDropClient(
        element,
        scopeToObserve,
        filterElement
    ) {
        var observer = getDragNDropObserver(scopeToObserve);

        var client = {
            element: element,
            filterElement: filterElement,
            state: null,
            ondrop: function ondrop() {},
            onenter: function onenter() {},
            ondrag: function ondrag() {},
            onexit: function onexit() {},
            onload: function onload() {},
            allowdrop: function allowdrop() {},
        };

        client.destroy = observer.addListener(client);

        return client;
    };

    var getDragNDropObserver = function getDragNDropObserver(element) {
        // see if already exists, if so, return
        var observer = dragNDropObservers.find(function(item) {
            return item.element === element;
        });
        if (observer) {
            return observer;
        }

        // create new observer, does not yet exist for this element
        var newObserver = createDragNDropObserver(element);
        dragNDropObservers.push(newObserver);
        return newObserver;
    };

    var createDragNDropObserver = function createDragNDropObserver(element) {
        var clients = [];

        var routes = {
            dragenter: dragenter,
            dragover: dragover,
            dragleave: dragleave,
            drop: drop,
        };

        var handlers = {};

        forin(routes, function(event, createHandler) {
            handlers[event] = createHandler(element, clients);
            element.addEventListener(event, handlers[event], false);
        });

        var observer = {
            element: element,
            addListener: function addListener(client) {
                // add as client
                clients.push(client);

                // return removeListener function
                return function() {
                    // remove client
                    clients.splice(clients.indexOf(client), 1);

                    // if no more clients, clean up observer
                    if (clients.length === 0) {
                        dragNDropObservers.splice(dragNDropObservers.indexOf(observer), 1);

                        forin(routes, function(event) {
                            element.removeEventListener(event, handlers[event], false);
                        });
                    }
                };
            },
        };

        return observer;
    };

    var elementFromPoint = function elementFromPoint(root, point) {
        if (!('elementFromPoint' in root)) {
            root = document;
        }
        return root.elementFromPoint(point.x, point.y);
    };

    var isEventTarget = function isEventTarget(e, target) {
        // get root
        var root = getRootNode(target);

        // get element at position
        // if root is not actual shadow DOM and does not have elementFromPoint method, use the one on document
        var elementAtPosition = elementFromPoint(root, {
            x: e.pageX - window.pageXOffset,
            y: e.pageY - window.pageYOffset,
        });

        // test if target is the element or if one of its children is
        return elementAtPosition === target || target.contains(elementAtPosition);
    };

    var initialTarget = null;

    var setDropEffect = function setDropEffect(dataTransfer, effect) {
        // is in try catch as IE11 will throw error if not
        try {
            dataTransfer.dropEffect = effect;
        } catch (e) {}
    };

    var dragenter = function dragenter(root, clients) {
        return function(e) {
            e.preventDefault();

            initialTarget = e.target;

            clients.forEach(function(client) {
                var element = client.element,
                    onenter = client.onenter;

                if (isEventTarget(e, element)) {
                    client.state = 'enter';

                    // fire enter event
                    onenter(eventPosition(e));
                }
            });
        };
    };

    var dragover = function dragover(root, clients) {
        return function(e) {
            e.preventDefault();

            var dataTransfer = e.dataTransfer;

            requestDataTransferItems(dataTransfer).then(function(items) {
                var overDropTarget = false;

                clients.some(function(client) {
                    var filterElement = client.filterElement,
                        element = client.element,
                        onenter = client.onenter,
                        onexit = client.onexit,
                        ondrag = client.ondrag,
                        allowdrop = client.allowdrop;

                    // by default we can drop
                    setDropEffect(dataTransfer, 'copy');

                    // allow transfer of these items
                    var allowsTransfer = allowdrop(items);

                    // only used when can be dropped on page
                    if (!allowsTransfer) {
                        setDropEffect(dataTransfer, 'none');
                        return;
                    }

                    // targetting this client
                    if (isEventTarget(e, element)) {
                        overDropTarget = true;

                        // had no previous state, means we are entering this client
                        if (client.state === null) {
                            client.state = 'enter';
                            onenter(eventPosition(e));
                            return;
                        }

                        // now over element (no matter if it allows the drop or not)
                        client.state = 'over';

                        // needs to allow transfer
                        if (filterElement && !allowsTransfer) {
                            setDropEffect(dataTransfer, 'none');
                            return;
                        }

                        // dragging
                        ondrag(eventPosition(e));
                    } else {
                        // should be over an element to drop
                        if (filterElement && !overDropTarget) {
                            setDropEffect(dataTransfer, 'none');
                        }

                        // might have just left this client?
                        if (client.state) {
                            client.state = null;
                            onexit(eventPosition(e));
                        }
                    }
                });
            });
        };
    };

    var drop = function drop(root, clients) {
        return function(e) {
            e.preventDefault();

            var dataTransfer = e.dataTransfer;

            requestDataTransferItems(dataTransfer).then(function(items) {
                clients.forEach(function(client) {
                    var filterElement = client.filterElement,
                        element = client.element,
                        ondrop = client.ondrop,
                        onexit = client.onexit,
                        allowdrop = client.allowdrop;

                    client.state = null;

                    // if we're filtering on element we need to be over the element to drop
                    if (filterElement && !isEventTarget(e, element)) return;

                    // no transfer for this client
                    if (!allowdrop(items)) return onexit(eventPosition(e));

                    // we can drop these items on this client
                    ondrop(eventPosition(e), items);
                });
            });
        };
    };

    var dragleave = function dragleave(root, clients) {
        return function(e) {
            if (initialTarget !== e.target) {
                return;
            }

            clients.forEach(function(client) {
                var onexit = client.onexit;

                client.state = null;

                onexit(eventPosition(e));
            });
        };
    };

    var createHopper = function createHopper(scope, validateItems, options) {
        // is now hopper scope
        scope.classList.add('filepond--hopper');

        // shortcuts
        var catchesDropsOnPage = options.catchesDropsOnPage,
            requiresDropOnElement = options.requiresDropOnElement,
            _options$filterItems = options.filterItems,
            filterItems =
                _options$filterItems === void 0
                    ? function(items) {
                          return items;
                      }
                    : _options$filterItems;

        // create a dnd client
        var client = createDragNDropClient(
            scope,
            catchesDropsOnPage ? document.documentElement : scope,
            requiresDropOnElement
        );

        // current client state
        var lastState = '';
        var currentState = '';

        // determines if a file may be dropped
        client.allowdrop = function(items) {
            // TODO: if we can, throw error to indicate the items cannot by dropped

            return validateItems(filterItems(items));
        };

        client.ondrop = function(position, items) {
            var filteredItems = filterItems(items);

            if (!validateItems(filteredItems)) {
                api.ondragend(position);
                return;
            }

            currentState = 'drag-drop';

            api.onload(filteredItems, position);
        };

        client.ondrag = function(position) {
            api.ondrag(position);
        };

        client.onenter = function(position) {
            currentState = 'drag-over';

            api.ondragstart(position);
        };

        client.onexit = function(position) {
            currentState = 'drag-exit';

            api.ondragend(position);
        };

        var api = {
            updateHopperState: function updateHopperState() {
                if (lastState !== currentState) {
                    scope.dataset.hopperState = currentState;
                    lastState = currentState;
                }
            },
            onload: function onload() {},
            ondragstart: function ondragstart() {},
            ondrag: function ondrag() {},
            ondragend: function ondragend() {},
            destroy: function destroy() {
                // destroy client
                client.destroy();
            },
        };

        return api;
    };

    var listening = false;
    var listeners$1 = [];

    var handlePaste = function handlePaste(e) {
        // if is pasting in input or textarea and the target is outside of a filepond scope, ignore
        var activeEl = document.activeElement;
        if (activeEl && /textarea|input/i.test(activeEl.nodeName)) {
            // test textarea or input is contained in filepond root
            var inScope = false;
            var element = activeEl;
            while (element !== document.body) {
                if (element.classList.contains('filepond--root')) {
                    inScope = true;
                    break;
                }
                element = element.parentNode;
            }

            if (!inScope) return;
        }

        requestDataTransferItems(e.clipboardData).then(function(files) {
            // no files received
            if (!files.length) {
                return;
            }

            // notify listeners of received files
            listeners$1.forEach(function(listener) {
                return listener(files);
            });
        });
    };

    var listen = function listen(cb) {
        // can't add twice
        if (listeners$1.includes(cb)) {
            return;
        }

        // add initial listener
        listeners$1.push(cb);

        // setup paste listener for entire page
        if (listening) {
            return;
        }

        listening = true;
        document.addEventListener('paste', handlePaste);
    };

    var unlisten = function unlisten(listener) {
        arrayRemove(listeners$1, listeners$1.indexOf(listener));

        // clean up
        if (listeners$1.length === 0) {
            document.removeEventListener('paste', handlePaste);
            listening = false;
        }
    };

    var createPaster = function createPaster() {
        var cb = function cb(files) {
            api.onload(files);
        };

        var api = {
            destroy: function destroy() {
                unlisten(cb);
            },
            onload: function onload() {},
        };

        listen(cb);

        return api;
    };

    /**
     * Creates the file view
     */
    var create$d = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;
        root.element.id = 'filepond--assistant-' + props.id;
        attr(root.element, 'role', 'status');
        attr(root.element, 'aria-live', 'polite');
        attr(root.element, 'aria-relevant', 'additions');
    };

    var addFilesNotificationTimeout = null;
    var notificationClearTimeout = null;

    var filenames = [];

    var assist = function assist(root, message) {
        root.element.textContent = message;
    };

    var clear$1 = function clear(root) {
        root.element.textContent = '';
    };

    var listModified = function listModified(root, filename, label) {
        var total = root.query('GET_TOTAL_ITEMS');
        assist(
            root,
            label +
                ' ' +
                filename +
                ', ' +
                total +
                ' ' +
                (total === 1
                    ? root.query('GET_LABEL_FILE_COUNT_SINGULAR')
                    : root.query('GET_LABEL_FILE_COUNT_PLURAL'))
        );

        // clear group after set amount of time so the status is not read twice
        clearTimeout(notificationClearTimeout);
        notificationClearTimeout = setTimeout(function() {
            clear$1(root);
        }, 1500);
    };

    var isUsingFilePond = function isUsingFilePond(root) {
        return root.element.parentNode.contains(document.activeElement);
    };

    var itemAdded = function itemAdded(_ref2) {
        var root = _ref2.root,
            action = _ref2.action;
        if (!isUsingFilePond(root)) {
            return;
        }

        root.element.textContent = '';
        var item = root.query('GET_ITEM', action.id);
        filenames.push(item.filename);

        clearTimeout(addFilesNotificationTimeout);
        addFilesNotificationTimeout = setTimeout(function() {
            listModified(root, filenames.join(', '), root.query('GET_LABEL_FILE_ADDED'));

            filenames.length = 0;
        }, 750);
    };

    var itemRemoved = function itemRemoved(_ref3) {
        var root = _ref3.root,
            action = _ref3.action;
        if (!isUsingFilePond(root)) {
            return;
        }

        var item = action.item;
        listModified(root, item.filename, root.query('GET_LABEL_FILE_REMOVED'));
    };

    var itemProcessed = function itemProcessed(_ref4) {
        var root = _ref4.root,
            action = _ref4.action;
        // will also notify the user when FilePond is not being used, as the user might be occupied with other activities while uploading a file

        var item = root.query('GET_ITEM', action.id);
        var filename = item.filename;
        var label = root.query('GET_LABEL_FILE_PROCESSING_COMPLETE');

        assist(root, filename + ' ' + label);
    };

    var itemProcessedUndo = function itemProcessedUndo(_ref5) {
        var root = _ref5.root,
            action = _ref5.action;
        var item = root.query('GET_ITEM', action.id);
        var filename = item.filename;
        var label = root.query('GET_LABEL_FILE_PROCESSING_ABORTED');

        assist(root, filename + ' ' + label);
    };

    var itemError = function itemError(_ref6) {
        var root = _ref6.root,
            action = _ref6.action;
        var item = root.query('GET_ITEM', action.id);
        var filename = item.filename;

        // will also notify the user when FilePond is not being used, as the user might be occupied with other activities while uploading a file

        assist(root, action.status.main + ' ' + filename + ' ' + action.status.sub);
    };

    var assistant = createView({
        create: create$d,
        ignoreRect: true,
        ignoreRectUpdate: true,
        write: createRoute({
            DID_LOAD_ITEM: itemAdded,
            DID_REMOVE_ITEM: itemRemoved,
            DID_COMPLETE_ITEM_PROCESSING: itemProcessed,

            DID_ABORT_ITEM_PROCESSING: itemProcessedUndo,
            DID_REVERT_ITEM_PROCESSING: itemProcessedUndo,

            DID_THROW_ITEM_REMOVE_ERROR: itemError,
            DID_THROW_ITEM_LOAD_ERROR: itemError,
            DID_THROW_ITEM_INVALID: itemError,
            DID_THROW_ITEM_PROCESSING_ERROR: itemError,
        }),

        tag: 'span',
        name: 'assistant',
    });

    var toCamels = function toCamels(string) {
        var separator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '-';
        return string.replace(new RegExp(separator + '.', 'g'), function(sub) {
            return sub.charAt(1).toUpperCase();
        });
    };

    var debounce = function debounce(func) {
        var interval = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 16;
        var immidiateOnly =
            arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
        var last = Date.now();
        var timeout = null;

        return function() {
            for (
                var _len = arguments.length, args = new Array(_len), _key = 0;
                _key < _len;
                _key++
            ) {
                args[_key] = arguments[_key];
            }
            clearTimeout(timeout);

            var dist = Date.now() - last;

            var fn = function fn() {
                last = Date.now();
                func.apply(void 0, args);
            };

            if (dist < interval) {
                // we need to delay by the difference between interval and dist
                // for example: if distance is 10 ms and interval is 16 ms,
                // we need to wait an additional 6ms before calling the function)
                if (!immidiateOnly) {
                    timeout = setTimeout(fn, interval - dist);
                }
            } else {
                // go!
                fn();
            }
        };
    };

    var MAX_FILES_LIMIT = 1000000;

    var prevent = function prevent(e) {
        return e.preventDefault();
    };

    var create$e = function create(_ref) {
        var root = _ref.root,
            props = _ref.props;
        // Add id
        var id = root.query('GET_ID');
        if (id) {
            root.element.id = id;
        }

        // Add className
        var className = root.query('GET_CLASS_NAME');
        if (className) {
            className
                .split(' ')
                .filter(function(name) {
                    return name.length;
                })
                .forEach(function(name) {
                    root.element.classList.add(name);
                });
        }

        // Field label
        root.ref.label = root.appendChildView(
            root.createChildView(
                dropLabel,
                Object.assign({}, props, {
                    translateY: null,
                    caption: root.query('GET_LABEL_IDLE'),
                })
            )
        );

        // List of items
        root.ref.list = root.appendChildView(
            root.createChildView(listScroller, { translateY: null })
        );

        // Background panel
        root.ref.panel = root.appendChildView(root.createChildView(panel, { name: 'panel-root' }));

        // Assistant notifies assistive tech when content changes
        root.ref.assistant = root.appendChildView(
            root.createChildView(assistant, Object.assign({}, props))
        );

        // Data
        root.ref.data = root.appendChildView(root.createChildView(data, Object.assign({}, props)));

        // Measure (tests if fixed height was set)
        // DOCTYPE needs to be set for this to work
        root.ref.measure = createElement$1('div');
        root.ref.measure.style.height = '100%';
        root.element.appendChild(root.ref.measure);

        // information on the root height or fixed height status
        root.ref.bounds = null;

        // apply initial style properties
        root.query('GET_STYLES')
            .filter(function(style) {
                return !isEmpty(style.value);
            })
            .map(function(_ref2) {
                var name = _ref2.name,
                    value = _ref2.value;
                root.element.dataset[name] = value;
            });

        // determine if width changed
        root.ref.widthPrevious = null;
        root.ref.widthUpdated = debounce(function() {
            root.ref.updateHistory = [];
            root.dispatch('DID_RESIZE_ROOT');
        }, 250);

        // history of updates
        root.ref.previousAspectRatio = null;
        root.ref.updateHistory = [];

        // prevent scrolling and zooming on iOS (only if supports pointer events, for then we can enable reorder)
        var canHover = window.matchMedia('(pointer: fine) and (hover: hover)').matches;
        var hasPointerEvents = 'PointerEvent' in window;
        if (root.query('GET_ALLOW_REORDER') && hasPointerEvents && !canHover) {
            root.element.addEventListener('touchmove', prevent, { passive: false });
            root.element.addEventListener('gesturestart', prevent);
        }

        // add credits
        var credits = root.query('GET_CREDITS');
        var hasCredits = credits.length === 2;
        if (hasCredits) {
            var frag = document.createElement('a');
            frag.className = 'filepond--credits';
            frag.setAttribute('aria-hidden', 'true');
            frag.href = credits[0];
            frag.tabindex = -1;
            frag.target = '_blank';
            frag.rel = 'noopener noreferrer';
            frag.textContent = credits[1];
            root.element.appendChild(frag);
            root.ref.credits = frag;
        }
    };

    var write$9 = function write(_ref3) {
        var root = _ref3.root,
            props = _ref3.props,
            actions = _ref3.actions;
        // route actions
        route$5({ root: root, props: props, actions: actions });

        // apply style properties
        actions
            .filter(function(action) {
                return /^DID_SET_STYLE_/.test(action.type);
            })
            .filter(function(action) {
                return !isEmpty(action.data.value);
            })
            .map(function(_ref4) {
                var type = _ref4.type,
                    data = _ref4.data;
                var name = toCamels(type.substring(8).toLowerCase(), '_');
                root.element.dataset[name] = data.value;
                root.invalidateLayout();
            });

        if (root.rect.element.hidden) return;

        if (root.rect.element.width !== root.ref.widthPrevious) {
            root.ref.widthPrevious = root.rect.element.width;
            root.ref.widthUpdated();
        }

        // get box bounds, we do this only once
        var bounds = root.ref.bounds;
        if (!bounds) {
            bounds = root.ref.bounds = calculateRootBoundingBoxHeight(root);

            // destroy measure element
            root.element.removeChild(root.ref.measure);
            root.ref.measure = null;
        }

        // get quick references to various high level parts of the upload tool
        var _root$ref = root.ref,
            hopper = _root$ref.hopper,
            label = _root$ref.label,
            list = _root$ref.list,
            panel = _root$ref.panel;

        // sets correct state to hopper scope
        if (hopper) {
            hopper.updateHopperState();
        }

        // bool to indicate if we're full or not
        var aspectRatio = root.query('GET_PANEL_ASPECT_RATIO');
        var isMultiItem = root.query('GET_ALLOW_MULTIPLE');
        var totalItems = root.query('GET_TOTAL_ITEMS');
        var maxItems = isMultiItem ? root.query('GET_MAX_FILES') || MAX_FILES_LIMIT : 1;
        var atMaxCapacity = totalItems === maxItems;

        // action used to add item
        var addAction = actions.find(function(action) {
            return action.type === 'DID_ADD_ITEM';
        });

        // if reached max capacity and we've just reached it
        if (atMaxCapacity && addAction) {
            // get interaction type
            var interactionMethod = addAction.data.interactionMethod;

            // hide label
            label.opacity = 0;

            if (isMultiItem) {
                label.translateY = -40;
            } else {
                if (interactionMethod === InteractionMethod.API) {
                    label.translateX = 40;
                } else if (interactionMethod === InteractionMethod.BROWSE) {
                    label.translateY = 40;
                } else {
                    label.translateY = 30;
                }
            }
        } else if (!atMaxCapacity) {
            label.opacity = 1;
            label.translateX = 0;
            label.translateY = 0;
        }

        var listItemMargin = calculateListItemMargin(root);

        var listHeight = calculateListHeight(root);

        var labelHeight = label.rect.element.height;
        var currentLabelHeight = !isMultiItem || atMaxCapacity ? 0 : labelHeight;

        var listMarginTop = atMaxCapacity ? list.rect.element.marginTop : 0;
        var listMarginBottom = totalItems === 0 ? 0 : list.rect.element.marginBottom;

        var visualHeight =
            currentLabelHeight + listMarginTop + listHeight.visual + listMarginBottom;
        var boundsHeight =
            currentLabelHeight + listMarginTop + listHeight.bounds + listMarginBottom;

        // link list to label bottom position
        list.translateY =
            Math.max(0, currentLabelHeight - list.rect.element.marginTop) - listItemMargin.top;

        if (aspectRatio) {
            // fixed aspect ratio

            // calculate height based on width
            var width = root.rect.element.width;
            var height = width * aspectRatio;

            // clear history if aspect ratio has changed
            if (aspectRatio !== root.ref.previousAspectRatio) {
                root.ref.previousAspectRatio = aspectRatio;
                root.ref.updateHistory = [];
            }

            // remember this width
            var history = root.ref.updateHistory;
            history.push(width);

            var MAX_BOUNCES = 2;
            if (history.length > MAX_BOUNCES * 2) {
                var l = history.length;
                var bottom = l - 10;
                var bounces = 0;
                for (var i = l; i >= bottom; i--) {
                    if (history[i] === history[i - 2]) {
                        bounces++;
                    }

                    if (bounces >= MAX_BOUNCES) {
                        // dont adjust height
                        return;
                    }
                }
            }

            // fix height of panel so it adheres to aspect ratio
            panel.scalable = false;
            panel.height = height;

            // available height for list
            var listAvailableHeight =
                // the height of the panel minus the label height
                height -
                currentLabelHeight -
                // the room we leave open between the end of the list and the panel bottom
                (listMarginBottom - listItemMargin.bottom) -
                // if we're full we need to leave some room between the top of the panel and the list
                (atMaxCapacity ? listMarginTop : 0);

            if (listHeight.visual > listAvailableHeight) {
                list.overflow = listAvailableHeight;
            } else {
                list.overflow = null;
            }

            // set container bounds (so pushes siblings downwards)
            root.height = height;
        } else if (bounds.fixedHeight) {
            // fixed height

            // fix height of panel
            panel.scalable = false;

            // available height for list
            var _listAvailableHeight =
                // the height of the panel minus the label height
                bounds.fixedHeight -
                currentLabelHeight -
                // the room we leave open between the end of the list and the panel bottom
                (listMarginBottom - listItemMargin.bottom) -
                // if we're full we need to leave some room between the top of the panel and the list
                (atMaxCapacity ? listMarginTop : 0);

            // set list height
            if (listHeight.visual > _listAvailableHeight) {
                list.overflow = _listAvailableHeight;
            } else {
                list.overflow = null;
            }

            // no need to set container bounds as these are handles by CSS fixed height
        } else if (bounds.cappedHeight) {
            // max-height

            // not a fixed height panel
            var isCappedHeight = visualHeight >= bounds.cappedHeight;
            var panelHeight = Math.min(bounds.cappedHeight, visualHeight);
            panel.scalable = true;
            panel.height = isCappedHeight
                ? panelHeight
                : panelHeight - listItemMargin.top - listItemMargin.bottom;

            // available height for list
            var _listAvailableHeight2 =
                // the height of the panel minus the label height
                panelHeight -
                currentLabelHeight -
                // the room we leave open between the end of the list and the panel bottom
                (listMarginBottom - listItemMargin.bottom) -
                // if we're full we need to leave some room between the top of the panel and the list
                (atMaxCapacity ? listMarginTop : 0);

            // set list height (if is overflowing)
            if (visualHeight > bounds.cappedHeight && listHeight.visual > _listAvailableHeight2) {
                list.overflow = _listAvailableHeight2;
            } else {
                list.overflow = null;
            }

            // set container bounds (so pushes siblings downwards)
            root.height = Math.min(
                bounds.cappedHeight,
                boundsHeight - listItemMargin.top - listItemMargin.bottom
            );
        } else {
            // flexible height

            // not a fixed height panel
            var itemMargin = totalItems > 0 ? listItemMargin.top + listItemMargin.bottom : 0;
            panel.scalable = true;
            panel.height = Math.max(labelHeight, visualHeight - itemMargin);

            // set container bounds (so pushes siblings downwards)
            root.height = Math.max(labelHeight, boundsHeight - itemMargin);
        }

        // move credits to bottom
        if (root.ref.credits && panel.heightCurrent)
            root.ref.credits.style.transform = 'translateY(' + panel.heightCurrent + 'px)';
    };

    var calculateListItemMargin = function calculateListItemMargin(root) {
        var item = root.ref.list.childViews[0].childViews[0];
        return item
            ? {
                  top: item.rect.element.marginTop,
                  bottom: item.rect.element.marginBottom,
              }
            : {
                  top: 0,
                  bottom: 0,
              };
    };

    var calculateListHeight = function calculateListHeight(root) {
        var visual = 0;
        var bounds = 0;

        // get file list reference
        var scrollList = root.ref.list;
        var itemList = scrollList.childViews[0];
        var visibleChildren = itemList.childViews.filter(function(child) {
            return child.rect.element.height;
        });
        var children = root
            .query('GET_ACTIVE_ITEMS')
            .map(function(item) {
                return visibleChildren.find(function(child) {
                    return child.id === item.id;
                });
            })
            .filter(function(item) {
                return item;
            });

        // no children, done!
        if (children.length === 0) return { visual: visual, bounds: bounds };

        var horizontalSpace = itemList.rect.element.width;
        var dragIndex = getItemIndexByPosition(itemList, children, scrollList.dragCoordinates);

        var childRect = children[0].rect.element;

        var itemVerticalMargin = childRect.marginTop + childRect.marginBottom;
        var itemHorizontalMargin = childRect.marginLeft + childRect.marginRight;

        var itemWidth = childRect.width + itemHorizontalMargin;
        var itemHeight = childRect.height + itemVerticalMargin;

        var newItem = typeof dragIndex !== 'undefined' && dragIndex >= 0 ? 1 : 0;
        var removedItem = children.find(function(child) {
            return child.markedForRemoval && child.opacity < 0.45;
        })
            ? -1
            : 0;
        var verticalItemCount = children.length + newItem + removedItem;
        var itemsPerRow = getItemsPerRow(horizontalSpace, itemWidth);

        // stack
        if (itemsPerRow === 1) {
            children.forEach(function(item) {
                var height = item.rect.element.height + itemVerticalMargin;
                bounds += height;
                visual += height * item.opacity;
            });
        }
        // grid
        else {
            bounds = Math.ceil(verticalItemCount / itemsPerRow) * itemHeight;
            visual = bounds;
        }

        return { visual: visual, bounds: bounds };
    };

    var calculateRootBoundingBoxHeight = function calculateRootBoundingBoxHeight(root) {
        var height = root.ref.measureHeight || null;
        var cappedHeight = parseInt(root.style.maxHeight, 10) || null;
        var fixedHeight = height === 0 ? null : height;

        return {
            cappedHeight: cappedHeight,
            fixedHeight: fixedHeight,
        };
    };

    var exceedsMaxFiles = function exceedsMaxFiles(root, items) {
        var allowReplace = root.query('GET_ALLOW_REPLACE');
        var allowMultiple = root.query('GET_ALLOW_MULTIPLE');
        var totalItems = root.query('GET_TOTAL_ITEMS');
        var maxItems = root.query('GET_MAX_FILES');

        // total amount of items being dragged
        var totalBrowseItems = items.length;

        // if does not allow multiple items and dragging more than one item
        if (!allowMultiple && totalBrowseItems > 1) {
            root.dispatch('DID_THROW_MAX_FILES', {
                source: items,
                error: createResponse('warning', 0, 'Max files'),
            });

            return true;
        }

        // limit max items to one if not allowed to drop multiple items
        maxItems = allowMultiple ? maxItems : 1;

        if (!allowMultiple && allowReplace) {
            // There is only one item, so there is room to replace or add an item
            return false;
        }

        // no more room?
        var hasMaxItems = isInt(maxItems);
        if (hasMaxItems && totalItems + totalBrowseItems > maxItems) {
            root.dispatch('DID_THROW_MAX_FILES', {
                source: items,
                error: createResponse('warning', 0, 'Max files'),
            });

            return true;
        }

        return false;
    };

    var getDragIndex = function getDragIndex(list, children, position) {
        var itemList = list.childViews[0];
        return getItemIndexByPosition(itemList, children, {
            left: position.scopeLeft - itemList.rect.element.left,
            top:
                position.scopeTop -
                (list.rect.outer.top + list.rect.element.marginTop + list.rect.element.scrollTop),
        });
    };

    /**
     * Enable or disable file drop functionality
     */
    var toggleDrop = function toggleDrop(root) {
        var isAllowed = root.query('GET_ALLOW_DROP');
        var isDisabled = root.query('GET_DISABLED');
        var enabled = isAllowed && !isDisabled;
        if (enabled && !root.ref.hopper) {
            var hopper = createHopper(
                root.element,
                function(items) {
                    // allow quick validation of dropped items
                    var beforeDropFile =
                        root.query('GET_BEFORE_DROP_FILE') ||
                        function() {
                            return true;
                        };

                    // all items should be validated by all filters as valid
                    var dropValidation = root.query('GET_DROP_VALIDATION');
                    return dropValidation
                        ? items.every(function(item) {
                              return (
                                  applyFilters('ALLOW_HOPPER_ITEM', item, {
                                      query: root.query,
                                  }).every(function(result) {
                                      return result === true;
                                  }) && beforeDropFile(item)
                              );
                          })
                        : true;
                },
                {
                    filterItems: function filterItems(items) {
                        var ignoredFiles = root.query('GET_IGNORED_FILES');
                        return items.filter(function(item) {
                            if (isFile(item)) {
                                return !ignoredFiles.includes(item.name.toLowerCase());
                            }
                            return true;
                        });
                    },
                    catchesDropsOnPage: root.query('GET_DROP_ON_PAGE'),
                    requiresDropOnElement: root.query('GET_DROP_ON_ELEMENT'),
                }
            );

            hopper.onload = function(items, position) {
                // get item children elements and sort based on list sort
                var list = root.ref.list.childViews[0];
                var visibleChildren = list.childViews.filter(function(child) {
                    return child.rect.element.height;
                });
                var children = root
                    .query('GET_ACTIVE_ITEMS')
                    .map(function(item) {
                        return visibleChildren.find(function(child) {
                            return child.id === item.id;
                        });
                    })
                    .filter(function(item) {
                        return item;
                    });

                applyFilterChain('ADD_ITEMS', items, { dispatch: root.dispatch }).then(function(
                    queue
                ) {
                    // these files don't fit so stop here
                    if (exceedsMaxFiles(root, queue)) return false;

                    // go
                    root.dispatch('ADD_ITEMS', {
                        items: queue,
                        index: getDragIndex(root.ref.list, children, position),
                        interactionMethod: InteractionMethod.DROP,
                    });
                });

                root.dispatch('DID_DROP', { position: position });

                root.dispatch('DID_END_DRAG', { position: position });
            };

            hopper.ondragstart = function(position) {
                root.dispatch('DID_START_DRAG', { position: position });
            };

            hopper.ondrag = debounce(function(position) {
                root.dispatch('DID_DRAG', { position: position });
            });

            hopper.ondragend = function(position) {
                root.dispatch('DID_END_DRAG', { position: position });
            };

            root.ref.hopper = hopper;

            root.ref.drip = root.appendChildView(root.createChildView(drip));
        } else if (!enabled && root.ref.hopper) {
            root.ref.hopper.destroy();
            root.ref.hopper = null;
            root.removeChildView(root.ref.drip);
        }
    };

    /**
     * Enable or disable browse functionality
     */
    var toggleBrowse = function toggleBrowse(root, props) {
        var isAllowed = root.query('GET_ALLOW_BROWSE');
        var isDisabled = root.query('GET_DISABLED');
        var enabled = isAllowed && !isDisabled;
        if (enabled && !root.ref.browser) {
            root.ref.browser = root.appendChildView(
                root.createChildView(
                    browser,
                    Object.assign({}, props, {
                        onload: function onload(items) {
                            applyFilterChain('ADD_ITEMS', items, {
                                dispatch: root.dispatch,
                            }).then(function(queue) {
                                // these files don't fit so stop here
                                if (exceedsMaxFiles(root, queue)) return false;

                                // add items!
                                root.dispatch('ADD_ITEMS', {
                                    items: queue,
                                    index: -1,
                                    interactionMethod: InteractionMethod.BROWSE,
                                });
                            });
                        },
                    })
                ),

                0
            );
        } else if (!enabled && root.ref.browser) {
            root.removeChildView(root.ref.browser);
            root.ref.browser = null;
        }
    };

    /**
     * Enable or disable paste functionality
     */
    var togglePaste = function togglePaste(root) {
        var isAllowed = root.query('GET_ALLOW_PASTE');
        var isDisabled = root.query('GET_DISABLED');
        var enabled = isAllowed && !isDisabled;
        if (enabled && !root.ref.paster) {
            root.ref.paster = createPaster();
            root.ref.paster.onload = function(items) {
                applyFilterChain('ADD_ITEMS', items, { dispatch: root.dispatch }).then(function(
                    queue
                ) {
                    // these files don't fit so stop here
                    if (exceedsMaxFiles(root, queue)) return false;

                    // add items!
                    root.dispatch('ADD_ITEMS', {
                        items: queue,
                        index: -1,
                        interactionMethod: InteractionMethod.PASTE,
                    });
                });
            };
        } else if (!enabled && root.ref.paster) {
            root.ref.paster.destroy();
            root.ref.paster = null;
        }
    };

    /**
     * Route actions
     */
    var route$5 = createRoute({
        DID_SET_ALLOW_BROWSE: function DID_SET_ALLOW_BROWSE(_ref5) {
            var root = _ref5.root,
                props = _ref5.props;
            toggleBrowse(root, props);
        },
        DID_SET_ALLOW_DROP: function DID_SET_ALLOW_DROP(_ref6) {
            var root = _ref6.root;
            toggleDrop(root);
        },
        DID_SET_ALLOW_PASTE: function DID_SET_ALLOW_PASTE(_ref7) {
            var root = _ref7.root;
            togglePaste(root);
        },
        DID_SET_DISABLED: function DID_SET_DISABLED(_ref8) {
            var root = _ref8.root,
                props = _ref8.props;
            toggleDrop(root);
            togglePaste(root);
            toggleBrowse(root, props);
            var isDisabled = root.query('GET_DISABLED');
            if (isDisabled) {
                root.element.dataset.disabled = 'disabled';
            } else {
                // delete root.element.dataset.disabled; <= this does not work on iOS 10
                root.element.removeAttribute('data-disabled');
            }
        },
    });

    var root = createView({
        name: 'root',
        read: function read(_ref9) {
            var root = _ref9.root;
            if (root.ref.measure) {
                root.ref.measureHeight = root.ref.measure.offsetHeight;
            }
        },
        create: create$e,
        write: write$9,
        destroy: function destroy(_ref10) {
            var root = _ref10.root;
            if (root.ref.paster) {
                root.ref.paster.destroy();
            }
            if (root.ref.hopper) {
                root.ref.hopper.destroy();
            }
            root.element.removeEventListener('touchmove', prevent);
            root.element.removeEventListener('gesturestart', prevent);
        },
        mixins: {
            styles: ['height'],
        },
    });

    // creates the app
    var createApp = function createApp() {
        var initialOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
        // let element
        var originalElement = null;

        // get default options
        var defaultOptions = getOptions();

        // create the data store, this will contain all our app info
        var store = createStore(
            // initial state (should be serializable)
            createInitialState(defaultOptions),

            // queries
            [queries, createOptionQueries(defaultOptions)],

            // action handlers
            [actions, createOptionActions(defaultOptions)]
        );

        // set initial options
        store.dispatch('SET_OPTIONS', { options: initialOptions });

        // kick thread if visibility changes
        var visibilityHandler = function visibilityHandler() {
            if (document.hidden) return;
            store.dispatch('KICK');
        };
        document.addEventListener('visibilitychange', visibilityHandler);

        // re-render on window resize start and finish
        var resizeDoneTimer = null;
        var isResizing = false;
        var isResizingHorizontally = false;
        var initialWindowWidth = null;
        var currentWindowWidth = null;
        var resizeHandler = function resizeHandler() {
            if (!isResizing) {
                isResizing = true;
            }
            clearTimeout(resizeDoneTimer);
            resizeDoneTimer = setTimeout(function() {
                isResizing = false;
                initialWindowWidth = null;
                currentWindowWidth = null;
                if (isResizingHorizontally) {
                    isResizingHorizontally = false;
                    store.dispatch('DID_STOP_RESIZE');
                }
            }, 500);
        };
        window.addEventListener('resize', resizeHandler);

        // render initial view
        var view = root(store, { id: getUniqueId() });

        //
        // PRIVATE API -------------------------------------------------------------------------------------
        //
        var isResting = false;
        var isHidden = false;

        var readWriteApi = {
            // necessary for update loop

            /**
             * Reads from dom (never call manually)
             * @private
             */
            _read: function _read() {
                // test if we're resizing horizontally
                // TODO: see if we can optimize this by measuring root rect
                if (isResizing) {
                    currentWindowWidth = window.innerWidth;
                    if (!initialWindowWidth) {
                        initialWindowWidth = currentWindowWidth;
                    }

                    if (!isResizingHorizontally && currentWindowWidth !== initialWindowWidth) {
                        store.dispatch('DID_START_RESIZE');
                        isResizingHorizontally = true;
                    }
                }

                if (isHidden && isResting) {
                    // test if is no longer hidden
                    isResting = view.element.offsetParent === null;
                }

                // if resting, no need to read as numbers will still all be correct
                if (isResting) return;

                // read view data
                view._read();

                // if is hidden we need to know so we exit rest mode when revealed
                isHidden = view.rect.element.hidden;
            },

            /**
             * Writes to dom (never call manually)
             * @private
             */
            _write: function _write(ts) {
                // get all actions from store
                var actions = store
                    .processActionQueue()

                    // filter out set actions (these will automatically trigger DID_SET)
                    .filter(function(action) {
                        return !/^SET_/.test(action.type);
                    });

                // if was idling and no actions stop here
                if (isResting && !actions.length) return;

                // some actions might trigger events
                routeActionsToEvents(actions);

                // update the view
                isResting = view._write(ts, actions, isResizingHorizontally);

                // will clean up all archived items
                removeReleasedItems(store.query('GET_ITEMS'));

                // now idling
                if (isResting) {
                    store.processDispatchQueue();
                }
            },
        };

        //
        // EXPOSE EVENTS -------------------------------------------------------------------------------------
        //
        var createEvent = function createEvent(name) {
            return function(data) {
                // create default event
                var event = {
                    type: name,
                };

                // no data to add
                if (!data) {
                    return event;
                }

                // copy relevant props
                if (data.hasOwnProperty('error')) {
                    event.error = data.error ? Object.assign({}, data.error) : null;
                }

                if (data.status) {
                    event.status = Object.assign({}, data.status);
                }

                if (data.file) {
                    event.output = data.file;
                }

                // only source is available, else add item if possible
                if (data.source) {
                    event.file = data.source;
                } else if (data.item || data.id) {
                    var item = data.item ? data.item : store.query('GET_ITEM', data.id);
                    event.file = item ? createItemAPI(item) : null;
                }

                // map all items in a possible items array
                if (data.items) {
                    event.items = data.items.map(createItemAPI);
                }

                // if this is a progress event add the progress amount
                if (/progress/.test(name)) {
                    event.progress = data.progress;
                }

                // copy relevant props
                if (data.hasOwnProperty('origin') && data.hasOwnProperty('target')) {
                    event.origin = data.origin;
                    event.target = data.target;
                }

                return event;
            };
        };

        var eventRoutes = {
            DID_DESTROY: createEvent('destroy'),

            DID_INIT: createEvent('init'),

            DID_THROW_MAX_FILES: createEvent('warning'),

            DID_INIT_ITEM: createEvent('initfile'),
            DID_START_ITEM_LOAD: createEvent('addfilestart'),
            DID_UPDATE_ITEM_LOAD_PROGRESS: createEvent('addfileprogress'),
            DID_LOAD_ITEM: createEvent('addfile'),

            DID_THROW_ITEM_INVALID: [createEvent('error'), createEvent('addfile')],

            DID_THROW_ITEM_LOAD_ERROR: [createEvent('error'), createEvent('addfile')],

            DID_THROW_ITEM_REMOVE_ERROR: [createEvent('error'), createEvent('removefile')],

            DID_PREPARE_OUTPUT: createEvent('preparefile'),

            DID_START_ITEM_PROCESSING: createEvent('processfilestart'),
            DID_UPDATE_ITEM_PROCESS_PROGRESS: createEvent('processfileprogress'),
            DID_ABORT_ITEM_PROCESSING: createEvent('processfileabort'),
            DID_COMPLETE_ITEM_PROCESSING: createEvent('processfile'),
            DID_COMPLETE_ITEM_PROCESSING_ALL: createEvent('processfiles'),
            DID_REVERT_ITEM_PROCESSING: createEvent('processfilerevert'),

            DID_THROW_ITEM_PROCESSING_ERROR: [createEvent('error'), createEvent('processfile')],

            DID_REMOVE_ITEM: createEvent('removefile'),

            DID_UPDATE_ITEMS: createEvent('updatefiles'),

            DID_ACTIVATE_ITEM: createEvent('activatefile'),

            DID_REORDER_ITEMS: createEvent('reorderfiles'),
        };

        var exposeEvent = function exposeEvent(event) {
            // create event object to be dispatched
            var detail = Object.assign({ pond: exports }, event);
            delete detail.type;
            view.element.dispatchEvent(
                new CustomEvent('FilePond:' + event.type, {
                    // event info
                    detail: detail,

                    // event behaviour
                    bubbles: true,
                    cancelable: true,
                    composed: true, // triggers listeners outside of shadow root
                })
            );

            // event object to params used for `on()` event handlers and callbacks `oninit()`
            var params = [];

            // if is possible error event, make it the first param
            if (event.hasOwnProperty('error')) {
                params.push(event.error);
            }

            // file is always section
            if (event.hasOwnProperty('file')) {
                params.push(event.file);
            }

            // append other props
            var filtered = ['type', 'error', 'file'];
            Object.keys(event)
                .filter(function(key) {
                    return !filtered.includes(key);
                })
                .forEach(function(key) {
                    return params.push(event[key]);
                });

            // on(type, () => { })
            exports.fire.apply(exports, [event.type].concat(params));

            // oninit = () => {}
            var handler = store.query('GET_ON' + event.type.toUpperCase());
            if (handler) {
                handler.apply(void 0, params);
            }
        };

        var routeActionsToEvents = function routeActionsToEvents(actions) {
            if (!actions.length) return;
            actions
                .filter(function(action) {
                    return eventRoutes[action.type];
                })
                .forEach(function(action) {
                    var routes = eventRoutes[action.type];
                    (Array.isArray(routes) ? routes : [routes]).forEach(function(route) {
                        // this isn't fantastic, but because of the stacking of settimeouts plugins can handle the did_load before the did_init
                        if (action.type === 'DID_INIT_ITEM') {
                            exposeEvent(route(action.data));
                        } else {
                            setTimeout(function() {
                                exposeEvent(route(action.data));
                            }, 0);
                        }
                    });
                });
        };

        //
        // PUBLIC API -------------------------------------------------------------------------------------
        //
        var setOptions = function setOptions(options) {
            return store.dispatch('SET_OPTIONS', { options: options });
        };

        var getFile = function getFile(query) {
            return store.query('GET_ACTIVE_ITEM', query);
        };

        var prepareFile = function prepareFile(query) {
            return new Promise(function(resolve, reject) {
                store.dispatch('REQUEST_ITEM_PREPARE', {
                    query: query,
                    success: function success(item) {
                        resolve(item);
                    },
                    failure: function failure(error) {
                        reject(error);
                    },
                });
            });
        };

        var addFile = function addFile(source) {
            var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
            return new Promise(function(resolve, reject) {
                addFiles([{ source: source, options: options }], { index: options.index })
                    .then(function(items) {
                        return resolve(items && items[0]);
                    })
                    .catch(reject);
            });
        };

        var isFilePondFile = function isFilePondFile(obj) {
            return obj.file && obj.id;
        };

        var removeFile = function removeFile(query, options) {
            // if only passed options
            if (typeof query === 'object' && !isFilePondFile(query) && !options) {
                options = query;
                query = undefined;
            }

            // request item removal
            store.dispatch('REMOVE_ITEM', Object.assign({}, options, { query: query }));

            // see if item has been removed
            return store.query('GET_ACTIVE_ITEM', query) === null;
        };

        var addFiles = function addFiles() {
            for (
                var _len = arguments.length, args = new Array(_len), _key = 0;
                _key < _len;
                _key++
            ) {
                args[_key] = arguments[_key];
            }
            return new Promise(function(resolve, reject) {
                var sources = [];
                var options = {};

                // user passed a sources array
                if (isArray(args[0])) {
                    sources.push.apply(sources, args[0]);
                    Object.assign(options, args[1] || {});
                } else {
                    // user passed sources as arguments, last one might be options object
                    var lastArgument = args[args.length - 1];
                    if (typeof lastArgument === 'object' && !(lastArgument instanceof Blob)) {
                        Object.assign(options, args.pop());
                    }

                    // add rest to sources
                    sources.push.apply(sources, args);
                }

                store.dispatch('ADD_ITEMS', {
                    items: sources,
                    index: options.index,
                    interactionMethod: InteractionMethod.API,
                    success: resolve,
                    failure: reject,
                });
            });
        };

        var getFiles = function getFiles() {
            return store.query('GET_ACTIVE_ITEMS');
        };

        var processFile = function processFile(query) {
            return new Promise(function(resolve, reject) {
                store.dispatch('REQUEST_ITEM_PROCESSING', {
                    query: query,
                    success: function success(item) {
                        resolve(item);
                    },
                    failure: function failure(error) {
                        reject(error);
                    },
                });
            });
        };

        var prepareFiles = function prepareFiles() {
            for (
                var _len2 = arguments.length, args = new Array(_len2), _key2 = 0;
                _key2 < _len2;
                _key2++
            ) {
                args[_key2] = arguments[_key2];
            }
            var queries = Array.isArray(args[0]) ? args[0] : args;
            var items = queries.length ? queries : getFiles();
            return Promise.all(items.map(prepareFile));
        };

        var processFiles = function processFiles() {
            for (
                var _len3 = arguments.length, args = new Array(_len3), _key3 = 0;
                _key3 < _len3;
                _key3++
            ) {
                args[_key3] = arguments[_key3];
            }
            var queries = Array.isArray(args[0]) ? args[0] : args;
            if (!queries.length) {
                var files = getFiles().filter(function(item) {
                    return (
                        !(item.status === ItemStatus.IDLE && item.origin === FileOrigin.LOCAL) &&
                        item.status !== ItemStatus.PROCESSING &&
                        item.status !== ItemStatus.PROCESSING_COMPLETE &&
                        item.status !== ItemStatus.PROCESSING_REVERT_ERROR
                    );
                });

                return Promise.all(files.map(processFile));
            }
            return Promise.all(queries.map(processFile));
        };

        var removeFiles = function removeFiles() {
            for (
                var _len4 = arguments.length, args = new Array(_len4), _key4 = 0;
                _key4 < _len4;
                _key4++
            ) {
                args[_key4] = arguments[_key4];
            }

            var queries = Array.isArray(args[0]) ? args[0] : args;

            var options;
            if (typeof queries[queries.length - 1] === 'object') {
                options = queries.pop();
            } else if (Array.isArray(args[0])) {
                options = args[1];
            }

            var files = getFiles();

            if (!queries.length)
                return Promise.all(
                    files.map(function(file) {
                        return removeFile(file, options);
                    })
                );

            // when removing by index the indexes shift after each file removal so we need to convert indexes to ids
            var mappedQueries = queries
                .map(function(query) {
                    return isNumber(query) ? (files[query] ? files[query].id : null) : query;
                })
                .filter(function(query) {
                    return query;
                });

            return mappedQueries.map(function(q) {
                return removeFile(q, options);
            });
        };

        var exports = Object.assign(
            {},

            on(),
            {},

            readWriteApi,
            {},

            createOptionAPI(store, defaultOptions),
            {
                /**
                 * Override options defined in options object
                 * @param options
                 */
                setOptions: setOptions,

                /**
                 * Load the given file
                 * @param source - the source of the file (either a File, base64 data uri or url)
                 * @param options - object, { index: 0 }
                 */
                addFile: addFile,

                /**
                 * Load the given files
                 * @param sources - the sources of the files to load
                 * @param options - object, { index: 0 }
                 */
                addFiles: addFiles,

                /**
                 * Returns the file objects matching the given query
                 * @param query { string, number, null }
                 */
                getFile: getFile,

                /**
                 * Upload file with given name
                 * @param query { string, number, null  }
                 */
                processFile: processFile,

                /**
                 * Request prepare output for file with given name
                 * @param query { string, number, null  }
                 */
                prepareFile: prepareFile,

                /**
                 * Removes a file by its name
                 * @param query { string, number, null  }
                 */
                removeFile: removeFile,

                /**
                 * Moves a file to a new location in the files list
                 */
                moveFile: function moveFile(query, index) {
                    return store.dispatch('MOVE_ITEM', { query: query, index: index });
                },

                /**
                 * Returns all files (wrapped in public api)
                 */
                getFiles: getFiles,

                /**
                 * Starts uploading all files
                 */
                processFiles: processFiles,

                /**
                 * Clears all files from the files list
                 */
                removeFiles: removeFiles,

                /**
                 * Starts preparing output of all files
                 */
                prepareFiles: prepareFiles,

                /**
                 * Sort list of files
                 */
                sort: function sort(compare) {
                    return store.dispatch('SORT', { compare: compare });
                },

                /**
                 * Browse the file system for a file
                 */
                browse: function browse() {
                    // needs to be trigger directly as user action needs to be traceable (is not traceable in requestAnimationFrame)
                    var input = view.element.querySelector('input[type=file]');
                    if (input) {
                        input.click();
                    }
                },

                /**
                 * Destroys the app
                 */
                destroy: function destroy() {
                    // request destruction
                    exports.fire('destroy', view.element);

                    // stop active processes (file uploads, fetches, stuff like that)
                    // loop over items and depending on states call abort for ongoing processes
                    store.dispatch('ABORT_ALL');

                    // destroy view
                    view._destroy();

                    // stop listening to resize
                    window.removeEventListener('resize', resizeHandler);

                    // stop listening to the visiblitychange event
                    document.removeEventListener('visibilitychange', visibilityHandler);

                    // dispatch destroy
                    store.dispatch('DID_DESTROY');
                },

                /**
                 * Inserts the plugin before the target element
                 */
                insertBefore: function insertBefore$1(element) {
                    return insertBefore(view.element, element);
                },

                /**
                 * Inserts the plugin after the target element
                 */
                insertAfter: function insertAfter$1(element) {
                    return insertAfter(view.element, element);
                },

                /**
                 * Appends the plugin to the target element
                 */
                appendTo: function appendTo(element) {
                    return element.appendChild(view.element);
                },

                /**
                 * Replaces an element with the app
                 */
                replaceElement: function replaceElement(element) {
                    // insert the app before the element
                    insertBefore(view.element, element);

                    // remove the original element
                    element.parentNode.removeChild(element);

                    // remember original element
                    originalElement = element;
                },

                /**
                 * Restores the original element
                 */
                restoreElement: function restoreElement() {
                    if (!originalElement) {
                        return; // no element to restore
                    }

                    // restore original element
                    insertAfter(originalElement, view.element);

                    // remove our element
                    view.element.parentNode.removeChild(view.element);

                    // remove reference
                    originalElement = null;
                },

                /**
                 * Returns true if the app root is attached to given element
                 * @param element
                 */
                isAttachedTo: function isAttachedTo(element) {
                    return view.element === element || originalElement === element;
                },

                /**
                 * Returns the root element
                 */
                element: {
                    get: function get() {
                        return view.element;
                    },
                },

                /**
                 * Returns the current pond status
                 */
                status: {
                    get: function get() {
                        return store.query('GET_STATUS');
                    },
                },
            }
        );

        // Done!
        store.dispatch('DID_INIT');

        // create actual api object
        return createObject(exports);
    };

    var createAppObject = function createAppObject() {
        var customOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
        // default options
        var defaultOptions = {};
        forin(getOptions(), function(key, value) {
            defaultOptions[key] = value[0];
        });

        // set app options
        var app = createApp(
            Object.assign(
                {},

                defaultOptions,
                {},

                customOptions
            )
        );

        // return the plugin instance
        return app;
    };

    var lowerCaseFirstLetter = function lowerCaseFirstLetter(string) {
        return string.charAt(0).toLowerCase() + string.slice(1);
    };

    var attributeNameToPropertyName = function attributeNameToPropertyName(attributeName) {
        return toCamels(attributeName.replace(/^data-/, ''));
    };

    var mapObject = function mapObject(object, propertyMap) {
        // remove unwanted
        forin(propertyMap, function(selector, mapping) {
            forin(object, function(property, value) {
                // create regexp shortcut
                var selectorRegExp = new RegExp(selector);

                // tests if
                var matches = selectorRegExp.test(property);

                // no match, skip
                if (!matches) {
                    return;
                }

                // if there's a mapping, the original property is always removed
                delete object[property];

                // should only remove, we done!
                if (mapping === false) {
                    return;
                }

                // move value to new property
                if (isString(mapping)) {
                    object[mapping] = value;
                    return;
                }

                // move to group
                var group = mapping.group;
                if (isObject(mapping) && !object[group]) {
                    object[group] = {};
                }

                object[group][lowerCaseFirstLetter(property.replace(selectorRegExp, ''))] = value;
            });

            // do submapping
            if (mapping.mapping) {
                mapObject(object[mapping.group], mapping.mapping);
            }
        });
    };

    var getAttributesAsObject = function getAttributesAsObject(node) {
        var attributeMapping =
            arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        // turn attributes into object
        var attributes = [];
        forin(node.attributes, function(index) {
            attributes.push(node.attributes[index]);
        });

        var output = attributes
            .filter(function(attribute) {
                return attribute.name;
            })
            .reduce(function(obj, attribute) {
                var value = attr(node, attribute.name);

                obj[attributeNameToPropertyName(attribute.name)] =
                    value === attribute.name ? true : value;
                return obj;
            }, {});

        // do mapping of object properties
        mapObject(output, attributeMapping);

        return output;
    };

    var createAppAtElement = function createAppAtElement(element) {
        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

        // how attributes of the input element are mapped to the options for the plugin
        var attributeMapping = {
            // translate to other name
            '^class$': 'className',
            '^multiple$': 'allowMultiple',
            '^capture$': 'captureMethod',
            '^webkitdirectory$': 'allowDirectoriesOnly',

            // group under single property
            '^server': {
                group: 'server',
                mapping: {
                    '^process': {
                        group: 'process',
                    },

                    '^revert': {
                        group: 'revert',
                    },

                    '^fetch': {
                        group: 'fetch',
                    },

                    '^restore': {
                        group: 'restore',
                    },

                    '^load': {
                        group: 'load',
                    },
                },
            },

            // don't include in object
            '^type$': false,
            '^files$': false,
        };

        // add additional option translators
        applyFilters('SET_ATTRIBUTE_TO_OPTION_MAP', attributeMapping);

        // create final options object by setting options object and then overriding options supplied on element
        var mergedOptions = Object.assign({}, options);

        var attributeOptions = getAttributesAsObject(
            element.nodeName === 'FIELDSET' ? element.querySelector('input[type=file]') : element,
            attributeMapping
        );

        // merge with options object
        Object.keys(attributeOptions).forEach(function(key) {
            if (isObject(attributeOptions[key])) {
                if (!isObject(mergedOptions[key])) {
                    mergedOptions[key] = {};
                }
                Object.assign(mergedOptions[key], attributeOptions[key]);
            } else {
                mergedOptions[key] = attributeOptions[key];
            }
        });

        // if parent is a fieldset, get files from parent by selecting all input fields that are not file upload fields
        // these will then be automatically set to the initial files
        mergedOptions.files = (options.files || []).concat(
            Array.from(element.querySelectorAll('input:not([type=file])')).map(function(input) {
                return {
                    source: input.value,
                    options: {
                        type: input.dataset.type,
                    },
                };
            })
        );

        // build plugin
        var app = createAppObject(mergedOptions);

        // add already selected files
        if (element.files) {
            Array.from(element.files).forEach(function(file) {
                app.addFile(file);
            });
        }

        // replace the target element
        app.replaceElement(element);

        // expose
        return app;
    };

    // if an element is passed, we create the instance at that element, if not, we just create an up object
    var createApp$1 = function createApp() {
        return isNode(arguments.length <= 0 ? undefined : arguments[0])
            ? createAppAtElement.apply(void 0, arguments)
            : createAppObject.apply(void 0, arguments);
    };

    var PRIVATE_METHODS = ['fire', '_read', '_write'];

    var createAppAPI = function createAppAPI(app) {
        var api = {};

        copyObjectPropertiesToObject(app, api, PRIVATE_METHODS);

        return api;
    };

    /**
     * Replaces placeholders in given string with replacements
     * @param string - "Foo {bar}""
     * @param replacements - { "bar": 10 }
     */
    var replaceInString = function replaceInString(string, replacements) {
        return string.replace(/(?:{([a-zA-Z]+)})/g, function(match, group) {
            return replacements[group];
        });
    };

    var createWorker = function createWorker(fn) {
        var workerBlob = new Blob(['(', fn.toString(), ')()'], {
            type: 'application/javascript',
        });

        var workerURL = URL.createObjectURL(workerBlob);
        var worker = new Worker(workerURL);

        return {
            transfer: function transfer(message, cb) {},
            post: function post(message, cb, transferList) {
                var id = getUniqueId();

                worker.onmessage = function(e) {
                    if (e.data.id === id) {
                        cb(e.data.message);
                    }
                };

                worker.postMessage(
                    {
                        id: id,
                        message: message,
                    },

                    transferList
                );
            },
            terminate: function terminate() {
                worker.terminate();
                URL.revokeObjectURL(workerURL);
            },
        };
    };

    var loadImage = function loadImage(url) {
        return new Promise(function(resolve, reject) {
            var img = new Image();
            img.onload = function() {
                resolve(img);
            };
            img.onerror = function(e) {
                reject(e);
            };
            img.src = url;
        });
    };

    var renameFile = function renameFile(file, name) {
        var renamedFile = file.slice(0, file.size, file.type);
        renamedFile.lastModifiedDate = file.lastModifiedDate;
        renamedFile.name = name;
        return renamedFile;
    };

    var copyFile = function copyFile(file) {
        return renameFile(file, file.name);
    };

    // already registered plugins (can't register twice)
    var registeredPlugins = [];

    // pass utils to plugin
    var createAppPlugin = function createAppPlugin(plugin) {
        // already registered
        if (registeredPlugins.includes(plugin)) {
            return;
        }

        // remember this plugin
        registeredPlugins.push(plugin);

        // setup!
        var pluginOutline = plugin({
            addFilter: addFilter,
            utils: {
                Type: Type,
                forin: forin,
                isString: isString,
                isFile: isFile,
                toNaturalFileSize: toNaturalFileSize,
                replaceInString: replaceInString,
                getExtensionFromFilename: getExtensionFromFilename,
                getFilenameWithoutExtension: getFilenameWithoutExtension,
                guesstimateMimeType: guesstimateMimeType,
                getFileFromBlob: getFileFromBlob,
                getFilenameFromURL: getFilenameFromURL,
                createRoute: createRoute,
                createWorker: createWorker,
                createView: createView,
                createItemAPI: createItemAPI,
                loadImage: loadImage,
                copyFile: copyFile,
                renameFile: renameFile,
                createBlob: createBlob,
                applyFilterChain: applyFilterChain,
                text: text,
                getNumericAspectRatioFromString: getNumericAspectRatioFromString,
            },

            views: {
                fileActionButton: fileActionButton,
            },
        });

        // add plugin options to default options
        extendDefaultOptions(pluginOutline.options);
    };

    // feature detection used by supported() method
    var isOperaMini = function isOperaMini() {
        return Object.prototype.toString.call(window.operamini) === '[object OperaMini]';
    };
    var hasPromises = function hasPromises() {
        return 'Promise' in window;
    };
    var hasBlobSlice = function hasBlobSlice() {
        return 'slice' in Blob.prototype;
    };
    var hasCreateObjectURL = function hasCreateObjectURL() {
        return 'URL' in window && 'createObjectURL' in window.URL;
    };
    var hasVisibility = function hasVisibility() {
        return 'visibilityState' in document;
    };
    var hasTiming = function hasTiming() {
        return 'performance' in window;
    }; // iOS 8.x
    var hasCSSSupports = function hasCSSSupports() {
        return 'supports' in (window.CSS || {});
    }; // use to detect Safari 9+
    var isIE11 = function isIE11() {
        return /MSIE|Trident/.test(window.navigator.userAgent);
    };

    var supported = (function() {
        // Runs immediately and then remembers result for subsequent calls
        var isSupported =
            // Has to be a browser
            isBrowser() &&
            // Can't run on Opera Mini due to lack of everything
            !isOperaMini() &&
            // Require these APIs to feature detect a modern browser
            hasVisibility() &&
            hasPromises() &&
            hasBlobSlice() &&
            hasCreateObjectURL() &&
            hasTiming() &&
            // doesn't need CSSSupports but is a good way to detect Safari 9+ (we do want to support IE11 though)
            (hasCSSSupports() || isIE11());

        return function() {
            return isSupported;
        };
    })();

    /**
     * Plugin internal state (over all instances)
     */
    var state = {
        // active app instances, used to redraw the apps and to find the later
        apps: [],
    };

    // plugin name
    var name = 'filepond';

    /**
     * Public Plugin methods
     */
    var fn = function fn() {};
    exports.Status = {};
    exports.FileStatus = {};
    exports.FileOrigin = {};
    exports.OptionTypes = {};
    exports.create = fn;
    exports.destroy = fn;
    exports.parse = fn;
    exports.find = fn;
    exports.registerPlugin = fn;
    exports.getOptions = fn;
    exports.setOptions = fn;

    // if not supported, no API
    if (supported()) {
        // start painter and fire load event
        createPainter(
            function() {
                state.apps.forEach(function(app) {
                    return app._read();
                });
            },
            function(ts) {
                state.apps.forEach(function(app) {
                    return app._write(ts);
                });
            }
        );

        // fire loaded event so we know when FilePond is available
        var dispatch = function dispatch() {
            // let others know we have area ready
            document.dispatchEvent(
                new CustomEvent('FilePond:loaded', {
                    detail: {
                        supported: supported,
                        create: exports.create,
                        destroy: exports.destroy,
                        parse: exports.parse,
                        find: exports.find,
                        registerPlugin: exports.registerPlugin,
                        setOptions: exports.setOptions,
                    },
                })
            );

            // clean up event
            document.removeEventListener('DOMContentLoaded', dispatch);
        };

        if (document.readyState !== 'loading') {
            // move to back of execution queue, FilePond should have been exported by then
            setTimeout(function() {
                return dispatch();
            }, 0);
        } else {
            document.addEventListener('DOMContentLoaded', dispatch);
        }

        // updates the OptionTypes object based on the current options
        var updateOptionTypes = function updateOptionTypes() {
            return forin(getOptions(), function(key, value) {
                exports.OptionTypes[key] = value[1];
            });
        };

        exports.Status = Object.assign({}, Status);
        exports.FileOrigin = Object.assign({}, FileOrigin);
        exports.FileStatus = Object.assign({}, ItemStatus);

        exports.OptionTypes = {};
        updateOptionTypes();

        // create method, creates apps and adds them to the app array
        exports.create = function create() {
            var app = createApp$1.apply(void 0, arguments);
            app.on('destroy', exports.destroy);
            state.apps.push(app);
            return createAppAPI(app);
        };

        // destroys apps and removes them from the app array
        exports.destroy = function destroy(hook) {
            // returns true if the app was destroyed successfully
            var indexToRemove = state.apps.findIndex(function(app) {
                return app.isAttachedTo(hook);
            });
            if (indexToRemove >= 0) {
                // remove from apps
                var app = state.apps.splice(indexToRemove, 1)[0];

                // restore original dom element
                app.restoreElement();

                return true;
            }

            return false;
        };

        // parses the given context for plugins (does not include the context element itself)
        exports.parse = function parse(context) {
            // get all possible hooks
            var matchedHooks = Array.from(context.querySelectorAll('.' + name));

            // filter out already active hooks
            var newHooks = matchedHooks.filter(function(newHook) {
                return !state.apps.find(function(app) {
                    return app.isAttachedTo(newHook);
                });
            });

            // create new instance for each hook
            return newHooks.map(function(hook) {
                return exports.create(hook);
            });
        };

        // returns an app based on the given element hook
        exports.find = function find(hook) {
            var app = state.apps.find(function(app) {
                return app.isAttachedTo(hook);
            });
            if (!app) {
                return null;
            }
            return createAppAPI(app);
        };

        // adds a plugin extension
        exports.registerPlugin = function registerPlugin() {
            for (
                var _len = arguments.length, plugins = new Array(_len), _key = 0;
                _key < _len;
                _key++
            ) {
                plugins[_key] = arguments[_key];
            }

            // register plugins
            plugins.forEach(createAppPlugin);

            // update OptionTypes, each plugin might have extended the default options
            updateOptionTypes();
        };

        exports.getOptions = function getOptions$1() {
            var opts = {};
            forin(getOptions(), function(key, value) {
                opts[key] = value[0];
            });
            return opts;
        };

        exports.setOptions = function setOptions$1(opts) {
            if (isObject(opts)) {
                // update existing plugins
                state.apps.forEach(function(app) {
                    app.setOptions(opts);
                });

                // override defaults
                setOptions(opts);
            }

            // return new options
            return exports.getOptions();
        };
    }

    exports.supported = supported;

    Object.defineProperty(exports, '__esModule', { value: true });
});


/***/ }),

/***/ "./node_modules/lucide-react/dist/esm/createLucideIcon.js":
/*!****************************************************************!*\
  !*** ./node_modules/lucide-react/dist/esm/createLucideIcon.js ***!
  \****************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ createLucideIcon; },
/* harmony export */   "toKebabCase": function() { return /* binding */ toKebabCase; }
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _defaultAttributes_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./defaultAttributes.js */ "./node_modules/lucide-react/dist/esm/defaultAttributes.js");
/**
 * lucide-react v0.182.0 - ISC
 */




const toKebabCase = (string) => string.replace(/([a-z0-9])([A-Z])/g, "$1-$2").toLowerCase();
const createLucideIcon = (iconName, iconNode) => {
  const Component = (0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(
    ({ color = "currentColor", size = 24, strokeWidth = 2, absoluteStrokeWidth, children, ...rest }, ref) => (0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)(
      "svg",
      {
        ref,
        ..._defaultAttributes_js__WEBPACK_IMPORTED_MODULE_1__["default"],
        width: size,
        height: size,
        stroke: color,
        strokeWidth: absoluteStrokeWidth ? Number(strokeWidth) * 24 / Number(size) : strokeWidth,
        className: `lucide lucide-${toKebabCase(iconName)}`,
        ...rest
      },
      [
        ...iconNode.map(([tag, attrs]) => (0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)(tag, attrs)),
        ...(Array.isArray(children) ? children : [children]) || []
      ]
    )
  );
  Component.displayName = `${iconName}`;
  return Component;
};


//# sourceMappingURL=createLucideIcon.js.map


/***/ }),

/***/ "./node_modules/lucide-react/dist/esm/defaultAttributes.js":
/*!*****************************************************************!*\
  !*** ./node_modules/lucide-react/dist/esm/defaultAttributes.js ***!
  \*****************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ defaultAttributes; }
/* harmony export */ });
/**
 * lucide-react v0.182.0 - ISC
 */

var defaultAttributes = {
  xmlns: "http://www.w3.org/2000/svg",
  width: 24,
  height: 24,
  viewBox: "0 0 24 24",
  fill: "none",
  stroke: "currentColor",
  strokeWidth: 2,
  strokeLinecap: "round",
  strokeLinejoin: "round"
};


//# sourceMappingURL=defaultAttributes.js.map


/***/ }),

/***/ "./node_modules/lucide-react/dist/esm/icons/accessibility.js":
/*!*******************************************************************!*\
  !*** ./node_modules/lucide-react/dist/esm/icons/accessibility.js ***!
  \*******************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ Accessibility; }
/* harmony export */ });
/* harmony import */ var _createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../createLucideIcon.js */ "./node_modules/lucide-react/dist/esm/createLucideIcon.js");
/**
 * lucide-react v0.182.0 - ISC
 */



const Accessibility = (0,_createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__["default"])("Accessibility", [
  ["circle", { cx: "16", cy: "4", r: "1", key: "1grugj" }],
  ["path", { d: "m18 19 1-7-6 1", key: "r0i19z" }],
  ["path", { d: "m5 8 3-3 5.5 3-2.36 3.5", key: "9ptxx2" }],
  ["path", { d: "M4.24 14.5a5 5 0 0 0 6.88 6", key: "10kmtu" }],
  ["path", { d: "M13.76 17.5a5 5 0 0 0-6.88-6", key: "2qq6rc" }]
]);


//# sourceMappingURL=accessibility.js.map


/***/ }),

/***/ "./node_modules/lucide-react/dist/esm/icons/crop.js":
/*!**********************************************************!*\
  !*** ./node_modules/lucide-react/dist/esm/icons/crop.js ***!
  \**********************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ Crop; }
/* harmony export */ });
/* harmony import */ var _createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../createLucideIcon.js */ "./node_modules/lucide-react/dist/esm/createLucideIcon.js");
/**
 * lucide-react v0.182.0 - ISC
 */



const Crop = (0,_createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__["default"])("Crop", [
  ["path", { d: "M6 2v14a2 2 0 0 0 2 2h14", key: "ron5a4" }],
  ["path", { d: "M18 22V8a2 2 0 0 0-2-2H2", key: "7s9ehn" }]
]);


//# sourceMappingURL=crop.js.map


/***/ }),

/***/ "./node_modules/lucide-react/dist/esm/icons/database.js":
/*!**************************************************************!*\
  !*** ./node_modules/lucide-react/dist/esm/icons/database.js ***!
  \**************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ Database; }
/* harmony export */ });
/* harmony import */ var _createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../createLucideIcon.js */ "./node_modules/lucide-react/dist/esm/createLucideIcon.js");
/**
 * lucide-react v0.182.0 - ISC
 */



const Database = (0,_createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__["default"])("Database", [
  ["ellipse", { cx: "12", cy: "5", rx: "9", ry: "3", key: "msslwz" }],
  ["path", { d: "M3 5V19A9 3 0 0 0 21 19V5", key: "1wlel7" }],
  ["path", { d: "M3 12A9 3 0 0 0 21 12", key: "mv7ke4" }]
]);


//# sourceMappingURL=database.js.map


/***/ }),

/***/ "./node_modules/lucide-react/dist/esm/icons/image.js":
/*!***********************************************************!*\
  !*** ./node_modules/lucide-react/dist/esm/icons/image.js ***!
  \***********************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ Image; }
/* harmony export */ });
/* harmony import */ var _createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../createLucideIcon.js */ "./node_modules/lucide-react/dist/esm/createLucideIcon.js");
/**
 * lucide-react v0.182.0 - ISC
 */



const Image = (0,_createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__["default"])("Image", [
  [
    "rect",
    {
      width: "18",
      height: "18",
      x: "3",
      y: "3",
      rx: "2",
      ry: "2",
      key: "1m3agn"
    }
  ],
  ["circle", { cx: "9", cy: "9", r: "2", key: "af1f0g" }],
  ["path", { d: "m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21", key: "1xmnt7" }]
]);


//# sourceMappingURL=image.js.map


/***/ }),

/***/ "./node_modules/lucide-react/dist/esm/icons/link.js":
/*!**********************************************************!*\
  !*** ./node_modules/lucide-react/dist/esm/icons/link.js ***!
  \**********************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ Link; }
/* harmony export */ });
/* harmony import */ var _createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../createLucideIcon.js */ "./node_modules/lucide-react/dist/esm/createLucideIcon.js");
/**
 * lucide-react v0.182.0 - ISC
 */



const Link = (0,_createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__["default"])("Link", [
  [
    "path",
    {
      d: "M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",
      key: "1cjeqo"
    }
  ],
  [
    "path",
    {
      d: "M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",
      key: "19qd67"
    }
  ]
]);


//# sourceMappingURL=link.js.map


/***/ }),

/***/ "./node_modules/lucide-react/dist/esm/icons/redo-2.js":
/*!************************************************************!*\
  !*** ./node_modules/lucide-react/dist/esm/icons/redo-2.js ***!
  \************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ Redo2; }
/* harmony export */ });
/* harmony import */ var _createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../createLucideIcon.js */ "./node_modules/lucide-react/dist/esm/createLucideIcon.js");
/**
 * lucide-react v0.182.0 - ISC
 */



const Redo2 = (0,_createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__["default"])("Redo2", [
  ["path", { d: "m15 14 5-5-5-5", key: "12vg1m" }],
  [
    "path",
    {
      d: "M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13",
      key: "19mnr4"
    }
  ]
]);


//# sourceMappingURL=redo-2.js.map


/***/ }),

/***/ "./node_modules/lucide-react/dist/esm/icons/upload.js":
/*!************************************************************!*\
  !*** ./node_modules/lucide-react/dist/esm/icons/upload.js ***!
  \************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ Upload; }
/* harmony export */ });
/* harmony import */ var _createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../createLucideIcon.js */ "./node_modules/lucide-react/dist/esm/createLucideIcon.js");
/**
 * lucide-react v0.182.0 - ISC
 */



const Upload = (0,_createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__["default"])("Upload", [
  ["path", { d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4", key: "ih7n3h" }],
  ["polyline", { points: "17 8 12 3 7 8", key: "t8dd8p" }],
  ["line", { x1: "12", x2: "12", y1: "3", y2: "15", key: "widbto" }]
]);


//# sourceMappingURL=upload.js.map


/***/ }),

/***/ "./node_modules/lucide-react/dist/esm/icons/x-circle.js":
/*!**************************************************************!*\
  !*** ./node_modules/lucide-react/dist/esm/icons/x-circle.js ***!
  \**************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ XCircle; }
/* harmony export */ });
/* harmony import */ var _createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../createLucideIcon.js */ "./node_modules/lucide-react/dist/esm/createLucideIcon.js");
/**
 * lucide-react v0.182.0 - ISC
 */



const XCircle = (0,_createLucideIcon_js__WEBPACK_IMPORTED_MODULE_0__["default"])("XCircle", [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["line", { x1: "15", x2: "9", y1: "9", y2: "15", key: "f7djnv" }],
  ["line", { x1: "9", x2: "15", y1: "9", y2: "15", key: "1shsy8" }]
]);


//# sourceMappingURL=x-circle.js.map


/***/ }),

/***/ "./local_modules/pintura/pintura.css":
/*!*******************************************!*\
  !*** ./local_modules/pintura/pintura.css ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./node_modules/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css":
/*!*******************************************************************************************!*\
  !*** ./node_modules/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css ***!
  \*******************************************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./node_modules/filepond/dist/filepond.min.css":
/*!*****************************************************!*\
  !*** ./node_modules/filepond/dist/filepond.min.css ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/blocks/photo-block/editor.scss":
/*!********************************************!*\
  !*** ./src/blocks/photo-block/editor.scss ***!
  \********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/UploadStatus/editor.scss":
/*!*************************************************!*\
  !*** ./src/components/UploadStatus/editor.scss ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/UploadTarget/editor.scss":
/*!*************************************************!*\
  !*** ./src/components/UploadTarget/editor.scss ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/components/UploadTypes/editor.scss":
/*!************************************************!*\
  !*** ./src/components/UploadTypes/editor.scss ***!
  \************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/screens/Edit/editor.scss":
/*!**************************************!*\
  !*** ./src/screens/Edit/editor.scss ***!
  \**************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./node_modules/react-filepond/dist/react-filepond.js":
/*!************************************************************!*\
  !*** ./node_modules/react-filepond/dist/react-filepond.js ***!
  \************************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

"use strict";
/*!
 * react-filepond v7.1.2
 * A handy FilePond adapter component for React
 * 
 * Copyright (c) 2022 PQINA
 * https://pqina.nl/filepond
 * 
 * Licensed under the MIT license.
 */



Object.defineProperty(exports, "__esModule", ({
  value: true
}));
exports.FilePond = exports.FileStatus = exports.registerPlugin = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = __webpack_require__(/*! react */ "react");

var _react2 = _interopRequireDefault(_react);

var _filepond = __webpack_require__(/*! filepond */ "./node_modules/filepond/dist/filepond.js");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

// Import required methods and styles from the FilePond module, should not need anything else


// We need to be able to call the registerPlugin method directly so we can add plugins
exports.registerPlugin = _filepond.registerPlugin;
exports.FileStatus = _filepond.FileStatus;

// Do this once

var isSupported = (0, _filepond.supported)();

// filtered methods
var filteredMethods = ["setOptions", "on", "off", "onOnce", "appendTo", "insertAfter", "insertBefore", "isAttachedTo", "replaceElement", "restoreElement", "destroy"];

// The React <FilePond/> wrapper

var FilePond = exports.FilePond = function (_React$Component) {
  _inherits(FilePond, _React$Component);

  function FilePond(props) {
    _classCallCheck(this, FilePond);

    var _this = _possibleConstructorReturn(this, (FilePond.__proto__ || Object.getPrototypeOf(FilePond)).call(this, props));

    _this.allowFilesSync = true;
    return _this;
  }

  // Will setup FilePond instance when mounted


  _createClass(FilePond, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this2 = this;

      // clone the input so we can restore it in unmount
      this._input = this._element.querySelector('input[type="file"]');
      this._inputClone = this._input.cloneNode();

      // exit here if not supported
      if (!isSupported) return;

      var options = Object.assign({}, this.props);

      // if onupdate files is defined, make sure setFiles does not cause race condition
      if (options.onupdatefiles) {
        var cb = options.onupdatefiles;
        options.onupdatefiles = function (items) {
          _this2.allowFilesSync = false;
          cb(items);
        };
      }

      // Create our pond
      this._pond = (0, _filepond.create)(this._input, options);

      // Reference pond methods to FilePond component instance
      Object.keys(this._pond).filter(function (key) {
        return !filteredMethods.includes(key);
      }).forEach(function (key) {
        _this2[key] = _this2._pond[key];
      });
    }

    // Will clean up FilePond instance when unmounted

  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      // exit when no pond defined
      if (!this._pond) return;

      // This fixed <Strict> errors

      // FilePond destroy is async so we have to move FilePond to a bin element so it can no longer affect current element tree as React unmount / mount is sync
      var bin = document.createElement("div");
      bin.append(this._pond.element);
      bin.id = "foo";

      // now we call destroy so FilePond can start it's destroy logic
      this._pond.destroy();
      this._pond = undefined;

      // we re-add the original file input element so everything is as it was before
      this._element.append(this._inputClone);
    }
  }, {
    key: "shouldComponentUpdate",
    value: function shouldComponentUpdate() {
      if (!this.allowFilesSync) {
        this.allowFilesSync = true;
        return false;
      }
      return true;
    }

    // Something changed

  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      // exit when no pond defined
      if (!this._pond) return;

      var options = Object.assign({}, this.props);

      // this is only set onces, on didmount
      delete options.onupdatefiles;

      // update pond options based on new props
      this._pond.setOptions(options);
    }

    // Renders basic element hook for FilePond to attach to

  }, {
    key: "render",
    value: function render() {
      var _this3 = this;

      var _props = this.props,
          id = _props.id,
          name = _props.name,
          className = _props.className,
          allowMultiple = _props.allowMultiple,
          required = _props.required,
          captureMethod = _props.captureMethod,
          acceptedFileTypes = _props.acceptedFileTypes;

      return (0, _react.createElement)("div", {
        className: "filepond--wrapper",
        ref: function ref(element) {
          return _this3._element = element;
        }
      }, (0, _react.createElement)("input", {
        type: "file",
        name: name,
        id: id,
        accept: acceptedFileTypes,
        multiple: allowMultiple,
        required: required,
        className: className,
        capture: captureMethod
      }));
    }
  }]);

  return FilePond;
}(_react2.default.Component);




/***/ }),

/***/ "react":
/*!************************!*\
  !*** external "React" ***!
  \************************/
/***/ (function(module) {

"use strict";
module.exports = window["React"];

/***/ }),

/***/ "@wordpress/block-editor":
/*!*************************************!*\
  !*** external ["wp","blockEditor"] ***!
  \*************************************/
/***/ (function(module) {

"use strict";
module.exports = window["wp"]["blockEditor"];

/***/ }),

/***/ "@wordpress/blocks":
/*!********************************!*\
  !*** external ["wp","blocks"] ***!
  \********************************/
/***/ (function(module) {

"use strict";
module.exports = window["wp"]["blocks"];

/***/ }),

/***/ "@wordpress/components":
/*!************************************!*\
  !*** external ["wp","components"] ***!
  \************************************/
/***/ (function(module) {

"use strict";
module.exports = window["wp"]["components"];

/***/ }),

/***/ "@wordpress/compose":
/*!*********************************!*\
  !*** external ["wp","compose"] ***!
  \*********************************/
/***/ (function(module) {

"use strict";
module.exports = window["wp"]["compose"];

/***/ }),

/***/ "@wordpress/element":
/*!*********************************!*\
  !*** external ["wp","element"] ***!
  \*********************************/
/***/ (function(module) {

"use strict";
module.exports = window["wp"]["element"];

/***/ }),

/***/ "@wordpress/i18n":
/*!******************************!*\
  !*** external ["wp","i18n"] ***!
  \******************************/
/***/ (function(module) {

"use strict";
module.exports = window["wp"]["i18n"];

/***/ }),

/***/ "./local_modules/pintura/pintura.js":
/*!******************************************!*\
  !*** ./local_modules/pintura/pintura.js ***!
  \******************************************/
/***/ (function(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "appendDefaultEditor": function() { return /* binding */ appendDefaultEditor; },
/* harmony export */   "appendDefaultEditors": function() { return /* binding */ appendDefaultEditors; },
/* harmony export */   "appendEditor": function() { return /* binding */ appendEditor; },
/* harmony export */   "appendEditors": function() { return /* binding */ appendEditors; },
/* harmony export */   "appendNode": function() { return /* binding */ appendNode; },
/* harmony export */   "blobToFile": function() { return /* binding */ blobToFile; },
/* harmony export */   "colorStringToColorArray": function() { return /* binding */ colorStringToColorArray; },
/* harmony export */   "createDefaultColorOptions": function() { return /* binding */ createDefaultColorOptions; },
/* harmony export */   "createDefaultFontFamilyOptions": function() { return /* binding */ createDefaultFontFamilyOptions; },
/* harmony export */   "createDefaultFontScaleOptions": function() { return /* binding */ createDefaultFontScaleOptions; },
/* harmony export */   "createDefaultFontSizeOptions": function() { return /* binding */ createDefaultFontSizeOptions; },
/* harmony export */   "createDefaultFontStyleOptions": function() { return /* binding */ createDefaultFontStyleOptions; },
/* harmony export */   "createDefaultFrameStyles": function() { return /* binding */ createDefaultFrameStyles; },
/* harmony export */   "createDefaultImageOrienter": function() { return /* binding */ createDefaultImageOrienter; },
/* harmony export */   "createDefaultImageReader": function() { return /* binding */ createDefaultImageReader; },
/* harmony export */   "createDefaultImageScrambler": function() { return /* binding */ createDefaultImageScrambler; },
/* harmony export */   "createDefaultImageWriter": function() { return /* binding */ createDefaultImageWriter; },
/* harmony export */   "createDefaultLineEndStyleOptions": function() { return /* binding */ createDefaultLineEndStyleOptions; },
/* harmony export */   "createDefaultLineEndStyles": function() { return /* binding */ createDefaultLineEndStyles; },
/* harmony export */   "createDefaultLineHeightOptions": function() { return /* binding */ createDefaultLineHeightOptions; },
/* harmony export */   "createDefaultLineHeightScaleOptions": function() { return /* binding */ createDefaultLineHeightScaleOptions; },
/* harmony export */   "createDefaultMediaWriter": function() { return /* binding */ createDefaultMediaWriter; },
/* harmony export */   "createDefaultShapePreprocessor": function() { return /* binding */ createDefaultShapePreprocessor; },
/* harmony export */   "createDefaultStrokeScaleOptions": function() { return /* binding */ createDefaultStrokeScaleOptions; },
/* harmony export */   "createDefaultStrokeWidthOptions": function() { return /* binding */ createDefaultStrokeWidthOptions; },
/* harmony export */   "createDefaultTextAlignOptions": function() { return /* binding */ createDefaultTextAlignOptions; },
/* harmony export */   "createEditor": function() { return /* binding */ createEditor; },
/* harmony export */   "createFrameStyleProcessor": function() { return /* binding */ createFrameStyleProcessor; },
/* harmony export */   "createLineEndProcessor": function() { return /* binding */ createLineEndProcessor; },
/* harmony export */   "createMarkupEditorBackgroundColorControl": function() { return /* binding */ createBackgroundColorControl; },
/* harmony export */   "createMarkupEditorColorControl": function() { return /* binding */ createColorControl; },
/* harmony export */   "createMarkupEditorColorOptions": function() { return /* binding */ createColorOptions; },
/* harmony export */   "createMarkupEditorFontColorControl": function() { return /* binding */ createFontColorControl; },
/* harmony export */   "createMarkupEditorFontFamilyControl": function() { return /* binding */ createFontFamilyControl; },
/* harmony export */   "createMarkupEditorFontFamilyOptions": function() { return /* binding */ createFontFamilyOptions; },
/* harmony export */   "createMarkupEditorFontScaleOptions": function() { return /* binding */ createFontScaleOptions; },
/* harmony export */   "createMarkupEditorFontSizeControl": function() { return /* binding */ createFontSizeControl; },
/* harmony export */   "createMarkupEditorFontSizeOptions": function() { return /* binding */ createFontSizeOptions; },
/* harmony export */   "createMarkupEditorFontStyleControl": function() { return /* binding */ createFontStyleControl; },
/* harmony export */   "createMarkupEditorFontStyleOptions": function() { return /* binding */ createFontStyleOptions; },
/* harmony export */   "createMarkupEditorLineEndStyleControl": function() { return /* binding */ createLineEndStyleControl; },
/* harmony export */   "createMarkupEditorLineEndStyleOptions": function() { return /* binding */ createLineEndStyleOptions; },
/* harmony export */   "createMarkupEditorLineHeightControl": function() { return /* binding */ createLineHeightControl; },
/* harmony export */   "createMarkupEditorLineHeightOptions": function() { return /* binding */ createLineHeightOptions; },
/* harmony export */   "createMarkupEditorLineHeightScaleOptions": function() { return /* binding */ createLineHeightScaleOptions; },
/* harmony export */   "createMarkupEditorLineStartStyleControl": function() { return /* binding */ createLineStartStyleControl; },
/* harmony export */   "createMarkupEditorShapeStyleControls": function() { return /* binding */ createMarkupEditorShapeStyleControls; },
/* harmony export */   "createMarkupEditorStrokeColorControl": function() { return /* binding */ createStrokeColorControl; },
/* harmony export */   "createMarkupEditorStrokeScaleOptions": function() { return /* binding */ createStrokeScaleOptions; },
/* harmony export */   "createMarkupEditorStrokeWidthControl": function() { return /* binding */ createStrokeWidthControl; },
/* harmony export */   "createMarkupEditorStrokeWidthOptions": function() { return /* binding */ createStrokeWidthOptions; },
/* harmony export */   "createMarkupEditorTextAlignControl": function() { return /* binding */ createTextAlignControl; },
/* harmony export */   "createMarkupEditorToolStyle": function() { return /* binding */ createToolStyle; },
/* harmony export */   "createMarkupEditorToolStyles": function() { return /* binding */ createMarkupEditorToolStyles; },
/* harmony export */   "createMarkupEditorToolbar": function() { return /* binding */ createMarkupEditorToolbar; },
/* harmony export */   "createNode": function() { return /* binding */ createNode; },
/* harmony export */   "createShapePreprocessor": function() { return /* binding */ createShapePreprocessor; },
/* harmony export */   "defineCustomElements": function() { return /* binding */ defineCustomElements; },
/* harmony export */   "defineDefaultCustomElements": function() { return /* binding */ defineDefaultCustomElements; },
/* harmony export */   "degToRad": function() { return /* binding */ degToRad; },
/* harmony export */   "dispatchEditorEvents": function() { return /* binding */ dispatchEditorEvents; },
/* harmony export */   "effectBrightness": function() { return /* binding */ brightness; },
/* harmony export */   "effectClarity": function() { return /* binding */ clarity; },
/* harmony export */   "effectContrast": function() { return /* binding */ contrast; },
/* harmony export */   "effectExposure": function() { return /* binding */ exposure; },
/* harmony export */   "effectGamma": function() { return /* binding */ gamma; },
/* harmony export */   "effectSaturation": function() { return /* binding */ saturation; },
/* harmony export */   "effectTemperature": function() { return /* binding */ temperature; },
/* harmony export */   "effectVignette": function() { return /* binding */ vignette; },
/* harmony export */   "filterChrome": function() { return /* binding */ chrome; },
/* harmony export */   "filterCold": function() { return /* binding */ cold; },
/* harmony export */   "filterFade": function() { return /* binding */ fade; },
/* harmony export */   "filterInvert": function() { return /* binding */ invert; },
/* harmony export */   "filterMonoDefault": function() { return /* binding */ monoDefault; },
/* harmony export */   "filterMonoNoir": function() { return /* binding */ monoNoir; },
/* harmony export */   "filterMonoStark": function() { return /* binding */ monoStark; },
/* harmony export */   "filterMonoWash": function() { return /* binding */ monoWash; },
/* harmony export */   "filterPastel": function() { return /* binding */ pastel; },
/* harmony export */   "filterSepiaBlues": function() { return /* binding */ sepiaBlues; },
/* harmony export */   "filterSepiaColor": function() { return /* binding */ sepiaColor; },
/* harmony export */   "filterSepiaDefault": function() { return /* binding */ sepiaDefault; },
/* harmony export */   "filterSepiaRust": function() { return /* binding */ sepiaRust; },
/* harmony export */   "filterWarm": function() { return /* binding */ warm; },
/* harmony export */   "findNode": function() { return /* binding */ findNode; },
/* harmony export */   "frameEdgeCross": function() { return /* binding */ edgeCross; },
/* harmony export */   "frameEdgeOverlap": function() { return /* binding */ edgeOverlap; },
/* harmony export */   "frameEdgeSeparate": function() { return /* binding */ edgeSeparate; },
/* harmony export */   "frameHook": function() { return /* binding */ hook; },
/* harmony export */   "frameLineMultiple": function() { return /* binding */ lineMultiple; },
/* harmony export */   "frameLineSingle": function() { return /* binding */ lineSingle; },
/* harmony export */   "framePolaroid": function() { return /* binding */ polaroid; },
/* harmony export */   "frameSolidRound": function() { return /* binding */ solidRound; },
/* harmony export */   "frameSolidSharp": function() { return /* binding */ solidSharp; },
/* harmony export */   "getEditorDefaults": function() { return /* binding */ getEditorDefaults; },
/* harmony export */   "getEditorProps": function() { return /* binding */ getEditorProps; },
/* harmony export */   "imageStateToCanvas": function() { return /* binding */ imageStateToCanvas; },
/* harmony export */   "insertNodeAfter": function() { return /* binding */ insertNodeAfter; },
/* harmony export */   "insertNodeBefore": function() { return /* binding */ insertNodeBefore; },
/* harmony export */   "isSupported": function() { return /* binding */ isModernBrowser; },
/* harmony export */   "legacyDataToImageState": function() { return /* binding */ legacyDataToImageState; },
/* harmony export */   "locale_en_gb": function() { return /* binding */ locale_en_gb; },
/* harmony export */   "markup_editor_defaults": function() { return /* binding */ markup_editor_defaults; },
/* harmony export */   "markup_editor_locale_en_gb": function() { return /* binding */ markup_editor_locale_en_gb; },
/* harmony export */   "naturalAspectRatioToNumber": function() { return /* binding */ naturalAspectRatioToNumber; },
/* harmony export */   "openDefaultEditor": function() { return /* binding */ openDefaultEditor; },
/* harmony export */   "openEditor": function() { return /* binding */ openEditor; },
/* harmony export */   "overlayDefaultEditor": function() { return /* binding */ overlayDefaultEditor; },
/* harmony export */   "overlayEditor": function() { return /* binding */ overlayEditor; },
/* harmony export */   "plugin_annotate": function() { return /* binding */ plugin_annotate; },
/* harmony export */   "plugin_annotate_locale_en_gb": function() { return /* binding */ plugin_annotate_locale_en_gb; },
/* harmony export */   "plugin_crop": function() { return /* binding */ plugin_crop; },
/* harmony export */   "plugin_crop_locale_en_gb": function() { return /* binding */ plugin_crop_locale_en_gb; },
/* harmony export */   "plugin_decorate": function() { return /* binding */ plugin_decorate; },
/* harmony export */   "plugin_decorate_locale_en_gb": function() { return /* binding */ plugin_decorate_locale_en_gb; },
/* harmony export */   "plugin_fill": function() { return /* binding */ plugin_fill; },
/* harmony export */   "plugin_fill_locale_en_gb": function() { return /* binding */ plugin_fill_locale_en_gb; },
/* harmony export */   "plugin_filter": function() { return /* binding */ plugin_filter; },
/* harmony export */   "plugin_filter_defaults": function() { return /* binding */ plugin_filter_defaults; },
/* harmony export */   "plugin_filter_locale_en_gb": function() { return /* binding */ plugin_filter_locale_en_gb; },
/* harmony export */   "plugin_finetune": function() { return /* binding */ plugin_finetune; },
/* harmony export */   "plugin_finetune_defaults": function() { return /* binding */ plugin_finetune_defaults; },
/* harmony export */   "plugin_finetune_locale_en_gb": function() { return /* binding */ plugin_finetune_locale_en_gb; },
/* harmony export */   "plugin_frame": function() { return /* binding */ plugin_frame; },
/* harmony export */   "plugin_frame_defaults": function() { return /* binding */ plugin_frame_defaults; },
/* harmony export */   "plugin_frame_locale_en_gb": function() { return /* binding */ plugin_frame_locale_en_gb; },
/* harmony export */   "plugin_redact": function() { return /* binding */ plugin_redact; },
/* harmony export */   "plugin_redact_locale_en_gb": function() { return /* binding */ plugin_redact_locale_en_gb; },
/* harmony export */   "plugin_resize": function() { return /* binding */ plugin_resize; },
/* harmony export */   "plugin_resize_locale_en_gb": function() { return /* binding */ plugin_resize_locale_en_gb; },
/* harmony export */   "plugin_sticker": function() { return /* binding */ plugin_sticker; },
/* harmony export */   "plugin_sticker_locale_en_gb": function() { return /* binding */ plugin_sticker_locale_en_gb; },
/* harmony export */   "processDefaultImage": function() { return /* binding */ processDefaultImage; },
/* harmony export */   "processImage": function() { return /* binding */ processImage; },
/* harmony export */   "removeNode": function() { return /* binding */ removeNode; },
/* harmony export */   "setPlugins": function() { return /* binding */ setPlugins; },
/* harmony export */   "shapeGetCenter": function() { return /* binding */ shapeGetCenter; },
/* harmony export */   "shapeGetLength": function() { return /* binding */ shapeGetLength; },
/* harmony export */   "shapeGetLevel": function() { return /* binding */ shapeGetLevel; },
/* harmony export */   "supportsWebGL": function() { return /* binding */ supportsWebGL; },
/* harmony export */   "updateNode": function() { return /* binding */ updateNode; }
/* harmony export */ });
var _excluded=["textContent","innerHTML"],_excluded2=["width"],_excluded3=["frameStyle"];var _DirectionCoordinateT,_DirectionRectMap,_DirectionInversionTa;function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function _toArray(arr){return _arrayWithHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableRest();}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e2){throw _e2;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e3){didErr=true;err=_e3;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map():undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function");}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper);}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor);}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class);};return _wrapNativeSuper(Class);}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct.bind();}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1;}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key);}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return(hint==="string"?String:Number)(input);}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1;}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err;}finally{try{if(!_n&&null!=_i["return"]&&(_r=_i["return"](),Object(_r)!==_r))return;}finally{if(_d)throw _e;}}return _arr;}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function _regeneratorRuntime(){return exports;};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,defineProperty=Object.defineProperty||function(obj,key,desc){obj[key]=desc.value;},$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key];}try{define({},"");}catch(err){define=function define(obj,key,value){return obj[key]=value;};}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return defineProperty(generator,"_invoke",{value:makeInvokeMethod(innerFn,self,context)}),generator;}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)};}catch(err){return{type:"throw",arg:err};}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,function(){return this;});var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg);});});}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject);},function(err){invoke("throw",err,resolve,reject);}):PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result);},function(error){return invoke("throw",error,resolve,reject);});}reject(record.arg);}var previousPromise;defineProperty(this,"_invoke",{value:function value(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject);});}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();}});}function makeInvokeMethod(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult();}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult;}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg);}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done};}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg);}};}function maybeInvokeDelegate(delegate,context){var methodName=context.method,method=delegate.iterator[methodName];if(undefined===method)return context.delegate=null,"throw"===methodName&&delegate.iterator["return"]&&(context.method="return",context.arg=undefined,maybeInvokeDelegate(delegate,context),"throw"===context.method)||"return"!==methodName&&(context.method="throw",context.arg=new TypeError("The iterator does not provide a '"+methodName+"' method")),ContinueSentinel;var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel);}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry);}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record;}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0);}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next;};return next.next=next;}}return{next:doneResult};}function doneResult(){return{value:undefined,done:!0};}return GeneratorFunction.prototype=GeneratorFunctionPrototype,defineProperty(Gp,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),defineProperty(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name));},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun;},exports.awrap=function(arg){return{__await:arg};},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,function(){return this;}),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next();});},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,function(){return this;}),define(Gp,"toString",function(){return"[object Generator]";}),exports.keys=function(val){var object=Object(val),keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next;}return next.done=!0,next;};},exports.values=values,Context.prototype={constructor:Context,reset:function reset(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined);},stop:function stop(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval;},dispatchException:function dispatchException(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=undefined),!!caught;}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc);}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc);}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break;}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record);},complete:function complete(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel;},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel;}},"catch":function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry);}return thrown;}}throw new Error("illegal catch attempt");},delegateYield:function delegateYield(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=undefined),ContinueSentinel;}},exports;}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err);}_next(undefined);});};}/*!
* Pintura Image Editor 8.57.2 
* (c) 2018-2023 PQINA Inc. - All Rights Reserved
* License: https://pqina.nl/pintura/license/
*/ /* eslint-disable */var JFIF_MARKER=0xffe0;var EXIF_MARKER=0xffe1;var SOS_MARKER=0xffda;var XMP_MARKER=0xffe1;var MPF_MARKER=0xffe2;var Markers=[{value:JFIF_MARKER,name:'jfif'},{value:SOS_MARKER,name:'sos'},{value:EXIF_MARKER,subvalue:0x4578,name:'exif'},{value:XMP_MARKER,subvalue:0x6874,name:'xmp'},{value:MPF_MARKER,subvalue:0x4d50,name:'mpf'}];var JPEG_SOI_MARKER=0xffd8;// start of JPEG
var JPEG_MARKER_PREFIX=0xff;var dataViewGetApplicationMarkers=function dataViewGetApplicationMarkers(view){// If no SOI marker exit here because we're not going to find the APP1 header in a non-jpeg file
if(view.getUint16(0)!==JPEG_SOI_MARKER)return undefined;var length=view.byteLength;// cache the length here
var offset=2;// start at 2 as we skip the SOI marker
var marker;// this will hold the current marker
// resulting markers
var res=undefined;while(offset<length){// test if marker is valid JPEG marker (starts with ff)
if(view.getUint8(offset)!==JPEG_MARKER_PREFIX)break;// let's read the full marker
marker=view.getUint16(offset);// read marker if included in marker types
var markerDescription=Markers.find(function(descriptor){if(descriptor.value===marker){if(descriptor.subvalue)return descriptor.subvalue===view.getUint16(offset+2+2);return true;}return false;});if(markerDescription){var name=markerDescription.name;if(!res)res={};// prevent overwriting by double markers
if(!res[name]){res[name]={offset:offset,size:view.getUint16(offset+2)};}}// Image stream starts here, no markers found
if(marker===SOS_MARKER)break;// next offset is 2 to skip over marker type and then we add marker data size to skip to next marker
offset+=2+view.getUint16(offset+2);}// no APP markers found
return res;};var APP1_MARKER=0xffe1;var APP1_EXIF_IDENTIFIER=0x45786966;var TIFF_MARKER=0x002a;var BYTE_ALIGN_MOTOROLA=0x4d4d;var BYTE_ALIGN_INTEL=0x4949;// offset = start of APP1_MARKER
var dataViewGetExifTags=function dataViewGetExifTags(view,offset){// If no APP1 marker exit here because we're not going to find the EXIF id header outside of APP1
if(view.getUint16(offset)!==APP1_MARKER)return undefined;// get marker size
var size=view.getUint16(offset+2);// 14197
// Let's skip over app1 marker and size marker (2 + 2 bytes)
offset+=4;// We're now at the EXIF header marker (we'll only check the first 4 bytes, reads "exif"), if not there, exit
if(view.getUint32(offset)!==APP1_EXIF_IDENTIFIER)return undefined;// Let's skip over 6 byte EXIF marker
offset+=6;// Read byte alignment
var byteAlignment=view.getUint16(offset);if(byteAlignment!==BYTE_ALIGN_INTEL&&byteAlignment!==BYTE_ALIGN_MOTOROLA)return undefined;var storedAsLittleEndian=byteAlignment===BYTE_ALIGN_INTEL;// Skip over byte alignment
offset+=2;// Test if valid tiff marker data, should always be 0x002a
if(view.getUint16(offset,storedAsLittleEndian)!==TIFF_MARKER)return undefined;// Skip to first IDF, position of IDF is read after tiff marker (offset 2)
offset+=view.getUint32(offset+2,storedAsLittleEndian);// helper method to find tag offset by marker
var getTagOffsets=function getTagOffsets(marker){var offsets=[];var i=offset;var max=Math.min(view.byteLength,offset+size-16);for(;i<max;i+=12){var tagOffset=i;// see if is match, if not, next entry
if(view.getUint16(tagOffset,storedAsLittleEndian)!==marker)continue;// add offset
offsets.push(tagOffset);}return offsets;};return{read:function read(address){var tagOffsets=getTagOffsets(address);if(!tagOffsets.length)return undefined;// only return first found tag
return view.getUint16(tagOffsets[0]+8,storedAsLittleEndian);},write:function write(address,value){var tagOffsets=getTagOffsets(address);if(!tagOffsets.length)return false;// overwrite all found tags (sometimes images can have multiple tags with the same value, let's make sure they're all set)
tagOffsets.forEach(function(offset){return view.setUint16(offset+8,value,storedAsLittleEndian);});return true;}};};var ORIENTATION_TAG=0x0112;var arrayBufferImageExif=function arrayBufferImageExif(data,key,value){// no data, no go!
if(!data)return;var view=new DataView(data);// Get app1 header offset
var markers=dataViewGetApplicationMarkers(view);if(!markers||!markers.exif)return;// Get EXIF tags read/writer
var tags=dataViewGetExifTags(view,markers.exif.offset);if(!tags)return;// Read the exif orientation marker
return value===undefined?tags.read(key):tags.write(key,value);};var backup='__pqina_webapi__';var getNativeAPIRef=function getNativeAPIRef(API){return window[backup]?window[backup][API]:window[API];};var noop$1=function noop$1(){};var FileReaderDataFormat={ArrayBuffer:'readAsArrayBuffer'};var readFile=function readFile(file){var onprogress=arguments.length>1&&arguments[1]!==undefined?arguments[1]:noop$1;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new Promise(function(resolve,reject){var _options$dataFormat=options.dataFormat,dataFormat=_options$dataFormat===void 0?FileReaderDataFormat.ArrayBuffer:_options$dataFormat;var reader=new(getNativeAPIRef('FileReader'))();reader.onload=function(){return resolve(reader.result);};reader.onerror=reject;reader.onprogress=onprogress;reader[dataFormat](file);});};var blobReadSection=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(blob){var slice,onprogress,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:slice=_args.length>1&&_args[1]!==undefined?_args[1]:[0,blob.size];onprogress=_args.length>2?_args[2]:undefined;_context.next=4;return readFile(blob.slice.apply(blob,_toConsumableArray(slice)),onprogress);case 4:return _context.abrupt("return",_context.sent);case 5:case"end":return _context.stop();}},_callee);}));return function blobReadSection(_x){return _ref.apply(this,arguments);};}();var getImageOrientationFromFile=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(file,onprogress){var head;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return blobReadSection(file,[0,64*4096],onprogress);case 2:head=_context2.sent;return _context2.abrupt("return",arrayBufferImageExif(head,ORIENTATION_TAG)||1);case 4:case"end":return _context2.stop();}},_callee2);}));return function getImageOrientationFromFile(_x2,_x3){return _ref2.apply(this,arguments);};}();var result$c=null;var isBrowser=function isBrowser(){if(result$c===null)result$c=typeof window!=='undefined'&&typeof window.document!=='undefined';return result$c;};var result$b=null;var canOrientImages=function canOrientImages(){return new Promise(function(resolve){if(result$b===null){// 2x1 pixel image 90CW rotated with orientation EXIF header
var testSrc='data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=';var testImage=isBrowser()?new Image():{};testImage.onload=function(){// should correct orientation if is presented in landscape,
// in which case the browser doesn't autocorrect
result$b=testImage.naturalWidth===1;testImage=undefined;resolve(result$b);};testImage.src=testSrc;return;}return resolve(result$b);});};var canvasToImageData=function canvasToImageData(canvas){var imageData=canvas.getContext('2d').getImageData(0,0,canvas.width,canvas.height);return imageData;};var h=function h(name,attributes){var children=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var el=document.createElement(name);// @ts-ignore
var descriptors=Object.getOwnPropertyDescriptors(el.__proto__);for(var key in attributes){if(key==='style'){el.style.cssText=attributes[key];}else if(descriptors[key]&&descriptors[key].set||/textContent|innerHTML/.test(key)||typeof attributes[key]==='function'){el[key]=attributes[key];}else{el.setAttribute(key,attributes[key]);}}children.forEach(function(child){return el.appendChild(child);});return el;};var MATRICES={1:function _(){return[1,0,0,1,0,0];},2:function _(width){return[-1,0,0,1,width,0];},3:function _(width,height){return[-1,0,0,-1,width,height];},4:function _(width,height){return[1,0,0,-1,0,height];},5:function _(){return[0,1,1,0,0,0];},6:function _(width,height){return[0,1,-1,0,height,0];},7:function _(width,height){return[0,-1,-1,0,height,width];},8:function _(width){return[0,-1,1,0,0,width];}};var getImageOrientationMatrix=function getImageOrientationMatrix(width,height){var orientation=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;if(orientation===-1)orientation=1;return MATRICES[orientation](width,height);};var releaseCanvas=function releaseCanvas(canvas){canvas.width=1;canvas.height=1;var ctx=canvas.getContext('2d');ctx&&ctx.clearRect(0,0,1,1);};var isImageData=function isImageData(obj){return'data'in obj;};var isUserAgent=function isUserAgent(test){return isBrowser()?RegExp(test).test(window.navigator.userAgent):undefined;};var result$a=null;var isAndroid=function isAndroid(){if(result$a===null)result$a=isUserAgent(/Android/);return result$a;};var canvasClone=function canvasClone(canvas,options){var clone=h('canvas',{width:canvas.width,height:canvas.height});clone.getContext('2d',options).drawImage(canvas,0,0);return clone;};var imageDataToCanvas=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(imageData){var orientation,canOrient,_ref4,_ref5,width,height,canvas,ctx,inMemoryCanvas,_ctx,_args3=arguments;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:orientation=_args3.length>1&&_args3[1]!==undefined?_args3[1]:1;_context3.next=3;return canOrientImages();case 3:canOrient=_context3.sent;_ref4=canOrient||orientation<5?[imageData.width,imageData.height]:[imageData.height,imageData.width],_ref5=_slicedToArray(_ref4,2),width=_ref5[0],height=_ref5[1];canvas=h('canvas',{width:width,height:height});ctx=canvas.getContext('2d',{willReadFrequently:true});// transform image data ojects into in memory canvas elements so we can transform them (putImageData isn't affect by transforms)
if(isImageData(imageData)&&!canOrient&&orientation>1){inMemoryCanvas=h('canvas',{width:imageData.width,height:imageData.height});_ctx=inMemoryCanvas.getContext('2d',{willReadFrequently:true});_ctx.putImageData(imageData,0,0);imageData=inMemoryCanvas;}// get base transformation matrix
if(!canOrient&&orientation>1){ctx.transform.apply(ctx,getImageOrientationMatrix(imageData.width,imageData.height,orientation));}// can't test for instanceof ImageBitmap as Safari doesn't support it
// if still imageData object by this point, we'll use put
if(!isImageData(imageData)){_context3.next=15;break;}ctx.putImageData(imageData,0,0);// Somehow on Android + Intel (not on M1) a toBlob call on the current canvas won't return a valid image blob, for some reason duplicating the canvas solves it #882
if(!isAndroid()){_context3.next=13;break;}return _context3.abrupt("return",canvasClone(canvas));case 13:_context3.next=16;break;case 15:ctx.drawImage(imageData,0,0);case 16:// if image data is of type canvas, clean it up
if(imageData instanceof HTMLCanvasElement)releaseCanvas(imageData);return _context3.abrupt("return",canvas);case 18:case"end":return _context3.stop();}},_callee3);}));return function imageDataToCanvas(_x4){return _ref3.apply(this,arguments);};}();var orientImageData=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(imageData){var orientation,_args4=arguments;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:orientation=_args4.length>1&&_args4[1]!==undefined?_args4[1]:1;if(!(orientation===1)){_context4.next=3;break;}return _context4.abrupt("return",imageData);case 3:_context4.next=5;return canOrientImages();case 5:if(_context4.sent){_context4.next=11;break;}_context4.t0=canvasToImageData;_context4.next=9;return imageDataToCanvas(imageData,orientation);case 9:_context4.t1=_context4.sent;return _context4.abrupt("return",(0,_context4.t0)(_context4.t1));case 11:return _context4.abrupt("return",imageData);case 12:case"end":return _context4.stop();}},_callee4);}));return function orientImageData(_x5){return _ref6.apply(this,arguments);};}();var isObject=function isObject(v){return _typeof(v)==='object';};var copy=function copy(val){return isObject(val)?deepCopy(val):val;};var deepCopy=function deepCopy(src){var dst;if(Array.isArray(src)){dst=[];src.forEach(function(val,i){dst[i]=copy(val);});}else{dst={};Object.keys(src).forEach(function(key){var val=src[key];dst[key]=copy(val);});}return dst;};var isString=function isString(v){return typeof v==='string';};var isFunction=function isFunction(v){return typeof v==='function';};var imageToCanvas=function imageToCanvas(image,_ref7){var width=_ref7.width,height=_ref7.height,canvasMemoryLimit=_ref7.canvasMemoryLimit,contextOptions=_ref7.contextOptions;var canvasWidth=width||image.naturalWidth;var canvasHeight=height||image.naturalHeight;// if no width and no height use defaults
if(!canvasWidth&&!canvasHeight){// if these are 0 it's possible that we're trying to convert an SVG that doesn't have width or height attributes
// https://bugzilla.mozilla.org/show_bug.cgi?id=1328124
canvasWidth=300;canvasHeight=150;}// determine if requires more memory than limit, if so limit target size
var requiredCanvasMemory=canvasWidth*canvasHeight;if(canvasMemoryLimit&&requiredCanvasMemory>canvasMemoryLimit){var canvasScalar=Math.sqrt(canvasMemoryLimit)/Math.sqrt(requiredCanvasMemory);canvasWidth=Math.floor(canvasWidth*canvasScalar);canvasHeight=Math.floor(canvasHeight*canvasScalar);}// create new canvas element
var canvas=h('canvas');canvas.width=canvasWidth;canvas.height=canvasHeight;var ctx=canvas.getContext('2d',contextOptions);ctx.drawImage(image,0,0,canvasWidth,canvasHeight);return canvas;};// turns image into canvas only after it's fully loaded
var imageToCanvasSafe=function imageToCanvasSafe(image,options){return new Promise(function(resolve,reject){var ready=function ready(){return resolve(imageToCanvas(image,options));};if(image.complete&&image.width){// need to test for image.width, on ie11 it will be 0 for object urls
ready();}else{image.onload=ready;image.onerror=reject;}});};var blobToCanvas=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(imageBlob,options){var imageElement,canvas;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:imageElement=h('img',{src:URL.createObjectURL(imageBlob)});_context5.next=3;return imageToCanvasSafe(imageElement,options);case 3:canvas=_context5.sent;URL.revokeObjectURL(imageElement.src);return _context5.abrupt("return",canvas);case 6:case"end":return _context5.stop();}},_callee5);}));return function blobToCanvas(_x6,_x7){return _ref8.apply(this,arguments);};}();var canCreateImageBitmap=function canCreateImageBitmap(){return'createImageBitmap'in window;};var canCreateOffscreenCanvas=function canCreateOffscreenCanvas(){return'OffscreenCanvas'in window;};var isSVGFile=function isSVGFile(blob){return /svg/.test(blob.type);};var getUniqueId=function getUniqueId(){return Math.random().toString(36).substr(2,9);};var functionToBlob=function functionToBlob(fn){return new Blob(['(',typeof fn==='function'?fn.toString():fn,')()'],{type:'application/javascript'});};var wrapFunction=function wrapFunction(fn){return"function () {self.onmessage = function (message) {(".concat(fn.toString(),").apply(null, message.data.content.concat([function (err, response) {\n    response = response || {};\n    const transfer = 'data' in response ? [response.data.buffer] : 'width' in response ? [response] : [];\n    return self.postMessage({ id: message.data.id, content: response, error: err }, transfer);\n}]))}}");};var workerPool=new Map();var thread=function thread(fn,args,transferList){return new Promise(function(resolve,reject){var workerKey=fn.toString();var pooledWorker=workerPool.get(workerKey);if(!pooledWorker){// create worker for this function
var workerFn=wrapFunction(fn);// create a new web worker
var url=URL.createObjectURL(functionToBlob(workerFn));var messages=new Map();var worker=new Worker(url);// create a pooled worker, this object will contain the worker and active messages
pooledWorker={url:url,worker:worker,messages:messages,terminationTimeout:undefined,terminate:function terminate(){clearTimeout(pooledWorker.terminationTimeout);pooledWorker.worker.terminate();URL.revokeObjectURL(url);workerPool["delete"](workerKey);}};// handle received messages
worker.onmessage=function(e){// should receive message id and message
var _e$data=e.data,id=_e$data.id,content=_e$data.content,error=_e$data.error;// automatically clean up workers after half a second
clearTimeout(pooledWorker.terminationTimeout);pooledWorker.terminationTimeout=setTimeout(function(){if(messages.size>0)return;pooledWorker.terminate();},500);// message route no longer valid
if(!messages.has(id))return;// get related thread and resolve with returned content
var message=messages.get(id);// remove thread from threads cache
messages["delete"](id);// resolve or reject message based on response from worker
error!=null?message.reject(error):message.resolve(content);};// pool this worker
workerPool.set(workerKey,pooledWorker);}// we need a way to remember this message so we generate a unique id and use that as a key for this request, that way we can link the response back to request in the pooledWorker.onmessage handler
var messageId=getUniqueId();pooledWorker.messages.set(messageId,{resolve:resolve,reject:reject});// use pooled worker and await response
pooledWorker.worker.postMessage({id:messageId,content:args},transferList);});};var blobToImageData=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(imageBlob,canvasMemoryLimit){var mainThreadBlobToImageData,imageData;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:mainThreadBlobToImageData=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(){var canvas,imageData;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:_context6.next=2;return blobToCanvas(imageBlob,{canvasMemoryLimit:canvasMemoryLimit,contextOptions:{willReadFrequently:true}});case 2:canvas=_context6.sent;imageData=canvasToImageData(canvas);releaseCanvas(canvas);return _context6.abrupt("return",imageData);case 6:case"end":return _context6.stop();}},_callee6);}));return function mainThreadBlobToImageData(){return _ref10.apply(this,arguments);};}();// somehow there's a weird issue with Android where when it uses offscreen canvas
// the imagedata gets "lost" when turning a canvas with that imagedata back into a blob
// for now we can circumvent the issue by creating the imagedata in the main thread
if(!isAndroid()){_context7.next=5;break;}_context7.next=4;return mainThreadBlobToImageData();case 4:return _context7.abrupt("return",_context7.sent);case 5:if(!(canCreateImageBitmap()&&!isSVGFile(imageBlob)&&canCreateOffscreenCanvas())){_context7.next=14;break;}_context7.prev=6;_context7.next=9;return thread(function(file,canvasMemoryLimit,done){createImageBitmap(file).then(function(bitmap){var canvasWidth=bitmap.width;var canvasHeight=bitmap.height;// determine if requires more memory than limit, if so limit target size
var requiredCanvasMemory=canvasWidth*canvasHeight;if(canvasMemoryLimit&&requiredCanvasMemory>canvasMemoryLimit){var canvasScalar=Math.sqrt(canvasMemoryLimit)/Math.sqrt(requiredCanvasMemory);canvasWidth=Math.floor(canvasWidth*canvasScalar);canvasHeight=Math.floor(canvasHeight*canvasScalar);}var canvas=new OffscreenCanvas(canvasWidth,canvasHeight);var ctx=canvas.getContext('2d',{// we're going to read from this canvas, don't hardware accelerate
willReadFrequently:true});ctx.drawImage(bitmap,0,0,canvasWidth,canvasHeight);var imageData=ctx.getImageData(0,0,canvas.width,canvas.height);done(null,imageData);})["catch"](function(err){// fail silently
done(err);});},[imageBlob,canvasMemoryLimit]);case 9:imageData=_context7.sent;_context7.next=14;break;case 12:_context7.prev=12;_context7.t0=_context7["catch"](6);case 14:if(!(!imageData||!imageData.width)){_context7.next=18;break;}_context7.next=17;return mainThreadBlobToImageData();case 17:return _context7.abrupt("return",_context7.sent);case 18:return _context7.abrupt("return",imageData);case 19:case"end":return _context7.stop();}},_callee7,null,[[6,12]]);}));return function blobToImageData(_x8,_x9){return _ref9.apply(this,arguments);};}();var canvasToBlob=function canvasToBlob(canvas){var mimeType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;var quality=arguments.length>2&&arguments[2]!==undefined?arguments[2]:undefined;return new Promise(function(resolve,reject){try{canvas.toBlob(function(blob){resolve(blob);},mimeType,quality);}catch(err){reject(err);}});};var imageDataToBlob=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(imageData,mimeType,quality){var canvas,blob;return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:_context8.next=2;return imageDataToCanvas(imageData);case 2:canvas=_context8.sent;_context8.next=5;return canvasToBlob(canvas,mimeType,quality);case 5:blob=_context8.sent;releaseCanvas(canvas);return _context8.abrupt("return",blob);case 8:case"end":return _context8.stop();}},_callee8);}));return function imageDataToBlob(_x10,_x11,_x12){return _ref11.apply(this,arguments);};}();var blobWriteSection=function blobWriteSection(blob,section){var slice=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[0,blob.size];if(!section)return blob;return new Blob([section,blob.slice.apply(blob,_toConsumableArray(slice))],{type:blob.type});};var mimeTypes={matroska:'mkv'};var getExtensionFromMimeType=function getExtensionFromMimeType(mimeType){var ext=(mimeType.match(/\/([a-z0-9]+)/)||[])[1];if(/^x/.test(ext)){var _mimeType$split=mimeType.split('/x-'),_mimeType$split2=_slicedToArray(_mimeType$split,2),_mimeType$split2$=_mimeType$split2[1],_post=_mimeType$split2$===void 0?'':_mimeType$split2$;return mimeTypes[_post];}return ext;};var getFilenameWithoutExtension=function getFilenameWithoutExtension(name){return name.substr(0,name.lastIndexOf('.'))||name;};var getExtensionFromFilename=function getExtensionFromFilename(filename){return filename.split('.').pop();};var ImageExtensionsRegex=/avif|bmp|gif|jpg|jpeg|jpe|jif|jfif|png|svg|tiff|webp/;/*
Support image mime types
- image/webp
- image/gif
- image/avif
- image/jpeg
- image/png
- image/bmp
- image/svg+xml
*/var getMimeTypeFromExtension=function getMimeTypeFromExtension(ext){// empty string returned if extension not found
if(!ImageExtensionsRegex.test(ext))return'';// return MimeType for this extension
return'image/'+(/jfif|jif|jpe|jpg/.test(ext)?'jpeg':ext==='svg'?'svg+xml':ext);};var getMimeTypeFromFilename=function getMimeTypeFromFilename(name){return name&&getMimeTypeFromExtension(getExtensionFromFilename(name).toLowerCase());};var matchFilenameToMimeType=function matchFilenameToMimeType(filename,mimeType){// get the mime type that matches this extension
var fileMimeType=getMimeTypeFromFilename(filename);// test if type already matches current mime type, no need to change name
if(fileMimeType===mimeType)return filename;// get the extension for this mimetype (gets all characters after the "image/" part)
// if mimeType doesn't yield an extension, use the fileMimeType
var targetMimeTypeExtension=getExtensionFromMimeType(mimeType)||fileMimeType;return"".concat(getFilenameWithoutExtension(filename),".").concat(targetMimeTypeExtension);};var blobToFile=function blobToFile(blob,filename,mimetype){var lastModified=new Date().getTime();var blobHasMimeType=blob.type.length&&!/null|text/.test(blob.type);var blobMimeType=blobHasMimeType?blob.type:mimetype;var name=matchFilenameToMimeType(filename,blobMimeType);try{return new(getNativeAPIRef('File'))([blob],name,{lastModified:lastModified,type:blobHasMimeType?blob.type:blobMimeType});}catch(err){var file=blobHasMimeType?blob.slice():blob.slice(0,blob.size,blobMimeType);file.lastModified=lastModified;file.name=name;return file;}};var getAspectRatio=function getAspectRatio(w,h){return w/h;};var passthrough=function passthrough(v){return v;};var PI=Math.PI;var HALF_PI=Math.PI/2;var QUART_PI=HALF_PI/2;var isRotatedSideways=function isRotatedSideways(a){var rotationLimited=Math.abs(a)%Math.PI;return rotationLimited>QUART_PI&&rotationLimited<Math.PI-QUART_PI;};// enum Direction {
//     Top = 't',
//     Right = 'r',
//     Bottom = 'b',
//     Left = 'l',
//     TopLeft = 'tl',
//     TopRight = 'tr',
//     BottomRight = 'br',
//     BottomLeft = 'bl',
// }
// export const { Top, Right, Bottom, Left, TopLeft, TopRight, BottomRight, BottomLeft } = Direction;
// export default Direction;
var Direction={Top:'t',Right:'r',Bottom:'b',Left:'l',TopLeft:'tl',TopRight:'tr',BottomRight:'br',BottomLeft:'bl'};var Top=Direction.Top,Right=Direction.Right,Bottom=Direction.Bottom,Left=Direction.Left,TopLeft=Direction.TopLeft,TopRight=Direction.TopRight,BottomRight=Direction.BottomRight,BottomLeft=Direction.BottomLeft;var DirectionCoordinateTable=(_DirectionCoordinateT={},_defineProperty(_DirectionCoordinateT,Top,[0.5,0]),_defineProperty(_DirectionCoordinateT,Right,[1,0.5]),_defineProperty(_DirectionCoordinateT,Bottom,[0.5,1]),_defineProperty(_DirectionCoordinateT,Left,[0,0.5]),_defineProperty(_DirectionCoordinateT,TopLeft,[0,0]),_defineProperty(_DirectionCoordinateT,TopRight,[1,0]),_defineProperty(_DirectionCoordinateT,BottomRight,[1,1]),_defineProperty(_DirectionCoordinateT,BottomLeft,[0,1]),_DirectionCoordinateT);var fixPrecision=function fixPrecision(value){var precision=arguments.length>1&&arguments[1]!==undefined?arguments[1]:12;return parseFloat(value.toFixed(precision));};//
// generic
//
var scale=function scale(value,scalar,pivot){return pivot+(value-pivot)*scalar;};var ellipseCreateFromRect=function ellipseCreateFromRect(rect){return{x:rect.x+rect.width*0.5,y:rect.y+rect.height*0.5,rx:rect.width*0.5,ry:rect.height*0.5};};//
// vector
//
var vectorCreateEmpty=function vectorCreateEmpty(){return vectorCreate(0,0);};var vectorCreate=function vectorCreate(x,y){return{x:x,y:y};};var vectorCreateFromSize=function vectorCreateFromSize(size){return vectorCreate(size.width,size.height);};var vectorCreateFromAny=function vectorCreateFromAny(obj){return vectorCreate(obj.x,obj.y);};var vectorCreateFromPointerEvent=function vectorCreateFromPointerEvent(e){return vectorCreate(e.pageX,e.pageY);};var vectorCreateFromPointerEventOffset=function vectorCreateFromPointerEventOffset(e){return vectorCreate(e.offsetX,e.offsetY);};var vectorClone=function vectorClone(v){return vectorCreate(v.x,v.y);};var vectorUpdate=function vectorUpdate(v,x,y){v.x=x;v.y=y;return v;};var vectorInvert=function vectorInvert(v){v.x=-v.x;v.y=-v.y;return v;};var vectorPerpendicular=function vectorPerpendicular(v){var x=v.x;v.x=-v.y;v.y=x;return v;};var vectorRotate=function vectorRotate(v,radians){var pivot=arguments.length>2&&arguments[2]!==undefined?arguments[2]:vectorCreateEmpty();var cos=Math.cos(radians);var sin=Math.sin(radians);var tx=v.x-pivot.x;var ty=v.y-pivot.y;v.x=pivot.x+cos*tx-sin*ty;v.y=pivot.y+sin*tx+cos*ty;return v;};var vectorLength=function vectorLength(v){return Math.sqrt(v.x*v.x+v.y*v.y);};var vectorNormalize=function vectorNormalize(v){var length=Math.sqrt(v.x*v.x+v.y*v.y);if(length===0)return vectorCreateEmpty();v.x/=length;v.y/=length;return v;};var vectorAngle=function vectorAngle(v){return Math.atan2(v.y,v.x);};var vectorAngleBetween=function vectorAngleBetween(a,b){return Math.atan2(b.y-a.y,b.x-a.x);};var vectorEqual=function vectorEqual(a,b){return a.x===b.x&&a.y===b.y;};var vectorApply=function vectorApply(v,fn){v.x=fn(v.x);v.y=fn(v.y);return v;};var vectorAdd=function vectorAdd(a,b){a.x+=b.x;a.y+=b.y;return a;};var vectorSubtract=function vectorSubtract(a,b){a.x-=b.x;a.y-=b.y;return a;};var vectorDivide=function vectorDivide(v,l){v.x/=l;v.y/=l;return v;};var vectorMultiply=function vectorMultiply(v,f){v.x*=f;v.y*=f;return v;};var vectorDot=function vectorDot(a,b){return a.x*b.x+a.y*b.y;};var vectorCross=function vectorCross(a,b){return a.x*b.y-a.y*b.x;};var vectorDistanceSquared=function vectorDistanceSquared(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:vectorCreateEmpty();var x=a.x-b.x;var y=a.y-b.y;return x*x+y*y;};var vectorDistance=function vectorDistance(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:vectorCreateEmpty();return Math.sqrt(vectorDistanceSquared(a,b));};var vectorScale=function vectorScale(v,scalar,pivot){v.x=scale(v.x,scalar,pivot.x);v.y=scale(v.y,scalar,pivot.y);return v;};var vectorCenter=function vectorCenter(v){var x=0;var y=0;v.forEach(function(v){x+=v.x;y+=v.y;});return vectorCreate(x/v.length,y/v.length);};var vectorsFlip=function vectorsFlip(points,flipX,flipY,cx,cy){points.forEach(function(point){point.x=flipX?cx-(point.x-cx):point.x;point.y=flipY?cy-(point.y-cy):point.y;});return points;};var vectorsRotate=function vectorsRotate(points,angle,cx,cy){var s=Math.sin(angle);var c=Math.cos(angle);points.forEach(function(p){p.x-=cx;p.y-=cy;var rx=p.x*c-p.y*s;var ry=p.x*s+p.y*c;p.x=cx+rx;p.y=cy+ry;});return points;};//
// size
//
var toSize=function toSize(width,height){return{width:width,height:height};};var sizeClone=function sizeClone(size){return toSize(size.width,size.height);};var sizeCreateFromAny=function sizeCreateFromAny(obj){return toSize(obj.width,obj.height);};var sizeCreateFromRect=function sizeCreateFromRect(r){return toSize(r.width,r.height);};var sizeCreateFromArray=function sizeCreateFromArray(a){return toSize(a[0],a[1]);};var sizeCreateFromImageNaturalSize=function sizeCreateFromImageNaturalSize(image){return toSize(image.naturalWidth,image.naturalHeight);};var sizeCreateFromElement=function sizeCreateFromElement(element){if(/img/i.test(element.nodeName)){return sizeCreateFromImageNaturalSize(element);}return sizeCreateFromAny(element);};var sizeCreate=function sizeCreate(width,height){return toSize(width,height);};var sizeEqual=function sizeEqual(a,b){var format=arguments.length>2&&arguments[2]!==undefined?arguments[2]:passthrough;return format(a.width)===format(b.width)&&format(a.height)===format(b.height);};var sizeScale=function sizeScale(size,scalar){size.width*=scalar;size.height*=scalar;return size;};var sizeCenter=function sizeCenter(size){return vectorCreate(size.width*0.5,size.height*0.5);};var sizeRotate=function sizeRotate(size,radians){var r=Math.abs(radians);var cos=Math.cos(r);var sin=Math.sin(r);var w=cos*size.width+sin*size.height;var h=sin*size.width+cos*size.height;size.width=w;size.height=h;return size;};var sizeTurn=function sizeTurn(size,radians){var w=size.width;var h=size.height;if(isRotatedSideways(radians)){size.width=h;size.height=w;}return size;};var sizeContains=function sizeContains(a,b){return a.width>=b.width&&a.height>=b.height;};var sizeApply=function sizeApply(size,fn){size.width=fn(size.width);size.height=fn(size.height);return size;};var sizeHypotenuse=function sizeHypotenuse(size){return Math.sqrt(size.width*size.width+size.height*size.height);};var sizeMin=function sizeMin(a,b){return sizeCreate(Math.min(a.width,b.width),Math.min(a.height,b.height));};//
// line
//
var lineCreate=function lineCreate(start,end){return{start:start,end:end};};var lineClone=function lineClone(line){return lineCreate(vectorClone(line.start),vectorClone(line.end));};var lineExtend=function lineExtend(line,amount){if(amount===0)return line;var v=vectorCreate(line.start.x-line.end.x,line.start.y-line.end.y);var n=vectorNormalize(v);var m=vectorMultiply(n,amount);line.start.x+=m.x;line.start.y+=m.y;line.end.x-=m.x;line.end.y-=m.y;return line;};var lineMultiply=function lineMultiply(line,amount){if(amount===0)return line;var v=vectorCreate(line.start.x-line.end.x,line.start.y-line.end.y);var n=vectorNormalize(v);var m=vectorMultiply(n,amount);line.end.x+=m.x;line.end.y+=m.y;return line;};var lineExtrude=function lineExtrude(_ref12,amount){var start=_ref12.start,end=_ref12.end;if(amount===0)return[vectorCreate(start.x,start.y),vectorCreate(start.x,start.y),vectorCreate(end.x,end.y),vectorCreate(end.x,end.y)];var a=Math.atan2(end.y-start.y,end.x-start.x);var sina=Math.sin(a)*amount;var cosa=Math.cos(a)*amount;return[vectorCreate(sina+start.x,-cosa+start.y),vectorCreate(-sina+start.x,cosa+start.y),vectorCreate(-sina+end.x,cosa+end.y),vectorCreate(sina+end.x,-cosa+end.y)];};//
// rect
//
var CornerSigns=[vectorCreate(-1,-1),vectorCreate(-1,1),vectorCreate(1,1),vectorCreate(1,-1)];var toRect=function toRect(x,y,width,height){return{x:x,y:y,width:width,height:height};};var rectClone$1=function rectClone$1(rect){return toRect(rect.x,rect.y,rect.width,rect.height);};var rectCreateEmpty=function rectCreateEmpty(){return toRect(0,0,0,0);};var rectCreateFromDimensions=function rectCreateFromDimensions(width,height){return toRect(0,0,width,height);};var rectCreateFromSize=function rectCreateFromSize(size){return toRect(0,0,size.width,size.height);};var rectCreateFromBounds=function rectCreateFromBounds(bounds){return toRect(bounds[3],bounds[0],bounds[1]-bounds[3],bounds[2]-bounds[0]);};var rectCreateFromAny=function rectCreateFromAny(obj){return toRect(obj.x||0,obj.y||0,obj.width||0,obj.height||0);};var rectCreateFromPoints=function rectCreateFromPoints(points){var xMin=points[0].x;var xMax=points[0].x;var yMin=points[0].y;var yMax=points[0].y;points.forEach(function(point){xMin=Math.min(xMin,point.x);xMax=Math.max(xMax,point.x);yMin=Math.min(yMin,point.y);yMax=Math.max(yMax,point.y);});return toRect(xMin,yMin,xMax-xMin,yMax-yMin);};var rectCreateFromEllipse=function rectCreateFromEllipse(ellipse){return rectCreate(ellipse.x-ellipse.rx,ellipse.y-ellipse.ry,ellipse.rx*2,ellipse.ry*2);};var rectCreateWithCenter=function rectCreateWithCenter(center,size){return toRect(center.x-size.width*0.5,center.y-size.height*0.5,size.width,size.height);};var rectCreate=function rectCreate(x,y,width,height){return toRect(x,y,width,height);};var rectCenter=function rectCenter(rect){return vectorCreate(rect.x+rect.width*0.5,rect.y+rect.height*0.5);};var rectTranslate$1=function rectTranslate$1(rect,t){rect.x+=t.x;rect.y+=t.y;return rect;};var rectScale$1=function rectScale$1(rect,scalar,pivot){pivot=pivot||rectCenter(rect);rect.x=scalar*(rect.x-pivot.x)+pivot.x;rect.y=scalar*(rect.y-pivot.y)+pivot.y;rect.width=scalar*rect.width;rect.height=scalar*rect.height;return rect;};var rectClamp=function rectClamp(rect,sizeMin,sizeMax,pivot){var x=(pivot.x-rect.x)/rect.width;var y=(pivot.y-rect.y)/rect.height;var width=Math.max(sizeMin.width,rect.width);var height=Math.max(sizeMin.height,rect.height);width=Math.min(sizeMax.width,width);height=Math.min(sizeMax.height,height);rect.x=pivot.x-x*width;rect.y=pivot.y-y*height;rect.width=width;rect.height=height;return rect;};var rectGetCornerByTarget=function rectGetCornerByTarget(rect,target){var _DirectionCoordinateT2=_slicedToArray(DirectionCoordinateTable[target],2),xf=_DirectionCoordinateT2[0],yf=_DirectionCoordinateT2[1];var x=xf*rect.width;var y=yf*rect.height;return vectorCreate(rect.x+x,rect.y+y);};var rectMultiply=function rectMultiply(rect,factor){rect.x*=factor;rect.y*=factor;rect.width*=factor;rect.height*=factor;return rect;};var rectDivide=function rectDivide(rect,factor){rect.x/=factor;rect.y/=factor;rect.width/=factor;rect.height/=factor;return rect;};var rectSubtract=function rectSubtract(a,b){a.x-=b.x;a.y-=b.y;a.width-=b.width;a.height-=b.height;return a;};var rectAdd=function rectAdd(a,b){a.x+=b.x;a.y+=b.y;a.width+=b.width;a.height+=b.height;return a;};var rectEqual=function rectEqual(a,b){var format=arguments.length>2&&arguments[2]!==undefined?arguments[2]:passthrough;return format(a.x)===format(b.x)&&format(a.y)===format(b.y)&&format(a.width)===format(b.width)&&format(a.height)===format(b.height);};var rectAspectRatio=function rectAspectRatio(rect){return getAspectRatio(rect.width,rect.height);};var rectUpdate=function rectUpdate(rect,x,y,width,height){rect.x=x;rect.y=y;rect.width=width;rect.height=height;return rect;};var rectUpdateWithRect=function rectUpdateWithRect(a,b){a.x=b.x;a.y=b.y;a.width=b.width;a.height=b.height;return a;};var rectRotate=function rectRotate(rect,radians,pivot){if(!pivot)pivot=rectCenter(rect);return rectGetCorners(rect).map(function(vertex){return vectorRotate(vertex,radians,pivot);});};var rectCenterRect=function rectCenterRect(a,b){return toRect(a.width*0.5-b.width*0.5,a.height*0.5-b.height*0.5,b.width,b.height);};var rectContainsPoint=function rectContainsPoint(rect,point){if(point.x<rect.x)return false;if(point.y<rect.y)return false;if(point.x>rect.x+rect.width)return false;if(point.y>rect.y+rect.height)return false;return true;};var rectCoverRect=function rectCoverRect(rect,aspectRatio){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:vectorCreateEmpty();if(rect.width===0||rect.height===0)return rectCreateEmpty();var inputAspectRatio=rectAspectRatio(rect);if(!aspectRatio)aspectRatio=inputAspectRatio;var width=rect.width;var height=rect.height;if(aspectRatio>inputAspectRatio){// height remains the same, width is expanded
width=height*aspectRatio;}else{// width remains the same, height is expanded
height=width/aspectRatio;}return toRect(offset.x+(rect.width-width)*0.5,offset.y+(rect.height-height)*0.5,width,height);};var rectLimitInRect=function rectLimitInRect(childRect,parentRect,aspectRatio){var _rectToBounds=rectToBounds(childRect),_rectToBounds2=_slicedToArray(_rectToBounds,4),t=_rectToBounds2[0],r=_rectToBounds2[1],b=_rectToBounds2[2],l=_rectToBounds2[3];var rectOrigin=_objectSpread({},childRect);if(t<parentRect.y){childRect.height=childRect.height-(parentRect.y-t);childRect.y=parentRect.y;}if(r>parentRect.x+parentRect.width){childRect.width=parentRect.x+parentRect.width-childRect.x;}if(b>parentRect.y+parentRect.height){childRect.height=parentRect.y+parentRect.height-childRect.y;}if(l<parentRect.x){childRect.width=childRect.width-(parentRect.x-l);childRect.x=parentRect.x;}if(aspectRatio){// scalar
var _scalar=Math.min(1,rectOrigin.width/childRect.width,rectOrigin.height/childRect.height);return rectMultiply(rectOrigin,_scalar);}return childRect;};var rectOffsetInRect=function rectOffsetInRect(childRect,parentRect){var _rectToBounds3=rectToBounds(childRect),_rectToBounds4=_slicedToArray(_rectToBounds3,4),t=_rectToBounds4[0],r=_rectToBounds4[1],b=_rectToBounds4[2],l=_rectToBounds4[3];if(t<parentRect.y)childRect.y=Math.max(parentRect.y,childRect.y);if(r>parentRect.width)childRect.x=parentRect.width-childRect.width;if(b>parentRect.height)childRect.y=parentRect.height-childRect.height;if(l<parentRect.x)childRect.x=Math.max(parentRect.x,childRect.x);return childRect;};var rectContainRect=function rectContainRect(rect){var aspectRatio=arguments.length>1&&arguments[1]!==undefined?arguments[1]:rectAspectRatio(rect);var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:vectorCreateEmpty();if(rect.width===0||rect.height===0)return rectCreateEmpty();var width=rect.width;var height=width/aspectRatio;if(height>rect.height){height=rect.height;width=height*aspectRatio;}return toRect(offset.x+(rect.width-width)*0.5,offset.y+(rect.height-height)*0.5,width,height);};var rectToBounds=function rectToBounds(rect){return[Math.min(rect.y,rect.y+rect.height),Math.max(rect.x,rect.x+rect.width),Math.max(rect.y,rect.y+rect.height),Math.min(rect.x,rect.x+rect.width)// left
];};var rectGetCorners=function rectGetCorners(rect){return[vectorCreate(rect.x,rect.y),vectorCreate(rect.x+rect.width,rect.y),vectorCreate(rect.x+rect.width,rect.y+rect.height),vectorCreate(rect.x,rect.y+rect.height)];};var rectApply=function rectApply(rect,fn){if(!rect)return;rect.x=fn(rect.x);rect.y=fn(rect.y);rect.width=fn(rect.width);rect.height=fn(rect.height);return rect;};var rectApplyPerspective=function rectApplyPerspective(rect,perspective){var pivot=arguments.length>2&&arguments[2]!==undefined?arguments[2]:rectCenter(rect);return rectGetCorners(rect).map(function(corner,index){var sign=CornerSigns[index];return vectorCreate(scale(corner.x,1.0+sign.x*perspective.x,pivot.x),scale(corner.y,1.0+sign.y*perspective.y,pivot.y));});};var rectNormalizeOffset=function rectNormalizeOffset(rect){rect.x=0;rect.y=0;return rect;};var convexPolyCentroid=function convexPolyCentroid(vertices){var first=vertices[0];var last=vertices[vertices.length-1];// make sure is closed loop
vertices=vectorEqual(first,last)?vertices:[].concat(_toConsumableArray(vertices),[first]);var fx=first.x;var fy=first.y;var twiceArea=0;var i=0;var x=0;var y=0;var a;var b;var f;var l=vertices.length;for(;i<l;i++){// current vertex
a=vertices[i];// next vertex
b=vertices[i+1>l-1?0:i+1];f=(a.y-fy)*(b.x-fx)-(b.y-fy)*(a.x-fx);twiceArea+=f;x+=(a.x+b.x-2*fx)*f;y+=(a.y+b.y-2*fy)*f;}f=twiceArea*3;return vectorCreate(fx+x/f,fy+y/f);};var lineLineIntersection=function lineLineIntersection(a,b){return getLineLineIntersectionPoint(a.start,a.end,b.start,b.end);};var getLineLineIntersectionPoint=function getLineLineIntersectionPoint(a,b,c,d){var denominator=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);// lines are parallel
if(denominator===0)return undefined;var uA=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/denominator;var uB=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/denominator;// intersection is not on the line itself
if(uA<0||uA>1||uB<0||uB>1)return undefined;// return intersection point
return vectorCreate(a.x+uA*(b.x-a.x),a.y+uA*(b.y-a.y));};// checks if line intersects with one of the lines that can be drawn between the points (in sequence)
var linePointsIntersection=function linePointsIntersection(line,points){var _ref13=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref13$ignoreIdentica=_ref13.ignoreIdenticalLines,ignoreIdenticalLines=_ref13$ignoreIdentica===void 0?false:_ref13$ignoreIdentica,_ref13$breakOnInterse=_ref13.breakOnIntersection,breakOnIntersection=_ref13$breakOnInterse===void 0?false:_ref13$breakOnInterse;var l=points.length;var intersections=[];for(var i=0;i<l-1;i++){if(ignoreIdenticalLines&&(vectorEqual(line.start,points[i])||vectorEqual(line.start,points[i+1])||vectorEqual(line.end,points[i])||vectorEqual(line.end,points[i+1])))continue;var intersection=getLineLineIntersectionPoint(line.start,line.end,points[i],points[i+1]);if(!intersection)continue;if(breakOnIntersection)return[intersection];intersections.push(intersection);}return intersections.length?intersections:undefined;};var pointInPoly$1=function pointInPoly$1(point,vertices){var i=0;var j=0;var c=false;var l=vertices.length;for(i=0,j=l-1;i<l;j=i++){if(vertices[i].y>point.y!=vertices[j].y>point.y&&point.x<(vertices[j].x-vertices[i].x)*(point.y-vertices[i].y)/(vertices[j].y-vertices[i].y)+vertices[i].x){c=!c;}}return c;};// first tests if points of a are to be found in b, then does the reverse
var polyIntersectsWithPoly=function polyIntersectsWithPoly(a,b){var bContainsCornerOfA=a.find(function(corner){return pointInPoly$1(corner,b);});if(bContainsCornerOfA)return true;var aContainsCornerOfB=b.find(function(corner){return pointInPoly$1(corner,a);});if(aContainsCornerOfB)return true;return false;};var quadLines=function quadLines(vertices){var arr=[];for(var i=0;i<vertices.length;i++){var next=i+1;if(next===vertices.length)next=0;arr.push(lineCreate(vectorClone(vertices[i]),vectorClone(vertices[next])));}return arr;};var quadToLines=function quadToLines(vertices){var extension=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return quadLines(vertices)// extend the poly lines a tiny bit so we
// don't shoot rays between line gaps at corners
// this caused one intersection to be missing resulting
// in error while manipulating crop edges
// (rotate image 90degrees -> drag bottom edge) (2021-04-09)
.map(function(line){return lineExtend(line,extension);});};var ellipseToPolygon=function ellipseToPolygon(center,rx,ry){var rotation=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var flipX=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var flipY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var resolution=arguments.length>6&&arguments[6]!==undefined?arguments[6]:12;var points=[];for(var i=0;i<resolution;i++){points.push(vectorCreate(center.x+rx*Math.cos(i*(Math.PI*2)/resolution),center.y+ry*Math.sin(i*(Math.PI*2)/resolution)));}if(flipX||flipY)vectorsFlip(points,flipX,flipY,center.x,center.y);if(rotation)vectorsRotate(points,rotation,center.x,center.y);return points;};var getImageTransformedRect=function getImageTransformedRect(imageSize,imageRotation){var imageRect=rectCreateFromSize(imageSize);var imageCenter=rectCenter(imageRect);var imageTransformedVertices=rectRotate(imageRect,imageRotation,imageCenter);return rectNormalizeOffset(rectCreateFromPoints(imageTransformedVertices));};var isElement=function isElement(v,name){return v instanceof HTMLElement&&(name?new RegExp("^".concat(name,"$"),'i').test(v.nodeName):true);};var isFile=function isFile(v){return v instanceof File;};var canvasToFile=/*#__PURE__*/function(){var _ref14=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(canvas,mimeType,quality){var blob;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:_context9.next=2;return canvasToBlob(canvas,mimeType,quality);case 2:blob=_context9.sent;return _context9.abrupt("return",blobToFile(blob,'canvas'));case 4:case"end":return _context9.stop();}},_callee9);}));return function canvasToFile(_x13,_x14,_x15){return _ref14.apply(this,arguments);};}();var getFilenameFromURL=function getFilenameFromURL(url){return url.split('/').pop().split(/\?|\#/).shift();};// @ts-ignore
var supportsReplaceChildren=isBrowser()&&!!Node.prototype.replaceChildren;var fn$1=supportsReplaceChildren?// @ts-ignore
function(parent,newChildren){return parent.replaceChildren(newChildren);}:function(parent,newChildren){while(parent.lastChild){parent.removeChild(parent.lastChild);}if(newChildren!==undefined){parent.append(newChildren);}};var container=isBrowser()&&h('div',{"class":'PinturaMeasure',style:'position:absolute;left:0;top:0;width:99999px;height:0;pointer-events:none;contain:strict;margin:0;padding:0;'});var timeoutId;var appendForMeasuring=function appendForMeasuring(element){// replace element children with this child
fn$1(container,element);// append to DOM if not in it atm
if(!container.parentNode)document.body.append(container);// auto detach from DOM after it isn't used for a little while
clearTimeout(timeoutId);timeoutId=setTimeout(function(){container.remove();},500);// return added element for measuring
return element;};var result$9=null;var isSafari=function isSafari(){if(result$9===null)result$9=isBrowser()&&/^((?!chrome|android).)*(safari|iphone|ipad)/i.test(navigator.userAgent);// added |iphone|ipad as safari is not present in WebView on React Native
return result$9;};var getImageElementSize=function getImageElementSize(imageElement){return new Promise(function(resolve,reject){var shouldAutoRemove=false;// test if image is attached to DOM, if not attached, attach so measurement is correct on Safari
if(!imageElement.parentNode&&isSafari()){shouldAutoRemove=true;// has width 0 and height 0 to prevent rendering very big SVGs (without width and height) that will for one frame overflow the window and show a scrollbar
imageElement.style.cssText="position:absolute;visibility:hidden;pointer-events:none;left:0;top:0;width:0;height:0;";appendForMeasuring(imageElement);}// start testing size
var measure=function measure(){var width=imageElement.naturalWidth;var height=imageElement.naturalHeight;var hasSize=width&&height;if(!hasSize)return;// clean up image if was attached for measuring
if(shouldAutoRemove)imageElement.remove();clearInterval(intervalId);resolve({width:width,height:height});};imageElement.onerror=function(err){clearInterval(intervalId);reject(err);};var intervalId=setInterval(measure,1);measure();});};var getVideoElementSize=function getVideoElementSize(element){return new Promise(function(resolve,reject){var done=function done(){resolve({width:element.videoWidth,height:element.videoHeight});};if(element.readyState>=1)return done();element.onloadedmetadata=done;element.onerror=reject;});};var isImage=function isImage(file){return /^image/.test(file.type);};var getAsVideoOrImageElement=function getAsVideoOrImageElement(src){return new Promise(function(resolve){// undetermined or is video
var elementSrc=isString(src)?src:URL.createObjectURL(src);var createImage=function createImage(){var image=new Image();image.src=elementSrc;resolve(image);};// we can already know it's an image
if(src instanceof Blob&&isImage(src))return createImage();// try video first
var element=document.createElement('video');element.preload='metadata';element.onloadedmetadata=function(){return resolve(element);};// when errors we switch to image
element.onerror=createImage;element.src=elementSrc;});};var isVideoElement=function isVideoElement(element){return element.nodeName==='VIDEO';};// TODO: video rename function
var getImageSize=/*#__PURE__*/function(){var _ref15=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(src){var mediaElement,size;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:if(src['src']){_context10.next=6;break;}_context10.next=3;return getAsVideoOrImageElement(src);case 3:mediaElement=_context10.sent;_context10.next=7;break;case 6:mediaElement=src;case 7:_context10.prev=7;if(!isVideoElement(mediaElement)){_context10.next=14;break;}_context10.next=11;return getVideoElementSize(mediaElement);case 11:_context10.t0=_context10.sent;_context10.next=17;break;case 14:_context10.next=16;return getImageElementSize(mediaElement);case 16:_context10.t0=_context10.sent;case 17:size=_context10.t0;case 18:_context10.prev=18;isFile(src)&&URL.revokeObjectURL(mediaElement.src);return _context10.finish(18);case 21:return _context10.abrupt("return",size);case 22:case"end":return _context10.stop();}},_callee10,null,[[7,,18,21]]);}));return function getImageSize(_x16){return _ref15.apply(this,arguments);};}();var awaitComplete=function awaitComplete(image){return new Promise(function(resolve,reject){if(image.complete)return resolve(image);image.onload=function(){return resolve(image);};image.onerror=reject;});};var imageToFile=/*#__PURE__*/function(){var _ref16=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11(imageElement){var size,image,canvas,ctx,blob;return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:_context11.next=2;return getImageSize(imageElement);case 2:size=_context11.sent;_context11.next=5;return awaitComplete(imageElement);case 5:image=_context11.sent;canvas=h('canvas',size);ctx=canvas.getContext('2d',{willReadFrequently:true});ctx.drawImage(image,0,0);_context11.next=11;return canvasToBlob(canvas);case 11:blob=_context11.sent;return _context11.abrupt("return",blobToFile(blob,getFilenameFromURL(image.src)));case 13:case"end":return _context11.stop();}},_callee11);}));return function imageToFile(_x17){return _ref16.apply(this,arguments);};}();var isDataURI=function isDataURI(str){return /^data:/.test(str);};var createProgressEvent=function createProgressEvent(){var loaded=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var lengthComputable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return new(getNativeAPIRef('ProgressEvent'))('progress',{loaded:loaded*100,total:100,lengthComputable:lengthComputable});};var dataURIToFile=/*#__PURE__*/function(){var _ref17=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12(dataURI){var filename,onprogress,res,blob,mimeType,file,_args7=arguments;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1)switch(_context12.prev=_context12.next){case 0:filename=_args7.length>1&&_args7[1]!==undefined?_args7[1]:'data-uri';onprogress=_args7.length>2&&_args7[2]!==undefined?_args7[2]:noop$1;// basic loader, no size info
onprogress(createProgressEvent(0));_context12.next=5;return fetch(dataURI);case 5:res=_context12.sent;onprogress(createProgressEvent(0.33));_context12.next=9;return res.blob();case 9:blob=_context12.sent;if(!isImage(blob))mimeType="image/".concat(dataURI.includes(',/9j/')?'jpeg':'png');onprogress(createProgressEvent(0.66));file=blobToFile(blob,filename,mimeType);onprogress(createProgressEvent(1));return _context12.abrupt("return",file);case 15:case"end":return _context12.stop();}},_callee12);}));return function dataURIToFile(_x18){return _ref17.apply(this,arguments);};}();var getResponseHeader=function getResponseHeader(xhr,header){var parse=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(header){return header;};return xhr.getAllResponseHeaders().indexOf(header)>=0?parse(xhr.getResponseHeader(header)):undefined;};var getFilenameFromContentDisposition=function getFilenameFromContentDisposition(header){if(!header)return null;var matches=header.split(/filename=|filename\*=.+''/).splice(1).map(function(name){return name.trim().replace(/^["']|[;"']{0,2}$/g,'');}).filter(function(name){return name.length;});return matches.length?decodeURI(matches[matches.length-1]):null;};var EditorErrorCode={URL_REQUEST:'URL_REQUEST',DOCTYPE_MISSING:'DOCTYPE_MISSING'};var EditorError=/*#__PURE__*/function(_Error){_inherits(EditorError,_Error);var _super=_createSuper(EditorError);function EditorError(message,code,metadata){var _this;_classCallCheck(this,EditorError);_this=_super.call(this,message);_this.name='EditorError';_this.code=code;_this.metadata=metadata;return _this;}return _createClass(EditorError);}(/*#__PURE__*/_wrapNativeSuper(Error));// should be called after xhr.open
var configureXHR=function configureXHR(xhr,options){// https://developer.mozilla.org/en-US/docs/Web/API/fetch#parameters
// only handles headers and credentials for now
var _ref18=options||{},_ref18$headers=_ref18.headers,headers=_ref18$headers===void 0?{}:_ref18$headers,credentials=_ref18.credentials;// apply options to xhr
Object.entries(headers).forEach(function(_ref19){var _ref20=_slicedToArray(_ref19,2),header=_ref20[0],value=_ref20[1];return xhr.setRequestHeader(header,value);});// set xhr withCredentials
if(credentials)xhr.withCredentials=credentials!=='omit';};var fetchFile=function fetchFile(url,onprogress,options){return new Promise(function(resolve,reject){var handleError=function handleError(){return reject(new EditorError('Error fetching image',EditorErrorCode.URL_REQUEST,xhr));};var xhr=new XMLHttpRequest();xhr.onprogress=onprogress;xhr.onerror=handleError,xhr.onload=function(){if(!xhr.response||xhr.status>=300||xhr.status<200)return handleError();// we store the response mime type so we can add it to the blob later on, if it's missing (happens on Safari 10)
var mimetype=getResponseHeader(xhr,'Content-Type');// try to get filename and any file instructions as well
var filename=getResponseHeader(xhr,'Content-Disposition',getFilenameFromContentDisposition)||getFilenameFromURL(url);// convert to actual file if possible
resolve(blobToFile(xhr.response,filename,mimetype||getMimeTypeFromFilename(filename)));};// get helper
var willRequest=options.willRequest;Promise.resolve(willRequest&&willRequest(url,{resourceType:'image'})).then(function(requestInit){// don't load image
if(requestInit===false)return reject('Image load rejected');// we're good to go
xhr.open('GET',url);// set props
configureXHR(xhr,requestInit);// fire xhr
xhr.responseType='blob';xhr.send();})["catch"](console.error);});};var urlToFile=function urlToFile(url,onprogress,options){// use fetch to create blob from data uri
if(isDataURI(url))return dataURIToFile(url,undefined,onprogress);// load file from url
return fetchFile(url,onprogress,options);};var isBlob=function isBlob(v){return v instanceof Blob&&!(v instanceof File);};var isImageBitmap=function isImageBitmap(obj){return'close'in obj;};var srcToFile=/*#__PURE__*/function(){var _ref21=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee13(src,onprogress,options){return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1)switch(_context13.prev=_context13.next){case 0:if(!(isFile(src)||isBlob(src))){_context13.next=4;break;}return _context13.abrupt("return",src);case 4:if(!isString(src)){_context13.next=10;break;}_context13.next=7;return urlToFile(src,onprogress,options);case 7:return _context13.abrupt("return",_context13.sent);case 10:if(!isElement(src,'canvas')){_context13.next=16;break;}_context13.next=13;return canvasToFile(src);case 13:return _context13.abrupt("return",_context13.sent);case 16:if(!isElement(src,'img')){_context13.next=22;break;}_context13.next=19;return imageToFile(src);case 19:return _context13.abrupt("return",_context13.sent);case 22:if(!(isImageData(src)||isImageBitmap(src))){_context13.next=32;break;}_context13.t0=canvasToFile;_context13.next=26;return imageDataToCanvas(src);case 26:_context13.t1=_context13.sent;_context13.next=29;return(0,_context13.t0)(_context13.t1);case 29:return _context13.abrupt("return",_context13.sent);case 32:throw new EditorError('Invalid image source','invalid-image-source');case 33:case"end":return _context13.stop();}},_callee13);}));return function srcToFile(_x19,_x20,_x21){return _ref21.apply(this,arguments);};}();var result$8=null;var isMac=function isMac(){if(result$8===null)result$8=isBrowser()&&/^mac/i.test(navigator.platform);return result$8;};var result$7=null;var isIOS=function isIOS(){if(result$7===null)// first part is for iPhones and iPads iOS 12 and below second part is for iPads with iOS 13 and up
result$7=isBrowser()&&(isUserAgent(/iPhone|iPad|iPod/)||isMac()&&navigator.maxTouchPoints>=1);return result$7;};var orientImageSize=/*#__PURE__*/function(){var _ref22=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee14(size){var orientation,_args9=arguments;return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1)switch(_context14.prev=_context14.next){case 0:orientation=_args9.length>1&&_args9[1]!==undefined?_args9[1]:1;_context14.next=3;return canOrientImages();case 3:_context14.t0=_context14.sent;if(_context14.t0){_context14.next=6;break;}_context14.t0=isIOS();case 6:if(!_context14.t0){_context14.next=8;break;}return _context14.abrupt("return",size);case 8:if(!(orientation<5)){_context14.next=10;break;}return _context14.abrupt("return",size);case 10:return _context14.abrupt("return",sizeCreate(size.height,size.width));case 11:case"end":return _context14.stop();}},_callee14);}));return function orientImageSize(_x22){return _ref22.apply(this,arguments);};}();var isJPEG=function isJPEG(file){return /jpeg/.test(file.type);};var isPlainObject=function isPlainObject(obj){return _typeof(obj)=='object'&&obj.constructor==Object;};var stringify=function stringify(value){return!isPlainObject(value)?value:JSON.stringify(value);};var post=function post(url,dataset,options){return new Promise(function(resolve,reject){var _options$token=options.token,token=_options$token===void 0?{}:_options$token,_options$beforeSend=options.beforeSend,beforeSend=_options$beforeSend===void 0?noop$1:_options$beforeSend,_options$onprogress=options.onprogress,onprogress=_options$onprogress===void 0?noop$1:_options$onprogress;token.cancel=function(){return request.abort();};var request=new XMLHttpRequest();request.upload.onprogress=onprogress;request.onload=function(){return request.status>=200&&request.status<300?resolve(request):reject(request);};request.onerror=function(){return reject(request);};request.ontimeout=function(){return reject(request);};request.open('POST',encodeURI(url));beforeSend(request);request.send(// if is FormData, we use that
dataset instanceof FormData?dataset:// reduce the dataset to FormData
dataset.reduce(function(formData,args){// @ts-ignore
formData.append.apply(formData,_toConsumableArray(args.map(stringify)));return formData;},new FormData()));});};var ctxRotate=function ctxRotate(ctx){var rotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var pivot=arguments.length>2?arguments[2]:undefined;if(rotation===0)return ctx;ctx.translate(pivot.x,pivot.y);ctx.rotate(rotation);ctx.translate(-pivot.x,-pivot.y);return ctx;};var ctxTranslate=function ctxTranslate(ctx,x,y){ctx.translate(x,y);return ctx;};var ctxScale=function ctxScale(ctx,x,y){ctx.scale(x,y);return ctx;};var cropImageData=/*#__PURE__*/function(){var _ref23=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee15(imageData){var options,flipX,flipY,rotation,crop,imageSize,shouldFlip,shouldRotate,cropDefined,cropCoversImage,shouldCrop,imageDataOut,image,_ctx2,outputSize,_ctx3,_ctx4,ctx,_args10=arguments;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1)switch(_context15.prev=_context15.next){case 0:options=_args10.length>1&&_args10[1]!==undefined?_args10[1]:{};flipX=options.flipX,flipY=options.flipY,rotation=options.rotation,crop=options.crop;imageSize=sizeCreateFromAny(imageData);shouldFlip=flipX||flipY;shouldRotate=!!rotation;cropDefined=crop&&(crop.x||crop.y||crop.width||crop.height);cropCoversImage=cropDefined&&rectEqual(crop,rectCreateFromSize(imageSize));shouldCrop=cropDefined&&!cropCoversImage;// skip!
if(!(!shouldFlip&&!shouldRotate&&!shouldCrop)){_context15.next=10;break;}return _context15.abrupt("return",imageData);case 10:image=h('canvas',{width:imageData.width,height:imageData.height});image.getContext('2d',{willReadFrequently:true}).putImageData(imageData,0,0);// flip image data
if(shouldFlip){_ctx2=h('canvas',{width:image.width,height:image.height}).getContext('2d',{willReadFrequently:true});ctxScale(_ctx2,flipX?-1:1,flipY?-1:1);_ctx2.drawImage(image,flipX?-image.width:0,flipY?-image.height:0);_ctx2.restore();releaseCanvas(image);image=_ctx2.canvas;}// rotate image data
if(!shouldRotate){_context15.next=24;break;}// if shouldRotate is true we also receive a crop rect
outputSize=sizeApply(sizeCreateFromRect(rectCreateFromPoints(rectRotate(rectCreateFromAny(image),rotation))),Math.floor);_ctx3=h('canvas',{width:crop.width,height:crop.height}).getContext('2d',{willReadFrequently:true});ctxTranslate(_ctx3,-crop.x,-crop.y);ctxRotate(_ctx3,rotation,sizeCenter(outputSize));_ctx3.drawImage(image,(outputSize.width-image.width)*0.5,(outputSize.height-image.height)*0.5);_ctx3.restore();releaseCanvas(image);image=_ctx3.canvas;_context15.next=29;break;case 24:if(!shouldCrop){_context15.next=29;break;}_ctx4=image.getContext('2d',{willReadFrequently:true});imageDataOut=_ctx4.getImageData(crop.x,crop.y,crop.width,crop.height);releaseCanvas(image);return _context15.abrupt("return",imageDataOut);case 29:// done, return resulting image data
ctx=image.getContext('2d',{willReadFrequently:true});imageDataOut=ctx.getImageData(0,0,image.width,image.height);releaseCanvas(image);return _context15.abrupt("return",imageDataOut);case 33:case"end":return _context15.stop();}},_callee15);}));return function cropImageData(_x23){return _ref23.apply(this,arguments);};}();var resizeTransform=function resizeTransform(options,done){var imageData=options.imageData,width=options.width,height=options.height;var inputWidth=imageData.width;var inputHeight=imageData.height;var outputWidth=Math.round(width);var outputHeight=Math.round(height);var inputData=imageData.data;var outputData=new Uint8ClampedArray(outputWidth*outputHeight*4);var scaleX=inputWidth/outputWidth;var scaleY=inputHeight/outputHeight;var scaleXHalf=Math.ceil(scaleX*0.5);var scaleYHalf=Math.ceil(scaleY*0.5);for(var j=0;j<outputHeight;j++){for(var i=0;i<outputWidth;i++){var x2=(i+j*outputWidth)*4;var weight=0;var weights=0;var weightsAlpha=0;var _r2=0;var g=0;var b=0;var a=0;var centerY=(j+0.5)*scaleY;for(var yy=Math.floor(j*scaleY);yy<(j+1)*scaleY;yy++){var dy=Math.abs(centerY-(yy+0.5))/scaleYHalf;var centerX=(i+0.5)*scaleX;var w0=dy*dy;for(var xx=Math.floor(i*scaleX);xx<(i+1)*scaleX;xx++){var dx=Math.abs(centerX-(xx+0.5))/scaleXHalf;var w=Math.sqrt(w0+dx*dx);if(w<-1||w>1)continue;weight=2*w*w*w-3*w*w+1;if(weight<=0)continue;dx=4*(xx+yy*inputWidth);var ref=inputData[dx+3];a+=weight*ref;weightsAlpha+=weight;if(ref<255){weight=weight*ref/250;}_r2+=weight*inputData[dx];g+=weight*inputData[dx+1];b+=weight*inputData[dx+2];weights+=weight;}}outputData[x2]=_r2/weights;outputData[x2+1]=g/weights;outputData[x2+2]=b/weights;outputData[x2+3]=a/weightsAlpha;}}// @ts-ignore
done(null,{data:outputData,width:outputWidth,height:outputHeight});};var imageDataObjectToImageData=function imageDataObjectToImageData(obj){if(obj instanceof ImageData){return obj;}var imageData;try{imageData=new ImageData(obj.width,obj.height);}catch(err){// IE + Old EDGE (tested on 12)
var canvas=h('canvas');imageData=canvas.getContext('2d').createImageData(obj.width,obj.height);}imageData.data.set(obj.data);return imageData;};var resizeImageData=/*#__PURE__*/function(){var _ref24=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee16(imageData){var options,resizeImageData,width,height,fit,upscale,targetWidth,targetHeight,scalarWidth,scalarHeight,_scalar2,_args11=arguments;return _regeneratorRuntime().wrap(function _callee16$(_context16){while(1)switch(_context16.prev=_context16.next){case 0:options=_args11.length>1&&_args11[1]!==undefined?_args11[1]:{};resizeImageData=_args11.length>2?_args11[2]:undefined;width=options.width,height=options.height,fit=options.fit,upscale=options.upscale;// no need to rescale
if(!(!width&&!height)){_context16.next=5;break;}return _context16.abrupt("return",imageData);case 5:targetWidth=width;targetHeight=height;if(!width){targetWidth=height;}else if(!height){targetHeight=width;}if(!(fit!=='force')){_context16.next=17;break;}scalarWidth=targetWidth/imageData.width;scalarHeight=targetHeight/imageData.height;_scalar2=1;if(fit==='cover'){_scalar2=Math.max(scalarWidth,scalarHeight);}else if(fit==='contain'){_scalar2=Math.min(scalarWidth,scalarHeight);}// if image is too small, exit here with original image
if(!(_scalar2>1&&upscale===false)){_context16.next=15;break;}return _context16.abrupt("return",imageData);case 15:targetWidth=Math.round(imageData.width*_scalar2);targetHeight=Math.round(imageData.height*_scalar2);case 17:// make sure canvas has a size
targetWidth=Math.max(targetWidth,1);targetHeight=Math.max(targetHeight,1);// no need to resize?
if(!(imageData.width===targetWidth&&imageData.height===targetHeight)){_context16.next=21;break;}return _context16.abrupt("return",imageData);case 21:if(!resizeImageData){_context16.next=23;break;}return _context16.abrupt("return",resizeImageData(imageData,targetWidth,targetHeight));case 23:_context16.next=25;return thread(resizeTransform,[{imageData:imageData,width:targetWidth,height:targetHeight}],[imageData.data.buffer]);case 25:imageData=_context16.sent;return _context16.abrupt("return",imageDataObjectToImageData(imageData));case 27:case"end":return _context16.stop();}},_callee16);}));return function resizeImageData(_x24){return _ref24.apply(this,arguments);};}();var colorEffect=function colorEffect(options,done){var imageData=options.imageData,matrix=options.matrix;if(!matrix)return done(null,imageData);var outputData=new Uint8ClampedArray(imageData.width*imageData.height*4);var data=imageData.data;var l=data.length;var m11=matrix[0];var m12=matrix[1];var m13=matrix[2];var m14=matrix[3];var m15=matrix[4];var m21=matrix[5];var m22=matrix[6];var m23=matrix[7];var m24=matrix[8];var m25=matrix[9];var m31=matrix[10];var m32=matrix[11];var m33=matrix[12];var m34=matrix[13];var m35=matrix[14];var m41=matrix[15];var m42=matrix[16];var m43=matrix[17];var m44=matrix[18];var m45=matrix[19];var index=0;var r=0.0;var g=0.0;var b=0.0;var a=0.0;var mr=0.0;var mg=0.0;var mb=0.0;var ma=0.0;var or=0.0;var og=0.0;var ob=0.0;for(;index<l;index+=4){r=data[index]/255;g=data[index+1]/255;b=data[index+2]/255;a=data[index+3]/255;mr=r*m11+g*m12+b*m13+a*m14+m15;mg=r*m21+g*m22+b*m23+a*m24+m25;mb=r*m31+g*m32+b*m33+a*m34+m35;ma=r*m41+g*m42+b*m43+a*m44+m45;or=Math.max(0,mr*ma)+(1.0-ma);og=Math.max(0,mg*ma)+(1.0-ma);ob=Math.max(0,mb*ma)+(1.0-ma);outputData[index]=Math.max(0.0,Math.min(1.0,or))*255;outputData[index+1]=Math.max(0.0,Math.min(1.0,og))*255;outputData[index+2]=Math.max(0.0,Math.min(1.0,ob))*255;outputData[index+3]=a*255;}// @ts-ignore
done(null,{data:outputData,width:imageData.width,height:imageData.height});};var convolutionEffect=function convolutionEffect(options,done){var imageData=options.imageData,matrix=options.matrix;if(!matrix)return done(null,imageData);// calculate kernel weight
var kernelWeight=matrix.reduce(function(prev,curr){return prev+curr;});kernelWeight=kernelWeight<=0?1:kernelWeight;// input info
var inputWidth=imageData.width;var inputHeight=imageData.height;var inputData=imageData.data;var i=0;var x=0;var y=0;var side=Math.round(Math.sqrt(matrix.length));var sideHalf=Math.floor(side/2);var r=0,g=0,b=0,a=0,cx=0,cy=0,scy=0,scx=0,srcOff=0,weight=0;var outputData=new Uint8ClampedArray(inputWidth*inputHeight*4);for(y=0;y<inputHeight;y++){for(x=0;x<inputWidth;x++){// calculate the weighed sum of the source image pixels that
// fall under the convolution matrix
r=0;g=0;b=0;a=0;for(cy=0;cy<side;cy++){for(cx=0;cx<side;cx++){scy=y+cy-sideHalf;scx=x+cx-sideHalf;if(scy<0){scy=inputHeight-1;}if(scy>=inputHeight){scy=0;}if(scx<0){scx=inputWidth-1;}if(scx>=inputWidth){scx=0;}srcOff=(scy*inputWidth+scx)*4;weight=matrix[cy*side+cx];r+=inputData[srcOff]*weight;g+=inputData[srcOff+1]*weight;b+=inputData[srcOff+2]*weight;a+=inputData[srcOff+3]*weight;}}outputData[i]=r/kernelWeight;outputData[i+1]=g/kernelWeight;outputData[i+2]=b/kernelWeight;outputData[i+3]=a/kernelWeight;i+=4;}}// @ts-ignore
done(null,{data:outputData,width:inputWidth,height:inputHeight});};var vignetteEffect=function vignetteEffect(options,done){var imageData=options.imageData,strength=options.strength;if(!strength)return done(null,imageData);var outputData=new Uint8ClampedArray(imageData.width*imageData.height*4);var inputWidth=imageData.width;var inputHeight=imageData.height;var inputData=imageData.data;var dist=function dist(x,y){dx=x-cx;dy=y-cy;return Math.sqrt(dx*dx+dy*dy);};var x=0;var y=0;var cx=inputWidth*0.5;var cy=inputHeight*0.5;var dx;var dy;var dm=dist(0,0);var fr,fg,fb;var br,bg,bb,ba;var fa;var ca;var blend=function blend(index,input,output,alpha){br=input[index]/255;bg=input[index+1]/255;bb=input[index+2]/255;ba=input[index+3]/255;fa=1.0-alpha;ca=fa*ba+alpha;output[index]=(fa*ba*br+alpha*fr)/ca*255;output[index+1]=(fa*ba*bg+alpha*fg)/ca*255;output[index+2]=(fa*ba*bb+alpha*fb)/ca*255;output[index+3]=ca*255;};if(strength>0){fr=0;fg=0;fb=0;}else{strength=Math.abs(strength);fr=1;fg=1;fb=1;}for(y=0;y<inputHeight;y++){for(x=0;x<inputWidth;x++){blend(// index
(x+y*inputWidth)*4,// data in
inputData,// data out
outputData,// opacity
dist(x,y)*strength/dm);}}// @ts-ignore
done(null,{data:outputData,width:imageData.width,height:imageData.height});};var noiseEffect=function noiseEffect(options,done){var imageData=options.imageData,level=options.level,_options$monochrome=options.monochrome,monochrome=_options$monochrome===void 0?false:_options$monochrome;if(!level)return done(null,imageData);var outputData=new Uint8ClampedArray(imageData.width*imageData.height*4);var data=imageData.data;var l=data.length;var index=0;var r;var g;var b;var rand=function rand(){return(-1+Math.random()*2)*255*level;};var pixel=monochrome?function(){var average=rand();return[average,average,average];}:function(){return[rand(),rand(),rand()];};for(;index<l;index+=4){var _pixel=pixel();var _pixel2=_slicedToArray(_pixel,3);r=_pixel2[0];g=_pixel2[1];b=_pixel2[2];outputData[index]=data[index]+r;outputData[index+1]=data[index+1]+g;outputData[index+2]=data[index+2]+b;outputData[index+3]=data[index+3];}// @ts-ignore
done(null,{data:outputData,width:imageData.width,height:imageData.height});};var gammaEffect=function gammaEffect(options,done){var imageData=options.imageData,level=options.level;if(!level)return done(null,imageData);var outputData=new Uint8ClampedArray(imageData.width*imageData.height*4);var data=imageData.data;var l=data.length;var index=0;var r;var g;var b;for(;index<l;index+=4){r=data[index]/255;g=data[index+1]/255;b=data[index+2]/255;outputData[index]=Math.pow(r,level)*255;outputData[index+1]=Math.pow(g,level)*255;outputData[index+2]=Math.pow(b,level)*255;outputData[index+3]=data[index+3];}// @ts-ignore
done(null,{data:outputData,width:imageData.width,height:imageData.height});};var isIdentityMatrix=function isIdentityMatrix(matrix){/*
    [
        1, 0, 0, 0, 0
        0, 1, 0, 0, 0
        0, 0, 1, 0, 0
        0, 0, 0, 1, 0
    ]
    */var l=matrix.length;var v;var s=l>=20?6:l>=16?5:3;for(var i=0;i<l;i++){v=matrix[i];if(v===1&&i%s!==0)return false;else if(v!==0&&v!==1)return false;}return true;};var filterImageData=/*#__PURE__*/function(){var _ref25=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee17(imageData){var options,colorMatrix,convolutionMatrix,gammaLevel,noiseLevel,vignetteStrength,filters,chain,filterChain,_args12=arguments;return _regeneratorRuntime().wrap(function _callee17$(_context17){while(1)switch(_context17.prev=_context17.next){case 0:options=_args12.length>1&&_args12[1]!==undefined?_args12[1]:{};colorMatrix=options.colorMatrix,convolutionMatrix=options.convolutionMatrix,gammaLevel=options.gamma,noiseLevel=options.noise,vignetteStrength=options.vignette;// filters
filters=[];// apply convolution matrix
if(convolutionMatrix){filters.push([convolutionEffect,{matrix:convolutionMatrix.clarity}]);}// apply noise
if(gammaLevel>0){filters.push([gammaEffect,{level:1.0/gammaLevel}]);}// apply color matrix
if(colorMatrix&&!isIdentityMatrix(colorMatrix)){filters.push([colorEffect,{matrix:colorMatrix}]);}// apply noise
if(noiseLevel>0||noiseLevel<0){filters.push([noiseEffect,{level:noiseLevel}]);}// apply vignette
if(vignetteStrength>0||vignetteStrength<0){filters.push([vignetteEffect,{strength:vignetteStrength}]);}// no changes
if(filters.length){_context17.next=10;break;}return _context17.abrupt("return",imageData);case 10:// builds effect chain
chain=function chain(transforms,i){return"(err, imageData) => {\n            (".concat(transforms[i][0].toString(),")(Object.assign({ imageData: imageData }, filterInstructions[").concat(i,"]), \n                ").concat(transforms[i+1]?chain(transforms,i+1):'done',")\n        }");};filterChain="function (options, done) {\n        const filterInstructions = options.filterInstructions;\n        const imageData = options.imageData;\n        (".concat(chain(filters,0),")(null, imageData)\n    }");_context17.next=14;return thread(filterChain,[{imageData:imageData,filterInstructions:filters.map(function(t){return t[1];})}],[imageData.data.buffer]);case 14:imageData=_context17.sent;return _context17.abrupt("return",imageDataObjectToImageData(imageData));case 16:case"end":return _context17.stop();}},_callee17);}));return function filterImageData(_x25){return _ref25.apply(this,arguments);};}();var isNumber=function isNumber(v){return typeof v==='number';};var isEmoji=function isEmoji(str){return isString(str)&&str.match(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g)!==null;};var hasProp=function hasProp(obj,key){return obj.hasOwnProperty(key);};var isArray=function isArray(arr){return Array.isArray(arr);};var isApple=function isApple(){return isIOS()||isMac();};var isWindows=function isWindows(){return /^win/i.test(navigator.platform);};// macos:   font-size: 123, x: 63.5, y: 110
// windows: font-size: 112, x: 64, y: 103
// android: font-size: 112, x: 64, y: 102
var x=64;var y=102;var fontSize=112;var hasSetValues=false;var getEmojiSVG=function getEmojiSVG(emoji,alt){if(!hasSetValues&&isBrowser()){if(isWindows())y=103;if(isApple()){x=63.5;y=110;fontSize=123;}hasSetValues=true;}return"<svg".concat(alt?" aria-label=\"".concat(alt,"\""):''," width=\"128\" height=\"128\" viewBox=\"0 0 128 128\" preserveAspectRatio=\"xMinYMin meet\" xmlns=\"http://www.w3.org/2000/svg\"><text x=\"").concat(x,"\" y=\"").concat(y,"\" alignment-baseline=\"text-top\" dominant-baseline=\"text-top\" text-anchor=\"middle\" font-size=\"").concat(fontSize,"px\">").concat(emoji,"</text></svg>");};var SVGToDataURL=function SVGToDataURL(svg){return"data:image/svg+xml,".concat(svg.replace('<','%3C').replace('>','%3E'));};var isBinary=function isBinary(v){return v instanceof Blob;};var toPercentage=function toPercentage(value,total){return"".concat(value/total*100,"%");};var colorArrayToRGBA=function colorArrayToRGBA(color){return"rgba(".concat(Math.round(color[0]*255),", ").concat(Math.round(color[1]*255),", ").concat(Math.round(color[2]*255),", ").concat(isNumber(color[3])?color[3]:1,")");};// tested and this seems a tiny bit faster than JSON.stringify
var objectUID=function objectUID(obj){return Object.values(obj).join('_');};var timeout=function timeout(){var timeout=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return new Promise(function(resolve){setTimeout(resolve,timeout);});};// cannot use a ObjectURL because of a webkit bug (throws error in chrome / safari)
// returns true if every pixel's uint32 representation is 0 (or "blank")
var isContextBlank=function isContextBlank(ctx){var buffer=new Uint32Array(ctx.getImageData(0,0,ctx.canvas.width,ctx.canvas.height).data.buffer);return!buffer.some(function(color){return color!==0;});};var width=80;var height=80;var whenSVGSafeForDrawing=/*#__PURE__*/function(){var _ref26=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee18(img){var delay,canvas,ctx,_args13=arguments;return _regeneratorRuntime().wrap(function _callee18$(_context18){while(1)switch(_context18.prev=_context18.next){case 0:delay=_args13.length>1&&_args13[1]!==undefined?_args13[1]:0;// Safari has some trouble with custom fonts
canvas=h('canvas',{width:width,height:height});ctx=canvas.getContext('2d');// always wait a short while because it's never ready on first draw
_context18.next=5;return timeout(delay);case 5:// we draw the image so we can test if the content is drawn. If custom font isn't ready the canvas will be empty
ctx.drawImage(img,0,0,width,height);if(!(isContextBlank(ctx)&&delay<=256)){_context18.next=10;break;}_context18.next=9;return whenSVGSafeForDrawing(img,delay+16);case 9:return _context18.abrupt("return",_context18.sent);case 10:return _context18.abrupt("return",true);case 11:case"end":return _context18.stop();}},_callee18);}));return function whenSVGSafeForDrawing(_x26){return _ref26.apply(this,arguments);};}();// store cached draw cycles here
var safariDrawCache=new Map();var svgToImage=function svgToImage(svg){var _ref27=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref27$safariCacheKey=_ref27.safariCacheKey,safariCacheKey=_ref27$safariCacheKey===void 0?'*':_ref27$safariCacheKey;return new Promise(function(resolve,reject){var img=new Image();img.onerror=reject;img.onload=function(){// We done!
if(!isSafari()||!svg.includes('@font-face')||safariDrawCache.has(safariCacheKey))return resolve(img);// wait for embedded fonts to load
whenSVGSafeForDrawing(img).then(function(){safariDrawCache.set(safariCacheKey,true);resolve(img);});};img.src='data:image/svg+xml,'+svg;});};var blobToDataURL=function blobToDataURL(blob){return new Promise(function(resolve,reject){var reader=new FileReader();reader.onerror=reject;reader.onload=function(){return resolve(reader.result);};reader.readAsDataURL(blob);});};var pubsub=function pubsub(){var subs=[];return{sub:function sub(event,callback){subs.push({event:event,callback:callback});return function(){return subs=subs.filter(function(subscriber){return subscriber.event!==event||subscriber.callback!==callback;});};},pub:function pub(event,value){subs.filter(function(sub){return sub.event===event;}).forEach(function(sub){return sub.callback(value);});}};};var escapeTags=function escapeTags(str){return str.replace(/</g,'&lt;').replace(/>/g,'&gt;');};// used to make sure text is drawn outside of element in a correct way
var TextPadding=32;var textGetInitialLineOffset=function textGetInitialLineOffset(){var _ref28=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref28$fontSize=_ref28.fontSize,fontSize=_ref28$fontSize===void 0?16:_ref28$fontSize,_ref28$lineHeight=_ref28.lineHeight,lineHeight=_ref28$lineHeight===void 0?20:_ref28$lineHeight;return Math.max(0,fontSize-lineHeight)*0.5;};var textGetLineCount=function textGetLineCount(){var text=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';return text.split('\n').length;};var textGetStyles=function textGetStyles(_ref29){var _ref29$color=_ref29.color,color=_ref29$color===void 0?[0,0,0]:_ref29$color,_ref29$fontSize=_ref29.fontSize,fontSize=_ref29$fontSize===void 0?16:_ref29$fontSize,_ref29$fontFamily=_ref29.fontFamily,fontFamily=_ref29$fontFamily===void 0?'sans-serif':_ref29$fontFamily,_ref29$fontVariant=_ref29.fontVariant,fontVariant=_ref29$fontVariant===void 0?'normal':_ref29$fontVariant,_ref29$fontWeight=_ref29.fontWeight,fontWeight=_ref29$fontWeight===void 0?'normal':_ref29$fontWeight,_ref29$fontStyle=_ref29.fontStyle,fontStyle=_ref29$fontStyle===void 0?'normal':_ref29$fontStyle,_ref29$textAlign=_ref29.textAlign,textAlign=_ref29$textAlign===void 0?'left':_ref29$textAlign,_ref29$lineHeight=_ref29.lineHeight,lineHeight=_ref29$lineHeight===void 0?20:_ref29$lineHeight;return"font-size:".concat(fontSize,"px;font-style:").concat(fontStyle,";font-weight:").concat(fontWeight,";font-family:").concat(fontFamily,";font-variant:").concat(fontVariant,";line-height:").concat(lineHeight,"px;text-align:").concat(textAlign,";color:").concat(colorArrayToRGBA(color),";");};var textGetContentEditableStyles=function textGetContentEditableStyles(text,options){var width=options.width,height=options.height,disableNewline=options.disableNewline;var isAutoWidth=!width;var allowNewline=disableNewline===false?textGetLineCount(text):undefined;var widthValue=isAutoWidth?'auto':"".concat(width,"px");var heightValue=height?"".concat(height,"px"):'auto';var wordBreak=isAutoWidth?'normal':'break-word';var whiteSpace=isAutoWidth&&!allowNewline?'nowrap':'pre-line';var paddingTop=textGetInitialLineOffset(options);return"max-width:none;min-width:auto;width:".concat(widthValue,";height:").concat(heightValue,";margin-top:0;margin-bottom:0;padding-top:").concat(paddingTop,"px;word-break:").concat(wordBreak,";word-wrap:normal;white-space:").concat(whiteSpace,";overflow:visible;");};var TextMeasureCache=new Map();var textMeasure=function textMeasure(){var text=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var options=arguments.length>1?arguments[1]:undefined;// gather props that impact size and test if can be found in cache
var _options$width=options.width,width=_options$width===void 0?0:_options$width,_options$height=options.height,height=_options$height===void 0?'auto':_options$height,fontSize=options.fontSize,fontFamily=options.fontFamily,lineHeight=options.lineHeight,fontWeight=options.fontWeight,fontStyle=options.fontStyle,fontVariant=options.fontVariant;var uid=objectUID({text:text,fontFamily:fontFamily,fontWeight:fontWeight,fontStyle:fontStyle,fontVariant:fontVariant,fontSize:fontSize,lineHeight:lineHeight,width:width,height:height});var measurement=TextMeasureCache.get(uid);if(measurement)return measurement;// this is appended to the end of the text and helps us determine if text wrapped
var endMarker=h('span');var element=appendForMeasuring(h('pre',{contenteditable:'true',spellcheck:'false',style:"pointer-events:none;visibility:hidden;position:absolute;left:0;top:0;".concat(textGetStyles({fontFamily:fontFamily,fontWeight:fontWeight,fontStyle:fontStyle,fontVariant:fontVariant,fontSize:fontSize,lineHeight:lineHeight}),";").concat(textGetContentEditableStyles(text,options),"\""),innerHTML:text},[endMarker]));//
// insert a character at the end and ask bounding client rect, should change position if wrapping changes
//
var elementRect=element.getBoundingClientRect();var endMarkerRect=endMarker.getBoundingClientRect();measurement={textSize:sizeApply(sizeCreateFromAny(elementRect),Math.ceil),lastCharPosition:vectorApply(vectorCreateFromAny(endMarkerRect),Math.round)};TextMeasureCache.set(uid,measurement);// clean up measured elements
element.remove();return measurement;};var TextSizeCache=new Map();var textToSize=function textToSize(){var text=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var options=arguments.length>1?arguments[1]:undefined;var _options$width2=options.width,width=_options$width2===void 0?0:_options$width2,_options$height2=options.height,height=_options$height2===void 0?0:_options$height2;if(width&&height)return sizeCreate(width,height);// gather props that impact size and test if can be found in cache
var _options$fontSize=options.fontSize,fontSize=_options$fontSize===void 0?16:_options$fontSize,fontFamily=options.fontFamily,_options$lineHeight=options.lineHeight,lineHeight=_options$lineHeight===void 0?20:_options$lineHeight,fontWeight=options.fontWeight,fontStyle=options.fontStyle,fontVariant=options.fontVariant;var uid=objectUID({text:text,fontFamily:fontFamily,fontWeight:fontWeight,fontStyle:fontStyle,fontVariant:fontVariant,fontSize:fontSize,lineHeight:lineHeight,width:width});var size=TextSizeCache.get(uid);if(size)return size;// fix height calc on Safari
if(isSafari()&&text.endsWith('\n')&&!text.endsWith('\n\n'))text+='\n';// new measurement needed
var element=appendForMeasuring(h('pre',{contenteditable:'true',spellcheck:'false',style:"pointer-events:none;visibility:hidden;position:absolute;".concat(textGetStyles(options),";").concat(textGetContentEditableStyles(text,options),"\""),innerHTML:text},[h('span')]));var rect=element.getBoundingClientRect();// cache measurement for next query
size=sizeCreateFromAny(rect);// add additional height to prevent cutting off footer
size.height+=Math.max(0,fontSize-lineHeight);TextSizeCache.set(uid,size);return size;};var getPathFromURL=function getPathFromURL(url){return url.pathname.split('/').slice(0,-1).join('/');};var createStyleSheetLoader=function createStyleSheetLoader(url,willRequest){var _pubsub=pubsub(),_sub=_pubsub.sub,pub=_pubsub.pub;var text;var error;Promise.resolve(willRequest&&willRequest(url,{resourceType:'stylesheet'})).then(function(requestInit){// prevent load
if(requestInit===false){error='requestPrevented';return pub('error',error);}// get props
var _ref30=requestInit||{},headers=_ref30.headers,credentials=_ref30.credentials;// fetching
fetch(url,{headers:headers,credentials:credentials}).then(function(res){return res.text();}).then(function(txt){text=txt;pub('load',text);})["catch"](function(err){error=err;pub('error',error);});});return{sub:function sub(event,cb){if(event==='load'&&text)return cb(text);if(event==='error'&&error)return cb(error);_sub(event,cb);}};};var StyleSheetLoaders=new Map();var loadStylesheet=function loadStylesheet(url,willRequest){return new Promise(function(resolve,reject){var loader=StyleSheetLoaders.get(url);if(typeof loader==='undefined'){loader=createStyleSheetLoader(url,willRequest);StyleSheetLoaders.set(url,loader);}loader.sub('load',resolve);loader.sub('error',reject);});};// use this method to access rules because when accessing third party stylesheetes like google fonts it will throw a warning
var getRulesRemote=/*#__PURE__*/function(){var _ref31=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee19(src,willRequest){var styleSheetContent,style,tempStyleSheet;return _regeneratorRuntime().wrap(function _callee19$(_context19){while(1)switch(_context19.prev=_context19.next){case 0:_context19.prev=0;_context19.next=3;return loadStylesheet(src,willRequest);case 3:styleSheetContent=_context19.sent;_context19.next=9;break;case 6:_context19.prev=6;_context19.t0=_context19["catch"](0);return _context19.abrupt("return",[]);case 9:style=h('style',{innerHTML:styleSheetContent,id:getUniqueId()});document.head.append(style);tempStyleSheet=Array.from(document.styleSheets).find(function(styleSheet){var node=styleSheet.ownerNode;return node.id===style.id;});style.remove();return _context19.abrupt("return",Array.from(tempStyleSheet.cssRules));case 14:case"end":return _context19.stop();}},_callee19,null,[[0,6]]);}));return function getRulesRemote(_x27,_x28){return _ref31.apply(this,arguments);};}();var RemoteStyleSheetRulesCache=new Map();var filterFontFaceRules=function filterFontFaceRules(rules){return rules.filter(function(rule){return rule instanceof CSSFontFaceRule;});};var filterImportRules=function filterImportRules(rules){return rules.filter(function(rule){return rule instanceof CSSImportRule;});};var getFontFaceRulesSafe=/*#__PURE__*/function(){var _ref32=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee20(styleSheet,willRequest){var rules,_iterator,_step,importRule,url,_remoteRules,remoteRules,_url;return _regeneratorRuntime().wrap(function _callee20$(_context20){while(1)switch(_context20.prev=_context20.next){case 0:if(!RemoteStyleSheetRulesCache.has(styleSheet.href)){_context20.next=2;break;}return _context20.abrupt("return",RemoteStyleSheetRulesCache.get(styleSheet.href));case 2:_context20.prev=2;// get all rules
rules=Array.from(styleSheet.cssRules);// get @imports
_iterator=_createForOfIteratorHelper(filterImportRules(rules));_context20.prev=5;_iterator.s();case 7:if((_step=_iterator.n()).done){_context20.next=21;break;}importRule=_step.value;url=importRule.href;// already loaded this one before
if(!RemoteStyleSheetRulesCache.has(url)){_context20.next=14;break;}_remoteRules=RemoteStyleSheetRulesCache.get(url);rules=[].concat(_toConsumableArray(rules),_toConsumableArray(_remoteRules));return _context20.abrupt("continue",19);case 14:_context20.next=16;return getRulesRemote(url,willRequest);case 16:remoteRules=_context20.sent;// remember returned rules for next run
RemoteStyleSheetRulesCache.set(url,remoteRules);// add found rules
rules=[].concat(_toConsumableArray(rules),_toConsumableArray(remoteRules));case 19:_context20.next=7;break;case 21:_context20.next=26;break;case 23:_context20.prev=23;_context20.t0=_context20["catch"](5);_iterator.e(_context20.t0);case 26:_context20.prev=26;_iterator.f();return _context20.finish(26);case 29:_context20.next=38;break;case 31:_context20.prev=31;_context20.t1=_context20["catch"](2);_url=styleSheet.href;// this tries to load the styles with `fetch`
_context20.next=36;return getRulesRemote(_url,willRequest);case 36:rules=_context20.sent;// remember returned rules for next run
RemoteStyleSheetRulesCache.set(_url,rules);case 38:return _context20.abrupt("return",filterFontFaceRules(rules));case 39:case"end":return _context20.stop();}},_callee20,null,[[2,31],[5,23,26,29]]);}));return function getFontFaceRulesSafe(_x29,_x30){return _ref32.apply(this,arguments);};}();var getCSSPropertyValue=function getCSSPropertyValue(rule,name){return rule.style.getPropertyValue(name);};var isMatchingFontRule=function isMatchingFontRule(rule,fontFamily){if(!rule.style)return false;var family=getCSSPropertyValue(rule,'font-family').replace(/^"|"$/g,'');return family==fontFamily;};var getMatchingFontRule=function getMatchingFontRule(rules,fontFamily){var res=[];var _iterator2=_createForOfIteratorHelper(rules),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var fontRule=_step2.value;var isMatch=isMatchingFontRule(fontRule,fontFamily);if(!isMatch)continue;res.push(fontRule);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return res;};var getDocumentStylesheetFontFaceRules=/*#__PURE__*/function(){var _ref33=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee21(willRequest){var styleSheets,ruleSets,rules;return _regeneratorRuntime().wrap(function _callee21$(_context21){while(1)switch(_context21.prev=_context21.next){case 0:styleSheets=Array.from(document.styleSheets).map(function(styleSheet){return getFontFaceRulesSafe(styleSheet,willRequest);});_context21.next=3;return Promise.all(styleSheets);case 3:ruleSets=_context21.sent;rules=[];ruleSets.forEach(function(ruleSet){return rules.push.apply(rules,_toConsumableArray(ruleSet));});return _context21.abrupt("return",rules);case 7:case"end":return _context21.stop();}},_callee21);}));return function getDocumentStylesheetFontFaceRules(_x31){return _ref33.apply(this,arguments);};}();var getFontSources=/*#__PURE__*/function(){var _ref34=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee22(fontFamily,willRequest){var fontFaceRules,matchingRules;return _regeneratorRuntime().wrap(function _callee22$(_context22){while(1)switch(_context22.prev=_context22.next){case 0:_context22.next=2;return getDocumentStylesheetFontFaceRules(willRequest);case 2:fontFaceRules=_context22.sent;// rules matching this font
matchingRules=getMatchingFontRule(fontFaceRules,fontFamily);if(matchingRules.length){_context22.next=6;break;}return _context22.abrupt("return",[]);case 6:return _context22.abrupt("return",matchingRules.map(function(rule){// create stylesheet root path so we can determine font path
var url=rule.parentStyleSheet.href&&new URL(rule.parentStyleSheet.href);var styleSheetPath=url?url.origin+getPathFromURL(url)+'/':'';// create font source
var fontSources=rule.style.getPropertyValue('src');var fontSrcFirst=fontSources.match(/url\("?(.*?)"?\)/)[1];// get styles
var fontProps=Array.from(rule.style).filter(function(prop){return prop!='src';}).reduce(function(props,key){props+=key+':'+getCSSPropertyValue(rule,key)+';';return props;},'');// merge together to create path (Safari font URL is absolute so if it is we only use that url)
return[/^http/.test(fontSrcFirst)?fontSrcFirst:styleSheetPath+fontSrcFirst,fontProps];}));case 7:case"end":return _context22.stop();}},_callee22);}));return function getFontSources(_x32,_x33){return _ref34.apply(this,arguments);};}();var FontLocal=new Map();var FontCache=new Map();// application/x-font-ttf
// application/x-font-truetype
// application/x-font-opentype
// application/font-woff
// application/font-woff2
// font/otf
// font/ttf
// font/woff
// font/woff2
var getFontFormatByMimeType=function getFontFormatByMimeType(type){if(!type||/woff2/.test(type))return'woff2';if(/woff/.test(type))return'woff';if(/ttf|truetype/.test(type))return'truetype';if(/otf|opentype/.test(type))return'opentype';if(/svg/.test(type))return'svg';return'woff2';};var getFontFaceEmbed=/*#__PURE__*/function(){var _ref35=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee23(fontFamily,willRequest){var fontStyles,fontSources,fontFaces,_iterator3,_step3,_step3$value,fontSource,fontProps,blob,dataType,dataURL;return _regeneratorRuntime().wrap(function _callee23$(_context23){while(1)switch(_context23.prev=_context23.next){case 0:if(!FontLocal.get(fontFamily)){_context23.next=2;break;}return _context23.abrupt("return");case 2:fontStyles=FontCache.get(fontFamily);if(fontStyles){_context23.next=36;break;}_context23.next=6;return getFontSources(fontFamily,willRequest);case 6:fontSources=_context23.sent;if(fontSources.length){_context23.next=10;break;}FontLocal.set(fontFamily,true);return _context23.abrupt("return");case 10:fontFaces=[];_iterator3=_createForOfIteratorHelper(fontSources);_context23.prev=12;_iterator3.s();case 14:if((_step3=_iterator3.n()).done){_context23.next=26;break;}_step3$value=_slicedToArray(_step3.value,2),fontSource=_step3$value[0],fontProps=_step3$value[1];_context23.next=18;return fetch(fontSource).then(function(res){return res.blob();});case 18:blob=_context23.sent;dataType=getFontFormatByMimeType(blob.type);_context23.next=22;return blobToDataURL(blob);case 22:dataURL=_context23.sent;fontFaces.push("@font-face { src:url(".concat(dataURL,") format('").concat(dataType,"');").concat(fontProps,";font-display:block; }"));case 24:_context23.next=14;break;case 26:_context23.next=31;break;case 28:_context23.prev=28;_context23.t0=_context23["catch"](12);_iterator3.e(_context23.t0);case 31:_context23.prev=31;_iterator3.f();return _context23.finish(31);case 34:fontStyles=fontFaces.join('');// cache the font so it's super fast in next request
FontCache.set(fontFamily,fontStyles);case 36:return _context23.abrupt("return",fontStyles);case 37:case"end":return _context23.stop();}},_callee23,null,[[12,28,31,34]]);}));return function getFontFaceEmbed(_x34,_x35){return _ref35.apply(this,arguments);};}();var textToImage=/*#__PURE__*/function(){var _ref36=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee24(){var text,options,_options$imageWidth,imageWidth,_options$imageHeight,imageHeight,_options$paddingLeft,paddingLeft,_options$paddingRight,paddingRight,fontFamily,_options$pixelRatio,pixelRatio,willRequest,width,height,textStyles,textContentEditableStyles,fontEmbed,textEncoded,textEscaped,textFinal,svg,_args19=arguments;return _regeneratorRuntime().wrap(function _callee24$(_context24){while(1)switch(_context24.prev=_context24.next){case 0:text=_args19.length>0&&_args19[0]!==undefined?_args19[0]:'';options=_args19.length>1?_args19[1]:undefined;if(text.length){_context24.next=4;break;}return _context24.abrupt("return");case 4:_options$imageWidth=options.imageWidth,imageWidth=_options$imageWidth===void 0?300:_options$imageWidth,_options$imageHeight=options.imageHeight,imageHeight=_options$imageHeight===void 0?150:_options$imageHeight,_options$paddingLeft=options.paddingLeft,paddingLeft=_options$paddingLeft===void 0?TextPadding:_options$paddingLeft,_options$paddingRight=options.paddingRight,paddingRight=_options$paddingRight===void 0?TextPadding:_options$paddingRight,fontFamily=options.fontFamily,_options$pixelRatio=options.pixelRatio,pixelRatio=_options$pixelRatio===void 0?1:_options$pixelRatio,willRequest=options.willRequest;width=(imageWidth+paddingLeft+paddingRight)*pixelRatio;height=imageHeight*pixelRatio;textStyles=textGetStyles(options);textContentEditableStyles=textGetContentEditableStyles(text,options);_context24.next=11;return getFontFaceEmbed(fontFamily,willRequest);case 11:fontEmbed=_context24.sent;// make sure text is encoded as characters before rendering in our SVG
textEncoded=text// these characters need to be encoded in an SVG dataURL
.replace(/&/g,'&amp;').replace(/%/g,'%25').replace(/#/g,'%23')// no non-closing tags allowed in foreignObject as is xhtml namespace
.replace(/<br>/g,'___BR___')// safari and firefox don't draw newline character so replace with <br/>
.replace(/\n/g,'___BR___');textEscaped=escapeTags(textEncoded);textFinal=textEscaped.replace(/___BR___/g,'<br/>');svg="<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"".concat(width,"\" height=\"").concat(height,"\" viewBox=\"0 0 ").concat(width," ").concat(height,"\"><foreignObject x=\"0\" y=\"0\" width=\"").concat(width,"\" height=\"").concat(height,"\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"transform-origin:0 0;transform:scale(").concat(pixelRatio,")\">").concat(fontEmbed?"<style>".concat(fontEmbed,"</style>"):'',"<pre contenteditable=\"true\" spellcheck=\"false\" style=\"position:absolute;padding-right:").concat(paddingRight,"px;padding-left:").concat(paddingLeft,"px;").concat(textStyles,";").concat(textContentEditableStyles,"\">").concat(textFinal,"</pre></div></foreignObject></svg>");// if (document.getElementById('test')) document.getElementById('test').remove();
// document.body.append(h('div', { id: 'test', innerHTML: svg }));
return _context24.abrupt("return",svgToImage(svg,{safariCacheKey:fontFamily}));case 17:case"end":return _context24.stop();}},_callee24);}));return function textToImage(){return _ref36.apply(this,arguments);};}();var shapeEqual=function shapeEqual(a,b){return JSON.stringify(a)===JSON.stringify(b);};var shapeDeepCopy=function shapeDeepCopy(shape){var shapeShallowCopy=_objectSpread({},shape);var shapeDeepCopy=deepCopy(shapeShallowCopy);return shapeDeepCopy;};var getContextSize=function getContextSize(context){var _ref37;var size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var contextAspectRatio=rectAspectRatio(context);var xOut;var yOut;var xIn=size.width||size.rx;var yIn=size.height||size.ry;if(xIn&&yIn)return sizeClone(size);if(xIn||yIn){xOut=parseFloat(xIn||Number.MAX_SAFE_INTEGER);yOut=parseFloat(yIn||Number.MAX_SAFE_INTEGER);var min=Math.min(xOut,yOut);if(isString(xIn)||isString(yIn)){xOut="".concat(min,"%");yOut="".concat(min*contextAspectRatio,"%");}else{xOut=min;yOut=min;}}else{var _min=10;xOut="".concat(_min,"%");yOut="".concat(_min*contextAspectRatio,"%");}var xProp=size.width?'width':size.rx?'rx':undefined;var yProp=size.width?'height':size.rx?'ry':undefined;return _ref37={},_defineProperty(_ref37,xProp||'width',xOut),_defineProperty(_ref37,yProp||'height',yOut),_ref37;};var shapeCreateFromEmoji=function shapeCreateFromEmoji(emoji){var props=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return _objectSpread(_objectSpread({width:undefined,height:undefined},props),{},{aspectRatio:1,backgroundImage:SVGToDataURL(getEmojiSVG(emoji))});};var shapeCreateFromImage=function shapeCreateFromImage(src){var shapeProps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var shapeDefaultLayout=shapeIsEllipse(shapeProps)?{}:{width:undefined,height:undefined,aspectRatio:undefined};var shape=_objectSpread(_objectSpread(_objectSpread({// required/default image shape props
backgroundColor:[0,0,0,0]},shapeDefaultLayout),shapeProps),{},{// set image
backgroundImage:// is svg or URL
isString(src)?src:isBinary(src)?URL.createObjectURL(src):src});return shape;};var shapeCreateFromPreset=function shapeCreateFromPreset(preset,parentRect){var shape;if(isString(preset)||isBinary(preset)){// default props for "quick" preset
var shapeOptions=_objectSpread(_objectSpread({},getContextSize(parentRect)),{},{backgroundSize:'contain'});// if is emoji, create default markup,
if(isEmoji(preset)){shape=shapeCreateFromEmoji(preset,shapeOptions);}// is URL, create default markup for image
else{shape=shapeCreateFromImage(preset,shapeOptions);}}else{// is using src shortcut
if(preset.src){var contextSize=getContextSize(parentRect,preset.shape||preset);// shape options
var _shapeOptions=_objectSpread(_objectSpread({},preset.shape),contextSize);// should auto-fix aspect ratio
if(preset.width&&preset.height&&!hasProp(_shapeOptions,'aspectRatio')){var _width=shapeGetPropPixelValue(contextSize,'width',parentRect);var _height=shapeGetPropPixelValue(contextSize,'height',parentRect);_shapeOptions.aspectRatio=getAspectRatio(_width,_height);}// should auto-contain sticker in container
if(!_shapeOptions.backgroundSize&&!preset.shape&&(!preset.width||!preset.height))_shapeOptions.backgroundSize='contain';// emoji markup
if(isEmoji(preset.src)){shape=shapeCreateFromEmoji(preset.src,_shapeOptions);}// is url
else{shape=shapeCreateFromImage(preset.src,_shapeOptions);}}// should have markup defined
else if(preset.shape){shape=shapeDeepCopy(preset.shape);}}if(hasProp(shape,'backgroundImage')){// set transparent background if no background color defined
if(!hasProp(shape,'backgroundColor')){shape.backgroundColor=[0,0,0,0];}// for rectangles with image presets, disable these styles by default
if(!hasProp(shape,'disableStyle')){shape.disableStyle=['cornerRadius','backgroundColor','strokeColor','strokeWidth'];}}return parentRect?shapeComputeDisplay(shape,parentRect):shape;};var shapeLineGetStartPoint=function shapeLineGetStartPoint(line){return vectorCreate(line.x1,line.y1);};var shapeLineGetEndPoint=function shapeLineGetEndPoint(line){return vectorCreate(line.x2,line.y2);};//#endregion
//#region shape testing
// shape types
var shapeIsText=function shapeIsText(shape){return hasProp(shape,'text');};var shapeIsTextBlock=function shapeIsTextBlock(shape){return shapeIsText(shape)&&!(shapeHasRelativeSize(shape)||hasProp(shape,'width'));};var shapeIsTextBox=function shapeIsTextBox(shape){return shapeIsText(shape)&&(shapeHasRelativeSize(shape)||hasProp(shape,'width'));};var shapeIsRect=function shapeIsRect(shape){return!shapeIsText(shape)&&shapeHasComputedSize(shape);};var shapeIsEllipse=function shapeIsEllipse(shape){return hasProp(shape,'rx');};var shapeIsLine=function shapeIsLine(shape){return hasProp(shape,'x1');};var shapeIsPath=function shapeIsPath(shape){return hasProp(shape,'points');};// shape state
var shapeIsTextEmpty=function shapeIsTextEmpty(shape){return shapeIsText(shape)&&!shape.text.length;};var shapeIsTextEditing=function shapeIsTextEditing(shape){return shapeIsText(shape)&&shape.isEditing;};var shapeIsVisible=function shapeIsVisible(shape){return hasProp(shape,'opacity')?shape.opacity>0:true;};var shapeIsSelected=function shapeIsSelected(shape){return shape.isSelected;};var shapeIsEditing=function shapeIsEditing(shape){return shape.isEditing;};var shapeIsDraft=function shapeIsDraft(shape){return shape._isDraft;};var shapeHasSize=function shapeHasSize(shape){return hasProp(shape,'width')&&hasProp(shape,'height');};var shapeHasNumericStroke=function shapeHasNumericStroke(shape){return isNumber(shape.strokeWidth)&&shape.strokeWidth>0;};// only relevant if is bigger than 0
var shapeHasRelativePosition=function shapeHasRelativePosition(shape){var hasRight=hasProp(shape,'right');var hasBottom=hasProp(shape,'bottom');return hasRight||hasBottom;};var shapeHasTexture=function shapeHasTexture(shape){return hasProp(shape,'backgroundImage')||hasProp(shape,'text');};var shapeHasRelativeSize=function shapeHasRelativeSize(shape){return(hasProp(shape,'x')||hasProp(shape,'left'))&&hasProp(shape,'right')||(hasProp(shape,'y')||hasProp(shape,'top'))&&hasProp(shape,'bottom');};var shapeHasComputedSize=function shapeHasComputedSize(shape){return shapeHasSize(shape)||shapeHasRelativeSize(shape);};var shapeIsVisibleColor=function shapeIsVisibleColor(shape,colorProp){var value=shape[colorProp];if(!value)return false;if(value.length===3)return true;return value[3]>0;};var shapeHasStroke=function shapeHasStroke(shape){return shape.strokeWidth&&shapeIsVisibleColor(shape,'strokeColor');};// actions
var shapeSelect=function shapeSelect(shape){shape.isSelected=true;return shape;};var shapeMakeDraft=function shapeMakeDraft(shape){shape._isDraft=true;return shape;};var shapeMakeFinal=function shapeMakeFinal(shape){shape._isDraft=false;return shape;};// rights
var shapeCanStyle=function shapeCanStyle(shape,style){if(shape.disableStyle===true)return false;if(isArray(shape.disableStyle)&&style){return!shape.disableStyle.includes(style);}return true;};var shapeCanSelect=function shapeCanSelect(shape){return shape.disableSelect!==true;};var shapeCanRemove=function shapeCanRemove(shape){return shape.disableRemove!==true;};var shapeCanDuplicate=function shapeCanDuplicate(shape){return shape.disableDuplicate!==true&&shapeCanMove(shape);};var shapeCanReorder=function shapeCanReorder(shape){return shape.disableReorder!==true;};var shapeCanFlip=function shapeCanFlip(shape){if(shape.disableFlip)return false;if(shapeIsDraft(shape)||shapeHasRelativePosition(shape))return false;return shapeHasTexture(shape);};var shapeCanInput=function shapeCanInput(shape,input){if(!shapeIsText(shape))return false;if(shape.disableInput===true)return false;if(isFunction(shape.disableInput))return shape.disableInput(input!=null?input:shape.text);return input||true;};var shapeCanChangeTextLayout=function shapeCanChangeTextLayout(shape,layout){if(shape.disableTextLayout===true)return false;if(isArray(shape.disableTextLayout)&&layout){return!shape.disableTextLayout.includes(layout);}return true;};var shapeCanManipulate=function shapeCanManipulate(shape){return shape.disableManipulate!==true&&!shapeIsDraft(shape)&&!shapeHasRelativePosition(shape);};var shapeCanMove=function shapeCanMove(shape){return shapeCanManipulate(shape)&&shape.disableMove!==true;};var shapeCanResize=function shapeCanResize(shape){return shapeCanManipulate(shape)&&shapeCanMove(shape)&&shape.disableResize!==true&&(shapeHasSize(shape)||shapeIsTextBox(shape)||shapeIsEllipse(shape)||shapeIsLine(shape)||shapeIsPath(shape)&&hasProp(shape,'pathClose'));};var shapeCanRotate=function shapeCanRotate(shape){return shapeCanManipulate(shape)&&shape.disableRotate!==true&&(shapeHasSize(shape)||hasProp(shape,'text')||shapeIsEllipse(shape));};//#endregion
//#region shape formatting
var shapeDeleteRelativeProps=function shapeDeleteRelativeProps(shape){delete shape.left;delete shape.right;delete shape.top;delete shape.bottom;return shape;};var shapeDeleteTransformProps=function shapeDeleteTransformProps(shape){delete shape.rotation;return shape;};var shapeFormatStroke=function shapeFormatStroke(shape){shape.strokeWidth=shape.strokeWidth||1;shape.strokeColor=shape.strokeColor||[0,0,0];return shape;};var shapeFormatFill=function shapeFormatFill(shape){shape.backgroundColor=shape.backgroundColor?shape.backgroundColor:shape.strokeWidth||shape.backgroundImage?undefined:[0,0,0];return shape;};var shapeFormatText=function shapeFormatText(shape){shape.fontSize=shape.fontSize||'4%';shape.fontFamily=shape.fontFamily||'sans-serif';shape.fontWeight=shape.fontWeight||'normal';shape.fontStyle=shape.fontStyle||'normal';shape.fontVariant=shape.fontVariant||'normal';shape.lineHeight=shape.lineHeight||'120%';shape.color=shape.color||[0,0,0];return shapeIsTextBlock(shape)?shapeFormatTextBlock(shape):shapeFormatTextBox(shape);};var shapeFormatTextBlock=function shapeFormatTextBlock(shape){// for now can't align if not allowed to use newlines
if(shape.disableNewline!==false){delete shape.textAlign;shape.text=shape.text.replace(/\n/g,' ');}return shapeDeleteRelativeProps(shape);};var shapeFormatTextBox=function shapeFormatTextBox(shape){shape.textAlign=shape.textAlign||'left';return shape;};var shapeFormatRect=function shapeFormatRect(shape){shape.cornerRadius=shape.cornerRadius||0;shape.strokeWidth=shape.strokeWidth||0;shape.strokeColor=shape.strokeColor||[0,0,0];return shapeFormatFill(shape);};var shapeFormatEllipse=function shapeFormatEllipse(shape){shape.strokeWidth=shape.strokeWidth||0;shape.strokeColor=shape.strokeColor||[0,0,0];return shapeFormatFill(shape);};var shapeFormatPath=function shapeFormatPath(shape){shapeFormatStroke(shape);shapeDeleteTransformProps(shape);if(!hasProp(shape,'pathClose')){shape.disableResize=true;if(!hasProp(shape,'disableMove')){shape.disableMove=true;}}return shapeDeleteRelativeProps(shape);};var shapeFormatLine=function shapeFormatLine(shape){shapeFormatStroke(shape);shape.lineStart=shape.lineStart||undefined;shape.lineEnd=shape.lineEnd||undefined;shapeDeleteTransformProps(shape);return shapeDeleteRelativeProps(shape);};var shapeFormatDefaults=function shapeFormatDefaults(shape){if(!isString(shape.id))shape.id=getUniqueId();if(!hasProp(shape,'rotation'))shape.rotation=0;if(!hasProp(shape,'opacity'))shape.opacity=1;if(!hasProp(shape,'disableErase'))shape.disableErase=true;};var shapeFormat=function shapeFormat(shape){shapeFormatDefaults(shape);if(shapeIsText(shape)){shapeFormatText(shape);}else if(shapeIsRect(shape)){shapeFormatRect(shape);}else if(shapeIsPath(shape)){shapeFormatPath(shape);}else if(shapeIsLine(shape)){shapeFormatLine(shape);}else if(shapeIsEllipse(shape)){shapeFormatEllipse(shape);}return shape;};var shapeGetDescription=function shapeGetDescription(shape){if(shapeIsText(shape))return'text';if(shapeIsRect(shape))return'rectangle';if(shapeIsPath(shape))return'path';if(shapeIsLine(shape))return'line';if(shapeIsEllipse(shape))return'ellipse';return;};//#endregion
var toPixelValue=function toPixelValue(percentage,total){return parseFloat(percentage)/100*total;};//#region shape transforming
var xRegExp=new RegExp(/^x|left|right|^width|rx|fontSize|cornerRadius|strokeWidth/,'i');var yRegExp=new RegExp(/^y|top|bottom|^height|ry/,'i');var compute=function compute(key,value,_ref38){var width=_ref38.width,height=_ref38.height;// handle array of percentage values
if(Array.isArray(value)){return value.map(function(v){if(isObject(v)){// update the object itself
computeProps(v,{width:width,height:height});}return v;});}// no need to compute (test with typeof instead of for perf)
if(typeof value!=='string')return value;if(!value.endsWith('%'))return value;var f=parseFloat(value)/100;if(xRegExp.test(key))return fixPrecision(width*f,6);if(yRegExp.test(key))return fixPrecision(height*f,6);// dont auto-compute
return value;};var computeProps=function computeProps(obj,context){Object.entries(obj).map(function(_ref39){var _ref40=_slicedToArray(_ref39,2),key=_ref40[0],value=_ref40[1];obj[key]=compute(key,value,context);});// assume is percentage
var lineHeight=obj.lineHeight;if(isString(lineHeight))obj.lineHeight=Math.round(obj.fontSize*(parseFloat(lineHeight)/100));};var shapeComputeDisplay=function shapeComputeDisplay(shape,context){computeProps(shape,context);shapeComputeRect(shape,context);return shape;};var shapeGetPropPixelTotal=function shapeGetPropPixelTotal(prop,parentRect){var total;if(/^x|width|rx|fontSize|strokeWidth|cornerRadius/.test(prop)){total=parentRect.width;}else if(/^y|height|ry/.test(prop)){total=parentRect.height;}return total;};var shapeUpdateProp=function shapeUpdateProp(shape,prop,value,parentRect){if(!isString(shape[prop])){shape[prop]=value;return shape;}var total=shapeGetPropPixelTotal(prop,parentRect);shape[prop]=total===undefined?value:toPercentage(value,total);return shape;};var shapeGetPropPixelValue=function shapeGetPropPixelValue(shape,prop,parentRect){if(Array.isArray(shape[prop]))return shape[prop].map(function(item){return Object.entries(item).reduce(function(mapped,_ref41){var _ref42=_slicedToArray(_ref41,2),key=_ref42[0],value=_ref42[1];mapped[key]=isString(value)?toPixelValue(value,shapeGetPropPixelTotal(key,parentRect)):value;return mapped;},{});});if(!isString(shape[prop]))return shape[prop];return toPixelValue(shape[prop],shapeGetPropPixelTotal(prop,parentRect));};var shapeGetPropsPixelValues=function shapeGetPropsPixelValues(shape,props,parentRect){return props.reduce(function(prev,prop){var value=shapeGetPropPixelValue(shape,prop,parentRect);prev[prop]=value;return prev;},{});};var shapeUpdateProps=function shapeUpdateProps(shape,props,parentRect){Object.keys(props).forEach(function(key){return shapeUpdateProp(shape,key,props[key],parentRect);});return shape;};var shapeBounds=function shapeBounds(shape){var rect=rectCreateEmpty();var strokeWidth=shape.strokeWidth||0;if(shapeIsRect(shape)){rect.x=shape.x-strokeWidth*0.5;rect.y=shape.y-strokeWidth*0.5;rect.width=shape.width+strokeWidth;rect.height=shape.height+strokeWidth;}else if(shapeIsLine(shape)){var x1=shape.x1,y1=shape.y1,x2=shape.x2,y2=shape.y2;var left=Math.abs(Math.min(x1,x2));var right=Math.abs(Math.max(x1,x2));var top=Math.abs(Math.min(y1,y2));var bottom=Math.abs(Math.min(y1,y2));rect.x=left+strokeWidth*0.5;rect.y=right+strokeWidth*0.5;rect.width=right-left+strokeWidth;rect.height=bottom-top+strokeWidth;}else if(shapeIsEllipse(shape)){rect.x=shape.x-shape.rx+strokeWidth*0.5;rect.y=shape.y-shape.ry+strokeWidth*0.5;rect.width=shape.rx*2+strokeWidth;rect.height=shape.ry*2+strokeWidth;}if(rect&&hasProp(shape,'rotation')){rectRotate(rect,shape.rotation);}return rectToBounds(rect);};var shapesBounds=function shapesBounds(shapes,parentRect){var bounds=shapes.filter(function(shape){return shape.x<0||shape.y<0||shape.x1<0||shape.y1<0;}).reduce(function(bounds,shape){var _shapeBounds=shapeBounds(shape),_shapeBounds2=_slicedToArray(_shapeBounds,4),top=_shapeBounds2[0],right=_shapeBounds2[1],bottom=_shapeBounds2[2],left=_shapeBounds2[3];bounds.top=Math.min(top,bounds.top);bounds.left=Math.min(left,bounds.left);bounds.bottom=Math.max(bottom,bounds.bottom);bounds.right=Math.max(right,bounds.right);return bounds;},{top:0,right:0,bottom:0,left:0});if(bounds.right>0)bounds.right-=parentRect.width;if(bounds.bottom>0)bounds.bottom-=parentRect.height;return bounds;};var shapesFromCompositShape=function shapesFromCompositShape(shape,parentRect,parser){var shapeCopy=shapeDeepCopy(shape);shapeComputeDisplay(shapeCopy,parentRect);var shapes=parser(shapeCopy);return Array.isArray(shapes)?shapes:[shapes];};var shapeComputeRect=function shapeComputeRect(shape,context){if(hasProp(shape,'left'))shape.x=shape.left;if(hasProp(shape,'right')&&!isString(shape.right)){var _r3=context.width-shape.right;if(hasProp(shape,'left')){shape.x=shape.left;shape.width=Math.max(0,_r3-shape.left);}else if(hasProp(shape,'width')){shape.x=_r3-shape.width;}}if(hasProp(shape,'top'))shape.y=shape.top;if(hasProp(shape,'bottom')&&!isString(shape.bottom)){var b=context.height-shape.bottom;if(hasProp(shape,'top')){shape.y=shape.top;shape.height=Math.max(0,b-shape.top);}else if(hasProp(shape,'height')){shape.y=b-shape.height;}}return shape;};// currently only used for drawing to canvas in output
var shapeScale=function shapeScale(shape,scale){if(shapeIsPath(shape)){shape.points.filter(function(point){return isNumber(point.x);}).forEach(function(point){point.x*=scale;point.y*=scale;});}if(shapeIsLine(shape)&&isNumber(shape.x1)){shape.x1*=scale;shape.y1*=scale;shape.x2*=scale;shape.y2*=scale;}if(isNumber(shape.x)&&isNumber(shape.y)){shape.x*=scale;shape.y*=scale;}if(isNumber(shape.width)&&isNumber(shape.height)){shape.width*=scale;shape.height*=scale;}if(isNumber(shape.rx)&&isNumber(shape.ry)){shape.rx*=scale;shape.ry*=scale;}if(shapeHasNumericStroke(shape)){shape.strokeWidth*=scale;}if(shapeIsText(shape)){shape._scale=scale;if(isNumber(shape.fontSize)){shape.fontSize*=scale;}if(isNumber(shape.lineHeight)){shape.lineHeight*=scale;}if(isNumber(shape.width)&&!isNumber(shape.height))shape.width*=scale;}if(hasProp(shape,'cornerRadius')&&isNumber(shape.cornerRadius)){shape.cornerRadius*=scale;}return shape;};var shapeGetLength=function shapeGetLength(shape){if(!shape.x1)return;return vectorDistance(vectorCreate(shape.x1,shape.y1),vectorCreate(shape.x2,shape.y2));};var shapeGetCenter=function shapeGetCenter(shape){if(shapeIsRect(shape)){return vectorCreate(shape.x+shape.width*0.5,shape.y+shape.height*0.5);}if(shapeIsEllipse(shape)){return vectorCreate(shape.x,shape.y);}if(shape.text){// if is text box we try to use width & height values
if(shapeIsTextBox(shape)){var _height2=shape.height||textToSize(shape.text,shape).height;return vectorCreate(shape.x+shape.width*0.5,shape.y+_height2*0.5);}// else we calculate text size
var size=textToSize(shape.text,shape);return vectorCreate(shape.x+size.width*0.5,shape.y+size.height*0.5);}if(shapeIsPath(shape)){return vectorCenter(shape.points);}if(shapeIsLine(shape)){return vectorCenter([shapeLineGetStartPoint(shape),shapeLineGetEndPoint(shape)]);}return undefined;};//#endregion
var shapeGetLevel=function shapeGetLevel(shapeInitialState,imageCurrentState){var flipX=false;if(imageCurrentState.flipX&&shapeInitialState.flipX){flipX=true;}else if(!imageCurrentState.flipX&&shapeInitialState.flipX){flipX=false;}else if(imageCurrentState.flipX&&!shapeInitialState.flipX){flipX=true;}var flipY=false;if(imageCurrentState.flipY&&shapeInitialState.flipY){flipY=true;}else if(!imageCurrentState.flipY&&shapeInitialState.flipY){flipY=false;}else if(imageCurrentState.flipY&&!shapeInitialState.flipY){flipY=true;}var rotation=-imageCurrentState.rotation;if((flipX||flipY)&&!(flipX&&flipY))rotation=-rotation;return{flipX:flipX,flipY:flipY,rotation:rotation};};var ctxRoundRect=function ctxRoundRect(ctx,x,y,width,height,radius){if(width<2*radius)radius=width/2;if(height<2*radius)radius=height/2;ctx.beginPath();ctx.moveTo(x+radius,y);ctx.arcTo(x+width,y,x+width,y+height,radius);ctx.arcTo(x+width,y+height,x,y+height,radius);ctx.arcTo(x,y+height,x,y,radius);ctx.arcTo(x,y,x+width,y,radius);ctx.closePath();return ctx;};var isCanvas=function isCanvas(element){return /canvas/i.test(element.nodeName);};var isRemoteURL=function isRemoteURL(url){return new URL(url,location.href).origin!==location.origin;};var loadImage=function loadImage(image){var onSize=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;return new Promise(function(resolve,reject){// the image element we'll use to load the image
var imageElement=image;var sizeCalculated=false;var reportSize=function reportSize(){if(sizeCalculated)return;sizeCalculated=true;isFunction(onSize)&&/* Use Promise.resolve to make async but place before resolve of parent promise */Promise.resolve().then(function(){return onSize(sizeCreate(imageElement.naturalWidth,imageElement.naturalHeight));});};// if is not an image element, it must be a valid image source
if(!imageElement.src){imageElement=new Image();// if is remote image, set crossOrigin
// why not always set crossOrigin? -> because when set this fires two requests,
// one for asking permission and one for downloading the image
if(isString(image)&&isRemoteURL(image))imageElement.crossOrigin='anonymous';imageElement.src=isString(image)?image:URL.createObjectURL(image);}if(imageElement.complete){reportSize();return resolve(imageElement);}// try to calculate size faster
if(isFunction(onSize))getImageElementSize(imageElement).then(reportSize)["catch"](reject);imageElement.onload=function(){reportSize();resolve(imageElement);};imageElement.onerror=reject;});};var cache=new Map([]);var getImage=function getImage(src){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return new Promise(function(resolve,reject){var _options$onMetadata=options.onMetadata,onMetadata=_options$onMetadata===void 0?noop$1:_options$onMetadata,_options$onLoad=options.onLoad,onLoad=_options$onLoad===void 0?resolve:_options$onLoad,_options$onError=options.onError,onError=_options$onError===void 0?reject:_options$onError,_options$onComplete=options.onComplete,onComplete=_options$onComplete===void 0?noop$1:_options$onComplete;var imageLoadState=cache.get(src);// start loading
if(!imageLoadState){imageLoadState={loading:false,complete:false,error:false,image:undefined,size:undefined,bus:pubsub()};// store
cache.set(src,imageLoadState);}// wait for load
imageLoadState.bus.sub('meta',onMetadata);imageLoadState.bus.sub('load',onLoad);imageLoadState.bus.sub('error',onError);imageLoadState.bus.sub('complete',onComplete);// if is canvas, it's already done
if(isCanvas(src)){var canvas=src;// get image
var image=canvas.cloneNode();// update state
imageLoadState.complete=true;imageLoadState.image=image;imageLoadState.size=sizeCreateFromElement(canvas);}// already loaded
if(imageLoadState.complete){imageLoadState.bus.pub('meta',{size:imageLoadState.size});if(imageLoadState.error){imageLoadState.bus.pub('error',imageLoadState.error);}else{imageLoadState.bus.pub('load',imageLoadState.image);}imageLoadState.bus.pub('complete');// reset subscribers
imageLoadState.bus=pubsub();return;}// already loading, exit here
if(imageLoadState.loading)return;// now loading
imageLoadState.loading=true;// resource needs to be loaded
loadImage(src,function(size){imageLoadState.size=size;imageLoadState.bus.pub('meta',{size:size});}).then(function(image){imageLoadState.image=image;imageLoadState.bus.pub('load',image);})["catch"](function(err){imageLoadState.error=err;imageLoadState.bus.pub('error',err);})["finally"](function(){imageLoadState.complete=true;imageLoadState.loading=false;imageLoadState.bus.pub('complete');// reset subscribers
imageLoadState.bus=pubsub();});});};var drawCanvas=function drawCanvas(ctx,image,srcRect,destRect){return ctx.drawImage(image,srcRect.x,srcRect.x,srcRect.width,srcRect.height,destRect.x,destRect.y,destRect.width,destRect.height);};var ctxDrawImage=/*#__PURE__*/function(){var _ref43=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee25(ctx,image,srcRect,destRect){var draw,_args20=arguments;return _regeneratorRuntime().wrap(function _callee25$(_context25){while(1)switch(_context25.prev=_context25.next){case 0:draw=_args20.length>4&&_args20[4]!==undefined?_args20[4]:drawCanvas;ctx.save();ctx.clip();_context25.next=5;return draw(ctx,image,srcRect,destRect);case 5:ctx.restore();case 6:case"end":return _context25.stop();}},_callee25);}));return function ctxDrawImage(_x36,_x37,_x38,_x39){return _ref43.apply(this,arguments);};}();var getDrawImageParams=function getDrawImageParams(container,backgroundSize,imageSize,backgroundCorners,backgroundPosition){// target is container
var destRect=rectClone$1(container);// texture mapping
if(backgroundCorners){var _srcRect=rectApply(rectCreateFromPoints(backgroundCorners),fixPrecision);_srcRect.x*=imageSize.width;_srcRect.width*=imageSize.width;_srcRect.y*=imageSize.height;_srcRect.height*=imageSize.height;return{srcRect:_srcRect,destRect:destRect};}// by default use entire image
var srcRect=rectCreate(0,0,imageSize.width,imageSize.height);// css background positioning
if(backgroundSize==='contain'){var rect=rectContainRect(container,rectAspectRatio(srcRect));destRect.width=rect.width;destRect.height=rect.height;if(backgroundPosition){destRect.x+=backgroundPosition.x;destRect.y+=backgroundPosition.y;}else{destRect.x+=rect.x;destRect.y+=rect.y;}}else if(backgroundSize==='cover'){var relativeRect=rectCoverRect(destRect,srcRect.width/srcRect.height);destRect.width=relativeRect.width;destRect.height=relativeRect.height;if(backgroundPosition){destRect.x+=backgroundPosition.x;destRect.y+=backgroundPosition.y;}else{destRect.x+=relativeRect.x;destRect.y+=relativeRect.y;}}else if(backgroundSize){destRect.width=backgroundSize.width;destRect.height=backgroundSize.height;if(backgroundPosition){destRect.x+=backgroundPosition.x;destRect.y+=backgroundPosition.y;}}else if(backgroundPosition){destRect.width=imageSize.width;destRect.height=imageSize.height;destRect.x+=backgroundPosition.x;destRect.y+=backgroundPosition.y;}return{srcRect:srcRect,destRect:destRect};};var defineRectShape=function defineRectShape(ctx,shape){shape.cornerRadius>0?ctxRoundRect(ctx,shape.x,shape.y,shape.width,shape.height,shape.cornerRadius):ctx.rect(shape.x,shape.y,shape.width,shape.height);return ctx;};var fillRectShape=function fillRectShape(ctx,shape){shape.backgroundColor&&ctx.fill();return ctx;};var strokeRectShape=function strokeRectShape(ctx,shape){shape.strokeWidth&&ctx.stroke();return ctx;};var drawRect=/*#__PURE__*/function(){var _ref44=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee26(ctx,shape){var options,drawImage,image,_getDrawImageParams,srcRect,destRect,_args21=arguments;return _regeneratorRuntime().wrap(function _callee26$(_context26){while(1)switch(_context26.prev=_context26.next){case 0:options=_args21.length>2&&_args21[2]!==undefined?_args21[2]:{};drawImage=options.drawImage;ctx.lineWidth=shape.strokeWidth?shape.strokeWidth:1;// 1 is default value for lineWidth prop
ctx.strokeStyle=shape.strokeColor?colorArrayToRGBA(shape.strokeColor):'none';ctx.fillStyle=shape.backgroundColor?colorArrayToRGBA(shape.backgroundColor):'none';ctx.globalAlpha=shape.opacity;if(!shape.backgroundImage){_context26.next=21;break;}if(!isCanvas(shape.backgroundImage)){_context26.next=11;break;}image=shape.backgroundImage;_context26.next=14;break;case 11:_context26.next=13;return getImage(shape.backgroundImage);case 13:image=_context26.sent;case 14:defineRectShape(ctx,shape);fillRectShape(ctx,shape);_getDrawImageParams=getDrawImageParams(shape,shape.backgroundSize,sizeCreateFromElement(image),shape.backgroundCorners,shape.backgroundPosition),srcRect=_getDrawImageParams.srcRect,destRect=_getDrawImageParams.destRect;_context26.next=19;return ctxDrawImage(ctx,image,srcRect,destRect,drawImage);case 19:strokeRectShape(ctx,shape);return _context26.abrupt("return",[]);case 21:defineRectShape(ctx,shape);fillRectShape(ctx,shape);strokeRectShape(ctx,shape);return _context26.abrupt("return",[]);case 25:case"end":return _context26.stop();}},_callee26);}));return function drawRect(_x40,_x41){return _ref44.apply(this,arguments);};}();var drawEllipse=/*#__PURE__*/function(){var _ref45=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee28(ctx,shape){var options,_args23=arguments;return _regeneratorRuntime().wrap(function _callee28$(_context28){while(1)switch(_context28.prev=_context28.next){case 0:options=_args23.length>2&&_args23[2]!==undefined?_args23[2]:{};return _context28.abrupt("return",new Promise(/*#__PURE__*/function(){var _ref46=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee27(resolve,reject){var drawImage,image,bounds,_getDrawImageParams2,srcRect,destRect;return _regeneratorRuntime().wrap(function _callee27$(_context27){while(1)switch(_context27.prev=_context27.next){case 0:drawImage=options.drawImage;ctx.lineWidth=shape.strokeWidth||1;// 1 is default value for lineWidth prop
ctx.strokeStyle=shape.strokeColor?colorArrayToRGBA(shape.strokeColor):'none';ctx.fillStyle=shape.backgroundColor?colorArrayToRGBA(shape.backgroundColor):'none';ctx.globalAlpha=shape.opacity;ctx.ellipse(shape.x,shape.y,shape.rx,shape.ry,0,0,Math.PI*2);shape.backgroundColor&&ctx.fill();if(!shape.backgroundImage){_context27.next=25;break;}_context27.prev=8;_context27.next=11;return getImage(shape.backgroundImage);case 11:image=_context27.sent;_context27.next=17;break;case 14:_context27.prev=14;_context27.t0=_context27["catch"](8);reject(_context27.t0);case 17:bounds=rectCreate(shape.x-shape.rx,shape.y-shape.ry,shape.rx*2,shape.ry*2);_getDrawImageParams2=getDrawImageParams(bounds,shape.backgroundSize,sizeCreateFromElement(image),shape.backgroundCorners,shape.backgroundPosition),srcRect=_getDrawImageParams2.srcRect,destRect=_getDrawImageParams2.destRect;// @ts-ignore
_context27.next=21;return ctxDrawImage(ctx,image,srcRect,destRect,drawImage);case 21:shape.strokeWidth&&ctx.stroke();resolve([]);_context27.next=27;break;case 25:shape.strokeWidth&&ctx.stroke();resolve([]);case 27:case"end":return _context27.stop();}},_callee27,null,[[8,14]]);}));return function(_x44,_x45){return _ref46.apply(this,arguments);};}()));case 2:case"end":return _context28.stop();}},_callee28);}));return function drawEllipse(_x42,_x43){return _ref45.apply(this,arguments);};}();var drawText=/*#__PURE__*/function(){var _ref47=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee29(ctx,shape,options){var size,rect,willRequest,image;return _regeneratorRuntime().wrap(function _callee29$(_context29){while(1)switch(_context29.prev=_context29.next){case 0:// get text size
size=shape.width&&shape.height?sizeCreateFromAny(shape):textToSize(shape.text,shape);rect={x:shape.x,y:shape.y,width:size.width,height:size.height};drawRect(ctx,_objectSpread(_objectSpread(_objectSpread({},shape),rect),{},{options:options}));// skip if no text
if(shape.text.length){_context29.next=5;break;}return _context29.abrupt("return",[]);case 5:willRequest=options.willRequest;_context29.next=8;return textToImage(shape.text,_objectSpread(_objectSpread(_objectSpread({},shape),rect),{},{imageWidth:rect.width,imageHeight:rect.height,willRequest:willRequest}));case 8:image=_context29.sent;ctx.drawImage(image,shape.x-TextPadding,shape.y,image.width,image.height);return _context29.abrupt("return",[]);case 11:case"end":return _context29.stop();}},_callee29);}));return function drawText(_x46,_x47,_x48){return _ref47.apply(this,arguments);};}();// TODO! START
// -----------
var drawLine=/*#__PURE__*/function(){var _ref48=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee31(ctx,shape){return _regeneratorRuntime().wrap(function _callee31$(_context31){while(1)switch(_context31.prev=_context31.next){case 0:return _context31.abrupt("return",new Promise(/*#__PURE__*/function(){var _ref49=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee30(resolve){var lineStartPosition,lineEndPosition;return _regeneratorRuntime().wrap(function _callee30$(_context30){while(1)switch(_context30.prev=_context30.next){case 0:ctx.lineWidth=shape.strokeWidth||1;// 1 is default value for lineWidth prop
ctx.strokeStyle=shape.strokeColor?colorArrayToRGBA(shape.strokeColor):'none';ctx.globalAlpha=shape.opacity;lineStartPosition=shapeLineGetStartPoint(shape);lineEndPosition=shapeLineGetEndPoint(shape);// draw line
ctx.moveTo(lineStartPosition.x,lineStartPosition.y);ctx.lineTo(lineEndPosition.x,lineEndPosition.y);shape.strokeWidth&&ctx.stroke();// draw other shapes
resolve([]);case 9:case"end":return _context30.stop();}},_callee30);}));return function(_x51){return _ref49.apply(this,arguments);};}()));case 1:case"end":return _context31.stop();}},_callee31);}));return function drawLine(_x49,_x50){return _ref48.apply(this,arguments);};}();// TODO! END
// -----------
var drawPath=/*#__PURE__*/function(){var _ref50=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee32(ctx,shape){return _regeneratorRuntime().wrap(function _callee32$(_context32){while(1)switch(_context32.prev=_context32.next){case 0:return _context32.abrupt("return",new Promise(function(resolve,reject){ctx.lineWidth=shape.strokeWidth||1;// 1 is default value for lineWidth prop
ctx.strokeStyle=shape.strokeColor?colorArrayToRGBA(shape.strokeColor):'none';ctx.fillStyle=shape.backgroundColor?colorArrayToRGBA(shape.backgroundColor):'none';ctx.globalAlpha=shape.opacity;// draw line
var points=shape.points;if(shape.pathClose)ctx.beginPath();ctx.moveTo(points[0].x,points[0].y);var l=points.length;for(var i=1;i<l;i++){ctx.lineTo(points[i].x,points[i].y);}if(shape.pathClose)ctx.closePath();shape.strokeWidth&&ctx.stroke();shape.backgroundColor&&ctx.fill();resolve([]);}));case 1:case"end":return _context32.stop();}},_callee32);}));return function drawPath(_x52,_x53){return _ref50.apply(this,arguments);};}();var ctxFlip=function ctxFlip(ctx,flipX,flipY,pivot){if(!flipX&&!flipY)return ctx;ctx.translate(pivot.x,pivot.y);ctx.scale(flipX?-1:1,flipY?-1:1);ctx.translate(-pivot.x,-pivot.y);return ctx;};var drawShape=/*#__PURE__*/function(){var _ref51=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee33(ctx,shape,options){var center,fn,subShapes,shapes;return _regeneratorRuntime().wrap(function _callee33$(_context33){while(1)switch(_context33.prev=_context33.next){case 0:// center, needed for transforms
center=shapeGetCenter(shape);// rotate context
ctxRotate(ctx,shape.rotation,center);// flip context
ctxFlip(ctx,shape.flipX,shape.flipY,center);if(shapeIsRect(shape)){fn=drawRect;}else if(shapeIsEllipse(shape)){fn=drawEllipse;}else if(shapeIsLine(shape)){fn=drawLine;}else if(shapeIsPath(shape)){fn=drawPath;}else if(shapeIsText(shape)){fn=drawText;}if(!fn){_context33.next=14;break;}_context33.next=7;return fn(ctx,shape,options);case 7:subShapes=_context33.sent;if(subShapes.length){_context33.next=10;break;}return _context33.abrupt("return",[]);case 10:_context33.next=12;return drawShapes(ctx,subShapes,options);case 12:shapes=_context33.sent;return _context33.abrupt("return",[shape].concat(_toConsumableArray(shapes)));case 14:return _context33.abrupt("return",[]);case 15:case"end":return _context33.stop();}},_callee33);}));return function drawShape(_x54,_x55,_x56){return _ref51.apply(this,arguments);};}();var drawShapes=/*#__PURE__*/function(){var _ref52=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee34(ctx,shapes,options){var drawnShapes,_iterator4,_step4,shape;return _regeneratorRuntime().wrap(function _callee34$(_context34){while(1)switch(_context34.prev=_context34.next){case 0:drawnShapes=[];_iterator4=_createForOfIteratorHelper(shapes);_context34.prev=2;_iterator4.s();case 4:if((_step4=_iterator4.n()).done){_context34.next=19;break;}shape=_step4.value;ctx.save();// clears previous shape's path
ctx.beginPath();// wait for shape to draw before drawing next shape
_context34.t0=[];_context34.t1=_toConsumableArray(drawnShapes);_context34.t2=_toConsumableArray;_context34.next=13;return drawShape(ctx,shape,options);case 13:_context34.t3=_context34.sent;_context34.t4=(0,_context34.t2)(_context34.t3);drawnShapes=_context34.t0.concat.call(_context34.t0,_context34.t1,_context34.t4);ctx.restore();case 17:_context34.next=4;break;case 19:_context34.next=24;break;case 21:_context34.prev=21;_context34.t5=_context34["catch"](2);_iterator4.e(_context34.t5);case 24:_context34.prev=24;_iterator4.f();return _context34.finish(24);case 27:return _context34.abrupt("return",drawnShapes);case 28:case"end":return _context34.stop();}},_callee34,null,[[2,21,24,27]]);}));return function drawShapes(_x57,_x58,_x59){return _ref52.apply(this,arguments);};}();var drawImageData=/*#__PURE__*/function(){var _ref53=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee35(imageData){var options,_options$shapes,shapes,_options$contextBound,contextBounds,_options$transform,transform,drawImage,willRequest,canvasMemoryLimit,_options$computeShape,computeShape,_options$preprocessSh,preprocessShape,canvas,ctx,computedShapes,imageDataOut,_args30=arguments;return _regeneratorRuntime().wrap(function _callee35$(_context35){while(1)switch(_context35.prev=_context35.next){case 0:options=_args30.length>1&&_args30[1]!==undefined?_args30[1]:{};_options$shapes=options.shapes,shapes=_options$shapes===void 0?[]:_options$shapes,_options$contextBound=options.contextBounds,contextBounds=_options$contextBound===void 0?imageData:_options$contextBound,_options$transform=options.transform,transform=_options$transform===void 0?noop$1:_options$transform,drawImage=options.drawImage,willRequest=options.willRequest,canvasMemoryLimit=options.canvasMemoryLimit,_options$computeShape=options.computeShape,computeShape=_options$computeShape===void 0?passthrough:_options$computeShape,_options$preprocessSh=options.preprocessShape,preprocessShape=_options$preprocessSh===void 0?passthrough:_options$preprocessSh;// no shapes to draw
if(shapes.length){_context35.next=4;break;}return _context35.abrupt("return",imageData);case 4:// create drawing context
canvas=h('canvas');canvas.width=contextBounds.width;canvas.height=contextBounds.height;ctx=canvas.getContext('2d',{willReadFrequently:true});ctx.putImageData(imageData,contextBounds.x||0,contextBounds.y||0);// compute the position of all shapes
computedShapes=shapes.map(shapeDeepCopy).map(computeShape).map(preprocessShape).flat();// compute transforms for context
transform(ctx);// draw shapes to canvas
_context35.next=13;return drawShapes(ctx,computedShapes,{drawImage:drawImage,canvasMemoryLimit:canvasMemoryLimit,willRequest:willRequest});case 13:imageDataOut=ctx.getImageData(0,0,canvas.width,canvas.height);releaseCanvas(canvas);return _context35.abrupt("return",imageDataOut);case 16:case"end":return _context35.stop();}},_callee35);}));return function drawImageData(_x60){return _ref53.apply(this,arguments);};}();var fillImageData=/*#__PURE__*/function(){var _ref54=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee36(imageData){var options,backgroundColor,backgroundImage,hasBackgroundColor,image,ctx,_image,_getDrawImageParams3,srcRect,destRect,imageDataOut,_args31=arguments;return _regeneratorRuntime().wrap(function _callee36$(_context36){while(1)switch(_context36.prev=_context36.next){case 0:options=_args31.length>1&&_args31[1]!==undefined?_args31[1]:{};backgroundColor=options.backgroundColor,backgroundImage=options.backgroundImage;hasBackgroundColor=!(!backgroundColor||backgroundColor&&backgroundColor[3]===0);// no background set
if(!(!backgroundImage&&!hasBackgroundColor)){_context36.next=5;break;}return _context36.abrupt("return",imageData);case 5:// canvas to fill
image=h('canvas');image.width=imageData.width;image.height=imageData.height;ctx=image.getContext('2d',{willReadFrequently:true});ctx.putImageData(imageData,0,0);// fill behind image
ctx.globalCompositeOperation='destination-over';if(hasBackgroundColor){ctx.fillStyle=colorArrayToRGBA(backgroundColor);ctx.fillRect(0,0,image.width,image.height);}if(!backgroundImage){_context36.next=22;break;}if(!isCanvas(backgroundImage)){_context36.next=17;break;}_image=backgroundImage;_context36.next=20;break;case 17:_context36.next=19;return getImage(backgroundImage);case 19:_image=_context36.sent;case 20:_getDrawImageParams3=getDrawImageParams({x:0,y:0,width:imageData.width,height:imageData.height},'cover',{width:_image.width,height:_image.height}),srcRect=_getDrawImageParams3.srcRect,destRect=_getDrawImageParams3.destRect;ctx.drawImage(_image,srcRect.x,srcRect.y,srcRect.width,srcRect.height,destRect.x,destRect.y,destRect.width,destRect.height);case 22:imageDataOut=ctx.getImageData(0,0,image.width,image.height);releaseCanvas(image);return _context36.abrupt("return",imageDataOut);case 25:case"end":return _context36.stop();}},_callee36);}));return function fillImageData(_x61){return _ref54.apply(this,arguments);};}();var dotColorMatrix=function dotColorMatrix(a,b){var res=new Array(20);// R
res[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15];res[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16];res[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17];res[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18];res[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19]+a[4];// G
res[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15];res[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16];res[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17];res[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18];res[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19]+a[9];// B
res[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15];res[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16];res[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17];res[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18];res[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19]+a[14];// A
res[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15];res[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16];res[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17];res[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18];res[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19]+a[19];return res;};var getColorMatrixFromColorMatrices=function getColorMatrixFromColorMatrices(colorMatrices){return colorMatrices.length?colorMatrices.reduce(function(previous,current){return dotColorMatrix(_toConsumableArray(previous),current);},colorMatrices.shift()):[];};var roundFraction=function roundFraction(value){var fr=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;return Math.round(value*fr)/fr;};var getImageRedactionScaleFactor=function getImageRedactionScaleFactor(imageSize,redactionShapes){var imageRes=imageSize.width*imageSize.height;var maxShapeSize=redactionShapes.reduce(function(max,shape){if(shape.width>max.width&&shape.height>max.height){max.width=shape.width;max.height=shape.height;}return max;},{width:0,height:0});var maxShapeRes=maxShapeSize.width*maxShapeSize.height;var fraction=Math.max(0.5,0.5+(1-maxShapeRes/imageRes)/2);return roundFraction(fraction,5);};function noop(){}var identity=function identity(x){return x;};function assign(tar,src){// @ts-ignore
for(var k in src)tar[k]=src[k];return tar;}function run(fn){return fn();}function blank_object(){return Object.create(null);}function run_all(fns){fns.forEach(run);}function is_function(thing){return typeof thing==='function';}function safe_not_equal(a,b){return a!=a?b==b:a!==b||a&&_typeof(a)==='object'||typeof a==='function';}function is_empty(obj){return Object.keys(obj).length===0;}function subscribe(store){if(store==null){return noop;}for(var _len=arguments.length,callbacks=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){callbacks[_key-1]=arguments[_key];}var unsub=store.subscribe.apply(store,callbacks);return unsub.unsubscribe?function(){return unsub.unsubscribe();}:unsub;}function get_store_value(store){var value;subscribe(store,function(_){return value=_;})();return value;}function component_subscribe(component,store,callback){component.$$.on_destroy.push(subscribe(store,callback));}function create_slot(definition,ctx,$$scope,fn){if(definition){var slot_ctx=get_slot_context(definition,ctx,$$scope,fn);return definition[0](slot_ctx);}}function get_slot_context(definition,ctx,$$scope,fn){return definition[1]&&fn?assign($$scope.ctx.slice(),definition[1](fn(ctx))):$$scope.ctx;}function get_slot_changes(definition,$$scope,dirty,fn){if(definition[2]&&fn){var lets=definition[2](fn(dirty));if($$scope.dirty===undefined){return lets;}if(_typeof(lets)==='object'){var merged=[];var len=Math.max($$scope.dirty.length,lets.length);for(var i=0;i<len;i+=1){merged[i]=$$scope.dirty[i]|lets[i];}return merged;}return $$scope.dirty|lets;}return $$scope.dirty;}function update_slot_base(slot,slot_definition,ctx,$$scope,slot_changes,get_slot_context_fn){if(slot_changes){var slot_context=get_slot_context(slot_definition,ctx,$$scope,get_slot_context_fn);slot.p(slot_context,slot_changes);}}function get_all_dirty_from_scope($$scope){if($$scope.ctx.length>32){var dirty=[];var length=$$scope.ctx.length/32;for(var i=0;i<length;i++){dirty[i]=-1;}return dirty;}return-1;}function exclude_internal_props(props){var result={};for(var k in props)if(k[0]!=='$')result[k]=props[k];return result;}function compute_rest_props(props,keys){var rest={};keys=new Set(keys);for(var k in props)if(!keys.has(k)&&k[0]!=='$')rest[k]=props[k];return rest;}function set_store_value(store,ret,value){store.set(value);return ret;}function action_destroyer(action_result){return action_result&&is_function(action_result.destroy)?action_result.destroy:noop;}var is_client=typeof window!=='undefined';var now=is_client?function(){return window.performance.now();}:function(){return Date.now();};var raf=is_client?function(cb){return requestAnimationFrame(cb);}:noop;var tasks=new Set();function run_tasks(now){tasks.forEach(function(task){if(!task.c(now)){tasks["delete"](task);task.f();}});if(tasks.size!==0)raf(run_tasks);}/**
 * Creates a new task that runs on each raf frame
 * until it returns a falsy value or is aborted
 */function loop(callback){var task;if(tasks.size===0)raf(run_tasks);return{promise:new Promise(function(fulfill){tasks.add(task={c:callback,f:fulfill});}),abort:function abort(){tasks["delete"](task);}};}function append(target,node){target.appendChild(node);}function get_root_for_style(node){if(!node)return document;var root=node.getRootNode?node.getRootNode():node.ownerDocument;if(root&&root.host){return root;}return node.ownerDocument;}function append_empty_stylesheet(node){var style_element=element('style');append_stylesheet(get_root_for_style(node),style_element);return style_element.sheet;}function append_stylesheet(node,style){append(node.head||node,style);return style.sheet;}function insert(target,node,anchor){target.insertBefore(node,anchor||null);}function detach(node){node.parentNode.removeChild(node);}function element(name){return document.createElement(name);}function svg_element(name){return document.createElementNS('http://www.w3.org/2000/svg',name);}function text(data){return document.createTextNode(data);}function space(){return text(' ');}function empty(){return text('');}function listen(node,event,handler,options){node.addEventListener(event,handler,options);return function(){return node.removeEventListener(event,handler,options);};}function prevent_default(fn){return function(event){event.preventDefault();// @ts-ignore
return fn.call(this,event);};}function stop_propagation(fn){return function(event){event.stopPropagation();// @ts-ignore
return fn.call(this,event);};}function attr(node,attribute,value){if(value==null)node.removeAttribute(attribute);else if(node.getAttribute(attribute)!==value)node.setAttribute(attribute,value);}function set_attributes(node,attributes){// @ts-ignore
var descriptors=Object.getOwnPropertyDescriptors(node.__proto__);for(var key in attributes){if(attributes[key]==null){node.removeAttribute(key);}else if(key==='style'){node.style.cssText=attributes[key];}else if(key==='__value'){node.value=node[key]=attributes[key];}else if(descriptors[key]&&descriptors[key].set){node[key]=attributes[key];}else{attr(node,key,attributes[key]);}}}function children(element){return Array.from(element.childNodes);}function set_data(text,data){data=''+data;if(text.wholeText!==data)text.data=data;}function set_input_value(input,value){input.value=value==null?'':value;}function custom_event(type,detail){var _ref55=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref55$bubbles=_ref55.bubbles,bubbles=_ref55$bubbles===void 0?false:_ref55$bubbles,_ref55$cancelable=_ref55.cancelable,cancelable=_ref55$cancelable===void 0?false:_ref55$cancelable;var e=document.createEvent('CustomEvent');e.initCustomEvent(type,bubbles,cancelable,detail);return e;}var HtmlTag=/*#__PURE__*/function(){function HtmlTag(){var is_svg=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classCallCheck(this,HtmlTag);this.is_svg=false;this.is_svg=is_svg;this.e=this.n=null;}_createClass(HtmlTag,[{key:"c",value:function c(html){this.h(html);}},{key:"m",value:function m(html,target){var anchor=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!this.e){if(this.is_svg)this.e=svg_element(target.nodeName);else this.e=element(target.nodeName);this.t=target;this.c(html);}this.i(anchor);}},{key:"h",value:function h(html){this.e.innerHTML=html;this.n=Array.from(this.e.childNodes);}},{key:"i",value:function i(anchor){for(var i=0;i<this.n.length;i+=1){insert(this.t,this.n[i],anchor);}}},{key:"p",value:function p(html){this.d();this.h(html);this.i(this.a);}},{key:"d",value:function d(){this.n.forEach(detach);}}]);return HtmlTag;}();function construct_svelte_component(component,props){return new component(props);}// we need to store the information for multiple documents because a Svelte application could also contain iframes
// https://github.com/sveltejs/svelte/issues/3624
var managed_styles=new Map();var active=0;// https://github.com/darkskyapp/string-hash/blob/master/index.js
function hash(str){var hash=5381;var i=str.length;while(i--)hash=(hash<<5)-hash^str.charCodeAt(i);return hash>>>0;}function create_style_information(doc,node){var info={stylesheet:append_empty_stylesheet(node),rules:{}};managed_styles.set(doc,info);return info;}function create_rule(node,a,b,duration,delay,ease,fn){var uid=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var step=16.666/duration;var keyframes='{\n';for(var p=0;p<=1;p+=step){var _t=a+(b-a)*ease(p);keyframes+=p*100+"%{".concat(fn(_t,1-_t),"}\n");}var rule=keyframes+"100% {".concat(fn(b,1-b),"}\n}");var name="__svelte_".concat(hash(rule),"_").concat(uid);var doc=get_root_for_style(node);var _ref56=managed_styles.get(doc)||create_style_information(doc,node),stylesheet=_ref56.stylesheet,rules=_ref56.rules;if(!rules[name]){rules[name]=true;stylesheet.insertRule("@keyframes ".concat(name," ").concat(rule),stylesheet.cssRules.length);}var animation=node.style.animation||'';node.style.animation="".concat(animation?"".concat(animation,", "):'').concat(name," ").concat(duration,"ms linear ").concat(delay,"ms 1 both");active+=1;return name;}function delete_rule(node,name){var previous=(node.style.animation||'').split(', ');var next=previous.filter(name?function(anim){return anim.indexOf(name)<0;}// remove specific animation
:function(anim){return anim.indexOf('__svelte')===-1;}// remove all Svelte animations
);var deleted=previous.length-next.length;if(deleted){node.style.animation=next.join(', ');active-=deleted;if(!active)clear_rules();}}function clear_rules(){raf(function(){if(active)return;managed_styles.forEach(function(info){var ownerNode=info.stylesheet.ownerNode;// there is no ownerNode if it runs on jsdom.
if(ownerNode)detach(ownerNode);});managed_styles.clear();});}var current_component;function set_current_component(component){current_component=component;}function get_current_component(){if(!current_component)throw new Error('Function called outside component initialization');return current_component;}/**
 * The `onMount` function schedules a callback to run as soon as the component has been mounted to the DOM.
 * It must be called during the component's initialisation (but doesn't need to live *inside* the component;
 * it can be called from an external module).
 *
 * `onMount` does not run inside a [server-side component](/docs#run-time-server-side-component-api).
 *
 * https://svelte.dev/docs#run-time-svelte-onmount
 */function onMount(fn){get_current_component().$$.on_mount.push(fn);}/**
 * Schedules a callback to run immediately after the component has been updated.
 *
 * The first time the callback runs will be after the initial `onMount`
 */function afterUpdate(fn){get_current_component().$$.after_update.push(fn);}/**
 * Schedules a callback to run immediately before the component is unmounted.
 *
 * Out of `onMount`, `beforeUpdate`, `afterUpdate` and `onDestroy`, this is the
 * only one that runs inside a server-side component.
 *
 * https://svelte.dev/docs#run-time-svelte-ondestroy
 */function onDestroy(fn){get_current_component().$$.on_destroy.push(fn);}/**
 * Creates an event dispatcher that can be used to dispatch [component events](/docs#template-syntax-component-directives-on-eventname).
 * Event dispatchers are functions that can take two arguments: `name` and `detail`.
 *
 * Component events created with `createEventDispatcher` create a
 * [CustomEvent](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent).
 * These events do not [bubble](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events#Event_bubbling_and_capture).
 * The `detail` argument corresponds to the [CustomEvent.detail](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/detail)
 * property and can contain any type of data.
 *
 * https://svelte.dev/docs#run-time-svelte-createeventdispatcher
 */function createEventDispatcher(){var component=get_current_component();return function(type,detail){var _ref57=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref57$cancelable=_ref57.cancelable,cancelable=_ref57$cancelable===void 0?false:_ref57$cancelable;var callbacks=component.$$.callbacks[type];if(callbacks){// TODO are there situations where events could be dispatched
// in a server (non-DOM) environment?
var event=custom_event(type,detail,{cancelable:cancelable});callbacks.slice().forEach(function(fn){fn.call(component,event);});return!event.defaultPrevented;}return true;};}/**
 * Associates an arbitrary `context` object with the current component and the specified `key`
 * and returns that object. The context is then available to children of the component
 * (including slotted content) with `getContext`.
 *
 * Like lifecycle functions, this must be called during component initialisation.
 *
 * https://svelte.dev/docs#run-time-svelte-setcontext
 */function setContext(key,context){get_current_component().$$.context.set(key,context);return context;}/**
 * Retrieves the context that belongs to the closest parent component with the specified `key`.
 * Must be called during component initialisation.
 *
 * https://svelte.dev/docs#run-time-svelte-getcontext
 */function getContext(key){return get_current_component().$$.context.get(key);}// TODO figure out if we still want to support
// shorthand events, or if we want to implement
// a real bubbling mechanism
function bubble(component,event){var _this2=this;var callbacks=component.$$.callbacks[event.type];if(callbacks){// @ts-ignore
callbacks.slice().forEach(function(fn){return fn.call(_this2,event);});}}var dirty_components=[];var binding_callbacks=[];var render_callbacks=[];var flush_callbacks=[];var resolved_promise=Promise.resolve();var update_scheduled=false;function schedule_update(){if(!update_scheduled){update_scheduled=true;resolved_promise.then(flush);}}function tick$1(){schedule_update();return resolved_promise;}function add_render_callback(fn){render_callbacks.push(fn);}function add_flush_callback(fn){flush_callbacks.push(fn);}// flush() calls callbacks in this order:
// 1. All beforeUpdate callbacks, in order: parents before children
// 2. All bind:this callbacks, in reverse order: children before parents.
// 3. All afterUpdate callbacks, in order: parents before children. EXCEPT
//    for afterUpdates called during the initial onMount, which are called in
//    reverse order: children before parents.
// Since callbacks might update component values, which could trigger another
// call to flush(), the following steps guard against this:
// 1. During beforeUpdate, any updated components will be added to the
//    dirty_components array and will cause a reentrant call to flush(). Because
//    the flush index is kept outside the function, the reentrant call will pick
//    up where the earlier call left off and go through all dirty components. The
//    current_component value is saved and restored so that the reentrant call will
//    not interfere with the "parent" flush() call.
// 2. bind:this callbacks cannot trigger new flush() calls.
// 3. During afterUpdate, any updated components will NOT have their afterUpdate
//    callback called a second time; the seen_callbacks set, outside the flush()
//    function, guarantees this behavior.
var seen_callbacks=new Set();var flushidx=0;// Do *not* move this inside the flush() function
function flush(){var saved_component=current_component;do{// first, call beforeUpdate functions
// and update components
while(flushidx<dirty_components.length){var component=dirty_components[flushidx];flushidx++;set_current_component(component);update(component.$$);}set_current_component(null);dirty_components.length=0;flushidx=0;while(binding_callbacks.length)binding_callbacks.pop()();// then, once components are updated, call
// afterUpdate functions. This may cause
// subsequent updates...
for(var i=0;i<render_callbacks.length;i+=1){var callback=render_callbacks[i];if(!seen_callbacks.has(callback)){// ...so guard against infinite loops
seen_callbacks.add(callback);callback();}}render_callbacks.length=0;}while(dirty_components.length);while(flush_callbacks.length){flush_callbacks.pop()();}update_scheduled=false;seen_callbacks.clear();set_current_component(saved_component);}function update($$){if($$.fragment!==null){$$.update();run_all($$.before_update);var dirty=$$.dirty;$$.dirty=[-1];$$.fragment&&$$.fragment.p($$.ctx,dirty);$$.after_update.forEach(add_render_callback);}}var promise;function wait(){if(!promise){promise=Promise.resolve();promise.then(function(){promise=null;});}return promise;}function dispatch(node,direction,kind){node.dispatchEvent(custom_event("".concat(direction?'intro':'outro').concat(kind)));}var outroing=new Set();var outros;function group_outros(){outros={r:0,c:[],p:outros// parent group
};}function check_outros(){if(!outros.r){run_all(outros.c);}outros=outros.p;}function transition_in(block,local){if(block&&block.i){outroing["delete"](block);block.i(local);}}function transition_out(block,local,detach,callback){if(block&&block.o){if(outroing.has(block))return;outroing.add(block);outros.c.push(function(){outroing["delete"](block);if(callback){if(detach)block.d(1);callback();}});block.o(local);}else if(callback){callback();}}var null_transition={duration:0};function create_bidirectional_transition(node,fn,params,intro){var config=fn(node,params);var t=intro?0:1;var running_program=null;var pending_program=null;var animation_name=null;function clear_animation(){if(animation_name)delete_rule(node,animation_name);}function init(program,duration){var d=program.b-t;duration*=Math.abs(d);return{a:t,b:program.b,d:d,duration:duration,start:program.start,end:program.start+duration,group:program.group};}function go(b){var _ref58=config||null_transition,_ref58$delay=_ref58.delay,delay=_ref58$delay===void 0?0:_ref58$delay,_ref58$duration=_ref58.duration,duration=_ref58$duration===void 0?300:_ref58$duration,_ref58$easing=_ref58.easing,easing=_ref58$easing===void 0?identity:_ref58$easing,_ref58$tick=_ref58.tick,tick=_ref58$tick===void 0?noop:_ref58$tick,css=_ref58.css;var program={start:now()+delay,b:b};if(!b){// @ts-ignore todo: improve typings
program.group=outros;outros.r+=1;}if(running_program||pending_program){pending_program=program;}else{// if this is an intro, and there's a delay, we need to do
// an initial tick and/or apply CSS animation immediately
if(css){clear_animation();animation_name=create_rule(node,t,b,duration,delay,easing,css);}if(b)tick(0,1);running_program=init(program,duration);add_render_callback(function(){return dispatch(node,b,'start');});loop(function(now){if(pending_program&&now>pending_program.start){running_program=init(pending_program,duration);pending_program=null;dispatch(node,running_program.b,'start');if(css){clear_animation();animation_name=create_rule(node,t,running_program.b,running_program.duration,0,easing,config.css);}}if(running_program){if(now>=running_program.end){tick(t=running_program.b,1-t);dispatch(node,running_program.b,'end');if(!pending_program){// we're done
if(running_program.b){// intro — we can tidy up immediately
clear_animation();}else{// outro — needs to be coordinated
if(! --running_program.group.r)run_all(running_program.group.c);}}running_program=null;}else if(now>=running_program.start){var p=now-running_program.start;t=running_program.a+running_program.d*easing(p/running_program.duration);tick(t,1-t);}}return!!(running_program||pending_program);});}}return{run:function run(b){if(is_function(config)){wait().then(function(){// @ts-ignore
config=config();go(b);});}else{go(b);}},end:function end(){clear_animation();running_program=pending_program=null;}};}var globals=typeof window!=='undefined'?window:typeof globalThis!=='undefined'?globalThis:global;function destroy_block(block,lookup){block.d(1);lookup["delete"](block.key);}function outro_and_destroy_block(block,lookup){transition_out(block,1,1,function(){lookup["delete"](block.key);});}function update_keyed_each(old_blocks,dirty,get_key,dynamic,ctx,list,lookup,node,destroy,create_each_block,next,get_context){var o=old_blocks.length;var n=list.length;var i=o;var old_indexes={};while(i--)old_indexes[old_blocks[i].key]=i;var new_blocks=[];var new_lookup=new Map();var deltas=new Map();i=n;while(i--){var child_ctx=get_context(ctx,list,i);var key=get_key(child_ctx);var block=lookup.get(key);if(!block){block=create_each_block(key,child_ctx);block.c();}else if(dynamic){block.p(child_ctx,dirty);}new_lookup.set(key,new_blocks[i]=block);if(key in old_indexes)deltas.set(key,Math.abs(i-old_indexes[key]));}var will_move=new Set();var did_move=new Set();function insert(block){transition_in(block,1);block.m(node,next);lookup.set(block.key,block);next=block.first;n--;}while(o&&n){var new_block=new_blocks[n-1];var old_block=old_blocks[o-1];var new_key=new_block.key;var old_key=old_block.key;if(new_block===old_block){// do nothing
next=new_block.first;o--;n--;}else if(!new_lookup.has(old_key)){// remove old block
destroy(old_block,lookup);o--;}else if(!lookup.has(new_key)||will_move.has(new_key)){insert(new_block);}else if(did_move.has(old_key)){o--;}else if(deltas.get(new_key)>deltas.get(old_key)){did_move.add(new_key);insert(new_block);}else{will_move.add(old_key);o--;}}while(o--){var _old_block=old_blocks[o];if(!new_lookup.has(_old_block.key))destroy(_old_block,lookup);}while(n)insert(new_blocks[n-1]);return new_blocks;}function get_spread_update(levels,updates){var update={};var to_null_out={};var accounted_for={$$scope:1};var i=levels.length;while(i--){var o=levels[i];var n=updates[i];if(n){for(var key in o){if(!(key in n))to_null_out[key]=1;}for(var _key2 in n){if(!accounted_for[_key2]){update[_key2]=n[_key2];accounted_for[_key2]=1;}}levels[i]=n;}else{for(var _key3 in o){accounted_for[_key3]=1;}}}for(var _key4 in to_null_out){if(!(_key4 in update))update[_key4]=undefined;}return update;}function get_spread_object(spread_props){return _typeof(spread_props)==='object'&&spread_props!==null?spread_props:{};}function bind(component,name,callback){var index=component.$$.props[name];if(index!==undefined){component.$$.bound[index]=callback;callback(component.$$.ctx[index]);}}function create_component(block){block&&block.c();}function mount_component(component,target,anchor,customElement){var _component$$$=component.$$,fragment=_component$$$.fragment,after_update=_component$$$.after_update;fragment&&fragment.m(target,anchor);if(!customElement){// onMount happens before the initial afterUpdate
add_render_callback(function(){var new_on_destroy=component.$$.on_mount.map(run).filter(is_function);// if the component was destroyed immediately
// it will update the `$$.on_destroy` reference to `null`.
// the destructured on_destroy may still reference to the old array
if(component.$$.on_destroy){var _component$$$$on_dest;(_component$$$$on_dest=component.$$.on_destroy).push.apply(_component$$$$on_dest,_toConsumableArray(new_on_destroy));}else{// Edge case - component was destroyed immediately,
// most likely as a result of a binding initialising
run_all(new_on_destroy);}component.$$.on_mount=[];});}after_update.forEach(add_render_callback);}function destroy_component(component,detaching){var $$=component.$$;if($$.fragment!==null){run_all($$.on_destroy);$$.fragment&&$$.fragment.d(detaching);// TODO null out other refs, including component.$$ (but need to
// preserve final state?)
$$.on_destroy=$$.fragment=null;$$.ctx=[];}}function make_dirty(component,i){if(component.$$.dirty[0]===-1){dirty_components.push(component);schedule_update();component.$$.dirty.fill(0);}component.$$.dirty[i/31|0]|=1<<i%31;}function init(component,options,instance,create_fragment,not_equal,props,append_styles){var dirty=arguments.length>7&&arguments[7]!==undefined?arguments[7]:[-1];var parent_component=current_component;set_current_component(component);var $$=component.$$={fragment:null,ctx:[],// state
props:props,update:noop,not_equal:not_equal,bound:blank_object(),// lifecycle
on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(options.context||(parent_component?parent_component.$$.context:[])),// everything else
callbacks:blank_object(),dirty:dirty,skip_bound:false,root:options.target||parent_component.$$.root};append_styles&&append_styles($$.root);var ready=false;$$.ctx=instance?instance(component,options.props||{},function(i,ret){var value=(arguments.length<=2?0:arguments.length-2)?arguments.length<=2?undefined:arguments[2]:ret;if($$.ctx&&not_equal($$.ctx[i],$$.ctx[i]=value)){if(!$$.skip_bound&&$$.bound[i])$$.bound[i](value);if(ready)make_dirty(component,i);}return ret;}):[];$$.update();ready=true;run_all($$.before_update);// `false` as a special case of no DOM component
$$.fragment=create_fragment?create_fragment($$.ctx):false;if(options.target){if(options.hydrate){var nodes=children(options.target);// eslint-disable-next-line @typescript-eslint/no-non-null-assertion
$$.fragment&&$$.fragment.l(nodes);nodes.forEach(detach);}else{// eslint-disable-next-line @typescript-eslint/no-non-null-assertion
$$.fragment&&$$.fragment.c();}if(options.intro)transition_in(component.$$.fragment);mount_component(component,options.target,options.anchor,options.customElement);flush();}set_current_component(parent_component);}/**
 * Base class for Svelte components. Used when dev=false.
 */var SvelteComponent=/*#__PURE__*/function(){function SvelteComponent(){_classCallCheck(this,SvelteComponent);}_createClass(SvelteComponent,[{key:"$destroy",value:function $destroy(){destroy_component(this,1);this.$destroy=noop;}},{key:"$on",value:function $on(type,callback){if(!is_function(callback)){return noop;}var callbacks=this.$$.callbacks[type]||(this.$$.callbacks[type]=[]);callbacks.push(callback);return function(){var index=callbacks.indexOf(callback);if(index!==-1)callbacks.splice(index,1);};}},{key:"$set",value:function $set($$props){if(this.$$set&&!is_empty($$props)){this.$$.skip_bound=true;this.$$set($$props);this.$$.skip_bound=false;}}}]);return SvelteComponent;}();var subscriber_queue=[];/**
 * Creates a `Readable` store that allows reading by subscription.
 * @param value initial value
 * @param {StartStopNotifier}start start and stop notifications for subscriptions
 */function readable(value,start){return{subscribe:writable(value,start).subscribe};}/**
 * Create a `Writable` store that allows both updating and reading by subscription.
 * @param {*=}value initial value
 * @param {StartStopNotifier=}start start and stop notifications for subscriptions
 */function writable(value){var start=arguments.length>1&&arguments[1]!==undefined?arguments[1]:noop;var stop;var subscribers=new Set();function set(new_value){if(safe_not_equal(value,new_value)){value=new_value;if(stop){// store is ready
var run_queue=!subscriber_queue.length;var _iterator5=_createForOfIteratorHelper(subscribers),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var subscriber=_step5.value;subscriber[1]();subscriber_queue.push(subscriber,value);}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}if(run_queue){for(var i=0;i<subscriber_queue.length;i+=2){subscriber_queue[i][0](subscriber_queue[i+1]);}subscriber_queue.length=0;}}}}function update(fn){set(fn(value));}function subscribe(run){var invalidate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:noop;var subscriber=[run,invalidate];subscribers.add(subscriber);if(subscribers.size===1){stop=start(set)||noop;}run(value);return function(){subscribers["delete"](subscriber);if(subscribers.size===0){stop();stop=null;}};}return{set:set,update:update,subscribe:subscribe};}function derived(stores,fn,initial_value){var single=!Array.isArray(stores);var stores_array=single?[stores]:stores;var auto=fn.length<2;return readable(initial_value,function(set){var inited=false;var values=[];var pending=0;var cleanup=noop;var sync=function sync(){if(pending){return;}cleanup();var result=fn(single?values[0]:values,set);if(auto){set(result);}else{cleanup=is_function(result)?result:noop;}};var unsubscribers=stores_array.map(function(store,i){return subscribe(store,function(value){values[i]=value;pending&=~(1<<i);if(inited){sync();}},function(){pending|=1<<i;});});inited=true;sync();return function stop(){run_all(unsubscribers);cleanup();};});}var mergeObjects=function mergeObjects(objects){return objects.reduce(function(prev,curr){return Object.assign(prev,curr);},{});};// @ts-ignore
var UPDATE_VALUE=function UPDATE_VALUE(updateValue){return{updateValue:updateValue};};var DEFAULT_VALUE=function DEFAULT_VALUE(defaultValue){return{defaultValue:defaultValue};};var CUSTOM_STORE=function CUSTOM_STORE(fn){return{store:fn};};// @ts-ignore (fixes error thrown in karma typescript)
var DERIVED_STORE=function DERIVED_STORE(fn){return{store:function store(defaultValue,stores){return derived.apply(void 0,_toConsumableArray(fn(stores)));}};};var UNIQUE_DERIVED_STORE=function UNIQUE_DERIVED_STORE(fn){return{store:function store(defaultValue,stores){var _fn=fn(stores),_fn2=_slicedToArray(_fn,3),selectedStores=_fn2[0],update=_fn2[1],_fn2$=_fn2[2],isEqual=_fn2$===void 0?function(){return false;}:_fn2$;var isFirst=true;var currentValue;return derived(selectedStores,function(storeValues,set){update(storeValues,function(value){if(!isFirst&&isEqual(currentValue,value))return;currentValue=value;isFirst=false;set(value);});});}};};var MAP_STORE=function MAP_STORE(fn){return{store:function store(defaultValue,stores){var _fn3=fn(stores),_fn4=_slicedToArray(_fn3,3),valueMapper=_fn4[0],_fn4$=_fn4[1],observedStores=_fn4$===void 0?{}:_fn4$,_fn4$2=_fn4[2],sorter=_fn4$2===void 0?undefined:_fn4$2;var storedItems=[];var $observedStores={};var mapValue=function mapValue(item){return valueMapper(item,$observedStores);};// set default properties for each item
var setValue=function setValue(items){// was empty, still empty
if(!storedItems.length&&!items.length)return;// update value
storedItems=items;updateValue();};var updateValue=function updateValue(){var mappedItems=storedItems.map(mapValue);if(sorter)mappedItems.sort(sorter);storedItems=_toConsumableArray(mappedItems);set(mappedItems);};// TODO: need to at some point unsub from these stores
Object.entries(observedStores).map(function(_ref59){var _ref60=_slicedToArray(_ref59,2),name=_ref60[0],store=_ref60[1];return store.subscribe(function(value){$observedStores[name]=value;if(!value)return;updateValue();});});var _writable=writable(defaultValue||[]),subscribe=_writable.subscribe,set=_writable.set;return{set:setValue,update:function update(fn){return setValue(fn(storedItems));},subscribe:subscribe};}};};var createStore$1=function createStore$1(accessors,stores,options){var _options$store=options.store,store=_options$store===void 0?function(defaultValue){return writable(defaultValue);}:_options$store,_options$defaultValue=options.defaultValue,defaultValue=_options$defaultValue===void 0?noop$1:_options$defaultValue,_options$updateValue=options.updateValue,updateValue=_options$updateValue===void 0?undefined:_options$updateValue;// create our private store
var storeInstance=store(defaultValue(),stores,accessors);var subscribe=storeInstance.subscribe,_storeInstance$update=storeInstance.update,update=_storeInstance$update===void 0?noop$1:_storeInstance$update;// update = noop because not all stores can be updated
// on update private store
var unsub;var onUpdate=function onUpdate(cb){var ignoreFirstCallback=true;if(unsub)unsub();unsub=subscribe(function(value){// need to ignore first callback because that returns current value
if(ignoreFirstCallback)return ignoreFirstCallback=false;// now we have the newly assigned value
cb(value);unsub();unsub=undefined;});};// create the value updater function, needs access to stores so can read all store values
var updateStoreValue=updateValue?updateValue(accessors):passthrough;// set and validate value
storeInstance.set=function(nextValue){return update(function(previousValue){return updateStoreValue(nextValue,previousValue,onUpdate);});};// set default value for external reference
storeInstance.defaultValue=defaultValue;// expose store api
return storeInstance;};var createStores=function createStores(props){var stores={};var accessors={};props.forEach(function(_ref61){var _ref62=_toArray(_ref61),name=_ref62[0],options=_ref62.slice(1);var opts=mergeObjects(options);var store=stores[name]=createStore$1(accessors,stores,opts);var property={get:function get(){return get_store_value(store);},set:store.set};Object.defineProperty(accessors,name,property);});return{stores:stores,accessors:accessors};};// custom source store so we only trigger update when src changes
var sourceStore=function sourceStore(){// inner value
var value;var _writable2=writable(),subscribe=_writable2.subscribe,set=_writable2.set;var _set=function _set(newValue){// is equal, bounce!
if(value===newValue)return;value=newValue;set(value);};var _update=function _update(fn){return _set(fn(value));};return{set:_set,subscribe:subscribe,update:_update};};var props=[// io
['src',CUSTOM_STORE(sourceStore)],['imageReader'],['imageWriter'],// will scramble image data for use with image redaction logic
['imageScrambler'],// current images
['images',DEFAULT_VALUE(function(){return[];})],// will process markup items before rendering, used by arrows and frames
['shapePreprocessor'],// will be called when requesting a resource, return false to prevent loading, receives URL and XHR
['willRequestResource']/* deprecated */,// will be called when requesting a resource, receives URL and requestType
// return false to prevent loading
// return object with options to update request
// return undefined to continue as normal
['willRequest']];var capitalizeFirstLetter=function capitalizeFirstLetter(str){return str.charAt(0).toUpperCase()+str.slice(1);};var defineMethods=function defineMethods(object,api){Object.keys(api).forEach(function(name){var descriptor=isFunction(api[name])?{value:api[name],writable:false}:api[name];Object.defineProperty(object,name,descriptor);});};// TODO: replace with pointInPoly from geom, this function works correctly with "offsetRectToFitPolygon" but doesn't always work correctly, the pointInPoly from geom does work correctly but causes offsetRectToFitPolygon to sometimes work incorrectly, needs to be cleaned up in the future
var pointInPoly=function pointInPoly(point,vertices){var i;var a;var b;var aX;var aY;var bX;var bY;var edgeX;var edgeY;var d;var l=vertices.length;for(i=0;i<l;i++){// current vertex
a=vertices[i];// next vertex
b=vertices[i+1>l-1?0:i+1];// translate so that point is the origin of the calculation
aX=a.x-point.x;aY=a.y-point.y;bX=b.x-point.x;bY=b.y-point.y;edgeX=aX-bX;edgeY=aY-bY;d=edgeX*aY-edgeY*aX;// 0 is ON the edge, but we check for -0.00001 to fix floating point errors
if(d<-0.00001)return false;}return true;};var scalar=10000;var offsetRectToFitPolygon=function offsetRectToFitPolygon(rect,poly){var polyLines=quadLines(poly);var offset=vectorCreateEmpty();var rectVertexes=rectGetCorners(rect);// we can fit it
rectVertexes.forEach(function(vertex){// we update each corner by adding the current offset
vectorAdd(vertex,offset);// test if point lies in polygon, if so, all is fine and we can exit
if(pointInPoly(vertex,poly))return;polyLines.forEach(function(line){// get angle of edge and draw a ray from the corner perpendicular to the edge
var a=Math.atan2(line.start.y-line.end.y,line.start.x-line.end.x);var x=Math.sin(Math.PI-a)*scalar;var y=Math.cos(Math.PI-a)*scalar;var ray=vectorCreate(vertex.x+x,vertex.y+y);// extend the poly line so even if we overshoot the polygon we hit it
var lineExtended=lineExtend(lineClone(line),scalar);// get the resulting intersection (there's always an intersection)
var intersection=lineLineIntersection(lineCreate(vertex,ray),lineExtended);// no intersection, no need to do anything
if(!intersection)return;// update offset to move towards image
vectorAdd(offset,vectorSubtract(vectorClone(intersection),vertex));});});// test if any vertexes still fall outside of poly, if so, we can't fit the rect
var rectOffset=rectClone$1(rect);vectorAdd(rectOffset,offset);var rectOffsetVertices=rectGetCorners(rectOffset);var fits=rectOffsetVertices.every(function(vertex){return pointInPoly(vertex,poly);});if(fits){rectUpdateWithRect(rect,rectOffset);return true;}return false;};var limitCropRectToImage=function limitCropRectToImage(rect,poly){// get crop rect polygon vertexes
var rectVertexes=rectGetCorners(rect);// if we end up here it doesn't fit, we might need to adjust
var polyLines=quadToLines(poly,5);var rectCenterPosition=rectCenter(rect);var intersections=[];rectVertexes.forEach(function(rectVertex){var ray=lineMultiply(lineCreate(vectorClone(rectCenterPosition),vectorClone(rectVertex)),1000000);var intersectionFound=false;polyLines.map(lineClone).forEach(function(line){var intersection=lineLineIntersection(ray,line);if(!intersection||intersectionFound)return;intersections.push(intersection);intersectionFound=true;});});// top left -> bottom right
var tlbr=vectorDistance(intersections[0],intersections[2]);// top right -> bottom left
var trbl=vectorDistance(intersections[1],intersections[3]);// calculate smallest rectangle we can make, use that
var rectLimitedVertices=tlbr<trbl?[intersections[0],intersections[2]]:[intersections[1],intersections[3]];var rectLimitedToPolygon=rectCreateFromPoints(rectLimitedVertices);// only use our fitted crop rectangle if it's smaller than our current rectangle,
// this would mean that our current rectangle couldn't be moved to make it fit
if(rectLimitedToPolygon.width<rect.width){// need to center on previous rect
rectUpdateWithRect(rect,rectLimitedToPolygon);return true;}return false;};var getImagePolygon=function getImagePolygon(image,imageRotation){var imagePerspective=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{x:0,y:0};var imageRect=rectCreateFromSize(image);var imageCenter=rectCenter(imageRect);var imagePoly=rectApplyPerspective(imageRect,imagePerspective,imageCenter).map(function(imageVertex){return vectorRotate(imageVertex,imageRotation,imageCenter);});// get image poly bounds, we need this to offset the poly vertices from 0,0
var imagePolyBounds=rectCreateFromPoints(imagePoly);// get image polygon vertexes
return imagePoly.map(function(imageVertex){return vectorSubtract(imageVertex,imagePolyBounds);});};var getMaxSizeInRect=function getMaxSizeInRect(size){var rotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var aspectRatio=arguments.length>2&&arguments[2]!==undefined?arguments[2]:rectAspectRatio(size);var width;var height;if(rotation!==0){var innerAngle=Math.atan2(1,aspectRatio);var rotationSigned=Math.sign(rotation)*rotation;var rotationSignedMod=rotationSigned%Math.PI;var rotationSignedModHalf=rotationSigned%HALF_PI;// determine if is turned on side
var _r4;if(rotationSignedMod>QUART_PI&&rotationSignedMod<HALF_PI+QUART_PI){_r4=rotationSignedModHalf>QUART_PI?rotationSigned:HALF_PI-rotationSignedModHalf;}else{_r4=rotationSignedModHalf>QUART_PI?HALF_PI-rotationSignedModHalf:rotationSigned;}var hyp=Math.min(Math.abs(size.height/Math.sin(innerAngle+_r4)),Math.abs(size.width/Math.cos(innerAngle-_r4)));width=Math.cos(innerAngle)*hyp;height=width/aspectRatio;}else{width=size.width;height=width/aspectRatio;if(height>size.height){height=size.height;width=height*aspectRatio;}}return sizeCreate(width,height);};var limitRectToImage=function limitRectToImage(rect,imageSize){var imageRotation=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var imagePerspective=arguments.length>3&&arguments[3]!==undefined?arguments[3]:vectorCreateEmpty();var minSize=arguments.length>4?arguments[4]:undefined;// rotation and/or perspective, let's use the "advanced" collision detection method
if(isNumber(imageRotation)&&imageRotation!==0||imagePerspective.x||imagePerspective.y){var inputAspectRatio=rectAspectRatio(rect);// test if crop can fit image, if it can, offset the crop so it fits
var imagePolygon=getImagePolygon(imageSize,imageRotation,imagePerspective);var maxSizeInRect=getMaxSizeInRect(imageSize,imageRotation,inputAspectRatio);var canFit=rect.width<maxSizeInRect.width&&rect.height<maxSizeInRect.height;if(!canFit){var dx=rect.width*0.5-maxSizeInRect.width*0.5;var dy=rect.height*0.5-maxSizeInRect.height*0.5;// adjust crop rect to max size
if(rect.width>maxSizeInRect.width){rect.width=maxSizeInRect.width;rect.x+=dx;}if(rect.height>maxSizeInRect.height){rect.height=maxSizeInRect.height;rect.y+=dy;}// test if has exceeded min size, if so we need to limit the size and recalculate the other edge
/*
                        -\
                       /  ---\
                      h2      ---\
                     /            ---\
                    +--------w---------+\
                   /|                  | ---\
                  / |                  |     ---\
                 /  |                  |         ---\
                /   |                  |             --
               h1   |                  |             /
              /     |                  |            /
             /      |                  |           /
            -\      |                  |          /
              ---\  |                  |         /
                  --+------------------+        /
                      ---\                     /
                          --\                 /
                             ---\            /
                                 ---\       /
                                     ---\  /
                                         --
            */}offsetRectToFitPolygon(rect,imagePolygon);var wasLimited=limitCropRectToImage(rect,imagePolygon);// this makes sure that after limiting the size, the crop rect is moved to a position that is inside the image
if(wasLimited)offsetRectToFitPolygon(rect,imagePolygon);}// no rotation, no perspective, use simple bounds method
else{// remember intended aspect ratio so we can try and recreate it
var intendedAspectRatio=rectAspectRatio(rect);// limit to image size first, can never exceed that
rect.width=Math.min(rect.width,imageSize.width);rect.height=Math.min(rect.height,imageSize.height);// reposition rect so it's always inside image bounds
rect.x=Math.max(rect.x,0);if(rect.x+rect.width>imageSize.width){rect.x-=rect.x+rect.width-imageSize.width;}rect.y=Math.max(rect.y,0);if(rect.y+rect.height>imageSize.height){rect.y-=rect.y+rect.height-imageSize.height;}// we get the center of the current rect so we can center the contained rect to it
var intendedCenter=rectCenter(rect);// make sure still adheres to aspect ratio
var containedRect=rectContainRect(rect,intendedAspectRatio);containedRect.width=Math.max(minSize.width,containedRect.width);containedRect.height=Math.max(minSize.height,containedRect.height);containedRect.x=intendedCenter.x-containedRect.width*0.5;containedRect.y=intendedCenter.y-containedRect.height*0.5;rectUpdateWithRect(rect,containedRect);}};var applyCropRectAction=function applyCropRectAction(cropRectPrevious,cropRectNext,imageSize,imageRotation,imagePerspective,cropLimitToImageBounds,cropMinSize,cropMaxSize){// clone
var minSize=sizeClone(cropMinSize);// set upper bounds to crop max size
var maxSize=sizeClone(cropMaxSize);// limit max size (more important that min size is respected so first limit max size)
var maxScalar=fixPrecision(Math.max(cropRectNext.width/maxSize.width,cropRectNext.height/maxSize.height));var minScalar=fixPrecision(Math.min(cropRectNext.width/minSize.width,cropRectNext.height/minSize.height));// clone for resulting crop rect
var cropRectOut=rectClone$1(cropRectNext);//
// if exceeds min or max scale correct next crop rectangle to conform to bounds
//
if(minScalar<1||maxScalar>1){// center of both previous and next crop rects
var previousCropRectCenter=rectCenter(cropRectPrevious);var nextCropRectCenter=rectCenter(cropRectNext);// calculate scales
var _scalar3=minScalar<1?minScalar:maxScalar;var cx=(nextCropRectCenter.x+previousCropRectCenter.x)/2;var cy=(nextCropRectCenter.y+previousCropRectCenter.y)/2;var cw=cropRectOut.width/_scalar3;var ch=cropRectOut.height/_scalar3;rectUpdate(cropRectOut,cx-cw*0.5,cy-ch*0.5,cw,ch);}// no need to limit to bounds, let's go!
if(!cropLimitToImageBounds)return{crop:cropRectOut};//
// make sure the crop is made inside the bounds of the image
//
limitRectToImage(cropRectOut,imageSize,imageRotation,imagePerspective,minSize);return{crop:cropRectOut};};var getBaseCropRect=function getBaseCropRect(imageSize,transformedCropRect,imageRotation){var imageRect=rectCreateFromSize(imageSize);var imageCenter=rectCenter(imageRect);var imageTransformedVertices=rectRotate(imageRect,imageRotation,imageCenter);// get the rotated image bounds center (offset isn't relevant as crop is relative to top left image position)
var imageRotatedBoundsCenter=rectCenter(rectNormalizeOffset(rectCreateFromPoints(imageTransformedVertices)));// get the center of the crop inside the rotated image
var cropCenterInTransformedImage=rectCenter(transformedCropRect);// invert the rotation of the crop center around the rotated image center
var deRotatedCropCenter=vectorRotate(cropCenterInTransformedImage,-imageRotation,imageRotatedBoundsCenter);// calculate crop distance from rotated image center
var cropFromCenterOfTransformedImage=vectorSubtract(deRotatedCropCenter,imageRotatedBoundsCenter);// calculate original crop offset (from untransformed image)
var originalCropCenterOffset=vectorApply(vectorAdd(imageCenter,cropFromCenterOfTransformedImage),fixPrecision);return rectCreate(originalCropCenterOffset.x-transformedCropRect.width*0.5,originalCropCenterOffset.y-transformedCropRect.height*0.5,transformedCropRect.width,transformedCropRect.height);};var clamp=function clamp(value,min,max){return Math.max(min,Math.min(value,max));};var applyRotationAction=function applyRotationAction(imageRotationPrevious,imageRotation,imageRotationRange,cropRect,imageSize,imagePerspective,cropLimitToImageBounds,cropRectOrigin,cropMinSize,cropMaxSize){// clone
var minSize=sizeClone(cropMinSize);// set upper bounds to crop max size if image is bigger than max size,
// else if should limit to image bounds use image size as limit
var maxSize=sizeClone(cropMaxSize);if(cropLimitToImageBounds){maxSize.width=Math.min(cropMaxSize.width,imageSize.width);maxSize.height=Math.min(cropMaxSize.height,imageSize.height);}var didAttemptDoubleTurn=false;var rotate=function rotate(rotationPrevious,rotation){// get the base crop rect (position of crop rect in untransformed image)
// if we have the base crop rect we can apply the new rotation to it
var cropRectBase=getBaseCropRect(imageSize,cropRect,rotationPrevious);// calculate transforms based on new rotation and base crop rect
var imageRect=rectCreateFromSize(imageSize);var imageCenter=rectCenter(imageRect);var imageTransformedCorners=rectApplyPerspective(imageRect,imagePerspective,imageCenter);// need this to correct for perspective centroid displacement
var perspectiveOffset=vectorSubtract(vectorClone(imageCenter),convexPolyCentroid(imageTransformedCorners));// rotate around center of image
var cropCenter=vectorRotate(rectCenter(cropRectBase),rotation,imageCenter);var rotateCropOffset=vectorSubtract(vectorClone(imageCenter),cropCenter);// get center of image bounds and move to correct position
imageTransformedCorners.forEach(function(imageVertex){return vectorRotate(imageVertex,rotation,imageCenter);});var imageBoundsRect=rectCreateFromPoints(imageTransformedCorners);var imageCentroid=convexPolyCentroid(imageTransformedCorners);var cropOffset=vectorAdd(vectorSubtract(vectorSubtract(imageCentroid,rotateCropOffset),imageBoundsRect),perspectiveOffset);// create output cropRect
var cropRectOut=rectCreate(cropOffset.x-cropRectBase.width*0.5,cropOffset.y-cropRectBase.height*0.5,cropRectBase.width,cropRectBase.height);// if has size target, scale croprect to target size
if(cropRectOrigin){rectScale$1(cropRectOut,cropRectOrigin.width/cropRectOut.width);}// if should limit to image bounds
if(cropLimitToImageBounds){var imagePoly=getImagePolygon(imageSize,rotation,imagePerspective);// offsetRectToFitPolygon(cropRectOut, imagePoly);
// commenting this fixes poly sliding problem when adjusting rotation
limitCropRectToImage(cropRectOut,imagePoly);}//#region if exceeds min or max adjust rotation to conform to bounds
var minScalar=fixPrecision(Math.min(cropRectOut.width/minSize.width,cropRectOut.height/minSize.height),8);var maxScalar=fixPrecision(Math.max(cropRectOut.width/maxSize.width,cropRectOut.height/maxSize.height),8);if(minScalar<1||maxScalar>1){// determine if is full image turn
var isTurn=fixPrecision(Math.abs(rotation-rotationPrevious))===fixPrecision(Math.PI/2);// try another turn if is turning image
if(isTurn&&!didAttemptDoubleTurn){didAttemptDoubleTurn=true;return rotate(imageRotationPrevious,imageRotationPrevious+Math.sign(rotation-rotationPrevious)*Math.PI);}}//#endregion
return{rotation:rotation,crop:rectApply(cropRectOut,function(v){return fixPrecision(v,8);})};};// amount of turns applied, we need this to correctly determine the allowed rotation range
var imageTurns=Math.sign(imageRotation)*Math.round(Math.abs(imageRotation)/HALF_PI)*HALF_PI;var imageRotationClamped=clamp(imageRotation,imageTurns+imageRotationRange[0],imageTurns+imageRotationRange[1]);// set new crop position
return rotate(imageRotationPrevious,imageRotationClamped);};// @ts-ignore
var ORDERED_STATE_PROPS=[// requirements
'cropLimitToImage','cropMinSize','cropMaxSize','cropAspectRatio',// selection -> flip -> rotate -> (perspective ->) crop
'flipX','flipY','rotation','crop',// effects
'colorMatrix','convolutionMatrix','gamma','vignette',// 'noise',
// shapes
'redaction','annotation','decoration','frame',// other
'backgroundColor','backgroundImage','targetSize','metadata',// video
'trim','volume'];var clone=function clone(value){if(isArray(value)){return value.map(clone);}else if(isBlob(value)||isFile(value)){return value;}else if(isObject(value)){return _objectSpread({},value);}return value;};var filterShapeState=function filterShapeState(shapes){return shapes.map(function(shape){return Object.entries(shape).reduce(function(copy,_ref63){var _ref64=_slicedToArray(_ref63,2),key=_ref64[0],value=_ref64[1];if(key.startsWith('_'))return copy;copy[key]=value;return copy;},{});});};var stateStore=function stateStore(_,stores,accessors){var observedStores=ORDERED_STATE_PROPS.map(function(key){return stores[key];});// used to wait with deriving state until new state is fully assigned
var isAssigningState=false;var forceState=writable({});// can only subscribe, setting is done directly through store accessors
// @ts-ignore (fixes error thrown in karma typescript)
var _derived=derived([].concat(_toConsumableArray(observedStores),[forceState]),function(values,set){// is setting state
if(isAssigningState)return;// create new state by looping over props in certain order
var state=ORDERED_STATE_PROPS.reduce(function(prev,curr,i){prev[curr]=clone(values[i]);return prev;},{});// round crop if defined
state.crop&&rectApply(state.crop,Math.round);// remove internal state props from decoration and annotation
state.redaction=state.redaction&&filterShapeState(state.redaction);state.annotation=state.annotation&&filterShapeState(state.annotation);state.decoration=state.decoration&&filterShapeState(state.decoration);// set new state
set(state);}),subscribe=_derived.subscribe;var setState=function setState(state){// requires at least some state to be supplied
if(!state)return;// now assigning state so don't derive state object untill done
isAssigningState=true;// make sure crop origin is reset
accessors.cropOrigin=undefined;// apply new values
ORDERED_STATE_PROPS// remove keys that weren't set
.filter(function(key){return hasProp(state,key);})// apply each key in order
.forEach(function(key){var value=state[key];accessors[key]=value===null?undefined:clone(value);});// now refresh state
isAssigningState=false;forceState.set({});};return{set:setState,update:function update(fn){return setState(fn(null));},subscribe:subscribe};};var toNumericAspectRatio=function toNumericAspectRatio(v){if(!v)return undefined;if(/:/.test(v)){var _v$split=v.split(':'),_v$split2=_slicedToArray(_v$split,2),w=_v$split2[0],_h=_v$split2[1];return w/_h;}return parseFloat(v);};var arrayEqual=function arrayEqual(a,b){if(a.length!==b.length)return false;for(var i=0;i<a.length;i++){if(a[i]!==b[i])return false;}return true;};var padColorArray=function padColorArray(){var color=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[0,0,0,0];var opacity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1.0;return color.length===4?color:[].concat(_toConsumableArray(color),[opacity]);};//
// helper methods
//
var isCropCentered=function isCropCentered(crop,imageSize,imageRotation){var cropCenter=vectorApply(rectCenter(crop),function(v){return fixPrecision(v,8);});var imageRect=rectCreateFromSize(imageSize);var imageCenter=rectCenter(imageRect);var imageRotatedVertices=rectRotate(imageRect,imageRotation,imageCenter);var imageBoundsCenter=vectorApply(sizeCenter(rectCreateFromPoints(imageRotatedVertices)),function(v){return fixPrecision(v,8);});var dx=Math.abs(imageBoundsCenter.x-cropCenter.x);var dy=Math.abs(imageBoundsCenter.y-cropCenter.y);return dx<1&&dy<1;};var isCropMaxSize=function isCropMaxSize(cropRect,imageSize,rotation){var maxSize=getMaxSizeInRect(imageSize,rotation,rectAspectRatio(cropRect));return sizeEqual(sizeApply(maxSize,Math.round),sizeApply(sizeClone(cropRect),Math.round));};//
// updater methods
//
var updateCropRect=function updateCropRect(props){return function(cropNext){var cropPrevious=arguments.length>1&&arguments[1]!==undefined?arguments[1]:cropNext;// wait for image to load
var loadState=props.loadState,size=props.size,cropMinSize=props.cropMinSize,cropMaxSize=props.cropMaxSize,cropLimitToImage=props.cropLimitToImage,cropAspectRatio=props.cropAspectRatio,rotation=props.rotation,perspective=props.perspective;// image hasn't loaded yet, use supplied crop rect
if(!cropNext&&!cropPrevious||!loadState||!loadState.beforeComplete)return cropNext;// crop previous set, crop next set to undefined, set crop to fit image
if(!cropNext)cropNext=rectCreateFromSize(getMaxSizeInRect(size,rotation,cropAspectRatio||rectAspectRatio(size)));// apply the action
var res=applyCropRectAction(cropPrevious,cropNext,size,rotation,perspective,cropLimitToImage,cropMinSize,cropMaxSize);var cropOut=rectApply(res.crop,function(v){return fixPrecision(v,8);});if(rectEqual(cropPrevious,cropOut))return cropPrevious;return cropOut;};};var updateCropAspectRatio=function updateCropAspectRatio(props){return function(aspectRatioNext,aspectRatioPrevious){var loadState=props.loadState,crop=props.crop,size=props.size,rotation=props.rotation,cropLimitToImage=props.cropLimitToImage;var aspectRatio=toNumericAspectRatio(aspectRatioNext);// no aspect ratio means custom aspect ratio so set to undefined
if(!aspectRatio)return undefined;// can't update crop if not defined yet
if(!crop||!loadState||!loadState.beforeComplete)return aspectRatio;// calculate difference between aspect ratios, if big difference, re-align in image
var aspectRatioDist=aspectRatioPrevious?Math.abs(aspectRatioNext-aspectRatioPrevious):1;// if crop centered scale up
if(isCropCentered(crop,size,rotation)&&cropLimitToImage&&aspectRatioDist>=0.1){var imageSize=sizeTurn(sizeClone(size),rotation);props.crop=rectApply(rectContainRect(rectCreateFromSize(imageSize),aspectRatioNext),fixPrecision);}else{var cropSize={width:crop.height*aspectRatio,height:crop.height};var tx=(crop.width-cropSize.width)*0.5;var ty=(crop.height-cropSize.height)*0.5;props.crop=rectApply(rectCreate(crop.x+tx,crop.y+ty,cropSize.width,cropSize.height),fixPrecision);}return aspectRatio;};};var updateCropLimitToImage=function updateCropLimitToImage(props){return function(limitToImageNext,limitToImagePrevious,onUpdate){// skip if no crop defined
var crop=props.crop;if(!crop)return limitToImageNext;// if was not limiting previously and now set limiting make sure crop fits bounds
if(!limitToImagePrevious&&limitToImageNext){onUpdate(function(){return props.crop=rectClone$1(props.crop);});}return limitToImageNext;};};var updateRotation=function updateRotation(props){return function(rotationNext,rotationPrevious,onUpdate){// when image rotation is updated we need to adjust the
// cropRect offset so rotation happens from cropRect center
// no change
if(rotationNext===rotationPrevious)return rotationNext;// get relevant data from store state
var loadState=props.loadState,size=props.size,rotationRange=props.rotationRange,cropMinSize=props.cropMinSize,cropMaxSize=props.cropMaxSize,crop=props.crop,perspective=props.perspective,cropLimitToImage=props.cropLimitToImage,cropOrigin=props.cropOrigin;// image not ready, exit!
if(!crop||!loadState||!loadState.beforeComplete)return rotationNext;// remember if current crop was at max size and centered, if so, resulting crop should also be at max size
var cropWasAtMaxSize=cropLimitToImage&&isCropMaxSize(crop,size,rotationPrevious);var cropWasCentered=cropLimitToImage&&isCropCentered(crop,size,rotationPrevious);// get new state
var res=applyRotationAction(rotationPrevious,rotationNext,rotationRange,crop,size,perspective,cropLimitToImage,cropOrigin,cropMinSize,cropMaxSize);// if is centered, and initial crop was at max size expand crop to max size
if(cropWasAtMaxSize&&cropWasCentered){var rect=getMaxSizeInRect(size,rotationNext,rectAspectRatio(res.crop));// move top left corner
res.crop.x+=res.crop.width*0.5;res.crop.y+=res.crop.height*0.5;res.crop.x-=rect.width*0.5;res.crop.y-=rect.height*0.5;// update size to max size
res.crop.width=rect.width;res.crop.height=rect.height;}// return validated rotation value, then, after we assign that value, we update the crop rect
// we may only call onUpdate if a change was made
onUpdate(function(){props.crop=rectApply(res.crop,function(v){return fixPrecision(v,8);});});// return result rotation (might have been rotated twice to fit crop rectangle)
return res.rotation;};};// updates the range of valid rotation input
var updateRotationRange=function updateRotationRange(imageSize,imageIsRotatedSideways,cropMinSize,cropSize,cropLimitToImage){if(!cropLimitToImage)return[-Infinity,Infinity];/*
    - 'a' is angle between diagonal and image height
    - 'b' is angle between diagonal and crop height
    - 'c' is angle between diagonal and image width
    - resulting range is then a - b
    +----------/\------------------------+
    |         / \ \                      |
    |        /   \  \                    |
    |       /     \   \                  |
    |       \      \    \                |
    |         \     \     \              |
    |           \    \      \            |
    |             \   \       /          |
    |               \  \     /           |
    |                 \ \   /            |
    |                   \\a/b            |
    +---------------------\--------------+
    */var scalar=Math.max(cropMinSize.width/cropSize.width,cropMinSize.height/cropSize.height);var minSize=sizeCreate(cropSize.width*scalar,cropSize.height*scalar);// the hypotenus is the length of the diagonal of the min crop size
var requiredSpace=sizeHypotenuse(minSize);// minimum space available in horizontal / vertical direction
var availableSpace=Math.min(imageSize.width,imageSize.height);// if there's enough space available, we can return the max range
if(requiredSpace<availableSpace)return[-Infinity,Infinity];// if the image is turned we need to swap the width and height
var imageWidth=imageIsRotatedSideways?imageSize.height:imageSize.width;var imageHeight=imageIsRotatedSideways?imageSize.width:imageSize.height;// subtracting the angle between the hypotenuse and the crop itself
var a=Math.acos(minSize.height/requiredSpace);var b=Math.acos(imageHeight/requiredSpace);var c=Math.asin(imageWidth/requiredSpace);var rangeHorizontal=a-b;var rangeVertical=c-a;// range is not a number, it means we can rotate as much as we want
if(Number.isNaN(rangeHorizontal)&&Number.isNaN(rangeVertical))return[-Infinity,Infinity];// get minimum range
var range=Number.isNaN(rangeHorizontal)?rangeVertical:Number.isNaN(rangeVertical)?rangeHorizontal:Math.min(rangeHorizontal,rangeVertical);// if not, limit range to min and max rotation
return[-range,range];};// updates the range of valid crop rectangle input
var updateCropRange=function updateCropRange(imageSize,rotation,cropAspectRatio,cropMinSize,cropMaxSize,cropLimitToImage){// ! rotation doesn't affect min size, only max size
// set lower bounds to crop min size
var minSize=sizeClone(cropMinSize);// set upper bounds to crop max size
var maxSize=sizeClone(cropMaxSize);// now we got basic bounds, let's see if we should limit to the image bounds, else we done
if(!cropLimitToImage)return[minSize,maxSize];return[minSize,sizeApply(getMaxSizeInRect(imageSize,rotation,cropAspectRatio),Math.round)];};var formatShape=function formatShape(shape,options){var context=options.context,props=options.props;// only auto-format once
if(!shape._isFormatted){shape=shapeFormat(shape);shape._isFormatted=true;Object.assign(shape,props);}// we need to make sure shape is still correctly positioned relative to parent context
// draft cannot be relative
// if context changed
// if has left top right or bottom
if(!shape._isDraft&&shapeHasRelativeSize(shape)&&(!shape._context||!rectEqual(context,shape._context))){shapeComputeRect(shape,context);shape._context=_objectSpread({},context);}return shape;};var updateFrame=function updateFrame(){return function(frameShapeNext){if(!frameShapeNext)return;var shape={frameStyle:undefined,x:0,y:0,width:'100%',height:'100%',disableStyle:['backgroundColor','strokeColor','strokeWidth']};if(isString(frameShapeNext)){shape.frameStyle=frameShapeNext;}else{Object.assign(shape,frameShapeNext);}return shape;};};var ImageStorePropDescriptors=[// media info received from read
['file'],['size'],// loading and processing state
['loadState'],['processState'],// derived info
['aspectRatio',DERIVED_STORE(function(_ref65){var size=_ref65.size;return[size,function($size){return $size?rectAspectRatio($size):undefined;}];})],// image modifications
['perspectiveX',DEFAULT_VALUE(function(){return 0;})],['perspectiveY',DEFAULT_VALUE(function(){return 0;})],['perspective',DERIVED_STORE(function(_ref66){var perspectiveX=_ref66.perspectiveX,perspectiveY=_ref66.perspectiveY;return[[perspectiveX,perspectiveY],function(_ref67){var _ref68=_slicedToArray(_ref67,2),x=_ref68[0],y=_ref68[1];return{x:x,y:y};}];})],['rotation',DEFAULT_VALUE(function(){return 0;}),UPDATE_VALUE(updateRotation)],['flipX',DEFAULT_VALUE(function(){return false;})],['flipY',DEFAULT_VALUE(function(){return false;})],['flip',DERIVED_STORE(function(_ref69){var flipX=_ref69.flipX,flipY=_ref69.flipY;return[[flipX,flipY],function(_ref70){var _ref71=_slicedToArray(_ref70,2),x=_ref71[0],y=_ref71[1];return{x:x,y:y};}];})],['isRotatedSideways',UNIQUE_DERIVED_STORE(function(_ref72){var rotation=_ref72.rotation;return[[rotation],function(_ref73,set){var _ref74=_slicedToArray(_ref73,1),$rotation=_ref74[0];return set(isRotatedSideways($rotation));},function(prevValue,nextValue){return prevValue!==nextValue;}];})],['crop',UPDATE_VALUE(updateCropRect)],['cropAspectRatio',UPDATE_VALUE(updateCropAspectRatio)],['cropOrigin'],['cropMinSize',DEFAULT_VALUE(function(){return{width:1,height:1};})],['cropMaxSize',DEFAULT_VALUE(function(){return{width:32768,height:32768};})],['cropLimitToImage',DEFAULT_VALUE(function(){return true;}),UPDATE_VALUE(updateCropLimitToImage)],['cropSize',UNIQUE_DERIVED_STORE(function(_ref75){var crop=_ref75.crop;return[[crop],function(_ref76,set){var _ref77=_slicedToArray(_ref76,1),$crop=_ref77[0];if(!$crop)return;set(sizeCreate($crop.width,$crop.height));},// if is same as previous size, don't trigger update (happens when updating only the crop offset)
function(prevValue,nextValue){return sizeEqual(prevValue,nextValue);}];})],['cropRectAspectRatio',DERIVED_STORE(function(_ref78){var cropSize=_ref78.cropSize;return[[cropSize],function(_ref79,set){var _ref80=_slicedToArray(_ref79,1),$cropSize=_ref80[0];if(!$cropSize)return;set(fixPrecision(rectAspectRatio($cropSize),5));}];})],['cropRange',UNIQUE_DERIVED_STORE(function(_ref81){var size=_ref81.size,rotation=_ref81.rotation,cropRectAspectRatio=_ref81.cropRectAspectRatio,cropMinSize=_ref81.cropMinSize,cropMaxSize=_ref81.cropMaxSize,cropLimitToImage=_ref81.cropLimitToImage;return[[size,rotation,cropRectAspectRatio,cropMinSize,cropMaxSize,cropLimitToImage],function(_ref82,set){var _ref83=_slicedToArray(_ref82,6),$size=_ref83[0],$rotation=_ref83[1],$cropRectAspectRatio=_ref83[2],$cropMinSize=_ref83[3],$cropMaxSize=_ref83[4],$cropLimitToImage=_ref83[5];// wait for image size
if(!$size)return;var range=updateCropRange($size,$rotation,$cropRectAspectRatio,$cropMinSize,$cropMaxSize,$cropLimitToImage);set(range);},// if is same range as previous range, don't trigger update
function(prevRange,nextRange){return arrayEqual(prevRange,nextRange);}];})],['rotationRange',UNIQUE_DERIVED_STORE(function(_ref84){var size=_ref84.size,isRotatedSideways=_ref84.isRotatedSideways,cropMinSize=_ref84.cropMinSize,cropSize=_ref84.cropSize,cropLimitToImage=_ref84.cropLimitToImage;return[[size,isRotatedSideways,cropMinSize,cropSize,cropLimitToImage],function(_ref85,set){var _ref86=_slicedToArray(_ref85,5),$size=_ref86[0],$isRotatedSideways=_ref86[1],$cropMinSize=_ref86[2],$cropSize=_ref86[3],$cropLimitToImage=_ref86[4];// wait for image size
if(!$size||!$cropSize)return;var range=updateRotationRange($size,$isRotatedSideways,$cropMinSize,$cropSize,$cropLimitToImage);set(range);},// if is same range as previous range, don't trigger update
function(prevRange,nextRange){return arrayEqual(prevRange,nextRange);}];})],// canvas
['backgroundColor',UPDATE_VALUE(function(){return function(color){return padColorArray(color);};})],['backgroundImage'],// size
['targetSize'],// effects
['colorMatrix'],['convolutionMatrix'],['gamma'],['noise'],['vignette'],// video
['duration'],['trim'],['volume'],// redaction lives in image space
['redaction',MAP_STORE(function(_ref87){var size=_ref87.size;return[formatShape,{context:size}];})],// annotation lives in image space
['annotation',MAP_STORE(function(_ref88){var size=_ref88.size;return[formatShape,{context:size}];})],// decoration lives in crop space
['decoration',MAP_STORE(function(_ref89){var crop=_ref89.crop;return[formatShape,{context:crop}];})],// frame to render on top of the image (or outside)
['frame',UPDATE_VALUE(updateFrame)],// custom metadata
['metadata'],// state of image, used to restore a previous state or request the current state
['state',CUSTOM_STORE(stateStore)]];var process=/*#__PURE__*/function(){var _ref90=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee37(value,chainTasks){var chainOptions,processOptions,ontaskstart,ontaskprogress,ontaskend,token,cancelled,taskCancelToken,_iterator6,_step6,_loop,_ret,_args33=arguments;return _regeneratorRuntime().wrap(function _callee37$(_context38){while(1)switch(_context38.prev=_context38.next){case 0:chainOptions=_args33.length>2&&_args33[2]!==undefined?_args33[2]:{};processOptions=_args33.length>3?_args33[3]:undefined;// options relevant to the process method itself
ontaskstart=processOptions.ontaskstart,ontaskprogress=processOptions.ontaskprogress,ontaskend=processOptions.ontaskend,token=processOptions.token;// has been cancelled
cancelled=false;// create token to pass to tasks
taskCancelToken={cancel:noop$1};// set cancel handler method
token.cancel=function(){// cancel called from outside of the process method
cancelled=true;// assign cancel method to task
taskCancelToken.cancel();};// step through chain
_iterator6=_createForOfIteratorHelper(chainTasks.entries());_context38.prev=7;_loop=/*#__PURE__*/_regeneratorRuntime().mark(function _loop(){var _step6$value,index,task,_task,fn,id;return _regeneratorRuntime().wrap(function _loop$(_context37){while(1)switch(_context37.prev=_context37.next){case 0:_step6$value=_slicedToArray(_step6.value,2),index=_step6$value[0],task=_step6$value[1];if(!cancelled){_context37.next=3;break;}return _context37.abrupt("return",{v:void 0});case 3:// get the task function and the id so we can notify the callee of the task that is being started
_task=_slicedToArray(task,2),fn=_task[0],id=_task[1];// start task
ontaskstart(index,id);_context37.prev=5;_context37.next=8;return fn(value,_objectSpread(_objectSpread({},chainOptions),{},{taskCancelToken:taskCancelToken}),function(event){return ontaskprogress(index,id,event);});case 8:value=_context37.sent;_context37.next=15;break;case 11:_context37.prev=11;_context37.t0=_context37["catch"](5);// stop processing more items in the chain
cancelled=true;// pass error back to parent
throw _context37.t0;case 15:ontaskend(index,id);case 16:case"end":return _context37.stop();}},_loop,null,[[5,11]]);});_iterator6.s();case 10:if((_step6=_iterator6.n()).done){_context38.next=17;break;}return _context38.delegateYield(_loop(),"t0",12);case 12:_ret=_context38.t0;if(!(_typeof(_ret)==="object")){_context38.next=15;break;}return _context38.abrupt("return",_ret.v);case 15:_context38.next=10;break;case 17:_context38.next=22;break;case 19:_context38.prev=19;_context38.t1=_context38["catch"](7);_iterator6.e(_context38.t1);case 22:_context38.prev=22;_iterator6.f();return _context38.finish(22);case 25:return _context38.abrupt("return",value);case 26:case"end":return _context38.stop();}},_callee37,null,[[7,19,22,25]]);}));return function process(_x62,_x63){return _ref90.apply(this,arguments);};}();// TODO: find better location for minSize / file load validation
var createImageCore=function createImageCore(){var _ref91=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref91$minSize=_ref91.minSize,minSize=_ref91$minSize===void 0?{width:1,height:1}:_ref91$minSize;// create default store
var _createStores=createStores(ImageStorePropDescriptors),stores=_createStores.stores,accessors=_createStores.accessors;// pub/sub
var _pubsub2=pubsub(),pub=_pubsub2.pub,sub=_pubsub2.sub;// processing handler
var createProcessingHandler=function createProcessingHandler(stateProp,eventKey){var getStore=function getStore(){return accessors[stateProp]||{};};var setStore=function setStore(obj){accessors[stateProp]=_objectSpread(_objectSpread(_objectSpread({},getStore()),obj),{},{timeStamp:Date.now()});};var hasError=function hasError(){return getStore().error;};var handleError=function handleError(error){if(hasError())return;setStore({error:error});pub("".concat(eventKey,"error"),_objectSpread({},getStore()));};return{start:function start(){pub("".concat(eventKey,"start"));},onabort:function onabort(){setStore({abort:true});pub("".concat(eventKey,"abort"),_objectSpread({},getStore()));},ontaskstart:function ontaskstart(index,id){if(hasError())return;setStore({index:index,task:id,taskProgress:undefined,taskLengthComputable:undefined});pub("".concat(eventKey,"taskstart"),_objectSpread({},getStore()));},ontaskprogress:function ontaskprogress(index,id,event){if(hasError())return;setStore({index:index,task:id,taskProgress:event.loaded/event.total,taskLengthComputable:event.lengthComputable});pub("".concat(eventKey,"taskprogress"),_objectSpread({},getStore()));pub("".concat(eventKey,"progress"),_objectSpread({},getStore()));},ontaskend:function ontaskend(index,id){if(hasError())return;setStore({index:index,task:id});pub("".concat(eventKey,"taskend"),_objectSpread({},getStore()));},ontaskerror:function ontaskerror(error){handleError(error);},error:function error(_error){handleError(_error);},beforeComplete:function beforeComplete(data){if(hasError())return;setStore({beforeComplete:true});pub("before".concat(eventKey),data);},complete:function complete(data){if(hasError())return;setStore({complete:true});pub(eventKey,data);}};};//#region read image
var read=function read(src,_ref92){var reader=_ref92.reader;var readerOptions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};// exit if no reader supplied
if(!reader)return;// reset file data to undefined as we're loading a new image
Object.assign(accessors,{file:undefined,size:undefined,loadState:undefined});// our cancel token so we can abort load if needed, cancel will be set by process
var imageReadToken={cancel:noop$1};var imageReadCancelled=false;var imageReadHandler=createProcessingHandler('loadState','load');var processOptions=_objectSpread({token:imageReadToken},imageReadHandler);var readerState={src:src,size:undefined,dest:undefined,duration:undefined};// wait a tick before starting image read so the read can be cancelled in loadstart
Promise.resolve().then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee38(){var output,_ref94,size,duration,dest;return _regeneratorRuntime().wrap(function _callee38$(_context39){while(1)switch(_context39.prev=_context39.next){case 0:_context39.prev=0;imageReadHandler.start();if(!imageReadCancelled){_context39.next=4;break;}return _context39.abrupt("return",imageReadHandler.onabort());case 4:_context39.next=6;return process(readerState,reader,readerOptions,processOptions);case 6:output=_context39.sent;if(!imageReadCancelled){_context39.next=9;break;}return _context39.abrupt("return",imageReadHandler.onabort());case 9:// get shortcuts for validation
_ref94=output||{},size=_ref94.size,duration=_ref94.duration,dest=_ref94.dest;// if we don't have a size
if(!(!size||!size.width||!size.height)){_context39.next=12;break;}throw new EditorError('Image size missing','IMAGE_SIZE_MISSING',output);case 12:if(!(size.width<minSize.width||size.height<minSize.height)){_context39.next=14;break;}throw new EditorError('Image too small','IMAGE_TOO_SMALL',_objectSpread(_objectSpread({},output),{},{minWidth:minSize.width,minHeight:minSize.height}));case 14:// update internal data
Object.assign(accessors,{file:dest,size:size,duration:duration});// before load complete
imageReadHandler.beforeComplete(output);// done loading image
imageReadHandler.complete(output);_context39.next=22;break;case 19:_context39.prev=19;_context39.t0=_context39["catch"](0);imageReadHandler.error(_context39.t0);case 22:_context39.prev=22;imageReadToken=undefined;return _context39.finish(22);case 25:case"end":return _context39.stop();}},_callee38,null,[[0,19,22,25]]);})));// call to abort load
return function(){imageReadCancelled=true;imageReadToken&&imageReadToken.cancel();imageReadHandler.onabort();};};//#endregion
//#region write image
var write=function write(writer,options){// not ready to start processing
if(!accessors.loadState.complete)return;// reset process state to undefined
accessors.processState=undefined;var imageWriteHandler=createProcessingHandler('processState','process');var writerState={src:accessors.file,imageState:accessors.state,dest:undefined};// writer is function, let's get the actual writer
if(isFunction(writer)){writer=writer(accessors.file,accessors.state);}// willProcessImageState
if(!writer){imageWriteHandler.start();imageWriteHandler.complete(writerState);return;}// we need this token to be a blet to cancel the processing operation
var imageWriteToken={cancel:noop$1};var imageWriteCancelled=false;var writerOptions=options;var processOptions=_objectSpread({token:imageWriteToken},imageWriteHandler);// wait a tick before starting image write so the write can be cancelled in processtart
Promise.resolve().then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee39(){var output;return _regeneratorRuntime().wrap(function _callee39$(_context40){while(1)switch(_context40.prev=_context40.next){case 0:_context40.prev=0;imageWriteHandler.start();// could be cancelled before processing started
if(!imageWriteCancelled){_context40.next=4;break;}return _context40.abrupt("return",imageWriteHandler.onabort());case 4:_context40.next=6;return process(writerState,writer,writerOptions,processOptions);case 6:output=_context40.sent;if(!imageWriteCancelled){_context40.next=9;break;}return _context40.abrupt("return",imageWriteHandler.onabort());case 9:imageWriteHandler.complete(output);_context40.next=15;break;case 12:_context40.prev=12;_context40.t0=_context40["catch"](0);imageWriteHandler.error(_context40.t0);case 15:_context40.prev=15;imageWriteToken=undefined;return _context40.finish(15);case 18:case"end":return _context40.stop();}},_callee39,null,[[0,12,15,18]]);})));// call to abort processing
return function(){imageWriteCancelled=true;imageWriteToken&&imageWriteToken.cancel();};};//#endregion
//#region api
defineMethods(accessors,{read:read,write:write,on:sub});//#endregion
// expose store API
return{accessors:accessors,stores:stores};};// @ts-ignore
var editorEventsToBubble=['loadstart','loadabort','loaderror','loadprogress','load','processstart','processabort','processerror','processprogress','process'];var imagePrivateProps=['flip','cropOrigin','isRotatedSideways','perspective','perspectiveX','perspectiveY','cropRange'];var editorPrivateProps=['images'];var imagePublicProps=ImageStorePropDescriptors.map(function(_ref96){var _ref97=_slicedToArray(_ref96,1),prop=_ref97[0];return prop;}).filter(function(prop){return!imagePrivateProps.includes(prop);});var getImagePropGroupedName=function getImagePropGroupedName(prop){return"image".concat(capitalizeFirstLetter(prop));};var getEditorProps$1=function getEditorProps$1(){var imageProperties=imagePublicProps.map(getImagePropGroupedName);var editorProperties=props.map(function(_ref98){var _ref99=_slicedToArray(_ref98,1),prop=_ref99[0];return prop;}).filter(function(prop){return!editorPrivateProps.includes(prop);});return imageProperties.concat(editorProperties);};var isImageSource=function isImageSource(src){return isString(src)||isBinary(src)||isElement(src);};var isImageState=function isImageState(obj){return hasProp(obj,'crop');};var createImageEditor=function createImageEditor(){// create default stores
var _createStores2=createStores(props),stores=_createStores2.stores,accessors=_createStores2.accessors;// set up pub/sub for the app layer
var _pubsub3=pubsub(),sub=_pubsub3.sub,pub=_pubsub3.pub;var bubble=function bubble(name){return function(value){return pub(name,value);};};// helper method
var getImageObjSafe=function getImageObjSafe(){return accessors.images?accessors.images[0]:{};};// initialImageProps is the list of transforms to apply when the image loads
var initialImageProps={};var initialImagePropsBackup={};// create shortcuts to image props : `crop` -> `imageCrop`
imagePublicProps.forEach(function(prop){Object.defineProperty(accessors,getImagePropGroupedName(prop),{get:function get(){// no image, can't get
var image=getImageObjSafe();if(!image)return;// return from image state
return image.accessors[prop];},set:function set(value){// always use as initial prop when loading a new image without reset
initialImageProps[getImagePropGroupedName(prop)]=value;// set to props backup so we can read it later when loading a new image
initialImagePropsBackup[getImagePropGroupedName(prop)]=value;// no image, we can't update
var image=getImageObjSafe();if(!image)return;// update the image immidiately
image.accessors[prop]=value;}});});// internal helper method to get active image
var getImage=function getImage(){return accessors.images&&accessors.images[0];};// handling loading an image if a src is set
var unsubSrc=stores.src.subscribe(function(src){// no image set, means clear active image
if(!src)return accessors.images=[];// exit here if we don't have an imageReader we'll wait for an imageReader to be defined
if(!accessors.imageReader)return;// reset initial image props if an image is already loaded, so props applied to previous image aren't applied to the new one
if(accessors.images.length)initialImageProps={};// load image in src prop
loadSrc(src);});var unsubReader=stores.imageReader.subscribe(function(reader){// can't do anything without an image reader
if(!reader)return;// an image has already been loaded no need to load images that were set earlier
if(accessors.images.length)return;// no image to load, we'll wait for images to be set to the `src` prop
if(!accessors.src)return;// src is waiting to be loaded so let's pick it up,
loadSrc(accessors.src);});var loadSrc=function loadSrc(src){// push it back a tick so we know initialImageProps are set
Promise.resolve().then(function(){// load with initial props
return loadImage(src,initialImageProps);})["catch"](function(){// fail silently, any errors are handled with 'loaderror' event
});};//#endregion
//#region public method (note that these are also called from UI, name of method is name of dispatched event in UI)
var applyImageOptionsOrState=function applyImageOptionsOrState(image,options){// test if options is image state, if so, apply and exit
if(isImageState(options)){accessors.imageState=options;return;}// create an initial crop rect if no crop supplied
if(!options.imageCrop){var imageSize=image.accessors.size;var imageRotation=options.imageRotation||0;var imageRotatedSize=sizeRotate(sizeClone(imageSize),imageRotation);var cropRect=rectCreateFromSize(imageRotatedSize);// prevent negative width/height
cropRect.width=fixPrecision(Math.abs(cropRect.width),6);cropRect.height=fixPrecision(Math.abs(cropRect.height),6);var aspectRatio=options.imageCropAspectRatio||(options.imageCropLimitToImage?rectAspectRatio(imageSize)// use image size if should limit to image
:rectAspectRatio(cropRect));// use rotated crop rect bounds if no limit
var crop;if(options.imageCropLimitToImage){crop=rectContainRect(cropRect,aspectRatio);}else{crop=rectCoverRect(cropRect,aspectRatio);// center the image in the crop rectangle
crop.x=(imageSize.width-crop.width)/2;crop.y=(imageSize.height-crop.height)/2;}options.imageCrop=crop;}// we need to apply these props in the correct order
var propKeys=['imageCropLimitToImage','imageCrop','imageCropAspectRatio','imageRotation'];propKeys.filter(function(prop){return hasProp(options,prop);}).forEach(function(prop){// assign to `image`
accessors[prop]=options[prop];// remove from normalizedOptions so it's not set twice
delete options[prop];});// don't set the above options for a second time
var filteredOptions=Object.keys(options).filter(function(key){return!propKeys.includes(key);}).reduce(function(filtered,prop){filtered[prop]=options[prop];return filtered;},{});// trigger setState
Object.assign(accessors,filteredOptions);};// load image, resolve when image is loaded
var imageLoadAbort;var loadImage=function loadImage(src){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return new Promise(function(resolve,reject){// get current image
var image=getImage();// determine min defined image size (is crop min size)
var cropLimitedToImage=!(options.cropLimitToImage===false||options.imageCropLimitToImage===false||initialImagePropsBackup.imageCropLmitedToImage===false);var cropMinSize=options.cropMinSize||options.imageCropMinSize||initialImagePropsBackup.imageCropMinSize;var minImageSize=cropLimitedToImage?cropMinSize:image&&image.accessors.cropMinSize;// if already has image, remove existing image
if(image)removeImage();// access image props and stores
image=createImageCore({minSize:minImageSize});editorEventsToBubble.map(function(event){return image.accessors.on(event,bubble(event));});// done, clean up listeners
var fin=function fin(){// reset initial props (as now applied)
initialImageProps={};unsubs.forEach(function(unsub){return unsub();});};var unsubs=[];unsubs.push(image.accessors.on('loaderror',function(error){fin();reject(error);}));unsubs.push(image.accessors.on('loadabort',function(){fin();reject({name:'AbortError'});}));unsubs.push(image.accessors.on('load',function(output){imageLoadAbort=undefined;fin();resolve(output);}));unsubs.push(image.accessors.on('beforeload',function(){return applyImageOptionsOrState(image,options);}));// set new image
accessors.images=[image];// assign passed options to editor accessors, we ignore 'src'
if(options.imageReader)accessors.imageReader=options.imageReader;if(options.imageWriter)accessors.imageWriter=options.imageWriter;// start reading image
imageLoadAbort=image.accessors.read(src,{reader:accessors.imageReader},{willRequest:accessors.willRequest});});};// start processing a loaded image, resolve when image is processed
var imageProcessAbort;var processImage=function processImage(src,options){return new Promise(function(resolve,reject){try{var unsubs=[];// done, clean up listeners
var fin=function fin(){imageProcessAbort=undefined;unsubs.forEach(function(unsub){return unsub();});};_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee40(){var image;return _regeneratorRuntime().wrap(function _callee40$(_context41){while(1)switch(_context41.prev=_context41.next){case 0:if(!isImageSource(src)){_context41.next=11;break;}_context41.prev=1;_context41.next=4;return loadImage(src,options);case 4:_context41.next=9;break;case 6:_context41.prev=6;_context41.t0=_context41["catch"](1);reject(_context41.t0);case 9:_context41.next=12;break;case 11:if(src){if(isImageState(src)){accessors.imageState=src;}else{Object.assign(accessors,src);}}case 12:// get current active image
image=getImage();// needs image for processing
if(image){_context41.next=15;break;}return _context41.abrupt("return",reject('no image'));case 15:unsubs.push(image.accessors.on('processerror',function(error){fin();reject(error);}));unsubs.push(image.accessors.on('processabort',function(){fin();reject({name:'AbortError'});}));unsubs.push(image.accessors.on('process',function(output){fin();resolve(output);}));imageProcessAbort=image.accessors.write(accessors.imageWriter,{shapePreprocessor:accessors.shapePreprocessor||passthrough,imageScrambler:accessors.imageScrambler,willRequest:accessors.willRequest,willRequestResource:accessors.willRequestResource// deprecated
});case 19:case"end":return _context41.stop();}},_callee40,null,[[1,6]]);}))();}catch(err){reject(err);}});};var abortProcessImage=function abortProcessImage(){var image=getImage();if(!image)return;if(imageProcessAbort)imageProcessAbort();image.accessors.processState=undefined;};// used internally (triggered by 'x' button when error loading image in UI)
var abortLoadImage=function abortLoadImage(){if(imageLoadAbort)imageLoadAbort();accessors.images=[];};// edit image, loads an image and resolve when image is processed
var editImage=function editImage(src,options){return new Promise(function(resolve,reject){loadImage(src,options).then(function(){// access image props and stores
var images=accessors.images;var image=images[0];// done, clean up listeners
var done=function done(){unsubReject();unsubResolve();};var unsubReject=image.accessors.on('processerror',function(error){done();reject(error);});var unsubResolve=image.accessors.on('process',function(output){done();resolve(output);});})["catch"](reject);});};var removeImage=function removeImage(){// no images, nothing to remove
var image=getImage();if(!image)return;// try to abort image load
if(imageLoadAbort)imageLoadAbort();image.accessors.loadState=undefined;// clear images
accessors.images=[];};//#endregion
Object.defineProperty(accessors,'stores',{get:function get(){return stores;}});//#region API
defineMethods(accessors,{on:sub,loadImage:loadImage,abortLoadImage:abortLoadImage,editImage:editImage,removeImage:removeImage,processImage:processImage,abortProcessImage:abortProcessImage,destroy:function destroy(){unsubSrc&&unsubSrc();unsubReader&&unsubReader();}});return accessors;//#endregion
};var processImage=function processImage(src,options){var _createImageEditor=createImageEditor(),processImage=_createImageEditor.processImage;return processImage(src,options);};var getCanvasMemoryLimit=function getCanvasMemoryLimit(){if(!isSafari())return Infinity;var isSafari15=/15_/.test(navigator.userAgent);if(isIOS()){// limit resolution a little bit further to prevent drawing issues
if(isSafari15)return 3840*3840;// old iOS can deal with 4096 * 4096 without issues
return 4096*4096;}return isSafari15?4096*4096:Infinity;};var filterObjectProperties=function filterObjectProperties(obj,props){return Object.keys(obj).filter(function(key){return!props.includes(key);}).reduce(function(prev,curr){prev[curr]=obj[curr];return prev;},{});};var videoFixDuration=function videoFixDuration(video){return new Promise(function(resolve){// https://bugs.chromium.org/p/chromium/issues/detail?id=656426
// https://bugs.chromium.org/p/chromium/issues/detail?id=642012
if(video.duration===Infinity){video.ontimeupdate=function(){video.ontimeupdate=undefined;resolve(video);};video.currentTime=Number.MAX_SAFE_INTEGER;return;}resolve(video);});};var getVideoElementDuration=function getVideoElementDuration(element){return new Promise(function(resolve,reject){var done=function done(){videoFixDuration(element).then(function(){resolve(element.duration);});};if(element.readyState>=1)return done();element.onloadedmetadata=done;element.onerror=reject;});};var arrayFlatten=function arrayFlatten(arr){return arr.reduce(function(flat,item){var arr=Array.isArray(item)?_toConsumableArray(item):[item];return[].concat(_toConsumableArray(flat),_toConsumableArray(arr));},[]);};// custom method to draw images
var createCanvasImageDrawer=function createCanvasImageDrawer(){var _ref101=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},imageDataResizer=_ref101.imageDataResizer,canvasMemoryLimit=_ref101.canvasMemoryLimit;return/*#__PURE__*/function(){var _ref102=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee41(ctx,image,srcRect,destRect){var _yield$processImage,dest;return _regeneratorRuntime().wrap(function _callee41$(_context42){while(1)switch(_context42.prev=_context42.next){case 0:// min size of src is 1x1
srcRect.width=Math.max(srcRect.width,1);srcRect.height=Math.max(srcRect.height,1);// min size of dest is 1x1
destRect.width=Math.max(destRect.width,1);destRect.height=Math.max(destRect.height,1);// get resized image
_context42.next=6;return processImage(image,{imageReader:createDefaultImageReader$1(),imageWriter:createDefaultImageWriter$1({format:'canvas',targetSize:_objectSpread(_objectSpread({},destRect),{},{upscale:true}),imageDataResizer:imageDataResizer,canvasMemoryLimit:canvasMemoryLimit}),imageCrop:srcRect});case 6:_yield$processImage=_context42.sent;dest=_yield$processImage.dest;// draw processed image
ctx.drawImage(dest,destRect.x,destRect.y,destRect.width,destRect.height);// release image canvas to free up memory
releaseCanvas(dest);case 10:case"end":return _context42.stop();}},_callee41);}));return function(_x64,_x65,_x66,_x67){return _ref102.apply(this,arguments);};}();};// connect function in process chain
var connect=function connect(fn){var getter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){for(var _len2=arguments.length,args=new Array(_len2),_key5=0;_key5<_len2;_key5++){args[_key5]=arguments[_key5];}return args;};var setter=arguments.length>2?arguments[2]:undefined;return/*#__PURE__*/function(){var _ref103=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee42(state,options,onprogress){var progressUpdated,res;return _regeneratorRuntime().wrap(function _callee42$(_context43){while(1)switch(_context43.prev=_context43.next){case 0:// will hold function result
// at this point we don't know if the length of this task can be computed
onprogress(createProgressEvent(0,false));// try to run the function
progressUpdated=false;_context43.next=4;return fn.apply(void 0,_toConsumableArray(getter(state,options,function(event){progressUpdated=true;onprogress(event);})));case 4:res=_context43.sent;// a setter isn't required
setter&&setter(state,res);// if progress was updated, we expect the connected function to fire the 1/1 event, else we fire it here
if(!progressUpdated)onprogress(createProgressEvent(1,false));return _context43.abrupt("return",state);case 8:case"end":return _context43.stop();}},_callee42);}));return function(_x68,_x69,_x70){return _ref103.apply(this,arguments);};}();};//
// Reader/Writer Presets
//
var AnyToFile=function AnyToFile(){var _ref104=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref104$willRequest=_ref104.willRequest,willRequest=_ref104$willRequest===void 0?undefined:_ref104$willRequest,_ref104$srcProp=_ref104.srcProp,srcProp=_ref104$srcProp===void 0?'src':_ref104$srcProp,_ref104$destProp=_ref104.destProp,destProp=_ref104$destProp===void 0?'dest':_ref104$destProp;return[connect(srcToFile,function(state,options,onprogress){return[state[srcProp],onprogress,_objectSpread(_objectSpread({},options),{},{willRequest:willRequest})];},function(state,file){return state[destProp]=file;}),'any-to-file'];};var BlobGuardMimeType=function BlobGuardMimeType(){var _ref105=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref105$srcProp=_ref105.srcProp,srcProp=_ref105$srcProp===void 0?'dest':_ref105$srcProp,_ref105$destProp=_ref105.destProp,destProp=_ref105$destProp===void 0?'dest':_ref105$destProp;return[connect(/*#__PURE__*/function(){var _ref106=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee43(src){var mediaType,el,propertyBag;return _regeneratorRuntime().wrap(function _callee43$(_context44){while(1)switch(_context44.prev=_context44.next){case 0:if(!/octet-stream/.test(src.type)){_context44.next=9;break;}console.warn('Pintura: Media has unknown mime type this can affect output quality',src);// assume is image
mediaType='image';// test if is possibly video
_context44.next=5;return getAsVideoOrImageElement(src);case 5:el=_context44.sent;if(/video/i.test(el.nodeName))mediaType='video';// set unknown media type
propertyBag={type:mediaType+'/unknown'};return _context44.abrupt("return",isFile(src)?new File([src],src.name,_objectSpread(_objectSpread({},propertyBag),{},{lastModified:src.lastModified})):new Blob([src],propertyBag));case 9:return _context44.abrupt("return",src);case 10:case"end":return _context44.stop();}},_callee43);}));return function(_x71){return _ref106.apply(this,arguments);};}(),function(state){return[state[srcProp]];},function(state,file){return state[destProp]=file;}),'any-to-file'];};var BlobReadImageSize=function BlobReadImageSize(){var _ref107=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref107$srcProp=_ref107.srcProp,srcProp=_ref107$srcProp===void 0?'src':_ref107$srcProp,_ref107$destProp=_ref107.destProp,destProp=_ref107$destProp===void 0?'size':_ref107$destProp;return[connect(getImageSize,function(state){return[state[srcProp]];},function(state,size){return state[destProp]=size;}),'read-image-size'];};var getMediaDuration=/*#__PURE__*/function(){var _ref108=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee44(src){var mediaElement;return _regeneratorRuntime().wrap(function _callee44$(_context45){while(1)switch(_context45.prev=_context45.next){case 0:_context45.next=2;return getAsVideoOrImageElement(src);case 2:mediaElement=_context45.sent;if(!isVideoElement(mediaElement)){_context45.next=7;break;}_context45.next=6;return getVideoElementDuration(mediaElement);case 6:return _context45.abrupt("return",_context45.sent);case 7:return _context45.abrupt("return",undefined);case 8:case"end":return _context45.stop();}},_callee44);}));return function getMediaDuration(_x72){return _ref108.apply(this,arguments);};}();var BlobReadMediaDuration=function BlobReadMediaDuration(){var _ref109=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref109$srcProp=_ref109.srcProp,srcProp=_ref109$srcProp===void 0?'src':_ref109$srcProp,_ref109$destProp=_ref109.destProp,destProp=_ref109$destProp===void 0?'duration':_ref109$destProp;return[connect(getMediaDuration,function(state){return[state[srcProp]];},function(state,duration){return state[destProp]=duration;}),'read-image-size'];};var ImageSizeMatchOrientation=function ImageSizeMatchOrientation(){var _ref110=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref110$srcSize=_ref110.srcSize,srcSize=_ref110$srcSize===void 0?'size':_ref110$srcSize,_ref110$srcOrientatio=_ref110.srcOrientation,srcOrientation=_ref110$srcOrientatio===void 0?'orientation':_ref110$srcOrientatio,_ref110$destSize=_ref110.destSize,destSize=_ref110$destSize===void 0?'size':_ref110$destSize;return[connect(orientImageSize,function(state){return[state[srcSize],state[srcOrientation]];},function(state,size){return state[destSize]=size;}),'image-size-match-orientation'];};var BlobReadImageHead=function BlobReadImageHead(){var _ref111=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref111$srcProp=_ref111.srcProp,srcProp=_ref111$srcProp===void 0?'src':_ref111$srcProp,_ref111$destProp=_ref111.destProp,destProp=_ref111$destProp===void 0?'head':_ref111$destProp;return[connect(function(blob,slice){return isJPEG(blob)?blobReadSection(blob,slice):undefined;},// 64 * 4096 should be plenty to find extract header
// Exif metadata are restricted in size to 64 kB in JPEG images because
// according to the specification this information must be contained within a single JPEG APP1 segment.
function(state){return[state[srcProp],[0,64*4096],onprogress];},function(state,head){return state[destProp]=head;}),'read-image-head'];};var ImageHeadReadExifOrientationTag=function ImageHeadReadExifOrientationTag(){var _ref112=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref112$srcProp=_ref112.srcProp,srcProp=_ref112$srcProp===void 0?'head':_ref112$srcProp,_ref112$destProp=_ref112.destProp,destProp=_ref112$destProp===void 0?'orientation':_ref112$destProp;return[connect(arrayBufferImageExif,function(state){return[state[srcProp],ORIENTATION_TAG];},function(state){var orientation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return state[destProp]=orientation;}),'read-exif-orientation-tag'];};var ImageHeadClearExifOrientationTag=function ImageHeadClearExifOrientationTag(){var _ref113=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref113$srcProp=_ref113.srcProp,srcProp=_ref113$srcProp===void 0?'head':_ref113$srcProp;return[connect(arrayBufferImageExif,function(state){return[state[srcProp],ORIENTATION_TAG,1];}),'clear-exif-orientation-tag'];};var CalculateCanvasScalar=function CalculateCanvasScalar(){var _ref114=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref114$srcImageSize=_ref114.srcImageSize,srcImageSize=_ref114$srcImageSize===void 0?'size':_ref114$srcImageSize,_ref114$srcCanvasSize=_ref114.srcCanvasSize,srcCanvasSize=_ref114$srcCanvasSize===void 0?'imageData':_ref114$srcCanvasSize,_ref114$srcImageState=_ref114.srcImageState,srcImageState=_ref114$srcImageState===void 0?'imageState':_ref114$srcImageState,_ref114$destImageSize=_ref114.destImageSize,destImageSize=_ref114$destImageSize===void 0?'size':_ref114$destImageSize,_ref114$destScalar=_ref114.destScalar,destScalar=_ref114$destScalar===void 0?'scalar':_ref114$destScalar;return[connect(function(naturalSize,canvasSize){return[Math.min(canvasSize.width/naturalSize.width,canvasSize.height/naturalSize.height),sizeCreateFromAny(canvasSize)];},function(state){return[state[srcImageSize],state[srcCanvasSize],state[srcImageState]];},function(state,_ref115){var _ref116=_slicedToArray(_ref115,2),scalar=_ref116[0],imageSize=_ref116[1];state[destScalar]=scalar;state[destImageSize]=imageSize;}),'calculate-canvas-scalar'];};var BlobToImageData=function BlobToImageData(){var _ref117=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref117$srcProp=_ref117.srcProp,srcProp=_ref117$srcProp===void 0?'src':_ref117$srcProp,_ref117$destProp=_ref117.destProp,destProp=_ref117$destProp===void 0?'imageData':_ref117$destProp,_ref117$canvasMemoryL=_ref117.canvasMemoryLimit,canvasMemoryLimit=_ref117$canvasMemoryL===void 0?undefined:_ref117$canvasMemoryL;return[connect(blobToImageData,function(state){return[state[srcProp],canvasMemoryLimit];},function(state,imageData){return state[destProp]=imageData;}),'blob-to-image-data'];};var ImageDataMatchOrientation=function ImageDataMatchOrientation(){var _ref118=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref118$srcImageData=_ref118.srcImageData,srcImageData=_ref118$srcImageData===void 0?'imageData':_ref118$srcImageData,_ref118$srcOrientatio=_ref118.srcOrientation,srcOrientation=_ref118$srcOrientatio===void 0?'orientation':_ref118$srcOrientatio;return[connect(orientImageData,function(state){return[state[srcImageData],state[srcOrientation]];},function(state,imageData){return state.imageData=imageData;}),'image-data-match-orientation'];};var ImageDataFill=function ImageDataFill(){var _ref119=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref119$srcImageData=_ref119.srcImageData,srcImageData=_ref119$srcImageData===void 0?'imageData':_ref119$srcImageData,_ref119$srcImageState=_ref119.srcImageState,srcImageState=_ref119$srcImageState===void 0?'imageState':_ref119$srcImageState;return[connect(fillImageData,function(state){return[state[srcImageData],{backgroundColor:state[srcImageState].backgroundColor,backgroundImage:state[srcImageState].backgroundImage}];},function(state,imageData){return state.imageData=imageData;}),'image-data-fill'];};var ImageDataCrop=function ImageDataCrop(){var _ref120=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref120$srcImageData=_ref120.srcImageData,srcImageData=_ref120$srcImageData===void 0?'imageData':_ref120$srcImageData,_ref120$srcImageState=_ref120.srcImageState,srcImageState=_ref120$srcImageState===void 0?'imageState':_ref120$srcImageState,_ref120$destScalar=_ref120.destScalar,destScalar=_ref120$destScalar===void 0?'scalar':_ref120$destScalar;return[connect(cropImageData,function(state){// scale crop if needed
var scalar=state[destScalar];var crop=state[srcImageState].crop;if(crop&&scalar!==1){crop=rectScale$1(rectClone$1(crop),scalar,vectorCreateEmpty());}// apply crop
return[state[srcImageData],{crop:crop,rotation:state[srcImageState].rotation,flipX:state[srcImageState].flipX,flipY:state[srcImageState].flipY}];},function(state,imageData){return state.imageData=imageData;}),'image-data-crop'];};var hasTargetSize=function hasTargetSize(imageState){return!!(imageState.targetSize&&imageState.targetSize.width||imageState.targetSize&&imageState.targetSize.height);};var ImageDataResize=function ImageDataResize(_ref121){var _ref121$targetSize=_ref121.targetSize,targetSize=_ref121$targetSize===void 0?{width:undefined,height:undefined,fit:undefined,upscale:undefined}:_ref121$targetSize,_ref121$imageDataResi=_ref121.imageDataResizer,imageDataResizer=_ref121$imageDataResi===void 0?undefined:_ref121$imageDataResi,_ref121$srcProp=_ref121.srcProp,srcProp=_ref121$srcProp===void 0?'imageData':_ref121$srcProp,_ref121$srcImageState=_ref121.srcImageState,srcImageState=_ref121$srcImageState===void 0?'imageState':_ref121$srcImageState,_ref121$destImageScal=_ref121.destImageScaledSize,destImageScaledSize=_ref121$destImageScal===void 0?'imageScaledSize':_ref121$destImageScal;return[connect(resizeImageData,function(state){var width=Math.min(targetSize.width||Number.MAX_SAFE_INTEGER,state[srcImageState].targetSize&&state[srcImageState].targetSize.width||Number.MAX_SAFE_INTEGER);var height=Math.min(targetSize.height||Number.MAX_SAFE_INTEGER,state[srcImageState].targetSize&&state[srcImageState].targetSize.height||Number.MAX_SAFE_INTEGER);return[state[srcProp],{width:width,height:height,fit:targetSize.fit||'contain',upscale:hasTargetSize(state[srcImageState])?true:targetSize.upscale||false},imageDataResizer];},function(state,imageData){if(!sizeEqual(state.imageData,imageData))state[destImageScaledSize]=sizeCreateFromAny(imageData);state.imageData=imageData;}),'image-data-resize'];};var ImageDataFilter=function ImageDataFilter(){var _ref122=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref122$srcImageData=_ref122.srcImageData,srcImageData=_ref122$srcImageData===void 0?'imageData':_ref122$srcImageData,_ref122$srcImageState=_ref122.srcImageState,srcImageState=_ref122$srcImageState===void 0?'imageState':_ref122$srcImageState,_ref122$destImageData=_ref122.destImageData,destImageData=_ref122$destImageData===void 0?'imageData':_ref122$destImageData;return[connect(filterImageData,function(state){var colorMatrix=state[srcImageState].colorMatrix;var colorMatrices=colorMatrix&&Object.keys(colorMatrix).map(function(name){return colorMatrix[name];}).filter(Boolean);return[state[srcImageData],{colorMatrix:colorMatrices&&getColorMatrixFromColorMatrices(colorMatrices),convolutionMatrix:state[srcImageState].convolutionMatrix,gamma:state[srcImageState].gamma,noise:state[srcImageState].noise,vignette:state[srcImageState].vignette}];},function(state,imageData){return state[destImageData]=imageData;}),'image-data-filter'];};var ImageDataRedact=function ImageDataRedact(){var _ref123=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref123$srcImageData=_ref123.srcImageData,srcImageData=_ref123$srcImageData===void 0?'imageData':_ref123$srcImageData,_ref123$srcImageState=_ref123.srcImageState,srcImageState=_ref123$srcImageState===void 0?'imageState':_ref123$srcImageState,_ref123$destImageData=_ref123.destImageData,destImageData=_ref123$destImageData===void 0?'imageData':_ref123$destImageData,_ref123$destScalar=_ref123.destScalar,destScalar=_ref123$destScalar===void 0?'scalar':_ref123$destScalar;return[connect(/*#__PURE__*/function(){var _ref124=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee45(imageData,imageScrambler,imageBackgroundColor,shapes,scalar){var scrambledCanvas,options,canvas,ctx,path,imageDataOut;return _regeneratorRuntime().wrap(function _callee45$(_context46){while(1)switch(_context46.prev=_context46.next){case 0:if(imageScrambler){_context46.next=2;break;}return _context46.abrupt("return",imageData);case 2:_context46.prev=2;options={dataSizeScalar:getImageRedactionScaleFactor(imageData,shapes)};if(imageBackgroundColor&&imageBackgroundColor[3]>0){options.backgroundColor=_toConsumableArray(imageBackgroundColor);}_context46.next=7;return imageScrambler(imageData,options);case 7:scrambledCanvas=_context46.sent;_context46.next=12;break;case 10:_context46.prev=10;_context46.t0=_context46["catch"](2);case 12:// create drawing context
canvas=h('canvas');canvas.width=imageData.width;canvas.height=imageData.height;ctx=canvas.getContext('2d',{willReadFrequently:true});ctx.putImageData(imageData,0,0);// set up a clip path so we only draw scrambled image within path
path=new Path2D();shapes.forEach(function(shape){var rect=rectCreate(shape.x,shape.y,shape.width,shape.height);rectMultiply(rect,scalar);var corners=rectRotate(rectClone$1(rect),shape.rotation);var poly=new Path2D();corners.forEach(function(corner,i){if(i===0)return poly.moveTo(corner.x,corner.y);poly.lineTo(corner.x,corner.y);});path.addPath(poly);});ctx.clip(path,'nonzero');ctx.imageSmoothingEnabled=false;ctx.drawImage(scrambledCanvas,0,0,canvas.width,canvas.height);releaseCanvas(scrambledCanvas);// done
imageDataOut=ctx.getImageData(0,0,canvas.width,canvas.height);// clean up memory usage
releaseCanvas(canvas);return _context46.abrupt("return",imageDataOut);case 26:case"end":return _context46.stop();}},_callee45,null,[[2,10]]);}));return function(_x73,_x74,_x75,_x76,_x77){return _ref124.apply(this,arguments);};}(),function(state,_ref125){var imageScrambler=_ref125.imageScrambler;return[state[srcImageData],imageScrambler,state[srcImageState].backgroundColor,state[srcImageState].redaction,state[destScalar]];},function(state,imageData){return state[destImageData]=imageData;}),'image-data-redact'];};var ImageDataAnnotate=function ImageDataAnnotate(){var _ref126=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref126$srcImageData=_ref126.srcImageData,srcImageData=_ref126$srcImageData===void 0?'imageData':_ref126$srcImageData,_ref126$srcSize=_ref126.srcSize,srcSize=_ref126$srcSize===void 0?'size':_ref126$srcSize,_ref126$srcImageState=_ref126.srcImageState,srcImageState=_ref126$srcImageState===void 0?'imageState':_ref126$srcImageState,_ref126$destImageData=_ref126.destImageData,destImageData=_ref126$destImageData===void 0?'imageData':_ref126$destImageData,_ref126$destImageScal=_ref126.destImageScaledSize,destImageScaledSize=_ref126$destImageScal===void 0?'imageScaledSize':_ref126$destImageScal,_ref126$destScalar=_ref126.destScalar,destScalar=_ref126$destScalar===void 0?'scalar':_ref126$destScalar,_ref126$imageDataResi=_ref126.imageDataResizer,imageDataResizer=_ref126$imageDataResi===void 0?undefined:_ref126$imageDataResi,_ref126$canvasMemoryL=_ref126.canvasMemoryLimit,canvasMemoryLimit=_ref126$canvasMemoryL===void 0?undefined:_ref126$canvasMemoryL;return[connect(drawImageData,function(state,_ref127){var shapePreprocessor=_ref127.shapePreprocessor,willRequestResource=_ref127.willRequestResource,willRequest=_ref127.willRequest;// scale annotations if needed
var annotation=state[srcImageState].annotation;// skip if no annotations
if(!annotation.length)return[state[srcImageData]];var canvasScalar=state[destScalar];var crop=state[srcImageState].crop;var imageSize=state[srcSize];// image is scaled
var imageSizeScalar=canvasScalar;var imageTargetSize=state[destImageScaledSize];if(imageTargetSize){// calculate annotation scalar
imageSizeScalar=Math.min(imageTargetSize.width/crop.width,imageTargetSize.height/crop.height);}var imageSizeScaled={width:imageSize.width/canvasScalar,height:imageSize.height/canvasScalar};// go
return[state[srcImageData],{shapes:annotation,computeShape:function computeShape(shape){shape=shapeComputeDisplay(shape,imageSizeScaled);shape=filterObjectProperties(shape,['left','right','top','bottom']);shape=shapeScale(shape,imageSizeScalar);return shape;},transform:function transform(ctx){var imageSize=state[srcSize];var _state$srcImageState=state[srcImageState],_state$srcImageState$=_state$srcImageState.rotation,rotation=_state$srcImageState$===void 0?0:_state$srcImageState$,flipX=_state$srcImageState.flipX,flipY=_state$srcImageState.flipY,cropLimitToImage=_state$srcImageState.cropLimitToImage;// scale crop
var canvasScalar=state[destScalar];// scale crop if needed
var _state$srcImageState$2=state[srcImageState].crop,crop=_state$srcImageState$2===void 0?rectCreateFromSize(imageSize):_state$srcImageState$2;// calculate image scalar so we can scale annotations accordingly
var scaledSize=state[destImageScaledSize];var scalar=scaledSize?Math.min(scaledSize.width/crop.width,scaledSize.height/crop.height):1;var imageScaledSize={width:imageSize.width/canvasScalar*scalar,height:imageSize.height/canvasScalar*scalar};var rotatedRect=getImageTransformedRect(imageScaledSize,rotation);var rotatedSize={width:rotatedRect.width,height:rotatedRect.height};// calculate center
var dx=imageScaledSize.width*0.5-rotatedSize.width*0.5;var dy=imageScaledSize.height*0.5-rotatedSize.height*0.5;var center=sizeCenter(imageScaledSize);// offset
ctx.translate(-dx,-dy);ctx.translate(-crop.x*scalar,-crop.y*scalar);// rotation
ctx.translate(center.x,center.y);ctx.rotate(rotation);ctx.translate(-center.x,-center.y);// flipping
ctx.scale(flipX?-1:1,flipY?-1:1);ctx.translate(flipX?-imageScaledSize.width:0,flipY?-imageScaledSize.height:0);// annotations are clipped to image
if(cropLimitToImage){ctx.rect(0,0,imageScaledSize.width,imageScaledSize.height);ctx.clip();}},drawImage:createCanvasImageDrawer({imageDataResizer:imageDataResizer,canvasMemoryLimit:canvasMemoryLimit}),preprocessShape:function preprocessShape(shape){return shapePreprocessor(shape,_objectSpread({isPreview:false},state[srcImageState]));},canvasMemoryLimit:canvasMemoryLimit,willRequest:willRequest||willRequestResource}];},function(state,imageData){return state[destImageData]=imageData;}),'image-data-annotate'];};var ImageDataDecorate=function ImageDataDecorate(){var _ref128=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref128$srcImageData=_ref128.srcImageData,srcImageData=_ref128$srcImageData===void 0?'imageData':_ref128$srcImageData,_ref128$srcImageState=_ref128.srcImageState,srcImageState=_ref128$srcImageState===void 0?'imageState':_ref128$srcImageState,_ref128$destImageData=_ref128.destImageData,destImageData=_ref128$destImageData===void 0?'imageData':_ref128$destImageData,_ref128$destImageScal=_ref128.destImageScaledSize,destImageScaledSize=_ref128$destImageScal===void 0?'imageScaledSize':_ref128$destImageScal,_ref128$imageDataResi=_ref128.imageDataResizer,imageDataResizer=_ref128$imageDataResi===void 0?undefined:_ref128$imageDataResi,_ref128$canvasMemoryL=_ref128.canvasMemoryLimit,canvasMemoryLimit=_ref128$canvasMemoryL===void 0?undefined:_ref128$canvasMemoryL,_ref128$destScalar=_ref128.destScalar,destScalar=_ref128$destScalar===void 0?'scalar':_ref128$destScalar;return[connect(drawImageData,function(state,_ref129){var shapePreprocessor=_ref129.shapePreprocessor,willRequestResource=_ref129.willRequestResource,willRequest=_ref129.willRequest;// scale annotations if needed
var decoration=state[srcImageState].decoration;// skip if no annotations
if(!decoration.length)return[state[srcImageData]];// scale decoration and crop if needed
var scalar=state[destScalar];var crop=state[srcImageState].crop;// image is scaled
var imageTargetSize=state[destImageScaledSize];if(imageTargetSize){var imageSizeScalar=Math.min(imageTargetSize.width/crop.width,imageTargetSize.height/crop.height);scalar=imageSizeScalar;}// go
return[state[srcImageData],{shapes:decoration,drawImage:createCanvasImageDrawer({imageDataResizer:imageDataResizer,canvasMemoryLimit:canvasMemoryLimit}),computeShape:function computeShape(shape){shape=shapeComputeDisplay(shape,crop);shape=filterObjectProperties(shape,['left','right','top','bottom']);shape=shapeScale(shape,scalar);return shape;},preprocessShape:function preprocessShape(shape){return shapePreprocessor(shape,_objectSpread({isPreview:false},state[srcImageState]));},canvasMemoryLimit:canvasMemoryLimit,willRequest:willRequest||willRequestResource}];},function(state,imageData){return state[destImageData]=imageData;}),'image-data-decorate'];};var ImageDataFrame=function ImageDataFrame(){var _ref130=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref130$srcImageData=_ref130.srcImageData,srcImageData=_ref130$srcImageData===void 0?'imageData':_ref130$srcImageData,_ref130$srcImageState=_ref130.srcImageState,srcImageState=_ref130$srcImageState===void 0?'imageState':_ref130$srcImageState,_ref130$destImageData=_ref130.destImageData,destImageData=_ref130$destImageData===void 0?'imageData':_ref130$destImageData,_ref130$destImageScal=_ref130.destImageScaledSize,destImageScaledSize=_ref130$destImageScal===void 0?'imageScaledSize':_ref130$destImageScal,_ref130$imageDataResi=_ref130.imageDataResizer,imageDataResizer=_ref130$imageDataResi===void 0?undefined:_ref130$imageDataResi,_ref130$canvasMemoryL=_ref130.canvasMemoryLimit,canvasMemoryLimit=_ref130$canvasMemoryL===void 0?undefined:_ref130$canvasMemoryL,_ref130$destScalar=_ref130.destScalar,destScalar=_ref130$destScalar===void 0?'scalar':_ref130$destScalar;return[connect(drawImageData,function(state,_ref131){var shapePreprocessor=_ref131.shapePreprocessor,willRequestResource=_ref131.willRequestResource,willRequest=_ref131.willRequest;var frame=state[srcImageState].frame;if(!frame)return[state[srcImageData]];// scale crop if needed
var scalar=state[destScalar];var crop=state[srcImageState].crop;if(crop&&scalar!==1){crop=rectScale$1(rectClone$1(crop),scalar,vectorCreateEmpty());}var context=_objectSpread({},crop);var bounds=shapesBounds(shapesFromCompositShape(frame,context,shapePreprocessor),context);context.x=Math.abs(bounds.left);context.y=Math.abs(bounds.top);context.width+=Math.abs(bounds.left)+Math.abs(bounds.right);context.height+=Math.abs(bounds.top)+Math.abs(bounds.bottom);var scaledSize=state[destImageScaledSize];var contaxtScalar=scaledSize?Math.min(scaledSize.width/crop.width,scaledSize.height/crop.height):1;rectMultiply(context,contaxtScalar);// use floor because we can't fill up half pixels
context.x=Math.floor(context.x);context.y=Math.floor(context.y);context.width=Math.floor(context.width);context.height=Math.floor(context.height);return[state[srcImageData],{shapes:[frame],contextBounds:context,computeShape:function computeShape(shape){return shapeComputeDisplay(shape,state[srcImageData]);},transform:function transform(ctx){ctx.translate(context.x,context.y);},drawImage:createCanvasImageDrawer({imageDataResizer:imageDataResizer,canvasMemoryLimit:canvasMemoryLimit}),preprocessShape:function preprocessShape(shape){return shapePreprocessor(shape,_objectSpread({isPreview:false},state[srcImageState]));},canvasMemoryLimit:canvasMemoryLimit,willRequest:willRequest||willRequestResource}];},function(state,imageData){return state[destImageData]=imageData;}),'image-data-frame'];};var ImageDataToBlob=function ImageDataToBlob(){var _ref132=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref132$mimeType=_ref132.mimeType,mimeType=_ref132$mimeType===void 0?undefined:_ref132$mimeType,_ref132$quality=_ref132.quality,quality=_ref132$quality===void 0?undefined:_ref132$quality,_ref132$srcImageData=_ref132.srcImageData,srcImageData=_ref132$srcImageData===void 0?'imageData':_ref132$srcImageData,_ref132$srcFile=_ref132.srcFile,srcFile=_ref132$srcFile===void 0?'src':_ref132$srcFile,_ref132$destBlob=_ref132.destBlob,destBlob=_ref132$destBlob===void 0?'blob':_ref132$destBlob;return[connect(imageDataToBlob,function(state){return[state[srcImageData],mimeType||getMimeTypeFromFilename(state[srcFile].name)||state[srcFile].type,quality];},function(state,blob){return state[destBlob]=blob;}),'image-data-to-blob'];};var ImageDataToCanvas=function ImageDataToCanvas(){var _ref133=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref133$srcImageData=_ref133.srcImageData,srcImageData=_ref133$srcImageData===void 0?'imageData':_ref133$srcImageData,_ref133$srcOrientatio=_ref133.srcOrientation,srcOrientation=_ref133$srcOrientatio===void 0?'orientation':_ref133$srcOrientatio,_ref133$destCanvas=_ref133.destCanvas,destCanvas=_ref133$destCanvas===void 0?'dest':_ref133$destCanvas;return[connect(imageDataToCanvas,function(state){return[state[srcImageData],state[srcOrientation]];},function(state,canvas){return state[destCanvas]=canvas;}),'image-data-to-canvas'];};var writeImageHead=/*#__PURE__*/function(){var _ref134=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee46(blob,head){var view,markers,headEnd,headBuffer;return _regeneratorRuntime().wrap(function _callee46$(_context47){while(1)switch(_context47.prev=_context47.next){case 0:if(!(!isJPEG(blob)||!head)){_context47.next=2;break;}return _context47.abrupt("return",blob);case 2:// get exif section
view=new DataView(head);markers=dataViewGetApplicationMarkers(view);// no markers found
if(!(!markers||!markers.exif)){_context47.next=6;break;}return _context47.abrupt("return",blob);case 6:headEnd=['exif','mpf','xmp'].reduce(function(max,key){return markers[key]?Math.max(max,markers[key].offset+markers[key].size):max;},0);// from byte 0 to end of exif header
headBuffer=head.slice(0,headEnd+2);return _context47.abrupt("return",blobWriteSection(blob,// insert head buffer into blob
headBuffer,// current blob doesn't have exif header (as outputted by canvas), so we insert ours in
// (jpeg header 2) + (jfif size 16) + (app1 header 2)
[20]));case 9:case"end":return _context47.stop();}},_callee46);}));return function writeImageHead(_x78,_x79){return _ref134.apply(this,arguments);};}();var BlobWriteImageHead=function BlobWriteImageHead(){var srcBlob=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'blob';var srcHead=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'head';var destBlob=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'blob';return[connect(writeImageHead,function(state){return[state[srcBlob],state[srcHead]];},function(state,blob){return state[destBlob]=blob;}),'blob-write-image-head'];};var BlobToFile=function BlobToFile(){var _ref135=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref135$renameFile=_ref135.renameFile,renameFile=_ref135$renameFile===void 0?undefined:_ref135$renameFile,_ref135$srcBlob=_ref135.srcBlob,srcBlob=_ref135$srcBlob===void 0?'blob':_ref135$srcBlob,_ref135$srcFile=_ref135.srcFile,srcFile=_ref135$srcFile===void 0?'src':_ref135$srcFile,_ref135$destFile=_ref135.destFile,destFile=_ref135$destFile===void 0?'dest':_ref135$destFile,_ref135$defaultFilena=_ref135.defaultFilename,defaultFilename=_ref135$defaultFilena===void 0?undefined:_ref135$defaultFilena;return[connect(blobToFile,function(state){return[state[srcBlob],renameFile?renameFile(state[srcFile]):state[srcFile].name||"".concat(defaultFilename,".").concat(getExtensionFromMimeType(state[srcBlob].type))];},function(state,file){return state[destFile]=file;}),'blob-to-file'];};var Store=function Store(_ref136){var _ref136$url=_ref136.url,url=_ref136$url===void 0?'./':_ref136$url,_ref136$dataset=_ref136.dataset,dataset=_ref136$dataset===void 0?function(state){return[['dest',state.dest,state.dest.name],['imageState',state.imageState]];}:_ref136$dataset,_ref136$destStore=_ref136.destStore,destStore=_ref136$destStore===void 0?'store':_ref136$destStore,credentials=_ref136.credentials,_ref136$headers=_ref136.headers,headers=_ref136$headers===void 0?{}:_ref136$headers;return[connect(/*#__PURE__*/ // upload function
function(){var _ref137=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee47(dataset,onprogress){return _regeneratorRuntime().wrap(function _callee47$(_context48){while(1)switch(_context48.prev=_context48.next){case 0:_context48.next=2;return post(url,dataset,{onprogress:onprogress,beforeSend:function beforeSend(xhr){return configureXHR(xhr,{headers:headers,credentials:credentials});}});case 2:return _context48.abrupt("return",_context48.sent);case 3:case"end":return _context48.stop();}},_callee47);}));return function(_x80,_x81){return _ref137.apply(this,arguments);};}(),// get state values
function(state,options,onprogress){return[dataset(state),onprogress];},// set state values
function(state,xhr){return state[destStore]=xhr;}// logs XHR request returned by `post`
),'store'];};var PropFilter=function PropFilter(allowlist){return[connect(function(state){// if no allowlist suppleid or is empty array we don't filter
if(!allowlist||!allowlist.length)return state;// else we only allow the props defined in the list and delete non matching props
Object.keys(state).forEach(function(key){if(allowlist.includes(key))return;delete state[key];});return state;}),'prop-filter'];};// Generic image reader, suitable for most use cases
var createDefaultImageReader$1=function createDefaultImageReader$1(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _options$orientImage=options.orientImage,orientImage=_options$orientImage===void 0?true:_options$orientImage,_options$outputProps=options.outputProps,outputProps=_options$outputProps===void 0?['src','dest','size','duration']:_options$outputProps,preprocessImageFile=options.preprocessImageFile,_options$request=options.request,request=_options$request===void 0?{}:_options$request;return[// can read most source files and turn them into blobs
AnyToFile({willRequest:function willRequest(){return request;}}),// TODO: test if supported mime/type
BlobGuardMimeType(),// called when file created, can be used to read unrecognized files
preprocessImageFile&&[connect(preprocessImageFile,function(state,options,onprogress){return[state.dest,options,onprogress];},function(state,file){return state.dest=file;}),'preprocess-image-file'],// quickly read size (only reads first part of image)
BlobReadImageSize({srcProp:'dest'}),// quickly read duration
BlobReadMediaDuration({srcProp:'dest'}),// fix image orientation
orientImage&&BlobReadImageHead({srcProp:'dest'}),orientImage&&ImageHeadReadExifOrientationTag(),orientImage&&ImageSizeMatchOrientation(),// remove unwanted props
PropFilter(outputProps)].filter(Boolean);};var createStore=function createStore(store){return store&&(isString(store)?// a basic store to post to
Store({url:store}):// see if is fully custom or store config
isFunction(store)?// fully custom store function
[store,'store']:// a store configuration object
Store(store));};var createDefaultImageWriter$1=function createDefaultImageWriter$1(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return function(src,imageState){var genericOptions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};// not a video, skip
if(!isImage(src))return;// let's go!
var _options$genericOptio=_objectSpread(_objectSpread({},options),genericOptions),_options$genericOptio2=_options$genericOptio.canvasMemoryLimit,canvasMemoryLimit=_options$genericOptio2===void 0?getCanvasMemoryLimit():_options$genericOptio2,_options$genericOptio3=_options$genericOptio.orientImage,orientImage=_options$genericOptio3===void 0?true:_options$genericOptio3,_options$genericOptio4=_options$genericOptio.copyImageHead,copyImageHead=_options$genericOptio4===void 0?true:_options$genericOptio4,_options$genericOptio5=_options$genericOptio.mimeType,mimeType=_options$genericOptio5===void 0?undefined:_options$genericOptio5,_options$genericOptio6=_options$genericOptio.quality,quality=_options$genericOptio6===void 0?undefined:_options$genericOptio6,_options$genericOptio7=_options$genericOptio.renameFile,renameFile=_options$genericOptio7===void 0?undefined:_options$genericOptio7,_options$genericOptio8=_options$genericOptio.targetSize,targetSize=_options$genericOptio8===void 0?undefined:_options$genericOptio8,_options$genericOptio9=_options$genericOptio.imageDataResizer,imageDataResizer=_options$genericOptio9===void 0?undefined:_options$genericOptio9,_options$genericOptio10=_options$genericOptio.store,store=_options$genericOptio10===void 0?undefined:_options$genericOptio10,_options$genericOptio11=_options$genericOptio.format,format=_options$genericOptio11===void 0?'file':_options$genericOptio11,_options$genericOptio12=_options$genericOptio.outputProps,outputProps=_options$genericOptio12===void 0?['src','dest','imageState','store']:_options$genericOptio12,_options$genericOptio13=_options$genericOptio.preprocessImageSource,preprocessImageSource=_options$genericOptio13===void 0?undefined:_options$genericOptio13,_options$genericOptio14=_options$genericOptio.preprocessImageState,preprocessImageState=_options$genericOptio14===void 0?undefined:_options$genericOptio14,_options$genericOptio15=_options$genericOptio.postprocessImageData,postprocessImageData=_options$genericOptio15===void 0?undefined:_options$genericOptio15,_options$genericOptio16=_options$genericOptio.postprocessImageBlob,postprocessImageBlob=_options$genericOptio16===void 0?undefined:_options$genericOptio16;return[// allow preprocessing of image blob, should return a new blob, for example to automatically make image background transparent
preprocessImageSource&&[connect(preprocessImageSource,function(state,options,onprogress){return[state.src,options,onprogress,state.imageState];},function(state,src){return state.src=src;}),'preprocess-image-source'],// get orientation info (if is jpeg)
(orientImage||copyImageHead)&&BlobReadImageHead(),orientImage&&ImageHeadReadExifOrientationTag(),// get image size
BlobReadImageSize(),// allow preproccesing of image state for example to replace placeholders
preprocessImageState&&[connect(preprocessImageState,function(state,options,onprogress,metadata){return[state.imageState,options,onprogress,{size:state.size,orientation:state.orientation}];},function(state,imageState){return state.imageState=imageState;}),'preprocess-image-state'],// get image data
BlobToImageData({canvasMemoryLimit:canvasMemoryLimit}),// fix image orientation
orientImage&&ImageSizeMatchOrientation(),orientImage&&ImageDataMatchOrientation(),// apply canvas scalar to data
CalculateCanvasScalar(),// apply image state
ImageDataRedact(),ImageDataCrop(),ImageDataResize({imageDataResizer:imageDataResizer,targetSize:targetSize}),ImageDataFilter(),ImageDataFill(),ImageDataAnnotate({imageDataResizer:imageDataResizer,canvasMemoryLimit:canvasMemoryLimit}),ImageDataDecorate({imageDataResizer:imageDataResizer,canvasMemoryLimit:canvasMemoryLimit}),ImageDataFrame({imageDataResizer:imageDataResizer,canvasMemoryLimit:canvasMemoryLimit}),// run post processing on image data, for example to apply circular crop
postprocessImageData&&[connect(postprocessImageData,function(state,options,onprogress){return[state.imageData,options,onprogress];},function(state,imageData){return state.imageData=imageData;}),'postprocess-image-data'],// convert to correct output format
format==='file'?ImageDataToBlob({mimeType:mimeType,quality:quality}):format==='canvas'?ImageDataToCanvas():[function(state){state.dest=state.imageData;return state;}],// we overwite the exif orientation tag so the image is oriented correctly
format==='file'&&orientImage&&ImageHeadClearExifOrientationTag(),// we write the new image head to the target blob
format==='file'&&copyImageHead&&BlobWriteImageHead(),// allow converting the blob to a different format
postprocessImageBlob&&[connect(postprocessImageBlob,function(_ref138,options,onprogress){var blob=_ref138.blob,imageData=_ref138.imageData,src=_ref138.src;return[{blob:blob,imageData:imageData,src:src},options,onprogress];},function(state,blob){return state.blob=blob;}),'postprocess-image-file'],// turn the image blob into a file, will also rename the file
format==='file'&&BlobToFile({defaultFilename:'image',renameFile:renameFile}),// upload or process data if is a file
format==='file'?// used for file output formats
createStore(store):// used for imageData and canvas output formats
isFunction(store)&&[store,'store'],// remove unwanted props
PropFilter(outputProps)].filter(Boolean);};};var isWriter=function isWriter(param){return Array.isArray(param)||isFunction(param);};var createDefaultMediaWriter$1=function createDefaultMediaWriter$1(genericWriterOptions){for(var _len3=arguments.length,writers=new Array(_len3>1?_len3-1:0),_key6=1;_key6<_len3;_key6++){writers[_key6-1]=arguments[_key6];}return function(src,imageState){// no generic options passed
if(isWriter(genericWriterOptions))writers=[genericWriterOptions].concat(_toConsumableArray(writers));var genericOptions=isObject(genericWriterOptions)?genericWriterOptions:{};// currently assigned writers
writers=Array.isArray(writers)?arrayFlatten(writers):writers;// loop over writers and return first that is a match
for(var i=0;i<writers.length;i++){var res=writers[i](src,imageState,genericOptions);if(Array.isArray(res))return res;}};};var calculateImageTransforms=function calculateImageTransforms(stageRect,rootRect,imageSize,cropRect,imageSelectionRect,imageSelectionRectScalar,imageSelectionRectTranslation,imageScale,imageRotation,imageFlipX,imageFlipY){if(!stageRect||!rootRect||!imageSize||!cropRect||!imageScale)return undefined;// scale presentation
imageScale*=imageSelectionRectScalar;var viewRect=rectNormalizeOffset(rectClone$1(rootRect));var viewCenter=rectCenter(viewRect);var stageCenter=rectCenter(stageRect);var imageRect=rectCreateFromSize(imageSize);var imageCenter=rectCenter(imageRect);// get base crop rect so we can correctly apply transforms
var cropRectBase=getBaseCropRect(imageSize,cropRect,imageRotation);var cropRectBaseCenter=rectCenter(cropRectBase);var imageTranslation=vectorSubtract(vectorClone(imageCenter),cropRectBaseCenter);// calculate stage center offset from view center
var imageOffset=vectorSubtract(vectorClone(stageCenter),viewCenter);// correct for stage offset
imageTranslation.x+=imageOffset.x;imageTranslation.y+=imageOffset.y;// set origin of translation (so rotates around center of selection)
var imageOrigin=vectorInvert(vectorClone(imageTranslation));// correct for stage offset
imageOrigin.x+=imageOffset.x;imageOrigin.y+=imageOffset.y;// correct for image selection offset relative to view
var imageSelectionCenter=rectCenter(rectTranslate$1(rectTranslate$1(rectClone$1(imageSelectionRect),imageSelectionRectTranslation),stageRect));var imageSelectionOffset=vectorSubtract(imageSelectionCenter,stageCenter);vectorAdd(imageTranslation,imageSelectionOffset);return{origin:imageOrigin,translation:imageTranslation,rotation:{x:imageFlipY?Math.PI:0,y:imageFlipX?Math.PI:0,z:imageRotation},scale:imageScale};};var result$6=null;var supportsWebGL2=function supportsWebGL2(){if(result$6===null){if('WebGL2RenderingContext'in window){var canvas;try{canvas=h('canvas');result$6=!!canvas.getContext('webgl2');}catch(err){result$6=false;}canvas&&releaseCanvas(canvas);canvas=undefined;}else{result$6=false;}}return result$6;};var isPowerOf2=function isPowerOf2(value){return(value&value-1)===0;};var stringReplace=function stringReplace(str){var entries=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var prefix=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var postfix=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'';return Object.keys(entries).filter(function(key){return!isObject(entries[key]);}).reduce(function(prev,curr){return prev.replace(new RegExp(prefix+curr+postfix),entries[curr]);},str);};var SHADER_FRAG_HEAD="#version 300 es\nprecision highp float;\n\nout vec4 fragColor;";// eslint-disable-line
var SHADER_FRAG_INIT="\nfloat a=1.0;vec4 fillColor=uColor;vec4 textureColor=texture(uTexture,vTexCoord);textureColor*=(1.0-step(1.0,vTexCoord.y))*step(0.0,vTexCoord.y)*(1.0-step(1.0,vTexCoord.x))*step(0.0,vTexCoord.x);";// eslint-disable-line
var SHADER_FRAG_MASK="\nuniform float uMaskFeather[8];uniform float uMaskBounds[4];uniform float uMaskOpacity;float mask(float x,float y,float bounds[4],float opacity){return 1.0-(1.0-(smoothstep(bounds[3],bounds[3]+1.0,x)*(1.0-smoothstep(bounds[1]-1.0,bounds[1],x))*(1.0-step(bounds[0],y))*step(bounds[2],y)))*(1.0-opacity);}";// eslint-disable-line
var SHADER_FRAG_MASK_APPLY="\nfloat m=mask(gl_FragCoord.x,gl_FragCoord.y,uMaskBounds,uMaskOpacity);";// eslint-disable-line
var SHADER_FRAG_MASK_FEATHER_APPLY="\nfloat leftFeatherOpacity=step(uMaskFeather[1],gl_FragCoord.x)*uMaskFeather[0]+((1.0-uMaskFeather[0])*smoothstep(uMaskFeather[1],uMaskFeather[3],gl_FragCoord.x));float rightFeatherOpacity=(1.0-step(uMaskFeather[7],gl_FragCoord.x))*uMaskFeather[4]+((1.0-uMaskFeather[4])*smoothstep(uMaskFeather[7],uMaskFeather[5],gl_FragCoord.x));a*=leftFeatherOpacity*rightFeatherOpacity;";// eslint-disable-line
var SHADER_FRAG_RECT_AA="\nvec2 scaledPoint=vec2(vRectCoord.x*uSize.x,vRectCoord.y*uSize.y);a*=smoothstep(0.0,1.0,uSize.x-scaledPoint.x);a*=smoothstep(0.0,1.0,uSize.y-scaledPoint.y);a*=smoothstep(0.0,1.0,scaledPoint.x);a*=smoothstep(0.0,1.0,scaledPoint.y);";// eslint-disable-line
var SHADER_FRAG_CORNER_RADIUS="\nvec2 s=(uSize-2.0)*.5;vec2 r=(vRectCoord*uSize);vec2 p=r-(uSize*.5);float cornerRadius=uCornerRadius[0];bool left=r.x<s.x;bool top=r.y<s.x;if(!left&&top){cornerRadius=uCornerRadius[1];}if(!left&&!top){cornerRadius=uCornerRadius[3];}if(left&&!top){cornerRadius=uCornerRadius[2];}a*=1.0-clamp(length(max(abs(p)-(s-cornerRadius),0.0))-cornerRadius,0.0,1.0);";// eslint-disable-line
var SHADER_FRAG_SHAPE_BLEND_COLOR="\nif(m<=0.0)discard;fillColor.a*=a;fillColor.rgb*=fillColor.a;fillColor.rgb*=m;fillColor.rgb+=(1.0-m)*(uCanvasColor.rgb*fillColor.a);textureColor*=uTextureOpacity;textureColor.a*=a;textureColor.rgb*=m*a;textureColor.rgb+=(1.0-m)*(uCanvasColor.rgb*textureColor.a);fragColor=textureColor+(fillColor*(1.0-textureColor.a));";// eslint-disable-line
var SHADER_FRAG_TEXTURE_COLORIZE="\nif(uTextureColor.a!=0.0&&textureColor.a>0.0){vec3 colorFlattened=textureColor.rgb/textureColor.a;if(colorFlattened.r>=.9999&&colorFlattened.g==0.0&&colorFlattened.b>=.9999){textureColor.rgb=uTextureColor.rgb*textureColor.a;}textureColor*=uTextureColor.a;}";// eslint-disable-line
var SHADER_VERT_HEAD="#version 300 es\n\nin vec4 aPosition;uniform mat4 uMatrix;";// eslint-disable-line
var SHADER_VERT_MULTIPLY_MATRUX="\ngl_Position=uMatrix*vec4(aPosition.x,aPosition.y,0,1);";// eslint-disable-line
var SHADER_VERT_TEXTURE="\nin vec2 aTexCoord;out vec2 vTexCoord;";// eslint-disable-line
var SHADER_VERT_SNIPPETS={head:SHADER_VERT_HEAD,text:SHADER_VERT_TEXTURE,matrix:SHADER_VERT_MULTIPLY_MATRUX};var SHADER_FRAG_SNIPPETS={head:SHADER_FRAG_HEAD,mask:SHADER_FRAG_MASK,init:SHADER_FRAG_INIT,colorize:SHADER_FRAG_TEXTURE_COLORIZE,maskapply:SHADER_FRAG_MASK_APPLY,maskfeatherapply:SHADER_FRAG_MASK_FEATHER_APPLY,edgeaa:SHADER_FRAG_RECT_AA,cornerradius:SHADER_FRAG_CORNER_RADIUS,fragcolor:SHADER_FRAG_SHAPE_BLEND_COLOR};var transpileShader=function transpileShader(gl,src,type){src=stringReplace(src,type===gl.VERTEX_SHADER?SHADER_VERT_SNIPPETS:SHADER_FRAG_SNIPPETS,'##').trim();// ready if supports webgl
if(supportsWebGL2())return src;src=src.replace(/#version.+/gm,'').trim();src=src.replace(/^\/\/\#/gm,'#');if(type===gl.VERTEX_SHADER){src=src.replace(/in /gm,'attribute ').replace(/out /g,'varying ');}if(type===gl.FRAGMENT_SHADER){src=src.replace(/in /gm,'varying ').replace(/out.*?;/gm,'').replace(/texture\(/g,'texture2D(').replace(/fragColor/g,'gl_FragColor');}return"".concat(src);};var compileShader=function compileShader(gl,src,type){var shader=gl.createShader(type);var transpiledSrc=transpileShader(gl,src,type);gl.shaderSource(shader,transpiledSrc);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){console.error(gl.getShaderInfoLog(shader));}return shader;};var createShader=function createShader(gl,vertexShaderCode,fragmentShaderCode,attribs,uniforms){var vertexShader=compileShader(gl,vertexShaderCode,gl.VERTEX_SHADER);var fragmentShader=compileShader(gl,fragmentShaderCode,gl.FRAGMENT_SHADER);var program=gl.createProgram();gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);var locations={};attribs.forEach(function(name){locations[name]=gl.getAttribLocation(program,name);});uniforms.forEach(function(name){locations[name]=gl.getUniformLocation(program,name);});return{program:program,locations:locations,destroy:function destroy(){gl.detachShader(program,vertexShader);gl.detachShader(program,fragmentShader);gl.deleteShader(vertexShader);gl.deleteShader(fragmentShader);gl.deleteProgram(program);}};};var canMipMap=function canMipMap(source){if(source['nodeName']==='VIDEO')return false;if(supportsWebGL2())return true;return isPowerOf2(source.width)&&isPowerOf2(source.height);};var applyTextureProperties=function applyTextureProperties(gl,source,options){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,canMipMap(source)?gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,options.filter);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);if(canMipMap(source))gl.generateMipmap(gl.TEXTURE_2D);};var updateTexture=function updateTexture(gl,texture,source,options){gl.bindTexture(gl.TEXTURE_2D,texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,source);applyTextureProperties(gl,source,options);gl.bindTexture(gl.TEXTURE_2D,null);return texture;};var applyOpacity=function applyOpacity(color){var opacity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return color?[color[0],color[1],color[2],isNumber(color[3])?opacity*color[3]:opacity]:[0,0,0,0];};var mat4Create=function mat4Create(){var mat=new Float32Array(16);mat[0]=1;mat[5]=1;mat[10]=1;mat[15]=1;return mat;};var mat4Perspective=function mat4Perspective(mat,fovy,aspect,near,far){var f=1.0/Math.tan(fovy/2);var nf=1/(near-far);mat[0]=f/aspect;mat[1]=0;mat[2]=0;mat[3]=0;mat[4]=0;mat[5]=f;mat[6]=0;mat[7]=0;mat[8]=0;mat[9]=0;mat[10]=(far+near)*nf;mat[11]=-1;mat[12]=0;mat[13]=0;mat[14]=2*far*near*nf;mat[15]=0;};var mat4Ortho=function mat4Ortho(mat,left,right,bottom,top,near,far){var lr=1/(left-right);var bt=1/(bottom-top);var nf=1/(near-far);mat[0]=-2*lr;mat[1]=0;mat[2]=0;mat[3]=0;mat[4]=0;mat[5]=-2*bt;mat[6]=0;mat[7]=0;mat[8]=0;mat[9]=0;mat[10]=2*nf;mat[11]=0;mat[12]=(left+right)*lr;mat[13]=(top+bottom)*bt;mat[14]=(far+near)*nf;mat[15]=1;};var mat4Translate=function mat4Translate(mat,x,y,z){mat[12]=mat[0]*x+mat[4]*y+mat[8]*z+mat[12];mat[13]=mat[1]*x+mat[5]*y+mat[9]*z+mat[13];mat[14]=mat[2]*x+mat[6]*y+mat[10]*z+mat[14];mat[15]=mat[3]*x+mat[7]*y+mat[11]*z+mat[15];};var mat4Scale=function mat4Scale(mat,s){mat[0]*=s;mat[1]*=s;mat[2]*=s;mat[3]*=s;mat[4]*=s;mat[5]*=s;mat[6]*=s;mat[7]*=s;mat[8]*=s;mat[9]*=s;mat[10]*=s;mat[11]*=s;};var mat4ScaleX=function mat4ScaleX(mat,s){mat[0]*=s;mat[1]*=s;mat[2]*=s;mat[3]*=s;};var mat4ScaleY=function mat4ScaleY(mat,s){mat[4]*=s;mat[5]*=s;mat[6]*=s;mat[7]*=s;};var mat4RotateX=function mat4RotateX(mat,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a10=mat[4];var a11=mat[5];var a12=mat[6];var a13=mat[7];var a20=mat[8];var a21=mat[9];var a22=mat[10];var a23=mat[11];mat[4]=a10*c+a20*s;mat[5]=a11*c+a21*s;mat[6]=a12*c+a22*s;mat[7]=a13*c+a23*s;mat[8]=a20*c-a10*s;mat[9]=a21*c-a11*s;mat[10]=a22*c-a12*s;mat[11]=a23*c-a13*s;};var mat4RotateY=function mat4RotateY(mat,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a00=mat[0];var a01=mat[1];var a02=mat[2];var a03=mat[3];var a20=mat[8];var a21=mat[9];var a22=mat[10];var a23=mat[11];mat[0]=a00*c-a20*s;mat[1]=a01*c-a21*s;mat[2]=a02*c-a22*s;mat[3]=a03*c-a23*s;mat[8]=a00*s+a20*c;mat[9]=a01*s+a21*c;mat[10]=a02*s+a22*c;mat[11]=a03*s+a23*c;};var mat4RotateZ=function mat4RotateZ(mat,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a00=mat[0];var a01=mat[1];var a02=mat[2];var a03=mat[3];var a10=mat[4];var a11=mat[5];var a12=mat[6];var a13=mat[7];mat[0]=a00*c+a10*s;mat[1]=a01*c+a11*s;mat[2]=a02*c+a12*s;mat[3]=a03*c+a13*s;mat[4]=a10*c-a00*s;mat[5]=a11*c-a01*s;mat[6]=a12*c-a02*s;mat[7]=a13*c-a03*s;};var degToRad=function degToRad(degrees){return degrees*Math.PI/180;};var getWebGLContext=function getWebGLContext(canvas,attrs){if(supportsWebGL2())return canvas.getContext('webgl2',attrs);return canvas.getContext('webgl',attrs)||canvas.getContext('experimental-webgl',attrs);};var imageFragmentShader="\n##head\nin vec2 vTexCoord;uniform sampler2D uTexture;uniform sampler2D uTextureOverlay;uniform sampler2D uTextureBlend;uniform vec2 uTextureSize;uniform float uOpacity;uniform int uAntialias;uniform vec4 uOverlayColor;uniform mat4 uColorMatrix;uniform vec4 uColorOffset;uniform float uClarityKernel[9];uniform float uClarityKernelWeight;uniform float uColorGamma;uniform float uColorVignette;uniform float uMaskClip;uniform float uMaskOpacity;uniform float uMaskBounds[4];uniform float uMaskCornerRadius[4];uniform float uMaskFeather[8];vec4 applyGamma(vec4 c,float g){c.r=pow(c.r,g);c.g=pow(c.g,g);c.b=pow(c.b,g);return c;}vec4 applyColorMatrix(vec4 c,mat4 m,vec4 o){return(c*m)+(o*c.a);}vec4 applyConvolutionMatrix(vec4 c,float k0,float k1,float k2,float k3,float k4,float k5,float k6,float k7,float k8,float w){vec2 pixel=vec2(1)/uTextureSize;vec4 colorSum=texture(uTexture,vTexCoord-pixel)*k0+texture(uTexture,vTexCoord+pixel*vec2(0.0,-1.0))*k1+texture(uTexture,vTexCoord+pixel*vec2(1.0,-1.0))*k2+texture(uTexture,vTexCoord+pixel*vec2(-1.0,0.0))*k3+texture(uTexture,vTexCoord)*k4+texture(uTexture,vTexCoord+pixel*vec2(1.0,0.0))*k5+texture(uTexture,vTexCoord+pixel*vec2(-1.0,1.0))*k6+texture(uTexture,vTexCoord+pixel*vec2(0.0,1.0))*k7+texture(uTexture,vTexCoord+pixel)*k8;vec4 color=vec4(clamp((colorSum/w),0.0,1.0).rgb,c.a);return color;}vec4 applyVignette(vec4 c,vec2 pos,vec2 center,float v){float d=distance(pos,center)/length(center);float f=1.0-(d*abs(v));if(v>0.0){c.rgb*=f;}else if(v<0.0){c.rgb+=(1.0-f)*(1.0-c.rgb);}return c;}vec4 blendPremultipliedAlpha(vec4 back,vec4 front){return front+(back*(1.0-front.a));}void main(){float x=gl_FragCoord.x;float y=gl_FragCoord.y;float a=1.0;float maskTop=uMaskBounds[0];float maskRight=uMaskBounds[1];float maskBottom=uMaskBounds[2];float maskLeft=uMaskBounds[3];float leftFeatherOpacity=step(uMaskFeather[1],x)*uMaskFeather[0]+((1.0-uMaskFeather[0])*smoothstep(uMaskFeather[1],uMaskFeather[3],x));float rightFeatherOpacity=(1.0-step(uMaskFeather[7],x))*uMaskFeather[4]+((1.0-uMaskFeather[4])*smoothstep(uMaskFeather[7],uMaskFeather[5],x));a*=leftFeatherOpacity*rightFeatherOpacity;float overlayColorAlpha=(smoothstep(maskLeft,maskLeft+1.0,x)*(1.0-smoothstep(maskRight-1.0,maskRight,x))*(1.0-step(maskTop,y))*step(maskBottom,y));if(uOverlayColor.a==0.0){a*=overlayColorAlpha;}vec2 offset=vec2(maskLeft,maskBottom);vec2 size=vec2(maskRight-maskLeft,maskTop-maskBottom)*.5;vec2 center=offset.xy+size.xy;int pixelX=int(step(center.x,x));int pixelY=int(step(y,center.y));float cornerRadius=0.0;if(pixelX==0&&pixelY==0)cornerRadius=uMaskCornerRadius[0];if(pixelX==1&&pixelY==0)cornerRadius=uMaskCornerRadius[1];if(pixelX==0&&pixelY==1)cornerRadius=uMaskCornerRadius[2];if(pixelX==1&&pixelY==1)cornerRadius=uMaskCornerRadius[3];float cornerOffset=sign(cornerRadius)*length(max(abs(gl_FragCoord.xy-size-offset)-size+cornerRadius,0.0))-cornerRadius;float cornerOpacity=1.0-smoothstep(0.0,1.0,cornerOffset);a*=cornerOpacity;if(uAntialias==1){vec2 scaledPoint=vec2(vTexCoord.x*uTextureSize.x,vTexCoord.y*uTextureSize.y);a*=smoothstep(0.0,1.0,uTextureSize.x-scaledPoint.x);a*=smoothstep(0.0,1.0,uTextureSize.y-scaledPoint.y);a*=smoothstep(0.0,1.0,scaledPoint.x);a*=smoothstep(0.0,1.0,scaledPoint.y);}vec4 color=texture(uTexture,vTexCoord);if(uClarityKernelWeight!=-1.0){color=applyConvolutionMatrix(color,uClarityKernel[0],uClarityKernel[1],uClarityKernel[2],uClarityKernel[3],uClarityKernel[4],uClarityKernel[5],uClarityKernel[6],uClarityKernel[7],uClarityKernel[8],uClarityKernelWeight);}color=blendPremultipliedAlpha(color,texture(uTextureBlend,vTexCoord));color=applyGamma(color,uColorGamma);color=applyColorMatrix(color,uColorMatrix,uColorOffset);color*=a;if(uColorVignette!=0.0){vec2 pos=gl_FragCoord.xy-offset;color=applyVignette(color,pos,center-offset,uColorVignette);}color=blendPremultipliedAlpha(color,texture(uTextureOverlay,vTexCoord));if(overlayColorAlpha<=0.0){color*=1.0-uOverlayColor.a;}color*=uOpacity;fragColor=color;}";// eslint-disable-line
var imageVertexShader="\n##head\n##text\nvoid main(){vTexCoord=aTexCoord;gl_Position=uMatrix*aPosition;}";// eslint-disable-line
var pathVertexShader="#version 300 es\n\nin vec4 aPosition;in vec2 aNormal;in float aMiter;out vec2 vNormal;out float vMiter;out float vWidth;uniform float uWidth;uniform float uSharpness;uniform mat4 uMatrix;void main(){vMiter=aMiter;vNormal=aNormal;vWidth=(uWidth*.5)+uSharpness;gl_Position=uMatrix*vec4(aPosition.x+(aNormal.x*vWidth*aMiter),aPosition.y+(aNormal.y*vWidth*aMiter),0,1);}";// eslint-disable-line
var pathFragmentShader="\n##head\n##mask\nin vec2 vNormal;in float vMiter;in float vWidth;uniform float uWidth;uniform vec4 uColor;uniform vec4 uCanvasColor;void main(){vec4 fillColor=uColor;float m=mask(gl_FragCoord.x,gl_FragCoord.y,uMaskBounds,uMaskOpacity);if(m<=0.0)discard;fillColor.a*=clamp(smoothstep(vWidth-.5,vWidth-1.0,abs(vMiter)*vWidth),0.0,1.0);fillColor.rgb*=fillColor.a;fillColor.rgb*=m;fillColor.rgb+=(1.0-m)*(uCanvasColor.rgb*fillColor.a);fragColor=fillColor;}";// eslint-disable-line
var rectVertexShader="\n##head\n##text\nin vec2 aRectCoord;out vec2 vRectCoord;void main(){vTexCoord=aTexCoord;vRectCoord=aRectCoord;\n##matrix\n}";// eslint-disable-line
var rectFragmentShader="\n##head\n##mask\nin vec2 vTexCoord;in vec2 vRectCoord;uniform sampler2D uTexture;uniform vec4 uTextureColor;uniform float uTextureOpacity;uniform vec4 uColor;uniform float uCornerRadius[4];uniform vec2 uSize;uniform vec2 uPosition;uniform vec4 uCanvasColor;uniform int uInverted;void main(){\n##init\n##colorize\n##edgeaa\n##cornerradius\n##maskfeatherapply\nif(uInverted==1)a=1.0-a;\n##maskapply\n##fragcolor\n}";// eslint-disable-line
var ellipseVertexShader="\n##head\n##text\nout vec2 vTexCoordDouble;void main(){vTexCoordDouble=vec2(aTexCoord.x*2.0-1.0,aTexCoord.y*2.0-1.0);vTexCoord=aTexCoord;\n##matrix\n}";// eslint-disable-line
var ellipseFragmentShader="\n##head\n##mask\nin vec2 vTexCoord;in vec2 vTexCoordDouble;uniform sampler2D uTexture;uniform float uTextureOpacity;uniform vec2 uRadius;uniform vec4 uColor;uniform int uInverted;uniform vec4 uCanvasColor;void main(){\n##init\nfloat ar=uRadius.x/uRadius.y;vec2 rAA=vec2(uRadius.x-1.0,uRadius.y-(1.0/ar));vec2 scaledPointSq=vec2((vTexCoordDouble.x*uRadius.x)*(vTexCoordDouble.x*uRadius.x),(vTexCoordDouble.y*uRadius.y)*(vTexCoordDouble.y*uRadius.y));float p=(scaledPointSq.x/(uRadius.x*uRadius.x))+(scaledPointSq.y/(uRadius.y*uRadius.y));float pAA=(scaledPointSq.x/(rAA.x*rAA.x))+(scaledPointSq.y/(rAA.y*rAA.y));a=smoothstep(1.0,p/pAA,p);if(uInverted==1)a=1.0-a;\n##maskapply\n##fragcolor\n}";// eslint-disable-line
var triangleVertexShader="\n##head\nvoid main(){\n##matrix\n}";// eslint-disable-line
var triangleFragmentShader="\n##head\n##mask\nuniform vec4 uColor;uniform vec4 uCanvasColor;void main(){vec4 fillColor=uColor;\n##maskapply\nfillColor.rgb*=fillColor.a;fillColor.rgb*=m;fillColor.rgb+=(1.0-m)*(uCanvasColor.rgb*fillColor.a);fragColor=fillColor;}";// eslint-disable-line
var getIndex=function getIndex(arr,index){var l=arr.length;if(index>=l)return arr[index%l];if(index<0)return arr[index%l+l];return arr[index];};var getPolygonArea=function getPolygonArea(vertices){var area=0,i,va,vb,w,h;var l=vertices.length;for(i=0;i<l;i++){va=vertices[i];vb=vertices[(i+1)%l];w=vb.x-va.x;h=(vb.y+va.y)/2;area+=w*h;}return area;};var isPointInTriangle=function isPointInTriangle(p,a,b,c){var ab=vectorCreate(b.x-a.x,b.y-a.y);var bc=vectorCreate(c.x-b.x,c.y-b.y);var ca=vectorCreate(a.x-c.x,a.y-c.y);var ap=vectorCreate(p.x-a.x,p.y-a.y);var bp=vectorCreate(p.x-b.x,p.y-b.y);var cp=vectorCreate(p.x-c.x,p.y-c.y);var c1=vectorCross(ab,ap);var c2=vectorCross(bc,bp);var c3=vectorCross(ca,cp);return c1<=0&&c2<=0&&c3<=0;};var isIntersectingSelf=function isIntersectingSelf(vertices){// test if lines intersect
var l=vertices.length;for(var i=0;i<l;i++){var line=lineCreate(vertices[i],getIndex(vertices,i+1));var intersections=linePointsIntersection(line,vertices,{ignoreIdenticalLines:true,breakOnIntersection:true});// is intersecting
if(intersections)return true;}return false;};var triangulate=function triangulate(vertices){// not enough vertices
if(vertices.length<3)return[];// test if is simple polygon
if(isIntersectingSelf(vertices))return[];// if vertices aren't clockwise, reverse
if(getPolygonArea(vertices)<0)vertices.reverse();// TODO: remove 180 degree corners, vertices should either be convex (< 180) or reflex (> 180), this happens when three vertices are in the same line
// triangulate
var totalVertices=vertices.length;var indexList=_toConsumableArray(Array(totalVertices).keys());var triangles=[];// faster to declare vars out of loop
var i,j,a,b,c,va,vb,vc,vaToVb,vaToVc,isEar,p;var safe=128;while(indexList.length>3){// safeguard against infinite loops
if(safe<=0)return[];// lower safeguard
safe--;// start calculating triangles
for(i=0;i<indexList.length;i++){a=indexList[i];b=getIndex(indexList,i-1);c=getIndex(indexList,i+1);va=vertices[a];vb=vertices[b];vc=vertices[c];vaToVb=vectorCreate(vb.x-va.x,vb.y-va.y);vaToVc=vectorCreate(vc.x-va.x,vc.y-va.y);// is not an ear if is reflex corner (angle > 180)
if(vectorCross(vaToVb,vaToVc)<0)continue;isEar=true;for(j=0;j<totalVertices;j++){// skip as is me
if(j===a||j===b||j===c)continue;// is not an ear if another vertex falls in this triangle
p=vertices[j];if(isPointInTriangle(p,vb,va,vc)){isEar=false;break;}}// skip
if(!isEar)continue;// found ear
triangles.push([vb,va,vc]);// no longer interested in this index
indexList.splice(i,1);break;}}// finale triangle
triangles.push([vertices[indexList[0]],vertices[indexList[1]],vertices[indexList[2]]]);return triangles;};var createPathSegment=function createPathSegment(vertices,index,a,b,c){var ab=vectorNormalize(vectorCreate(b.x-a.x,b.y-a.y));var bc=vectorNormalize(vectorCreate(c.x-b.x,c.y-b.y));var tangent=vectorNormalize(vectorCreate(ab.x+bc.x,ab.y+bc.y));var miter=vectorCreate(-tangent.y,tangent.x);var normal=vectorCreate(-ab.y,ab.x);// limit miter length (TEMP fix to prevent spikes, should eventually add caps)
var miterLength=Math.min(1/vectorDot(miter,normal),5);vertices[index]=b.x;vertices[index+1]=b.y;vertices[index+2]=miter.x*miterLength;vertices[index+3]=miter.y*miterLength;vertices[index+4]=-1;vertices[index+5]=b.x;vertices[index+6]=b.y;vertices[index+7]=miter.x*miterLength;vertices[index+8]=miter.y*miterLength;vertices[index+9]=1;};var createPathVertices=function createPathVertices(points,close){var a,b,c,i=0;var l=points.length;var stride=10;var vertices=new Float32Array((close?l+1:l)*stride);var first=points[0];var last=points[l-1];for(i=0;i<l;i++){a=points[i-1];b=points[i];c=points[i+1];// if previous point not available use inverse vector to next point
if(!a)a=close?last:vectorCreate(b.x+(b.x-c.x),b.y+(b.y-c.y));// if next point not available use inverse vector from previous point
if(!c)c=close?first:vectorCreate(b.x+(b.x-a.x),b.y+(b.y-a.y));createPathSegment(vertices,i*stride,a,b,c);}if(close)createPathSegment(vertices,l*stride,last,first,points[1]);return vertices;};var rectPointsToVertices=function rectPointsToVertices(points){// [tl, tr, br, bl]
// B   D
// | \ |
// A  C
var vertices=new Float32Array(8);vertices[0]=points[3].x;vertices[1]=points[3].y;vertices[2]=points[0].x;vertices[3]=points[0].y;vertices[4]=points[2].x;vertices[5]=points[2].y;vertices[6]=points[1].x;vertices[7]=points[1].y;return vertices;};var createRectPoints=function createRectPoints(rect){var rotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var flipX=arguments.length>2?arguments[2]:undefined;var flipY=arguments.length>3?arguments[3]:undefined;var corners=rectGetCorners(rect);var cx=rect.x+rect.width*0.5;var cy=rect.y+rect.height*0.5;if(flipX||flipY)vectorsFlip(corners,flipX,flipY,cx,cy);if(rotation!==0)vectorsRotate(corners,rotation,cx,cy);return corners;};var createEllipseOutline=function createEllipseOutline(x,y,width,height,rotation,flipX,flipY){var rx=Math.abs(width)*0.5;var ry=Math.abs(height)*0.5;var size=Math.abs(width)+Math.abs(height);var precision=Math.max(20,Math.round(size/6));return ellipseToPolygon(vectorCreate(x+rx,y+ry),rx,ry,rotation,flipX,flipY,precision);};var createRectOutline=function createRectOutline(x,y,width,height,rotation,cornerRadius,flipX,flipY){var points=[];if(cornerRadius.every(function(v){return v===0;})){points.push(vectorCreate(x,y),// top left corner
vectorCreate(x+width,y),// top right corner
vectorCreate(x+width,y+height),// bottom right corner
vectorCreate(x,y+height)// bottom left corner
);}else{var _cornerRadius=_slicedToArray(cornerRadius,4),tl=_cornerRadius[0],tr=_cornerRadius[1],bl=_cornerRadius[2],br=_cornerRadius[3];var l=x;var _r5=x+width;var _t2=y;var b=y+height;// start at end of top left corner
points.push(vectorCreate(l+tl,_t2));pushRectCornerPoints(points,_r5-tr,_t2+tr,tr,-1);// move to bottom right corner
points.push(vectorCreate(_r5,_t2+tr));pushRectCornerPoints(points,_r5-br,b-br,br,0);// move to bottom left corner
points.push(vectorCreate(_r5-br,b));pushRectCornerPoints(points,l+bl,b-bl,bl,1);// move to top left corner
points.push(vectorCreate(l,b-bl));pushRectCornerPoints(points,l+tl,_t2+tl,tl,2);}if(flipX||flipY)vectorsFlip(points,flipX,flipY,x+width*0.5,y+height*0.5);if(rotation)vectorsRotate(points,rotation,x+width*0.5,y+height*0.5);return points;};var pushRectCornerPoints=function pushRectCornerPoints(points,x,y,radius,offset){var precision=Math.min(20,Math.max(4,Math.round(radius/2)));var p=0;var s=0;var rx=0;var ry=0;var i=0;for(;i<precision;i++){p=i/precision;s=offset*HALF_PI+p*HALF_PI;rx=radius*Math.cos(s);ry=radius*Math.sin(s);points.push(vectorCreate(x+rx,y+ry));}};var limit=null;var getWebGLTextureSizeLimit=function getWebGLTextureSizeLimit(){if(limit!==null)return limit;var canvas=h('canvas');var gl=getWebGLContext(canvas);limit=gl?gl.getParameter(gl.MAX_TEXTURE_SIZE):undefined;releaseCanvas(canvas);canvas=undefined;return limit;};var result$5=null;var isFirefox=function isFirefox(){if(result$5===null)result$5=isUserAgent(/Firefox/);return result$5;};// prettier-ignore
// B   D
// | \ |
// A  C
var RECT_UV=new Float32Array([0.0,1.0,0.0,0.0,1.0,1.0,1.0,0.0// D
]);// prettier-ignore
// BROWSER BUG FIX: Here to fix Firefox video texture rotation issue
var RECT_UV_ROTATED=new Float32Array([1.0,0.0,0.0,0.0,1.0,1.0,0.0,1.0// D
]);var SHOULD_APPLY_ROTATED_UV_TO_VIDEO_TEXTURES=isBrowser()&&isFirefox();var CLARITY_IDENTITY=[0,0,0,0,1,0,0,0,0];var COLOR_MATRIX_IDENTITY$1=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];var TEXTURE_TRANSPARENT_INDEX=0;var TEXTURE_PREVIEW_BLEND_INDEX=1;var TEXTURE_PREVIEW_OVERLAY_INDEX=2;var TEXTURE_PREVIEW_INDEX=3;var TEXTURE_SHAPE_INDEX=4;var COLOR_TRANSPARENT=[0,0,0,0];var NO_CORNERS=[0,0,0,0];var calculateBackgroundUVMap=function calculateBackgroundUVMap(width,height,backgroundSize,backgroundPosition,viewPixelDensity){if(!backgroundSize||!backgroundPosition)return RECT_UV;var x=backgroundPosition.x/backgroundSize.width;var y=backgroundPosition.y/backgroundSize.height;var w=width/backgroundSize.width/viewPixelDensity;var h=height/backgroundSize.height/viewPixelDensity;w-=x;h-=y;// prettier-ignore
// B   D
// | \ |
// A  C
// bottom left
var ax=-x;var ay=h;// top left
var bx=-x;var by=-y;// bottom right
var cx=w;var cy=h;// top right
var dx=w;var dy=-y;return new Float32Array([ax,ay,bx,by,cx,cy,dx,dy// D
]);};var limitCornerRadius=function limitCornerRadius(r,size){return Math.floor(clamp(r,0,Math.min((size.width-1)*0.5,(size.height-1)*0.5)));};var createWebGLCanvas=function createWebGLCanvas(canvas){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};// defaults
var _options$alpha=options.alpha,alpha=_options$alpha===void 0?false:_options$alpha;// go
var viewSize={width:0,height:0};var viewSizeVisual={width:0,height:0};var textureSizeLimit=getWebGLTextureSizeLimit()||1024;var viewAspectRatio;var viewPixelDensity;var pathSharpness;var overlayMatrixCanvas=mat4Create();var imageFrameBuffer=mat4Create();var overlayMatrix;var maskTop;var maskRight;var maskBottom;var maskLeft;var maskOpacity;var maskBounds;var IMAGE_MASK_FEATHER;// updated when viewport is resized
var RECT_MASK_FEATHER;var CANVAS_COLOR_R=0;var CANVAS_COLOR_G=0;var CANVAS_COLOR_B=0;var CANVAS_COLOR_A=1;var indexTextureMap=new Map([]);// resize view
var resize=function resize(width,height,pixelDensity){// density
viewPixelDensity=pixelDensity;// set path sharpness factor so paths look a little nicer on low res displays
pathSharpness=viewPixelDensity===1?0.75:1;// visual size
viewSizeVisual.width=width;viewSizeVisual.height=height;// size
viewSize.width=width*viewPixelDensity;viewSize.height=height*viewPixelDensity;// calculate the aspect ratio, we use this to determine quad size
viewAspectRatio=getAspectRatio(viewSize.width,viewSize.height);// sync dimensions with image data
canvas.width=viewSize.width;canvas.height=viewSize.height;// update canvas markup matrix
mat4Ortho(overlayMatrixCanvas,0,viewSize.width,viewSize.height,0,-1,1);IMAGE_MASK_FEATHER=[1,0,1,0,1,viewSizeVisual.width,1,viewSizeVisual.width];};var enablePreviewStencil=function enablePreviewStencil(){gl.stencilOp(gl.KEEP,gl.KEEP,gl.REPLACE);gl.stencilFunc(gl.ALWAYS,1,0xff);gl.stencilMask(0xff);};var applyPreviewStencil=function applyPreviewStencil(){gl.stencilFunc(gl.EQUAL,1,0xff);gl.stencilMask(0x00);};var disablePreviewStencil=function disablePreviewStencil(){gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP);gl.stencilFunc(gl.ALWAYS,1,0xff);gl.stencilMask(0xff);};// fov is fixed
var FOV=degToRad(30);var FOV_TAN_HALF=Math.tan(FOV/2);// get gl drawing context
var gl=getWebGLContext(canvas,{alpha:alpha,antialias:false,premultipliedAlpha:true,stencil:true});// no drawing context received, exit
if(!gl)return;// enable derivatives
gl.getExtension('OES_standard_derivatives');// toggle gl settings
gl.disable(gl.DEPTH_TEST);// need stencil to draw overlay on preview only
gl.enable(gl.STENCIL_TEST);// set blend mode, we need it for alpha blending
gl.enable(gl.BLEND);/*
    https://webglfundamentals.org/webgl/lessons/webgl-and-alpha.html
    most if not all Canvas 2D implementations work with pre-multiplied alpha.
    That means when you transfer them to WebGL and UNPACK_PREMULTIPLY_ALPHA_WEBGL
    is false WebGL will convert them back to un-premultipiled.
    With pre-multiplied alpha on, [1, .5, .5, 0] does not exist, it's always [0, 0, 0, 0]
    */gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!alpha&&isFirefox()?false:true);// something to look into:
// gl.UNPACK_COLORSPACE_CONVERSION_WEBGL
// stencil test always passes
disablePreviewStencil();// let's create textures
var transparentTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,transparentTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,// width
1,// height
0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(COLOR_TRANSPARENT)// transparent background
);indexTextureMap.set(TEXTURE_TRANSPARENT_INDEX,transparentTexture);// create image markup texture and framebuffer
var imageOverlayTexture=gl.createTexture();indexTextureMap.set(TEXTURE_PREVIEW_OVERLAY_INDEX,imageOverlayTexture);var overlayFramebuffer=gl.createFramebuffer();// create image blend texture and framebuffer
var imageBlendTexture=gl.createTexture();indexTextureMap.set(TEXTURE_PREVIEW_BLEND_INDEX,imageBlendTexture);var blendFramebuffer=gl.createFramebuffer();// #region image
// create default pixel drawing program, supports what we need
var imageShader=createShader(gl,imageVertexShader,imageFragmentShader,['aPosition','aTexCoord'],['uMatrix','uTexture','uTextureBlend','uTextureOverlay','uTextureSize','uColorGamma','uColorVignette','uColorOffset','uColorMatrix','uClarityKernel','uClarityKernelWeight','uOpacity','uMaskOpacity','uMaskBounds','uMaskCornerRadius','uMaskFeather','uOverlayColor','uAntialias']);// create image buffers
var imagePositionsBuffer=gl.createBuffer();var texturePositionsBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,texturePositionsBuffer);gl.bufferData(gl.ARRAY_BUFFER,RECT_UV,gl.STATIC_DRAW);// BROWSER BUG FIX: here to fix firefox video texture rotation issue
var texturePositionsRotatedBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,texturePositionsRotatedBuffer);gl.bufferData(gl.ARRAY_BUFFER,RECT_UV_ROTATED,gl.STATIC_DRAW);var drawImage=function drawImage(texture,textureSize,originX,originY,translateX,translateY,rotateX,rotateY,rotateZ,scale){var colorMatrix=arguments.length>10&&arguments[10]!==undefined?arguments[10]:COLOR_MATRIX_IDENTITY$1;var opacity=arguments.length>11&&arguments[11]!==undefined?arguments[11]:1;var clarity=arguments.length>12?arguments[12]:undefined;var gamma=arguments.length>13&&arguments[13]!==undefined?arguments[13]:1;var vignette=arguments.length>14&&arguments[14]!==undefined?arguments[14]:0;var maskFeather=arguments.length>15&&arguments[15]!==undefined?arguments[15]:IMAGE_MASK_FEATHER;var maskCornerRadius=arguments.length>16&&arguments[16]!==undefined?arguments[16]:NO_CORNERS;var imageOverlayColor=arguments.length>17&&arguments[17]!==undefined?arguments[17]:COLOR_TRANSPARENT;var enableOverlay=arguments.length>18&&arguments[18]!==undefined?arguments[18]:false;var enableBlend=arguments.length>19&&arguments[19]!==undefined?arguments[19]:false;var enableAntialiasing=arguments.length>20&&arguments[20]!==undefined?arguments[20]:true;// update image texture
var imageWidth=textureSize.width*viewPixelDensity;var imageHeight=textureSize.height*viewPixelDensity;var l=imageWidth*-0.5;var t=imageHeight*0.5;var r=imageWidth*0.5;var b=imageHeight*-0.5;// prettier-ignore
// B   D
// | \ |
// A  C
var imagePositions=new Float32Array([l,b,0,l,t,0,r,b,0,r,t,0// D
]);gl.bindBuffer(gl.ARRAY_BUFFER,imagePositionsBuffer);gl.bufferData(gl.ARRAY_BUFFER,imagePositions,gl.STATIC_DRAW);// move image backwards so it's presented in actual pixel size
var viewZ=// 1. we calculate the z offset required to have the
//    image height match the view height
/*        /|
                 / |
                /  | height / 2
               /   |
        f / 2 /__z_|
              \    |
               \   |
                \  |
                 \ |
                  \|
        */textureSize.height/2/FOV_TAN_HALF*(// 2. we want to render the image at the actual height, viewsize / height gets us results in a 1:1 presentation
viewSize.height/textureSize.height)*// 3. z has to be negative, therefor multiply by -1
-1;// convert to pixel density
translateX*=viewPixelDensity;translateY*=viewPixelDensity;originX*=viewPixelDensity;originY*=viewPixelDensity;// get shader params
var program=imageShader.program,locations=imageShader.locations;// apply
var matrix=mat4Create();mat4Perspective(matrix,FOV,viewAspectRatio,1,-viewZ*2);// move image
mat4Translate(matrix,translateX,-translateY,viewZ);// set rotation origin in view
mat4Translate(matrix,originX,-originY,0);// rotate image
mat4RotateZ(matrix,-rotateZ);// resize
mat4Scale(matrix,scale);// reset rotation origin
mat4Translate(matrix,-originX,originY,0);// flip
mat4RotateY(matrix,rotateY);mat4RotateX(matrix,rotateX);//
// tell context to draw preview
//
gl.useProgram(program);gl.enableVertexAttribArray(locations.aPosition);gl.enableVertexAttribArray(locations.aTexCoord);// set up texture
gl.uniform1i(locations.uTexture,TEXTURE_PREVIEW_INDEX);gl.uniform2f(locations.uTextureSize,textureSize.width,textureSize.height);gl.activeTexture(gl.TEXTURE0+TEXTURE_PREVIEW_INDEX);gl.bindTexture(gl.TEXTURE_2D,texture);// set up blend texture
var blendTextureIndex=enableBlend?TEXTURE_PREVIEW_BLEND_INDEX:TEXTURE_TRANSPARENT_INDEX;var blendTexture=indexTextureMap.get(blendTextureIndex);gl.uniform1i(locations.uTextureBlend,blendTextureIndex);gl.activeTexture(gl.TEXTURE0+blendTextureIndex);gl.bindTexture(gl.TEXTURE_2D,blendTexture);// set up markup texture
var overlayTextureIndex=enableOverlay?TEXTURE_PREVIEW_OVERLAY_INDEX:TEXTURE_TRANSPARENT_INDEX;var overlayTexture=indexTextureMap.get(overlayTextureIndex);gl.uniform1i(locations.uTextureOverlay,overlayTextureIndex);gl.activeTexture(gl.TEXTURE0+overlayTextureIndex);gl.bindTexture(gl.TEXTURE_2D,overlayTexture);// set up buffers
gl.bindBuffer(gl.ARRAY_BUFFER,imagePositionsBuffer);gl.vertexAttribPointer(locations.aPosition,3,gl.FLOAT,false,0,0);// BROWSER BUG FIX: Here to fix Firefox bug with rotated video textures
var rotateUV=SHOULD_APPLY_ROTATED_UV_TO_VIDEO_TEXTURES&&textureIsRotatedVideo(texture);gl.bindBuffer(gl.ARRAY_BUFFER,rotateUV?texturePositionsRotatedBuffer:texturePositionsBuffer);gl.vertexAttribPointer(locations.aTexCoord,2,gl.FLOAT,false,0,0);// update matrix
gl.uniformMatrix4fv(locations.uMatrix,false,matrix);// overlay color
gl.uniform4fv(locations.uOverlayColor,imageOverlayColor);// convolution
var clarityWeight;if(!clarity||arrayEqual(clarity,CLARITY_IDENTITY)){clarity=CLARITY_IDENTITY;clarityWeight=-1;}else{clarityWeight=clarity.reduce(function(prev,curr){return prev+curr;},0);clarityWeight=clarityWeight<=0?1:clarityWeight;}gl.uniform1fv(locations.uClarityKernel,clarity);gl.uniform1f(locations.uClarityKernelWeight,clarityWeight);gl.uniform1f(locations.uColorGamma,1.0/gamma);gl.uniform1f(locations.uColorVignette,vignette);gl.uniform1i(locations.uAntialias,enableAntialiasing?1:0);// set color matrix values
gl.uniform4f(locations.uColorOffset,colorMatrix[4],colorMatrix[9],colorMatrix[14],colorMatrix[19]);gl.uniformMatrix4fv(locations.uColorMatrix,false,[colorMatrix[0],colorMatrix[1],colorMatrix[2],colorMatrix[3],colorMatrix[5],colorMatrix[6],colorMatrix[7],colorMatrix[8],colorMatrix[10],colorMatrix[11],colorMatrix[12],colorMatrix[13],colorMatrix[15],colorMatrix[16],colorMatrix[17],colorMatrix[18]]);// opacity level
gl.uniform1f(locations.uOpacity,opacity);// mask
gl.uniform1f(locations.uMaskOpacity,maskOpacity);gl.uniform1fv(locations.uMaskBounds,maskBounds);gl.uniform1fv(locations.uMaskCornerRadius,maskCornerRadius.map(function(v){return v*viewPixelDensity;}));gl.uniform1fv(locations.uMaskFeather,maskFeather.map(function(v,i){return i%2===0?v:v*viewPixelDensity;}));gl.drawArrays(gl.TRIANGLE_STRIP,0,4);gl.disableVertexAttribArray(locations.aPosition);gl.disableVertexAttribArray(locations.aTexCoord);};//#endregion
// #region path
var pathShader=createShader(gl,pathVertexShader,pathFragmentShader,['aPosition','aNormal','aMiter'],['uColor','uCanvasColor','uMatrix','uWidth','uSharpness','uMaskBounds','uMaskOpacity']);var pathBuffer=gl.createBuffer();var strokePath=function strokePath(points,width,color){var close=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var program=pathShader.program,locations=pathShader.locations;gl.useProgram(program);gl.enableVertexAttribArray(locations.aPosition);gl.enableVertexAttribArray(locations.aNormal);gl.enableVertexAttribArray(locations.aMiter);var vertices=createPathVertices(points,close);var stride=Float32Array.BYTES_PER_ELEMENT*5;var normalOffset=Float32Array.BYTES_PER_ELEMENT*2;// at position 2
var miterOffset=Float32Array.BYTES_PER_ELEMENT*4;// at position 4
gl.uniform1f(locations.uWidth,width);gl.uniform1f(locations.uSharpness,pathSharpness);gl.uniform4fv(locations.uColor,color);gl.uniformMatrix4fv(locations.uMatrix,false,overlayMatrix);gl.uniform4f(locations.uCanvasColor,CANVAS_COLOR_R,CANVAS_COLOR_G,CANVAS_COLOR_B,CANVAS_COLOR_A);gl.uniform1fv(locations.uMaskBounds,maskBounds);gl.uniform1f(locations.uMaskOpacity,maskOpacity);gl.bindBuffer(gl.ARRAY_BUFFER,pathBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aPosition,2,gl.FLOAT,false,stride,0);gl.vertexAttribPointer(locations.aNormal,2,gl.FLOAT,false,stride,normalOffset);gl.vertexAttribPointer(locations.aMiter,1,gl.FLOAT,false,stride,miterOffset);// gl.stencilMask(0xee);
// gl.stencilFunc(
//     gl.EQUAL, // the test
//     0, // reference value
//     0xee // mask
// );
// gl.stencilOp(
//     gl.KEEP, // what to do if the stencil test fails
//     gl.KEEP, // what to do if the depth test fails
//     gl.INCR // what to do if both tests pass
// );
gl.drawArrays(gl.TRIANGLE_STRIP,0,vertices.length/5);// gl.clear(gl.STENCIL_BUFFER_BIT);
// gl.stencilMask(0xff);
gl.disableVertexAttribArray(locations.aPosition);gl.disableVertexAttribArray(locations.aNormal);gl.disableVertexAttribArray(locations.aMiter);};//#endregion
// #region triangle
var triangleShader=createShader(gl,triangleVertexShader,triangleFragmentShader,['aPosition'],['uColor','uCanvasColor','uMatrix','uMaskBounds','uMaskOpacity']);var trianglesBuffer=gl.createBuffer();var fillTriangles=function fillTriangles(vertices,backgroundColor){var program=triangleShader.program,locations=triangleShader.locations;gl.useProgram(program);gl.enableVertexAttribArray(locations.aPosition);gl.uniform4fv(locations.uColor,backgroundColor);gl.uniformMatrix4fv(locations.uMatrix,false,overlayMatrix);gl.uniform1fv(locations.uMaskBounds,maskBounds);gl.uniform1f(locations.uMaskOpacity,maskOpacity);gl.uniform4f(locations.uCanvasColor,CANVAS_COLOR_R,CANVAS_COLOR_G,CANVAS_COLOR_B,CANVAS_COLOR_A);gl.bindBuffer(gl.ARRAY_BUFFER,trianglesBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aPosition,2,gl.FLOAT,false,0,0);gl.drawArrays(gl.TRIANGLES,0,vertices.length/2);gl.disableVertexAttribArray(locations.aPosition);return vertices;};// const fillTriangles: (vertices: Float32Array, backgroundColor: number[]) => {};
//#endregion
// #region rect
var rectShaderAttributes=['aPosition','aTexCoord','aRectCoord'];var rectShaderUniforms=['uTexture','uColor','uMatrix','uCanvasColor','uTextureColor','uTextureOpacity','uPosition','uSize','uMaskBounds','uMaskOpacity','uMaskFeather','uCornerRadius','uInverted'];var rectShader=createShader(gl,rectVertexShader,rectFragmentShader,rectShaderAttributes,rectShaderUniforms);var rectBuffer=gl.createBuffer();var rectTextureBuffer=gl.createBuffer();var rectCornerBuffer=gl.createBuffer();var fillRect=function fillRect(vertices,width,height,cornerRadius,backgroundColor){var backgroundImage=arguments.length>5&&arguments[5]!==undefined?arguments[5]:transparentTexture;var opacity=arguments.length>6&&arguments[6]!==undefined?arguments[6]:1.0;var colorFilter=arguments.length>7&&arguments[7]!==undefined?arguments[7]:COLOR_TRANSPARENT;var uv=arguments.length>8&&arguments[8]!==undefined?arguments[8]:RECT_UV;var maskFeather=arguments.length>9&&arguments[9]!==undefined?arguments[9]:RECT_MASK_FEATHER;var inverted=arguments.length>10?arguments[10]:undefined;var program=rectShader.program,locations=rectShader.locations;gl.useProgram(program);gl.enableVertexAttribArray(locations.aPosition);gl.enableVertexAttribArray(locations.aTexCoord);gl.enableVertexAttribArray(locations.aRectCoord);gl.uniform4fv(locations.uColor,backgroundColor);gl.uniform2fv(locations.uSize,[width,height]);gl.uniform2fv(locations.uPosition,[vertices[2],vertices[3]]);gl.uniform1i(locations.uInverted,inverted?1:0);gl.uniform1fv(locations.uCornerRadius,cornerRadius);gl.uniform4f(locations.uCanvasColor,CANVAS_COLOR_R,CANVAS_COLOR_G,CANVAS_COLOR_B,CANVAS_COLOR_A);// mask
gl.uniform1fv(locations.uMaskFeather,maskFeather.map(function(v,i){return i%2===0?v:v*viewPixelDensity;}));gl.uniform1fv(locations.uMaskBounds,maskBounds);gl.uniform1f(locations.uMaskOpacity,maskOpacity);gl.uniformMatrix4fv(locations.uMatrix,false,overlayMatrix);gl.uniform1i(locations.uTexture,TEXTURE_SHAPE_INDEX);gl.uniform4fv(locations.uTextureColor,colorFilter);gl.uniform1f(locations.uTextureOpacity,opacity);gl.activeTexture(gl.TEXTURE0+TEXTURE_SHAPE_INDEX);gl.bindTexture(gl.TEXTURE_2D,backgroundImage);gl.bindBuffer(gl.ARRAY_BUFFER,rectTextureBuffer);gl.bufferData(gl.ARRAY_BUFFER,uv,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aTexCoord,2,gl.FLOAT,false,0,0);// we use these coordinates combined with the size of the rect to interpolate and alias edges
gl.bindBuffer(gl.ARRAY_BUFFER,rectCornerBuffer);gl.bufferData(gl.ARRAY_BUFFER,RECT_UV,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aRectCoord,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,rectBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aPosition,2,gl.FLOAT,false,0,0);gl.drawArrays(gl.TRIANGLE_STRIP,0,vertices.length/2);gl.disableVertexAttribArray(locations.aPosition);gl.disableVertexAttribArray(locations.aTexCoord);gl.disableVertexAttribArray(locations.aRectCoord);return vertices;};//#endregion
// #region ellipse
var ellipseShader=createShader(gl,ellipseVertexShader,ellipseFragmentShader,['aPosition','aTexCoord'],['uTexture','uTextureOpacity','uColor','uCanvasColor','uMatrix','uRadius','uInverted','uMaskBounds','uMaskOpacity']);var ellipseBuffer=gl.createBuffer();var ellipseTextureBuffer=gl.createBuffer();var fillEllipse=function fillEllipse(vertices,width,height,backgroundColor){var backgroundImage=arguments.length>4&&arguments[4]!==undefined?arguments[4]:transparentTexture;var uv=arguments.length>5&&arguments[5]!==undefined?arguments[5]:RECT_UV;var opacity=arguments.length>6&&arguments[6]!==undefined?arguments[6]:1.0;var inverted=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;var program=ellipseShader.program,locations=ellipseShader.locations;gl.useProgram(program);gl.enableVertexAttribArray(locations.aPosition);gl.enableVertexAttribArray(locations.aTexCoord);gl.uniformMatrix4fv(locations.uMatrix,false,overlayMatrix);gl.uniform2fv(locations.uRadius,[width*0.5,height*0.5]);gl.uniform1i(locations.uInverted,inverted?1:0);gl.uniform4fv(locations.uColor,backgroundColor);gl.uniform4f(locations.uCanvasColor,CANVAS_COLOR_R,CANVAS_COLOR_G,CANVAS_COLOR_B,CANVAS_COLOR_A);gl.uniform1fv(locations.uMaskBounds,maskBounds);gl.uniform1f(locations.uMaskOpacity,maskOpacity);gl.uniform1i(locations.uTexture,TEXTURE_SHAPE_INDEX);gl.uniform1f(locations.uTextureOpacity,opacity);gl.activeTexture(gl.TEXTURE0+TEXTURE_SHAPE_INDEX);gl.bindTexture(gl.TEXTURE_2D,backgroundImage);gl.bindBuffer(gl.ARRAY_BUFFER,ellipseTextureBuffer);gl.bufferData(gl.ARRAY_BUFFER,uv,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aTexCoord,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,ellipseBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.vertexAttribPointer(locations.aPosition,2,gl.FLOAT,false,0,0);gl.drawArrays(gl.TRIANGLE_STRIP,0,vertices.length/2);gl.disableVertexAttribArray(locations.aPosition);gl.disableVertexAttribArray(locations.aTexCoord);};//#endregion
//
// draw calls
//
var drawPath=function drawPath(points){var rotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var flipX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var flipY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var// not implemented yet
strokeWidth=arguments.length>4?arguments[4]:undefined;var strokeColor=arguments.length>5?arguments[5]:undefined;var strokeClose=arguments.length>6?arguments[6]:undefined;var backgroundColor=arguments.length>7?arguments[7]:undefined;var opacity=arguments.length>8?arguments[8]:undefined;// is no line
if(points.length<2)return;// manipulate points
var computedPoints=points.map(function(p){return{x:p.x*viewPixelDensity,y:p.y*viewPixelDensity};});// const center = convexPolyCentroid(clonedPoints);
// if (flipX || flipY) vectorsFlip(clonedPoints, flipX, flipY, center.x, center.y);
// if (rotation !== 0) vectorsRotate(clonedPoints, rotation, center.x, center.y);
var computedStrokeWidth=strokeWidth*viewPixelDensity;// stroke
if(computedStrokeWidth>0)strokePath(computedPoints,computedStrokeWidth,applyOpacity(strokeColor,opacity),strokeClose);// need to fill polygon?
if(computedPoints.length<3||!backgroundColor||backgroundColor[3]===0||!strokeClose)return;var triangles=triangulate(computedPoints);var vertices=new Float32Array(triangles.length*6);triangles.forEach(function(_ref139,i){var _ref140=_slicedToArray(_ref139,3),a=_ref140[0],b=_ref140[1],c=_ref140[2];var index=i*6;vertices[index+0]=a.x;vertices[index+1]=a.y;vertices[index+2]=b.x;vertices[index+3]=b.y;vertices[index+4]=c.x;vertices[index+5]=c.y;});fillTriangles(vertices,applyOpacity(backgroundColor,opacity));};var drawRect=function drawRect(rect){var rotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var flipX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var flipY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var cornerRadius=arguments.length>4?arguments[4]:undefined;var backgroundColor=arguments.length>5?arguments[5]:undefined;var backgroundImage=arguments.length>6?arguments[6]:undefined;var backgroundSize=arguments.length>7&&arguments[7]!==undefined?arguments[7]:undefined;var backgroundPosition=arguments.length>8&&arguments[8]!==undefined?arguments[8]:undefined;var backgroundUVMap=arguments.length>9&&arguments[9]!==undefined?arguments[9]:undefined;var strokeWidth=arguments.length>10?arguments[10]:undefined;var strokeColor=arguments.length>11?arguments[11]:undefined;var opacity=arguments.length>12?arguments[12]:undefined;var maskFeather=arguments.length>13&&arguments[13]!==undefined?arguments[13]:undefined;var colorize=arguments.length>14?arguments[14]:undefined;var inverted=arguments.length>15?arguments[15]:undefined;// clone first
var rectOut=rectMultiply(rectClone$1(rect),viewPixelDensity);// has radius, doesn't matter for coordinates
var cornerRadiusOut=cornerRadius.map(function(r){return limitCornerRadius(r||0,rect);}).map(function(r){return r*viewPixelDensity;});// should fill
if(backgroundColor||backgroundImage){// adjust for edge anti-aliasing, if we don't do this the
// visible rectangle will be 1 pixel smaller than the actual rectangle
var rectFill=rectClone$1(rectOut);rectFill.x-=0.5;rectFill.y-=0.5;rectFill.width+=1;rectFill.height+=1;var points=createRectPoints(rectFill,rotation,flipX,flipY);var vertices=rectPointsToVertices(points);var color;if(colorize){color=applyOpacity(colorize);// as 0 transparancy is used to test if the colorize filter should be applied we set it to 0.001
if(color[3]===0)color[3]=0.001;}fillRect(vertices,rectFill.width,rectFill.height,cornerRadiusOut,applyOpacity(backgroundColor,opacity),backgroundImage,opacity,color,backgroundUVMap?new Float32Array(backgroundUVMap):calculateBackgroundUVMap(rectFill.width,rectFill.height,backgroundSize,backgroundPosition,viewPixelDensity),maskFeather,inverted);}// should draw outline
if(strokeWidth){// fixes issue where stroke would render weirdly
strokeWidth=Math.min(strokeWidth,rectOut.width,rectOut.height);strokePath(// rect out is already multiplied by pixel density
createRectOutline(rectOut.x,rectOut.y,rectOut.width,rectOut.height,rotation,cornerRadiusOut,flipX,flipY),strokeWidth*viewPixelDensity,applyOpacity(strokeColor,opacity),true);}};var drawEllipse=function drawEllipse(center,rx,ry,rotation,flipX,flipY,backgroundColor,backgroundImage){var backgroundSize=arguments.length>8&&arguments[8]!==undefined?arguments[8]:undefined;var backgroundPosition=arguments.length>9&&arguments[9]!==undefined?arguments[9]:undefined;var backgroundUVMap=arguments.length>10&&arguments[10]!==undefined?arguments[10]:undefined;var strokeWidth=arguments.length>11?arguments[11]:undefined;var strokeColor=arguments.length>12?arguments[12]:undefined;var opacity=arguments.length>13?arguments[13]:undefined;var inverted=arguments.length>14?arguments[14]:undefined;var rectOut=rectMultiply(rectCreate(center.x-rx,center.y-ry,rx*2,ry*2),viewPixelDensity);if(backgroundColor||backgroundImage){// adjust for edge anti-aliasing, if we don't do this the
// visible rectangle will be 1 pixel smaller than the actual rectangle
var rectFill=rectClone$1(rectOut);rectFill.x-=0.5;rectFill.y-=0.5;rectFill.width+=1.0;rectFill.height+=1.0;var points=createRectPoints(rectFill,rotation,flipX,flipY);var vertices=rectPointsToVertices(points);fillEllipse(vertices,rectFill.width,rectFill.height,applyOpacity(backgroundColor,opacity),backgroundImage,backgroundUVMap?new Float32Array(backgroundUVMap):calculateBackgroundUVMap(rectFill.width,rectFill.height,backgroundSize,backgroundPosition,viewPixelDensity),opacity,inverted);}if(strokeWidth)strokePath(// rect out is already multiplied by pixeldensity
createEllipseOutline(rectOut.x,rectOut.y,rectOut.width,rectOut.height,rotation,flipX,flipY),strokeWidth*viewPixelDensity,applyOpacity(strokeColor,opacity),true);};//#endregion
var glTextures=new Map();var imageFramebufferSize={};imageFramebufferSize[TEXTURE_PREVIEW_OVERLAY_INDEX]={width:0,height:0};imageFramebufferSize[TEXTURE_PREVIEW_BLEND_INDEX]={width:0,height:0};var imageFrameBufferMaxSize=4096;var drawToImageFramebuffer=function drawToImageFramebuffer(index,buffer,imageSize){var pixelDensity=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var textureScalar=Math.min(Math.min(imageFrameBufferMaxSize,textureSizeLimit)/imageSize.width,Math.min(imageFrameBufferMaxSize,textureSizeLimit)/imageSize.height,pixelDensity);var textureWidth=Math.floor(textureScalar*imageSize.width);var textureHeight=Math.floor(textureScalar*imageSize.height);if(!sizeEqual(imageSize,imageFramebufferSize[index])){// update preview markup texture
gl.bindTexture(gl.TEXTURE_2D,indexTextureMap.get(index));gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,textureWidth,textureHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,null);// set the filtering, we don't need mips
gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.bindFramebuffer(gl.FRAMEBUFFER,buffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,indexTextureMap.get(index),0);// remember so we know when to update the framebuffer
imageFramebufferSize[index]=imageSize;}else{gl.bindFramebuffer(gl.FRAMEBUFFER,buffer);}// switch transformMatrix
var w=imageSize.width*viewPixelDensity;var h=imageSize.height*viewPixelDensity;mat4Ortho(imageFrameBuffer,0,w,h,0,-1,1);mat4Translate(imageFrameBuffer,0,h,0);mat4ScaleX(imageFrameBuffer,1);mat4ScaleY(imageFrameBuffer,-1);overlayMatrix=imageFrameBuffer;// framebuffer lives in image space
gl.viewport(0,0,textureWidth,textureHeight);// always transparent
gl.colorMask(true,true,true,true);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);// update rect mask
RECT_MASK_FEATHER=[1,0,1,0,1,Math.max(viewSize.width,imageSize.width),1,Math.max(viewSize.width,imageSize.width)];};var textureDelete=function textureDelete(texture){var forceRelease=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var _glTextures$get=glTextures.get(texture),src=_glTextures$get.src;if(src instanceof HTMLCanvasElement){if(!forceRelease&&!src.dataset.retain){releaseCanvas(src);}}glTextures["delete"](texture);gl.deleteTexture(texture);};var resetCanvasMatrix=function resetCanvasMatrix(){mat4Ortho(overlayMatrixCanvas,0,viewSize.width,viewSize.height,0,-1,1);};var textureIsRotatedVideo=function textureIsRotatedVideo(texture){return glTextures.get(texture).isRotatedVideo;};return{// draw api
drawPath:drawPath,drawRect:drawRect,drawEllipse:drawEllipse,drawImage:drawImage,// texture filters
textureFilterNearest:gl.NEAREST,textureFilterLinear:gl.LINEAR,//#region texture management
textureCreate:function textureCreate(){return gl.createTexture();},textureUpdate:function textureUpdate(texture,source,options){glTextures.set(texture,{src:source,options:options,isRotatedVideo:source.nodeName==='VIDEO'&&(source.dataset&&source.dataset.rotation==90||source.dataset.rotation==270)});return updateTexture(gl,texture,source,options);},textureGetSize:function textureGetSize(texture){var _glTextures$get2=glTextures.get(texture),src=_glTextures$get2.src,options=_glTextures$get2.options;var size=sizeCreateFromAny(src);if(options.scalar)return sizeApply(size,function(v){return v/options.scalar;});return size;},textureDelete:textureDelete,//#endregion
enablePreviewStencil:enablePreviewStencil,applyPreviewStencil:applyPreviewStencil,disablePreviewStencil:disablePreviewStencil,setCanvasColor:function setCanvasColor(color){CANVAS_COLOR_R=color[0];CANVAS_COLOR_G=color[1];CANVAS_COLOR_B=color[2];CANVAS_COLOR_A=alpha?color[3]:1;gl.clear(gl.COLOR_BUFFER_BIT);},resetCanvasMatrix:resetCanvasMatrix,updateCanvasMatrix:function updateCanvasMatrix(imageSize,origin,translation,scale,rotate){var imageWidth=imageSize.width;var imageHeight=imageSize.height;var originX=viewSize.width*(0.5/viewPixelDensity);var originY=viewSize.height*(0.5/viewPixelDensity);var imageOrigin={x:originX+(translation.x+origin.x),y:originY+(translation.y+origin.y)};var imageVisualCenter={x:imageOrigin.x-origin.x,y:imageOrigin.y-origin.y};var imageAbsoluteCenter={x:imageWidth*0.5,y:imageHeight*0.5};vectorRotate(imageVisualCenter,rotate.z,imageOrigin);vectorScale(imageVisualCenter,scale,imageOrigin);var imageTranslation={x:imageVisualCenter.x-imageAbsoluteCenter.x,y:imageVisualCenter.y-imageAbsoluteCenter.y};mat4Translate(overlayMatrixCanvas,imageTranslation.x*viewPixelDensity,imageTranslation.y*viewPixelDensity,0);// we apply transforms from center of image
mat4Translate(overlayMatrixCanvas,imageAbsoluteCenter.x*viewPixelDensity,imageAbsoluteCenter.y*viewPixelDensity,0);mat4RotateZ(overlayMatrixCanvas,rotate.z);var flipX=rotate.x>Math.PI/2;mat4RotateX(overlayMatrixCanvas,flipX?Math.PI:0);var flipY=rotate.y>Math.PI/2;mat4RotateY(overlayMatrixCanvas,flipY?Math.PI:0);mat4Scale(overlayMatrixCanvas,scale);mat4Translate(overlayMatrixCanvas,-imageAbsoluteCenter.x*viewPixelDensity,-imageAbsoluteCenter.y*viewPixelDensity,0);},drawToCanvas:function drawToCanvas(){gl.bindFramebuffer(gl.FRAMEBUFFER,null);// switch transformMatrix
overlayMatrix=overlayMatrixCanvas;// tell webgl about the viewport
gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight);// black (or other color depending on background)
gl.colorMask(true,true,true,true);gl.clearColor(CANVAS_COLOR_R,CANVAS_COLOR_G,CANVAS_COLOR_B,CANVAS_COLOR_A);// gl.clearColor(0.25, 0.25, 0.25, 1); // for debugging
gl.clear(gl.COLOR_BUFFER_BIT);// update rect mask
RECT_MASK_FEATHER=[1,0,1,0,1,viewSize.width,1,viewSize.width];},drawToImageBlendBuffer:function drawToImageBlendBuffer(imageSize,pixelDensity){drawToImageFramebuffer(TEXTURE_PREVIEW_BLEND_INDEX,blendFramebuffer,imageSize,pixelDensity);},drawToImageOverlayBuffer:function drawToImageOverlayBuffer(imageSize,pixelDensity){drawToImageFramebuffer(TEXTURE_PREVIEW_OVERLAY_INDEX,overlayFramebuffer,imageSize,pixelDensity);},// set mask
enableMask:function enableMask(rect,opacity){var maskX=rect.x*viewPixelDensity;var maskY=rect.y*viewPixelDensity;var maskWidth=rect.width*viewPixelDensity;var maskHeight=rect.height*viewPixelDensity;maskLeft=maskX;maskRight=maskLeft+maskWidth;maskTop=viewSize.height-maskY;maskBottom=viewSize.height-(maskY+maskHeight);maskOpacity=1.0-opacity;maskBounds=[maskTop,maskRight,maskBottom,maskLeft];},disableMask:function disableMask(){maskLeft=0;maskRight=viewSize.width;maskTop=viewSize.height;maskBottom=0;maskOpacity=1;maskBounds=[maskTop,maskRight,maskBottom,maskLeft];},// canvas
resize:resize,release:function release(){// remove all stored textures
var textures=Array.from(glTextures.keys());textures.forEach(function(texture){return textureDelete(texture,true);});glTextures.clear();// remove indexed textures
indexTextureMap.forEach(function(texture){gl.deleteTexture(texture);});indexTextureMap.clear();// clean up shaders
imageShader.destroy();pathShader.destroy();triangleShader.destroy();rectShader.destroy();ellipseShader.destroy();// clear canvas
canvas.width=1;canvas.height=1;canvas=undefined;}};};var numberToEven=function numberToEven(n){return n%2==0?n:n+1;};// quickly reads canvas data to editor state, replaces createDefaultImageReader
var createCanvasReader=function createCanvasReader(){return[[/*#__PURE__*/function(){var _ref141=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee48(state,options,onprogress){var src,width,height,dest;return _regeneratorRuntime().wrap(function _callee48$(_context49){while(1)switch(_context49.prev=_context49.next){case 0:src=state.src;width=parseInt(src.width,10);height=parseInt(src.height,10);_context49.next=5;return canvasToBlob(src);case 5:dest=_context49.sent;return _context49.abrupt("return",_objectSpread(_objectSpread({},state),{},{dest:dest,size:{width:width,height:height}}));case 7:case"end":return _context49.stop();}},_callee48);}));return function(_x82,_x83,_x84){return _ref141.apply(this,arguments);};}(),'read-canvas']];};var imageStateToCanvas=function imageStateToCanvas(src,imageState,options){var _ref142=options||{},targetCanvas=_ref142.targetCanvas,targetSize=_ref142.targetSize,_ref142$disableDraw=_ref142.disableDraw,disableDraw=_ref142$disableDraw===void 0?false:_ref142$disableDraw,shapePreprocessor=_ref142.shapePreprocessor;var canvas=targetCanvas||document.createElement('canvas');var crop=imageState.crop,colorMatrix=imageState.colorMatrix,convolutionMatrix=imageState.convolutionMatrix;var isVideoSrc=isVideoElement(src);var srcSize={width:isVideoSrc?src.videoWidth:src.width,height:isVideoSrc?src.videoHeight:src.height};// calculate target bounds dimensions
var _ref143=targetSize||{},_ref143$upscale=_ref143.upscale,upscale=_ref143$upscale===void 0?false:_ref143$upscale,_ref143$fit=_ref143.fit,fit=_ref143$fit===void 0?'contain':_ref143$fit,targetWidth=_ref143.width,targetHeight=_ref143.height;// scale canvas
var canvasScalar=1;if(fit==='contain'){canvasScalar=Math.min((targetWidth||Number.MAX_SAFE_INTEGER)/crop.width,(targetHeight||Number.MAX_SAFE_INTEGER)/crop.height);}else if(fit==='cover'){canvasScalar=Math.max((targetWidth||crop.width)/crop.width,(targetHeight||crop.height)/crop.height);}// can't upscale, let's limit scalar to 1
if(!upscale)canvasScalar=Math.min(canvasScalar,1);var canvasScaledWidth=Math.floor(crop.width*canvasScalar);var canvasScaledHeight=Math.floor(crop.height*canvasScalar);var canvasWidth=isVideoSrc?numberToEven(canvasScaledWidth):canvasScaledWidth;var canvasHeight=isVideoSrc?numberToEven(canvasScaledHeight):canvasScaledHeight;var glCanvas=createWebGLCanvas(canvas,{alpha:true});glCanvas.resize(canvasWidth,canvasHeight,1);var glTexture=glCanvas.textureCreate();glCanvas.setCanvasColor([0,0,0,0]);glCanvas.drawToCanvas();glCanvas.disableMask();glCanvas.disablePreviewStencil();// color matrix
var computedColorMatrix;{var colorMatrices=Object.values(colorMatrix||{}).filter(Boolean);if(colorMatrices.length)computedColorMatrix=getColorMatrixFromColorMatrices(colorMatrices);}var canvasRect={x:0,y:0,width:canvasWidth,height:canvasHeight};var _calculateImageTransf=calculateImageTransforms(canvasRect,canvasRect,srcSize,crop,{x:0,y:0,width:canvasWidth,height:canvasHeight},canvasScalar,{x:0,y:0},1,imageState.rotation,imageState.flipX,imageState.flipY),origin=_calculateImageTransf.origin,translation=_calculateImageTransf.translation,rotation=_calculateImageTransf.rotation,scale=_calculateImageTransf.scale;var glTransforms=[srcSize,origin.x,origin.y,translation.x,translation.y,rotation.x,rotation.y,rotation.z,scale,computedColorMatrix,1,// @ts-ignore
convolutionMatrix&&convolutionMatrix.clarity,isNumber(imageState.gamma)?imageState.gamma:1,imageState.vignette||0,[1,0,1,0,1,canvasHeight,1,canvasWidth],undefined,undefined,undefined,undefined,false];// shapes
var shapesOverlayDrawn=false;var hasShapes=imageState.decoration.length||imageState.annotation.length;var glShapeTexture=hasShapes&&glCanvas.textureCreate();// api
var updateTexture=function updateTexture(){glCanvas.textureUpdate(glTexture,src,{filter:glCanvas.textureFilterLinear});};var draw=function draw(){// make sure texture is at the correct frame when it's a video
updateTexture();// draw to the canvas
glCanvas.drawImage.apply(glCanvas,[glTexture].concat(glTransforms));// draw to the canvas
if(!hasShapes||!shapesOverlayDrawn)return;glCanvas.drawRect(canvasRect,0,false,false,[0,0,0,0],undefined,glShapeTexture);};var prepare=/*#__PURE__*/function(){var _ref144=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee49(){var _yield$processImage2,dest;return _regeneratorRuntime().wrap(function _callee49$(_context50){while(1)switch(_context50.prev=_context50.next){case 0:if(hasShapes){_context50.next=2;break;}return _context50.abrupt("return");case 2:_context50.next=4;return processImage(h('canvas',srcSize),{shapePreprocessor:shapePreprocessor,imageReader:createCanvasReader(),imageWriter:createDefaultImageWriter$1({format:'canvas'}),imageState:_objectSpread(_objectSpread({},imageState),{},{redaction:[],frame:undefined,gamma:undefined,convolutionMatrix:undefined,colorMatrix:undefined,backgroundColor:[0,0,0,0],backgroundImage:undefined,trim:undefined,vignette:undefined,volume:undefined})});case 4:_yield$processImage2=_context50.sent;dest=_yield$processImage2.dest;// only needs to run once
glCanvas.textureUpdate(glShapeTexture,dest,{filter:glCanvas.textureFilterLinear});// now ready to draw shapes texture
shapesOverlayDrawn=true;// first draw
!disableDraw&&draw();case 9:case"end":return _context50.stop();}},_callee49);}));return function prepare(){return _ref144.apply(this,arguments);};}();// load texture
updateTexture();// first draw
!disableDraw&&draw();return{canvas:canvas,prepare:prepare,redraw:draw};};var scrambleEffect=function scrambleEffect(options,done){var imageData=options.imageData,_options$amount=options.amount,amount=_options$amount===void 0?1:_options$amount;var intensity=Math.round(Math.max(1,amount)*2);var range=Math.round(intensity*0.5);var inputWidth=imageData.width;var inputHeight=imageData.height;var outputData=new Uint8ClampedArray(inputWidth*inputHeight*4);var inputData=imageData.data;var randomData;var i=0,x,y,r;var xoffset=0;var yoffset=0;var index;var l=inputWidth*inputHeight*4-4;for(y=0;y<inputHeight;y++){randomData=crypto.getRandomValues(new Uint8ClampedArray(inputHeight));for(x=0;x<inputWidth;x++){r=randomData[y]/255;xoffset=0;yoffset=0;if(r<0.5){xoffset=(-range+Math.round(Math.random()*intensity))*4;}if(r>0.5){yoffset=(-range+Math.round(Math.random()*intensity))*(inputWidth*4);}// limit to image data
index=Math.min(Math.max(0,i+xoffset+yoffset),l);outputData[i]=inputData[index];outputData[i+1]=inputData[index+1];outputData[i+2]=inputData[index+2];outputData[i+3]=inputData[index+3];i+=4;}}// @ts-ignore
done(null,{data:outputData,width:imageData.width,height:imageData.height});};// basic blur covolution matrix
var BLUR_MATRIX=[0.0625,0.125,0.0625,0.125,0.25,0.125,0.0625,0.125,0.0625];var imageDataScramble=/*#__PURE__*/function(){var _ref145=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee50(inputData){var options,width,height,_options$dataSize,dataSize,_options$dataSizeScal,dataSizeScalar,_options$scrambleAmou,scrambleAmount,_options$blurAmount,blurAmount,_options$outputFormat,outputFormat,_options$backgroundCo,backgroundColor,size,scalar,outputWidth,outputHeight,scaledOutputCanvas,ctx,transferCanvas,imageData,filters,i,imageDataScrambled,_chain,filterChain,imageDataObjectScrambled,_args46=arguments;return _regeneratorRuntime().wrap(function _callee50$(_context51){while(1)switch(_context51.prev=_context51.next){case 0:options=_args46.length>1&&_args46[1]!==undefined?_args46[1]:{};if(inputData){_context51.next=3;break;}return _context51.abrupt("return");case 3:width=inputData.width,height=inputData.height;_options$dataSize=options.dataSize,dataSize=_options$dataSize===void 0?96:_options$dataSize,_options$dataSizeScal=options.dataSizeScalar,dataSizeScalar=_options$dataSizeScal===void 0?1:_options$dataSizeScal,_options$scrambleAmou=options.scrambleAmount,scrambleAmount=_options$scrambleAmou===void 0?4:_options$scrambleAmou,_options$blurAmount=options.blurAmount,blurAmount=_options$blurAmount===void 0?6:_options$blurAmount,_options$outputFormat=options.outputFormat,outputFormat=_options$outputFormat===void 0?'canvas':_options$outputFormat,_options$backgroundCo=options.backgroundColor,backgroundColor=_options$backgroundCo===void 0?[0,0,0]:_options$backgroundCo;size=Math.round(dataSize*dataSizeScalar);scalar=Math.min(size/width,size/height);outputWidth=Math.floor(width*scalar);outputHeight=Math.floor(height*scalar);// draw low res preview, add margin so blur isn't transparent
scaledOutputCanvas=h('canvas',{width:outputWidth,height:outputHeight});ctx=scaledOutputCanvas.getContext('2d',{willReadFrequently:true});// fill background on transparent images
backgroundColor.length=3;// prevent transparent colors
ctx.fillStyle=colorArrayToRGBA(backgroundColor);ctx.fillRect(0,0,outputWidth,outputHeight);if(isImageData(inputData)){// temporarily draw to canvas so we can draw image data to scaled context
transferCanvas=h('canvas',{width:width,height:height});transferCanvas.getContext('2d',{willReadFrequently:true}).putImageData(inputData,0,0);// draw to scaled context
ctx.drawImage(transferCanvas,0,0,outputWidth,outputHeight);// release memory
releaseCanvas(transferCanvas);}else{// bitmap data
ctx.drawImage(inputData,0,0,outputWidth,outputHeight);}// get scaled image data for scrambling
imageData=ctx.getImageData(0,0,outputWidth,outputHeight);// filters to apply
filters=[];// add scramble filter
if(scrambleAmount>0)filters.push([scrambleEffect,{amount:scrambleAmount}]);// add blur filters
if(blurAmount>0)for(i=0;i<blurAmount;i++){filters.push([convolutionEffect,{matrix:BLUR_MATRIX}]);}if(!filters.length){_context51.next=28;break;}// builds effect chain
_chain=function _chain(transforms,i){return"(err, imageData) => {\n                (".concat(transforms[i][0].toString(),")(Object.assign({ imageData: imageData }, filterInstructions[").concat(i,"]), \n                    ").concat(transforms[i+1]?_chain(transforms,i+1):'done',")\n            }");};filterChain="function (options, done) {\n            const filterInstructions = options.filterInstructions;\n            const imageData = options.imageData;\n            (".concat(_chain(filters,0),")(null, imageData)\n        }");// scramble image data in separate thread
_context51.next=24;return thread(filterChain,[{imageData:imageData,filterInstructions:filters.map(function(t){return t[1];})}],[imageData.data.buffer]);case 24:imageDataObjectScrambled=_context51.sent;imageDataScrambled=imageDataObjectToImageData(imageDataObjectScrambled);_context51.next=29;break;case 28:imageDataScrambled=imageData;case 29:if(!(outputFormat==='canvas')){_context51.next=32;break;}// put back scrambled data
ctx.putImageData(imageDataScrambled,0,0);// return canvas
return _context51.abrupt("return",scaledOutputCanvas);case 32:return _context51.abrupt("return",imageDataScrambled);case 33:case"end":return _context51.stop();}},_callee50);}));return function imageDataScramble(_x85){return _ref145.apply(this,arguments);};}();function circOut(t){return Math.sqrt(1- --t*t);}function is_date(obj){return Object.prototype.toString.call(obj)==='[object Date]';}function get_interpolator(a,b){if(a===b||a!==a)return function(){return a;};var type=_typeof(a);if(type!==_typeof(b)||Array.isArray(a)!==Array.isArray(b)){throw new Error('Cannot interpolate values of different type');}if(Array.isArray(a)){var arr=b.map(function(bi,i){return get_interpolator(a[i],bi);});return function(t){return arr.map(function(fn){return fn(t);});};}if(type==='object'){if(!a||!b)throw new Error('Object cannot be null');if(is_date(a)&&is_date(b)){a=a.getTime();b=b.getTime();var delta=b-a;return function(t){return new Date(a+t*delta);};}var keys=Object.keys(b);var interpolators={};keys.forEach(function(key){interpolators[key]=get_interpolator(a[key],b[key]);});return function(t){var result={};keys.forEach(function(key){result[key]=interpolators[key](t);});return result;};}if(type==='number'){var _delta=b-a;return function(t){return a+t*_delta;};}throw new Error("Cannot interpolate ".concat(type," values"));}function tweened(value){var defaults=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var store=writable(value);var task;var target_value=value;function set(new_value,opts){if(value==null){store.set(value=new_value);return Promise.resolve();}target_value=new_value;var previous_task=task;var started=false;var _assign=assign(assign({},defaults),opts),_assign$delay=_assign.delay,delay=_assign$delay===void 0?0:_assign$delay,_assign$duration=_assign.duration,duration=_assign$duration===void 0?400:_assign$duration,_assign$easing=_assign.easing,easing=_assign$easing===void 0?identity:_assign$easing,_assign$interpolate=_assign.interpolate,interpolate=_assign$interpolate===void 0?get_interpolator:_assign$interpolate;if(duration===0){if(previous_task){previous_task.abort();previous_task=null;}store.set(value=target_value);return Promise.resolve();}var start=now()+delay;var fn;task=loop(function(now){if(now<start)return true;if(!started){fn=interpolate(value,new_value);if(typeof duration==='function')duration=duration(value,new_value);started=true;}if(previous_task){previous_task.abort();previous_task=null;}var elapsed=now-start;if(elapsed>duration){store.set(value=new_value);return false;}// @ts-ignore
store.set(value=fn(easing(elapsed/duration)));return true;});return task.promise;}return{set:set,update:function update(fn,opts){return set(fn(target_value,value),opts);},subscribe:store.subscribe};}// @ts-ignore
function tick_spring(ctx,last_value,current_value,target_value){if(typeof current_value==='number'){// @ts-ignore
var delta=target_value-current_value;// @ts-ignore
var velocity=(current_value-last_value)/(ctx.dt||1/60);// guard div by 0
var _spring=ctx.opts.stiffness*delta;var damper=ctx.opts.damping*velocity;var acceleration=(_spring-damper)*ctx.inv_mass;var d=(velocity+acceleration)*ctx.dt;if(Math.abs(d)<ctx.opts.precision&&Math.abs(delta)<ctx.opts.precision){return target_value;// settled
}else{ctx.settled=false;// signal loop to keep ticking
// @ts-ignore
return current_value+d;}}else if(isArray(current_value)){// @ts-ignore
return current_value.map(function(_,i){return tick_spring(ctx,last_value[i],current_value[i],target_value[i]);});}else if(_typeof(current_value)==='object'){var next_value={};// @ts-ignore
for(var k in current_value){// @ts-ignore
next_value[k]=tick_spring(ctx,last_value[k],current_value[k],target_value[k]);}// @ts-ignore
return next_value;}else{throw new Error("Cannot spring ".concat(_typeof(current_value)," values"));}}// export interface Spring {
//     set: (new_value: any, opts?: SpringUpdateOpts) => Promise<void>;
//     update: (fn: Function, opts?: SpringUpdateOpts) => Promise<void>;
//     subscribe: Function;
//     precision: number;
//     damping: number;
//     stiffness: number;
// }
function spring(value){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var store=writable(value);var _opts$stiffness=opts.stiffness,stiffness=_opts$stiffness===void 0?0.15:_opts$stiffness,_opts$damping=opts.damping,damping=_opts$damping===void 0?0.8:_opts$damping,_opts$precision=opts.precision,precision=_opts$precision===void 0?0.01:_opts$precision;var last_time;var task;var current_token;var last_value=value;var target_value=value;var inv_mass=1;var inv_mass_recovery_rate=0;var cancel_task=false;function set(new_value){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};target_value=new_value;var token=current_token={};if(value==null||opts.hard||spring.stiffness>=1&&spring.damping>=1){cancel_task=true;// cancel any running animation
last_time=null;last_value=new_value;store.set(value=target_value);return Promise.resolve();}else if(opts.soft){var rate=opts.soft===true?0.5:+opts.soft;inv_mass_recovery_rate=1/(rate*60);inv_mass=0;// infinite mass, unaffected by spring forces
}if(!task){last_time=null;cancel_task=false;var ctx={inv_mass:undefined,opts:spring,settled:true,dt:undefined};task=loop(function(now){if(last_time===null)last_time=now;if(cancel_task){cancel_task=false;task=null;return false;}inv_mass=Math.min(inv_mass+inv_mass_recovery_rate,1);// altered so doesn't create a new object
ctx.inv_mass=inv_mass;ctx.opts=spring;ctx.settled=true;// tick_spring may signal false
ctx.dt=(now-last_time)*60/1000;var next_value=tick_spring(ctx,last_value,value,target_value);last_time=now;last_value=value;store.set(value=next_value);if(ctx.settled)task=null;return!ctx.settled;});}return new Promise(function(fulfil){task.promise.then(function(){if(token===current_token)fulfil();});});}var spring={set:set,update:function update(fn,opts){return set(fn(target_value,value),opts);},subscribe:store.subscribe,stiffness:stiffness,damping:damping,precision:precision};return spring;}var prefersReducedMotion=readable(false,function(set){var mql=window.matchMedia('(prefers-reduced-motion:reduce)');var test=function test(){return set(mql.matches);};test();mql.addListener(test);return function(){return mql.removeListener(test);};});var hasResizeObserver=function hasResizeObserver(){return'ResizeObserver'in window;};//
var rectNext=rectCreateEmpty();var updateNodeRect=function updateNodeRect(node,x,y,width,height){if(!node.rect)node.rect=rectCreateEmpty();var rect=node.rect;rectUpdate(rectNext,x,y,width,height);if(rectEqual(rect,rectNext))return;rectUpdateWithRect(rect,rectNext);node.dispatchEvent(new CustomEvent('measure',{detail:rect}));};// measures the element
var r=Math.round;var measureViewRect=function measureViewRect(node){var clientRect=node.getBoundingClientRect();updateNodeRect(node,r(clientRect.x),r(clientRect.y),r(clientRect.width),r(clientRect.height));};var measureOffset=function measureOffset(node){return updateNodeRect(node,node.offsetLeft,node.offsetTop,node.offsetWidth,node.offsetHeight);};// holds all the elements to measure using requestAnimationFrame
var elements=[];// draw loop
var frame=null;function tick(){if(!elements.length){frame=null;return;}elements.forEach(function(node){return node.measure(node);});frame=requestAnimationFrame(tick);}var observer;// ResizeObserver API not known by TypeScript
// total observed elements so we know when we can unload observer
var observedNodes=0;var measurable=function measurable(node){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _options$observePosit=options.observePosition,observePosition=_options$observePosit===void 0?false:_options$observePosit,_options$observeViewR=options.observeViewRect,observeViewRect=_options$observeViewR===void 0?false:_options$observeViewR,_options$once=options.once,once=_options$once===void 0?false:_options$once,_options$disabled=options.disabled,disabled=_options$disabled===void 0?false:_options$disabled;// exit
if(disabled)return;// use resize observe if available
if(hasResizeObserver()&&!observePosition&&!observeViewRect){// we only create one observer, it will observe all registered elements
if(!observer){// @ts-ignore: [2020-02-20] ResizeObserver API not known by TypeScript
observer=new ResizeObserver(function(entries){// @ts-ignore
entries.forEach(function(entry){return measureOffset(entry.target);});});}// start observing this node
observer.observe(node);// measure our node for the first time
measureOffset(node);// if should only measure once, remove now
if(once){observer.unobserve(node);}else{observedNodes++;}// and we done, need to return a clean up method for when our node is destroyed
return{destroy:function destroy(){// already unobserved this node
if(once)return;// stop observing this node
observer.unobserve(node);// test if all nodes have been removed, if so, remove observer
observedNodes--;if(observedNodes===0){observer.disconnect();observer=undefined;}}};}// set measure function
node.measure=observeViewRect?measureViewRect:measureOffset;// add so the element is measured
elements.push(node);// start measuring on next frame, we set up a single measure loop,
// the loop will check if there's still elements that need to be measured,
// else it will stop running
if(!frame)frame=requestAnimationFrame(tick);// measure this element now
node.measure(node);// remove method
return{destroy:function destroy(){var index=elements.indexOf(node);elements.splice(index,1);delete node.measure;}};};var focusvisible=function focusvisible(element){var isKeyboardInteraction=false;var handlePointerdown=function handlePointerdown(){isKeyboardInteraction=false;};var handleKeydown=function handleKeydown(){isKeyboardInteraction=true;};var handleKeyup=function handleKeyup(){isKeyboardInteraction=false;};var handleFocus=function handleFocus(e){if(!isKeyboardInteraction)return;e.target.dataset.focusVisible='';};var handleBlur=function handleBlur(e){delete e.target.dataset.focusVisible;};var map={pointerdown:handlePointerdown,keydown:handleKeydown,keyup:handleKeyup,focus:handleFocus,blur:handleBlur};Object.keys(map).forEach(function(event){return element.addEventListener(event,map[event],true);});return{destroy:function destroy(){Object.keys(map).forEach(function(event){return element.removeEventListener(event,map[event],true);});}};};var getResourceFromItem=/*#__PURE__*/function(){var _ref146=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee51(item){return _regeneratorRuntime().wrap(function _callee51$(_context52){while(1)switch(_context52.prev=_context52.next){case 0:return _context52.abrupt("return",new Promise(function(resolve){if(item.kind==='file')return resolve(item.getAsFile());item.getAsString(resolve);}));case 1:case"end":return _context52.stop();}},_callee51);}));return function getResourceFromItem(_x86){return _ref146.apply(this,arguments);};}();var getResourcesFromEvent=function getResourcesFromEvent(e){return new Promise(function(resolve,reject){var items=e.dataTransfer.items;if(!items)return resolve([]);Promise.all(Array.from(items).map(getResourceFromItem)).then(function(res){resolve(res.filter(function(item){return isBinary(item)&&isImage(item)||/^http/.test(item);}));})["catch"](reject);});};var dropable=function dropable(node){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var handleDragOver=function handleDragOver(e){// need to be prevent default to allow drop
e.preventDefault();};var handleDrop=/*#__PURE__*/function(){var _ref147=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee52(e){var resources;return _regeneratorRuntime().wrap(function _callee52$(_context53){while(1)switch(_context53.prev=_context53.next){case 0:e.preventDefault();e.stopPropagation();// prevents parents from catching this drop
_context53.prev=2;_context53.next=5;return getResourcesFromEvent(e);case 5:resources=_context53.sent;node.dispatchEvent(new CustomEvent('dropfiles',_objectSpread({detail:{event:e,resources:resources}},options)));_context53.next=11;break;case 9:_context53.prev=9;_context53.t0=_context53["catch"](2);case 11:case"end":return _context53.stop();}},_callee52,null,[[2,9]]);}));return function handleDrop(_x87){return _ref147.apply(this,arguments);};}();node.addEventListener('drop',handleDrop);node.addEventListener('dragover',handleDragOver);// remove method
return{destroy:function destroy(){node.removeEventListener('drop',handleDrop);node.removeEventListener('dragover',handleDragOver);}};};var result$4=null;var isSoftwareRendering=function isSoftwareRendering(){if(result$4===null){if(isBrowser()){var canvas=h('canvas');result$4=!getWebGLContext(canvas,{failIfMajorPerformanceCaveat:true});releaseCanvas(canvas);}else{result$4=false;}}return result$4;};/* src/core/ui/components/Canvas.svelte generated by Svelte v3.52.0 */function create_fragment$Q(ctx){var div;var canvas_1;var mounted;var dispose;return{c:function c(){div=element("div");canvas_1=element("canvas");attr(div,"class","PinturaCanvas");},m:function m(target,anchor){insert(target,div,anchor);append(div,canvas_1);/*canvas_1_binding*/ctx[31](canvas_1);if(!mounted){dispose=[listen(canvas_1,"measure",/*measure_handler*/ctx[32]),action_destroyer(measurable.call(null,canvas_1))];mounted=true;}},p:noop,i:noop,o:noop,d:function d(detaching){if(detaching)detach(div);/*canvas_1_binding*/ctx[31](null);mounted=false;run_all(dispose);}};}function instance$R($$self,$$props,$$invalidate){var canDraw;var drawUpdate;var $maskFrameOpacityStore;var $background;var $imageOverlayColor;var $maskOpacityStore;var $mask;var blendWithCanvasBackground=function blendWithCanvasBackground(back,front){var _back=_slicedToArray(back,3),bR=_back[0],bG=_back[1],bB=_back[2];var _front=_slicedToArray(front,4),fR=_front[0],fG=_front[1],fB=_front[2],fA=_front[3];return[fR*fA+bR*(1.0-fA),fG*fA+bG*(1.0-fA),fB*fA+bB*(1.0-fA),1.0];};// used to dispatch the 'measure' event
var dispatch=createEventDispatcher();var isAnimated=$$props.isAnimated;var isTransparent=$$props.isTransparent;var maskRect=$$props.maskRect;var _$$props$maskOpacity=$$props.maskOpacity,maskOpacity=_$$props$maskOpacity===void 0?1:_$$props$maskOpacity;var _$$props$maskFrameOpa=$$props.maskFrameOpacity,maskFrameOpacity=_$$props$maskFrameOpa===void 0?0.95:_$$props$maskFrameOpa;var _$$props$maskMarkupOp=$$props.maskMarkupOpacity,maskMarkupOpacity=_$$props$maskMarkupOp===void 0?1:_$$props$maskMarkupOp;var _$$props$clipAnnotati=$$props.clipAnnotationsToImage,clipAnnotationsToImage=_$$props$clipAnnotati===void 0?true:_$$props$clipAnnotati;var _$$props$pixelRatio=$$props.pixelRatio,pixelRatio=_$$props$pixelRatio===void 0?1:_$$props$pixelRatio;var _$$props$textPixelRat=$$props.textPixelRatio,textPixelRatio=_$$props$textPixelRat===void 0?pixelRatio:_$$props$textPixelRat;var backgroundColor=$$props.backgroundColor;var _$$props$willRender=$$props.willRender,willRender=_$$props$willRender===void 0?passthrough:_$$props$willRender;var _$$props$didRender=$$props.didRender,didRender=_$$props$didRender===void 0?passthrough:_$$props$didRender;var _$$props$willRequest=$$props.willRequest,willRequest=_$$props$willRequest===void 0?undefined:_$$props$willRequest;var _$$props$loadImageDat=$$props.loadImageData,loadImageData=_$$props$loadImageDat===void 0?passthrough:_$$props$loadImageDat;var _$$props$images=$$props.images,images=_$$props$images===void 0?[]:_$$props$images;var _$$props$interfaceIma=$$props.interfaceImages,interfaceImages=_$$props$interfaceIma===void 0?[]:_$$props$interfaceIma;// internal props
var canvas;var canvasGL=null;var width=null;var height=null;//
// springyness for main preview
//
var updateSpring=function updateSpring(spring,value){return spring.set(value,{hard:!isAnimated});};var SPRING_PROPS={precision:0.0001};var SPRING_PROPS_FRACTION={precision:SPRING_PROPS.precision*0.01};// Editor UI
var durationToMilliseconds=function durationToMilliseconds(duration){var f=parseFloat(duration);if(/^[0-9]+s$/.test(duration))return f*1000;return f;};var backgroundColorAnimationDuration=0;var background=tweened(undefined,{duration:0});component_subscribe($$self,background,function(value){return $$invalidate(29,$background=value);});var maskOpacityStore=spring(1,SPRING_PROPS_FRACTION);component_subscribe($$self,maskOpacityStore,function(value){return $$invalidate(30,$maskOpacityStore=value);});var maskFrameOpacityStore=spring(1,SPRING_PROPS_FRACTION);component_subscribe($$self,maskFrameOpacityStore,function(value){return $$invalidate(40,$maskFrameOpacityStore=value);});var mask=writable();component_subscribe($$self,mask,function(value){return $$invalidate(42,$mask=value);});var imageOverlayColor=writable();component_subscribe($$self,imageOverlayColor,function(value){return $$invalidate(41,$imageOverlayColor=value);});//#region texture loading and binding
var requestRedraw=function requestRedraw(){return requestAnimationFrame(function(){// this triggers redraw of items marked as non-dirty
redrawForce=true;// this makes sure delayed redraw also works
lastDraw=0;// draw the update
drawUpdate();});};var Textures=new Map([]);var PlaceholderTextures=new Map([]);var getImageTexture=function getImageTexture(image,imageRendering){// no texture yet for this source
if(!Textures.has(image)){// is in loading state when is same as source
Textures.set(image,image);// get texture filter mode
var filter=imageRendering==='pixelated'?canvasGL.textureFilterNearest:canvasGL.textureFilterLinear;// already loaded
if(!isString(image)&&(isImageBitmap(image)||isImageData(image)||isCanvas(image)||isVideoElement(image))){// create texture
var texture=canvasGL.textureCreate();// udpate texture in gl canvas
canvasGL.textureUpdate(texture,image,{filter:filter});// update state we now have a texture
Textures.set(image,texture);}else// need to load the image
{loadImageData(image).then(function(data){// canvas destroyed while loading texture data, or no data returned
if(!canvasGL||!data)return;// create texture
var texture=canvasGL.textureCreate();// udpate texture in gl canvas
canvasGL.textureUpdate(texture,data,{filter:filter});// update state we now have a texture
Textures.set(image,texture);// need to redraw because texture is now available
requestRedraw();})["catch"](function(err){console.error(err);});}}else if(isVideoElement(image)){var _texture=Textures.get(image);// get texture filter mode
var _filter=imageRendering==='pixelated'?canvasGL.textureFilterNearest:canvasGL.textureFilterLinear;// udpate texture in gl canvas
canvasGL.textureUpdate(_texture,image,{filter:_filter});}return Textures.get(image);};var getTextTexture=function getTextTexture(shape){// no text, texture not necessary
if(!shape.text.length){PlaceholderTextures["delete"](shape.id);return undefined;}var text=shape.text,textAlign=shape.textAlign,fontFamily=shape.fontFamily,_shape$fontSize=shape.fontSize,fontSize=_shape$fontSize===void 0?16:_shape$fontSize,fontWeight=shape.fontWeight,fontVariant=shape.fontVariant,fontStyle=shape.fontStyle,_shape$lineHeight=shape.lineHeight,lineHeight=_shape$lineHeight===void 0?fontSize:_shape$lineHeight,width=shape.width,height=shape.height;var _textMeasure=textMeasure(text,shape),lastCharPosition=_textMeasure.lastCharPosition,textSize=_textMeasure.textSize;var textUID=objectUID({text:text,textAlign:textAlign,fontFamily:fontFamily,fontSize:fontSize,fontWeight:fontWeight,fontVariant:fontVariant,fontStyle:fontStyle,lineHeight:lineHeight,height:height&&lineHeight?Math.min(lastCharPosition.y,Math.ceil(height/lineHeight)*lineHeight):'auto',xOffset:lastCharPosition.x,yOffset:lastCharPosition.y});// get texture unit assigned to this specific text shape
if(!Textures.has(textUID)){// is in loading state when is same as source
Textures.set(textUID,text);// defined size of text box
// - line: undefined, undefined
// - auto: width, undefined
// - box:  width, height
var widthRounded=width&&Math.ceil(width);var heightRounded=height&&Math.ceil(height);var imageWidth=Math.ceil(textSize.width);var imageHeight=Math.ceil(textSize.height/lineHeight)*lineHeight;// so lines at end of text box are not cut of
// skip
if(imageWidth===0||imageHeight===0)return;// check if needs to scale texture
var textureSizeLimit=getWebGLTextureSizeLimit();var textureSizeScalar=Math.min(1,(textureSizeLimit-TextPadding*textPixelRatio*2)/(imageWidth*textPixelRatio),textureSizeLimit/(imageHeight*textPixelRatio));// create texture
textToImage(text,{fontSize:fontSize,fontFamily:fontFamily,fontWeight:fontWeight,fontVariant:fontVariant,fontStyle:fontStyle,textAlign:textAlign,lineHeight:lineHeight,width:widthRounded,height:heightRounded,imageWidth:imageWidth,imageHeight:imageHeight,pixelRatio:textPixelRatio*textureSizeScalar,willRequest:willRequest,color:[1,0,1]// purple will be replaced in render method
}).then(function(image){// canvas destroyed while loading texture data
if(!canvasGL)return;// create texture
var texture=canvasGL.textureCreate();// update texture in gl canvas
canvasGL.textureUpdate(texture,image,{filter:canvasGL.textureFilterLinear,scalar:textureSizeScalar});// update state we now have a texture
Textures.set(textUID,texture);// use as fallback texture for next update
PlaceholderTextures.set(shape.id,texture);// need to redraw because texture is now available
requestRedraw();})["catch"](console.error);}var texture=Textures.get(textUID);return isTexture(texture)?texture:PlaceholderTextures.get(shape.id);};var getShapeTexture=function getShapeTexture(shape){var texture;// let's create textures for backgrounds and texts
if(shape.backgroundImage){texture=getImageTexture(shape.backgroundImage,shape.backgroundImageRendering);}else// is text texture
if(isString(shape.text)){if(shape.width&&shape.width<1||shape.height&&shape.height<1)return undefined;texture=getTextTexture(shape);}return texture;};var isTexture=function isTexture(texture){return texture instanceof WebGLTexture;};var releaseUnusedTextures=function releaseUnusedTextures(usedTextures){Textures.forEach(function(registeredTexture,key){var isUsed=!!usedTextures.find(function(usedTexture){return usedTexture===registeredTexture;});// stil used, no need to release
if(isUsed||!isTexture(registeredTexture))return;// skip if used as placeholder texture
if(Array.from(PlaceholderTextures.values()).includes(registeredTexture))return;// remove this texture
Textures["delete"](key);canvasGL.textureDelete(registeredTexture);});};//#endregion
//#region drawing
var drawImageHelper=function drawImageHelper(_ref148){var data=_ref148.data,size=_ref148.size,origin=_ref148.origin,translation=_ref148.translation,rotation=_ref148.rotation,scale=_ref148.scale,colorMatrix=_ref148.colorMatrix,opacity=_ref148.opacity,convolutionMatrix=_ref148.convolutionMatrix,gamma=_ref148.gamma,vignette=_ref148.vignette,maskFeather=_ref148.maskFeather,maskCornerRadius=_ref148.maskCornerRadius,overlayColor=_ref148.overlayColor,enableOverlay=_ref148.enableOverlay,enableBlend=_ref148.enableBlend,enableAntialiasing=_ref148.enableAntialiasing;// gets texture to use for this image
var texture=getImageTexture(data);// this makes sure the image renders extra crisp on low res screens
var sharpenOffsetX=0;var sharpenOffsetY=0;if(pixelRatio===1){var atActualSize=Math.abs(1-scale)<Number.EPSILON;sharpenOffsetX=atActualSize&&width%2!==0?0.5:0;sharpenOffsetY=atActualSize&&height%2!==0?0.5:0;}// draw the image
canvasGL.drawImage(texture,size,origin.x,origin.y,translation.x+sharpenOffsetX,translation.y+sharpenOffsetY,rotation.x,rotation.y,rotation.z,scale,colorMatrix,clamp(opacity,0,1),convolutionMatrix,gamma,vignette,maskFeather,maskCornerRadius,overlayColor,enableOverlay,enableBlend,enableAntialiasing);return texture;};var backgroundCornersToUVMap=function backgroundCornersToUVMap(_ref149){var _ref150=_slicedToArray(_ref149,4),tl=_ref150[0],tr=_ref150[1],br=_ref150[2],bl=_ref150[3];// tl, tr, br, bl -> bl, tl, br, tr
// prettier-ignore
// B   D
// | \ |
// A  C
return[bl.x,bl.y,tl.x,tl.y,br.x,br.y,tr.x,tr.y];};var EmptyVector=vectorCreateEmpty();var drawShapes=function drawShapes(){var shapes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var maxSize=arguments.length>1?arguments[1]:undefined;return shapes.map(function(shape){// only show texture if shape is finished loading
var shapeTexture=!shape._isLoading&&getShapeTexture(shape);// get the webgl texture
var texture=isTexture(shapeTexture)?shapeTexture:undefined;// transforms
var scalar=shape._scale||1;var translation=shape._translate||EmptyVector;// scale stroke width
var strokeWidth=shape.strokeWidth&&shape.strokeWidth*scalar;if(isArray(shape.points)){// transform points
var points=shape.points.map(function(point){return vectorCreate(point.x*scalar+translation.x,point.y*scalar+translation.y);});canvasGL.drawPath(points,shape.rotation,shape.flipX,shape.flipY,strokeWidth,shape.strokeColor,shape.pathClose,shape.backgroundColor,shape.opacity);}else// is ellipse
if(isNumber(shape.rx)&&isNumber(shape.ry)){var _x88=shape.x;var _y=shape.y;_x88*=scalar;_y*=scalar;_x88+=translation.x;_y+=translation.y;canvasGL.drawEllipse(vectorCreate(_x88,_y),shape.rx*scalar,shape.ry*scalar,shape.rotation,shape.flipX,shape.flipY,shape.backgroundColor,texture,undefined,undefined,shape.backgroundCorners&&backgroundCornersToUVMap(shape.backgroundCorners),strokeWidth,shape.strokeColor,shape.opacity,shape.inverted);}else// is rect
if(isString(shape.text)&&texture||shape.width){var textureSize=texture&&canvasGL.textureGetSize(texture);var colorize=undefined;var shapeBackgroundColor=shape.backgroundColor;var shapeStrokeColor=shape.strokeColor;var shapeRect;var shapeCornerRadius=[shape.cornerRadius,shape.cornerRadius,shape.cornerRadius,shape.cornerRadius].map(function(v){return v*scalar;});if(shape.width){shapeRect=rectCreateFromAny(shape);}else{shapeRect=_objectSpread({x:shape.x,y:shape.y},textureSize);}// apply shape transforms
if(scalar&&translation){shapeRect.x*=scalar;shapeRect.y*=scalar;shapeRect.x+=translation.x;shapeRect.y+=translation.y;shapeRect.width*=scalar;shapeRect.height*=scalar;}// get texture
var backgroundSize;var backgroundPosition;if(textureSize){// background should be scaled
if(shape.backgroundImage&&(shape.backgroundSize||shape.backgroundPosition)){// always respect texture aspect ratio
var textureAspectRatio=getAspectRatio(textureSize.width,textureSize.height);// adjust position of background
if(shape.backgroundSize==='contain'){var rect=rectContainRect(shapeRect,textureAspectRatio,shapeRect);backgroundSize=sizeCreateFromRect(rect);if(shape.backgroundPosition){backgroundPosition=shape.backgroundPosition;}else{backgroundPosition=vectorCreate((shapeRect.width-backgroundSize.width)*0.5,(shapeRect.height-backgroundSize.height)*0.5);}}else if(shape.backgroundSize==='cover'){var _rect=rectCoverRect(shapeRect,textureAspectRatio,shapeRect);backgroundSize=sizeCreateFromRect(_rect);if(shape.backgroundPosition){backgroundPosition=shape.backgroundPosition;}else{backgroundPosition=vectorCreate(_rect.x,_rect.y);backgroundPosition=vectorCreate((shapeRect.width-backgroundSize.width)*0.5,(shapeRect.height-backgroundSize.height)*0.5);}}else// fixed size
if(shape.backgroundSize){backgroundSize=shape.backgroundSize;backgroundPosition=shape.backgroundPosition;}else// no size set but position is set
if(shape.backgroundPosition){backgroundSize=_objectSpread({},textureSize);backgroundPosition=shape.backgroundPosition;}}else// is text, "background" should be texture size and be positioned based on alignment
if(shape.text){var pixelTextureSize={width:textureSize.width/textPixelRatio,height:textureSize.height/textPixelRatio};// position texture based on text alignment
backgroundPosition=vectorCreate(0,0);backgroundSize={width:pixelTextureSize.width*scalar,height:pixelTextureSize.height*scalar};// draw background
if(shape.backgroundColor||shape.strokeColor){// remove background for text rendering draw call
shapeBackgroundColor=undefined;shapeStrokeColor=undefined;// get width and height of shape
var _width2=(shape.width||pixelTextureSize.width-TextPadding*2)*scalar;var _height3=(shape.height||pixelTextureSize.height)*scalar;canvasGL.drawRect(_objectSpread(_objectSpread({},shapeRect),{},{width:_width2,height:_height3}),shape.rotation,shape.flipX,shape.flipY,shapeCornerRadius,shape.backgroundColor,undefined,undefined,undefined,undefined,strokeWidth,shape.strokeColor,shape.opacity,undefined,undefined,shape.inverted);}// Apply TextPadding so text doesn't clip on left and right edges
shapeRect.x-=TextPadding*scalar;// The text texture needs to be colorized
colorize=shape.color||[0,0,0];// adjust width
if(shape.width){// auto scale height if is auto-height field
shapeRect.height=shapeRect.height||pixelTextureSize.height*scalar;// adjust width so we can still render characters outside of box
shapeRect.width+=TextPadding*2*scalar;// adjust when text alignment is different
if(shape.textAlign==='center'){backgroundPosition.x=(shapeRect.width-backgroundSize.width)*0.5;}else if(shape.textAlign==='right'){backgroundPosition.x=shapeRect.width-backgroundSize.width;}}else{shapeRect.width=pixelTextureSize.width*scalar;shapeRect.height=pixelTextureSize.height*scalar;}// make color transparent
if(shape._prerender)colorize[3]=0;}}canvasGL.drawRect(shapeRect,shape.rotation,shape.flipX,shape.flipY,shapeCornerRadius,shapeBackgroundColor,texture,backgroundSize,backgroundPosition,shape.backgroundCorners&&backgroundCornersToUVMap(shape.backgroundCorners),strokeWidth,shapeStrokeColor,shape.opacity,undefined,colorize,shape.inverted);}return shapeTexture;}).filter(Boolean);};// redraws state
var redrawForce=false;var isFirstDraw=true;var wasFlipping=false;var usedBlendTextures=[];var usedAnnotationTextures=[];var usedTextures=[];var redraw=function redraw(){// reset array of textures used in this draw call
usedTextures.length=0;// get top image shortcut
var imagesTop=images[0];// allow dev to inject more shapes
var _willRender=willRender({// top image state shortcut
opacity:imagesTop.opacity,rotation:imagesTop.rotation,scale:imagesTop.scale,// active images
images:images,// canvas size
size:sizeCreate(width,height),// canvas background
backgroundColor:_toConsumableArray($background),// preview selection rect
selectionRect:$mask}),blendShapes=_willRender.blendShapes,blendShapesDirty=_willRender.blendShapesDirty,annotationShapes=_willRender.annotationShapes,annotationShapesDirty=_willRender.annotationShapesDirty,interfaceShapes=_willRender.interfaceShapes,decorationShapes=_willRender.decorationShapes,frameShapes=_willRender.frameShapes;var canvasBackgroundColor=_toConsumableArray($background);// adjust mask a bit so bacckground color doesn't bleed through
var imagesMask=$mask;var imagesMaskOpacity=clamp($maskOpacityStore,0,1);var imagesOverlayColor=$imageOverlayColor;var xFlipProgress=Math.abs(-1+imagesTop.rotation.x/Math.PI*2);var yFlipProgress=Math.abs(-1+imagesTop.rotation.y/Math.PI*2);var isFlipping=xFlipProgress<0.99||yFlipProgress<0.99;var imagesSize=_objectSpread({},imagesTop.size);var imagesBackgroundColor=imagesTop.backgroundColor;var imagesBackgroundImage=imagesTop.backgroundImage;// no need to draw to blend framebuffer if no redactions
var hasBlendShapes=blendShapes.length>0;// no need to draw to markup framebuffer if no annotations
var hasAnnotations=annotationShapes.length>0;// if image has background color
var hasImageBackgroundColor=imagesBackgroundColor[3]>0.0;// if the overlay is transparent so we can see the canvas
var hasTransparentOverlay=imagesMaskOpacity<1.0;// should mask annotations outside of preview
var hasPreviewStencil=clipAnnotationsToImage?maskMarkupOpacity>=1:false;//clipAnnotationsToImage || maskMarkupOpacity >= 1;
// set canvas background color to image background color if is defined
if(hasTransparentOverlay&&hasImageBackgroundColor){var backR=canvasBackgroundColor[0];var backG=canvasBackgroundColor[1];var backB=canvasBackgroundColor[2];var frontA=1.0-imagesMaskOpacity;var frontR=imagesBackgroundColor[0]*frontA;var frontG=imagesBackgroundColor[1]*frontA;var frontB=imagesBackgroundColor[2]*frontA;var fA=1.0-frontA;canvasBackgroundColor[0]=frontR+backR*fA;canvasBackgroundColor[1]=frontG+backG*fA;canvasBackgroundColor[2]=frontB+backB*fA;canvasBackgroundColor[3]=1;}// make background transparent
canvasGL.setCanvasColor(isTransparent?[0,0,0,0]:canvasBackgroundColor);// if has blend shapes draw blend shapes to framebuffer
if(hasBlendShapes&&blendShapesDirty){canvasGL.disableMask();canvasGL.drawToImageBlendBuffer(imagesSize);usedBlendTextures.length=0;usedBlendTextures.push.apply(usedBlendTextures,_toConsumableArray(drawShapes(blendShapes)));}else if(!hasBlendShapes){usedBlendTextures.length=0;}usedTextures.push.apply(usedTextures,usedBlendTextures);// prepare overlay frame buffer
if(isFirstDraw){canvasGL.drawToImageOverlayBuffer(imagesSize,textPixelRatio);isFirstDraw=false;}// if has annotations draw annotation shapes to framebuffer
var shouldDrawAnnotations=hasAnnotations&&(annotationShapesDirty||redrawForce);if(isFlipping){if(shouldDrawAnnotations||!wasFlipping){canvasGL.disableMask();canvasGL.drawToImageOverlayBuffer(imagesSize,textPixelRatio);usedAnnotationTextures.length=0;usedAnnotationTextures.push.apply(usedAnnotationTextures,_toConsumableArray(drawShapes(annotationShapes)));}else if(!hasAnnotations){usedAnnotationTextures.length=0;}// we use wasFlipping so we know when we should redraw the overlay framebuffer
wasFlipping=true;}else{wasFlipping=false;}// switch to canvas drawing for other elements
canvasGL.drawToCanvas();canvasGL.enableMask(imagesMask,imagesMaskOpacity);// draw a colored rectangle behind main preview image
if(hasImageBackgroundColor){canvasGL.drawRect(imagesMask,0,false,false,[0,0,0,0],blendWithCanvasBackground($background,imagesBackgroundColor));}if(imagesBackgroundImage){// hide background image outside of crop area
canvasGL.enableMask(imagesMask,1.0);var _scalar4=Math.max(maskRect.width/imagesBackgroundImage.width,maskRect.height/imagesBackgroundImage.height);var _width3=imagesBackgroundImage.width*_scalar4;var _height4=imagesBackgroundImage.height*_scalar4;var rect={x:maskRect.x+maskRect.width*0.5-_width3*0.5,y:maskRect.y+maskRect.height*0.5-_height4*0.5,width:_width3,height:_height4};canvasGL.drawRect(rect,0,false,false,[0,0,0,0],[0,0,0,0],getImageTexture(imagesBackgroundImage,'linear'));canvasGL.enableMask(imagesMask,imagesMaskOpacity);}hasPreviewStencil&&canvasGL.enablePreviewStencil();usedTextures.push.apply(usedTextures,_toConsumableArray(_toConsumableArray(images).reverse().map(function(image){return drawImageHelper(_objectSpread(_objectSpread({},image),{},{// enable drawing markup if defined
enableOverlay:isFlipping&&hasAnnotations,// enable drawing redactions if defined
enableBlend:hasBlendShapes,// antialias image edges
enableAntialiasing:true,// mask and overlay positions
mask:imagesMask,maskOpacity:imagesMaskOpacity,// overlay
overlayColor:imagesOverlayColor}));})));// TODO: move vignette here (draw with colorized circular gradient texture instead of in shader)
// set markup mask
canvasGL.enableMask(imagesMask,maskMarkupOpacity);// draw shapes in UI instead of framebuffer
if(!isFlipping){// only draw in image area
hasPreviewStencil&&canvasGL.applyPreviewStencil();// draw shapes
canvasGL.resetCanvasMatrix();canvasGL.updateCanvasMatrix(imagesSize,imagesTop.origin,imagesTop.translation,imagesTop.scale,imagesTop.rotation);// draw shapes
usedAnnotationTextures.length=0;usedAnnotationTextures.push.apply(usedAnnotationTextures,_toConsumableArray(drawShapes(annotationShapes)));// stencil no longer needed
hasPreviewStencil&&canvasGL.disablePreviewStencil();}usedTextures.push.apply(usedTextures,usedAnnotationTextures);// draw decorations shapes relative to crop
canvasGL.resetCanvasMatrix();canvasGL.enableMask(imagesMask,maskMarkupOpacity);usedTextures.push.apply(usedTextures,_toConsumableArray(drawShapes(decorationShapes)));// draw frames
if(frameShapes.length){// set frame mask
canvasGL.enableMask(imagesMask,1);var shapesInside=frameShapes.filter(function(shape){return!shape.expandsCanvas;});var shapesOutside=frameShapes.filter(function(shape){return shape.expandsCanvas;});if(shapesInside.length){usedTextures.push.apply(usedTextures,_toConsumableArray(drawShapes(shapesInside)));}if(shapesOutside.length){// the half pixel helps mask the outside shapes at the correct position
canvasGL.enableMask({x:imagesMask.x+0.5,y:imagesMask.y+0.5,width:imagesMask.width-1,height:imagesMask.height-1},$maskFrameOpacityStore);usedTextures.push.apply(usedTextures,_toConsumableArray(drawShapes(shapesOutside)));}}// crop mask not used for interface
canvasGL.disableMask();// frames rendered on the outside
// draw custom interface shapes
usedTextures.push.apply(usedTextures,_toConsumableArray(drawShapes(interfaceShapes)));interfaceImages.forEach(function(image){canvasGL.enableMask(image.mask,image.maskOpacity);// draw background fill
if(image.backgroundColor){// calculate background image cover rect
var backgroundRect=imagesBackgroundImage&&rectCoverRect(_objectSpread({},image.mask),imagesBackgroundImage.width/imagesBackgroundImage.height);var backgroundImage=imagesBackgroundImage&&getImageTexture(imagesBackgroundImage,'linear');canvasGL.drawRect(image.mask,0,false,false,image.maskCornerRadius,image.backgroundColor,backgroundImage,backgroundRect,backgroundRect,undefined,undefined,undefined,image.opacity,image.maskFeather);}// draw image
drawImageHelper(_objectSpread(_objectSpread({},image),{},{// antialias edges
enableAntialiasing:false,// update translation to apply `offset` from top left
translation:{x:image.translation.x+image.offset.x-width*0.5,y:image.translation.y+image.offset.y-height*0.5}}));});canvasGL.disableMask();// determine which textures can be dropped
releaseUnusedTextures(usedTextures);// done rendering
didRender();// redraw force flag
redrawForce=false;};//#endregion
//#region set up
// throttled redrawer
var lastDraw=0;var redrawThrottled=function redrawThrottled(){var now=Date.now();var dist=now-lastDraw;if(dist<48)return;lastDraw=now;redraw();};// returns the render function to use for this browser context
var selectFittingRenderFunction=function selectFittingRenderFunction(){return isSoftwareRendering()?redrawThrottled:redraw;};// after DOM has been altered, redraw to canvas
afterUpdate(function(){return drawUpdate();});// hook up canvas to WebGL drawer
onMount(function(){return $$invalidate(25,canvasGL=createWebGLCanvas(canvas,{alpha:isTransparent}));});// clean up canvas
onDestroy(function(){// if canvas wasn't created we don't need to release it
if(!canvasGL)return;// done drawing
canvasGL.release();// remove reference
$$invalidate(25,canvasGL=undefined);$$invalidate(0,canvas=undefined);});function canvas_1_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){canvas=$$value;$$invalidate(0,canvas);});}var measure_handler=function measure_handler(e){$$invalidate(1,width=e.detail.width);$$invalidate(2,height=e.detail.height);dispatch('measure',{width:width,height:height});};$$self.$$set=function($$props){if('isAnimated'in $$props)$$invalidate(9,isAnimated=$$props.isAnimated);if('isTransparent'in $$props)$$invalidate(10,isTransparent=$$props.isTransparent);if('maskRect'in $$props)$$invalidate(11,maskRect=$$props.maskRect);if('maskOpacity'in $$props)$$invalidate(12,maskOpacity=$$props.maskOpacity);if('maskFrameOpacity'in $$props)$$invalidate(13,maskFrameOpacity=$$props.maskFrameOpacity);if('maskMarkupOpacity'in $$props)$$invalidate(14,maskMarkupOpacity=$$props.maskMarkupOpacity);if('clipAnnotationsToImage'in $$props)$$invalidate(15,clipAnnotationsToImage=$$props.clipAnnotationsToImage);if('pixelRatio'in $$props)$$invalidate(16,pixelRatio=$$props.pixelRatio);if('textPixelRatio'in $$props)$$invalidate(17,textPixelRatio=$$props.textPixelRatio);if('backgroundColor'in $$props)$$invalidate(18,backgroundColor=$$props.backgroundColor);if('willRender'in $$props)$$invalidate(19,willRender=$$props.willRender);if('didRender'in $$props)$$invalidate(20,didRender=$$props.didRender);if('willRequest'in $$props)$$invalidate(21,willRequest=$$props.willRequest);if('loadImageData'in $$props)$$invalidate(22,loadImageData=$$props.loadImageData);if('images'in $$props)$$invalidate(23,images=$$props.images);if('interfaceImages'in $$props)$$invalidate(24,interfaceImages=$$props.interfaceImages);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*canvas*/1){if(canvas){var propertyValue=getComputedStyle(canvas).getPropertyValue('--color-transition-duration');$$invalidate(26,backgroundColorAnimationDuration=durationToMilliseconds(propertyValue));}}if($$self.$$.dirty[0]&/*backgroundColor, isAnimated, backgroundColorAnimationDuration*/67371520){backgroundColor&&background.set(backgroundColor,{duration:isAnimated?backgroundColorAnimationDuration:0});}if($$self.$$.dirty[0]&/*maskOpacity*/4096){updateSpring(maskOpacityStore,isNumber(maskOpacity)?maskOpacity:1);}if($$self.$$.dirty[0]&/*maskFrameOpacity*/8192){updateSpring(maskFrameOpacityStore,isNumber(maskFrameOpacity)?maskFrameOpacity:1);}if($$self.$$.dirty[0]&/*maskRect*/2048){maskRect&&mask.set(maskRect);}if($$self.$$.dirty[0]&/*$background, $maskOpacityStore*/1610612736){$background&&imageOverlayColor.set([$background[0],$background[1],$background[2],clamp($maskOpacityStore,0,1)]);}if($$self.$$.dirty[0]&/*canvasGL, width, height, images*/41943046){// can draw view
$$invalidate(28,canDraw=!!(canvasGL&&width&&height&&images.length));}if($$self.$$.dirty[0]&/*width, height, canvasGL, pixelRatio*/33619974){// observe width and height changes and resize the canvas proportionally
if(width&&height&&canvasGL){// need to reset last draw date so throttled redraw always runs redraw logic after resize
lastDraw=0;// resize canvas
canvasGL.resize(width,height,pixelRatio);}}if($$self.$$.dirty[0]&/*canDraw*/268435456){// switch to draw method when can draw
$$invalidate(27,drawUpdate=canDraw?selectFittingRenderFunction():noop$1);}if($$self.$$.dirty[0]&/*canDraw, drawUpdate*/402653184){// if can draw state is updated and we have a draw update function, time to redraw
canDraw&&drawUpdate&&drawUpdate();}};return[canvas,width,height,dispatch,background,maskOpacityStore,maskFrameOpacityStore,mask,imageOverlayColor,isAnimated,isTransparent,maskRect,maskOpacity,maskFrameOpacity,maskMarkupOpacity,clipAnnotationsToImage,pixelRatio,textPixelRatio,backgroundColor,willRender,didRender,willRequest,loadImageData,images,interfaceImages,canvasGL,backgroundColorAnimationDuration,drawUpdate,canDraw,$background,$maskOpacityStore,canvas_1_binding,measure_handler];}var Canvas=/*#__PURE__*/function(_SvelteComponent){_inherits(Canvas,_SvelteComponent);var _super2=_createSuper(Canvas);function Canvas(options){var _this3;_classCallCheck(this,Canvas);_this3=_super2.call(this);init(_assertThisInitialized(_this3),options,instance$R,create_fragment$Q,safe_not_equal,{isAnimated:9,isTransparent:10,maskRect:11,maskOpacity:12,maskFrameOpacity:13,maskMarkupOpacity:14,clipAnnotationsToImage:15,pixelRatio:16,textPixelRatio:17,backgroundColor:18,willRender:19,didRender:20,willRequest:21,loadImageData:22,images:23,interfaceImages:24},null,[-1,-1,-1]);return _this3;}return _createClass(Canvas);}(SvelteComponent);var arrayJoin=function arrayJoin(arr){var filter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Boolean;var str=arguments.length>2&&arguments[2]!==undefined?arguments[2]:' ';return arr.filter(filter).join(str);};/* src/core/ui/components/TabList.svelte generated by Svelte v3.52.0 */function get_each_context$9(ctx,list,i){var child_ctx=ctx.slice();child_ctx[17]=list[i];return child_ctx;}var get_default_slot_changes$1=function get_default_slot_changes$1(dirty){return{tab:dirty&/*tabNodes*/4};};var get_default_slot_context$1=function get_default_slot_context$1(ctx){return{tab:/*tab*/ctx[17]};};// (52:0) {#if shouldRender}
function create_if_block$h(ctx){var ul;var each_blocks=[];var each_1_lookup=new Map();var ul_class_value;var current;var each_value=/*tabNodes*/ctx[2];var get_key=function get_key(ctx){return(/*tab*/ctx[17].id);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$9(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$9(key,child_ctx));}return{c:function c(){ul=element("ul");for(var _i2=0;_i2<each_blocks.length;_i2+=1){each_blocks[_i2].c();}attr(ul,"class",ul_class_value=arrayJoin(['PinturaTabList',/*klass*/ctx[0]]));attr(ul,"role","tablist");attr(ul,"data-layout",/*layout*/ctx[1]);},m:function m(target,anchor){insert(target,ul,anchor);for(var _i3=0;_i3<each_blocks.length;_i3+=1){each_blocks[_i3].m(ul,null);}/*ul_binding*/ctx[14](ul);current=true;},p:function p(ctx,dirty){if(dirty&/*tabNodes, handleKeyTab, handleClickTab, $$scope*/1124){each_value=/*tabNodes*/ctx[2];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value,each_1_lookup,ul,outro_and_destroy_block,create_each_block$9,null,get_each_context$9);check_outros();}if(!current||dirty&/*klass*/1&&ul_class_value!==(ul_class_value=arrayJoin(['PinturaTabList',/*klass*/ctx[0]]))){attr(ul,"class",ul_class_value);}if(!current||dirty&/*layout*/2){attr(ul,"data-layout",/*layout*/ctx[1]);}},i:function i(local){if(current)return;for(var _i4=0;_i4<each_value.length;_i4+=1){transition_in(each_blocks[_i4]);}current=true;},o:function o(local){for(var _i5=0;_i5<each_blocks.length;_i5+=1){transition_out(each_blocks[_i5]);}current=false;},d:function d(detaching){if(detaching)detach(ul);for(var _i6=0;_i6<each_blocks.length;_i6+=1){each_blocks[_i6].d();}/*ul_binding*/ctx[14](null);}};}// (59:8) {#each tabNodes as tab (tab.id)}
function create_each_block$9(key_1,ctx){var li;var button;var button_disabled_value;var t;var li_aria_controls_value;var li_id_value;var li_aria_selected_value;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[11]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[10],get_default_slot_context$1);function keydown_handler(){var _ctx5;for(var _len4=arguments.length,args=new Array(_len4),_key7=0;_key7<_len4;_key7++){args[_key7]=arguments[_key7];}return(/*keydown_handler*/(_ctx5=ctx)[12].apply(_ctx5,[/*tab*/ctx[17]].concat(args)));}function click_handler(){var _ctx6;for(var _len5=arguments.length,args=new Array(_len5),_key8=0;_key8<_len5;_key8++){args[_key8]=arguments[_key8];}return(/*click_handler*/(_ctx6=ctx)[13].apply(_ctx6,[/*tab*/ctx[17]].concat(args)));}return{key:key_1,first:null,c:function c(){li=element("li");button=element("button");if(default_slot)default_slot.c();t=space();attr(button,"type","button");button.disabled=button_disabled_value=/*tab*/ctx[17].disabled;attr(li,"role","tab");attr(li,"aria-controls",li_aria_controls_value=/*tab*/ctx[17].href.substr(1));attr(li,"id",li_id_value=/*tab*/ctx[17].tabId);attr(li,"aria-selected",li_aria_selected_value=/*tab*/ctx[17].selected);this.first=li;},m:function m(target,anchor){insert(target,li,anchor);append(li,button);if(default_slot){default_slot.m(button,null);}append(li,t);current=true;if(!mounted){dispose=[listen(button,"keydown",keydown_handler),listen(button,"click",click_handler)];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope, tabNodes*/1028)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[10],!current?get_all_dirty_from_scope(/*$$scope*/ctx[10]):get_slot_changes(default_slot_template,/*$$scope*/ctx[10],dirty,get_default_slot_changes$1),get_default_slot_context$1);}}if(!current||dirty&/*tabNodes*/4&&button_disabled_value!==(button_disabled_value=/*tab*/ctx[17].disabled)){button.disabled=button_disabled_value;}if(!current||dirty&/*tabNodes*/4&&li_aria_controls_value!==(li_aria_controls_value=/*tab*/ctx[17].href.substr(1))){attr(li,"aria-controls",li_aria_controls_value);}if(!current||dirty&/*tabNodes*/4&&li_id_value!==(li_id_value=/*tab*/ctx[17].tabId)){attr(li,"id",li_id_value);}if(!current||dirty&/*tabNodes*/4&&li_aria_selected_value!==(li_aria_selected_value=/*tab*/ctx[17].selected)){attr(li,"aria-selected",li_aria_selected_value);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(li);if(default_slot)default_slot.d(detaching);mounted=false;run_all(dispose);}};}function create_fragment$P(ctx){var if_block_anchor;var current;var if_block=/*shouldRender*/ctx[4]&&create_if_block$h(ctx);return{c:function c(){if(if_block)if_block.c();if_block_anchor=empty();},m:function m(target,anchor){if(if_block)if_block.m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,_ref151){var _ref152=_slicedToArray(_ref151,1),dirty=_ref152[0];if(/*shouldRender*/ctx[4]){if(if_block){if_block.p(ctx,dirty);if(dirty&/*shouldRender*/16){transition_in(if_block,1);}}else{if_block=create_if_block$h(ctx);if_block.c();transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(if_block)if_block.d(detaching);if(detaching)detach(if_block_anchor);}};}function instance$Q($$self,$$props,$$invalidate){var tabNodes;var shouldRender;var _$$props$$$slots=$$props.$$slots,slots=_$$props$$$slots===void 0?{}:_$$props$$$slots,$$scope=$$props.$$scope;var root;var _$$props$class=$$props["class"],klass=_$$props$class===void 0?undefined:_$$props$class;var name=$$props.name;var selected=$$props.selected;var _$$props$tabs=$$props.tabs,tabs=_$$props$tabs===void 0?[]:_$$props$tabs;var _$$props$layout=$$props.layout,layout=_$$props$layout===void 0?undefined:_$$props$layout;var dispatch=createEventDispatcher();var focusTab=function focusTab(index){var tab=root.querySelectorAll('[role="tab"] button')[index];if(!tab)return;tab.focus();};var handleClickTab=function handleClickTab(e,id){e.preventDefault();e.stopPropagation();dispatch('select',id);};var handleKeyTab=function handleKeyTab(_ref153,id){var key=_ref153.key;if(!/arrow/i.test(key))return;var index=tabs.findIndex(function(tab){return tab.id===id;});// next
if(/right|down/i.test(key))return focusTab(index<tabs.length-1?index+1:0);// prev
if(/left|up/i.test(key))return focusTab(index>0?index-1:tabs.length-1);};var keydown_handler=function keydown_handler(tab,e){return handleKeyTab(e,tab.id);};var click_handler=function click_handler(tab,e){return handleClickTab(e,tab.id);};function ul_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){root=$$value;$$invalidate(3,root);});}$$self.$$set=function($$props){if('class'in $$props)$$invalidate(0,klass=$$props["class"]);if('name'in $$props)$$invalidate(7,name=$$props.name);if('selected'in $$props)$$invalidate(8,selected=$$props.selected);if('tabs'in $$props)$$invalidate(9,tabs=$$props.tabs);if('layout'in $$props)$$invalidate(1,layout=$$props.layout);if('$$scope'in $$props)$$invalidate(10,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty&/*tabs, selected, name*/896){$$invalidate(2,tabNodes=tabs.map(function(tab){var isActive=tab.id===selected;return _objectSpread(_objectSpread({},tab),{},{tabId:"tab-".concat(name,"-").concat(tab.id),href:"#panel-".concat(name,"-").concat(tab.id),selected:isActive});}));}if($$self.$$.dirty&/*tabNodes*/4){$$invalidate(4,shouldRender=tabNodes.length>1);}};return[klass,layout,tabNodes,root,shouldRender,handleClickTab,handleKeyTab,name,selected,tabs,$$scope,slots,keydown_handler,click_handler,ul_binding];}var TabList=/*#__PURE__*/function(_SvelteComponent2){_inherits(TabList,_SvelteComponent2);var _super3=_createSuper(TabList);function TabList(options){var _this4;_classCallCheck(this,TabList);_this4=_super3.call(this);init(_assertThisInitialized(_this4),options,instance$Q,create_fragment$P,safe_not_equal,{"class":0,name:7,selected:8,tabs:9,layout:1});return _this4;}return _createClass(TabList);}(SvelteComponent);/* src/core/ui/components/TabPanels.svelte generated by Svelte v3.52.0 */var get_default_slot_changes_1=function get_default_slot_changes_1(dirty){return{panel:dirty&/*panelNodes*/16};};var get_default_slot_context_1=function get_default_slot_context_1(ctx){return{panel:/*panelNodes*/ctx[4][0].id,panelIsActive:true};};function get_each_context$8(ctx,list,i){var child_ctx=ctx.slice();child_ctx[14]=list[i].id;child_ctx[15]=list[i].shouldDraw;child_ctx[16]=list[i].panelId;child_ctx[17]=list[i].tabindex;child_ctx[18]=list[i].labelledBy;child_ctx[19]=list[i].isActive;child_ctx[20]=list[i].hidden;child_ctx[3]=list[i].visible;return child_ctx;}var get_default_slot_changes=function get_default_slot_changes(dirty){return{panel:dirty&/*panelNodes*/16,panelIsActive:dirty&/*panelNodes*/16};};var get_default_slot_context=function get_default_slot_context(ctx){return{panel:/*id*/ctx[14],panelIsActive:/*isActive*/ctx[19]};};// (60:0) {:else}
function create_else_block$6(ctx){var div1;var div0;var div0_class_value;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[11]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[10],get_default_slot_context_1);return{c:function c(){div1=element("div");div0=element("div");if(default_slot)default_slot.c();attr(div0,"class",div0_class_value=arrayJoin([/*panelClass*/ctx[1]]));attr(div1,"class",/*klass*/ctx[0]);attr(div1,"style",/*style*/ctx[2]);},m:function m(target,anchor){insert(target,div1,anchor);append(div1,div0);if(default_slot){default_slot.m(div0,null);}current=true;if(!mounted){dispose=[listen(div1,"measure",/*measure_handler_1*/ctx[13]),action_destroyer(measurable.call(null,div1))];mounted=true;}},p:function p(ctx,dirty){if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope, panelNodes*/1040)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[10],!current?get_all_dirty_from_scope(/*$$scope*/ctx[10]):get_slot_changes(default_slot_template,/*$$scope*/ctx[10],dirty,get_default_slot_changes_1),get_default_slot_context_1);}}if(!current||dirty&/*panelClass*/2&&div0_class_value!==(div0_class_value=arrayJoin([/*panelClass*/ctx[1]]))){attr(div0,"class",div0_class_value);}if(!current||dirty&/*klass*/1){attr(div1,"class",/*klass*/ctx[0]);}if(!current||dirty&/*style*/4){attr(div1,"style",/*style*/ctx[2]);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div1);if(default_slot)default_slot.d(detaching);mounted=false;run_all(dispose);}};}// (39:0) {#if shouldRender}
function create_if_block$g(ctx){var div;var each_blocks=[];var each_1_lookup=new Map();var div_class_value;var current;var mounted;var dispose;var each_value=/*panelNodes*/ctx[4];var get_key=function get_key(ctx){return(/*id*/ctx[14]);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$8(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$8(key,child_ctx));}return{c:function c(){div=element("div");for(var _i7=0;_i7<each_blocks.length;_i7+=1){each_blocks[_i7].c();}attr(div,"class",div_class_value=arrayJoin(['PinturaTabPanels',/*klass*/ctx[0]]));attr(div,"style",/*style*/ctx[2]);},m:function m(target,anchor){insert(target,div,anchor);for(var _i8=0;_i8<each_blocks.length;_i8+=1){each_blocks[_i8].m(div,null);}current=true;if(!mounted){dispose=[listen(div,"measure",/*measure_handler*/ctx[12]),action_destroyer(measurable.call(null,div,{observePosition:true}))];mounted=true;}},p:function p(ctx,dirty){if(dirty&/*arrayJoin, panelClass, panelNodes, $$scope*/1042){each_value=/*panelNodes*/ctx[4];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value,each_1_lookup,div,outro_and_destroy_block,create_each_block$8,null,get_each_context$8);check_outros();}if(!current||dirty&/*klass*/1&&div_class_value!==(div_class_value=arrayJoin(['PinturaTabPanels',/*klass*/ctx[0]]))){attr(div,"class",div_class_value);}if(!current||dirty&/*style*/4){attr(div,"style",/*style*/ctx[2]);}},i:function i(local){if(current)return;for(var _i9=0;_i9<each_value.length;_i9+=1){transition_in(each_blocks[_i9]);}current=true;},o:function o(local){for(var _i10=0;_i10<each_blocks.length;_i10+=1){transition_out(each_blocks[_i10]);}current=false;},d:function d(detaching){if(detaching)detach(div);for(var _i11=0;_i11<each_blocks.length;_i11+=1){each_blocks[_i11].d();}mounted=false;run_all(dispose);}};}// (56:16) {#if shouldDraw}
function create_if_block_1$e(ctx){var current;var default_slot_template=/*#slots*/ctx[11]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[10],get_default_slot_context);return{c:function c(){if(default_slot)default_slot.c();},m:function m(target,anchor){if(default_slot){default_slot.m(target,anchor);}current=true;},p:function p(ctx,dirty){if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope, panelNodes*/1040)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[10],!current?get_all_dirty_from_scope(/*$$scope*/ctx[10]):get_slot_changes(default_slot_template,/*$$scope*/ctx[10],dirty,get_default_slot_changes),get_default_slot_context);}}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(default_slot)default_slot.d(detaching);}};}// (47:8) {#each panelNodes as { id, shouldDraw, panelId, tabindex, labelledBy, isActive, hidden, visible }
function create_each_block$8(key_1,ctx){var div;var t;var div_class_value;var div_hidden_value;var div_id_value;var div_tabindex_value;var div_aria_labelledby_value;var div_data_inert_value;var current;var if_block=/*shouldDraw*/ctx[15]&&create_if_block_1$e(ctx);return{key:key_1,first:null,c:function c(){div=element("div");if(if_block)if_block.c();t=space();attr(div,"class",div_class_value=arrayJoin(['PinturaTabPanel',/*panelClass*/ctx[1]]));div.hidden=div_hidden_value=/*hidden*/ctx[20];attr(div,"id",div_id_value=/*panelId*/ctx[16]);attr(div,"tabindex",div_tabindex_value=/*tabindex*/ctx[17]);attr(div,"aria-labelledby",div_aria_labelledby_value=/*labelledBy*/ctx[18]);attr(div,"data-inert",div_data_inert_value=!/*visible*/ctx[3]);this.first=div;},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);append(div,t);current=true;},p:function p(new_ctx,dirty){ctx=new_ctx;if(/*shouldDraw*/ctx[15]){if(if_block){if_block.p(ctx,dirty);if(dirty&/*panelNodes*/16){transition_in(if_block,1);}}else{if_block=create_if_block_1$e(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,t);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if(!current||dirty&/*panelClass*/2&&div_class_value!==(div_class_value=arrayJoin(['PinturaTabPanel',/*panelClass*/ctx[1]]))){attr(div,"class",div_class_value);}if(!current||dirty&/*panelNodes*/16&&div_hidden_value!==(div_hidden_value=/*hidden*/ctx[20])){div.hidden=div_hidden_value;}if(!current||dirty&/*panelNodes*/16&&div_id_value!==(div_id_value=/*panelId*/ctx[16])){attr(div,"id",div_id_value);}if(!current||dirty&/*panelNodes*/16&&div_tabindex_value!==(div_tabindex_value=/*tabindex*/ctx[17])){attr(div,"tabindex",div_tabindex_value);}if(!current||dirty&/*panelNodes*/16&&div_aria_labelledby_value!==(div_aria_labelledby_value=/*labelledBy*/ctx[18])){attr(div,"aria-labelledby",div_aria_labelledby_value);}if(!current||dirty&/*panelNodes*/16&&div_data_inert_value!==(div_data_inert_value=!/*visible*/ctx[3])){attr(div,"data-inert",div_data_inert_value);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();}};}function create_fragment$O(ctx){var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block$g,create_else_block$6];var if_blocks=[];function select_block_type(ctx,dirty){if(/*shouldRender*/ctx[5])return 0;return 1;}current_block_type_index=select_block_type(ctx);if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);return{c:function c(){if_block.c();if_block_anchor=empty();},m:function m(target,anchor){if_blocks[current_block_type_index].m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,_ref154){var _ref155=_slicedToArray(_ref154,1),dirty=_ref155[0];var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if_blocks[current_block_type_index].d(detaching);if(detaching)detach(if_block_anchor);}};}function instance$P($$self,$$props,$$invalidate){var panelNodes;var shouldRender;var _$$props$$$slots2=$$props.$$slots,slots=_$$props$$$slots2===void 0?{}:_$$props$$$slots2,$$scope=$$props.$$scope;var _$$props$class2=$$props["class"],klass=_$$props$class2===void 0?undefined:_$$props$class2;var name=$$props.name;var selected=$$props.selected;var _$$props$panelClass=$$props.panelClass,panelClass=_$$props$panelClass===void 0?undefined:_$$props$panelClass;var _$$props$panels=$$props.panels,panels=_$$props$panels===void 0?[]:_$$props$panels;var _$$props$visible=$$props.visible,visible=_$$props$visible===void 0?undefined:_$$props$visible;var _$$props$style=$$props.style,style=_$$props$style===void 0?undefined:_$$props$style;var drawCache={};function measure_handler(event){bubble.call(this,$$self,event);}function measure_handler_1(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('class'in $$props)$$invalidate(0,klass=$$props["class"]);if('name'in $$props)$$invalidate(6,name=$$props.name);if('selected'in $$props)$$invalidate(7,selected=$$props.selected);if('panelClass'in $$props)$$invalidate(1,panelClass=$$props.panelClass);if('panels'in $$props)$$invalidate(8,panels=$$props.panels);if('visible'in $$props)$$invalidate(3,visible=$$props.visible);if('style'in $$props)$$invalidate(2,style=$$props.style);if('$$scope'in $$props)$$invalidate(10,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty&/*panels, selected, visible, name, drawCache*/968){$$invalidate(4,panelNodes=panels.map(function(id){var isActive=id===selected;// remember that this tab was active so we keep drawing it even when it's inactive, speeds up page rendering
if(isActive)$$invalidate(9,drawCache[id]=true,drawCache);var isVisible=visible?visible.indexOf(id)!==-1:isActive;return{id:id,panelId:"panel-".concat(name,"-").concat(id),labelledBy:"tab-".concat(name,"-").concat(id),isActive:isActive,hidden:!isActive,visible:isVisible,tabindex:isActive?0:-1,shouldDraw:isActive||drawCache[id]};}));}if($$self.$$.dirty&/*panelNodes*/16){$$invalidate(5,shouldRender=panelNodes.length>1);}};return[klass,panelClass,style,visible,panelNodes,shouldRender,name,selected,panels,drawCache,$$scope,slots,measure_handler,measure_handler_1];}var TabPanels=/*#__PURE__*/function(_SvelteComponent3){_inherits(TabPanels,_SvelteComponent3);var _super4=_createSuper(TabPanels);function TabPanels(options){var _this5;_classCallCheck(this,TabPanels);_this5=_super4.call(this);init(_assertThisInitialized(_this5),options,instance$P,create_fragment$O,safe_not_equal,{"class":0,name:6,selected:7,panelClass:1,panels:8,visible:3,style:2});return _this5;}return _createClass(TabPanels);}(SvelteComponent);var getComponentExportedProps=function getComponentExportedProps(Component){var descriptors=Object.getOwnPropertyDescriptors(Component.prototype);return Object.keys(descriptors).filter(function(key){return!!descriptors[key]['get'];});};/* src/core/ui/components/Icon.svelte generated by Svelte v3.52.0 */function create_fragment$N(ctx){var svg;var svg_viewBox_value;var current;var default_slot_template=/*#slots*/ctx[5]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[4],null);return{c:function c(){svg=svg_element("svg");if(default_slot)default_slot.c();attr(svg,"class",/*klass*/ctx[3]);attr(svg,"style",/*style*/ctx[2]);attr(svg,"width",/*width*/ctx[0]);attr(svg,"height",/*height*/ctx[1]);attr(svg,"viewBox",svg_viewBox_value="0 0 "+/*width*/ctx[0]+"\n    "+/*height*/ctx[1]);attr(svg,"xmlns","http://www.w3.org/2000/svg");attr(svg,"aria-hidden","true");attr(svg,"focusable","false");attr(svg,"stroke-linecap","round");attr(svg,"stroke-linejoin","round");},m:function m(target,anchor){insert(target,svg,anchor);if(default_slot){default_slot.m(svg,null);}current=true;},p:function p(ctx,_ref156){var _ref157=_slicedToArray(_ref156,1),dirty=_ref157[0];if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope*/16)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[4],!current?get_all_dirty_from_scope(/*$$scope*/ctx[4]):get_slot_changes(default_slot_template,/*$$scope*/ctx[4],dirty,null),null);}}if(!current||dirty&/*klass*/8){attr(svg,"class",/*klass*/ctx[3]);}if(!current||dirty&/*style*/4){attr(svg,"style",/*style*/ctx[2]);}if(!current||dirty&/*width*/1){attr(svg,"width",/*width*/ctx[0]);}if(!current||dirty&/*height*/2){attr(svg,"height",/*height*/ctx[1]);}if(!current||dirty&/*width, height*/3&&svg_viewBox_value!==(svg_viewBox_value="0 0 "+/*width*/ctx[0]+"\n    "+/*height*/ctx[1])){attr(svg,"viewBox",svg_viewBox_value);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(svg);if(default_slot)default_slot.d(detaching);}};}function instance$O($$self,$$props,$$invalidate){var _$$props$$$slots3=$$props.$$slots,slots=_$$props$$$slots3===void 0?{}:_$$props$$$slots3,$$scope=$$props.$$scope;var _$$props$width=$$props.width,width=_$$props$width===void 0?24:_$$props$width;var _$$props$height=$$props.height,height=_$$props$height===void 0?24:_$$props$height;var _$$props$style2=$$props.style,style=_$$props$style2===void 0?undefined:_$$props$style2;var _$$props$class3=$$props["class"],klass=_$$props$class3===void 0?undefined:_$$props$class3;$$self.$$set=function($$props){if('width'in $$props)$$invalidate(0,width=$$props.width);if('height'in $$props)$$invalidate(1,height=$$props.height);if('style'in $$props)$$invalidate(2,style=$$props.style);if('class'in $$props)$$invalidate(3,klass=$$props["class"]);if('$$scope'in $$props)$$invalidate(4,$$scope=$$props.$$scope);};return[width,height,style,klass,$$scope,slots];}var Icon=/*#__PURE__*/function(_SvelteComponent4){_inherits(Icon,_SvelteComponent4);var _super5=_createSuper(Icon);function Icon(options){var _this6;_classCallCheck(this,Icon);_this6=_super5.call(this);init(_assertThisInitialized(_this6),options,instance$O,create_fragment$N,safe_not_equal,{width:0,height:1,style:2,"class":3});return _this6;}return _createClass(Icon);}(SvelteComponent);var nudgeable=function nudgeable(element){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};// if added as action on non focusable element you should add tabindex=0 attribute
var _options$direction=options.direction,direction=_options$direction===void 0?undefined:_options$direction,_options$shiftMultipl=options.shiftMultiplier,shiftMultiplier=_options$shiftMultipl===void 0?10:_options$shiftMultipl,_options$bubbles=options.bubbles,bubbles=_options$bubbles===void 0?false:_options$bubbles,_options$preventDefau=options.preventDefault,preventDefault=_options$preventDefau===void 0?false:_options$preventDefau,_options$stopKeydownP=options.stopKeydownPropagation,stopKeydownPropagation=_options$stopKeydownP===void 0?true:_options$stopKeydownP;var isHorizontalDirection=direction==='horizontal';var isVerticalDirection=direction==='vertical';var handleKeydown=function handleKeydown(e){var key=e.key;var isShift=e.shiftKey;var isVerticalAction=/up|down/i.test(key);var isHorizontalAction=/left|right/i.test(key);// no directional key
if(!isHorizontalAction&&!isVerticalAction)return;// is horizontal but up or down pressed
if(isHorizontalDirection&&isVerticalAction)return;// is vertical but left or right pressed
if(isVerticalDirection&&isHorizontalAction)return;// if holding shift move by a factor 10
var multiplier=isShift?shiftMultiplier:1;if(stopKeydownPropagation)e.stopPropagation();if(preventDefault)e.preventDefault();element.dispatchEvent(new CustomEvent('nudge',{bubbles:bubbles,detail:vectorCreate((/left/i.test(key)?-1:/right/i.test(key)?1:0)*multiplier,(/up/i.test(key)?-1:/down/i.test(key)?1:0)*multiplier)}));};element.addEventListener('keydown',handleKeydown);return{destroy:function destroy(){element.removeEventListener('keydown',handleKeydown);}};};var numberRoundTo=function numberRoundTo(value,fraction){fraction=1/fraction;return Math.round(value*fraction)/fraction;};var toFraction=function toFraction(value,min,max){return(value-min)/(max-min);};/* src/core/ui/components/Slider.svelte generated by Svelte v3.52.0 */var get_knob_slot_changes=function get_knob_slot_changes(dirty){return{};};var get_knob_slot_context=function get_knob_slot_context(ctx){return{};};// (237:4) {#if enableSpinButtons}
function create_if_block$f(ctx){var button0;var icon0;var t;var button1;var icon1;var current;var mounted;var dispose;icon0=new Icon({props:{$$slots:{"default":[create_default_slot_1$7]},$$scope:{ctx:ctx}}});icon1=new Icon({props:{$$slots:{"default":[create_default_slot$i]},$$scope:{ctx:ctx}}});return{c:function c(){button0=element("button");create_component(icon0.$$.fragment);t=space();button1=element("button");create_component(icon1.$$.fragment);attr(button0,"type","button");attr(button0,"aria-label","Increase");attr(button1,"type","button");attr(button1,"aria-label","Decrease");},m:function m(target,anchor){insert(target,button0,anchor);mount_component(icon0,button0,null);insert(target,t,anchor);insert(target,button1,anchor);mount_component(icon1,button1,null);current=true;if(!mounted){dispose=[listen(button0,"pointerdown",/*handleUpdaterDown*/ctx[20](1)),listen(button1,"pointerdown",/*handleUpdaterDown*/ctx[20](-1))];mounted=true;}},p:function p(ctx,dirty){var icon0_changes={};if(dirty[1]&/*$$scope*/128){icon0_changes.$$scope={dirty:dirty,ctx:ctx};}icon0.$set(icon0_changes);var icon1_changes={};if(dirty[1]&/*$$scope*/128){icon1_changes.$$scope={dirty:dirty,ctx:ctx};}icon1.$set(icon1_changes);},i:function i(local){if(current)return;transition_in(icon0.$$.fragment,local);transition_in(icon1.$$.fragment,local);current=true;},o:function o(local){transition_out(icon0.$$.fragment,local);transition_out(icon1.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(button0);destroy_component(icon0);if(detaching)detach(t);if(detaching)detach(button1);destroy_component(icon1);mounted=false;run_all(dispose);}};}// (239:12) <Icon>
function create_default_slot_1$7(ctx){var path;return{c:function c(){path=svg_element("path");attr(path,"d","M8 12 h8 M12 8 v8");},m:function m(target,anchor){insert(target,path,anchor);},p:noop,d:function d(detaching){if(detaching)detach(path);}};}// (242:12) <Icon>
function create_default_slot$i(ctx){var path;return{c:function c(){path=svg_element("path");attr(path,"d","M9 12 h6");},m:function m(target,anchor){insert(target,path,anchor);},p:noop,d:function d(detaching){if(detaching)detach(path);}};}function create_fragment$M(ctx){var div4;var div3;var input_1;var input_1_style_value;var t0;var div0;var div0_class_value;var t1;var div2;var div1;var div1_class_value;var div3_style_value;var t2;var div4_class_value;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[36]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[38],null);var knob_slot_template=/*#slots*/ctx[36].knob;var knob_slot=create_slot(knob_slot_template,ctx,/*$$scope*/ctx[38],get_knob_slot_context);var if_block=/*enableSpinButtons*/ctx[9]&&create_if_block$f(ctx);return{c:function c(){div4=element("div");div3=element("div");input_1=element("input");t0=space();div0=element("div");if(default_slot)default_slot.c();t1=space();div2=element("div");div1=element("div");if(knob_slot)knob_slot.c();t2=space();if(if_block)if_block.c();attr(input_1,"type","range");attr(input_1,"id",/*id*/ctx[3]);attr(input_1,"min",/*min*/ctx[0]);attr(input_1,"max",/*max*/ctx[1]);attr(input_1,"step",/*step*/ctx[2]);input_1.value=/*numberValue*/ctx[14];attr(input_1,"style",input_1_style_value=/*enableForceUseKnob*/ctx[10]?'pointer-events:none':'');attr(div0,"class",div0_class_value=arrayJoin(['PinturaSliderTrack',/*trackClass*/ctx[5]]));attr(div0,"style",/*trackStyle*/ctx[4]);attr(div1,"class",div1_class_value=arrayJoin(['PinturaSliderKnob',/*knobClass*/ctx[7]]));attr(div1,"style",/*knobStyle*/ctx[6]);attr(div2,"class","PinturaSliderKnobController");attr(div2,"style",/*knobControllerStyle*/ctx[17]);attr(div3,"class","PinturaSliderControl");attr(div3,"style",div3_style_value="--slider-position:".concat(Math.round(/*position*/ctx[15])));attr(div4,"class",div4_class_value=arrayJoin(['PinturaSlider',/*klass*/ctx[12]]));attr(div4,"data-direction",/*direction*/ctx[8]);},m:function m(target,anchor){insert(target,div4,anchor);append(div4,div3);append(div3,input_1);/*input_1_binding*/ctx[37](input_1);append(div3,t0);append(div3,div0);if(default_slot){default_slot.m(div0,null);}append(div3,t1);append(div3,div2);append(div2,div1);if(knob_slot){knob_slot.m(div1,null);}append(div4,t2);if(if_block)if_block.m(div4,null);current=true;if(!mounted){dispose=[listen(input_1,"input",/*handleInput*/ctx[18]),listen(input_1,"nudge",/*handleNudge*/ctx[19]),action_destroyer(nudgeable.call(null,input_1)),listen(div3,"pointerdown",function(){if(is_function(/*enablePointerdownListener*/ctx[11]&&/*handlePointerDown*/ctx[13]))(/*enablePointerdownListener*/ctx[11]&&/*handlePointerDown*/ctx[13]).apply(this,arguments);})];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(!current||dirty[0]&/*id*/8){attr(input_1,"id",/*id*/ctx[3]);}if(!current||dirty[0]&/*min*/1){attr(input_1,"min",/*min*/ctx[0]);}if(!current||dirty[0]&/*max*/2){attr(input_1,"max",/*max*/ctx[1]);}if(!current||dirty[0]&/*step*/4){attr(input_1,"step",/*step*/ctx[2]);}if(!current||dirty[0]&/*numberValue*/16384){input_1.value=/*numberValue*/ctx[14];}if(!current||dirty[0]&/*enableForceUseKnob*/1024&&input_1_style_value!==(input_1_style_value=/*enableForceUseKnob*/ctx[10]?'pointer-events:none':'')){attr(input_1,"style",input_1_style_value);}if(default_slot){if(default_slot.p&&(!current||dirty[1]&/*$$scope*/128)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[38],!current?get_all_dirty_from_scope(/*$$scope*/ctx[38]):get_slot_changes(default_slot_template,/*$$scope*/ctx[38],dirty,null),null);}}if(!current||dirty[0]&/*trackClass*/32&&div0_class_value!==(div0_class_value=arrayJoin(['PinturaSliderTrack',/*trackClass*/ctx[5]]))){attr(div0,"class",div0_class_value);}if(!current||dirty[0]&/*trackStyle*/16){attr(div0,"style",/*trackStyle*/ctx[4]);}if(knob_slot){if(knob_slot.p&&(!current||dirty[1]&/*$$scope*/128)){update_slot_base(knob_slot,knob_slot_template,ctx,/*$$scope*/ctx[38],!current?get_all_dirty_from_scope(/*$$scope*/ctx[38]):get_slot_changes(knob_slot_template,/*$$scope*/ctx[38],dirty,get_knob_slot_changes),get_knob_slot_context);}}if(!current||dirty[0]&/*knobClass*/128&&div1_class_value!==(div1_class_value=arrayJoin(['PinturaSliderKnob',/*knobClass*/ctx[7]]))){attr(div1,"class",div1_class_value);}if(!current||dirty[0]&/*knobStyle*/64){attr(div1,"style",/*knobStyle*/ctx[6]);}if(!current||dirty[0]&/*knobControllerStyle*/131072){attr(div2,"style",/*knobControllerStyle*/ctx[17]);}if(!current||dirty[0]&/*position*/32768&&div3_style_value!==(div3_style_value="--slider-position:".concat(Math.round(/*position*/ctx[15])))){attr(div3,"style",div3_style_value);}if(/*enableSpinButtons*/ctx[9]){if(if_block){if_block.p(ctx,dirty);if(dirty[0]&/*enableSpinButtons*/512){transition_in(if_block,1);}}else{if_block=create_if_block$f(ctx);if_block.c();transition_in(if_block,1);if_block.m(div4,null);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if(!current||dirty[0]&/*klass*/4096&&div4_class_value!==(div4_class_value=arrayJoin(['PinturaSlider',/*klass*/ctx[12]]))){attr(div4,"class",div4_class_value);}if(!current||dirty[0]&/*direction*/256){attr(div4,"data-direction",/*direction*/ctx[8]);}},i:function i(local){if(current)return;transition_in(default_slot,local);transition_in(knob_slot,local);transition_in(if_block);current=true;},o:function o(local){transition_out(default_slot,local);transition_out(knob_slot,local);transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div4);/*input_1_binding*/ctx[37](null);if(default_slot)default_slot.d(detaching);if(knob_slot)knob_slot.d(detaching);if(if_block)if_block.d();mounted=false;run_all(dispose);}};}function instance$N($$self,$$props,$$invalidate){var numberValue;var range;var fraction;var position;var axis;var dimension;var offsetSizeProp;var pageAxisProp;var knobControllerStyle;var _$$props$$$slots4=$$props.$$slots,slots=_$$props$$$slots4===void 0?{}:_$$props$$$slots4,$$scope=$$props.$$scope;var _$$props$min=$$props.min,min=_$$props$min===void 0?0:_$$props$min;var _$$props$max=$$props.max,max=_$$props$max===void 0?100:_$$props$max;var _$$props$step=$$props.step,step=_$$props$step===void 0?1:_$$props$step;var _$$props$id=$$props.id,id=_$$props$id===void 0?undefined:_$$props$id;var _$$props$value=$$props.value,value=_$$props$value===void 0?0:_$$props$value;var _$$props$valueMin=$$props.valueMin,valueMin=_$$props$valueMin===void 0?undefined:_$$props$valueMin;var _$$props$valueMax=$$props.valueMax,valueMax=_$$props$valueMax===void 0?undefined:_$$props$valueMax;var _$$props$trackStyle=$$props.trackStyle,trackStyle=_$$props$trackStyle===void 0?undefined:_$$props$trackStyle;var _$$props$trackClass=$$props.trackClass,trackClass=_$$props$trackClass===void 0?undefined:_$$props$trackClass;var _$$props$knobStyle=$$props.knobStyle,knobStyle=_$$props$knobStyle===void 0?undefined:_$$props$knobStyle;var _$$props$knobClass=$$props.knobClass,knobClass=_$$props$knobClass===void 0?undefined:_$$props$knobClass;var _$$props$ongrab=$$props.ongrab,ongrab=_$$props$ongrab===void 0?noop$1:_$$props$ongrab;var _$$props$onchange=$$props.onchange,onchange=_$$props$onchange===void 0?noop$1:_$$props$onchange;var _$$props$onrelease=$$props.onrelease,onrelease=_$$props$onrelease===void 0?noop$1:_$$props$onrelease;var _$$props$onexceed=$$props.onexceed,onexceed=_$$props$onexceed===void 0?noop$1:_$$props$onexceed;var _$$props$direction=$$props.direction,direction=_$$props$direction===void 0?'x':_$$props$direction;var _$$props$getValue=$$props.getValue,getValue=_$$props$getValue===void 0?passthrough:_$$props$getValue;var _$$props$setValue=$$props.setValue,setValue=_$$props$setValue===void 0?passthrough:_$$props$setValue;var _$$props$enableSpinBu=$$props.enableSpinButtons,enableSpinButtons=_$$props$enableSpinBu===void 0?true:_$$props$enableSpinBu;var _$$props$enableForceU=$$props.enableForceUseKnob,enableForceUseKnob=_$$props$enableForceU===void 0?false:_$$props$enableForceU;var _$$props$enableStopPr=$$props.enableStopPropagation,enableStopPropagation=_$$props$enableStopPr===void 0?true:_$$props$enableStopPr;var _$$props$enablePointe=$$props.enablePointerdownListener,enablePointerdownListener=_$$props$enablePointe===void 0?true:_$$props$enablePointe;var _$$props$maxInteracti=$$props.maxInteractionDistance,maxInteractionDistance=_$$props$maxInteracti===void 0?6:_$$props$maxInteracti;var _$$props$class4=$$props["class"],klass=_$$props$class4===void 0?undefined:_$$props$class4;var input;var inputSize;var inputOffset;var pageOffset;var valuePrev;var valuePrevIntended;var formatValue=function formatValue(value){return setValue(numberRoundTo(clamp(value,min,max),step));};var setValueByOffset=function setValueByOffset(offset,size){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var _options$grabbed=options.grabbed,grabbed=_options$grabbed===void 0?false:_options$grabbed,_options$released=options.released,released=_options$released===void 0?false:_options$released;var intendedValue=formatValue(min+offset/size*range);var minValue=valueMin||min;var maxValue=valueMax||max;$$invalidate(21,value=isString(intendedValue)?intendedValue:clamp(intendedValue,minValue,maxValue));// skip
if(valuePrevIntended===intendedValue)return;valuePrevIntended=intendedValue;if(!isString(intendedValue)&&(intendedValue<minValue||intendedValue>maxValue)){onexceed(value,intendedValue);}if(value===valuePrev){return;}valuePrev=value;if(grabbed)ongrab(value);onchange(value);if(released)onrelease(value);};var handleInput=function handleInput(e){// already handled by pointer events
if(inputSize)return;$$invalidate(21,value=setValue(parseFloat(e.target.value)));if(value===valuePrev)return;valuePrev=value;onchange(value);};var nudgeTimer;var handleNudge=function handleNudge(e){var size=input[offsetSizeProp];var offset=numberValue/range*size;setValueByOffset(offset+e.detail[direction],size);clearTimeout(nudgeTimer);nudgeTimer=setTimeout(function(){onrelease(value);},250);};var eventDistanceToKnob=function eventDistanceToKnob(e){var clientRect=input.getBoundingClientRect();var pageOffset=e[pageAxisProp];var inputOffset=pageOffset-clientRect[direction];var inputSize=input[offsetSizeProp];return Math.abs(inputOffset-fraction*inputSize);};var handlePointerDown=function handlePointerDown(e){var stopPropagation=false;enableStopPropagation&&e.stopPropagation();clearTimeout(nudgeTimer);var clientRect=input.getBoundingClientRect();inputSize=input[offsetSizeProp];pageOffset=e[pageAxisProp];inputOffset=pageOffset-clientRect[direction];if(enableForceUseKnob){var dist=Math.abs(inputOffset-fraction*inputSize);if(dist>maxInteractionDistance)return;stopPropagation=true;e.stopPropagation();}if(document.activeElement!==input)input.focus();setValueByOffset(inputOffset,inputSize,{grabbed:true});document.documentElement.addEventListener('pointermove',handlePointerMove);document.documentElement.addEventListener('pointerup',handlePointerUp);return stopPropagation;};var handlePointerMove=function handlePointerMove(e){var d=e[pageAxisProp]-pageOffset;setValueByOffset(inputOffset+d,inputSize);};var handlePointerUp=function handlePointerUp(e){inputSize=undefined;document.documentElement.removeEventListener('pointermove',handlePointerMove);document.documentElement.removeEventListener('pointerup',handlePointerUp);onchange(value);onrelease(value);};var update=function update(){$$invalidate(21,value=formatValue(numberValue+updateDir*step));onchange(value);};var updateTimer;var updateDir=1;var didUpdate=false;var handleUpdaterDown=function handleUpdaterDown(dir){return function(e){clearTimeout(nudgeTimer);updateDir=dir;didUpdate=false;updateTimer=setInterval(function(){didUpdate=true;update();},100);document.addEventListener('pointercancel',handleUpdaterUp);document.addEventListener('pointerup',handleUpdaterUp);};};var handleUpdaterUp=function handleUpdaterUp(e){clearTimeout(updateTimer);if(!didUpdate)update();onrelease(value);document.removeEventListener('pointerup',handleUpdaterUp);};function input_1_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){input=$$value;$$invalidate(16,input);});}$$self.$$set=function($$props){if('min'in $$props)$$invalidate(0,min=$$props.min);if('max'in $$props)$$invalidate(1,max=$$props.max);if('step'in $$props)$$invalidate(2,step=$$props.step);if('id'in $$props)$$invalidate(3,id=$$props.id);if('value'in $$props)$$invalidate(21,value=$$props.value);if('valueMin'in $$props)$$invalidate(22,valueMin=$$props.valueMin);if('valueMax'in $$props)$$invalidate(23,valueMax=$$props.valueMax);if('trackStyle'in $$props)$$invalidate(4,trackStyle=$$props.trackStyle);if('trackClass'in $$props)$$invalidate(5,trackClass=$$props.trackClass);if('knobStyle'in $$props)$$invalidate(6,knobStyle=$$props.knobStyle);if('knobClass'in $$props)$$invalidate(7,knobClass=$$props.knobClass);if('ongrab'in $$props)$$invalidate(24,ongrab=$$props.ongrab);if('onchange'in $$props)$$invalidate(25,onchange=$$props.onchange);if('onrelease'in $$props)$$invalidate(26,onrelease=$$props.onrelease);if('onexceed'in $$props)$$invalidate(27,onexceed=$$props.onexceed);if('direction'in $$props)$$invalidate(8,direction=$$props.direction);if('getValue'in $$props)$$invalidate(28,getValue=$$props.getValue);if('setValue'in $$props)$$invalidate(29,setValue=$$props.setValue);if('enableSpinButtons'in $$props)$$invalidate(9,enableSpinButtons=$$props.enableSpinButtons);if('enableForceUseKnob'in $$props)$$invalidate(10,enableForceUseKnob=$$props.enableForceUseKnob);if('enableStopPropagation'in $$props)$$invalidate(30,enableStopPropagation=$$props.enableStopPropagation);if('enablePointerdownListener'in $$props)$$invalidate(11,enablePointerdownListener=$$props.enablePointerdownListener);if('maxInteractionDistance'in $$props)$$invalidate(31,maxInteractionDistance=$$props.maxInteractionDistance);if('class'in $$props)$$invalidate(12,klass=$$props["class"]);if('$$scope'in $$props)$$invalidate(38,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*value, getValue*/270532608){$$invalidate(14,numberValue=value!==undefined?getValue(value):0);}if($$self.$$.dirty[0]&/*max, min*/3){range=max-min;}if($$self.$$.dirty[0]&/*numberValue, min, max*/16387){$$invalidate(33,fraction=toFraction(numberValue,min,max));}if($$self.$$.dirty[1]&/*fraction*/4){$$invalidate(15,position=fraction*100);}if($$self.$$.dirty[0]&/*direction*/256){$$invalidate(34,axis=direction.toUpperCase());}if($$self.$$.dirty[0]&/*direction*/256){$$invalidate(35,dimension=direction==='x'?'Width':'Height');}if($$self.$$.dirty[1]&/*dimension*/16){offsetSizeProp="offset".concat(dimension);}if($$self.$$.dirty[1]&/*axis*/8);if($$self.$$.dirty[1]&/*axis*/8){pageAxisProp="page".concat(axis);}if($$self.$$.dirty[0]&/*position*/32768|$$self.$$.dirty[1]&/*axis*/8){$$invalidate(17,knobControllerStyle="transform: translate".concat(axis,"(").concat(position,"%)"));}};return[min,max,step,id,trackStyle,trackClass,knobStyle,knobClass,direction,enableSpinButtons,enableForceUseKnob,enablePointerdownListener,klass,handlePointerDown,numberValue,position,input,knobControllerStyle,handleInput,handleNudge,handleUpdaterDown,value,valueMin,valueMax,ongrab,onchange,onrelease,onexceed,getValue,setValue,enableStopPropagation,maxInteractionDistance,eventDistanceToKnob,fraction,axis,dimension,slots,input_1_binding,$$scope];}var Slider=/*#__PURE__*/function(_SvelteComponent5){_inherits(Slider,_SvelteComponent5);var _super6=_createSuper(Slider);function Slider(options){var _this7;_classCallCheck(this,Slider);_this7=_super6.call(this);init(_assertThisInitialized(_this7),options,instance$N,create_fragment$M,safe_not_equal,{min:0,max:1,step:2,id:3,value:21,valueMin:22,valueMax:23,trackStyle:4,trackClass:5,knobStyle:6,knobClass:7,ongrab:24,onchange:25,onrelease:26,onexceed:27,direction:8,getValue:28,setValue:29,enableSpinButtons:9,enableForceUseKnob:10,enableStopPropagation:30,enablePointerdownListener:11,maxInteractionDistance:31,"class":12,eventDistanceToKnob:32,handlePointerDown:13},null,[-1,-1]);return _this7;}_createClass(Slider,[{key:"eventDistanceToKnob",get:function get(){return this.$$.ctx[32];}},{key:"handlePointerDown",get:function get(){return this.$$.ctx[13];}}]);return Slider;}(SvelteComponent);var isEventTarget=function isEventTarget(e,element){return element===e.target||element.contains(e.target);};/* src/core/ui/components/Button.svelte generated by Svelte v3.52.0 */function create_if_block_1$d(ctx){var icon_1;var current;icon_1=new Icon({props:{"class":"PinturaButtonIcon",$$slots:{"default":[create_default_slot$h]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon_1.$$.fragment);},m:function m(target,anchor){mount_component(icon_1,target,anchor);current=true;},p:function p(ctx,dirty){var icon_1_changes={};if(dirty&/*$$scope, icon*/134217730){icon_1_changes.$$scope={dirty:dirty,ctx:ctx};}icon_1.$set(icon_1_changes);},i:function i(local){if(current)return;transition_in(icon_1.$$.fragment,local);current=true;},o:function o(local){transition_out(icon_1.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon_1,detaching);}};}// (79:16) <Icon class="PinturaButtonIcon">
function create_default_slot$h(ctx){var g;return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=/*icon*/ctx[1];},p:function p(ctx,dirty){if(dirty&/*icon*/2)g.innerHTML=/*icon*/ctx[1];},d:function d(detaching){if(detaching)detach(g);}};}// (85:12) {#if label}
function create_if_block$e(ctx){var span;var t;return{c:function c(){span=element("span");t=text(/*label*/ctx[0]);attr(span,"class",/*elLabelClass*/ctx[9]);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty&/*label*/1)set_data(t,/*label*/ctx[0]);if(dirty&/*elLabelClass*/512){attr(span,"class",/*elLabelClass*/ctx[9]);}},d:function d(detaching){if(detaching)detach(span);}};}// (76:10)          
function fallback_block$2(ctx){var span;var t;var current;var if_block0=/*icon*/ctx[1]&&create_if_block_1$d(ctx);var if_block1=/*label*/ctx[0]&&create_if_block$e(ctx);return{c:function c(){span=element("span");if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();attr(span,"class",/*elButtonInnerClass*/ctx[11]);},m:function m(target,anchor){insert(target,span,anchor);if(if_block0)if_block0.m(span,null);append(span,t);if(if_block1)if_block1.m(span,null);current=true;},p:function p(ctx,dirty){if(/*icon*/ctx[1]){if(if_block0){if_block0.p(ctx,dirty);if(dirty&/*icon*/2){transition_in(if_block0,1);}}else{if_block0=create_if_block_1$d(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(span,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*label*/ctx[0]){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block$e(ctx);if_block1.c();if_block1.m(span,null);}}else if(if_block1){if_block1.d(1);if_block1=null;}if(!current||dirty&/*elButtonInnerClass*/2048){attr(span,"class",/*elButtonInnerClass*/ctx[11]);}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(detaching)detach(span);if(if_block0)if_block0.d();if(if_block1)if_block1.d();}};}function create_fragment$L(ctx){var button;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[25]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[27],null);var default_slot_or_fallback=default_slot||fallback_block$2(ctx);return{c:function c(){button=element("button");if(default_slot_or_fallback)default_slot_or_fallback.c();attr(button,"type",/*type*/ctx[4]);attr(button,"style",/*style*/ctx[2]);button.disabled=/*disabled*/ctx[3];attr(button,"class",/*elButtonClass*/ctx[10]);attr(button,"title",/*label*/ctx[0]);},m:function m(target,anchor){insert(target,button,anchor);if(default_slot_or_fallback){default_slot_or_fallback.m(button,null);}/*button_binding*/ctx[26](button);current=true;if(!mounted){dispose=[listen(button,"keydown",function(){if(is_function(/*onkeydown*/ctx[6]))/*onkeydown*/ctx[6].apply(this,arguments);}),listen(button,"click",function(){if(is_function(/*onclick*/ctx[5]))/*onclick*/ctx[5].apply(this,arguments);}),listen(button,"pointerdown",function(){if(is_function(/*handleDown*/ctx[12]))/*handleDown*/ctx[12].apply(this,arguments);}),action_destroyer(/*action*/ctx[7].call(null,button))];mounted=true;}},p:function p(new_ctx,_ref158){var _ref159=_slicedToArray(_ref158,1),dirty=_ref159[0];ctx=new_ctx;if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope*/134217728)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[27],!current?get_all_dirty_from_scope(/*$$scope*/ctx[27]):get_slot_changes(default_slot_template,/*$$scope*/ctx[27],dirty,null),null);}}else{if(default_slot_or_fallback&&default_slot_or_fallback.p&&(!current||dirty&/*elButtonInnerClass, elLabelClass, label, icon*/2563)){default_slot_or_fallback.p(ctx,!current?-1:dirty);}}if(!current||dirty&/*type*/16){attr(button,"type",/*type*/ctx[4]);}if(!current||dirty&/*style*/4){attr(button,"style",/*style*/ctx[2]);}if(!current||dirty&/*disabled*/8){button.disabled=/*disabled*/ctx[3];}if(!current||dirty&/*elButtonClass*/1024){attr(button,"class",/*elButtonClass*/ctx[10]);}if(!current||dirty&/*label*/1){attr(button,"title",/*label*/ctx[0]);}},i:function i(local){if(current)return;transition_in(default_slot_or_fallback,local);current=true;},o:function o(local){transition_out(default_slot_or_fallback,local);current=false;},d:function d(detaching){if(detaching)detach(button);if(default_slot_or_fallback)default_slot_or_fallback.d(detaching);/*button_binding*/ctx[26](null);mounted=false;run_all(dispose);}};}function instance$M($$self,$$props,$$invalidate){var handleDown;var handleUp;var elButtonInnerClass;var elButtonClass;var elLabelClass;var _$$props$$$slots5=$$props.$$slots,slots=_$$props$$$slots5===void 0?{}:_$$props$$$slots5,$$scope=$$props.$$scope;var _$$props$class5=$$props["class"],klass=_$$props$class5===void 0?undefined:_$$props$class5;var _$$props$label=$$props.label,label=_$$props$label===void 0?undefined:_$$props$label;var _$$props$labelClass=$$props.labelClass,labelClass=_$$props$labelClass===void 0?undefined:_$$props$labelClass;var _$$props$innerClass=$$props.innerClass,innerClass=_$$props$innerClass===void 0?undefined:_$$props$innerClass;var _$$props$hideLabel=$$props.hideLabel,hideLabel=_$$props$hideLabel===void 0?false:_$$props$hideLabel;var _$$props$icon=$$props.icon,icon=_$$props$icon===void 0?undefined:_$$props$icon;var _$$props$style3=$$props.style,style=_$$props$style3===void 0?undefined:_$$props$style3;var _$$props$disabled=$$props.disabled,disabled=_$$props$disabled===void 0?undefined:_$$props$disabled;var _$$props$type=$$props.type,type=_$$props$type===void 0?'button':_$$props$type;var _$$props$onclick=$$props.onclick,onclick=_$$props$onclick===void 0?undefined:_$$props$onclick;var _$$props$onkeydown=$$props.onkeydown,onkeydown=_$$props$onkeydown===void 0?undefined:_$$props$onkeydown;var _$$props$onhold=$$props.onhold,onhold=_$$props$onhold===void 0?undefined:_$$props$onhold;var _$$props$action=$$props.action,action=_$$props$action===void 0?function(){}:_$$props$action;var _$$props$holdThreshol=$$props.holdThreshold,holdThreshold=_$$props$holdThreshol===void 0?500:_$$props$holdThreshol;var _$$props$holdSpeedUpF=$$props.holdSpeedUpFactor,holdSpeedUpFactor=_$$props$holdSpeedUpF===void 0?0.5:_$$props$holdSpeedUpF;var _$$props$holdSpeedMin=$$props.holdSpeedMin,holdSpeedMin=_$$props$holdSpeedMin===void 0?20:_$$props$holdSpeedMin;var holdTimer;var hold=function hold(holdStep){$$invalidate(23,holdTimer=setTimeout(function(){onhold();hold(Math.max(holdStep*holdSpeedUpFactor,holdSpeedMin));},holdStep));};var root;var isEventTarget$1=function isEventTarget$1(e){return isEventTarget(e,root);};var getElement=function getElement(){return root;};function button_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){root=$$value;$$invalidate(8,root);});}$$self.$$set=function($$props){if('class'in $$props)$$invalidate(13,klass=$$props["class"]);if('label'in $$props)$$invalidate(0,label=$$props.label);if('labelClass'in $$props)$$invalidate(14,labelClass=$$props.labelClass);if('innerClass'in $$props)$$invalidate(15,innerClass=$$props.innerClass);if('hideLabel'in $$props)$$invalidate(16,hideLabel=$$props.hideLabel);if('icon'in $$props)$$invalidate(1,icon=$$props.icon);if('style'in $$props)$$invalidate(2,style=$$props.style);if('disabled'in $$props)$$invalidate(3,disabled=$$props.disabled);if('type'in $$props)$$invalidate(4,type=$$props.type);if('onclick'in $$props)$$invalidate(5,onclick=$$props.onclick);if('onkeydown'in $$props)$$invalidate(6,onkeydown=$$props.onkeydown);if('onhold'in $$props)$$invalidate(17,onhold=$$props.onhold);if('action'in $$props)$$invalidate(7,action=$$props.action);if('holdThreshold'in $$props)$$invalidate(18,holdThreshold=$$props.holdThreshold);if('holdSpeedUpFactor'in $$props)$$invalidate(19,holdSpeedUpFactor=$$props.holdSpeedUpFactor);if('holdSpeedMin'in $$props)$$invalidate(20,holdSpeedMin=$$props.holdSpeedMin);if('$$scope'in $$props)$$invalidate(27,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty&/*onhold, holdTimer, handleUp*/25296896){$$invalidate(24,handleUp=onhold?function(){if(!holdTimer)return;// clean up
clearTimeout(holdTimer);$$invalidate(23,holdTimer=undefined);// no longer holder
document.documentElement.removeEventListener('pointerup',handleUp);}:noop);}if($$self.$$.dirty&/*onhold, handleUp, holdThreshold*/17170432){$$invalidate(12,handleDown=onhold?function(){document.documentElement.addEventListener('pointerup',handleUp);hold(holdThreshold);}:noop);}if($$self.$$.dirty&/*innerClass*/32768){$$invalidate(11,elButtonInnerClass=arrayJoin(['PinturaButtonInner',innerClass]));}if($$self.$$.dirty&/*hideLabel, klass*/73728){$$invalidate(10,elButtonClass=arrayJoin(['PinturaButton',hideLabel&&'PinturaButtonIconOnly',klass]));}if($$self.$$.dirty&/*hideLabel, labelClass*/81920){$$invalidate(9,elLabelClass=arrayJoin([hideLabel?'implicit':'PinturaButtonLabel',labelClass]));}};return[label,icon,style,disabled,type,onclick,onkeydown,action,root,elLabelClass,elButtonClass,elButtonInnerClass,handleDown,klass,labelClass,innerClass,hideLabel,onhold,holdThreshold,holdSpeedUpFactor,holdSpeedMin,isEventTarget$1,getElement,holdTimer,handleUp,slots,button_binding,$$scope];}var Button=/*#__PURE__*/function(_SvelteComponent6){_inherits(Button,_SvelteComponent6);var _super7=_createSuper(Button);function Button(options){var _this8;_classCallCheck(this,Button);_this8=_super7.call(this);init(_assertThisInitialized(_this8),options,instance$M,create_fragment$L,safe_not_equal,{"class":13,label:0,labelClass:14,innerClass:15,hideLabel:16,icon:1,style:2,disabled:3,type:4,onclick:5,onkeydown:6,onhold:17,action:7,holdThreshold:18,holdSpeedUpFactor:19,holdSpeedMin:20,isEventTarget:21,getElement:22});return _this8;}_createClass(Button,[{key:"isEventTarget",get:function get(){return this.$$.ctx[21];}},{key:"getElement",get:function get(){return this.$$.ctx[22];}}]);return Button;}(SvelteComponent);/* src/core/ui/components/UtilPanel.svelte generated by Svelte v3.52.0 */function create_if_block$d(ctx){var switch_instance;var updating_name;var switch_instance_anchor;var current;var switch_instance_spread_levels=[/*componentProps*/ctx[4]];function switch_instance_name_binding(value){/*switch_instance_name_binding*/ctx[22](value);}var switch_value=/*ComponentView*/ctx[10];function switch_props(ctx){var switch_instance_props={};for(var i=0;i<switch_instance_spread_levels.length;i+=1){switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);}if(/*panelName*/ctx[2]!==void 0){switch_instance_props.name=/*panelName*/ctx[2];}return{props:switch_instance_props};}if(switch_value){switch_instance=construct_svelte_component(switch_value,switch_props(ctx));binding_callbacks.push(function(){return bind(switch_instance,'name',switch_instance_name_binding);});/*switch_instance_binding*/ctx[23](switch_instance);switch_instance.$on("measure",/*handleMeasure*/ctx[11]);}return{c:function c(){if(switch_instance)create_component(switch_instance.$$.fragment);switch_instance_anchor=empty();},m:function m(target,anchor){if(switch_instance)mount_component(switch_instance,target,anchor);insert(target,switch_instance_anchor,anchor);current=true;},p:function p(ctx,dirty){var switch_instance_changes=dirty&/*componentProps*/16?get_spread_update(switch_instance_spread_levels,[get_spread_object(/*componentProps*/ctx[4])]):{};if(!updating_name&&dirty&/*panelName*/4){updating_name=true;switch_instance_changes.name=/*panelName*/ctx[2];add_flush_callback(function(){return updating_name=false;});}if(switch_value!==(switch_value=/*ComponentView*/ctx[10])){if(switch_instance){group_outros();var old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,function(){destroy_component(old_component,1);});check_outros();}if(switch_value){switch_instance=construct_svelte_component(switch_value,switch_props(ctx));binding_callbacks.push(function(){return bind(switch_instance,'name',switch_instance_name_binding);});/*switch_instance_binding*/ctx[23](switch_instance);switch_instance.$on("measure",/*handleMeasure*/ctx[11]);create_component(switch_instance.$$.fragment);transition_in(switch_instance.$$.fragment,1);mount_component(switch_instance,switch_instance_anchor.parentNode,switch_instance_anchor);}else{switch_instance=null;}}else if(switch_value){switch_instance.$set(switch_instance_changes);}},i:function i(local){if(current)return;if(switch_instance)transition_in(switch_instance.$$.fragment,local);current=true;},o:function o(local){if(switch_instance)transition_out(switch_instance.$$.fragment,local);current=false;},d:function d(detaching){/*switch_instance_binding*/ctx[23](null);if(detaching)detach(switch_instance_anchor);if(switch_instance)destroy_component(switch_instance,detaching);}};}function create_fragment$K(ctx){var div;var div_class_value;var current;var if_block=/*isLocal*/ctx[5]&&create_if_block$d(ctx);return{c:function c(){div=element("div");if(if_block)if_block.c();attr(div,"data-util",/*panelName*/ctx[2]);attr(div,"class",div_class_value=arrayJoin(['PinturaUtilPanel',/*klass*/ctx[1]]));attr(div,"style",/*style*/ctx[6]);},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);/*div_binding*/ctx[24](div);current=true;},p:function p(ctx,_ref160){var _ref161=_slicedToArray(_ref160,1),dirty=_ref161[0];if(/*isLocal*/ctx[5]){if(if_block){if_block.p(ctx,dirty);if(dirty&/*isLocal*/32){transition_in(if_block,1);}}else{if_block=create_if_block$d(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,null);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if(!current||dirty&/*panelName*/4){attr(div,"data-util",/*panelName*/ctx[2]);}if(!current||dirty&/*klass*/2&&div_class_value!==(div_class_value=arrayJoin(['PinturaUtilPanel',/*klass*/ctx[1]]))){attr(div,"class",div_class_value);}if(!current||dirty&/*style*/64){attr(div,"style",/*style*/ctx[6]);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();/*div_binding*/ctx[24](null);}};}function instance$L($$self,$$props,$$invalidate){var style;var componentProps;var isLocal;var $isActivePrivateStore;var $opacityClamped;var $isAnimated;var dispatch=createEventDispatcher();var _$$props$isActive=$$props.isActive,isActive=_$$props$isActive===void 0?true:_$$props$isActive;var stores=$$props.stores;var content=$$props.content;var component=$$props.component;var locale=$$props.locale;var _$$props$class6=$$props["class"],klass=_$$props$class6===void 0?undefined:_$$props$class6;// context
var isAnimated=getContext('isAnimated');component_subscribe($$self,isAnimated,function(value){return $$invalidate(21,$isAnimated=value);});// we remember the view rect in this variable
var rect;var opacity=spring(0);var opacityClamped=derived(opacity,function($opacity){return clamp($opacity,0,1);});component_subscribe($$self,opacityClamped,function(value){return $$invalidate(20,$opacityClamped=value);});// throw hide / show events
var isHidden=!isActive;// create active store so can be used in derived stores
var isActivePrivateStore=writable(isActive);component_subscribe($$self,isActivePrivateStore,function(value){return $$invalidate(25,$isActivePrivateStore=value);});var stateProps={// derived store to make isActive private
isActive:derived(isActivePrivateStore,/*#__PURE__*/function(){var _ref162=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee53($isActivePrivateStore,set){return _regeneratorRuntime().wrap(function _callee53$(_context54){while(1)switch(_context54.prev=_context54.next){case 0:if($isActivePrivateStore){_context54.next=2;break;}return _context54.abrupt("return",set($isActivePrivateStore));case 2:_context54.next=4;return tick$1();case 4:set($isActivePrivateStore);case 5:case"end":return _context54.stop();}},_callee53);}));return function(_x89,_x90){return _ref162.apply(this,arguments);};}()),isActiveFraction:derived(opacityClamped,function($opacityClamped){return $opacityClamped;}),isVisible:derived(opacityClamped,function($opacityClamped){return $opacityClamped>0;})};// build the component props
var ComponentView=content.view;var componentExportedProps=getComponentExportedProps(ComponentView);var componentComputedProps=Object.keys(content.props||{}).reduce(function(computedProps,key){if(!componentExportedProps.includes(key))return computedProps;computedProps[key]=content.props[key];return computedProps;},{});var componentComputedStateProps=Object.keys(stateProps).reduce(function(computedStateProps,key){if(!componentExportedProps.includes(key))return computedStateProps;computedStateProps[key]=stateProps[key];return computedStateProps;},{});// class used on panel element
var panelName;// used when loading external plugin
var rootElement;var handleMeasure=function handleMeasure(e){// not fully hidden, so store rect for next render
$$invalidate(17,rect=_objectSpread({},e.detail));if(!hasBeenMounted||!isActive)return;dispatch('measure',_objectSpread({},rect));};// we use the `hasBeenMounted` bool to block rect updates until the entire panel is ready
var hasBeenMounted=false;onMount(function(){$$invalidate(19,hasBeenMounted=true);if(isLocal)return;$$invalidate(0,component=new ComponentView({target:rootElement,props:_objectSpread({},componentProps)}));$$invalidate(2,panelName=component.name);var unsub=component.$on('measure',handleMeasure);return function(){unsub();component.$destroy();};});function switch_instance_name_binding(value){panelName=value;$$invalidate(2,panelName);}function switch_instance_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){component=$$value;$$invalidate(0,component);});}function div_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){rootElement=$$value;$$invalidate(3,rootElement);});}$$self.$$set=function($$props){if('isActive'in $$props)$$invalidate(12,isActive=$$props.isActive);if('stores'in $$props)$$invalidate(13,stores=$$props.stores);if('content'in $$props)$$invalidate(14,content=$$props.content);if('component'in $$props)$$invalidate(0,component=$$props.component);if('locale'in $$props)$$invalidate(15,locale=$$props.locale);if('class'in $$props)$$invalidate(1,klass=$$props["class"]);};$$self.$$.update=function(){if($$self.$$.dirty&/*rect, isActive, component*/135169){// when the view rect changes and the panel is in active state or became active, dispatch measure event
if(rect&&isActive&&component)dispatch('measure',rect);}if($$self.$$.dirty&/*isActive, $isAnimated*/2101248){opacity.set(isActive?1:0,{hard:$isAnimated===false});}if($$self.$$.dirty&/*$opacityClamped, isHidden*/1310720){if($opacityClamped<=0&&!isHidden){$$invalidate(18,isHidden=true);}else if($opacityClamped>0&&isHidden){$$invalidate(18,isHidden=false);}}if($$self.$$.dirty&/*hasBeenMounted, isHidden*/786432){hasBeenMounted&&dispatch(isHidden?'hide':'show');}if($$self.$$.dirty&/*$opacityClamped*/1048576){dispatch('fade',$opacityClamped);}if($$self.$$.dirty&/*$opacityClamped*/1048576){// only set opacity prop if is below 0
$$invalidate(6,style=$opacityClamped<1?"opacity: ".concat($opacityClamped):undefined);}if($$self.$$.dirty&/*isActive*/4096){set_store_value(isActivePrivateStore,$isActivePrivateStore=isActive,$isActivePrivateStore);}if($$self.$$.dirty&/*stores, locale*/40960){$$invalidate(4,componentProps=_objectSpread(_objectSpread(_objectSpread({},componentComputedProps),componentComputedStateProps),{},{stores:stores,locale:locale}));}};$$invalidate(5,isLocal=!componentExportedProps.includes('external'));return[component,klass,panelName,rootElement,componentProps,isLocal,style,isAnimated,opacityClamped,isActivePrivateStore,ComponentView,handleMeasure,isActive,stores,content,locale,opacity,rect,isHidden,hasBeenMounted,$opacityClamped,$isAnimated,switch_instance_name_binding,switch_instance_binding,div_binding];}var UtilPanel=/*#__PURE__*/function(_SvelteComponent7){_inherits(UtilPanel,_SvelteComponent7);var _super8=_createSuper(UtilPanel);function UtilPanel(options){var _this9;_classCallCheck(this,UtilPanel);_this9=_super8.call(this);init(_assertThisInitialized(_this9),options,instance$L,create_fragment$K,safe_not_equal,{isActive:12,stores:13,content:14,component:0,locale:15,"class":1,opacity:16});return _this9;}_createClass(UtilPanel,[{key:"opacity",get:function get(){return this.$$.ctx[16];}}]);return UtilPanel;}(SvelteComponent);var arrayRemove=function arrayRemove(array,predicate){var index=array.findIndex(predicate);if(index>=0)return array.splice(index,1);return undefined;};// svelte
// constants
var INERTIA_THRESHOLD=0.25;// when force of velocity exceeds this value we drift
var INERTIA_DISTANCE_MULTIPLIER=50;var INERTIA_DURATION_MULTIPLIER=80;var TAP_DURATION_MAX=300;var TAP_DISTANCE_MAX=64;var DOUBLE_TAP_DURATION_MAX=700;var DOUBLE_TAP_DISTANCE_MAX=128;var isContextMenuAction=function isContextMenuAction(e){return isNumber(e.button)&&e.button!==0;};var interactable=function interactable(node){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};// set defaults
var _options$inertia=options.inertia,inertia=_options$inertia===void 0?false:_options$inertia,_options$inertiaDurat=options.inertiaDurationMultiplier,inertiaDurationMultiplier=_options$inertiaDurat===void 0?INERTIA_DURATION_MULTIPLIER:_options$inertiaDurat,_options$shouldStartI=options.shouldStartInteraction,shouldStartInteraction=_options$shouldStartI===void 0?function(){return true;}:_options$shouldStartI,_options$pinch=options.pinch,pinch=_options$pinch===void 0?false:_options$pinch,_options$multiTouch=options.multiTouch,multiTouch=_options$multiTouch===void 0?undefined:_options$multiTouch,_options$getEventPosi=options.getEventPosition,getEventPosition=_options$getEventPosi===void 0?function(e){return vectorCreate(e.clientX,e.clientY);}:_options$getEventPosi;//
// helpers
//
function dispatch(type,detail){node.dispatchEvent(new CustomEvent(type,{detail:detail}));}function resetInertia(){if(inertiaTweenUnsubscribe)inertiaTweenUnsubscribe();inertiaTweenUnsubscribe=undefined;}//#region pointer registry
var pointers=[];var getPointerTimestamp=function getPointerTimestamp(e){return e.timeStamp===0?Date.now():e.timeStamp;};var addPointer=function addPointer(e){var timeStamp=getPointerTimestamp(e);var pointer={timeStamp:timeStamp,timeStampInitial:timeStamp,position:getEventPosition(e),origin:getEventPosition(e),velocity:vectorCreateEmpty(),velocityHistory:[],velocityAverage:vectorCreateEmpty(),translation:vectorCreateEmpty(),interactionState:undefined,event:e};pointers.push(pointer);pointer.interactionState=getInteractionState(pointers);};var removePointer=function removePointer(e){var pointer=arrayRemove(pointers,function(pointer){return pointer.event.pointerId===e.pointerId;});if(pointer)return pointer[0];};var removePointers=function removePointers(){pointers.length=0;};var getPointerIndex=function getPointerIndex(e){return pointers.findIndex(function(pointer){return pointer.event.pointerId===e.pointerId;});};var getPointersCenter=function getPointersCenter(){var position=vectorClone(pointers[0].position);if(pointers[1]){var dx=(pointers[1].position.x-position.x)*0.5;var dy=(pointers[1].position.y-position.y)*0.5;position.x+=dx;position.y+=dy;}return position;};var flattenPointerOrigin=function flattenPointerOrigin(pointer){pointer.origin.x=pointer.position.x;pointer.origin.y=pointer.position.y;pointer.translation.x=0;pointer.translation.y=0;};var updatePointer=function updatePointer(e){var pointer=getPointer(e);if(!pointer)return;var timeStamp=getPointerTimestamp(e);// position
var eventPosition=getEventPosition(e);// duration between previous interaction and new interaction, an interaction duration cannot be faster than 1 millisecond
var interactionDuration=Math.max(1,timeStamp-pointer.timeStamp);// calculate velocity
pointer.velocity.x=(eventPosition.x-pointer.position.x)/interactionDuration;pointer.velocity.y=(eventPosition.y-pointer.position.y)/interactionDuration;pointer.velocityHistory.push(vectorClone(pointer.velocity));pointer.velocityHistory=pointer.velocityHistory.slice(-3);pointer.velocityAverage=pointer.velocityHistory.reduce(function(v,c,index,arr){v.x+=c.x/arr.length;v.y+=c.y/arr.length;return v;},vectorCreateEmpty());// update the translation
pointer.translation.x=eventPosition.x-pointer.origin.x;pointer.translation.y=eventPosition.y-pointer.origin.y;// set new state
pointer.timeStamp=timeStamp;pointer.position.x=eventPosition.x;pointer.position.y=eventPosition.y;pointer.event=e;};var getPointer=function getPointer(e){var i=getPointerIndex(e);if(i<0)return;return pointers[i];};var isSingleTouching=function isSingleTouching(){return pointers.length===1;};var isMultiTouching=function isMultiTouching(){return pointers.length===2;};var getDistance=function getDistance(pointers,position){var distanceTotal=pointers.reduce(function(prev,curr){prev+=vectorDistance(position,curr.position);return prev;},0);return distanceTotal/pointers.length;};var getInteractionState=function getInteractionState(pointers){var center=vectorCenter(pointers.map(function(pointer){return pointer.position;}));var distance=getDistance(pointers,center);return{center:center,distance:distance,velocity:vectorCenter(pointers.map(function(pointer){return pointer.velocity;})),translation:vectorCenter(pointers.map(function(pointer){return pointer.translation;}))};};//#endregion
var inertiaTween;var inertiaOrigin;var inertiaTranslation;var inertiaTweenUnsubscribe;var pinchOffsetDistance;var currentTranslation;var currentScale;var isGesture;var lastTapTimeStamp=0;var lastTapPosition=undefined;// start handling interactions
node.addEventListener('pointerdown',handlePointerdown);function handlePointerdown(e){// ignore more than two pointers for now
if(isMultiTouching())return;// not interested in context menu
if(isContextMenuAction(e))return;// target should equal node, if it doesn't user might have clicked one of the nodes children
if(!shouldStartInteraction(e,node))return;// stop any previous inertia tweens
resetInertia();// register this pointer
addPointer(e);// if is first pointer we need to init the drag gesture
if(isSingleTouching()){// handle pointer events
document.documentElement.addEventListener('pointermove',handlePointermove);document.documentElement.addEventListener('pointerup',handlePointerup);document.documentElement.addEventListener('pointercancel',handlePointerup);// clear vars
isGesture=false;currentScale=1;currentTranslation=vectorCreateEmpty();pinchOffsetDistance=undefined;dispatch('interactionstart',{origin:vectorClone(getPointer(e).origin)});}// is pinch
else if(pinch){isGesture=true;pinchOffsetDistance=vectorDistance(pointers[0].position,pointers[1].position);currentTranslation.x+=pointers[0].translation.x;currentTranslation.y+=pointers[0].translation.y;flattenPointerOrigin(pointers[0]);}// is multitouch and we're not allowed to multitouch
else if(multiTouch===false){// remove all pointers
removePointers();// clean up
document.documentElement.removeEventListener('pointermove',handlePointermove);document.documentElement.removeEventListener('pointerup',handlePointerup);document.documentElement.removeEventListener('pointercancel',handlePointerup);// cancelled
return dispatch('interactioncancel');}}//
// pointer move can only be a primary event (other pointers are not handled)
//
var moveLast=Date.now();function handlePointermove(e){// prevent selection of text (Safari)
e.preventDefault();// update pointer state
updatePointer(e);var translation=vectorClone(pointers[0].translation);var scalar=currentScale;if(pinch&&isMultiTouching()){// current pinch distance
var pinchCurrentDistance=vectorDistance(pointers[0].position,pointers[1].position);// to find out scalar we calculate the difference between the pinch offset and the new pinch
var pinchScalar=pinchCurrentDistance/pinchOffsetDistance;// add to existing scalar
scalar*=pinchScalar;// current offset
vectorAdd(translation,pointers[1].translation);}vectorAdd(translation,currentTranslation);// skip update event if last interaction was less than 16 ms ago
var now=Date.now();var dist=now-moveLast;if(dist<16)return;moveLast=now;dispatch('interactionupdate',{position:getPointersCenter(),translation:translation,scalar:pinch?scalar:undefined,isMultiTouching:isMultiTouching()});}//
// pointer up can only be a primary event (other pointers are not handled)
//
function handlePointerup(e){// test if is my pointer that was released, as we're listining on document it could be other pointers
if(!getPointer(e))return;// calculate center between active pointers
var centerBetweenPointers=getPointersCenter();// remove pointer from active pointers array
var removedPointer=removePointer(e);// store current size
if(pinch&&isSingleTouching()){// calculate current scale
var pinchCurrentDistance=vectorDistance(pointers[0].position,removedPointer.position);currentScale*=pinchCurrentDistance/pinchOffsetDistance;currentTranslation.x+=pointers[0].translation.x+removedPointer.translation.x;currentTranslation.y+=pointers[0].translation.y+removedPointer.translation.y;flattenPointerOrigin(pointers[0]);}// check if this was a tap
var isTap=false;var isDoubleTap=false;if(!isGesture&&removedPointer){var interactionEnd=performance.now();var interactionDuration=interactionEnd-removedPointer.timeStampInitial;var interactionDistanceSquared=vectorDistanceSquared(removedPointer.translation);isTap=interactionDistanceSquared<TAP_DISTANCE_MAX&&interactionDuration<TAP_DURATION_MAX;isDoubleTap=!!(lastTapPosition&&isTap&&interactionEnd-lastTapTimeStamp<DOUBLE_TAP_DURATION_MAX&&vectorDistanceSquared(lastTapPosition,removedPointer.position)<DOUBLE_TAP_DISTANCE_MAX);if(isTap){lastTapPosition=vectorClone(removedPointer.position);lastTapTimeStamp=interactionEnd;}}// we wait till last multi-touch interaction is finished, all pointers need to be de-registered before proceeding
if(pointers.length>0)return;// stop listening
document.documentElement.removeEventListener('pointermove',handlePointermove);document.documentElement.removeEventListener('pointerup',handlePointerup);document.documentElement.removeEventListener('pointercancel',handlePointerup);var translation=vectorClone(removedPointer.translation);var velocity=vectorClone(removedPointer.velocityAverage);// allows cancelling inertia from release handler
var inertiaPrevented=false;// user has released interaction
dispatch('interactionrelease',{isTap:isTap,isDoubleTap:isDoubleTap,position:centerBetweenPointers,translation:translation,scalar:currentScale,preventInertia:function preventInertia(){return inertiaPrevented=true;}});// stop intantly if not a lot of force applied
var force=vectorDistance(velocity);if(inertiaPrevented||!inertia||force<INERTIA_THRESHOLD){return handleEnd(translation,{isTap:isTap,isDoubleTap:isDoubleTap});}// drift
inertiaOrigin=vectorClone(centerBetweenPointers);inertiaTranslation=vectorClone(translation);inertiaTween=tweened(vectorClone(translation),{easing:circOut,duration:force*inertiaDurationMultiplier});inertiaTween.set({x:translation.x+velocity.x*INERTIA_DISTANCE_MULTIPLIER,y:translation.y+velocity.y*INERTIA_DISTANCE_MULTIPLIER}).then(function(){// if has unsubscribed (tween was reset)
if(!inertiaTweenUnsubscribe)return;// go!
handleEnd(get_store_value(inertiaTween),{isTap:isTap,isDoubleTap:isDoubleTap});});inertiaTweenUnsubscribe=inertiaTween.subscribe(handleInertiaUpdate);}function handleInertiaUpdate(translation){// if is same as previous position, ignore
if(!translation)return;// this will handle drift interactions
dispatch('interactionupdate',{position:vectorCreate(inertiaOrigin.x+(translation.x-inertiaTranslation.x),inertiaOrigin.y+(translation.y-inertiaTranslation.y)),translation:translation,scalar:pinch?currentScale:undefined});}function handleEnd(translation,tapState){resetInertia();dispatch('interactionend',_objectSpread(_objectSpread({},tapState),{},{translation:translation,scalar:pinch?currentScale:undefined}));}return{destroy:function destroy(){resetInertia();node.removeEventListener('pointerdown',handlePointerdown);}};};function elastify(translation,dist){return dist?dist*Math.sign(translation)*Math.log10(1+Math.abs(translation)/dist):translation;}var elastifyRects=function elastifyRects(a,b,dist){if(!b||!dist)return _objectSpread({},a);var left=a.x+elastify(b.x-a.x,dist);var right=a.x+a.width+elastify(b.x+b.width-(a.x+a.width),dist);var top=a.y+elastify(b.y-a.y,dist);var bottom=a.y+a.height+elastify(b.y+b.height-(a.y+a.height),dist);return{x:left,y:top,width:right-left,height:bottom-top};};var elastifyVectors=function elastifyVectors(a,b,dist){if(!b||!dist)return _objectSpread({},a);return vectorCreate(a.x+elastify(b.x-a.x,dist),a.y+elastify(b.y-a.y,dist));};var unitToPixels=function unitToPixels(value,element){if(!value)return;if(/em/.test(value))return parseInt(value,10)*16;if(/px/.test(value))return parseInt(value,10);};var getWheelDelta=function getWheelDelta(e){var d=e.detail||0;var deltaX=e.deltaX,deltaY=e.deltaY,wheelDelta=e.wheelDelta,wheelDeltaX=e.wheelDeltaX,wheelDeltaY=e.wheelDeltaY;// "detect" x axis interaction for MacOS trackpad
if(isNumber(wheelDeltaX)&&Math.abs(wheelDeltaX)>Math.abs(wheelDeltaY)){// blink & webkit
d=wheelDeltaX/-120;}else if(isNumber(deltaX)&&Math.abs(deltaX)>Math.abs(deltaY)){// quantum
d=deltaX/20;}else if(wheelDelta||wheelDeltaY){// blink & webkit
d=(wheelDelta||wheelDeltaY)/-120;}if(!d){// quantum
d=deltaY/20;}// speed up wheel/touch interactions on firefox and safari as chrome is more snappy
if(isFirefox()||isSafari()){d*=2;}return d;};/* src/core/ui/components/Scrollable.svelte generated by Svelte v3.52.0 */function create_fragment$J(ctx){var div1;var div0;var div1_class_value;var nudgeable_action;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[36]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[35],null);return{c:function c(){div1=element("div");div0=element("div");if(default_slot)default_slot.c();attr(div0,"style",/*childStyle*/ctx[5]);attr(div1,"class",div1_class_value=arrayJoin(['PinturaScrollable',/*klass*/ctx[0]]));attr(div1,"style",/*overflowStyle*/ctx[4]);attr(div1,"data-direction",/*scrollDirection*/ctx[1]);attr(div1,"data-state",/*containerState*/ctx[6]);},m:function m(target,anchor){insert(target,div1,anchor);append(div1,div0);if(default_slot){default_slot.m(div0,null);}/*div1_binding*/ctx[38](div1);current=true;if(!mounted){dispose=[listen(div0,"interactionstart",/*handleDragStart*/ctx[8]),listen(div0,"interactionupdate",/*handleDragMove*/ctx[10]),listen(div0,"interactionend",/*handleDragEnd*/ctx[11]),listen(div0,"interactionrelease",/*handleDragRelease*/ctx[9]),action_destroyer(interactable.call(null,div0,{inertia:true})),listen(div0,"measure",/*measure_handler*/ctx[37]),action_destroyer(measurable.call(null,div0)),listen(div1,"wheel",/*handleWheel*/ctx[13],{passive:false}),listen(div1,"scroll",/*handleScroll*/ctx[15]),listen(div1,"focusin",/*handleFocus*/ctx[14]),listen(div1,"nudge",/*handleNudge*/ctx[16]),listen(div1,"measure",/*handleResizeScrollContainer*/ctx[12]),action_destroyer(measurable.call(null,div1,{observePosition:true})),action_destroyer(nudgeable_action=nudgeable.call(null,div1,{direction:/*scrollDirection*/ctx[1]==='x'?'horizontal':'vertical',stopKeydownPropagation:false}))];// preventDefault is not enabled as keyboard interaction is needed to select nodes
mounted=true;}},p:function p(ctx,dirty){if(default_slot){if(default_slot.p&&(!current||dirty[1]&/*$$scope*/16)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[35],!current?get_all_dirty_from_scope(/*$$scope*/ctx[35]):get_slot_changes(default_slot_template,/*$$scope*/ctx[35],dirty,null),null);}}if(!current||dirty[0]&/*childStyle*/32){attr(div0,"style",/*childStyle*/ctx[5]);}if(!current||dirty[0]&/*klass*/1&&div1_class_value!==(div1_class_value=arrayJoin(['PinturaScrollable',/*klass*/ctx[0]]))){attr(div1,"class",div1_class_value);}if(!current||dirty[0]&/*overflowStyle*/16){attr(div1,"style",/*overflowStyle*/ctx[4]);}if(!current||dirty[0]&/*scrollDirection*/2){attr(div1,"data-direction",/*scrollDirection*/ctx[1]);}if(!current||dirty[0]&/*containerState*/64){attr(div1,"data-state",/*containerState*/ctx[6]);}if(nudgeable_action&&is_function(nudgeable_action.update)&&dirty[0]&/*scrollDirection*/2)nudgeable_action.update.call(null,{direction:/*scrollDirection*/ctx[1]==='x'?'horizontal':'vertical',stopKeydownPropagation:false});// preventDefault is not enabled as keyboard interaction is needed to select nodes
},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div1);if(default_slot)default_slot.d(detaching);/*div1_binding*/ctx[38](null);mounted=false;run_all(dispose);}};}function instance$K($$self,$$props,$$invalidate){var size;var axis;var containerStyle;var containerFeatherSize;var overflows;var containerState;var childStyle;var $scrollOffset;var _$$props$$$slots6=$$props.$$slots,slots=_$$props$$$slots6===void 0?{}:_$$props$$$slots6,$$scope=$$props.$$scope;var dispatch=createEventDispatcher();// const ArrowKeyCodes = Object.values(ArrowKeys);
// const keysPressedStore = getContext('keysPressed');
var scrollState='idle';var scrollOrigin;var scrollRect;var scrollContainerRect;var scrollReleased;var scrollOffset=spring(0);component_subscribe($$self,scrollOffset,function(value){return $$invalidate(34,$scrollOffset=value);});var _$$props$class7=$$props["class"],klass=_$$props$class7===void 0?undefined:_$$props$class7;var _$$props$scrollBlockI=$$props.scrollBlockInteractionDist,scrollBlockInteractionDist=_$$props$scrollBlockI===void 0?5:_$$props$scrollBlockI;var _$$props$scrollStep=$$props.scrollStep,scrollStep=_$$props$scrollStep===void 0?10:_$$props$scrollStep;var _$$props$scrollFocusM=$$props.scrollFocusMargin,scrollFocusMargin=_$$props$scrollFocusM===void 0?64:_$$props$scrollFocusM;var _$$props$scrollDirect=$$props.scrollDirection,scrollDirection=_$$props$scrollDirect===void 0?'x':_$$props$scrollDirect;var _$$props$scrollAutoCa=$$props.scrollAutoCancel,scrollAutoCancel=_$$props$scrollAutoCa===void 0?false:_$$props$scrollAutoCa;var _$$props$elasticity=$$props.elasticity,elasticity=_$$props$elasticity===void 0?0:_$$props$elasticity;var _$$props$onscroll=$$props.onscroll,onscroll=_$$props$onscroll===void 0?noop$1:_$$props$onscroll;var _$$props$maskFeatherS=$$props.maskFeatherSize,maskFeatherSize=_$$props$maskFeatherS===void 0?undefined:_$$props$maskFeatherS;var _$$props$maskFeatherS2=$$props.maskFeatherStartOpacity,maskFeatherStartOpacity=_$$props$maskFeatherS2===void 0?undefined:_$$props$maskFeatherS2;var _$$props$maskFeatherE=$$props.maskFeatherEndOpacity,maskFeatherEndOpacity=_$$props$maskFeatherE===void 0?undefined:_$$props$maskFeatherE;var _$$props$scroll=$$props.scroll,scroll=_$$props$scroll===void 0?undefined:_$$props$scroll;// logic
var container;var overflowStyle='';// is scroll in reset state
var scrollAtRest=true;// triggers onscroll callback
var scrollOffsetUnsub=scrollOffset.subscribe(function(value){var pos=vectorCreateEmpty();pos[scrollDirection]=value;onscroll(pos);});var limitOffsetToContainer=function limitOffsetToContainer(offset){return Math.max(Math.min(0,offset),scrollContainerRect[size]-scrollRect[size]);};var scrollFirstMove;var scrollCancelled;var scrollTranslationPrev;var isHorizontalTranslation=function isHorizontalTranslation(translation){var velocity=vectorApply(vectorCreate(translation.x-scrollTranslationPrev.x,translation.y-scrollTranslationPrev.y),Math.abs);scrollTranslationPrev=vectorClone(translation);var speed=vectorDistanceSquared(velocity);var diff=velocity.x-velocity.y;return!(speed>1&&diff<-0.5);};var handleDragStart=function handleDragStart(){// not overflowing so no need to handle
if(!overflows)return;scrollCancelled=false;scrollFirstMove=true;scrollTranslationPrev=vectorCreate(0,0);scrollReleased=false;$$invalidate(27,scrollState='idle');scrollOrigin=get_store_value(scrollOffset);};var handleDragRelease=function handleDragRelease(_ref163){var detail=_ref163.detail;if(!overflows)return;scrollReleased=true;$$invalidate(27,scrollState='idle');};var handleDragMove=function handleDragMove(_ref164){var detail=_ref164.detail;if(!overflows)return;if(scrollCancelled)return;// fixes problem with single move event fired when clicking
if(scrollFirstMove){scrollFirstMove=false;if(vectorDistanceSquared(detail.translation)<0.1)return;}if(scrollAutoCancel&&scrollDirection==='x'&&!isHorizontalTranslation(detail.translation)){scrollCancelled=true;return;}setScrollOffset(scrollOrigin+detail.translation[scrollDirection],{elastic:true});};var handleDragEnd=function handleDragEnd(_ref165){var detail=_ref165.detail;if(!overflows)return;if(scrollCancelled)return;var offset=scrollOrigin+detail.translation[scrollDirection];var offsetLimited=limitOffsetToContainer(offset);scrollAtRest=false;scrollOffset.set(offsetLimited).then(function(res){if(!scrollReleased)return;scrollAtRest=true;});};var handleResizeScrollContainer=function handleResizeScrollContainer(_ref166){var detail=_ref166.detail;$$invalidate(28,scrollContainerRect=detail);dispatch('measure',{x:detail.x,y:detail.y,width:detail.width,height:detail.height});};var setScrollOffset=function setScrollOffset(offset){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _options$elastic=options.elastic,elastic=_options$elastic===void 0?false:_options$elastic,_options$animate=options.animate,animate=_options$animate===void 0?false:_options$animate,_options$preventScrol=options.preventScrollState,preventScrollState=_options$preventScrol===void 0?false:_options$preventScrol;// prevents clicks on child elements if the container is being scrolled
if(Math.abs(offset-scrollOrigin)>scrollBlockInteractionDist&&scrollState==='idle'&&!scrollReleased&&!preventScrollState){$$invalidate(27,scrollState='scrolling');}var offsetLimited=limitOffsetToContainer(offset);var offsetVisual=elastic&&elasticity&&!scrollReleased?offsetLimited+elastify(offset-offsetLimited,elasticity):offsetLimited;var snapToPosition=true;if(animate){snapToPosition=false;}else if(!scrollAtRest){snapToPosition=!scrollReleased;}scrollAtRest=false;scrollOffset.set(offsetVisual,{hard:snapToPosition}).then(function(res){if(!scrollReleased)return;scrollAtRest=true;});};var handleWheel=function handleWheel(e){// don't do anything if isn't overflowing
if(!overflows)return;// hold shift scroll up -> move to begin
// hold shift scroll down -> move to end
// scroll down -> move to right/down
// scroll up -> move to left/up
// don't run default actions, prevent other actions from running
e.preventDefault();e.stopPropagation();// detect if is holding shift
var isHoldingShift=e.shiftKey;// apply wheel delta to offset
var delta=getWheelDelta(e)*(isHoldingShift?-1:1);var offset=get_store_value(scrollOffset);setScrollOffset(offset+delta*scrollStep,{animate:true});};var handleFocus=function handleFocus(e){// don't do anything if isn't overflowing
if(!overflows)return;// ignore this handler if is dragging
if(!scrollReleased)return;// ignore this handler if is pressing arrow key
// disabled for now as prevents scrolling filter list
// if ($keysPressedStore.some((key) => ArrowKeyCodes.includes(key))) return;
var target=e.target;// when a target is marked as implicit we use its parent elemetn
if(e.target.classList.contains('implicit'))target=target.parentNode;// get bounds
var start=target[scrollDirection==='x'?'offsetLeft':'offsetTop'];//.offsetLeft;
var space=target[scrollDirection==='x'?'offsetWidth':'offsetHeight'];//.offsetWidth;
var end=start+space;// we need to know the current offset of the scroll so we can determine if the target is in view
var currentScrollOffset=get_store_value(scrollOffset);// the margin around elements to keep in mind when focussing items
var margin=scrollFocusMargin+maskFeatherSize;if(currentScrollOffset+start<margin){setScrollOffset(-start+margin);}else if(currentScrollOffset+end>scrollContainerRect[size]-margin){setScrollOffset(scrollContainerRect[size]-end-margin,{animate:true});}};var handleScroll=function handleScroll(){// the scroll handler corrects auto browser scroll,
// is triggered when browser tries to focus an
// element outside of the scrollcontiner
$$invalidate(3,container[scrollDirection==='x'?'scrollLeft':'scrollTop']=0,container);};var handleNudge=function handleNudge(_ref167){var detail=_ref167.detail;// no nudging if arrows are used to switch between buttons
if(container.querySelector('[data-focus-visible]'))return;// apply nudge
var delta=-2*detail[scrollDirection];var offset=get_store_value(scrollOffset);setScrollOffset(offset+delta*scrollStep,{animate:true,preventScrollState:true});};onDestroy(function(){scrollOffsetUnsub();});var measure_handler=function measure_handler(e){return $$invalidate(2,scrollRect=e.detail);};function div1_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){container=$$value;$$invalidate(3,container);});}$$self.$$set=function($$props){if('class'in $$props)$$invalidate(0,klass=$$props["class"]);if('scrollBlockInteractionDist'in $$props)$$invalidate(20,scrollBlockInteractionDist=$$props.scrollBlockInteractionDist);if('scrollStep'in $$props)$$invalidate(21,scrollStep=$$props.scrollStep);if('scrollFocusMargin'in $$props)$$invalidate(22,scrollFocusMargin=$$props.scrollFocusMargin);if('scrollDirection'in $$props)$$invalidate(1,scrollDirection=$$props.scrollDirection);if('scrollAutoCancel'in $$props)$$invalidate(23,scrollAutoCancel=$$props.scrollAutoCancel);if('elasticity'in $$props)$$invalidate(24,elasticity=$$props.elasticity);if('onscroll'in $$props)$$invalidate(25,onscroll=$$props.onscroll);if('maskFeatherSize'in $$props)$$invalidate(19,maskFeatherSize=$$props.maskFeatherSize);if('maskFeatherStartOpacity'in $$props)$$invalidate(17,maskFeatherStartOpacity=$$props.maskFeatherStartOpacity);if('maskFeatherEndOpacity'in $$props)$$invalidate(18,maskFeatherEndOpacity=$$props.maskFeatherEndOpacity);if('scroll'in $$props)$$invalidate(26,scroll=$$props.scroll);if('$$scope'in $$props)$$invalidate(35,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*scrollDirection*/2){$$invalidate(31,size=scrollDirection==='x'?'width':'height');}if($$self.$$.dirty[0]&/*scrollDirection*/2){$$invalidate(29,axis=scrollDirection.toUpperCase());}if($$self.$$.dirty[0]&/*container*/8){$$invalidate(33,containerStyle=container&&getComputedStyle(container));}if($$self.$$.dirty[0]&/*container*/8|$$self.$$.dirty[1]&/*containerStyle*/4){$$invalidate(32,containerFeatherSize=containerStyle&&unitToPixels(containerStyle.getPropertyValue('--scrollable-feather-size')));}if($$self.$$.dirty[0]&/*scrollContainerRect, scrollRect, maskFeatherStartOpacity, maskFeatherEndOpacity*/268828676|$$self.$$.dirty[1]&/*$scrollOffset, containerFeatherSize, size*/11){if($scrollOffset!=null&&scrollContainerRect&&containerFeatherSize!=null&&scrollRect){var startOffset=-1*$scrollOffset/containerFeatherSize;var endOffset=-(scrollContainerRect[size]-scrollRect[size]-$scrollOffset)/containerFeatherSize;$$invalidate(17,maskFeatherStartOpacity=clamp(1-startOffset,0,1));$$invalidate(18,maskFeatherEndOpacity=clamp(1-endOffset,0,1));$$invalidate(19,maskFeatherSize=containerFeatherSize);$$invalidate(4,overflowStyle="--scrollable-feather-start-opacity: ".concat(maskFeatherStartOpacity,";--scrollable-feather-end-opacity: ").concat(maskFeatherEndOpacity));}}if($$self.$$.dirty[0]&/*container, scroll*/67108872){// update scroll position
if(container&&scroll!==undefined){if(isNumber(scroll))setScrollOffset(scroll);else setScrollOffset(scroll.scrollOffset,scroll);}}if($$self.$$.dirty[0]&/*scrollContainerRect, scrollRect*/268435460|$$self.$$.dirty[1]&/*size*/1){$$invalidate(30,overflows=scrollContainerRect&&scrollRect?scrollRect[size]>scrollContainerRect[size]:undefined);}if($$self.$$.dirty[0]&/*scrollState, overflows*/1207959552){$$invalidate(6,containerState=arrayJoin([scrollState,overflows?'overflows':undefined]));}if($$self.$$.dirty[0]&/*overflows, axis*/1610612736|$$self.$$.dirty[1]&/*$scrollOffset*/8){$$invalidate(5,childStyle=overflows?"transform: translate".concat(axis,"(").concat($scrollOffset,"px)"):undefined);}};return[klass,scrollDirection,scrollRect,container,overflowStyle,childStyle,containerState,scrollOffset,handleDragStart,handleDragRelease,handleDragMove,handleDragEnd,handleResizeScrollContainer,handleWheel,handleFocus,handleScroll,handleNudge,maskFeatherStartOpacity,maskFeatherEndOpacity,maskFeatherSize,scrollBlockInteractionDist,scrollStep,scrollFocusMargin,scrollAutoCancel,elasticity,onscroll,scroll,scrollState,scrollContainerRect,axis,overflows,size,containerFeatherSize,containerStyle,$scrollOffset,$$scope,slots,measure_handler,div1_binding];}var Scrollable=/*#__PURE__*/function(_SvelteComponent8){_inherits(Scrollable,_SvelteComponent8);var _super9=_createSuper(Scrollable);function Scrollable(options){var _this10;_classCallCheck(this,Scrollable);_this10=_super9.call(this);init(_assertThisInitialized(_this10),options,instance$K,create_fragment$J,safe_not_equal,{"class":0,scrollBlockInteractionDist:20,scrollStep:21,scrollFocusMargin:22,scrollDirection:1,scrollAutoCancel:23,elasticity:24,onscroll:25,maskFeatherSize:19,maskFeatherStartOpacity:17,maskFeatherEndOpacity:18,scroll:26},null,[-1,-1]);return _this10;}return _createClass(Scrollable);}(SvelteComponent);function fade$1(node){var _ref168=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref168$delay=_ref168.delay,delay=_ref168$delay===void 0?0:_ref168$delay,_ref168$duration=_ref168.duration,duration=_ref168$duration===void 0?400:_ref168$duration,_ref168$easing=_ref168.easing,easing=_ref168$easing===void 0?identity:_ref168$easing;var o=+getComputedStyle(node).opacity;return{delay:delay,duration:duration,easing:easing,css:function css(t){return"opacity: ".concat(t*o);}};}/* src/core/ui/components/StatusMessage.svelte generated by Svelte v3.52.0 */function create_fragment$I(ctx){var span;var span_transition;var current;var mounted;var dispose;return{c:function c(){span=element("span");attr(span,"class","PinturaStatusMessage");},m:function m(target,anchor){insert(target,span,anchor);span.innerHTML=/*text*/ctx[0];current=true;if(!mounted){dispose=[listen(span,"measure",function(){if(is_function(/*onmeasure*/ctx[1]))/*onmeasure*/ctx[1].apply(this,arguments);}),action_destroyer(measurable.call(null,span))];mounted=true;}},p:function p(new_ctx,_ref169){var _ref170=_slicedToArray(_ref169,1),dirty=_ref170[0];ctx=new_ctx;if(!current||dirty&/*text*/1)span.innerHTML=/*text*/ctx[0];},i:function i(local){if(current)return;add_render_callback(function(){if(!span_transition)span_transition=create_bidirectional_transition(span,fade$1,{duration:500},true);span_transition.run(1);});current=true;},o:function o(local){if(!span_transition)span_transition=create_bidirectional_transition(span,fade$1,{duration:500},false);span_transition.run(0);current=false;},d:function d(detaching){if(detaching)detach(span);if(detaching&&span_transition)span_transition.end();mounted=false;run_all(dispose);}};}function instance$J($$self,$$props,$$invalidate){var text=$$props.text;var _$$props$onmeasure=$$props.onmeasure,onmeasure=_$$props$onmeasure===void 0?noop$1:_$$props$onmeasure;$$self.$$set=function($$props){if('text'in $$props)$$invalidate(0,text=$$props.text);if('onmeasure'in $$props)$$invalidate(1,onmeasure=$$props.onmeasure);};return[text,onmeasure];}var StatusMessage=/*#__PURE__*/function(_SvelteComponent9){_inherits(StatusMessage,_SvelteComponent9);var _super10=_createSuper(StatusMessage);function StatusMessage(options){var _this11;_classCallCheck(this,StatusMessage);_this11=_super10.call(this);init(_assertThisInitialized(_this11),options,instance$J,create_fragment$I,safe_not_equal,{text:0,onmeasure:1});return _this11;}return _createClass(StatusMessage);}(SvelteComponent);/* src/core/ui/components/ProgressIndicator.svelte generated by Svelte v3.52.0 */function create_fragment$H(ctx){var span1;var svg;var g;var circle0;var circle1;var t0;var span0;var t1;return{c:function c(){span1=element("span");svg=svg_element("svg");g=svg_element("g");circle0=svg_element("circle");circle1=svg_element("circle");t0=space();span0=element("span");t1=text(/*formattedValue*/ctx[3]);attr(circle0,"class","PinturaProgressIndicatorBar");attr(circle0,"r","8.5");attr(circle0,"cx","10");attr(circle0,"cy","10");attr(circle0,"stroke-linecap","round");attr(circle0,"opacity",".25");attr(circle1,"class","PinturaProgressIndicatorFill");attr(circle1,"r","8.5");attr(circle1,"stroke-dasharray",/*circleValue*/ctx[2]);attr(circle1,"cx","10");attr(circle1,"cy","10");attr(circle1,"transform","rotate(-90) translate(-20)");attr(g,"fill","none");attr(g,"stroke","currentColor");attr(g,"stroke-width","2.5");attr(g,"stroke-linecap","round");attr(g,"opacity",/*circleOpacity*/ctx[1]);attr(svg,"width","20");attr(svg,"height","20");attr(svg,"viewBox","0 0 20 20");attr(svg,"xmlns","http://www.w3.org/2000/svg");attr(svg,"aria-hidden","true");attr(svg,"focusable","false");attr(span0,"class","implicit");attr(span1,"class","PinturaProgressIndicator");attr(span1,"data-status",/*status*/ctx[0]);},m:function m(target,anchor){insert(target,span1,anchor);append(span1,svg);append(svg,g);append(g,circle0);append(g,circle1);append(span1,t0);append(span1,span0);append(span0,t1);},p:function p(ctx,_ref171){var _ref172=_slicedToArray(_ref171,1),dirty=_ref172[0];if(dirty&/*circleValue*/4){attr(circle1,"stroke-dasharray",/*circleValue*/ctx[2]);}if(dirty&/*circleOpacity*/2){attr(g,"opacity",/*circleOpacity*/ctx[1]);}if(dirty&/*formattedValue*/8)set_data(t1,/*formattedValue*/ctx[3]);if(dirty&/*status*/1){attr(span1,"data-status",/*status*/ctx[0]);}},i:noop,o:noop,d:function d(detaching){if(detaching)detach(span1);}};}function instance$I($$self,$$props,$$invalidate){var formattedValue;var circleValue;var circleOpacity;var status;var $animatedOpacity;var $animatedProgressClamped;var dispatch=createEventDispatcher();var progress=$$props.progress;var _$$props$min2=$$props.min,min=_$$props$min2===void 0?0:_$$props$min2;var _$$props$max2=$$props.max,max=_$$props$max2===void 0?100:_$$props$max2;var _$$props$labelBusy=$$props.labelBusy,labelBusy=_$$props$labelBusy===void 0?'Busy':_$$props$labelBusy;var animatedValue=spring(0,{precision:0.01});var animatedOpacity=spring(0,{precision:0.01});component_subscribe($$self,animatedOpacity,function(value){return $$invalidate(10,$animatedOpacity=value);});var animatedProgressClamped=derived([animatedValue],function($animatedValue){return clamp($animatedValue,min,max);});component_subscribe($$self,animatedProgressClamped,function(value){return $$invalidate(11,$animatedProgressClamped=value);});var animatedProgressClampedUnsub=animatedProgressClamped.subscribe(function(value){if(progress===1&&Math.round(value)>=100)dispatch('complete');});onMount(function(){animatedOpacity.set(1);});onDestroy(function(){animatedProgressClampedUnsub();});$$self.$$set=function($$props){if('progress'in $$props)$$invalidate(6,progress=$$props.progress);if('min'in $$props)$$invalidate(7,min=$$props.min);if('max'in $$props)$$invalidate(8,max=$$props.max);if('labelBusy'in $$props)$$invalidate(9,labelBusy=$$props.labelBusy);};$$self.$$.update=function(){if($$self.$$.dirty&/*progress*/64){progress&&progress!==Infinity&&animatedValue.set(progress*100);}if($$self.$$.dirty&/*progress, labelBusy, $animatedProgressClamped*/2624){$$invalidate(3,formattedValue=progress===Infinity?labelBusy:"".concat(Math.round($animatedProgressClamped),"%"));}if($$self.$$.dirty&/*progress, $animatedProgressClamped*/2112){$$invalidate(2,circleValue=progress===Infinity?'26.5 53':"".concat($animatedProgressClamped/100*53," 53"));}if($$self.$$.dirty&/*$animatedOpacity*/1024){$$invalidate(1,circleOpacity=$animatedOpacity);// Math.min(1, progress === Infinity ? 1 : $animatedProgressClamped / 10);
}if($$self.$$.dirty&/*progress*/64){$$invalidate(0,status=progress===Infinity?'busy':'loading');}};return[status,circleOpacity,circleValue,formattedValue,animatedOpacity,animatedProgressClamped,progress,min,max,labelBusy,$animatedOpacity,$animatedProgressClamped];}var ProgressIndicator=/*#__PURE__*/function(_SvelteComponent10){_inherits(ProgressIndicator,_SvelteComponent10);var _super11=_createSuper(ProgressIndicator);function ProgressIndicator(options){var _this12;_classCallCheck(this,ProgressIndicator);_this12=_super11.call(this);init(_assertThisInitialized(_this12),options,instance$I,create_fragment$H,safe_not_equal,{progress:6,min:7,max:8,labelBusy:9});return _this12;}return _createClass(ProgressIndicator);}(SvelteComponent);/* src/core/ui/components/StatusAside.svelte generated by Svelte v3.52.0 */function create_fragment$G(ctx){var span;var span_class_value;var current;var default_slot_template=/*#slots*/ctx[5]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[4],null);return{c:function c(){span=element("span");if(default_slot)default_slot.c();attr(span,"class",span_class_value="PinturaStatusAside ".concat(/*klass*/ctx[0]));attr(span,"style",/*style*/ctx[1]);},m:function m(target,anchor){insert(target,span,anchor);if(default_slot){default_slot.m(span,null);}current=true;},p:function p(ctx,_ref173){var _ref174=_slicedToArray(_ref173,1),dirty=_ref174[0];if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope*/16)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[4],!current?get_all_dirty_from_scope(/*$$scope*/ctx[4]):get_slot_changes(default_slot_template,/*$$scope*/ctx[4],dirty,null),null);}}if(!current||dirty&/*klass*/1&&span_class_value!==(span_class_value="PinturaStatusAside ".concat(/*klass*/ctx[0]))){attr(span,"class",span_class_value);}if(!current||dirty&/*style*/2){attr(span,"style",/*style*/ctx[1]);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(span);if(default_slot)default_slot.d(detaching);}};}function instance$H($$self,$$props,$$invalidate){var style;var _$$props$$$slots7=$$props.$$slots,slots=_$$props$$$slots7===void 0?{}:_$$props$$$slots7,$$scope=$$props.$$scope;var _$$props$offset=$$props.offset,offset=_$$props$offset===void 0?0:_$$props$offset;var _$$props$opacity=$$props.opacity,opacity=_$$props$opacity===void 0?0:_$$props$opacity;var _$$props$class8=$$props["class"],klass=_$$props$class8===void 0?undefined:_$$props$class8;$$self.$$set=function($$props){if('offset'in $$props)$$invalidate(2,offset=$$props.offset);if('opacity'in $$props)$$invalidate(3,opacity=$$props.opacity);if('class'in $$props)$$invalidate(0,klass=$$props["class"]);if('$$scope'in $$props)$$invalidate(4,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty&/*offset, opacity*/12){$$invalidate(1,style="transform:translateX(".concat(offset,"px);opacity:").concat(opacity));}};return[klass,style,offset,opacity,$$scope,slots];}var StatusAside=/*#__PURE__*/function(_SvelteComponent11){_inherits(StatusAside,_SvelteComponent11);var _super12=_createSuper(StatusAside);function StatusAside(options){var _this13;_classCallCheck(this,StatusAside);_this13=_super12.call(this);init(_assertThisInitialized(_this13),options,instance$H,create_fragment$G,safe_not_equal,{offset:2,opacity:3,"class":0});return _this13;}return _createClass(StatusAside);}(SvelteComponent);/* src/core/ui/components/Tag.svelte generated by Svelte v3.52.0 */function create_if_block_2$b(ctx){var label;var label_for_value;var current;var default_slot_template=/*#slots*/ctx[3]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[2],null);var label_levels=[{"for":label_for_value='_'},/*attributes*/ctx[1]];var label_data={};for(var i=0;i<label_levels.length;i+=1){label_data=assign(label_data,label_levels[i]);}return{c:function c(){label=element("label");if(default_slot)default_slot.c();set_attributes(label,label_data);},m:function m(target,anchor){insert(target,label,anchor);if(default_slot){default_slot.m(label,null);}current=true;},p:function p(ctx,dirty){if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope*/4)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[2],!current?get_all_dirty_from_scope(/*$$scope*/ctx[2]):get_slot_changes(default_slot_template,/*$$scope*/ctx[2],dirty,null),null);}}set_attributes(label,label_data=get_spread_update(label_levels,[{"for":label_for_value},dirty&/*attributes*/2&&/*attributes*/ctx[1]]));},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(label);if(default_slot)default_slot.d(detaching);}};}// (12:26) 
function create_if_block_1$c(ctx){var div;var current;var default_slot_template=/*#slots*/ctx[3]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[2],null);var div_levels=[/*attributes*/ctx[1]];var div_data={};for(var i=0;i<div_levels.length;i+=1){div_data=assign(div_data,div_levels[i]);}return{c:function c(){div=element("div");if(default_slot)default_slot.c();set_attributes(div,div_data);},m:function m(target,anchor){insert(target,div,anchor);if(default_slot){default_slot.m(div,null);}current=true;},p:function p(ctx,dirty){if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope*/4)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[2],!current?get_all_dirty_from_scope(/*$$scope*/ctx[2]):get_slot_changes(default_slot_template,/*$$scope*/ctx[2],dirty,null),null);}}set_attributes(div,div_data=get_spread_update(div_levels,[dirty&/*attributes*/2&&/*attributes*/ctx[1]]));},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(default_slot)default_slot.d(detaching);}};}// (8:0) {#if name === 'div'}
function create_if_block$c(ctx){var div;var current;var default_slot_template=/*#slots*/ctx[3]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[2],null);var div_levels=[/*attributes*/ctx[1]];var div_data={};for(var i=0;i<div_levels.length;i+=1){div_data=assign(div_data,div_levels[i]);}return{c:function c(){div=element("div");if(default_slot)default_slot.c();set_attributes(div,div_data);},m:function m(target,anchor){insert(target,div,anchor);if(default_slot){default_slot.m(div,null);}current=true;},p:function p(ctx,dirty){if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope*/4)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[2],!current?get_all_dirty_from_scope(/*$$scope*/ctx[2]):get_slot_changes(default_slot_template,/*$$scope*/ctx[2],dirty,null),null);}}set_attributes(div,div_data=get_spread_update(div_levels,[dirty&/*attributes*/2&&/*attributes*/ctx[1]]));},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(default_slot)default_slot.d(detaching);}};}function create_fragment$F(ctx){var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block$c,create_if_block_1$c,create_if_block_2$b];var if_blocks=[];function select_block_type(ctx,dirty){if(/*name*/ctx[0]==='div')return 0;if(/*name*/ctx[0]==='span')return 1;if(/*name*/ctx[0]==='label')return 2;return-1;}if(~(current_block_type_index=select_block_type(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){if(if_block)if_block.c();if_block_anchor=empty();},m:function m(target,anchor){if(~current_block_type_index){if_blocks[current_block_type_index].m(target,anchor);}insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,_ref175){var _ref176=_slicedToArray(_ref175,1),dirty=_ref176[0];var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}else{if_block=null;}}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(~current_block_type_index){if_blocks[current_block_type_index].d(detaching);}if(detaching)detach(if_block_anchor);}};}function instance$G($$self,$$props,$$invalidate){var _$$props$$$slots8=$$props.$$slots,slots=_$$props$$$slots8===void 0?{}:_$$props$$$slots8,$$scope=$$props.$$scope;var _$$props$name=$$props.name,name=_$$props$name===void 0?'div':_$$props$name;var _$$props$attributes=$$props.attributes,attributes=_$$props$attributes===void 0?{}:_$$props$attributes;$$self.$$set=function($$props){if('name'in $$props)$$invalidate(0,name=$$props.name);if('attributes'in $$props)$$invalidate(1,attributes=$$props.attributes);if('$$scope'in $$props)$$invalidate(2,$$scope=$$props.$$scope);};return[name,attributes,$$scope,slots];}var Tag=/*#__PURE__*/function(_SvelteComponent12){_inherits(Tag,_SvelteComponent12);var _super13=_createSuper(Tag);function Tag(options){var _this14;_classCallCheck(this,Tag);_this14=_super13.call(this);init(_assertThisInitialized(_this14),options,instance$G,create_fragment$F,safe_not_equal,{name:0,attributes:1});return _this14;}return _createClass(Tag);}(SvelteComponent);var getDevicePixelRatio=function getDevicePixelRatio(){return isBrowser()&&window.devicePixelRatio||1;};// if this is a non retina display snap to pixel
var fn=null;var snapToPixel=function snapToPixel(v){if(fn===null)fn=getDevicePixelRatio()===1?Math.round:function(v){return v;};return fn(v);};var focus=function focus(element){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!element)return;if(options.preventScroll&&isSafari()){var scrollTop=document.body.scrollTop;element.focus();document.body.scrollTop=scrollTop;return;}element.focus(options);};/* src/core/ui/components/Panel.svelte generated by Svelte v3.52.0 */var get_details_slot_changes=function get_details_slot_changes(dirty){return{};};var get_details_slot_context=function get_details_slot_context(ctx){return{};};var get_label_slot_changes=function get_label_slot_changes(dirty){return{};};var get_label_slot_context=function get_label_slot_context(ctx){return{};};// (216:0) {:else}
function create_else_block$5(ctx){var button;var current;var button_spread_levels=[/*buttonProps*/ctx[7]];var button_props={$$slots:{"default":[create_default_slot$g]},$$scope:{ctx:ctx}};for(var i=0;i<button_spread_levels.length;i+=1){button_props=assign(button_props,button_spread_levels[i]);}button=new Button({props:button_props});/*button_binding_1*/ctx[40](button);return{c:function c(){create_component(button.$$.fragment);},m:function m(target,anchor){mount_component(button,target,anchor);current=true;},p:function p(ctx,dirty){var button_changes=dirty[0]&/*buttonProps*/128?get_spread_update(button_spread_levels,[get_spread_object(/*buttonProps*/ctx[7])]):{};if(dirty[1]&/*$$scope*/8192){button_changes.$$scope={dirty:dirty,ctx:ctx};}button.$set(button_changes);},i:function i(local){if(current)return;transition_in(button.$$.fragment,local);current=true;},o:function o(local){transition_out(button.$$.fragment,local);current=false;},d:function d(detaching){/*button_binding_1*/ctx[40](null);destroy_component(button,detaching);}};}// (214:0) {#if buttonLabel}
function create_if_block_2$a(ctx){var button;var current;var button_spread_levels=[/*buttonProps*/ctx[7]];var button_props={};for(var i=0;i<button_spread_levels.length;i+=1){button_props=assign(button_props,button_spread_levels[i]);}button=new Button({props:button_props});/*button_binding*/ctx[39](button);return{c:function c(){create_component(button.$$.fragment);},m:function m(target,anchor){mount_component(button,target,anchor);current=true;},p:function p(ctx,dirty){var button_changes=dirty[0]&/*buttonProps*/128?get_spread_update(button_spread_levels,[get_spread_object(/*buttonProps*/ctx[7])]):{};button.$set(button_changes);},i:function i(local){if(current)return;transition_in(button.$$.fragment,local);current=true;},o:function o(local){transition_out(button.$$.fragment,local);current=false;},d:function d(detaching){/*button_binding*/ctx[39](null);destroy_component(button,detaching);}};}// (217:4) <Button bind:this={buttonComponent} {...buttonProps}>
function create_default_slot$g(ctx){var current;var label_slot_template=/*#slots*/ctx[38].label;var label_slot=create_slot(label_slot_template,ctx,/*$$scope*/ctx[44],get_label_slot_context);return{c:function c(){if(label_slot)label_slot.c();},m:function m(target,anchor){if(label_slot){label_slot.m(target,anchor);}current=true;},p:function p(ctx,dirty){if(label_slot){if(label_slot.p&&(!current||dirty[1]&/*$$scope*/8192)){update_slot_base(label_slot,label_slot_template,ctx,/*$$scope*/ctx[44],!current?get_all_dirty_from_scope(/*$$scope*/ctx[44]):get_slot_changes(label_slot_template,/*$$scope*/ctx[44],dirty,get_label_slot_changes),get_label_slot_context);}}},i:function i(local){if(current)return;transition_in(label_slot,local);current=true;},o:function o(local){transition_out(label_slot,local);current=false;},d:function d(detaching){if(label_slot)label_slot.d(detaching);}};}// (222:0) {#if isVisible}
function create_if_block_1$b(ctx){var div;var t;var span;var div_class_value;var current;var mounted;var dispose;var details_slot_template=/*#slots*/ctx[38].details;var details_slot=create_slot(details_slot_template,ctx,/*$$scope*/ctx[44],get_details_slot_context);return{c:function c(){div=element("div");if(details_slot)details_slot.c();t=space();span=element("span");attr(span,"class","PinturaPanelTip");attr(span,"style",/*tipStyle*/ctx[10]);attr(div,"class",div_class_value=arrayJoin(['PinturaPanel','pintura-editor-panel',/*panelClass*/ctx[2]]));attr(div,"tabindex","-1");attr(div,"style",/*style*/ctx[11]);},m:function m(target,anchor){insert(target,div,anchor);if(details_slot){details_slot.m(div,null);}append(div,t);append(div,span);/*div_binding*/ctx[41](div);current=true;if(!mounted){dispose=[listen(div,"close",/*close_handler*/ctx[42]),listen(div,"keydown",/*handlePanelKeydown*/ctx[18]),listen(div,"measure",/*measure_handler*/ctx[43]),action_destroyer(measurable.call(null,div))];mounted=true;}},p:function p(ctx,dirty){if(details_slot){if(details_slot.p&&(!current||dirty[1]&/*$$scope*/8192)){update_slot_base(details_slot,details_slot_template,ctx,/*$$scope*/ctx[44],!current?get_all_dirty_from_scope(/*$$scope*/ctx[44]):get_slot_changes(details_slot_template,/*$$scope*/ctx[44],dirty,get_details_slot_changes),get_details_slot_context);}}if(!current||dirty[0]&/*tipStyle*/1024){attr(span,"style",/*tipStyle*/ctx[10]);}if(!current||dirty[0]&/*panelClass*/4&&div_class_value!==(div_class_value=arrayJoin(['PinturaPanel','pintura-editor-panel',/*panelClass*/ctx[2]]))){attr(div,"class",div_class_value);}if(!current||dirty[0]&/*style*/2048){attr(div,"style",/*style*/ctx[11]);}},i:function i(local){if(current)return;transition_in(details_slot,local);current=true;},o:function o(local){transition_out(details_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(details_slot)details_slot.d(detaching);/*div_binding*/ctx[41](null);mounted=false;run_all(dispose);}};}function create_fragment$E(ctx){var t0;var current_block_type_index;var if_block0;var t1;var t2;var if_block2_anchor;var current;var mounted;var dispose;var if_block_creators=[create_if_block_2$a,create_else_block$5];var if_blocks=[];function select_block_type(ctx,dirty){if(/*buttonLabel*/ctx[1])return 0;return 1;}current_block_type_index=select_block_type(ctx);if_block0=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);var if_block1=/*isVisible*/ctx[6]&&create_if_block_1$b(ctx);var if_block2=false;return{c:function c(){t0=space();if_block0.c();t1=space();if(if_block1)if_block1.c();t2=space();if_block2_anchor=empty();},m:function m(target,anchor){insert(target,t0,anchor);if_blocks[current_block_type_index].m(target,anchor);insert(target,t1,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,t2,anchor);insert(target,if_block2_anchor,anchor);current=true;if(!mounted){dispose=[listen(document.body,"pointerdown",function(){if(is_function(/*handleDown*/ctx[9]))/*handleDown*/ctx[9].apply(this,arguments);}),listen(document.body,"pointerup",function(){if(is_function(/*handleUp*/ctx[8]))/*handleUp*/ctx[8].apply(this,arguments);})];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block0=if_blocks[current_block_type_index];if(!if_block0){if_block0=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block0.c();}else{if_block0.p(ctx,dirty);}transition_in(if_block0,1);if_block0.m(t1.parentNode,t1);}if(/*isVisible*/ctx[6]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[0]&/*isVisible*/64){transition_in(if_block1,1);}}else{if_block1=create_if_block_1$b(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(t2.parentNode,t2);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);transition_in(if_block2);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);transition_out(if_block2);current=false;},d:function d(detaching){if(detaching)detach(t0);if_blocks[current_block_type_index].d(detaching);if(detaching)detach(t1);if(if_block1)if_block1.d(detaching);if(detaching)detach(t2);if(detaching)detach(if_block2_anchor);mounted=false;run_all(dispose);}};}var panelMargin=12;function instance$F($$self,$$props,$$invalidate){var buttonElement;var offsetProgress;var isVisible;var isAnimating;var transform;var style;var tipScale;var tipOpacity;var tipStyle;var handleDown;var handleUp;var buttonProps;var $portal;var $position;var $opacity;var $offset;var $portalRootRect;var $isAnimated;var _$$props$$$slots9=$$props.$$slots,slots=_$$props$$$slots9===void 0?{}:_$$props$$$slots9,$$scope=$$props.$$scope;var _$$props$buttonClass=$$props.buttonClass,buttonClass=_$$props$buttonClass===void 0?undefined:_$$props$buttonClass;var _$$props$buttonLabel=$$props.buttonLabel,buttonLabel=_$$props$buttonLabel===void 0?undefined:_$$props$buttonLabel;var _$$props$panelClass2=$$props.panelClass,panelClass=_$$props$panelClass2===void 0?undefined:_$$props$panelClass2;var _$$props$isActive2=$$props.isActive,isActive=_$$props$isActive2===void 0?false:_$$props$isActive2;var _$$props$onshow=$$props.onshow,onshow=_$$props$onshow===void 0?function(_ref177){var panel=_ref177.panel;return focus(panel,{preventScroll:true});}:_$$props$onshow;var _$$props$onhide=$$props.onhide,onhide=_$$props$onhide===void 0?noop$1:_$$props$onhide;var isAnimated=getContext('isAnimated');component_subscribe($$self,isAnimated,function(value){return $$invalidate(37,$isAnimated=value);});var portal=getContext('rootPortal');component_subscribe($$self,portal,function(value){return $$invalidate(32,$portal=value);});var portalRootRect=getContext('rootRect');component_subscribe($$self,portalRootRect,function(value){return $$invalidate(36,$portalRootRect=value);});var panelSize;var buttonComponent;var buttonRect;var syncButtonRect=function syncButtonRect(){return $$invalidate(22,buttonRect=buttonElement&&buttonElement.getBoundingClientRect());};var dir=vectorCreateEmpty();var opacity=spring(0);component_subscribe($$self,opacity,function(value){return $$invalidate(34,$opacity=value);});var shift=vectorCreateEmpty();var position=writable({x:0,y:0});component_subscribe($$self,position,function(value){return $$invalidate(33,$position=value);});var offset=spring(-5,{stiffness:0.1,damping:0.35,precision:0.001});component_subscribe($$self,offset,function(value){return $$invalidate(35,$offset=value);});var isTargetSelf=function isTargetSelf(e){return isEventTarget(e,$portal)||buttonComponent.isEventTarget(e);};var downOutsidePanel=false;// move detail panel to portal
var detailPanel;var trigger;// test keydown press to open
var handleClick=function handleClick(e){if(!isActive)syncButtonRect();$$invalidate(26,trigger=e);$$invalidate(0,isActive=!isActive);};var handleButtonKeydown=function handleButtonKeydown(e){if(!/down/i.test(e.key))return;$$invalidate(0,isActive=true);$$invalidate(26,trigger=e);};var handlePanelKeydown=function handlePanelKeydown(e){if(!/esc/i.test(e.key))return;$$invalidate(0,isActive=false);buttonElement.focus();};// clean up panel if it was appended to a portal
onDestroy(function(){// no panel or portal, exit
if(!$portal)return;if(!detailPanel)return;// store a ref
var detailPanelRef=detailPanel;// clean up "manually" if svelte failed to detach, this sometimes happens if parent element is removed from DOM
tick$1().then(function(){if(!detailPanelRef.parentNode)return;detailPanelRef.remove();});});function button_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){buttonComponent=$$value;$$invalidate(4,buttonComponent);});}function button_binding_1($$value){binding_callbacks[$$value?'unshift':'push'](function(){buttonComponent=$$value;$$invalidate(4,buttonComponent);});}function div_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){detailPanel=$$value;$$invalidate(5,detailPanel);});}var close_handler=function close_handler(e){e.stopPropagation();$$invalidate(0,isActive=false);};var measure_handler=function measure_handler(e){return $$invalidate(3,panelSize=sizeCreateFromAny(e.detail));};$$self.$$set=function($$props){if('buttonClass'in $$props)$$invalidate(19,buttonClass=$$props.buttonClass);if('buttonLabel'in $$props)$$invalidate(1,buttonLabel=$$props.buttonLabel);if('panelClass'in $$props)$$invalidate(2,panelClass=$$props.panelClass);if('isActive'in $$props)$$invalidate(0,isActive=$$props.isActive);if('onshow'in $$props)$$invalidate(20,onshow=$$props.onshow);if('onhide'in $$props)$$invalidate(21,onhide=$$props.onhide);if('$$scope'in $$props)$$invalidate(44,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*buttonComponent*/16){buttonElement=buttonComponent&&buttonComponent.getElement();}if($$self.$$.dirty[0]&/*isActive, downOutsidePanel*/33554433){$$invalidate(8,handleUp=isActive?function(e){if(!downOutsidePanel)return;$$invalidate(25,downOutsidePanel=false);if(isTargetSelf(e))return;$$invalidate(0,isActive=false);}:undefined);}if($$self.$$.dirty[0]&/*isActive*/1|$$self.$$.dirty[1]&/*$isAnimated*/64){opacity.set(isActive?1:0,{hard:$isAnimated===false});}if($$self.$$.dirty[0]&/*isActive*/1|$$self.$$.dirty[1]&/*$isAnimated*/64){offset.set(isActive?0:-5,{hard:$isAnimated===false});}if($$self.$$.dirty[1]&/*$offset*/16){$$invalidate(29,offsetProgress=1-$offset/-5);}if($$self.$$.dirty[0]&/*isActive*/1|$$self.$$.dirty[1]&/*$portalRootRect*/32){if($portalRootRect&&isActive)syncButtonRect();}if($$self.$$.dirty[0]&/*panelSize, buttonRect, isActive*/4194313|$$self.$$.dirty[1]&/*$portalRootRect*/32){if($portalRootRect&&panelSize&&buttonRect&&isActive){// as a starting point we'll align panel to center of button and position below
var _x91=buttonRect.x-$portalRootRect.x+buttonRect.width*0.5-panelSize.width*0.5;var _y2=buttonRect.y-$portalRootRect.y+buttonRect.height;var parentLeft=panelMargin;var parentTop=panelMargin;var parentRight=$portalRootRect.width-panelMargin;var parentBottom=$portalRootRect.height-panelMargin;var panelLeft=_x91;var panelTop=_y2;var panelRight=panelLeft+panelSize.width;var panelBottom=panelTop+panelSize.height;// move to right
if(panelLeft<parentLeft){$$invalidate(24,shift.x=panelLeft-parentLeft,shift);_x91=parentLeft;}// move to left
if(panelRight>parentRight){$$invalidate(24,shift.x=panelRight-parentRight,shift);_x91=parentRight-panelSize.width;}if(panelBottom>parentBottom){// doesn't fit vertically, push up
$$invalidate(23,dir.y=-1,dir);var positionedAboveButtonY=_y2-panelSize.height-buttonRect.height;var panelFitsAboveButton=parentTop<positionedAboveButtonY;if(panelFitsAboveButton){$$invalidate(24,shift.y=0,shift);_y2-=panelSize.height+buttonRect.height;}else{// overlap with button
$$invalidate(24,shift.y=_y2-(panelBottom-parentBottom),shift);_y2-=panelBottom-parentBottom;}}else{// all is fine
$$invalidate(23,dir.y=1,dir);}set_store_value(position,$position=vectorApply(vectorCreate(_x91,_y2),snapToPixel),$position);}}if($$self.$$.dirty[1]&/*$opacity*/8){$$invalidate(6,isVisible=$opacity>0);}if($$self.$$.dirty[1]&/*$opacity*/8){$$invalidate(31,isAnimating=$opacity<1);}if($$self.$$.dirty[0]&/*dir*/8388608|$$self.$$.dirty[1]&/*$position, $offset*/20){$$invalidate(30,transform="translateX(".concat(Math.round($position.x)+dir.x*panelMargin,"px) translateY(").concat(Math.round($position.y)+dir.y*panelMargin+dir.y*$offset,"px)"));}if($$self.$$.dirty[0]&/*transform*/1073741824|$$self.$$.dirty[1]&/*isAnimating, $opacity*/9){$$invalidate(11,style=isAnimating?"opacity: ".concat($opacity,"; pointer-events: ").concat($opacity<1?'none':'all',"; transform: ").concat(transform,";"):"transform: ".concat(transform));}if($$self.$$.dirty[0]&/*offsetProgress*/536870912){$$invalidate(27,tipScale=0.5+offsetProgress*0.5);}if($$self.$$.dirty[0]&/*offsetProgress*/536870912){$$invalidate(28,tipOpacity=offsetProgress);}if($$self.$$.dirty[0]&/*panelSize, tipOpacity, tipScale, dir, shift*/427819016|$$self.$$.dirty[1]&/*$position*/4){$$invalidate(10,tipStyle=$position&&panelSize&&"opacity:".concat(tipOpacity,";transform:scaleX(").concat(tipScale,")rotate(45deg);top:").concat(dir.y<0?shift.y+panelSize.height:0,"px;left:").concat(shift.x+panelSize.width*0.5,"px"));}if($$self.$$.dirty[0]&/*isActive*/1){$$invalidate(9,handleDown=isActive?function(e){if(isTargetSelf(e))return;$$invalidate(25,downOutsidePanel=true);}:undefined);}if($$self.$$.dirty[0]&/*isVisible, detailPanel*/96|$$self.$$.dirty[1]&/*$portal*/2){if(isVisible&&$portal&&detailPanel&&detailPanel.parentNode!==$portal)$portal.append(detailPanel);}if($$self.$$.dirty[0]&/*isActive*/1){if(!isActive){$$invalidate(26,trigger=undefined);}}if($$self.$$.dirty[0]&/*isActive, isVisible, detailPanel, onshow, trigger*/68157537){if(isActive&&isVisible&&detailPanel){onshow({e:trigger,panel:detailPanel});}}if($$self.$$.dirty[0]&/*isVisible, isActive, onhide*/2097217){if(isVisible&&!isActive){onhide();}}if($$self.$$.dirty[0]&/*buttonLabel, buttonClass*/524290){// calculate button props for both types of buttons
$$invalidate(7,buttonProps={label:buttonLabel,"class":arrayJoin(['PinturaPanelButton',buttonClass]),onkeydown:handleButtonKeydown,onclick:handleClick});}};return[isActive,buttonLabel,panelClass,panelSize,buttonComponent,detailPanel,isVisible,buttonProps,handleUp,handleDown,tipStyle,style,isAnimated,portal,portalRootRect,opacity,position,offset,handlePanelKeydown,buttonClass,onshow,onhide,buttonRect,dir,shift,downOutsidePanel,trigger,tipScale,tipOpacity,offsetProgress,transform,isAnimating,$portal,$position,$opacity,$offset,$portalRootRect,$isAnimated,slots,button_binding,button_binding_1,div_binding,close_handler,measure_handler,$$scope];}var Panel=/*#__PURE__*/function(_SvelteComponent13){_inherits(Panel,_SvelteComponent13);var _super14=_createSuper(Panel);function Panel(options){var _this15;_classCallCheck(this,Panel);_this15=_super14.call(this);init(_assertThisInitialized(_this15),options,instance$F,create_fragment$E,safe_not_equal,{buttonClass:19,buttonLabel:1,panelClass:2,isActive:0,onshow:20,onhide:21},null,[-1,-1]);return _this15;}return _createClass(Panel);}(SvelteComponent);var ArrowKeys={Up:38,Down:40,Left:37,Right:39};/* src/core/ui/components/RadioItem.svelte generated by Svelte v3.52.0 */function create_fragment$D(ctx){var li;var input;var t;var label_1;var li_class_value;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[15]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[14],null);return{c:function c(){li=element("li");input=element("input");t=space();label_1=element("label");if(default_slot)default_slot.c();attr(input,"type","radio");attr(input,"class","implicit");attr(input,"id",/*inputId*/ctx[7]);attr(input,"name",/*name*/ctx[0]);input.value=/*value*/ctx[3];input.disabled=/*disabled*/ctx[6];input.hidden=/*hidden*/ctx[5];input.checked=/*checked*/ctx[4];attr(label_1,"for",/*inputId*/ctx[7]);attr(label_1,"title",/*label*/ctx[2]);attr(li,"class",li_class_value=arrayJoin(['PinturaRadioGroupOption',/*klass*/ctx[1]]));attr(li,"data-hidden",/*hidden*/ctx[5]);attr(li,"data-disabled",/*disabled*/ctx[6]);attr(li,"data-selected",/*checked*/ctx[4]);},m:function m(target,anchor){insert(target,li,anchor);append(li,input);append(li,t);append(li,label_1);if(default_slot){default_slot.m(label_1,null);}current=true;if(!mounted){dispose=[listen(input,"change",stop_propagation(/*change_handler*/ctx[16])),listen(input,"keydown",/*handleKeydown*/ctx[9]),listen(input,"click",/*handleClick*/ctx[10])];mounted=true;}},p:function p(ctx,_ref178){var _ref179=_slicedToArray(_ref178,1),dirty=_ref179[0];if(!current||dirty&/*inputId*/128){attr(input,"id",/*inputId*/ctx[7]);}if(!current||dirty&/*name*/1){attr(input,"name",/*name*/ctx[0]);}if(!current||dirty&/*value*/8){input.value=/*value*/ctx[3];}if(!current||dirty&/*disabled*/64){input.disabled=/*disabled*/ctx[6];}if(!current||dirty&/*hidden*/32){input.hidden=/*hidden*/ctx[5];}if(!current||dirty&/*checked*/16){input.checked=/*checked*/ctx[4];}if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope*/16384)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[14],!current?get_all_dirty_from_scope(/*$$scope*/ctx[14]):get_slot_changes(default_slot_template,/*$$scope*/ctx[14],dirty,null),null);}}if(!current||dirty&/*inputId*/128){attr(label_1,"for",/*inputId*/ctx[7]);}if(!current||dirty&/*label*/4){attr(label_1,"title",/*label*/ctx[2]);}if(!current||dirty&/*klass*/2&&li_class_value!==(li_class_value=arrayJoin(['PinturaRadioGroupOption',/*klass*/ctx[1]]))){attr(li,"class",li_class_value);}if(!current||dirty&/*hidden*/32){attr(li,"data-hidden",/*hidden*/ctx[5]);}if(!current||dirty&/*disabled*/64){attr(li,"data-disabled",/*disabled*/ctx[6]);}if(!current||dirty&/*checked*/16){attr(li,"data-selected",/*checked*/ctx[4]);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(li);if(default_slot)default_slot.d(detaching);mounted=false;run_all(dispose);}};}function instance$E($$self,$$props,$$invalidate){var inputId;var $keysPressedStored;var _$$props$$$slots10=$$props.$$slots,slots=_$$props$$$slots10===void 0?{}:_$$props$$$slots10,$$scope=$$props.$$scope;var name=$$props.name;var _$$props$class9=$$props["class"],klass=_$$props$class9===void 0?undefined:_$$props$class9;var label=$$props.label;var id=$$props.id;var value=$$props.value;var checked=$$props.checked;var onkeydown=$$props.onkeydown;var onclick=$$props.onclick;var _$$props$hidden=$$props.hidden,hidden=_$$props$hidden===void 0?false:_$$props$hidden;var _$$props$disabled2=$$props.disabled,disabled=_$$props$disabled2===void 0?false:_$$props$disabled2;var ArrowKeyCodes=Object.values(ArrowKeys);var keysPressedStored=getContext('keysPressed');component_subscribe($$self,keysPressedStored,function(value){return $$invalidate(17,$keysPressedStored=value);});var handleKeydown=function handleKeydown(e){onkeydown(e);};var handleClick=function handleClick(e){// if pressed arrow key -> ignore so navigation with arrow keys works
if($keysPressedStored.some(function(key){return ArrowKeyCodes.includes(key);}))return;// just a normal click
onclick(e);};function change_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('name'in $$props)$$invalidate(0,name=$$props.name);if('class'in $$props)$$invalidate(1,klass=$$props["class"]);if('label'in $$props)$$invalidate(2,label=$$props.label);if('id'in $$props)$$invalidate(11,id=$$props.id);if('value'in $$props)$$invalidate(3,value=$$props.value);if('checked'in $$props)$$invalidate(4,checked=$$props.checked);if('onkeydown'in $$props)$$invalidate(12,onkeydown=$$props.onkeydown);if('onclick'in $$props)$$invalidate(13,onclick=$$props.onclick);if('hidden'in $$props)$$invalidate(5,hidden=$$props.hidden);if('disabled'in $$props)$$invalidate(6,disabled=$$props.disabled);if('$$scope'in $$props)$$invalidate(14,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty&/*name, id*/2049){$$invalidate(7,inputId="".concat(name,"-").concat(id));}};return[name,klass,label,value,checked,hidden,disabled,inputId,keysPressedStored,handleKeydown,handleClick,id,onkeydown,onclick,$$scope,slots,change_handler];}var RadioItem=/*#__PURE__*/function(_SvelteComponent14){_inherits(RadioItem,_SvelteComponent14);var _super15=_createSuper(RadioItem);function RadioItem(options){var _this16;_classCallCheck(this,RadioItem);_this16=_super15.call(this);init(_assertThisInitialized(_this16),options,instance$E,create_fragment$D,safe_not_equal,{name:0,"class":1,label:2,id:11,value:3,checked:4,onkeydown:12,onclick:13,hidden:5,disabled:6});return _this16;}return _createClass(RadioItem);}(SvelteComponent);var flattenOptions=function flattenOptions(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return options.reduce(function(prev,current){var isGroup=isArray(current)?isArray(current[1]):!!current.options;if(isGroup){return prev.concat(isArray(current)?current[1]:current.options);}prev.push(current);return prev;},[]);};var mapOption=function mapOption(option,index,optionMapper){var mappedOption;if(isArray(option)){mappedOption=_objectSpread({id:index,value:option[0],label:option[1]},option[2]||{});}else{mappedOption=option;mappedOption.id=mappedOption.id!=null?mappedOption.id:index;}return optionMapper?optionMapper(mappedOption):mappedOption;};var mapOptions=function mapOptions(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var optionMapper=arguments.length>1?arguments[1]:undefined;var index=0;return options.map(function(option){index++;if(isArray(option)){// is either [label, options] or [value, label]
if(isArray(option[1])){return{id:index,label:option[0],options:option[1].map(function(option){return mapOption(option,++index,optionMapper);})};}return mapOption(option,index,optionMapper);}else{// is either { id?, label, options } or { id?, value, label }
if(option.options){return{id:option.id||index,label:option.label,options:option.options.map(function(option){return mapOption(option,++index,optionMapper);})};}return mapOption(option,index,optionMapper);}});};var opop=function opop(fn){for(var _len6=arguments.length,args=new Array(_len6>1?_len6-1:0),_key9=1;_key9<_len6;_key9++){args[_key9-1]=arguments[_key9];}return fn&&fn.apply(void 0,args);};var localize=function localize(prop,locale,params){return isFunction(prop)?prop(locale,params):prop;};var localizeOptions=function localizeOptions(options,locale){return options.map(function(_ref180){var _ref181=_slicedToArray(_ref180,3),value=_ref181[0],label=_ref181[1],props=_ref181[2];if(isArray(label)){return[localize(value,locale),localizeOptions(label,locale)];}else{var res=[value,localize(label,locale)];if(props){var obj=_objectSpread({},props);if(props.icon)obj.icon=localize(props.icon,locale);res.push(obj);}return res;}});};var localizeOptions$1=function localizeOptions$1(options,locale){return localizeOptions(options,locale);};var isConfirmKey=function isConfirmKey(key){return /enter| /i.test(key);};var isDeepEqual=function isDeepEqual(a,b){if(Array.isArray(a)&&Array.isArray(b))return arrayEqual(a,b);return a===b;};/* src/core/ui/components/RadioGroup.svelte generated by Svelte v3.52.0 */function get_each_context$7(ctx,list,i){var child_ctx=ctx.slice();child_ctx[27]=list[i];return child_ctx;}var get_option_slot_changes_1=function get_option_slot_changes_1(dirty){return{option:dirty[0]&/*mappedOptions*/1024};};var get_option_slot_context_1=function get_option_slot_context_1(ctx){return{option:/*option*/ctx[27]};};function get_each_context_1(ctx,list,i){var child_ctx=ctx.slice();child_ctx[27]=list[i];return child_ctx;}var get_option_slot_changes=function get_option_slot_changes(dirty){return{option:dirty[0]&/*mappedOptions*/1024};};var get_option_slot_context=function get_option_slot_context(ctx){return{option:/*option*/ctx[27]};};var get_group_slot_changes=function get_group_slot_changes(dirty){return{option:dirty[0]&/*mappedOptions*/1024};};var get_group_slot_context=function get_group_slot_context(ctx){return{option:/*option*/ctx[27]};};// (78:0) {#if localizedOptions.length}
function create_if_block_1$a(ctx){var fieldset;var t;var ul;var each_blocks=[];var each_1_lookup=new Map();var fieldset_class_value;var current;var if_block=/*label*/ctx[1]&&create_if_block_7$1(ctx);var each_value=/*mappedOptions*/ctx[10];var get_key=function get_key(ctx){return(/*option*/ctx[27].id);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$7(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$7(key,child_ctx));}return{c:function c(){fieldset=element("fieldset");if(if_block)if_block.c();t=space();ul=element("ul");for(var _i12=0;_i12<each_blocks.length;_i12+=1){each_blocks[_i12].c();}attr(ul,"class","PinturaRadioGroupOptions");attr(fieldset,"class",fieldset_class_value=arrayJoin(['PinturaRadioGroup',/*klass*/ctx[3]]));attr(fieldset,"data-layout",/*layout*/ctx[5]);attr(fieldset,"title",/*title*/ctx[7]);},m:function m(target,anchor){insert(target,fieldset,anchor);if(if_block)if_block.m(fieldset,null);append(fieldset,t);append(fieldset,ul);for(var _i13=0;_i13<each_blocks.length;_i13+=1){each_blocks[_i13].m(ul,null);}current=true;},p:function p(ctx,dirty){if(/*label*/ctx[1]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block_7$1(ctx);if_block.c();if_block.m(fieldset,t);}}else if(if_block){if_block.d(1);if_block=null;}if(dirty[0]&/*optionGroupClass, mappedOptions, name, optionClass, getOptionIndex, selectedIndex, handleRadioKeydown, handleRadioClick, optionLabelClass, $$scope*/8419153){each_value=/*mappedOptions*/ctx[10];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value,each_1_lookup,ul,outro_and_destroy_block,create_each_block$7,null,get_each_context$7);check_outros();}if(!current||dirty[0]&/*klass*/8&&fieldset_class_value!==(fieldset_class_value=arrayJoin(['PinturaRadioGroup',/*klass*/ctx[3]]))){attr(fieldset,"class",fieldset_class_value);}if(!current||dirty[0]&/*layout*/32){attr(fieldset,"data-layout",/*layout*/ctx[5]);}if(!current||dirty[0]&/*title*/128){attr(fieldset,"title",/*title*/ctx[7]);}},i:function i(local){if(current)return;for(var _i14=0;_i14<each_value.length;_i14+=1){transition_in(each_blocks[_i14]);}current=true;},o:function o(local){for(var _i15=0;_i15<each_blocks.length;_i15+=1){transition_out(each_blocks[_i15]);}current=false;},d:function d(detaching){if(detaching)detach(fieldset);if(if_block)if_block.d();for(var _i16=0;_i16<each_blocks.length;_i16+=1){each_blocks[_i16].d();}}};}// (80:8) {#if label}
function create_if_block_7$1(ctx){var legend;var t;var legend_class_value;return{c:function c(){legend=element("legend");t=text(/*label*/ctx[1]);attr(legend,"class",legend_class_value=/*hideLabel*/ctx[2]&&'implicit');},m:function m(target,anchor){insert(target,legend,anchor);append(legend,t);},p:function p(ctx,dirty){if(dirty[0]&/*label*/2)set_data(t,/*label*/ctx[1]);if(dirty[0]&/*hideLabel*/4&&legend_class_value!==(legend_class_value=/*hideLabel*/ctx[2]&&'implicit')){attr(legend,"class",legend_class_value);}},d:function d(detaching){if(detaching)detach(legend);}};}// (116:16) {:else}
function create_else_block$4(ctx){var radioitem;var current;radioitem=new RadioItem({props:{name:/*name*/ctx[4],label:/*option*/ctx[27].label,id:/*option*/ctx[27].id,value:/*option*/ctx[27].value,disabled:/*option*/ctx[27].disabled,hidden:/*option*/ctx[27].hidden,"class":/*optionClass*/ctx[8],checked:/*getOptionIndex*/ctx[12](/*option*/ctx[27])===/*selectedIndex*/ctx[0],onkeydown:/*handleRadioKeydown*/ctx[13](/*option*/ctx[27]),onclick:/*handleRadioClick*/ctx[14](/*option*/ctx[27]),$$slots:{"default":[create_default_slot_2$4]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(radioitem.$$.fragment);},m:function m(target,anchor){mount_component(radioitem,target,anchor);current=true;},p:function p(ctx,dirty){var radioitem_changes={};if(dirty[0]&/*name*/16)radioitem_changes.name=/*name*/ctx[4];if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.label=/*option*/ctx[27].label;if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.id=/*option*/ctx[27].id;if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.value=/*option*/ctx[27].value;if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.disabled=/*option*/ctx[27].disabled;if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.hidden=/*option*/ctx[27].hidden;if(dirty[0]&/*optionClass*/256)radioitem_changes["class"]=/*optionClass*/ctx[8];if(dirty[0]&/*mappedOptions, selectedIndex*/1025)radioitem_changes.checked=/*getOptionIndex*/ctx[12](/*option*/ctx[27])===/*selectedIndex*/ctx[0];if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.onkeydown=/*handleRadioKeydown*/ctx[13](/*option*/ctx[27]);if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.onclick=/*handleRadioClick*/ctx[14](/*option*/ctx[27]);if(dirty[0]&/*$$scope, optionLabelClass, mappedOptions*/8389696){radioitem_changes.$$scope={dirty:dirty,ctx:ctx};}radioitem.$set(radioitem_changes);},i:function i(local){if(current)return;transition_in(radioitem.$$.fragment,local);current=true;},o:function o(local){transition_out(radioitem.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radioitem,detaching);}};}// (85:16) {#if option.options}
function create_if_block_2$9(ctx){var li;var t0;var ul;var each_blocks=[];var each_1_lookup=new Map();var t1;var li_class_value;var current;var group_slot_template=/*#slots*/ctx[22].group;var group_slot=create_slot(group_slot_template,ctx,/*$$scope*/ctx[23],get_group_slot_context);var group_slot_or_fallback=group_slot||fallback_block_1(ctx);var each_value_1=/*option*/ctx[27].options;var get_key=function get_key(ctx){return(/*option*/ctx[27].id);};for(var i=0;i<each_value_1.length;i+=1){var child_ctx=get_each_context_1(ctx,each_value_1,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block_1(key,child_ctx));}return{c:function c(){li=element("li");if(group_slot_or_fallback)group_slot_or_fallback.c();t0=space();ul=element("ul");for(var _i17=0;_i17<each_blocks.length;_i17+=1){each_blocks[_i17].c();}t1=space();attr(ul,"class","PinturaRadioGroupOptions");attr(li,"class",li_class_value=arrayJoin(['PinturaRadioGroupOptionGroup',/*optionGroupClass*/ctx[9]]));},m:function m(target,anchor){insert(target,li,anchor);if(group_slot_or_fallback){group_slot_or_fallback.m(li,null);}append(li,t0);append(li,ul);for(var _i18=0;_i18<each_blocks.length;_i18+=1){each_blocks[_i18].m(ul,null);}append(li,t1);current=true;},p:function p(ctx,dirty){if(group_slot){if(group_slot.p&&(!current||dirty[0]&/*$$scope, mappedOptions*/8389632)){update_slot_base(group_slot,group_slot_template,ctx,/*$$scope*/ctx[23],!current?get_all_dirty_from_scope(/*$$scope*/ctx[23]):get_slot_changes(group_slot_template,/*$$scope*/ctx[23],dirty,get_group_slot_changes),get_group_slot_context);}}else{if(group_slot_or_fallback&&group_slot_or_fallback.p&&(!current||dirty[0]&/*mappedOptions*/1024)){group_slot_or_fallback.p(ctx,!current?[-1,-1]:dirty);}}if(dirty[0]&/*name, mappedOptions, optionClass, getOptionIndex, selectedIndex, handleRadioKeydown, handleRadioClick, optionLabelClass, $$scope*/8418641){each_value_1=/*option*/ctx[27].options;group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value_1,each_1_lookup,ul,outro_and_destroy_block,create_each_block_1,null,get_each_context_1);check_outros();}if(!current||dirty[0]&/*optionGroupClass*/512&&li_class_value!==(li_class_value=arrayJoin(['PinturaRadioGroupOptionGroup',/*optionGroupClass*/ctx[9]]))){attr(li,"class",li_class_value);}},i:function i(local){if(current)return;transition_in(group_slot_or_fallback,local);for(var _i19=0;_i19<each_value_1.length;_i19+=1){transition_in(each_blocks[_i19]);}current=true;},o:function o(local){transition_out(group_slot_or_fallback,local);for(var _i20=0;_i20<each_blocks.length;_i20+=1){transition_out(each_blocks[_i20]);}current=false;},d:function d(detaching){if(detaching)detach(li);if(group_slot_or_fallback)group_slot_or_fallback.d(detaching);for(var _i21=0;_i21<each_blocks.length;_i21+=1){each_blocks[_i21].d();}}};}// (129:28) {#if option.icon}
function create_if_block_6$2(ctx){var icon;var current;icon=new Icon({props:{$$slots:{"default":[create_default_slot_3$2]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);},m:function m(target,anchor){mount_component(icon,target,anchor);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty[0]&/*$$scope, mappedOptions*/8389632){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);}};}// (130:32) <Icon>
function create_default_slot_3$2(ctx){var g;var raw_value=/*option*/ctx[27].icon+"";return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[0]&/*mappedOptions*/1024&&raw_value!==(raw_value=/*option*/ctx[27].icon+""))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (132:28) {#if !option.hideLabel}
function create_if_block_5$4(ctx){var span;var t_value=/*option*/ctx[27].label+"";var t;return{c:function c(){span=element("span");t=text(t_value);attr(span,"class",/*optionLabelClass*/ctx[6]);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[0]&/*mappedOptions*/1024&&t_value!==(t_value=/*option*/ctx[27].label+""))set_data(t,t_value);if(dirty[0]&/*optionLabelClass*/64){attr(span,"class",/*optionLabelClass*/ctx[6]);}},d:function d(detaching){if(detaching)detach(span);}};}// (128:54)                              
function fallback_block_2(ctx){var t0;var t1;var current;var if_block0=/*option*/ctx[27].icon&&create_if_block_6$2(ctx);var if_block1=!/*option*/ctx[27].hideLabel&&create_if_block_5$4(ctx);return{c:function c(){if(if_block0)if_block0.c();t0=space();if(if_block1)if_block1.c();t1=space();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t0,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,t1,anchor);current=true;},p:function p(ctx,dirty){if(/*option*/ctx[27].icon){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*mappedOptions*/1024){transition_in(if_block0,1);}}else{if_block0=create_if_block_6$2(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t0.parentNode,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(!/*option*/ctx[27].hideLabel){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block_5$4(ctx);if_block1.c();if_block1.m(t1.parentNode,t1);}}else if(if_block1){if_block1.d(1);if_block1=null;}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t0);if(if_block1)if_block1.d(detaching);if(detaching)detach(t1);}};}// (117:20) <RadioItem                         {name}                         label={option.label}                         id={option.id}                         value={option.value}                         disabled={option.disabled}                         hidden={option.hidden}                         class={optionClass}                         checked={getOptionIndex(option) === selectedIndex}                         onkeydown={handleRadioKeydown(option)}                         onclick={handleRadioClick(option)}                         >
function create_default_slot_2$4(ctx){var current;var option_slot_template=/*#slots*/ctx[22].option;var option_slot=create_slot(option_slot_template,ctx,/*$$scope*/ctx[23],get_option_slot_context_1);var option_slot_or_fallback=option_slot||fallback_block_2(ctx);return{c:function c(){if(option_slot_or_fallback)option_slot_or_fallback.c();},m:function m(target,anchor){if(option_slot_or_fallback){option_slot_or_fallback.m(target,anchor);}current=true;},p:function p(ctx,dirty){if(option_slot){if(option_slot.p&&(!current||dirty[0]&/*$$scope, mappedOptions*/8389632)){update_slot_base(option_slot,option_slot_template,ctx,/*$$scope*/ctx[23],!current?get_all_dirty_from_scope(/*$$scope*/ctx[23]):get_slot_changes(option_slot_template,/*$$scope*/ctx[23],dirty,get_option_slot_changes_1),get_option_slot_context_1);}}else{if(option_slot_or_fallback&&option_slot_or_fallback.p&&(!current||dirty[0]&/*optionLabelClass, mappedOptions*/1088)){option_slot_or_fallback.p(ctx,!current?[-1,-1]:dirty);}}},i:function i(local){if(current)return;transition_in(option_slot_or_fallback,local);current=true;},o:function o(local){transition_out(option_slot_or_fallback,local);current=false;},d:function d(detaching){if(option_slot_or_fallback)option_slot_or_fallback.d(detaching);}};}// (88:29) <span class="PinturaRadioGroupOptionGroupLabel">
function fallback_block_1(ctx){var span;var t_value=/*option*/ctx[27].label+"";var t;return{c:function c(){span=element("span");t=text(t_value);attr(span,"class","PinturaRadioGroupOptionGroupLabel");},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[0]&/*mappedOptions*/1024&&t_value!==(t_value=/*option*/ctx[27].label+""))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (105:40) {#if option.icon}
function create_if_block_4$6(ctx){var icon;var current;icon=new Icon({props:{$$slots:{"default":[create_default_slot_1$6]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);},m:function m(target,anchor){mount_component(icon,target,anchor);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty[0]&/*$$scope, mappedOptions*/8389632){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);}};}// (106:44) <Icon>
function create_default_slot_1$6(ctx){var g;var raw_value=/*option*/ctx[27].icon+"";return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[0]&/*mappedOptions*/1024&&raw_value!==(raw_value=/*option*/ctx[27].icon+""))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (108:40) {#if !option.hideLabel}
function create_if_block_3$7(ctx){var span;var t_value=/*option*/ctx[27].label+"";var t;return{c:function c(){span=element("span");t=text(t_value);attr(span,"class",/*optionLabelClass*/ctx[6]);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[0]&/*mappedOptions*/1024&&t_value!==(t_value=/*option*/ctx[27].label+""))set_data(t,t_value);if(dirty[0]&/*optionLabelClass*/64){attr(span,"class",/*optionLabelClass*/ctx[6]);}},d:function d(detaching){if(detaching)detach(span);}};}// (104:66)                                          
function fallback_block$1(ctx){var t0;var t1;var current;var if_block0=/*option*/ctx[27].icon&&create_if_block_4$6(ctx);var if_block1=!/*option*/ctx[27].hideLabel&&create_if_block_3$7(ctx);return{c:function c(){if(if_block0)if_block0.c();t0=space();if(if_block1)if_block1.c();t1=space();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t0,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,t1,anchor);current=true;},p:function p(ctx,dirty){if(/*option*/ctx[27].icon){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*mappedOptions*/1024){transition_in(if_block0,1);}}else{if_block0=create_if_block_4$6(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t0.parentNode,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(!/*option*/ctx[27].hideLabel){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block_3$7(ctx);if_block1.c();if_block1.m(t1.parentNode,t1);}}else if(if_block1){if_block1.d(1);if_block1=null;}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t0);if(if_block1)if_block1.d(detaching);if(detaching)detach(t1);}};}// (93:32) <RadioItem                                     {name}                                     label={option.label}                                     id={option.id}                                     value={option.value}                                     disabled={option.disabled}                                     hidden={option.hidden}                                     class={optionClass}                                     checked={getOptionIndex(option) === selectedIndex}                                     onkeydown={handleRadioKeydown(option)}                                     onclick={handleRadioClick(option)}                                     >
function create_default_slot$f(ctx){var current;var option_slot_template=/*#slots*/ctx[22].option;var option_slot=create_slot(option_slot_template,ctx,/*$$scope*/ctx[23],get_option_slot_context);var option_slot_or_fallback=option_slot||fallback_block$1(ctx);return{c:function c(){if(option_slot_or_fallback)option_slot_or_fallback.c();},m:function m(target,anchor){if(option_slot_or_fallback){option_slot_or_fallback.m(target,anchor);}current=true;},p:function p(ctx,dirty){if(option_slot){if(option_slot.p&&(!current||dirty[0]&/*$$scope, mappedOptions*/8389632)){update_slot_base(option_slot,option_slot_template,ctx,/*$$scope*/ctx[23],!current?get_all_dirty_from_scope(/*$$scope*/ctx[23]):get_slot_changes(option_slot_template,/*$$scope*/ctx[23],dirty,get_option_slot_changes),get_option_slot_context);}}else{if(option_slot_or_fallback&&option_slot_or_fallback.p&&(!current||dirty[0]&/*optionLabelClass, mappedOptions*/1088)){option_slot_or_fallback.p(ctx,!current?[-1,-1]:dirty);}}},i:function i(local){if(current)return;transition_in(option_slot_or_fallback,local);current=true;},o:function o(local){transition_out(option_slot_or_fallback,local);current=false;},d:function d(detaching){if(option_slot_or_fallback)option_slot_or_fallback.d(detaching);}};}// (92:28) {#each option.options as option (option.id)}
function create_each_block_1(key_1,ctx){var first;var radioitem;var current;radioitem=new RadioItem({props:{name:/*name*/ctx[4],label:/*option*/ctx[27].label,id:/*option*/ctx[27].id,value:/*option*/ctx[27].value,disabled:/*option*/ctx[27].disabled,hidden:/*option*/ctx[27].hidden,"class":/*optionClass*/ctx[8],checked:/*getOptionIndex*/ctx[12](/*option*/ctx[27])===/*selectedIndex*/ctx[0],onkeydown:/*handleRadioKeydown*/ctx[13](/*option*/ctx[27]),onclick:/*handleRadioClick*/ctx[14](/*option*/ctx[27]),$$slots:{"default":[create_default_slot$f]},$$scope:{ctx:ctx}}});return{key:key_1,first:null,c:function c(){first=empty();create_component(radioitem.$$.fragment);this.first=first;},m:function m(target,anchor){insert(target,first,anchor);mount_component(radioitem,target,anchor);current=true;},p:function p(new_ctx,dirty){ctx=new_ctx;var radioitem_changes={};if(dirty[0]&/*name*/16)radioitem_changes.name=/*name*/ctx[4];if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.label=/*option*/ctx[27].label;if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.id=/*option*/ctx[27].id;if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.value=/*option*/ctx[27].value;if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.disabled=/*option*/ctx[27].disabled;if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.hidden=/*option*/ctx[27].hidden;if(dirty[0]&/*optionClass*/256)radioitem_changes["class"]=/*optionClass*/ctx[8];if(dirty[0]&/*mappedOptions, selectedIndex*/1025)radioitem_changes.checked=/*getOptionIndex*/ctx[12](/*option*/ctx[27])===/*selectedIndex*/ctx[0];if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.onkeydown=/*handleRadioKeydown*/ctx[13](/*option*/ctx[27]);if(dirty[0]&/*mappedOptions*/1024)radioitem_changes.onclick=/*handleRadioClick*/ctx[14](/*option*/ctx[27]);if(dirty[0]&/*$$scope, optionLabelClass, mappedOptions*/8389696){radioitem_changes.$$scope={dirty:dirty,ctx:ctx};}radioitem.$set(radioitem_changes);},i:function i(local){if(current)return;transition_in(radioitem.$$.fragment,local);current=true;},o:function o(local){transition_out(radioitem.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(first);destroy_component(radioitem,detaching);}};}// (84:12) {#each mappedOptions as option (option.id)}
function create_each_block$7(key_1,ctx){var first;var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block_2$9,create_else_block$4];var if_blocks=[];function select_block_type(ctx,dirty){if(/*option*/ctx[27].options)return 0;return 1;}current_block_type_index=select_block_type(ctx);if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);return{key:key_1,first:null,c:function c(){first=empty();if_block.c();if_block_anchor=empty();this.first=first;},m:function m(target,anchor){insert(target,first,anchor);if_blocks[current_block_type_index].m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(new_ctx,dirty){ctx=new_ctx;var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(first);if_blocks[current_block_type_index].d(detaching);if(detaching)detach(if_block_anchor);}};}function create_fragment$C(ctx){var t;var if_block1_anchor;var current;var if_block0=/*localizedOptions*/ctx[11].length&&create_if_block_1$a(ctx);var if_block1=false;return{c:function c(){if(if_block0)if_block0.c();t=space();if_block1_anchor=empty();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t,anchor);insert(target,if_block1_anchor,anchor);current=true;},p:function p(ctx,dirty){if(/*localizedOptions*/ctx[11].length){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*localizedOptions*/2048){transition_in(if_block0,1);}}else{if_block0=create_if_block_1$a(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t.parentNode,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t);if(detaching)detach(if_block1_anchor);}};}function instance$D($$self,$$props,$$invalidate){var localizedOptions;var mappedOptions;var flattenedOptions;var _$$props$$$slots11=$$props.$$slots,slots=_$$props$$$slots11===void 0?{}:_$$props$$$slots11,$$scope=$$props.$$scope;var dispatch=createEventDispatcher();var _$$props$label2=$$props.label,label=_$$props$label2===void 0?undefined:_$$props$label2;var _$$props$hideLabel2=$$props.hideLabel,hideLabel=_$$props$hideLabel2===void 0?true:_$$props$hideLabel2;var _$$props$class10=$$props["class"],klass=_$$props$class10===void 0?undefined:_$$props$class10;var _$$props$name2=$$props.name,name=_$$props$name2===void 0?"radio-group-".concat(getUniqueId()):_$$props$name2;var _$$props$selectedInde=$$props.selectedIndex,selectedIndex=_$$props$selectedInde===void 0?-1:_$$props$selectedInde;var _$$props$options=$$props.options,options=_$$props$options===void 0?[]:_$$props$options;var _$$props$onchange2=$$props.onchange,onchange=_$$props$onchange2===void 0?undefined:_$$props$onchange2;var _$$props$layout2=$$props.layout,layout=_$$props$layout2===void 0?undefined:_$$props$layout2;var _$$props$optionMapper=$$props.optionMapper,optionMapper=_$$props$optionMapper===void 0?undefined:_$$props$optionMapper;var _$$props$optionFilter=$$props.optionFilter,optionFilter=_$$props$optionFilter===void 0?undefined:_$$props$optionFilter;var _$$props$value2=$$props.value,value=_$$props$value2===void 0?undefined:_$$props$value2;var _$$props$optionLabelC=$$props.optionLabelClass,optionLabelClass=_$$props$optionLabelC===void 0?undefined:_$$props$optionLabelC;var _$$props$title=$$props.title,title=_$$props$title===void 0?undefined:_$$props$title;var _$$props$locale=$$props.locale,locale=_$$props$locale===void 0?undefined:_$$props$locale;var _$$props$optionClass=$$props.optionClass,optionClass=_$$props$optionClass===void 0?undefined:_$$props$optionClass;var _$$props$optionGroupC=$$props.optionGroupClass,optionGroupClass=_$$props$optionGroupC===void 0?undefined:_$$props$optionGroupC;var getUndefinedOptionIndex=function getUndefinedOptionIndex(options){return options.findIndex(function(option){return option[0]===undefined;});};var getOptionIndex=function getOptionIndex(option){return flattenedOptions.findIndex(function(flattenedOption){return flattenedOption.id===option.id;});};var changeSelection=function changeSelection(option,e){$$invalidate(0,selectedIndex=getOptionIndex(option));var payload=_objectSpread({index:selectedIndex},option);opop(onchange,payload,e);dispatch('change',payload);};var handleRadioKeydown=function handleRadioKeydown(option){return function(e){// is confirm key ([enter] or [space])
if(!isConfirmKey(e.key))return;changeSelection(option,e);};};var handleRadioClick=function handleRadioClick(option){return function(e){changeSelection(option,e);};};$$self.$$set=function($$props){if('label'in $$props)$$invalidate(1,label=$$props.label);if('hideLabel'in $$props)$$invalidate(2,hideLabel=$$props.hideLabel);if('class'in $$props)$$invalidate(3,klass=$$props["class"]);if('name'in $$props)$$invalidate(4,name=$$props.name);if('selectedIndex'in $$props)$$invalidate(0,selectedIndex=$$props.selectedIndex);if('options'in $$props)$$invalidate(15,options=$$props.options);if('onchange'in $$props)$$invalidate(16,onchange=$$props.onchange);if('layout'in $$props)$$invalidate(5,layout=$$props.layout);if('optionMapper'in $$props)$$invalidate(17,optionMapper=$$props.optionMapper);if('optionFilter'in $$props)$$invalidate(18,optionFilter=$$props.optionFilter);if('value'in $$props)$$invalidate(19,value=$$props.value);if('optionLabelClass'in $$props)$$invalidate(6,optionLabelClass=$$props.optionLabelClass);if('title'in $$props)$$invalidate(7,title=$$props.title);if('locale'in $$props)$$invalidate(20,locale=$$props.locale);if('optionClass'in $$props)$$invalidate(8,optionClass=$$props.optionClass);if('optionGroupClass'in $$props)$$invalidate(9,optionGroupClass=$$props.optionGroupClass);if('$$scope'in $$props)$$invalidate(23,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*optionFilter, options, locale*/1343488){$$invalidate(11,localizedOptions=localizeOptions$1(optionFilter?options.filter(optionFilter):options,locale));}if($$self.$$.dirty[0]&/*localizedOptions, optionMapper*/133120){$$invalidate(10,mappedOptions=mapOptions(localizedOptions,optionMapper));}if($$self.$$.dirty[0]&/*mappedOptions*/1024){$$invalidate(21,flattenedOptions=flattenOptions(mappedOptions));}if($$self.$$.dirty[0]&/*selectedIndex, flattenedOptions, value, options*/2654209){// can optionally pass value to have radio button group try to auto-select the right option
if(selectedIndex<0){$$invalidate(0,selectedIndex=flattenedOptions.findIndex(function(option){return isDeepEqual(option.value,value);}));if(selectedIndex<0){$$invalidate(0,selectedIndex=getUndefinedOptionIndex(options));}}}};return[selectedIndex,label,hideLabel,klass,name,layout,optionLabelClass,title,optionClass,optionGroupClass,mappedOptions,localizedOptions,getOptionIndex,handleRadioKeydown,handleRadioClick,options,onchange,optionMapper,optionFilter,value,locale,flattenedOptions,slots,$$scope];}var RadioGroup=/*#__PURE__*/function(_SvelteComponent15){_inherits(RadioGroup,_SvelteComponent15);var _super16=_createSuper(RadioGroup);function RadioGroup(options){var _this17;_classCallCheck(this,RadioGroup);_this17=_super16.call(this);init(_assertThisInitialized(_this17),options,instance$D,create_fragment$C,safe_not_equal,{label:1,hideLabel:2,"class":3,name:4,selectedIndex:0,options:15,onchange:16,layout:5,optionMapper:17,optionFilter:18,value:19,optionLabelClass:6,title:7,locale:20,optionClass:8,optionGroupClass:9},null,[-1,-1]);return _this17;}return _createClass(RadioGroup);}(SvelteComponent);/* src/core/ui/components/Dropdown.svelte generated by Svelte v3.52.0 */var get_controls_slot_changes=function get_controls_slot_changes(dirty){return{};};var get_controls_slot_context=function get_controls_slot_context(ctx){return{};};// (97:8) {#if icon}
function create_if_block_2$8(ctx){var icon_1;var current;icon_1=new Icon({props:{"class":"PinturaButtonIcon",$$slots:{"default":[create_default_slot_1$5]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon_1.$$.fragment);},m:function m(target,anchor){mount_component(icon_1,target,anchor);current=true;},p:function p(ctx,dirty){var icon_1_changes={};if(dirty&/*$$scope, icon*/268435520){icon_1_changes.$$scope={dirty:dirty,ctx:ctx};}icon_1.$set(icon_1_changes);},i:function i(local){if(current)return;transition_in(icon_1.$$.fragment,local);current=true;},o:function o(local){transition_out(icon_1.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon_1,detaching);}};}// (98:12) <Icon class="PinturaButtonIcon">
function create_default_slot_1$5(ctx){var g;return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=/*icon*/ctx[6];},p:function p(ctx,dirty){if(dirty&/*icon*/64)g.innerHTML=/*icon*/ctx[6];},d:function d(detaching){if(detaching)detach(g);}};}// (92:4) 
function create_label_slot$2(ctx){var span1;var t;var span0;var raw_value=(/*label*/ctx[2]||/*selectedLabel*/ctx[18])+"";var span0_class_value;var span1_title_value;var span1_class_value;var current;var if_block=/*icon*/ctx[6]&&create_if_block_2$8(ctx);return{c:function c(){span1=element("span");if(if_block)if_block.c();t=space();span0=element("span");attr(span0,"class",span0_class_value=arrayJoin(['PinturaButtonLabel',/*labelClass*/ctx[3],/*hideLabel*/ctx[5]&&'implicit']));attr(span1,"slot","label");attr(span1,"title",span1_title_value=localize(/*title*/ctx[1],/*locale*/ctx[15]));attr(span1,"class",span1_class_value=arrayJoin(['PinturaButtonInner',/*innerClass*/ctx[4]]));},m:function m(target,anchor){insert(target,span1,anchor);if(if_block)if_block.m(span1,null);append(span1,t);append(span1,span0);span0.innerHTML=raw_value;current=true;},p:function p(ctx,dirty){if(/*icon*/ctx[6]){if(if_block){if_block.p(ctx,dirty);if(dirty&/*icon*/64){transition_in(if_block,1);}}else{if_block=create_if_block_2$8(ctx);if_block.c();transition_in(if_block,1);if_block.m(span1,t);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if((!current||dirty&/*label, selectedLabel*/262148)&&raw_value!==(raw_value=(/*label*/ctx[2]||/*selectedLabel*/ctx[18])+""))span0.innerHTML=raw_value;if(!current||dirty&/*labelClass, hideLabel*/40&&span0_class_value!==(span0_class_value=arrayJoin(['PinturaButtonLabel',/*labelClass*/ctx[3],/*hideLabel*/ctx[5]&&'implicit']))){attr(span0,"class",span0_class_value);}if(!current||dirty&/*title, locale*/32770&&span1_title_value!==(span1_title_value=localize(/*title*/ctx[1],/*locale*/ctx[15]))){attr(span1,"title",span1_title_value);}if(!current||dirty&/*innerClass*/16&&span1_class_value!==(span1_class_value=arrayJoin(['PinturaButtonInner',/*innerClass*/ctx[4]]))){attr(span1,"class",span1_class_value);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(span1);if(if_block)if_block.d();}};}// (121:12) 
function create_group_slot$1(ctx){var span;var t_value=/*option*/ctx[30].label+"";var t;return{c:function c(){span=element("span");t=text(t_value);attr(span,"slot","group");},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty&/*option*/1073741824&&t_value!==(t_value=/*option*/ctx[30].label+""))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (123:16) {#if option.icon}
function create_if_block_1$9(ctx){var icon_1;var current;icon_1=new Icon({props:{style:isFunction(/*optionIconStyle*/ctx[13])?/*optionIconStyle*/ctx[13](/*option*/ctx[30].value):/*optionIconStyle*/ctx[13],$$slots:{"default":[create_default_slot$e]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon_1.$$.fragment);},m:function m(target,anchor){mount_component(icon_1,target,anchor);current=true;},p:function p(ctx,dirty){var icon_1_changes={};if(dirty&/*optionIconStyle, option*/1073750016)icon_1_changes.style=isFunction(/*optionIconStyle*/ctx[13])?/*optionIconStyle*/ctx[13](/*option*/ctx[30].value):/*optionIconStyle*/ctx[13];if(dirty&/*$$scope, option*/1342177280){icon_1_changes.$$scope={dirty:dirty,ctx:ctx};}icon_1.$set(icon_1_changes);},i:function i(local){if(current)return;transition_in(icon_1.$$.fragment,local);current=true;},o:function o(local){transition_out(icon_1.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon_1,detaching);}};}// (124:20) <Icon                         style={isFunction(optionIconStyle)                             ? optionIconStyle(option.value)                             : optionIconStyle}>
function create_default_slot$e(ctx){var g;var raw_value=/*option*/ctx[30].icon+"";return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty&/*option*/1073741824&&raw_value!==(raw_value=/*option*/ctx[30].icon+""))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (137:20) {#if option.sublabel}
function create_if_block$b(ctx){var span;var raw_value=/*option*/ctx[30].sublabel+"";return{c:function c(){span=element("span");attr(span,"class","PinturaDropdownOptionSublabel");},m:function m(target,anchor){insert(target,span,anchor);span.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty&/*option*/1073741824&&raw_value!==(raw_value=/*option*/ctx[30].sublabel+""))span.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(span);}};}// (122:12) 
function create_option_slot$5(ctx){var span1;var t0;var span0;var html_tag;var raw_value=/*option*/ctx[30].label+"";var t1;var span0_style_value;var span0_class_value;var current;var if_block0=/*option*/ctx[30].icon&&create_if_block_1$9(ctx);var if_block1=/*option*/ctx[30].sublabel&&create_if_block$b(ctx);return{c:function c(){span1=element("span");if(if_block0)if_block0.c();t0=space();span0=element("span");html_tag=new HtmlTag(false);t1=space();if(if_block1)if_block1.c();html_tag.a=t1;attr(span0,"style",span0_style_value=isFunction(/*optionLabelStyle*/ctx[14])?/*optionLabelStyle*/ctx[14](/*option*/ctx[30].value):/*optionLabelStyle*/ctx[14]);attr(span0,"class",span0_class_value=arrayJoin(['PinturaDropdownOptionLabel',/*optionLabelClass*/ctx[10]]));attr(span1,"slot","option");},m:function m(target,anchor){insert(target,span1,anchor);if(if_block0)if_block0.m(span1,null);append(span1,t0);append(span1,span0);html_tag.m(raw_value,span0);append(span0,t1);if(if_block1)if_block1.m(span0,null);current=true;},p:function p(ctx,dirty){if(/*option*/ctx[30].icon){if(if_block0){if_block0.p(ctx,dirty);if(dirty&/*option*/1073741824){transition_in(if_block0,1);}}else{if_block0=create_if_block_1$9(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(span1,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if((!current||dirty&/*option*/1073741824)&&raw_value!==(raw_value=/*option*/ctx[30].label+""))html_tag.p(raw_value);if(/*option*/ctx[30].sublabel){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block$b(ctx);if_block1.c();if_block1.m(span0,null);}}else if(if_block1){if_block1.d(1);if_block1=null;}if(!current||dirty&/*optionLabelStyle, option*/1073758208&&span0_style_value!==(span0_style_value=isFunction(/*optionLabelStyle*/ctx[14])?/*optionLabelStyle*/ctx[14](/*option*/ctx[30].value):/*optionLabelStyle*/ctx[14])){attr(span0,"style",span0_style_value);}if(!current||dirty&/*optionLabelClass*/1024&&span0_class_value!==(span0_class_value=arrayJoin(['PinturaDropdownOptionLabel',/*optionLabelClass*/ctx[10]]))){attr(span0,"class",span0_class_value);}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(detaching)detach(span1);if(if_block0)if_block0.d();if(if_block1)if_block1.d();}};}// (105:4) 
function create_details_slot$3(ctx){var div;var t;var radiogroup;var current;var mounted;var dispose;var controls_slot_template=/*#slots*/ctx[26].controls;var controls_slot=create_slot(controls_slot_template,ctx,/*$$scope*/ctx[28],get_controls_slot_context);radiogroup=new RadioGroup({props:{"class":"PinturaOptionsList PinturaScrollableContent",name:/*name*/ctx[7],value:/*value*/ctx[9],selectedIndex:/*selectedIndex*/ctx[8],optionFilter:/*optionFilter*/ctx[11],optionMapper:/*optionMapper*/ctx[12],optionLabelClass:arrayJoin(['PinturaDropdownOptionLabel',/*optionLabelClass*/ctx[10]]),optionGroupClass:"PinturaListOptionGroup",optionClass:"PinturaListOption",options:/*localizedOptions*/ctx[16],onchange:/*handleSelect*/ctx[19],$$slots:{option:[create_option_slot$5,function(_ref182){var option=_ref182.option;return{30:option};},function(_ref183){var option=_ref183.option;return option?1073741824:0;}],group:[create_group_slot$1,function(_ref184){var option=_ref184.option;return{30:option};},function(_ref185){var option=_ref185.option;return option?1073741824:0;}]},$$scope:{ctx:ctx}}});return{c:function c(){div=element("div");if(controls_slot)controls_slot.c();t=space();create_component(radiogroup.$$.fragment);attr(div,"slot","details");attr(div,"class","PinturaOptionsListWrapper");},m:function m(target,anchor){insert(target,div,anchor);if(controls_slot){controls_slot.m(div,null);}append(div,t);mount_component(radiogroup,div,null);current=true;if(!mounted){dispose=listen(div,"keydown",/*handleKeydown*/ctx[21]);mounted=true;}},p:function p(ctx,dirty){if(controls_slot){if(controls_slot.p&&(!current||dirty&/*$$scope*/268435456)){update_slot_base(controls_slot,controls_slot_template,ctx,/*$$scope*/ctx[28],!current?get_all_dirty_from_scope(/*$$scope*/ctx[28]):get_slot_changes(controls_slot_template,/*$$scope*/ctx[28],dirty,get_controls_slot_changes),get_controls_slot_context);}}var radiogroup_changes={};if(dirty&/*name*/128)radiogroup_changes.name=/*name*/ctx[7];if(dirty&/*value*/512)radiogroup_changes.value=/*value*/ctx[9];if(dirty&/*selectedIndex*/256)radiogroup_changes.selectedIndex=/*selectedIndex*/ctx[8];if(dirty&/*optionFilter*/2048)radiogroup_changes.optionFilter=/*optionFilter*/ctx[11];if(dirty&/*optionMapper*/4096)radiogroup_changes.optionMapper=/*optionMapper*/ctx[12];if(dirty&/*optionLabelClass*/1024)radiogroup_changes.optionLabelClass=arrayJoin(['PinturaDropdownOptionLabel',/*optionLabelClass*/ctx[10]]);if(dirty&/*localizedOptions*/65536)radiogroup_changes.options=/*localizedOptions*/ctx[16];if(dirty&/*$$scope, optionLabelStyle, option, optionLabelClass, optionIconStyle*/1342202880){radiogroup_changes.$$scope={dirty:dirty,ctx:ctx};}radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(controls_slot,local);transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(controls_slot,local);transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(controls_slot)controls_slot.d(detaching);destroy_component(radiogroup);mounted=false;dispose();}};}function create_fragment$B(ctx){var panel;var updating_isActive;var current;function panel_isActive_binding(value){/*panel_isActive_binding*/ctx[27](value);}var panel_props={onshow:/*handleShowPanel*/ctx[20],buttonClass:arrayJoin(['PinturaDropdownButton',/*klass*/ctx[0],/*hideLabel*/ctx[5]&&'PinturaDropdownIconOnly']),$$slots:{details:[create_details_slot$3],label:[create_label_slot$2]},$$scope:{ctx:ctx}};if(/*dropdownVisible*/ctx[17]!==void 0){panel_props.isActive=/*dropdownVisible*/ctx[17];}panel=new Panel({props:panel_props});binding_callbacks.push(function(){return bind(panel,'isActive',panel_isActive_binding);});return{c:function c(){create_component(panel.$$.fragment);},m:function m(target,anchor){mount_component(panel,target,anchor);current=true;},p:function p(ctx,_ref186){var _ref187=_slicedToArray(_ref186,1),dirty=_ref187[0];var panel_changes={};if(dirty&/*klass, hideLabel*/33)panel_changes.buttonClass=arrayJoin(['PinturaDropdownButton',/*klass*/ctx[0],/*hideLabel*/ctx[5]&&'PinturaDropdownIconOnly']);if(dirty&/*$$scope, name, value, selectedIndex, optionFilter, optionMapper, optionLabelClass, localizedOptions, optionLabelStyle, optionIconStyle, title, locale, innerClass, labelClass, hideLabel, label, selectedLabel, icon*/268828670){panel_changes.$$scope={dirty:dirty,ctx:ctx};}if(!updating_isActive&&dirty&/*dropdownVisible*/131072){updating_isActive=true;panel_changes.isActive=/*dropdownVisible*/ctx[17];add_flush_callback(function(){return updating_isActive=false;});}panel.$set(panel_changes);},i:function i(local){if(current)return;transition_in(panel.$$.fragment,local);current=true;},o:function o(local){transition_out(panel.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(panel,detaching);}};}function instance$C($$self,$$props,$$invalidate){var localizedOptions;var selectedLabel;var _$$props$$$slots12=$$props.$$slots,slots=_$$props$$$slots12===void 0?{}:_$$props$$$slots12,$$scope=$$props.$$scope;var _$$props$class11=$$props["class"],klass=_$$props$class11===void 0?undefined:_$$props$class11;var _$$props$title2=$$props.title,title=_$$props$title2===void 0?undefined:_$$props$title2;var _$$props$label3=$$props.label,label=_$$props$label3===void 0?undefined:_$$props$label3;var _$$props$labelClass2=$$props.labelClass,labelClass=_$$props$labelClass2===void 0?undefined:_$$props$labelClass2;var _$$props$innerClass2=$$props.innerClass,innerClass=_$$props$innerClass2===void 0?undefined:_$$props$innerClass2;var _$$props$hideLabel3=$$props.hideLabel,hideLabel=_$$props$hideLabel3===void 0?false:_$$props$hideLabel3;var _$$props$icon2=$$props.icon,icon=_$$props$icon2===void 0?undefined:_$$props$icon2;var _$$props$name3=$$props.name,name=_$$props$name3===void 0?undefined:_$$props$name3;var _$$props$options2=$$props.options,options=_$$props$options2===void 0?[]:_$$props$options2;var _$$props$selectedInde2=$$props.selectedIndex,selectedIndex=_$$props$selectedInde2===void 0?-1:_$$props$selectedInde2;var _$$props$value3=$$props.value,value=_$$props$value3===void 0?undefined:_$$props$value3;var _$$props$optionLabelC2=$$props.optionLabelClass,optionLabelClass=_$$props$optionLabelC2===void 0?undefined:_$$props$optionLabelC2;var _$$props$optionFilter2=$$props.optionFilter,optionFilter=_$$props$optionFilter2===void 0?undefined:_$$props$optionFilter2;var _$$props$optionMapper2=$$props.optionMapper,optionMapper=_$$props$optionMapper2===void 0?undefined:_$$props$optionMapper2;var _$$props$optionIconSt=$$props.optionIconStyle,optionIconStyle=_$$props$optionIconSt===void 0?undefined:_$$props$optionIconSt;var _$$props$optionLabelS=$$props.optionLabelStyle,optionLabelStyle=_$$props$optionLabelS===void 0?undefined:_$$props$optionLabelS;var _$$props$locale2=$$props.locale,locale=_$$props$locale2===void 0?undefined:_$$props$locale2;var _$$props$onchange3=$$props.onchange,onchange=_$$props$onchange3===void 0?noop$1:_$$props$onchange3;var _$$props$onload=$$props.onload,onload=_$$props$onload===void 0?noop$1:_$$props$onload;var _$$props$ondestroy=$$props.ondestroy,ondestroy=_$$props$ondestroy===void 0?noop$1:_$$props$ondestroy;var getUndefinedOptionLabel=function getUndefinedOptionLabel(options){var option=options.find(function(option){return option[0]===undefined;});if(!option)return undefined;return option[1];};var dropdownVisible;var handleSelect=function handleSelect(detail){// triggers label update
$$invalidate(18,selectedLabel=detail.value);// update value
onchange(detail);// hide details
$$invalidate(17,dropdownVisible=false);};var handleShowPanel=function handleShowPanel(_ref188){var e=_ref188.e,panel=_ref188.panel;if(e&&e.key&&/up|down/i.test(e.key))return focus(panel.querySelector('input:not([disabled])'));focus(panel.querySelector('fieldset'));};var handleKeydown=function handleKeydown(e){// don't allow tabbing ([tab] is also blocked in normal <select>)
if(/tab/i.test(e.key))e.preventDefault();};onMount(function(){return onload({options:options});});onDestroy(function(){return ondestroy({options:options});});function panel_isActive_binding(value){dropdownVisible=value;$$invalidate(17,dropdownVisible);}$$self.$$set=function($$props){if('class'in $$props)$$invalidate(0,klass=$$props["class"]);if('title'in $$props)$$invalidate(1,title=$$props.title);if('label'in $$props)$$invalidate(2,label=$$props.label);if('labelClass'in $$props)$$invalidate(3,labelClass=$$props.labelClass);if('innerClass'in $$props)$$invalidate(4,innerClass=$$props.innerClass);if('hideLabel'in $$props)$$invalidate(5,hideLabel=$$props.hideLabel);if('icon'in $$props)$$invalidate(6,icon=$$props.icon);if('name'in $$props)$$invalidate(7,name=$$props.name);if('options'in $$props)$$invalidate(22,options=$$props.options);if('selectedIndex'in $$props)$$invalidate(8,selectedIndex=$$props.selectedIndex);if('value'in $$props)$$invalidate(9,value=$$props.value);if('optionLabelClass'in $$props)$$invalidate(10,optionLabelClass=$$props.optionLabelClass);if('optionFilter'in $$props)$$invalidate(11,optionFilter=$$props.optionFilter);if('optionMapper'in $$props)$$invalidate(12,optionMapper=$$props.optionMapper);if('optionIconStyle'in $$props)$$invalidate(13,optionIconStyle=$$props.optionIconStyle);if('optionLabelStyle'in $$props)$$invalidate(14,optionLabelStyle=$$props.optionLabelStyle);if('locale'in $$props)$$invalidate(15,locale=$$props.locale);if('onchange'in $$props)$$invalidate(23,onchange=$$props.onchange);if('onload'in $$props)$$invalidate(24,onload=$$props.onload);if('ondestroy'in $$props)$$invalidate(25,ondestroy=$$props.ondestroy);if('$$scope'in $$props)$$invalidate(28,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty&/*locale, options*/4227072){$$invalidate(16,localizedOptions=locale?localizeOptions$1(options,locale):options);}if($$self.$$.dirty&/*localizedOptions, value*/66048){$$invalidate(18,selectedLabel=localizedOptions.reduce(function(prev,curr){if(prev)return prev;var item=Array.isArray(curr)?curr:[curr,curr];var _item=_slicedToArray(item,2),optionValue=_item[0],optionLabel=_item[1];if(isDeepEqual(optionValue,value))return optionLabel;},undefined)||getUndefinedOptionLabel(localizedOptions)||value);}};return[klass,title,label,labelClass,innerClass,hideLabel,icon,name,selectedIndex,value,optionLabelClass,optionFilter,optionMapper,optionIconStyle,optionLabelStyle,locale,localizedOptions,dropdownVisible,selectedLabel,handleSelect,handleShowPanel,handleKeydown,options,onchange,onload,ondestroy,slots,panel_isActive_binding,$$scope];}var Dropdown=/*#__PURE__*/function(_SvelteComponent16){_inherits(Dropdown,_SvelteComponent16);var _super17=_createSuper(Dropdown);function Dropdown(options){var _this18;_classCallCheck(this,Dropdown);_this18=_super17.call(this);init(_assertThisInitialized(_this18),options,instance$C,create_fragment$B,safe_not_equal,{"class":0,title:1,label:2,labelClass:3,innerClass:4,hideLabel:5,icon:6,name:7,options:22,selectedIndex:8,value:9,optionLabelClass:10,optionFilter:11,optionMapper:12,optionIconStyle:13,optionLabelStyle:14,locale:15,onchange:23,onload:24,ondestroy:25});return _this18;}return _createClass(Dropdown);}(SvelteComponent);/* src/core/ui/components/DynamicPanel.svelte generated by Svelte v3.52.0 */function create_details_slot$2(ctx){var div;return{c:function c(){div=element("div");attr(div,"slot","details");},m:function m(target,anchor){insert(target,div,anchor);/*div_binding*/ctx[10](div);},p:noop,d:function d(detaching){if(detaching)detach(div);/*div_binding*/ctx[10](null);}};}function create_fragment$A(ctx){var panel;var updating_isActive;var current;function panel_isActive_binding(value){/*panel_isActive_binding*/ctx[11](value);}var panel_props={buttonLabel:/*buttonLabel*/ctx[0],buttonClass:/*buttonClass*/ctx[1],onshow:/*onshow*/ctx[2],onhide:/*onhide*/ctx[3],$$slots:{details:[create_details_slot$2]},$$scope:{ctx:ctx}};if(/*isActive*/ctx[5]!==void 0){panel_props.isActive=/*isActive*/ctx[5];}panel=new Panel({props:panel_props});binding_callbacks.push(function(){return bind(panel,'isActive',panel_isActive_binding);});return{c:function c(){create_component(panel.$$.fragment);},m:function m(target,anchor){mount_component(panel,target,anchor);current=true;},p:function p(ctx,_ref189){var _ref190=_slicedToArray(_ref189,1),dirty=_ref190[0];var panel_changes={};if(dirty&/*buttonLabel*/1)panel_changes.buttonLabel=/*buttonLabel*/ctx[0];if(dirty&/*buttonClass*/2)panel_changes.buttonClass=/*buttonClass*/ctx[1];if(dirty&/*onshow*/4)panel_changes.onshow=/*onshow*/ctx[2];if(dirty&/*onhide*/8)panel_changes.onhide=/*onhide*/ctx[3];if(dirty&/*$$scope, container*/4112){panel_changes.$$scope={dirty:dirty,ctx:ctx};}if(!updating_isActive&&dirty&/*isActive*/32){updating_isActive=true;panel_changes.isActive=/*isActive*/ctx[5];add_flush_callback(function(){return updating_isActive=false;});}panel.$set(panel_changes);},i:function i(local){if(current)return;transition_in(panel.$$.fragment,local);current=true;},o:function o(local){transition_out(panel.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(panel,detaching);}};}function instance$B($$self,$$props,$$invalidate){var _$$props$buttonLabel2=$$props.buttonLabel,buttonLabel=_$$props$buttonLabel2===void 0?undefined:_$$props$buttonLabel2;var _$$props$buttonClass2=$$props.buttonClass,buttonClass=_$$props$buttonClass2===void 0?undefined:_$$props$buttonClass2;var _$$props$root=$$props.root,root=_$$props$root===void 0?undefined:_$$props$root;var _$$props$ondestroy2=$$props.ondestroy,ondestroy=_$$props$ondestroy2===void 0?noop$1:_$$props$ondestroy2;var _$$props$onshow2=$$props.onshow,onshow=_$$props$onshow2===void 0?noop$1:_$$props$onshow2;var _$$props$onhide2=$$props.onhide,onhide=_$$props$onhide2===void 0?noop$1:_$$props$onhide2;var hide=function hide(){return $$invalidate(5,isActive=false);};var show=function show(){return $$invalidate(5,isActive=true);};var container;var isActive=false;onDestroy(ondestroy);function div_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){container=$$value;$$invalidate(4,container);});}function panel_isActive_binding(value){isActive=value;$$invalidate(5,isActive);}$$self.$$set=function($$props){if('buttonLabel'in $$props)$$invalidate(0,buttonLabel=$$props.buttonLabel);if('buttonClass'in $$props)$$invalidate(1,buttonClass=$$props.buttonClass);if('root'in $$props)$$invalidate(6,root=$$props.root);if('ondestroy'in $$props)$$invalidate(7,ondestroy=$$props.ondestroy);if('onshow'in $$props)$$invalidate(2,onshow=$$props.onshow);if('onhide'in $$props)$$invalidate(3,onhide=$$props.onhide);};$$self.$$.update=function(){if($$self.$$.dirty&/*container, root*/80){if(container&&root&&container.firstChild!==root){container.hasChildNodes()?container.replaceChild(root,container.firstChild):container.append(root);}}};return[buttonLabel,buttonClass,onshow,onhide,container,isActive,root,ondestroy,hide,show,div_binding,panel_isActive_binding];}var DynamicPanel=/*#__PURE__*/function(_SvelteComponent17){_inherits(DynamicPanel,_SvelteComponent17);var _super18=_createSuper(DynamicPanel);function DynamicPanel(options){var _this19;_classCallCheck(this,DynamicPanel);_this19=_super18.call(this);init(_assertThisInitialized(_this19),options,instance$B,create_fragment$A,safe_not_equal,{buttonLabel:0,buttonClass:1,root:6,ondestroy:7,onshow:2,onhide:3,hide:8,show:9});return _this19;}_createClass(DynamicPanel,[{key:"hide",get:function get(){return this.$$.ctx[8];}},{key:"show",get:function get(){return this.$$.ctx[9];}}]);return DynamicPanel;}(SvelteComponent);/* src/core/ui/components/ToggleSlider.svelte generated by Svelte v3.52.0 */function create_if_block$a(ctx){var icon_1;var current;icon_1=new Icon({props:{"class":"PinturaButtonIcon",$$slots:{"default":[create_default_slot$d]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon_1.$$.fragment);},m:function m(target,anchor){mount_component(icon_1,target,anchor);current=true;},p:function p(ctx,dirty){var icon_1_changes={};if(dirty&/*$$scope, icon*/524292){icon_1_changes.$$scope={dirty:dirty,ctx:ctx};}icon_1.$set(icon_1_changes);},i:function i(local){if(current)return;transition_in(icon_1.$$.fragment,local);current=true;},o:function o(local){transition_out(icon_1.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon_1,detaching);}};}// (56:12) <Icon class="PinturaButtonIcon">
function create_default_slot$d(ctx){var g;return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=/*icon*/ctx[2];},p:function p(ctx,dirty){if(dirty&/*icon*/4)g.innerHTML=/*icon*/ctx[2];},d:function d(detaching){if(detaching)detach(g);}};}// (50:4) 
function create_label_slot$1(ctx){var span1;var t0;var span0;var t1;var span0_class_value;var span1_title_value;var span1_class_value;var current;var if_block=/*icon*/ctx[2]&&create_if_block$a(ctx);return{c:function c(){span1=element("span");if(if_block)if_block.c();t0=space();span0=element("span");t1=text(/*currentLabel*/ctx[8]);attr(span0,"class",span0_class_value=arrayJoin(['PinturaButtonLabel',/*labelClass*/ctx[3],/*hideLabel*/ctx[5]&&'implicit']));attr(span1,"slot","label");attr(span1,"title",span1_title_value=localize(/*title*/ctx[1],/*locale*/ctx[6]));attr(span1,"class",span1_class_value=arrayJoin(['PinturaButtonInner',/*innerClass*/ctx[4]]));},m:function m(target,anchor){insert(target,span1,anchor);if(if_block)if_block.m(span1,null);append(span1,t0);append(span1,span0);append(span0,t1);current=true;},p:function p(ctx,dirty){if(/*icon*/ctx[2]){if(if_block){if_block.p(ctx,dirty);if(dirty&/*icon*/4){transition_in(if_block,1);}}else{if_block=create_if_block$a(ctx);if_block.c();transition_in(if_block,1);if_block.m(span1,t0);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if(!current||dirty&/*currentLabel*/256)set_data(t1,/*currentLabel*/ctx[8]);if(!current||dirty&/*labelClass, hideLabel*/40&&span0_class_value!==(span0_class_value=arrayJoin(['PinturaButtonLabel',/*labelClass*/ctx[3],/*hideLabel*/ctx[5]&&'implicit']))){attr(span0,"class",span0_class_value);}if(!current||dirty&/*title, locale*/66&&span1_title_value!==(span1_title_value=localize(/*title*/ctx[1],/*locale*/ctx[6]))){attr(span1,"title",span1_title_value);}if(!current||dirty&/*innerClass*/16&&span1_class_value!==(span1_class_value=arrayJoin(['PinturaButtonInner',/*innerClass*/ctx[4]]))){attr(span1,"class",span1_class_value);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(span1);if(if_block)if_block.d();}};}// (63:4) 
function create_details_slot$1(ctx){var div;var slider;var current;var mounted;var dispose;var slider_spread_levels=[/*$$restProps*/ctx[11],{value:/*value*/ctx[7]},{onchange:/*handleChangeValue*/ctx[10]}];var slider_props={};for(var i=0;i<slider_spread_levels.length;i+=1){slider_props=assign(slider_props,slider_spread_levels[i]);}slider=new Slider({props:slider_props});return{c:function c(){div=element("div");create_component(slider.$$.fragment);attr(div,"slot","details");},m:function m(target,anchor){insert(target,div,anchor);mount_component(slider,div,null);current=true;if(!mounted){dispose=listen(div,"keydown",/*handleKeydown*/ctx[9]);mounted=true;}},p:function p(ctx,dirty){var slider_changes=dirty&/*$$restProps, value, handleChangeValue*/3200?get_spread_update(slider_spread_levels,[dirty&/*$$restProps*/2048&&get_spread_object(/*$$restProps*/ctx[11]),dirty&/*value*/128&&{value:/*value*/ctx[7]},dirty&/*handleChangeValue*/1024&&{onchange:/*handleChangeValue*/ctx[10]}]):{};slider.$set(slider_changes);},i:function i(local){if(current)return;transition_in(slider.$$.fragment,local);current=true;},o:function o(local){transition_out(slider.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(slider);mounted=false;dispose();}};}function create_fragment$z(ctx){var panel;var current;panel=new Panel({props:{panelClass:"PinturaSliderPanel",buttonClass:arrayJoin(['PinturaSliderButton',/*klass*/ctx[0],/*hideLabel*/ctx[5]&&'PinturaSliderIconOnly']),$$slots:{details:[create_details_slot$1],label:[create_label_slot$1]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(panel.$$.fragment);},m:function m(target,anchor){mount_component(panel,target,anchor);current=true;},p:function p(ctx,_ref191){var _ref192=_slicedToArray(_ref191,1),dirty=_ref192[0];var panel_changes={};if(dirty&/*klass, hideLabel*/33)panel_changes.buttonClass=arrayJoin(['PinturaSliderButton',/*klass*/ctx[0],/*hideLabel*/ctx[5]&&'PinturaSliderIconOnly']);if(dirty&/*$$scope, $$restProps, value, title, locale, innerClass, labelClass, hideLabel, currentLabel, icon*/526846){panel_changes.$$scope={dirty:dirty,ctx:ctx};}panel.$set(panel_changes);},i:function i(local){if(current)return;transition_in(panel.$$.fragment,local);current=true;},o:function o(local){transition_out(panel.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(panel,detaching);}};}function instance$A($$self,$$props,$$invalidate){var omit_props_names=["class","title","label","icon","labelClass","innerClass","hideLabel","locale","value","onchange"];var $$restProps=compute_rest_props($$props,omit_props_names);var _$$props=$$props,_$$props$class12=_$$props["class"],klass=_$$props$class12===void 0?undefined:_$$props$class12;var _$$props2=$$props,_$$props2$title=_$$props2.title,title=_$$props2$title===void 0?undefined:_$$props2$title;var _$$props3=$$props,_$$props3$label=_$$props3.label,label=_$$props3$label===void 0?Math.round:_$$props3$label;var _$$props4=$$props,_$$props4$icon=_$$props4.icon,icon=_$$props4$icon===void 0?undefined:_$$props4$icon;var _$$props5=$$props,_$$props5$labelClass=_$$props5.labelClass,labelClass=_$$props5$labelClass===void 0?undefined:_$$props5$labelClass;var _$$props6=$$props,_$$props6$innerClass=_$$props6.innerClass,innerClass=_$$props6$innerClass===void 0?undefined:_$$props6$innerClass;var _$$props7=$$props,_$$props7$hideLabel=_$$props7.hideLabel,hideLabel=_$$props7$hideLabel===void 0?false:_$$props7$hideLabel;var _$$props8=$$props,_$$props8$locale=_$$props8.locale,locale=_$$props8$locale===void 0?undefined:_$$props8$locale;var _$$props9=$$props,_$$props9$value=_$$props9.value,value=_$$props9$value===void 0?undefined:_$$props9$value;var _$$props10=$$props,_$$props10$onchange=_$$props10.onchange,onchange=_$$props10$onchange===void 0?noop$1:_$$props10$onchange;var _$$restProps=$$restProps,min=_$$restProps.min,max=_$$restProps.max,_$$restProps$getValue=_$$restProps.getValue,getValue=_$$restProps$getValue===void 0?passthrough:_$$restProps$getValue;var currentLabel;var handleKeydown=function handleKeydown(e){// don't allow tabbing ([tab] is also blocked in normal <select>)
if(/tab/i.test(e.key))e.preventDefault();};var getLabel=function getLabel(value){return isFunction(label)?label(getValue(value),min,max):label;};var handleChangeValue=function handleChangeValue(value){syncLabel(value);onchange(value);};var syncLabel=function syncLabel(value){return $$invalidate(8,currentLabel=getLabel(value));};$$self.$$set=function($$new_props){$$props=assign(assign({},$$props),exclude_internal_props($$new_props));$$invalidate(11,$$restProps=compute_rest_props($$props,omit_props_names));if('class'in $$new_props)$$invalidate(0,klass=$$new_props["class"]);if('title'in $$new_props)$$invalidate(1,title=$$new_props.title);if('label'in $$new_props)$$invalidate(12,label=$$new_props.label);if('icon'in $$new_props)$$invalidate(2,icon=$$new_props.icon);if('labelClass'in $$new_props)$$invalidate(3,labelClass=$$new_props.labelClass);if('innerClass'in $$new_props)$$invalidate(4,innerClass=$$new_props.innerClass);if('hideLabel'in $$new_props)$$invalidate(5,hideLabel=$$new_props.hideLabel);if('locale'in $$new_props)$$invalidate(6,locale=$$new_props.locale);if('value'in $$new_props)$$invalidate(7,value=$$new_props.value);if('onchange'in $$new_props)$$invalidate(13,onchange=$$new_props.onchange);};$$self.$$.update=function(){if($$self.$$.dirty&/*value, label*/4224){syncLabel(value);}};return[klass,title,icon,labelClass,innerClass,hideLabel,locale,value,currentLabel,handleKeydown,handleChangeValue,$$restProps,label,onchange];}var ToggleSlider=/*#__PURE__*/function(_SvelteComponent18){_inherits(ToggleSlider,_SvelteComponent18);var _super19=_createSuper(ToggleSlider);function ToggleSlider(options){var _this20;_classCallCheck(this,ToggleSlider);_this20=_super19.call(this);init(_assertThisInitialized(_this20),options,instance$A,create_fragment$z,safe_not_equal,{"class":0,title:1,label:12,icon:2,labelClass:3,innerClass:4,hideLabel:5,locale:6,value:7,onchange:13});return _this20;}return _createClass(ToggleSlider);}(SvelteComponent);/* src/core/ui/components/DynamicComponentTree.svelte generated by Svelte v3.52.0 */function get_each_context$6(ctx,list,i){var child_ctx=ctx.slice();child_ctx[9]=list[i][0];child_ctx[0]=list[i][1];child_ctx[10]=list[i][2];child_ctx[2]=list[i][3];return child_ctx;}// (59:4) {:else}
function create_else_block$3(ctx){var switch_instance;var switch_instance_anchor;var current;var switch_instance_spread_levels=[/*props*/ctx[10]];var switch_value=/*ComponentMap*/ctx[3][/*node*/ctx[9]]||/*node*/ctx[9];function switch_props(ctx){var switch_instance_props={};for(var i=0;i<switch_instance_spread_levels.length;i+=1){switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);}return{props:switch_instance_props};}if(switch_value){switch_instance=construct_svelte_component(switch_value,switch_props());}return{c:function c(){if(switch_instance)create_component(switch_instance.$$.fragment);switch_instance_anchor=empty();},m:function m(target,anchor){if(switch_instance)mount_component(switch_instance,target,anchor);insert(target,switch_instance_anchor,anchor);current=true;},p:function p(ctx,dirty){var switch_instance_changes=dirty&/*children*/4?get_spread_update(switch_instance_spread_levels,[get_spread_object(/*props*/ctx[10])]):{};if(switch_value!==(switch_value=/*ComponentMap*/ctx[3][/*node*/ctx[9]]||/*node*/ctx[9])){if(switch_instance){group_outros();var old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,function(){destroy_component(old_component,1);});check_outros();}if(switch_value){switch_instance=construct_svelte_component(switch_value,switch_props());create_component(switch_instance.$$.fragment);transition_in(switch_instance.$$.fragment,1);mount_component(switch_instance,switch_instance_anchor.parentNode,switch_instance_anchor);}else{switch_instance=null;}}else if(switch_value){switch_instance.$set(switch_instance_changes);}},i:function i(local){if(current)return;if(switch_instance)transition_in(switch_instance.$$.fragment,local);current=true;},o:function o(local){if(switch_instance)transition_out(switch_instance.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(switch_instance_anchor);if(switch_instance)destroy_component(switch_instance,detaching);}};}// (49:4) {#if !isComponent(node)}
function create_if_block$9(ctx){var tag;var current;tag=new Tag({props:{name:/*node*/ctx[9],attributes:/*getElementAttributes*/ctx[4](/*props*/ctx[10]),$$slots:{"default":[create_default_slot$c]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(tag.$$.fragment);},m:function m(target,anchor){mount_component(tag,target,anchor);current=true;},p:function p(ctx,dirty){var tag_changes={};if(dirty&/*children*/4)tag_changes.name=/*node*/ctx[9];if(dirty&/*children*/4)tag_changes.attributes=/*getElementAttributes*/ctx[4](/*props*/ctx[10]);if(dirty&/*$$scope, children*/8196){tag_changes.$$scope={dirty:dirty,ctx:ctx};}tag.$set(tag_changes);},i:function i(local){if(current)return;transition_in(tag.$$.fragment,local);current=true;},o:function o(local){transition_out(tag.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(tag,detaching);}};}// (55:38) 
function create_if_block_3$6(ctx){var html_tag;var raw_value=/*props*/ctx[10].innerHTML+"";var html_anchor;return{c:function c(){html_tag=new HtmlTag(false);html_anchor=empty();html_tag.a=html_anchor;},m:function m(target,anchor){html_tag.m(raw_value,target,anchor);insert(target,html_anchor,anchor);},p:function p(ctx,dirty){if(dirty&/*children*/4&&raw_value!==(raw_value=/*props*/ctx[10].innerHTML+""))html_tag.p(raw_value);},i:noop,o:noop,d:function d(detaching){if(detaching)detach(html_anchor);if(detaching)html_tag.d();}};}// (53:40) 
function create_if_block_2$7(ctx){var t_value=/*props*/ctx[10].textContent+"";var t;return{c:function c(){t=text(t_value);},m:function m(target,anchor){insert(target,t,anchor);},p:function p(ctx,dirty){if(dirty&/*children*/4&&t_value!==(t_value=/*props*/ctx[10].textContent+""))set_data(t,t_value);},i:noop,o:noop,d:function d(detaching){if(detaching)detach(t);}};}// (51:12) {#if children && children.length}
function create_if_block_1$8(ctx){var dynamiccomponenttree;var current;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*children*/ctx[2],discardEmptyItems:true}});return{c:function c(){create_component(dynamiccomponenttree.$$.fragment);},m:function m(target,anchor){mount_component(dynamiccomponenttree,target,anchor);current=true;},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty&/*children*/4)dynamiccomponenttree_changes.items=/*children*/ctx[2];dynamiccomponenttree.$set(dynamiccomponenttree_changes);},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(dynamiccomponenttree,detaching);}};}// (50:8) <Tag name={node} attributes={getElementAttributes(props)}>
function create_default_slot$c(ctx){var current_block_type_index;var if_block;var t;var current;var if_block_creators=[create_if_block_1$8,create_if_block_2$7,create_if_block_3$6];var if_blocks=[];function select_block_type_1(ctx,dirty){if(/*children*/ctx[2]&&/*children*/ctx[2].length)return 0;if(/*props*/ctx[10].textContent)return 1;if(/*props*/ctx[10].innerHTML)return 2;return-1;}if(~(current_block_type_index=select_block_type_1(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){if(if_block)if_block.c();t=space();},m:function m(target,anchor){if(~current_block_type_index){if_blocks[current_block_type_index].m(target,anchor);}insert(target,t,anchor);current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type_1(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(t.parentNode,t);}else{if_block=null;}}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(~current_block_type_index){if_blocks[current_block_type_index].d(detaching);}if(detaching)detach(t);}};}// (48:0) {#each children as [node, key, props, children] (key + treeUniqueKey)}
function create_each_block$6(key_2,ctx){var first;var show_if;var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block$9,create_else_block$3];var if_blocks=[];function select_block_type(ctx,dirty){if(dirty&/*children*/4)show_if=null;if(show_if==null)show_if=!!!/*isComponent*/ctx[5](/*node*/ctx[9]);if(show_if)return 0;return 1;}current_block_type_index=select_block_type(ctx,-1);if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);return{key:key_2,first:null,c:function c(){first=empty();if_block.c();if_block_anchor=empty();this.first=first;},m:function m(target,anchor){insert(target,first,anchor);if_blocks[current_block_type_index].m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(new_ctx,dirty){ctx=new_ctx;var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx,dirty);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(first);if_blocks[current_block_type_index].d(detaching);if(detaching)detach(if_block_anchor);}};}function create_fragment$y(ctx){var each_blocks=[];var each_1_lookup=new Map();var each_1_anchor;var current;var each_value=/*children*/ctx[2];var get_key=function get_key(ctx){return(/*key*/ctx[0]+/*treeUniqueKey*/ctx[1]);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$6(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$6(key,child_ctx));}return{c:function c(){for(var _i22=0;_i22<each_blocks.length;_i22+=1){each_blocks[_i22].c();}each_1_anchor=empty();},m:function m(target,anchor){for(var _i23=0;_i23<each_blocks.length;_i23+=1){each_blocks[_i23].m(target,anchor);}insert(target,each_1_anchor,anchor);current=true;},p:function p(ctx,_ref193){var _ref194=_slicedToArray(_ref193,1),dirty=_ref194[0];if(dirty&/*children, getElementAttributes, isComponent, ComponentMap, treeUniqueKey*/62){each_value=/*children*/ctx[2];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value,each_1_lookup,each_1_anchor.parentNode,outro_and_destroy_block,create_each_block$6,each_1_anchor,get_each_context$6);check_outros();}},i:function i(local){if(current)return;for(var _i24=0;_i24<each_value.length;_i24+=1){transition_in(each_blocks[_i24]);}current=true;},o:function o(local){for(var _i25=0;_i25<each_blocks.length;_i25+=1){transition_out(each_blocks[_i25]);}current=false;},d:function d(detaching){for(var _i26=0;_i26<each_blocks.length;_i26+=1){each_blocks[_i26].d(detaching);}if(detaching)detach(each_1_anchor);}};}function instance$z($$self,$$props,$$invalidate){var treeUniqueKey;var children;var items=$$props.items;var _$$props$discardEmpty=$$props.discardEmptyItems,discardEmptyItems=_$$props$discardEmpty===void 0?true:_$$props$discardEmpty;var _$$props$key=$$props.key,key=_$$props$key===void 0?'':_$$props$key;var ComponentMap={Button:Button,Dropdown:Dropdown,Panel:DynamicPanel,Slider:ToggleSlider};var getElementAttributes=function getElementAttributes(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var textContent=props.textContent,innerHTML=props.innerHTML,attributes=_objectWithoutProperties(props,_excluded);return attributes;};var isComponent=function isComponent(node){return!isString(node)||!!ComponentMap[node];};var shouldRenderItem=function shouldRenderItem(item){// don't render falsy items
if(!item)return false;// get relevant props
var _item2=_slicedToArray(item,4),node=_item2[0],props=_item2[2],_item2$=_item2[3],children=_item2$===void 0?[]:_item2$;// if item is component, we always render it
if(isComponent(node))return true;// item is tag, we have to check if it has content
return children.some(shouldRenderItem)||props.textContent||props.innerHTML;};$$self.$$set=function($$props){if('items'in $$props)$$invalidate(6,items=$$props.items);if('discardEmptyItems'in $$props)$$invalidate(7,discardEmptyItems=$$props.discardEmptyItems);if('key'in $$props)$$invalidate(0,key=$$props.key);};$$self.$$.update=function(){if($$self.$$.dirty&/*key*/1){$$invalidate(1,treeUniqueKey=key);}if($$self.$$.dirty&/*items, discardEmptyItems*/192){$$invalidate(2,children=(items&&discardEmptyItems?items.filter(shouldRenderItem):items)||[]);}};return[key,treeUniqueKey,children,ComponentMap,getElementAttributes,isComponent,items,discardEmptyItems];}var DynamicComponentTree_1=/*#__PURE__*/function(_SvelteComponent19){_inherits(DynamicComponentTree_1,_SvelteComponent19);var _super20=_createSuper(DynamicComponentTree_1);function DynamicComponentTree_1(options){var _this21;_classCallCheck(this,DynamicComponentTree_1);_this21=_super20.call(this);init(_assertThisInitialized(_this21),options,instance$z,create_fragment$y,safe_not_equal,{items:6,discardEmptyItems:7,key:0});return _this21;}return _createClass(DynamicComponentTree_1);}(SvelteComponent);// these are derived stores, we can filter them out
var ImagePropsDerived=['aspectRatio','isRotatedSideways','flip','cropSize'];// map descriptors to props
var ImageStoreProps=ImageStorePropDescriptors.map(function(_ref195){var _ref196=_slicedToArray(_ref195,1),name=_ref196[0];return name;}).filter(function(name){return!ImagePropsDerived.includes(name);});var proxy=function proxy(get,set,update){var subscribers=[];return{set:set,update:update,publish:function publish(value){subscribers.forEach(function(cb){return cb(value);});},subscribe:function subscribe(cb){subscribers.push(cb);get(cb);return function(){subscribers=subscribers.filter(function(item){return item!==cb;});};}};};var createImageProxy=function createImageProxy(){var unsubs;var image;var proxyStores=ImageStoreProps.reduce(function(prev,curr){prev[curr]=proxy(// getter
function(cb){// subscribe
if(!image)return cb();var unsub=image.stores[curr].subscribe(cb);unsub();},// setter
function(value){// set value on actual store if is defined
if(!image)return;image.stores[curr].set(value);},// updater
function(cb){if(!image)return;image.stores[curr].update(cb);});return prev;},{});var update=function update(newImage){image=newImage;if(unsubs){// remove subscribers
unsubs.forEach(function(unsub){return unsub();});unsubs=undefined;}if(!newImage){// need to reset load state
proxyStores['file'].publish(undefined);proxyStores['loadState'].publish(undefined);return;}unsubs=ImageStoreProps.map(function(prop){return newImage.stores[prop].subscribe(function(value){proxyStores[prop].publish(value);});});};return{update:update,stores:proxyStores,destroy:function destroy(){if(unsubs)unsubs.forEach(function(unsub){return unsub();});}};};var createPingRouter=function createPingRouter(route){var cancel=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return function(e){if(e.type!=='ping')return;if(cancel)e.stopPropagation();route(e.detail.type,e.detail.data);};};var createPing=function createPing(type,data){return new CustomEvent('ping',{detail:{type:type,data:data},cancelable:true,bubbles:true});};var isTextarea=function isTextarea(element){return /textarea/i.test(element.nodeName);};var isTextInput=function isTextInput(node){return /date|email|number|search|text|url/.test(node.type);};var isTextField=function isTextField(node){return isTextarea(node)||isTextInput(node)||node.isContentEditable;};var toKebabCase=function toKebabCase(str,abbr){return(abbr?stringReplace(str,abbr):str).replace(/([a-z])([A-Z])/g,'$1-$2').replace(/\s+/g,'-').toLowerCase();};var matchMedia$1=function matchMedia$1(query,cb){var mql=matchMedia(query);mql.addListener(cb);cb(mql);return{get matches(){return mql.matches;},destroy:function destroy(){return mql.removeListener(cb);}};};var mediaQueryStore=function mediaQueryStore(query){var formatValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:passthrough;var _writable3=writable(undefined),subscribe=_writable3.subscribe,set=_writable3.set;var mm=matchMedia$1(query,function(_ref197){var matches=_ref197.matches;return set(formatValue(matches));});return{subscribe:subscribe,destroy:mm.destroy};};var canPreventNavSwipe=function canPreventNavSwipe(){// if not iOS we can't prevent swipe because it probably isn't a thing
if(!isIOS())return false;// extract version number
var matches=navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/i)||[];var _matches$map=matches.map(function(v){return parseInt(v,10)||0;}),_matches$map2=_slicedToArray(_matches$map,3),major=_matches$map2[1],minor=_matches$map2[2];// is atleast version 13.4+
return major>13||major===13&&minor>=4;};// @ts-ignore
var historyCreate=function historyCreate(getState,setState){// set up pub/sub for history object
var _pubsub4=pubsub(),sub=_pubsub4.sub,pub=_pubsub4.pub;// current history state
var entries=[];var index=writable(0);var subs=[];var updateSubs=function updateSubs(){return subs.forEach(function(cb){return cb({index:get_store_value(index),length:entries.length});});};var history={get index(){return get_store_value(index);},set index(i){// validate new index
i=Number.isInteger(i)?i:0;i=clamp(i,0,entries.length-1);// remember
index.set(i);setState(entries[history.index]);// update subs
updateSubs();},get state(){return entries[entries.length-1];},length:function length(){return entries.length;},undo:function undo(){var newIndex=history.index--;pub('undo',newIndex);return newIndex;},redo:function redo(){var newIndex=history.index++;pub('redo',history.index);return newIndex;},revert:function revert(){entries.length=1;// retain first state
history.index=0;pub('revert');},write:function write(state){// write history entry
if(state){setState(_objectSpread(_objectSpread({},getState()),state));}var newState=getState();var lastState=entries[entries.length-1];// don't update if new state isn't different
if(JSON.stringify(newState)===JSON.stringify(lastState))return;// reset length to current index
entries.length=history.index+1;// add new entry
entries.push(newState);// move pointer to last added index
index.set(entries.length-1);updateSubs();pub('writehistory');},set:function set(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};// set clears all entries
entries.length=0;history.index=0;// set new entries
var newStateEntries=!Array.isArray(state)?[state]:state;// add new entries
entries.push.apply(entries,_toConsumableArray(newStateEntries));// move pointer to last added index
history.index=entries.length-1;},get:function get(){return[].concat(entries);},subscribe:function subscribe(cb){subs.push(cb);cb({index:history.index,length:entries.length});return function(){return subs.splice(subs.indexOf(cb),1);};},on:sub};return history;};var isChrome=function isChrome(){return isBrowser()&&!!window['chrome'];};var imageBitmapToImageData=/*#__PURE__*/function(){var _ref198=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee54(imageBitmap){return _regeneratorRuntime().wrap(function _callee54$(_context55){while(1)switch(_context55.prev=_context55.next){case 0:_context55.t0=canvasToImageData;_context55.next=3;return imageDataToCanvas(imageBitmap);case 3:_context55.t1=_context55.sent;return _context55.abrupt("return",(0,_context55.t0)(_context55.t1));case 5:case"end":return _context55.stop();}},_callee54);}));return function imageBitmapToImageData(_x92){return _ref198.apply(this,arguments);};}();var isVideoFile=function isVideoFile(blob){return /video/.test(blob.type);};// TODO: VIDEO cleanup?
var videoToImageData=function videoToImageData(file){return new Promise(function(resolve,reject){var video=h('video');video.onseeked=function(){var frame=h('canvas');getVideoElementSize(video).then(function(_ref199){var width=_ref199.width,height=_ref199.height;frame.width=width;frame.height=height;var ctx=frame.getContext('2d',{// we're going to read from this canvas, no need to hardware accelerate it
willReadFrequently:true});var drawFrame=function drawFrame(){ctx.drawImage(video,0,0,frame.width,frame.height);var imageData=ctx.getImageData(0,0,frame.width,frame.height);releaseCanvas(frame);resolve(imageData);};// if we don't use setTimeout for safari sometimes it doesn't draw the frame
isSafari()?setTimeout(drawFrame,16):drawFrame();});};video.onloadeddata=function(){// if we use onloadedmetadata safari doesn't render the frame
video.currentTime=0;};video.onerror=function(e){console.error(e);reject(e);};video.src=URL.createObjectURL(file);video.load();// needed to make video show up on iOS
});};var blobToImageBitmap=function blobToImageBitmap(file,ImageOrienter,canvasMemoryLimit){return new Promise(function(resolve,reject){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee55(){var orientation,toImageData,imageBitmap;return _regeneratorRuntime().wrap(function _callee55$(_context56){while(1)switch(_context56.prev=_context56.next){case 0:if(!isVideoFile(file)){_context56.next=6;break;}_context56.t0=resolve;_context56.next=4;return videoToImageData(file);case 4:_context56.t1=_context56.sent;(0,_context56.t0)(_context56.t1);case 6:_context56.next=8;return ImageOrienter.read(file);case 8:orientation=_context56.sent;// helper method to apply orientation fix if needed
toImageData=function toImageData(file){return blobToImageData(file,canvasMemoryLimit).then(function(imageData){return ImageOrienter.apply(imageData,orientation);}).then(resolve)["catch"](reject);};// if cannot create image bitmaps in worker
// Safari 15 cannot correctly apply orientation, also it will choke on very big images
// when trying to createImageBitmap in thread, so lets just do it on the main thread
// we'll ignore Safari and iOS for now
if(!(isSVGFile(file)||!canCreateImageBitmap()||isSafari()||isIOS())){_context56.next=12;break;}return _context56.abrupt("return",toImageData(file));case 12:_context56.prev=12;_context56.next=15;return thread(function(file,done){return createImageBitmap(file).then(function(bitmap){return done(null,bitmap);})["catch"](done);},[file]);case 15:imageBitmap=_context56.sent;_context56.next=20;break;case 18:_context56.prev=18;_context56.t2=_context56["catch"](12);case 20:if(!(!imageBitmap||!imageBitmap.width)){_context56.next=22;break;}return _context56.abrupt("return",toImageData(file));case 22:_context56.next=24;return canOrientImages();case 24:if(_context56.sent){_context56.next=26;break;}return _context56.abrupt("return",resolve(ImageOrienter.apply(imageBitmap,orientation)));case 26:if(!(isChrome()&&orientation>1)){_context56.next=32;break;}_context56.t3=resolve;_context56.next=30;return imageBitmapToImageData(imageBitmap);case 30:_context56.t4=_context56.sent;return _context56.abrupt("return",(0,_context56.t3)(_context56.t4));case 32:// yay we got our bitmap
resolve(imageBitmap);case 33:case"end":return _context56.stop();}},_callee55,null,[[12,18]]);}))();});};var imageDataContain=function imageDataContain(imageData,size){return new Promise(/*#__PURE__*/function(){var _ref201=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee56(resolve){var scalar,targetWidth,targetHeight,canvas,ctx,data;return _regeneratorRuntime().wrap(function _callee56$(_context57){while(1)switch(_context57.prev=_context57.next){case 0:if(!(imageData.width<size.width&&imageData.height<size.height)){_context57.next=2;break;}return _context57.abrupt("return",resolve(imageData));case 2:scalar=Math.min(size.width/imageData.width,size.height/imageData.height);// scale
targetWidth=scalar*imageData.width;targetHeight=scalar*imageData.height;canvas=h('canvas',{width:targetWidth,height:targetHeight});ctx=canvas.getContext('2d',{willReadFrequently:true});if(!isImageData(imageData)){_context57.next=13;break;}_context57.next=10;return imageDataToCanvas(imageData);case 10:_context57.t0=_context57.sent;_context57.next=14;break;case 13:_context57.t0=imageData;case 14:data=_context57.t0;ctx.drawImage(data,0,0,targetWidth,targetHeight);resolve(canvasToImageData(canvas));case 17:case"end":return _context57.stop();}},_callee56);}));return function(_x93){return _ref201.apply(this,arguments);};}());};var hexToRGB=function hexToRGB(str){var _str$split=str.split(''),_str$split2=_slicedToArray(_str$split,4),q=_str$split2[1],w=_str$split2[2],e=_str$split2[3];str=str.length===4?"#".concat(q).concat(q).concat(w).concat(w).concat(e).concat(e):str;var _exec=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(str),_exec2=_slicedToArray(_exec,4),r=_exec2[1],g=_exec2[2],b=_exec2[3];return[r,g,b].map(function(v){return parseInt(v,16)/255;});};var colorStringToColorArray=function colorStringToColorArray(color){color=color.trim();// if rgba(128, 128, 128, .5)
if(/^rgba/.test(color)){return color.substr(5).split(',').map(parseFloat).map(function(v,i){return v/(i===3?1:255);});}// if rgb(128, 128, 128)
if(/^rgb/.test(color)){return color.substr(4).split(',').map(parseFloat).map(function(v){return v/255;});}// if #777
if(/^#/.test(color)){return hexToRGB(color);}// is possibly 255, 0, 0
if(/[0-9]{1,3}\s?,\s?[0-9]{1,3}\s?,\s?[0-9]{1,3}/.test(color)){return color.split(',').map(function(v){return parseInt(v,10);}).map(function(v){return v/255;});}// undefined if no idea
};var result$3=null;var supportsWebGL=function supportsWebGL(){if(result$3===null){var canvas=h('canvas');result$3=!!getWebGLContext(canvas);releaseCanvas(canvas);canvas=undefined;}return result$3;};var isBitmap=function isBitmap(file){return /^image/.test(file.type)&&!/svg/.test(file.type);};// @ts-ignore
var COLOR_MATRIX_IDENTITY=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];var SPRING_PROPS={precision:0.0001};var SPRING_PROPS_FRACTION={precision:SPRING_PROPS.precision*0.01};var createImage=function createImage(data,size){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var _options$resize=options.resize,resizeInitial=_options$resize===void 0?1:_options$resize,_options$opacity=options.opacity,opacityInitial=_options$opacity===void 0?0:_options$opacity;var stores={// interface
opacity:[spring(opacityInitial,_objectSpread(_objectSpread({},SPRING_PROPS),{},{stiffness:0.1})),passthrough],resize:[spring(resizeInitial,_objectSpread(_objectSpread({},SPRING_PROPS),{},{stiffness:0.1})),passthrough],// transforms
translation:[spring(undefined,SPRING_PROPS),passthrough],rotation:[spring(undefined,SPRING_PROPS_FRACTION),passthrough],origin:[spring(undefined,SPRING_PROPS),passthrough],scale:[spring(undefined,SPRING_PROPS_FRACTION),passthrough],gamma:[spring(undefined,SPRING_PROPS_FRACTION),function(v){return v||1;}],vignette:[spring(undefined,SPRING_PROPS_FRACTION),function(v){return v||0;}],colorMatrix:[spring([].concat(COLOR_MATRIX_IDENTITY),SPRING_PROPS),function(v){return v||[].concat(COLOR_MATRIX_IDENTITY);}],convolutionMatrix:[writable(undefined),function(v){return v&&v.clarity||undefined;}],backgroundColor:[spring(undefined,SPRING_PROPS),function(newValue,currentValue,setHard){if(!Array.isArray(newValue))return undefined;// makes sure
if(Array.isArray(currentValue)){var newColor=_toConsumableArray(newValue);// if going from transparent to opaque
if(currentValue[3]===0){newColor[3]=0;setHard(newColor);}// if going from opaque to transparent
else if(newColor[3]===0){newValue=_toConsumableArray(currentValue);newValue[3]=0;}}return newValue;}],backgroundImage:[writable(undefined),passthrough]};// shortcut to quickly get all stores from the stores object
var storeEntries=Object.entries(stores).map(function(_ref202){var _ref203=_slicedToArray(_ref202,2),key=_ref203[0],value=_ref203[1];return[key,value[0]];});var storeArray=storeEntries.map(function(_ref204){var _ref205=_slicedToArray(_ref204,2),store=_ref205[1];return store;});// create quick accessors to store value setter functions, best to do ones on creation instead of on each update
var storeSetters=Object.entries(stores).reduce(function(prev,_ref206){var _ref207=_slicedToArray(_ref206,2),key=_ref207[0],value=_ref207[1];var _value=_slicedToArray(value,2),store=_value[0],getValue=_value[1];prev[key]=function(value,opts){return store.set(getValue(value,stateCache[key],function(value){store.set(value,{hard:true});}),opts);};return prev;},{});// holds current derived state so can be easily read from from the outside
var stateCache;//
var state=derived(storeArray,function(storeValues){// get new state
stateCache=storeValues.reduce(function(calculatedState,value,index){var key=storeEntries[index][0];calculatedState[key]=value;return calculatedState;},{});// set base image props
stateCache.data=data;stateCache.size=size;// apply resize modifier (is at index 1 of storeValues)
stateCache.scale*=storeValues[1];return stateCache;});state.get=function(){return stateCache;};state.set=function(props,animate){var opts={hard:!animate};Object.entries(props).forEach(function(_ref208){var _ref209=_slicedToArray(_ref208,2),key=_ref209[0],value=_ref209[1];if(!storeSetters[key])return;storeSetters[key](value,opts);});};return state;};var storeList=function storeList(){var stores=[];var subscribers=[];var state=[];var storeDidUpdate=function storeDidUpdate(store,value){var index=stores.indexOf(store);if(index<0)return;state[index]=value;triggerUpdate();};var triggerUpdate=function triggerUpdate(){subscribers.forEach(function(fn){return fn(state);});};var addStore=function addStore(store){store.unsub=store.subscribe(function(value){return storeDidUpdate(store,value);});triggerUpdate();};var unshift=function unshift(store){stores.unshift(store);addStore(store);};var push=function push(store){stores.push(store);addStore(store);};var clear=function clear(){stores.forEach(function(store){return store.unsub();});stores.length=0;state.length=0;};var remove=function remove(store){store.unsub();var index=stores.indexOf(store);stores.splice(index,1);state.splice(index,1);};var subscribe=function subscribe(fn){subscribers.push(fn);fn(state);return function(){subscribers.splice(subscribers.indexOf(fn),1);};};var forEach=function forEach(fn){return stores.forEach(fn);};var filter=function filter(fn){return stores.filter(fn);};var get=function get(index){return stores[index];};return{get length(){return stores.length;},clear:clear,unshift:unshift,get:get,push:push,remove:remove,forEach:forEach,filter:filter,subscribe:subscribe};};var isDarkColor=function isDarkColor(color){return color[0]<0.25&&color[1]<0.25&&color[2]<0.25;};var browse=function browse(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new Promise(function(resolve){// can now pass options
var _options$accept=options.accept,accept=_options$accept===void 0?'image/*':_options$accept;// create file input box
var fileInput=h('input',{style:'position:absolute;visibility:hidden;width:0;height:0;',type:'file',accept:accept});// listen for file changes on input
var handleFileChange=function handleFileChange(){// get file, if one was selected
var _fileInput$files=_slicedToArray(fileInput.files,1),file=_fileInput$files[0];// clean up
fileInput.parentNode&&fileInput.remove();fileInput.removeEventListener('change',handleFileChange);// done
resolve(file);};// listen for changes
fileInput.addEventListener('change',handleFileChange);// need to attach to DOM for Safari 15+
isIOS()&&document.body.append(fileInput);// open browse window
fileInput.click();// there is no way to reliably detect "cancel" event on browsers so we'll leave it be for now
});};var runSafe=function runSafe(cb){try{return cb();}catch(err){console.error(err);}};var getRangeCenter=function getRangeCenter(_ref210){var _ref211=_slicedToArray(_ref210,2),min=_ref211[0],max=_ref211[1];return min+(max-min)*0.5;};var toPercentageNumber=function toPercentageNumber(v){return Math.round(v*100);};var getEventPositionInViewport=function getEventPositionInViewport(e){return vectorCreate(e.clientX,e.clientY);};var getEventPositionInStage=function getEventPositionInStage(e,viewOffset,stageOffset){var positionInViewport=getEventPositionInViewport(e);return vectorSubtract(vectorSubtract(positionInViewport,viewOffset),stageOffset);};/* src/core/ui/components/CanvasPanAndZoom.svelte generated by Svelte v3.52.0 */function instance$y($$self,$$props,$$invalidate){var canZoom;var canPan;var imageFitsOnStage;var zoomLevels;var zoomMin;var zoomMax;var zoomLevelSelectedIndex;var zoomLevelCurrent;var zoomLevelLabel;var $imageSelectionZoom;var $imageSelectionPan;var $imageSelectionStageFitScalar;var $imagePreviewUpscale;var $stageRect;var $rootRect;var $imageSelectionRect;var $isInteracting;var $stageScalar;var $isAnimated;var $imageSelectionStoredState;var root=$$props.root;var locale=$$props.locale;var stores=$$props.stores;var _$$props$allowPan=$$props.allowPan,allowPan=_$$props$allowPan===void 0?true:_$$props$allowPan;var _$$props$allowZoom=$$props.allowZoom,allowZoom=_$$props$allowZoom===void 0?true:_$$props$allowZoom;var _$$props$enablePan=$$props.enablePan,enablePan=_$$props$enablePan===void 0?true:_$$props$enablePan;var _$$props$enableZoom=$$props.enableZoom,enableZoom=_$$props$enableZoom===void 0?true:_$$props$enableZoom;var _$$props$enableZoomCo=$$props.enableZoomControls,enableZoomControls=_$$props$enableZoomCo===void 0?enableZoom:_$$props$enableZoomCo;var _$$props$enableZoomIn=$$props.enableZoomInput,enableZoomInput=_$$props$enableZoomIn===void 0?true:_$$props$enableZoomIn;var _$$props$enablePanInp=$$props.enablePanInput,enablePanInput=_$$props$enablePanInp===void 0?true:_$$props$enablePanInp;var _$$props$enablePanLim=$$props.enablePanLimit,enablePanLimit=_$$props$enablePanLim===void 0?true:_$$props$enablePanLim;var _$$props$panLimitGutt=$$props.panLimitGutterScalar,panLimitGutterScalar=_$$props$panLimitGutt===void 0?0:_$$props$panLimitGutt;var _$$props$zoomOptions=$$props.zoomOptions,zoomOptions=_$$props$zoomOptions===void 0?[0.25,0.5,1,1.25,1.5,2,3,4,6,8,16]:_$$props$zoomOptions;var _$$props$zoomAdjustSt=$$props.zoomAdjustStep,zoomAdjustStep=_$$props$zoomAdjustSt===void 0?0.25:_$$props$zoomAdjustSt;var _$$props$zoomAdjustFa=$$props.zoomAdjustFactor,zoomAdjustFactor=_$$props$zoomAdjustFa===void 0?0.1:_$$props$zoomAdjustFa;var _$$props$zoomAdjustWh=$$props.zoomAdjustWheelFactor,zoomAdjustWheelFactor=_$$props$zoomAdjustWh===void 0?1:_$$props$zoomAdjustWh;var _$$props$elasticity2=$$props.elasticity,elasticity=_$$props$elasticity2===void 0?5:_$$props$elasticity2;var _$$props$imageSelecti=$$props.imageSelectionRectCentered,imageSelectionRectCentered=_$$props$imageSelecti===void 0?undefined:_$$props$imageSelecti;var _$$props$imageSelecti2=$$props.imageSelectionRectScalar,imageSelectionRectScalar=_$$props$imageSelecti2===void 0?undefined:_$$props$imageSelecti2;var _$$props$zoomLevel=$$props.zoomLevel,zoomLevel=_$$props$zoomLevel===void 0?null:_$$props$zoomLevel;var zoomControls=$$props.zoomControls;var _$$props$zoomMultiTou=$$props.zoomMultiTouching,zoomMultiTouching=_$$props$zoomMultiTou===void 0?false:_$$props$zoomMultiTou;var _stores=stores,isAnimated=_stores.isAnimated,isInteracting=_stores.isInteracting,rootRect=_stores.rootRect,stageRect=_stores.stageRect,stageScalar=_stores.stageScalar,imageSelectionPan=_stores.imageSelectionPan,imageSelectionZoom=_stores.imageSelectionZoom,imageSelectionStageFitScalar=_stores.imageSelectionStageFitScalar,imageSelectionRect=_stores.imageSelectionRect,imageSelectionStoredState=_stores.imageSelectionStoredState,imagePreviewUpscale=_stores.imagePreviewUpscale;component_subscribe($$self,isAnimated,function(value){return $$invalidate(68,$isAnimated=value);});component_subscribe($$self,isInteracting,function(value){return $$invalidate(67,$isInteracting=value);});component_subscribe($$self,rootRect,function(value){return $$invalidate(65,$rootRect=value);});component_subscribe($$self,stageRect,function(value){return $$invalidate(64,$stageRect=value);});component_subscribe($$self,stageScalar,function(value){return $$invalidate(45,$stageScalar=value);});component_subscribe($$self,imageSelectionPan,function(value){return $$invalidate(63,$imageSelectionPan=value);});component_subscribe($$self,imageSelectionZoom,function(value){return $$invalidate(42,$imageSelectionZoom=value);});component_subscribe($$self,imageSelectionStageFitScalar,function(value){return $$invalidate(43,$imageSelectionStageFitScalar=value);});component_subscribe($$self,imageSelectionRect,function(value){return $$invalidate(66,$imageSelectionRect=value);});component_subscribe($$self,imageSelectionStoredState,function(value){return $$invalidate(69,$imageSelectionStoredState=value);});component_subscribe($$self,imagePreviewUpscale,function(value){return $$invalidate(44,$imagePreviewUpscale=value);});// to toggle mouse cursor
var isPanning=false;var panOrigin=undefined;var zoomOrigin=undefined;var isPanningToCenter=undefined;var currentDistanceToCenter=undefined;var shouldStartInteraction=function shouldStartInteraction(e){// currently active stage panel
var main=root.querySelector('.PinturaMain > .PinturaUtilMain')||root.querySelector('div[tabindex="0"] .PinturaUtilMain');// somehow main not found
if(!main)return false;// only handle if is interaction in main stage
if(!main.contains(e.target))return false;// never on text fields
if(isTextField(e.target))return false;return true;};var storePanAndZoom=function storePanAndZoom(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _options$pan=options.pan,pan=_options$pan===void 0?$imageSelectionPan:_options$pan,_options$zoom=options.zoom,zoom=_options$zoom===void 0?$imageSelectionZoom:_options$zoom;set_store_value(imageSelectionStoredState,$imageSelectionStoredState={translation:pan,zoom:zoom},$imageSelectionStoredState);};var isImageSelectionPanCentered=function isImageSelectionPanCentered(){return $imageSelectionPan&&$imageSelectionPan.x===0&&$imageSelectionPan.y===0;};var resetPanToCenter=function resetPanToCenter(){if(isImageSelectionPanCentered())return;set_store_value(imageSelectionPan,$imageSelectionPan=vectorCreateEmpty(),$imageSelectionPan);};var restorePanAndZoom=function restorePanAndZoom(){set_store_value(imageSelectionZoom,$imageSelectionZoom=enableZoom?$imageSelectionStoredState.zoom:undefined,$imageSelectionZoom);set_store_value(imageSelectionPan,$imageSelectionPan=enablePan?vectorClone($imageSelectionStoredState.translation):isImageSelectionPanCentered()?$imageSelectionPan:vectorCreateEmpty(),$imageSelectionPan);zoomAdjust.set($imageSelectionZoom);};var resetPanAndZoom=function resetPanAndZoom(){set_store_value(imageSelectionZoom,$imageSelectionZoom=undefined,$imageSelectionZoom);resetPanToCenter();zoomAdjust.set(undefined,{hard:true});};var snapToCenter=function snapToCenter(){resetPanAndZoom();storePanAndZoom();};// this smoothens updates to the zoom level
var zoomAdjust=spring(undefined,{precision:0.01});zoomAdjust.subscribe(function(newValue){// no value yet, wait
if(newValue===undefined){set_store_value(imageSelectionZoom,$imageSelectionZoom=undefined,$imageSelectionZoom);if(!isImageSelectionPanCentered())set_store_value(imageSelectionPan,$imageSelectionPan=vectorCreateEmpty(),$imageSelectionPan);return;}var currentValue=$imageSelectionZoom;if(newValue<=1){if(!isImageSelectionPanCentered())set_store_value(imageSelectionPan,$imageSelectionPan=vectorCreateEmpty(),$imageSelectionPan);}else if(newValue<=currentValue){set_store_value(imageSelectionPan,$imageSelectionPan=vectorMultiply($imageSelectionPan,0.8),$imageSelectionPan);}set_store_value(imageSelectionZoom,$imageSelectionZoom=newValue,$imageSelectionZoom);});var updateZoomAdjust=function updateZoomAdjust(update){zoomAdjust.update(function(currentValue){var newValue=update(currentValue||$imageSelectionStageFitScalar);// remember new value
storePanAndZoom({zoom:newValue});return newValue;});};var setZoomAdjust=function setZoomAdjust(newValue){if(!newValue){newValue=undefined;zoomAdjust.set(undefined,{hard:true});}else{zoomAdjust.set(newValue,{hard:$isAnimated===false});}// update zoom
set_store_value(imageSelectionZoom,$imageSelectionZoom=newValue,$imageSelectionZoom);// remember
storePanAndZoom({zoom:newValue});};var getSelectedZoomLevel=function getSelectedZoomLevel(levels,currentScalar){return levels.findIndex(function(level){return level===currentScalar;});};//
// interaction
//
var getPanLimitedTranslation=function getPanLimitedTranslation(pan,zoom){var scalar=imageSelectionRectScalar*zoom;// this is the current image centered on the stage which we'll use as drag bounds
var safeRect=_objectSpread({},imageSelectionRectCentered);// apply gutter
var gutterScalar=1.0-clamp(panLimitGutterScalar,0.0,1.0);rectScale$1(safeRect,scalar<gutterScalar?scalar:gutterScalar);// here we need to
var nextRect=_objectSpread({},imageSelectionRectCentered);rectScale$1(nextRect,scalar);rectTranslate$1(nextRect,pan);var nextRectLimited=_objectSpread({},nextRect);if(nextRect.x>safeRect.x)nextRectLimited.x=safeRect.x;if(nextRect.y>safeRect.y)nextRectLimited.y=safeRect.y;if(nextRect.x+nextRect.width<safeRect.x+safeRect.width)nextRectLimited.x=safeRect.x+safeRect.width-nextRect.width;if(nextRect.y+nextRect.height<safeRect.y+safeRect.height)nextRectLimited.y=safeRect.y+safeRect.height-nextRect.height;return vectorSubtract(rectCenter(nextRectLimited),rectCenter(safeRect));};var manipulatePan=function manipulatePan(_ref212){var translation=_ref212.translation,_ref212$zoom=_ref212.zoom,zoom=_ref212$zoom===void 0?1:_ref212$zoom,_ref212$elastify=_ref212.elastify,elastify=_ref212$elastify===void 0?true:_ref212$elastify;if(!panOrigin)return;var panTranslation=translation;var nextPan=vectorCreate(panOrigin.x+panTranslation.x,panOrigin.y+panTranslation.y);if(!enablePanLimit)return nextPan;var nextPanLimited=getPanLimitedTranslation(nextPan,zoom);return elastify?elastifyVectors(nextPanLimited,nextPan,elasticity):nextPanLimited;};var didPan;var lastDragInteraction;var handleDragStart=function handleDragStart(){lastDragInteraction=undefined;// set to true so updates aren't animated
set_store_value(isInteracting,$isInteracting=true,$isInteracting);// set to true so grab cursor is shown
$$invalidate(33,isPanning=enablePanInput);// did interact with canvas
didPan=false;// we need to determine if panning to center so we can snap zoom
isPanningToCenter=false;// so we can correctly apply drag translation
panOrigin=_objectSpread({},$imageSelectionPan);// so we can correctly apply zoom adjustment
zoomOrigin=$imagePreviewUpscale?$imageSelectionZoom||$imageSelectionStageFitScalar:imageFitsOnStage?$imageSelectionZoom||1:$imageSelectionZoom||$imageSelectionStageFitScalar;};var handleDrag=function handleDrag(e){var _e$detail=e.detail,scalar=_e$detail.scalar,translation=_e$detail.translation,isMultiTouching=_e$detail.isMultiTouching;if(!panOrigin||!(isMultiTouching||enablePanInput))return;// TODO: research why this is needed. this makes movement of image better align with touch,
// misalignment problem originates in `interactable`
// this "fix" works here because we can only multitouch, it doesn't work in crop util because user can switch between single and multi input
isMultiTouching&&vectorMultiply(translation,0.5);if(enablePanInput||isMultiTouching)didPan=true;// set to true when multiple fingers detected
if(!zoomMultiTouching)$$invalidate(12,zoomMultiTouching=isMultiTouching);// next zoom
var nextZoom=canZoom?clamp(zoomOrigin*scalar,zoomMin,zoomMax):1;// need this info to determine if we're panning to center
var nextPan=manipulatePan({translation:translation,zoom:nextZoom,elastify:true});// calculate if is panning to center, we'll look at the result when user is done interacting with the canvas
var nextDistanceToCenter=vectorLength(nextPan);var currentPan=$imageSelectionPan;currentDistanceToCenter=vectorLength(currentPan);isPanningToCenter=nextDistanceToCenter<currentDistanceToCenter;// assign new pan/zoom values
if(canZoom)imageSelectionZoom.set(nextZoom);imageSelectionPan.set(nextPan);lastDragInteraction=zoomMultiTouching&&{translation:e.detail.translation,scalar:scalar};};var handleDragRelease=function handleDragRelease(e){set_store_value(isInteracting,$isInteracting=false,$isInteracting);$$invalidate(33,isPanning=false);$$invalidate(12,zoomMultiTouching=false);// if is panning to center snap to center
if(isPanningToCenter&&currentDistanceToCenter<50){// stop drag action
panOrigin=undefined;zoomOrigin=undefined;imageSelectionPan.set(vectorCreateEmpty());}};var handleDragEnd=function handleDragEnd(e){// done interacting
set_store_value(isInteracting,$isInteracting=false,$isInteracting);// clean up
$$invalidate(33,isPanning=false);$$invalidate(12,zoomMultiTouching=false);// to make sure interaction is turned off before pan is updated we set it on next tick
// this is a bit of a hack.
// TODO: look into queueing interaction and ui updates so we can reliably disable/enable isInteracting and then run ui updates so they're properly animated
Promise.resolve().then(function(){if(didPan&&panOrigin){var interaction=lastDragInteraction||e.detail;// next zoom
var nextZoom=canZoom?clamp(zoomOrigin*interaction.scalar,zoomMin,zoomMax):1;// snap back to center if needed
var nextPan=manipulatePan({elastify:false,translation:interaction.translation,zoom:nextZoom});imageSelectionPan.set(nextPan);}panOrigin=undefined;zoomOrigin=undefined;// reset zoom
if(enablePanInput&&e.detail.isDoubleTap)snapToCenter();// store for future
storePanAndZoom();});};// wheel input
var lastWheelEventTimestamp=Date.now();var wheelSnapZoomTimer;var wheelFastZoomCounter=0;var wheelFastZoomShouldHandle=false;var didSnap=false;var handleWheel=function handleWheel(e){// determine if wheel position is over image, else ignore
if(!shouldStartInteraction(e))return;// don't run default actions, prevent other actions from running
e.preventDefault();e.stopPropagation();if(didSnap)return;clearTimeout(wheelSnapZoomTimer);// for determining if fast zooming
var now=Date.now();var wheelInterval=now-lastWheelEventTimestamp;lastWheelEventTimestamp=now;var isZoomingFast=wheelInterval<24;wheelFastZoomCounter=isZoomingFast?wheelFastZoomCounter+1:0;// convert wheel delta to scalar
var delta=getWheelDelta(e)*-1*zoomAdjustWheelFactor;var scalar=1+delta/(isZoomingFast?50:100);var stageWheelPosition=getEventPositionInStage(e,$rootRect,$stageRect);// update zoom
updateZoom(stageWheelPosition,scalar,{isZoomingFast:isZoomingFast});};var updateZoom=function updateZoom(stagePosition,scalar,_ref213){var isZoomingFast=_ref213.isZoomingFast;var currentZoom=$imagePreviewUpscale?$imageSelectionZoom||$imageSelectionStageFitScalar:imageFitsOnStage?$imageSelectionZoom||1:$imageSelectionZoom||$imageSelectionStageFitScalar;var nextZoom=currentZoom*scalar;var newTranslation=vectorCreateEmpty();var currentTranslation=$imageSelectionPan;var zoomCenter=$imagePreviewUpscale?$imageSelectionStageFitScalar:imageFitsOnStage?1:$imageSelectionStageFitScalar;var nextZoomDistanceToCenter=Math.abs(nextZoom-zoomCenter);// zoom state
var isZoomedIn=currentZoom>zoomCenter;var isZoomedOut=currentZoom<zoomCenter;var isZoomingIn=nextZoom>currentZoom;var isZoomingOut=nextZoom<currentZoom;var isZoomingToCenter=isZoomedIn&&isZoomingOut||isZoomedOut&&isZoomingIn;var isZoomingFlick=wheelFastZoomCounter>=5;if(!isZoomingFast){wheelFastZoomShouldHandle=false;}if(wheelFastZoomCounter>0&&!wheelFastZoomShouldHandle){wheelFastZoomShouldHandle=isZoomingToCenter;}// quick snap to place
if(isZoomingFlick&&wheelFastZoomShouldHandle){snapToCenter();didSnap=true;setTimeout(function(){didSnap=false;},100);return;}// stop here, if flicks wheel we're not going to handle it
if(isZoomingFlick)return;// snap when positioned very close to center
if(!isZoomingFast&&isZoomingToCenter&&nextZoomDistanceToCenter<=0.05){wheelSnapZoomTimer=setTimeout(function(){snapToCenter();},250);}// update zoom
set_store_value(imageSelectionZoom,$imageSelectionZoom=clamp(nextZoom,zoomMin,zoomMax),$imageSelectionZoom);// get wheel position so we can zoom to specific area of image
var originSelectionRect=rectClone$1($imageSelectionRect);rectScale$1(originSelectionRect,currentZoom);rectTranslate$1(originSelectionRect,currentTranslation);var originSelectionRectCenter=rectCenter(originSelectionRect);var zoomedSelectionRect=rectClone$1(originSelectionRect);rectScale$1(zoomedSelectionRect,1+($imageSelectionZoom-currentZoom),stagePosition);var zoomedSelectionRectCenter=rectCenter(zoomedSelectionRect);var rectTranslation=vectorDivide(vectorSubtract(zoomedSelectionRectCenter,originSelectionRectCenter),currentZoom);vectorUpdate(newTranslation,currentTranslation.x+rectTranslation.x,currentTranslation.y+rectTranslation.y);//  if zooming out fast move to center
if(isZoomingOut&&isZoomingFast){set_store_value(imageSelectionPan,$imageSelectionPan=vectorMultiply(vectorClone($imageSelectionPan),0.85),$imageSelectionPan);}else{set_store_value(imageSelectionPan,$imageSelectionPan=getPanLimitedTranslation(newTranslation,currentZoom),$imageSelectionPan);}// store for future
storePanAndZoom();};// toggle listeners
var getListenerFunction=function getListenerFunction(enable){return(enable?'add':'remove')+'EventListener';};var gestureZoomOffset;var gesturePanOffset;var gestureStagePosition;var gestureSelectionRect;var handleGestureStart=function handleGestureStart(e){e.preventDefault();// so we can correctly apply drag translation
gesturePanOffset=_objectSpread({},$imageSelectionPan);gestureSelectionRect=rectClone$1($imageSelectionRect);gestureStagePosition=getEventPositionInStage(e,$rootRect,$stageRect);gestureZoomOffset=$imagePreviewUpscale?$imageSelectionZoom||$imageSelectionStageFitScalar:imageFitsOnStage?$imageSelectionZoom||1:$imageSelectionZoom||$imageSelectionStageFitScalar;};var handleGesture=function handleGesture(e){e.preventDefault();set_store_value(imageSelectionZoom,$imageSelectionZoom=clamp(e.scale*gestureZoomOffset,zoomMin,zoomMax),$imageSelectionZoom);var originSelectionRect=rectClone$1(gestureSelectionRect);rectScale$1(originSelectionRect,gestureZoomOffset);rectTranslate$1(originSelectionRect,gesturePanOffset);var originSelectionRectCenter=rectCenter(originSelectionRect);var zoomedSelectionRect=rectClone$1(originSelectionRect);rectScale$1(zoomedSelectionRect,1+($imageSelectionZoom-gestureZoomOffset),gestureStagePosition);var zoomedSelectionRectCenter=rectCenter(zoomedSelectionRect);var rectTranslation=vectorDivide(vectorSubtract(zoomedSelectionRectCenter,originSelectionRectCenter),gestureZoomOffset);var pan={x:gesturePanOffset.x+rectTranslation.x,y:gesturePanOffset.y+rectTranslation.y};set_store_value(imageSelectionPan,$imageSelectionPan=getPanLimitedTranslation(pan,$imageSelectionZoom),$imageSelectionPan);};var handleGestureEnd=function handleGestureEnd(e){e.preventDefault();};var toggleZoomInput=function toggleZoomInput(enable){// wheel zooming
root[getListenerFunction(enable)]('wheel',handleWheel);// macos touchpad zooming, not on iOS as will conflict with handling of multitouch pointer events
if(isIOS())return;root[getListenerFunction(enable)]('gesturestart',handleGestureStart);root[getListenerFunction(enable)]('gesturechange',handleGesture);root[getListenerFunction(enable)]('gestureend',handleGestureEnd);};var togglePanInput=function togglePanInput(enable){var fn=getListenerFunction(enable);root[fn]('interactionstart',handleDragStart);root[fn]('interactionupdate',handleDrag);root[fn]('interactionrelease',handleDragRelease);root[fn]('interactionend',handleDragEnd);};// mount & destroy
var interactableInstance;onMount(function(){interactableInstance=interactable(root,{drag:true,pinch:true,inertia:true,inertiaDurationMultiplier:10,shouldStartInteraction:shouldStartInteraction});});onDestroy(function(){toggleZoomInput(false);togglePanInput(false);interactableInstance.destroy();interactableInstance=undefined;});$$self.$$set=function($$props){if('root'in $$props)$$invalidate(13,root=$$props.root);if('locale'in $$props)$$invalidate(14,locale=$$props.locale);if('stores'in $$props)$$invalidate(15,stores=$$props.stores);if('allowPan'in $$props)$$invalidate(16,allowPan=$$props.allowPan);if('allowZoom'in $$props)$$invalidate(17,allowZoom=$$props.allowZoom);if('enablePan'in $$props)$$invalidate(18,enablePan=$$props.enablePan);if('enableZoom'in $$props)$$invalidate(19,enableZoom=$$props.enableZoom);if('enableZoomControls'in $$props)$$invalidate(20,enableZoomControls=$$props.enableZoomControls);if('enableZoomInput'in $$props)$$invalidate(21,enableZoomInput=$$props.enableZoomInput);if('enablePanInput'in $$props)$$invalidate(22,enablePanInput=$$props.enablePanInput);if('enablePanLimit'in $$props)$$invalidate(23,enablePanLimit=$$props.enablePanLimit);if('panLimitGutterScalar'in $$props)$$invalidate(24,panLimitGutterScalar=$$props.panLimitGutterScalar);if('zoomOptions'in $$props)$$invalidate(25,zoomOptions=$$props.zoomOptions);if('zoomAdjustStep'in $$props)$$invalidate(26,zoomAdjustStep=$$props.zoomAdjustStep);if('zoomAdjustFactor'in $$props)$$invalidate(27,zoomAdjustFactor=$$props.zoomAdjustFactor);if('zoomAdjustWheelFactor'in $$props)$$invalidate(28,zoomAdjustWheelFactor=$$props.zoomAdjustWheelFactor);if('elasticity'in $$props)$$invalidate(29,elasticity=$$props.elasticity);if('imageSelectionRectCentered'in $$props)$$invalidate(30,imageSelectionRectCentered=$$props.imageSelectionRectCentered);if('imageSelectionRectScalar'in $$props)$$invalidate(31,imageSelectionRectScalar=$$props.imageSelectionRectScalar);if('zoomLevel'in $$props)$$invalidate(32,zoomLevel=$$props.zoomLevel);if('zoomControls'in $$props)$$invalidate(11,zoomControls=$$props.zoomControls);if('zoomMultiTouching'in $$props)$$invalidate(12,zoomMultiTouching=$$props.zoomMultiTouching);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*allowZoom, enableZoom, enableZoomInput*/2752512){$$invalidate(35,canZoom=allowZoom&&enableZoom&&enableZoomInput);}if($$self.$$.dirty[0]&/*allowPan, enablePan*/327680){$$invalidate(34,canPan=allowPan&&enablePan);}if($$self.$$.dirty[0]&/*allowPan, allowZoom*/196608){// restore when becomes active
allowPan||allowZoom?restorePanAndZoom():resetPanAndZoom();}if($$self.$$.dirty[1]&/*$stageScalar*/16384){imageFitsOnStage=$stageScalar>=1;}if($$self.$$.dirty[0]&/*locale, zoomOptions*/33570816|$$self.$$.dirty[1]&/*$imagePreviewUpscale, $stageScalar, $imageSelectionStageFitScalar*/28672){// the list of zoom levels
$$invalidate(39,zoomLevels=[// zoom level need to fit to view
($imagePreviewUpscale||$stageScalar<1)&&[$imageSelectionStageFitScalar,toPercentageNumber($imageSelectionStageFitScalar)+'%',{sublabel:locale.labelZoomFit}]].concat(_toConsumableArray(zoomOptions.map(function(value){return[value,toPercentageNumber(value)+'%'];}))).filter(Boolean).map(function(level){if(level[0]===1)level[2]={sublabel:locale.labelZoomActual};return level;}).sort(function(a,b){var av=a[0]||$imageSelectionStageFitScalar;var bv=b[0]||$imageSelectionStageFitScalar;if(av<bv)return-1;if(bv<av)return 1;return 0;}));}if($$self.$$.dirty[1]&/*zoomLevels, $imageSelectionStageFitScalar*/4352){$$invalidate(37,zoomMin=Math.min(zoomLevels.reduce(function(min,_ref214){var _ref215=_slicedToArray(_ref214,1),level=_ref215[0];return level<min?level:min;},Number.MAX_SAFE_INTEGER),$imageSelectionStageFitScalar));}if($$self.$$.dirty[1]&/*zoomLevels*/256){$$invalidate(36,zoomMax=zoomLevels.reduce(function(max,_ref216){var _ref217=_slicedToArray(_ref216,1),level=_ref217[0];return level>max?level:max;},Number.MIN_SAFE_INTEGER));}if($$self.$$.dirty[1]&/*zoomLevel*/2){zoomLevel!==null&&setZoomAdjust(zoomLevel);}if($$self.$$.dirty[1]&/*$imageSelectionZoom, $imagePreviewUpscale, $stageScalar, $imageSelectionStageFitScalar*/30720){$$invalidate(41,zoomLevelCurrent=$imageSelectionZoom?$imageSelectionZoom:$imagePreviewUpscale||$stageScalar<1?$imageSelectionStageFitScalar:1);}if($$self.$$.dirty[1]&/*zoomLevels, zoomLevelCurrent*/1280){$$invalidate(38,zoomLevelSelectedIndex=getSelectedZoomLevel(zoomLevels.map(function(_ref218){var _ref219=_slicedToArray(_ref218,1),level=_ref219[0];return level;}),zoomLevelCurrent));}if($$self.$$.dirty[1]&/*zoomLevelCurrent*/1024){$$invalidate(40,zoomLevelLabel=toPercentageNumber(zoomLevelCurrent)+'%');}if($$self.$$.dirty[0]&/*allowZoom, enableZoomControls, locale, zoomAdjustStep, zoomAdjustFactor*/202522624|$$self.$$.dirty[1]&/*$imageSelectionZoom, zoomMin, zoomLevelLabel, zoomLevels, zoomLevelSelectedIndex, zoomMax*/3040){$$invalidate(11,zoomControls=(allowZoom||allowZoom)&&enableZoomControls?[['Button','zoom-out',{hideLabel:true,label:locale.labelZoomOut,icon:locale.iconZoomOut,disabled:$imageSelectionZoom===zoomMin,onclick:function onclick(){return updateZoomAdjust(function(value){return Math.max(zoomMin,value-zoomAdjustStep);});},onhold:function onhold(){return updateZoomAdjust(function(value){return Math.max(zoomMin,value*(1-zoomAdjustFactor));});}}],['Dropdown','zoom-level',{label:zoomLevelLabel,labelClass:'PinturaFixedWidthCharacters',options:zoomLevels,selectedIndex:zoomLevelSelectedIndex,onchange:function onchange(item){return setZoomAdjust(item.value);}}],['Button','zoom-in',{hideLabel:true,label:locale.labelZoomIn,icon:locale.iconZoomIn,disabled:$imageSelectionZoom===zoomMax,onclick:function onclick(){return updateZoomAdjust(function(value){return Math.min(zoomMax,value+zoomAdjustStep);});},onhold:function onhold(){return updateZoomAdjust(function(value){return Math.min(zoomMax,value*(1+zoomAdjustFactor));});}}]]:[]);}if($$self.$$.dirty[0]&/*root*/8192|$$self.$$.dirty[1]&/*canZoom*/16){root&&toggleZoomInput(canZoom);}if($$self.$$.dirty[0]&/*root*/8192|$$self.$$.dirty[1]&/*canPan*/8){root&&togglePanInput(canPan);}if($$self.$$.dirty[0]&/*root, enablePanInput*/4202496|$$self.$$.dirty[1]&/*canPan, isPanning*/12){root&&root.style.setProperty('--cursor',canPan&&enablePanInput?isPanning?'grabbing':'grab':'');}};return[isAnimated,isInteracting,rootRect,stageRect,stageScalar,imageSelectionPan,imageSelectionZoom,imageSelectionStageFitScalar,imageSelectionRect,imageSelectionStoredState,imagePreviewUpscale,zoomControls,zoomMultiTouching,root,locale,stores,allowPan,allowZoom,enablePan,enableZoom,enableZoomControls,enableZoomInput,enablePanInput,enablePanLimit,panLimitGutterScalar,zoomOptions,zoomAdjustStep,zoomAdjustFactor,zoomAdjustWheelFactor,elasticity,imageSelectionRectCentered,imageSelectionRectScalar,zoomLevel,isPanning,canPan,canZoom,zoomMax,zoomMin,zoomLevelSelectedIndex,zoomLevels,zoomLevelLabel,zoomLevelCurrent,$imageSelectionZoom,$imageSelectionStageFitScalar,$imagePreviewUpscale,$stageScalar];}var CanvasPanAndZoom=/*#__PURE__*/function(_SvelteComponent20){_inherits(CanvasPanAndZoom,_SvelteComponent20);var _super21=_createSuper(CanvasPanAndZoom);function CanvasPanAndZoom(options){var _this22;_classCallCheck(this,CanvasPanAndZoom);_this22=_super21.call(this);init(_assertThisInitialized(_this22),options,instance$y,null,safe_not_equal,{root:13,locale:14,stores:15,allowPan:16,allowZoom:17,enablePan:18,enableZoom:19,enableZoomControls:20,enableZoomInput:21,enablePanInput:22,enablePanLimit:23,panLimitGutterScalar:24,zoomOptions:25,zoomAdjustStep:26,zoomAdjustFactor:27,zoomAdjustWheelFactor:28,elasticity:29,imageSelectionRectCentered:30,imageSelectionRectScalar:31,zoomLevel:32,zoomControls:11,zoomMultiTouching:12},null,[-1,-1,-1,-1]);return _this22;}return _createClass(CanvasPanAndZoom);}(SvelteComponent);// Bytes for degree metadata
// 0 degrees
// 00010000 00000000 00000000 00000000
// 00010000 00000000 00000000 00000000
// 40
// 90 degrees
// 00000000 00010000 00000000 FFFF0000
// 00000000 00000000 00000000 00000000
// 40
// 180 degrees
// FFFF0000 00000000 00000000 00000000
// FFFF0000 00000000 00000000 00000000
// 40
// 270 degrees
// 00000000 FFFF0000 00000000 00010000
// 00000000 00000000 00000000 00000000
// 40
var getVideoFileRotationMetadata=/*#__PURE__*/function(){var _ref220=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee57(file){var buffer,view;return _regeneratorRuntime().wrap(function _callee57$(_context58){while(1)switch(_context58.prev=_context58.next){case 0:_context58.next=2;return blobToArrayBuffer(file);case 2:buffer=_context58.sent;view=new DataView(buffer);return _context58.abrupt("return",getRotationMetadataInDataView(view));case 5:case"end":return _context58.stop();}},_callee57);}));return function getVideoFileRotationMetadata(_x94){return _ref220.apply(this,arguments);};}();var blobToArrayBuffer=function blobToArrayBuffer(blob){return new Promise(function(resolve){var reader=new FileReader();reader.onload=function(){return resolve(reader.result);};reader.readAsArrayBuffer(blob);});};var getRotationMetadataInDataView=function getRotationMetadataInDataView(view){var _ref221=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref221$limit=_ref221.limit,limit=_ref221$limit===void 0?1024:_ref221$limit;var FTYP_MARKER=0x66747970;// QuickTime Container File Type
var MP42_MARKER=0x6d703432;// MP4 format
var TRAK_MARKER=0x7472616b;// Video track
var ROTA_MARKER=0x40;// Rotation byte
var offset=0;// const size = view.getUint32(offset);
offset+=4;var container=view.getUint32(offset);if(container!==FTYP_MARKER)return 0;offset+=4;var format=view.getUint32(offset);if(format!==MP42_MARKER)return 0;var inTrack=false;// rotation marker offset
var r=-1;for(var i=offset;i<limit;i++){// find start of video track
if(!inTrack&&view.getUint32(i)===TRAK_MARKER){inTrack=true;i+=4;}// not found yet, skip to next byte
if(!inTrack)continue;// found, let's search rotation marker
var value=view.getUint8(i);// now looking for rotation marker offset
if(value==ROTA_MARKER){r=i;break;}}// rotation marker not found, exit
if(r<0)return 0;// Let's read bytes preceding the rotation marker entry to check rotation value
var B=view.getUint32(r-28);var D=view.getUint32(r-20);var A=view.getUint32(r-32);var E=view.getUint32(r-16);if(B===0x00010000&&D===0xffff0000)return 90;else if(A===0xffff0000&&E===0xffff0000)return 180;else if(B===0xffff0000&&D===0x00010000)return 270;return 0;};/* src/core/ui/index.svelte generated by Svelte v3.52.0 */var window_1$1=globals.window;function create_if_block_1$7(ctx){var t;var if_block1_anchor;var current;var if_block0=/*isStatusVisible*/ctx[39]&&create_if_block_6$1(ctx);var if_block1=/*isReady*/ctx[37]&&create_if_block_2$6(ctx);return{c:function c(){if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();if_block1_anchor=empty();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,if_block1_anchor,anchor);current=true;},p:function p(ctx,dirty){if(/*isStatusVisible*/ctx[39]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[1]&/*isStatusVisible*/256){transition_in(if_block0,1);}}else{if_block0=create_if_block_6$1(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t.parentNode,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*isReady*/ctx[37]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[1]&/*isReady*/64){transition_in(if_block1,1);}}else{if_block1=create_if_block_2$6(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(if_block1_anchor.parentNode,if_block1_anchor);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t);if(if_block1)if_block1.d(detaching);if(detaching)detach(if_block1_anchor);}};}// (3251:8) {#if isStatusVisible}
function create_if_block_6$1(ctx){var div;var _p;var current_block_type_index;var if_block;var div_style_value;var current;var if_block_creators=[create_if_block_7,create_if_block_8];var if_blocks=[];function select_block_type(ctx,dirty){if(/*isSupportsError*/ctx[38])return 0;if(/*statusState*/ctx[33])return 1;return-1;}if(~(current_block_type_index=select_block_type(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){div=element("div");_p=element("p");if(if_block)if_block.c();attr(_p,"style",/*statusTransform*/ctx[67]);attr(div,"class","PinturaStatus");attr(div,"style",div_style_value="opacity: ".concat(/*$statusOpacity*/ctx[51]));},m:function m(target,anchor){insert(target,div,anchor);append(div,_p);if(~current_block_type_index){if_blocks[current_block_type_index].m(_p,null);}current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(_p,null);}else{if_block=null;}}if(!current||dirty[2]&/*statusTransform*/32){attr(_p,"style",/*statusTransform*/ctx[67]);}if(!current||dirty[1]&/*$statusOpacity*/1048576&&div_style_value!==(div_style_value="opacity: ".concat(/*$statusOpacity*/ctx[51]))){attr(div,"style",div_style_value);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(~current_block_type_index){if_blocks[current_block_type_index].d();}}};}// (3264:42) 
function create_if_block_8(ctx){var statusmessage;var t;var if_block_anchor;var current;statusmessage=new StatusMessage({props:{text:/*statusState*/ctx[33].text||'',onmeasure:/*offsetAside*/ctx[189]}});var if_block=/*statusState*/ctx[33].aside&&create_if_block_9(ctx);return{c:function c(){create_component(statusmessage.$$.fragment);t=space();if(if_block)if_block.c();if_block_anchor=empty();},m:function m(target,anchor){mount_component(statusmessage,target,anchor);insert(target,t,anchor);if(if_block)if_block.m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,dirty){var statusmessage_changes={};if(dirty[1]&/*statusState*/4)statusmessage_changes.text=/*statusState*/ctx[33].text||'';statusmessage.$set(statusmessage_changes);if(/*statusState*/ctx[33].aside){if(if_block){if_block.p(ctx,dirty);if(dirty[1]&/*statusState*/4){transition_in(if_block,1);}}else{if_block=create_if_block_9(ctx);if_block.c();transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}},i:function i(local){if(current)return;transition_in(statusmessage.$$.fragment,local);transition_in(if_block);current=true;},o:function o(local){transition_out(statusmessage.$$.fragment,local);transition_out(if_block);current=false;},d:function d(detaching){destroy_component(statusmessage,detaching);if(detaching)detach(t);if(if_block)if_block.d(detaching);if(detaching)detach(if_block_anchor);}};}// (3254:20) {#if isSupportsError}
function create_if_block_7(ctx){var statusmessage;var t;var statusaside;var current;statusmessage=new StatusMessage({props:{text:/*isSupportsError*/ctx[38],onmeasure:/*offsetAside*/ctx[189]}});statusaside=new StatusAside({props:{"class":"PinturaStatusIcon",offset:/*$asideOffset*/ctx[77],opacity:/*$asideOpacity*/ctx[78],$$slots:{"default":[create_default_slot_4$1]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(statusmessage.$$.fragment);t=space();create_component(statusaside.$$.fragment);},m:function m(target,anchor){mount_component(statusmessage,target,anchor);insert(target,t,anchor);mount_component(statusaside,target,anchor);current=true;},p:function p(ctx,dirty){var statusmessage_changes={};if(dirty[1]&/*isSupportsError*/128)statusmessage_changes.text=/*isSupportsError*/ctx[38];statusmessage.$set(statusmessage_changes);var statusaside_changes={};if(dirty[2]&/*$asideOffset*/32768)statusaside_changes.offset=/*$asideOffset*/ctx[77];if(dirty[2]&/*$asideOpacity*/65536)statusaside_changes.opacity=/*$asideOpacity*/ctx[78];if(dirty[0]&/*locale*/8|dirty[16]&/*$$scope*/524288){statusaside_changes.$$scope={dirty:dirty,ctx:ctx};}statusaside.$set(statusaside_changes);},i:function i(local){if(current)return;transition_in(statusmessage.$$.fragment,local);transition_in(statusaside.$$.fragment,local);current=true;},o:function o(local){transition_out(statusmessage.$$.fragment,local);transition_out(statusaside.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(statusmessage,detaching);if(detaching)detach(t);destroy_component(statusaside,detaching);}};}// (3267:24) {#if statusState.aside}
function create_if_block_9(ctx){var statusaside;var current;statusaside=new StatusAside({props:{"class":"PinturaStatusButton",offset:/*$asideOffset*/ctx[77],opacity:/*$asideOpacity*/ctx[78],$$slots:{"default":[create_default_slot_6]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(statusaside.$$.fragment);},m:function m(target,anchor){mount_component(statusaside,target,anchor);current=true;},p:function p(ctx,dirty){var statusaside_changes={};if(dirty[2]&/*$asideOffset*/32768)statusaside_changes.offset=/*$asideOffset*/ctx[77];if(dirty[2]&/*$asideOpacity*/65536)statusaside_changes.opacity=/*$asideOpacity*/ctx[78];if(dirty[1]&/*statusState*/4|dirty[16]&/*$$scope*/524288){statusaside_changes.$$scope={dirty:dirty,ctx:ctx};}statusaside.$set(statusaside_changes);},i:function i(local){if(current)return;transition_in(statusaside.$$.fragment,local);current=true;},o:function o(local){transition_out(statusaside.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(statusaside,detaching);}};}// (3273:32) {#if statusState.progressIndicator.visible}
function create_if_block_11(ctx){var progressindicator;var current;progressindicator=new ProgressIndicator({props:{progress:/*statusState*/ctx[33].progressIndicator.progress}});return{c:function c(){create_component(progressindicator.$$.fragment);},m:function m(target,anchor){mount_component(progressindicator,target,anchor);current=true;},p:function p(ctx,dirty){var progressindicator_changes={};if(dirty[1]&/*statusState*/4)progressindicator_changes.progress=/*statusState*/ctx[33].progressIndicator.progress;progressindicator.$set(progressindicator_changes);},i:function i(local){if(current)return;transition_in(progressindicator.$$.fragment,local);current=true;},o:function o(local){transition_out(progressindicator.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(progressindicator,detaching);}};}// (3279:32) {#if statusState.closeButton && statusState.text}
function create_if_block_10(ctx){var button;var current;var button_spread_levels=[/*statusState*/ctx[33].closeButton,{hideLabel:true}];var button_props={};for(var i=0;i<button_spread_levels.length;i+=1){button_props=assign(button_props,button_spread_levels[i]);}button=new Button({props:button_props});return{c:function c(){create_component(button.$$.fragment);},m:function m(target,anchor){mount_component(button,target,anchor);current=true;},p:function p(ctx,dirty){var button_changes=dirty[1]&/*statusState*/4?get_spread_update(button_spread_levels,[get_spread_object(/*statusState*/ctx[33].closeButton),button_spread_levels[1]]):{};button.$set(button_changes);},i:function i(local){if(current)return;transition_in(button.$$.fragment,local);current=true;},o:function o(local){transition_out(button.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(button,detaching);}};}// (3268:28) <StatusAside                                 class="PinturaStatusButton"                                 offset={$asideOffset}                                 opacity={$asideOpacity}                             >
function create_default_slot_6(ctx){var t;var if_block1_anchor;var current;var if_block0=/*statusState*/ctx[33].progressIndicator.visible&&create_if_block_11(ctx);var if_block1=/*statusState*/ctx[33].closeButton&&/*statusState*/ctx[33].text&&create_if_block_10(ctx);return{c:function c(){if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();if_block1_anchor=empty();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,if_block1_anchor,anchor);current=true;},p:function p(ctx,dirty){if(/*statusState*/ctx[33].progressIndicator.visible){if(if_block0){if_block0.p(ctx,dirty);if(dirty[1]&/*statusState*/4){transition_in(if_block0,1);}}else{if_block0=create_if_block_11(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t.parentNode,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*statusState*/ctx[33].closeButton&&/*statusState*/ctx[33].text){if(if_block1){if_block1.p(ctx,dirty);if(dirty[1]&/*statusState*/4){transition_in(if_block1,1);}}else{if_block1=create_if_block_10(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(if_block1_anchor.parentNode,if_block1_anchor);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t);if(if_block1)if_block1.d(detaching);if(detaching)detach(if_block1_anchor);}};}// (3262:28) <Icon>
function create_default_slot_5$1(ctx){var g;var raw_value=/*locale*/ctx[3].iconSupportError+"";return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[0]&/*locale*/8&&raw_value!==(raw_value=/*locale*/ctx[3].iconSupportError+""))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (3257:24) <StatusAside                             class="PinturaStatusIcon"                             offset={$asideOffset}                             opacity={$asideOpacity}                         >
function create_default_slot_4$1(ctx){var icon;var current;icon=new Icon({props:{$$slots:{"default":[create_default_slot_5$1]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);},m:function m(target,anchor){mount_component(icon,target,anchor);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty[0]&/*locale*/8|dirty[16]&/*$$scope*/524288){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);}};}// (3289:8) {#if isReady}
function create_if_block_2$6(ctx){var t0;var t1;var current_block_type_index;var if_block2;var t2;var canvas;var t3;var div;var t4;var canvaspanandzoom;var updating_zoomLevel;var updating_zoomControls;var updating_zoomMultiTouching;var current;var if_block0=/*enableToolbar*/ctx[10]&&create_if_block_5$3(ctx);var if_block1=/*shouldRenderTabs*/ctx[43]&&/*showUtils*/ctx[42]&&create_if_block_4$5(ctx);var if_block_creators=[create_if_block_3$5,create_else_block$2];var if_blocks=[];function select_block_type_1(ctx,dirty){if(/*shouldRenderTabs*/ctx[43])return 0;return 1;}current_block_type_index=select_block_type_1(ctx);if_block2=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);canvas=new Canvas({props:{isAnimated:/*$isAnimated*/ctx[50],isTransparent:/*enableCanvasAlpha*/ctx[18],pixelRatio:/*$pixelRatio*/ctx[54],textPixelRatio:/*previewImageTextPixelRatio*/ctx[6],backgroundColor:/*$rootBackgroundColor*/ctx[53],maskRect:/*$imageSelectionRectPresentation*/ctx[55],maskOpacity:/*imageCanvasState*/ctx[68]?/*imageCanvasState*/ctx[68].maskOpacity:1,maskMarkupOpacity:/*markupMaskOpacity*/ctx[7],maskFrameOpacity:/*previewMaskOpacity*/ctx[5],clipAnnotationsToImage:/*$imageCropLimitToImage*/ctx[80],images:/*$activeImages*/ctx[52],interfaceImages:/*$interfaceImages*/ctx[81],loadImageData:/*imageSourceToImageData*/ctx[26],willRequest:/*$willRequest*/ctx[76]||/*$willRequestResource*/ctx[82],willRender:/*func_2*/ctx[371],didRender:/*func_3*/ctx[372]}});function canvaspanandzoom_zoomLevel_binding(value){/*canvaspanandzoom_zoomLevel_binding*/ctx[374](value);}function canvaspanandzoom_zoomControls_binding(value){/*canvaspanandzoom_zoomControls_binding*/ctx[375](value);}function canvaspanandzoom_zoomMultiTouching_binding(value){/*canvaspanandzoom_zoomMultiTouching_binding*/ctx[376](value);}var canvaspanandzoom_props={root:/*root*/ctx[2],locale:/*locale*/ctx[3],stores:/*utilStores*/ctx[179],allowPan:/*$allowPan*/ctx[84],enablePan:/*enablePan*/ctx[15],enablePanLimit:/*enablePanLimit*/ctx[19],panLimitGutterScalar:/*panLimitGutterScalar*/ctx[20],enablePanInput:/*$enablePanInputStatus*/ctx[85],allowZoom:/*$allowZoom*/ctx[86],enableZoom:/*enableZoom*/ctx[16],enableZoomInput:/*enableZoomInput*/ctx[17]!==undefined?/*enableZoomInput*/ctx[17]:/*$enableZoomInputStore*/ctx[87],enableZoomControls:/*$enableZoomControlsProp*/ctx[88],zoomOptions:/*markupEditorZoomLevels*/ctx[11]||/*zoomPresetOptions*/ctx[21],zoomAdjustStep:/*markupEditorZoomAdjustStep*/ctx[12]||/*zoomAdjustStep*/ctx[22],zoomAdjustFactor:/*markupEditorZoomAdjustFactor*/ctx[13]||/*zoomAdjustFactor*/ctx[23],zoomAdjustWheelFactor:/*markupEditorZoomAdjustWheelFactor*/ctx[14]||/*zoomAdjustWheelFactor*/ctx[24],imageSelectionRectCentered:/*$imageSelectionRectCentered*/ctx[89],imageSelectionRectScalar:/*$imageSelectionRectScalar*/ctx[90],elasticity:imageSelectionRectElasticity*/*elasticityMultiplier*/ctx[8]};if(/*zoomLevel*/ctx[0]!==void 0){canvaspanandzoom_props.zoomLevel=/*zoomLevel*/ctx[0];}if(/*zoomControls*/ctx[31]!==void 0){canvaspanandzoom_props.zoomControls=/*zoomControls*/ctx[31];}if(/*zoomMultiTouching*/ctx[32]!==void 0){canvaspanandzoom_props.zoomMultiTouching=/*zoomMultiTouching*/ctx[32];}canvaspanandzoom=new CanvasPanAndZoom({props:canvaspanandzoom_props});binding_callbacks.push(function(){return bind(canvaspanandzoom,'zoomLevel',canvaspanandzoom_zoomLevel_binding);});binding_callbacks.push(function(){return bind(canvaspanandzoom,'zoomControls',canvaspanandzoom_zoomControls_binding);});binding_callbacks.push(function(){return bind(canvaspanandzoom,'zoomMultiTouching',canvaspanandzoom_zoomMultiTouching_binding);});return{c:function c(){if(if_block0)if_block0.c();t0=space();if(if_block1)if_block1.c();t1=space();if_block2.c();t2=space();create_component(canvas.$$.fragment);t3=space();div=element("div");t4=space();create_component(canvaspanandzoom.$$.fragment);attr(div,"class","PinturaRootPortal");},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t0,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,t1,anchor);if_blocks[current_block_type_index].m(target,anchor);insert(target,t2,anchor);mount_component(canvas,target,anchor);insert(target,t3,anchor);insert(target,div,anchor);/*div_binding*/ctx[373](div);insert(target,t4,anchor);mount_component(canvaspanandzoom,target,anchor);current=true;},p:function p(ctx,dirty){if(/*enableToolbar*/ctx[10]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*enableToolbar*/1024){transition_in(if_block0,1);}}else{if_block0=create_if_block_5$3(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t0.parentNode,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*shouldRenderTabs*/ctx[43]&&/*showUtils*/ctx[42]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[1]&/*shouldRenderTabs, showUtils*/6144){transition_in(if_block1,1);}}else{if_block1=create_if_block_4$5(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(t1.parentNode,t1);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}var previous_block_index=current_block_type_index;current_block_type_index=select_block_type_1(ctx);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block2=if_blocks[current_block_type_index];if(!if_block2){if_block2=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block2.c();}else{if_block2.p(ctx,dirty);}transition_in(if_block2,1);if_block2.m(t2.parentNode,t2);}var canvas_changes={};if(dirty[1]&/*$isAnimated*/524288)canvas_changes.isAnimated=/*$isAnimated*/ctx[50];if(dirty[0]&/*enableCanvasAlpha*/262144)canvas_changes.isTransparent=/*enableCanvasAlpha*/ctx[18];if(dirty[1]&/*$pixelRatio*/8388608)canvas_changes.pixelRatio=/*$pixelRatio*/ctx[54];if(dirty[0]&/*previewImageTextPixelRatio*/64)canvas_changes.textPixelRatio=/*previewImageTextPixelRatio*/ctx[6];if(dirty[1]&/*$rootBackgroundColor*/4194304)canvas_changes.backgroundColor=/*$rootBackgroundColor*/ctx[53];if(dirty[1]&/*$imageSelectionRectPresentation*/16777216)canvas_changes.maskRect=/*$imageSelectionRectPresentation*/ctx[55];if(dirty[2]&/*imageCanvasState*/64)canvas_changes.maskOpacity=/*imageCanvasState*/ctx[68]?/*imageCanvasState*/ctx[68].maskOpacity:1;if(dirty[0]&/*markupMaskOpacity*/128)canvas_changes.maskMarkupOpacity=/*markupMaskOpacity*/ctx[7];if(dirty[0]&/*previewMaskOpacity*/32)canvas_changes.maskFrameOpacity=/*previewMaskOpacity*/ctx[5];if(dirty[2]&/*$imageCropLimitToImage*/262144)canvas_changes.clipAnnotationsToImage=/*$imageCropLimitToImage*/ctx[80];if(dirty[1]&/*$activeImages*/2097152)canvas_changes.images=/*$activeImages*/ctx[52];if(dirty[2]&/*$interfaceImages*/524288)canvas_changes.interfaceImages=/*$interfaceImages*/ctx[81];if(dirty[0]&/*imageSourceToImageData*/67108864)canvas_changes.loadImageData=/*imageSourceToImageData*/ctx[26];if(dirty[2]&/*$willRequest, $willRequestResource*/1064960)canvas_changes.willRequest=/*$willRequest*/ctx[76]||/*$willRequestResource*/ctx[82];if(dirty[0]&/*willRenderCanvas*/512|dirty[1]&/*$redrawTrigger, $imageAnnotation, $imageDecoration, $imageFrame, blendShapes*/376840|dirty[2]&/*$imageOverlay*/2097152)canvas_changes.willRender=/*func_2*/ctx[371];if(dirty[1]&/*imageAnnotationShapesDirty, imageAnnotationRequiresPreprocessing, imageDecorationShapesDirty, imageFrameShapesDirty, imageBlendShapesDirty*/2080374784)canvas_changes.didRender=/*func_3*/ctx[372];canvas.$set(canvas_changes);var canvaspanandzoom_changes={};if(dirty[0]&/*root*/4)canvaspanandzoom_changes.root=/*root*/ctx[2];if(dirty[0]&/*locale*/8)canvaspanandzoom_changes.locale=/*locale*/ctx[3];if(dirty[2]&/*$allowPan*/4194304)canvaspanandzoom_changes.allowPan=/*$allowPan*/ctx[84];if(dirty[0]&/*enablePan*/32768)canvaspanandzoom_changes.enablePan=/*enablePan*/ctx[15];if(dirty[0]&/*enablePanLimit*/524288)canvaspanandzoom_changes.enablePanLimit=/*enablePanLimit*/ctx[19];if(dirty[0]&/*panLimitGutterScalar*/1048576)canvaspanandzoom_changes.panLimitGutterScalar=/*panLimitGutterScalar*/ctx[20];if(dirty[2]&/*$enablePanInputStatus*/8388608)canvaspanandzoom_changes.enablePanInput=/*$enablePanInputStatus*/ctx[85];if(dirty[2]&/*$allowZoom*/16777216)canvaspanandzoom_changes.allowZoom=/*$allowZoom*/ctx[86];if(dirty[0]&/*enableZoom*/65536)canvaspanandzoom_changes.enableZoom=/*enableZoom*/ctx[16];if(dirty[0]&/*enableZoomInput*/131072|dirty[2]&/*$enableZoomInputStore*/33554432)canvaspanandzoom_changes.enableZoomInput=/*enableZoomInput*/ctx[17]!==undefined?/*enableZoomInput*/ctx[17]:/*$enableZoomInputStore*/ctx[87];if(dirty[2]&/*$enableZoomControlsProp*/67108864)canvaspanandzoom_changes.enableZoomControls=/*$enableZoomControlsProp*/ctx[88];if(dirty[0]&/*markupEditorZoomLevels, zoomPresetOptions*/2099200)canvaspanandzoom_changes.zoomOptions=/*markupEditorZoomLevels*/ctx[11]||/*zoomPresetOptions*/ctx[21];if(dirty[0]&/*markupEditorZoomAdjustStep, zoomAdjustStep*/4198400)canvaspanandzoom_changes.zoomAdjustStep=/*markupEditorZoomAdjustStep*/ctx[12]||/*zoomAdjustStep*/ctx[22];if(dirty[0]&/*markupEditorZoomAdjustFactor, zoomAdjustFactor*/8396800)canvaspanandzoom_changes.zoomAdjustFactor=/*markupEditorZoomAdjustFactor*/ctx[13]||/*zoomAdjustFactor*/ctx[23];if(dirty[0]&/*markupEditorZoomAdjustWheelFactor, zoomAdjustWheelFactor*/16793600)canvaspanandzoom_changes.zoomAdjustWheelFactor=/*markupEditorZoomAdjustWheelFactor*/ctx[14]||/*zoomAdjustWheelFactor*/ctx[24];if(dirty[2]&/*$imageSelectionRectCentered*/134217728)canvaspanandzoom_changes.imageSelectionRectCentered=/*$imageSelectionRectCentered*/ctx[89];if(dirty[2]&/*$imageSelectionRectScalar*/268435456)canvaspanandzoom_changes.imageSelectionRectScalar=/*$imageSelectionRectScalar*/ctx[90];if(dirty[0]&/*elasticityMultiplier*/256)canvaspanandzoom_changes.elasticity=imageSelectionRectElasticity*/*elasticityMultiplier*/ctx[8];if(!updating_zoomLevel&&dirty[0]&/*zoomLevel*/1){updating_zoomLevel=true;canvaspanandzoom_changes.zoomLevel=/*zoomLevel*/ctx[0];add_flush_callback(function(){return updating_zoomLevel=false;});}if(!updating_zoomControls&&dirty[1]&/*zoomControls*/1){updating_zoomControls=true;canvaspanandzoom_changes.zoomControls=/*zoomControls*/ctx[31];add_flush_callback(function(){return updating_zoomControls=false;});}if(!updating_zoomMultiTouching&&dirty[1]&/*zoomMultiTouching*/2){updating_zoomMultiTouching=true;canvaspanandzoom_changes.zoomMultiTouching=/*zoomMultiTouching*/ctx[32];add_flush_callback(function(){return updating_zoomMultiTouching=false;});}canvaspanandzoom.$set(canvaspanandzoom_changes);},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);transition_in(if_block2);transition_in(canvas.$$.fragment,local);transition_in(canvaspanandzoom.$$.fragment,local);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);transition_out(if_block2);transition_out(canvas.$$.fragment,local);transition_out(canvaspanandzoom.$$.fragment,local);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t0);if(if_block1)if_block1.d(detaching);if(detaching)detach(t1);if_blocks[current_block_type_index].d(detaching);if(detaching)detach(t2);destroy_component(canvas,detaching);if(detaching)detach(t3);if(detaching)detach(div);/*div_binding*/ctx[373](null);if(detaching)detach(t4);destroy_component(canvaspanandzoom,detaching);}};}// (3290:12) {#if enableToolbar}
function create_if_block_5$3(ctx){var div;var dynamiccomponenttree;var current;var mounted;var dispose;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*toolbarItems*/ctx[64]}});return{c:function c(){div=element("div");create_component(dynamiccomponenttree.$$.fragment);attr(div,"class","PinturaNav PinturaNavTools");},m:function m(target,anchor){insert(target,div,anchor);mount_component(dynamiccomponenttree,div,null);current=true;if(!mounted){dispose=[listen(div,"measure",/*measure_handler*/ctx[358]),action_destroyer(measurable.call(null,div))];mounted=true;}},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty[2]&/*toolbarItems*/4)dynamiccomponenttree_changes.items=/*toolbarItems*/ctx[64];dynamiccomponenttree.$set(dynamiccomponenttree_changes);},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(dynamiccomponenttree);mounted=false;run_all(dispose);}};}// (3300:12) {#if shouldRenderTabs && showUtils}
function create_if_block_4$5(ctx){var div;var scrollable;var current;scrollable=new Scrollable({props:{elasticity:/*elasticityMultiplier*/ctx[8]*scrollElasticity,scrollDirection:/*isLandscape*/ctx[70]?'y':'x',$$slots:{"default":[create_default_slot_1$4]},$$scope:{ctx:ctx}}});return{c:function c(){div=element("div");create_component(scrollable.$$.fragment);attr(div,"class","PinturaNav PinturaNavMain");},m:function m(target,anchor){insert(target,div,anchor);mount_component(scrollable,div,null);current=true;},p:function p(ctx,dirty){var scrollable_changes={};if(dirty[0]&/*elasticityMultiplier*/256)scrollable_changes.elasticity=/*elasticityMultiplier*/ctx[8]*scrollElasticity;if(dirty[2]&/*isLandscape*/256)scrollable_changes.scrollDirection=/*isLandscape*/ctx[70]?'y':'x';if(dirty[1]&/*utilSelected*/1024|dirty[2]&/*tabsConfig, tabs*/6144|dirty[16]&/*$$scope*/524288){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(scrollable);}};}// (3312:28) <Icon>
function create_default_slot_3$1(ctx){var g;var raw_value=/*tab*/ctx[514].icon+"";return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[16]&/*tab*/262144&&raw_value!==(raw_value=/*tab*/ctx[514].icon+""))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (3306:24) <TabList                             {...tabsConfig}                             {tabs}                             on:select={({ detail }) => (utilSelected = detail)}                             let:tab                         >
function create_default_slot_2$3(ctx){var icon;var t0;var span;var t1_value=/*tab*/ctx[514].label+"";var t1;var current;icon=new Icon({props:{$$slots:{"default":[create_default_slot_3$1]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);t0=space();span=element("span");t1=text(t1_value);},m:function m(target,anchor){mount_component(icon,target,anchor);insert(target,t0,anchor);insert(target,span,anchor);append(span,t1);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty[16]&/*$$scope, tab*/786432){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);if((!current||dirty[16]&/*tab*/262144)&&t1_value!==(t1_value=/*tab*/ctx[514].label+""))set_data(t1,t1_value);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);if(detaching)detach(t0);if(detaching)detach(span);}};}// (3302:20) <Scrollable                         elasticity={elasticityMultiplier * scrollElasticity}                         scrollDirection={isLandscape ? 'y' : 'x'}                     >
function create_default_slot_1$4(ctx){var tablist;var current;var tablist_spread_levels=[/*tabsConfig*/ctx[74],{tabs:/*tabs*/ctx[73]}];var tablist_props={$$slots:{"default":[create_default_slot_2$3,function(_ref93){var tab=_ref93.tab;return{514:tab};},function(_ref95){var tab=_ref95.tab;return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,tab?262144:0];}]},$$scope:{ctx:ctx}};for(var i=0;i<tablist_spread_levels.length;i+=1){tablist_props=assign(tablist_props,tablist_spread_levels[i]);}tablist=new TabList({props:tablist_props});tablist.$on("select",/*select_handler*/ctx[359]);return{c:function c(){create_component(tablist.$$.fragment);},m:function m(target,anchor){mount_component(tablist,target,anchor);current=true;},p:function p(ctx,dirty){var tablist_changes=dirty[2]&/*tabsConfig, tabs*/6144?get_spread_update(tablist_spread_levels,[dirty[2]&/*tabsConfig*/4096&&get_spread_object(/*tabsConfig*/ctx[74]),dirty[2]&/*tabs*/2048&&{tabs:/*tabs*/ctx[73]}]):{};if(dirty[16]&/*$$scope, tab*/786432){tablist_changes.$$scope={dirty:dirty,ctx:ctx};}tablist.$set(tablist_changes);},i:function i(local){if(current)return;transition_in(tablist.$$.fragment,local);current=true;},o:function o(local){transition_out(tablist.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(tablist,detaching);}};}// (3345:12) {:else}
function create_else_block$2(ctx){var utilpanel;var updating_component;var current;function utilpanel_component_binding_1(value){/*utilpanel_component_binding_1*/ctx[367](value);}var utilpanel_props={"class":"PinturaMain",content:_objectSpread(_objectSpread({},/*utilsMerged*/ctx[44].find(/*func_1*/ctx[366])),{},{props:/*pluginOptions*/ctx[25][/*utilSelected*/ctx[41]]}),locale:/*locale*/ctx[3],stores:/*utilStores*/ctx[179]};if(/*pluginInterface*/ctx[1][/*utilSelected*/ctx[41]]!==void 0){utilpanel_props.component=/*pluginInterface*/ctx[1][/*utilSelected*/ctx[41]];}utilpanel=new UtilPanel({props:utilpanel_props});binding_callbacks.push(function(){return bind(utilpanel,'component',utilpanel_component_binding_1);});utilpanel.$on("measure",/*handleMeasureUtil*/ctx[201]);utilpanel.$on("show",/*show_handler_1*/ctx[368]);utilpanel.$on("hide",/*hide_handler_1*/ctx[369]);utilpanel.$on("fade",/*fade_handler_1*/ctx[370]);return{c:function c(){create_component(utilpanel.$$.fragment);},m:function m(target,anchor){mount_component(utilpanel,target,anchor);current=true;},p:function p(ctx,dirty){var utilpanel_changes={};if(dirty[0]&/*pluginOptions*/33554432|dirty[1]&/*utilsMerged, utilSelected*/9216)utilpanel_changes.content=_objectSpread(_objectSpread({},/*utilsMerged*/ctx[44].find(/*func_1*/ctx[366])),{},{props:/*pluginOptions*/ctx[25][/*utilSelected*/ctx[41]]});if(dirty[0]&/*locale*/8)utilpanel_changes.locale=/*locale*/ctx[3];if(!updating_component&&dirty[0]&/*pluginInterface*/2|dirty[1]&/*utilSelected*/1024){updating_component=true;utilpanel_changes.component=/*pluginInterface*/ctx[1][/*utilSelected*/ctx[41]];add_flush_callback(function(){return updating_component=false;});}utilpanel.$set(utilpanel_changes);},i:function i(local){if(current)return;transition_in(utilpanel.$$.fragment,local);current=true;},o:function o(local){transition_out(utilpanel.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(utilpanel,detaching);}};}// (3319:12) {#if shouldRenderTabs}
function create_if_block_3$5(ctx){var tabpanels;var current;var tabpanels_spread_levels=[{"class":"PinturaMain"},{visible:/*utilsVisible*/ctx[56]},/*tabsConfig*/ctx[74],{panels:/*panels*/ctx[72]}];var tabpanels_props={$$slots:{"default":[create_default_slot$b,function(_ref100){var panel=_ref100.panel,panelIsActive=_ref100.panelIsActive;return{512:panel,513:panelIsActive};},function(_ref200){var panel=_ref200.panel,panelIsActive=_ref200.panelIsActive;return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(panel?65536:0)|(panelIsActive?131072:0)];}]},$$scope:{ctx:ctx}};for(var i=0;i<tabpanels_spread_levels.length;i+=1){tabpanels_props=assign(tabpanels_props,tabpanels_spread_levels[i]);}tabpanels=new TabPanels({props:tabpanels_props});tabpanels.$on("measure",/*measure_handler_1*/ctx[365]);return{c:function c(){create_component(tabpanels.$$.fragment);},m:function m(target,anchor){mount_component(tabpanels,target,anchor);current=true;},p:function p(ctx,dirty){var tabpanels_changes=dirty[1]&/*utilsVisible*/33554432|dirty[2]&/*tabsConfig, panels*/5120?get_spread_update(tabpanels_spread_levels,[tabpanels_spread_levels[0],dirty[1]&/*utilsVisible*/33554432&&{visible:/*utilsVisible*/ctx[56]},dirty[2]&/*tabsConfig*/4096&&get_spread_object(/*tabsConfig*/ctx[74]),dirty[2]&/*panels*/1024&&{panels:/*panels*/ctx[72]}]):{};if(dirty[0]&/*pluginOptions, locale, pluginInterface*/33554442|dirty[1]&/*utilsMerged, utilsVisible, utilsVisibleFraction*/33562656|dirty[16]&/*$$scope, panel, panelIsActive*/720896){tabpanels_changes.$$scope={dirty:dirty,ctx:ctx};}tabpanels.$set(tabpanels_changes);},i:function i(local){if(current)return;transition_in(tabpanels.$$.fragment,local);current=true;},o:function o(local){transition_out(tabpanels.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(tabpanels,detaching);}};}// (3320:16) <TabPanels                     class="PinturaMain"                     visible={utilsVisible}                     {...tabsConfig}                     {panels}                     let:panel                     let:panelIsActive                     on:measure={(e) => ($tabRect = e.detail)}                 >
function create_default_slot$b(ctx){var utilpanel;var updating_component;var current;function func(){var _ctx7;for(var _len7=arguments.length,args=new Array(_len7),_key10=0;_key10<_len7;_key10++){args[_key10]=arguments[_key10];}return(/*func*/(_ctx7=ctx)[360].apply(_ctx7,[/*panel*/ctx[512]].concat(args)));}function utilpanel_component_binding(value){/*utilpanel_component_binding*/ctx[361](value,/*panel*/ctx[512]);}function show_handler(){return(/*show_handler*/ctx[362](/*panel*/ctx[512]));}function hide_handler(){return(/*hide_handler*/ctx[363](/*panel*/ctx[512]));}function fade_handler(){var _ctx8;for(var _len8=arguments.length,args=new Array(_len8),_key11=0;_key11<_len8;_key11++){args[_key11]=arguments[_key11];}return(/*fade_handler*/(_ctx8=ctx)[364].apply(_ctx8,[/*panel*/ctx[512]].concat(args)));}var utilpanel_props={content:_objectSpread(_objectSpread({},/*utilsMerged*/ctx[44].find(func)),{},{props:/*pluginOptions*/ctx[25][/*panel*/ctx[512]]}),locale:/*locale*/ctx[3],isActive:/*panelIsActive*/ctx[513],stores:/*utilStores*/ctx[179]};if(/*pluginInterface*/ctx[1][/*panel*/ctx[512]]!==void 0){utilpanel_props.component=/*pluginInterface*/ctx[1][/*panel*/ctx[512]];}utilpanel=new UtilPanel({props:utilpanel_props});binding_callbacks.push(function(){return bind(utilpanel,'component',utilpanel_component_binding);});utilpanel.$on("measure",/*handleMeasureUtil*/ctx[201]);utilpanel.$on("show",show_handler);utilpanel.$on("hide",hide_handler);utilpanel.$on("fade",fade_handler);return{c:function c(){create_component(utilpanel.$$.fragment);},m:function m(target,anchor){mount_component(utilpanel,target,anchor);current=true;},p:function p(new_ctx,dirty){ctx=new_ctx;var utilpanel_changes={};if(dirty[0]&/*pluginOptions*/33554432|dirty[1]&/*utilsMerged*/8192|dirty[16]&/*panel*/65536)utilpanel_changes.content=_objectSpread(_objectSpread({},/*utilsMerged*/ctx[44].find(func)),{},{props:/*pluginOptions*/ctx[25][/*panel*/ctx[512]]});if(dirty[0]&/*locale*/8)utilpanel_changes.locale=/*locale*/ctx[3];if(dirty[16]&/*panelIsActive*/131072)utilpanel_changes.isActive=/*panelIsActive*/ctx[513];if(!updating_component&&dirty[0]&/*pluginInterface*/2|dirty[16]&/*panel*/65536){updating_component=true;utilpanel_changes.component=/*pluginInterface*/ctx[1][/*panel*/ctx[512]];add_flush_callback(function(){return updating_component=false;});}utilpanel.$set(utilpanel_changes);},i:function i(local){if(current)return;transition_in(utilpanel.$$.fragment,local);current=true;},o:function o(local){transition_out(utilpanel.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(utilpanel,detaching);}};}// (3448:4) {#if $disabledTransition > 0}
function create_if_block$8(ctx){var span;var span_style_value;return{c:function c(){span=element("span");attr(span,"class","PinturaEditorOverlay");attr(span,"style",span_style_value="opacity:".concat(/*$disabledTransition*/ctx[91]));},m:function m(target,anchor){insert(target,span,anchor);},p:function p(ctx,dirty){if(dirty[2]&/*$disabledTransition*/536870912&&span_style_value!==(span_style_value="opacity:".concat(/*$disabledTransition*/ctx[91]))){attr(span,"style",span_style_value);}},d:function d(detaching){if(detaching)detach(span);}};}function create_fragment$x(ctx){var div;var t;var current;var mounted;var dispose;add_render_callback(/*onwindowresize*/ctx[357]);var if_block0=/*canRender*/ctx[63]&&create_if_block_1$7(ctx);var if_block1=/*$disabledTransition*/ctx[91]>0&&create_if_block$8(ctx);return{c:function c(){div=element("div");if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();attr(div,"id",/*id*/ctx[4]);attr(div,"class",/*className*/ctx[71]);attr(div,"data-env",/*envStr*/ctx[69]);},m:function m(target,anchor){insert(target,div,anchor);if(if_block0)if_block0.m(div,null);append(div,t);if(if_block1)if_block1.m(div,null);/*div_binding_1*/ctx[377](div);current=true;if(!mounted){dispose=[listen(window_1$1,"keydown",/*handleKeydown*/ctx[192]),listen(window_1$1,"keyup",/*handleKeyup*/ctx[193]),listen(window_1$1,"blur",/*handleWindowBlur*/ctx[194]),listen(window_1$1,"paste",/*handlePaste*/ctx[198]),listen(window_1$1,"resize",/*onwindowresize*/ctx[357]),listen(div,"ping",function(){if(is_function(/*routePing*/ctx[62]))/*routePing*/ctx[62].apply(this,arguments);}),listen(div,"contextmenu",/*handleContextMenu*/ctx[195]),listen(div,"touchstart",/*handleTouchStart*/ctx[190],{passive:false}),listen(div,"touchmove",function(){if(is_function(/*handleTouchMove*/ctx[66]))/*handleTouchMove*/ctx[66].apply(this,arguments);}),listen(div,"pointermove",function(){if(is_function(/*handlePointerMove*/ctx[65]))/*handlePointerMove*/ctx[65].apply(this,arguments);}),listen(div,"transitionend",/*handleTransitionEnd*/ctx[180]),listen(div,"dropfiles",/*handleDropFiles*/ctx[196]),listen(div,"measure",/*measure_handler_2*/ctx[378]),listen(div,"click",function(){if(is_function(/*isWaitingForImage*/ctx[40]?/*browseFileSystem*/ctx[197]:noop$1))(/*isWaitingForImage*/ctx[40]?/*browseFileSystem*/ctx[197]:noop$1).apply(this,arguments);}),action_destroyer(measurable.call(null,div,{observeViewRect:true})),action_destroyer(focusvisible.call(null,div)),action_destroyer(dropable.call(null,div))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(/*canRender*/ctx[63]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[2]&/*canRender*/2){transition_in(if_block0,1);}}else{if_block0=create_if_block_1$7(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(div,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*$disabledTransition*/ctx[91]>0){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block$8(ctx);if_block1.c();if_block1.m(div,null);}}else if(if_block1){if_block1.d(1);if_block1=null;}if(!current||dirty[0]&/*id*/16){attr(div,"id",/*id*/ctx[4]);}if(!current||dirty[2]&/*className*/512){attr(div,"class",/*className*/ctx[71]);}if(!current||dirty[2]&/*envStr*/128){attr(div,"data-env",/*envStr*/ctx[69]);}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block0)if_block0.d();if(if_block1)if_block1.d();/*div_binding_1*/ctx[377](null);mounted=false;run_all(dispose);}};}var imageCropRectElasticity=5;// updating crop selection / the intended selection rect, combined with actual selection rect, used to render elasticity visualisation
var imageSelectionRectElasticity=1;var OVERLAY_ID='stage-overlay';var OVERLAY_OPACITY_TWEEN_DIST=64;var scrollElasticity=10;var rangeInputElasticity=5;function instance$x($$self,$$props,$$invalidate){var isOverlayModeEnabled;var showUtils;var maxImageDataSize;var preprocessShape;var supportsAnimations;var canAnimate;var acceptsAnimations;var OVERLAY_OPACITY_MAX;var overlayMin;var overlayOverlap;var overlayLeft;var overlayTop;var overlayRight;var overlayBottom;var gradientOverlays;var imageTransformsSnapPixels;var canUndo;var canRedo;var utilsFiltered;var utilsAvailable;var utilsDefined;var utilsMerged;var utilSelected;var utilsVisibleFraction;var tabsConfig;var tabs;var panels;var shouldRenderTabs;var className;var horizontalSpace;var hasLimitedSpace;var verticalSpace;var isModal;var isCenteredHorizontally;var isCenteredVertically;var isCentered;var isTransparent;var isNarrow;var orientation;var isLandscape;var isCompact;var hasSwipeNavigation;var activeUtilTools;var navigationHorizontalPreference;var navigationVerticalPreference;var toolbarVerticalPreference;var controlGroupsVerticalPreference;var controlTabsVerticalpreference;var rootRectDefined;var rootElementComputedStyle;var envStr;var imageCanvasState;var hasProps;var missingFeatures;var isSupportsError;var isStartLoadingImageSource;var isImageLoadError;var isWaitingForImage;var imageLoadProgress;var isLoadingImageData;var isCreatingImagePreview;var isProcessingImage;var imageLoadShowProgressIndicator;var imageLoadStatusLabel;var imageProcessStatusLabel;var imageProcessProgress;var imageProcessShowProgressIndicator;var isImageProcessingError;var isCustomStatus;var isStatusActive;var isStatusVisible;var hasAside;var statusIndent;var statusTransform;var needsInteractionLock;var preventTouchHandler;var handleTouchMove;var handlePointerMove;var toolbarItems;var hasClientRect;var canRender;var hasImageRedaction;var imageRedactionScalar;var routePing;var isReady;var $utilRect;var $imageFrame;var $imageDecoration;var $imageSize;var $imageFlipY;var $imageFlipX;var $imageRotation;var $imageAnnotation;var $stageRect;var $rootRect;var $isInteractingFraction;var $isInteracting;var $rootLineColor;var $rootForegroundColor;var $imagePreview,$$unsubscribe_imagePreview=noop,$$subscribe_imagePreview=function $$subscribe_imagePreview(){return $$unsubscribe_imagePreview(),$$unsubscribe_imagePreview=subscribe(imagePreview,function($$value){return $$invalidate(316,$imagePreview=$$value);}),imagePreview;};var $imageRedaction;var $imageBackgroundColor;var $imageScrambler;var $pressedKeysStore;var $clientRect;var $env;var $redrawTrigger;var $imageProcessingPreparing;var $isAnimated;var $statusOffset;var $asideWidth;var $statusWidth;var $statusOpacity;var $wasProcessingImage;var $imageVisualLoadComplete;var $imageProcessState;var $imageLoadState;var $imagePreviewSource;var $activeImages;var $imageProps;var $shouldAnimate;var $imagePreviewModifiers;var $imageTransforms;var $pointerHoverable;var $pointerAccuracy;var $utilTools;var $mediaDuration;var $previewShouldUpscale;var $history,$$unsubscribe_history=noop,$$subscribe_history=function $$subscribe_history(){return $$unsubscribe_history(),$$unsubscribe_history=subscribe(history,function($$value){return $$invalidate(338,$history=$$value);}),history;};var $imageState;var $tabRect;var $muteAudioStore;var $imageFile;var $imageOverlayMarkup;var $overlayBottomRect;var $overlayOpacity;var $rootBackgroundColor;var $overlayRightRect;var $overlayTopRect;var $overlayLeftRect;var $pixelRatio;var $imageSelectionRectPresentation;var $stagePadding;var $stagePadded;var $imageSelectionRectStaticScalar;var $imageSelectionRect;var $imageCropRect;var $imageStaticBounds;var $imageCropRectIntent;var $imageSelectionRectSnapshot;var $imageIsStatic;var $imageCropRectSnapshot;var $presentationScalar;var $stageScalar;var $imageSelectionScalar;var $imageSelectionPan;var $imageSelectionRectIntent;var $imageSelectionRectOffset;var $imageSelectionZoom;var $prefersReducedMotion;var $imageCropAspectRatio;var $enablePanInputStore;var $enablePanInputProp;var $allowZoomControls;var $shapePreprocessor;var $images;var $mediaTrim;var $willRequest;var $elasticityMultiplierStore;var $asideOffset;var $asideOpacity;var $toolRect;var $imageCropLimitToImage;var $interfaceImages;var $willRequestResource;var $imageOverlay;var $allowPan;var $enablePanInputStatus;var $allowZoom;var $enableZoomInputStore;var $enableZoomControlsProp;var $imageSelectionRectCentered;var $imageSelectionRectScalar;var $disabledTransition;component_subscribe($$self,prefersReducedMotion,function($$value){return $$invalidate(353,$prefersReducedMotion=$$value);});$$self.$$.on_destroy.push(function(){return $$unsubscribe_imagePreview();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_history();});var eventProxy=pubsub();var dispatch=createEventDispatcher();var _$$props$class13=$$props["class"],klass=_$$props$class13===void 0?undefined:_$$props$class13;var _$$props$layout3=$$props.layout,layoutMode=_$$props$layout3===void 0?undefined:_$$props$layout3;var stores=$$props.stores;var _$$props$locale3=$$props.locale,locale=_$$props$locale3===void 0?undefined:_$$props$locale3;var _$$props$id2=$$props.id,id=_$$props$id2===void 0?undefined:_$$props$id2;var _$$props$util=$$props.util,util=_$$props$util===void 0?undefined:_$$props$util;var _$$props$utils=$$props.utils,utils=_$$props$utils===void 0?undefined:_$$props$utils;var _$$props$animations=$$props.animations,animations=_$$props$animations===void 0?'auto':_$$props$animations;var _$$props$disabled3=$$props.disabled,disabled=_$$props$disabled3===void 0?false:_$$props$disabled3;var _$$props$status=$$props.status,status=_$$props$status===void 0?undefined:_$$props$status;var _$$props$previewUpsca=$$props.previewUpscale,previewUpscale=_$$props$previewUpsca===void 0?false:_$$props$previewUpsca;var _$$props$previewPad=$$props.previewPad,previewPad=_$$props$previewPad===void 0?false:_$$props$previewPad;var _$$props$previewMaskO=$$props.previewMaskOpacity,previewMaskOpacity=_$$props$previewMaskO===void 0?0.95:_$$props$previewMaskO;var _$$props$previewImage=$$props.previewImageDataMaxSize,previewImageDataMaxSize=_$$props$previewImage===void 0?undefined:_$$props$previewImage;var _$$props$previewImage2=$$props.previewImageTextPixelRatio,previewImageTextPixelRatio=_$$props$previewImage2===void 0?undefined:_$$props$previewImage2;var _$$props$markupMaskOp=$$props.markupMaskOpacity,markupMaskOpacity=_$$props$markupMaskOp===void 0?1:_$$props$markupMaskOp;var _$$props$zoomMaskOpac=$$props.zoomMaskOpacity,zoomMaskOpacity=_$$props$zoomMaskOpac===void 0?0.85:_$$props$zoomMaskOpac;var _$$props$elasticityMu=$$props.elasticityMultiplier,elasticityMultiplier=_$$props$elasticityMu===void 0?10:_$$props$elasticityMu;var _$$props$willRevert=$$props.willRevert,willRevert=_$$props$willRevert===void 0?function(){return Promise.resolve(true);}:_$$props$willRevert;var _$$props$willProcessI=$$props.willProcessImage,willProcessImage=_$$props$willProcessI===void 0?function(){return Promise.resolve(true);}:_$$props$willProcessI;var _$$props$willRenderCa=$$props.willRenderCanvas,willRenderCanvas=_$$props$willRenderCa===void 0?passthrough:_$$props$willRenderCa;var _$$props$willRenderTo=$$props.willRenderToolbar,willRenderToolbar=_$$props$willRenderTo===void 0?passthrough:_$$props$willRenderTo;var _$$props$willSetHisto=$$props.willSetHistoryInitialState,willSetHistoryInitialState=_$$props$willSetHisto===void 0?passthrough:_$$props$willSetHisto;var _$$props$enableButton=$$props.enableButtonExport,enableButtonExport=_$$props$enableButton===void 0?true:_$$props$enableButton;var _$$props$enableButton2=$$props.enableButtonRevert,enableButtonRevert=_$$props$enableButton2===void 0?true:_$$props$enableButton2;var _$$props$enableNaviga=$$props.enableNavigateHistory,enableNavigateHistory=_$$props$enableNaviga===void 0?true:_$$props$enableNaviga;var _$$props$enableToolba=$$props.enableToolbar,enableToolbar=_$$props$enableToolba===void 0?true:_$$props$enableToolba;var _$$props$enableUtils=$$props.enableUtils,enableUtils=_$$props$enableUtils===void 0?true:_$$props$enableUtils;var _$$props$enableButton3=$$props.enableButtonClose,enableButtonClose=_$$props$enableButton3===void 0?false:_$$props$enableButton3;var _$$props$enableDropIm=$$props.enableDropImage,enableDropImage=_$$props$enableDropIm===void 0?false:_$$props$enableDropIm;var _$$props$enablePasteI=$$props.enablePasteImage,enablePasteImage=_$$props$enablePasteI===void 0?false:_$$props$enablePasteI;var _$$props$enableBrowse=$$props.enableBrowseImage,enableBrowseImage=_$$props$enableBrowse===void 0?false:_$$props$enableBrowse;var _$$props$layoutDirect=$$props.layoutDirectionPreference,layoutDirectionPreference=_$$props$layoutDirect===void 0?'auto':_$$props$layoutDirect;var _$$props$layoutHorizo=$$props.layoutHorizontalUtilsPreference,layoutHorizontalUtilsPreference=_$$props$layoutHorizo===void 0?'left':_$$props$layoutHorizo;var _$$props$layoutVertic=$$props.layoutVerticalUtilsPreference,layoutVerticalUtilsPreference=_$$props$layoutVertic===void 0?'bottom':_$$props$layoutVertic;var _$$props$layoutVertic2=$$props.layoutVerticalToolbarPreference,layoutVerticalToolbarPreference=_$$props$layoutVertic2===void 0?'top':_$$props$layoutVertic2;var _$$props$layoutVertic3=$$props.layoutVerticalControlGroupsPreference,layoutVerticalControlGroupsPreference=_$$props$layoutVertic3===void 0?'bottom':_$$props$layoutVertic3;var _$$props$layoutVertic4=$$props.layoutVerticalControlTabsPreference,layoutVerticalControlTabsPreference=_$$props$layoutVertic4===void 0?'bottom':_$$props$layoutVertic4;var _$$props$markupEditor=$$props.markupEditorZoomLevel,markupEditorZoomLevel=_$$props$markupEditor===void 0?null:_$$props$markupEditor;var _$$props$markupEditor2=$$props.markupEditorZoomLevels,markupEditorZoomLevels=_$$props$markupEditor2===void 0?undefined:_$$props$markupEditor2;var _$$props$markupEditor3=$$props.markupEditorZoomAdjustStep,markupEditorZoomAdjustStep=_$$props$markupEditor3===void 0?undefined:_$$props$markupEditor3;var _$$props$markupEditor4=$$props.markupEditorZoomAdjustFactor,markupEditorZoomAdjustFactor=_$$props$markupEditor4===void 0?undefined:_$$props$markupEditor4;var _$$props$markupEditor5=$$props.markupEditorZoomAdjustWheelFactor,markupEditorZoomAdjustWheelFactor=_$$props$markupEditor5===void 0?undefined:_$$props$markupEditor5;var _$$props$markupEditor6=$$props.markupEditorInteractionMode,markupEditorInteractionMode=_$$props$markupEditor6===void 0?false:_$$props$markupEditor6;var _$$props$muteAudio=$$props.muteAudio,muteAudio=_$$props$muteAudio===void 0?true:_$$props$muteAudio;var _$$props$willSetMedia=$$props.willSetMediaInitialTimeOffset,willSetMediaInitialTimeOffset=_$$props$willSetMedia===void 0?function(duration,trim){return duration*getRangeCenter(trim[0]);}:_$$props$willSetMedia;var _$$props$enablePan2=$$props.enablePan,enablePan=_$$props$enablePan2===void 0?true:_$$props$enablePan2;var _$$props$enableZoom2=$$props.enableZoom,enableZoom=_$$props$enableZoom2===void 0?true:_$$props$enableZoom2;var _$$props$enableZoomCo2=$$props.enableZoomControls,enableZoomControls=_$$props$enableZoomCo2===void 0?true:_$$props$enableZoomCo2;var _$$props$enableZoomIn2=$$props.enableZoomInput,enableZoomInput=_$$props$enableZoomIn2===void 0?undefined:_$$props$enableZoomIn2;var _$$props$enablePanInp2=$$props.enablePanInput,enablePanInput=_$$props$enablePanInp2===void 0?undefined:_$$props$enablePanInp2;var _$$props$enableCanvas=$$props.enableCanvasAlpha,enableCanvasAlpha=_$$props$enableCanvas===void 0?false:_$$props$enableCanvas;var _$$props$enablePanLim2=$$props.enablePanLimit,enablePanLimit=_$$props$enablePanLim2===void 0?undefined:_$$props$enablePanLim2;var _$$props$panLimitGutt2=$$props.panLimitGutterScalar,panLimitGutterScalar=_$$props$panLimitGutt2===void 0?undefined:_$$props$panLimitGutt2;var _$$props$zoomPresetOp=$$props.zoomPresetOptions,zoomPresetOptions=_$$props$zoomPresetOp===void 0?[0.25,0.5,1,1.25,1.5,2,3,4,6,8,16]:_$$props$zoomPresetOp;var _$$props$zoomAdjustSt2=$$props.zoomAdjustStep,zoomAdjustStep=_$$props$zoomAdjustSt2===void 0?0.25:_$$props$zoomAdjustSt2;var _$$props$zoomAdjustFa2=$$props.zoomAdjustFactor,zoomAdjustFactor=_$$props$zoomAdjustFa2===void 0?0.1:_$$props$zoomAdjustFa2;var _$$props$zoomAdjustWh2=$$props.zoomAdjustWheelFactor,zoomAdjustWheelFactor=_$$props$zoomAdjustWh2===void 0?1:_$$props$zoomAdjustWh2;var _$$props$zoomLevel2=$$props.zoomLevel,zoomLevel=_$$props$zoomLevel2===void 0?null:_$$props$zoomLevel2;var _$$props$imagePreview=$$props.imagePreviewSrc,imagePreviewSrc=_$$props$imagePreview===void 0?undefined:_$$props$imagePreview;var _$$props$imageOriente=$$props.imageOrienter,imageOrienter=_$$props$imageOriente===void 0?{read:function read(){return 1;},apply:function apply(v){return v;}}:_$$props$imageOriente;var _$$props$pluginCompon=$$props.pluginComponents,pluginComponents=_$$props$pluginCompon===void 0?undefined:_$$props$pluginCompon;var _$$props$pluginOption=$$props.pluginOptions,pluginOptions=_$$props$pluginOption===void 0?{}:_$$props$pluginOption;var sub=eventProxy.sub;var pluginInterface={};var root=$$props.root;// media
var muteAudioStore=writable(muteAudio);component_subscribe($$self,muteAudioStore,function(value){return $$invalidate(339,$muteAudioStore=value);});// setup redraw store
var redrawTrigger=writable({});component_subscribe($$self,redrawTrigger,function(value){return $$invalidate(49,$redrawTrigger=value);});setContext('redrawTrigger',redrawTrigger);var elasticityMultiplierStore=writable(elasticityMultiplier);component_subscribe($$self,elasticityMultiplierStore,function(value){return $$invalidate(418,$elasticityMultiplierStore=value);});setContext('elasticityMultiplier',elasticityMultiplierStore);var registeredPluginsComponents=[];// editor disabled spring for animating in and out disabled state
var disabledTransition=spring();component_subscribe($$self,disabledTransition,function(value){return $$invalidate(91,$disabledTransition=value);});// this method is used to read image resources (preview image / shape images)
var glMaxTextureSize=getWebGLTextureSizeLimit()||1024;var maxTextureSize=sizeCreate(glMaxTextureSize,glMaxTextureSize);var canvasMemoryLimit=getCanvasMemoryLimit();var fetchSrc=function fetchSrc(src){return Promise.resolve($willRequest&&$willRequest(src,{resourceType:'image'})).then(function(requestInit){// do something with options
if(requestInit===false)return;// get props
var _ref222=requestInit||{},headers=_ref222.headers,credentials=_ref222.credentials;// fetch
return fetch(src,{headers:headers,credentials:credentials}).then(function(res){if(res.status!==200)throw"".concat(res.status," (").concat(res.statusText,")");return res.blob();}).then(function(blob){return blobToImageBitmap(blob,imageOrienter,canvasMemoryLimit);}).then(function(imageData){return imageDataContain(imageData,maxImageDataSize);});});};var _$$props$imageSourceT=$$props.imageSourceToImageData,imageSourceToImageData=_$$props$imageSourceT===void 0?function(src){return isString(src)?// it's a url src
fetchSrc(src):isElement(src)?// assume src is a <canvas>
new Promise(function(resolve){return resolve(canvasToImageData(src));}):// assume src is a File or Blob
isBlob(src)||isFile(src)?blobToImageBitmap(src,imageOrienter,canvasMemoryLimit).then(function(imageData){return imageDataContain(imageData,maxImageDataSize);}):undefined;}:_$$props$imageSourceT;var imageProxy=createImageProxy();var _imageProxy$stores=imageProxy.stores,imageFile=_imageProxy$stores.file,imageSize=_imageProxy$stores.size,mediaDuration=_imageProxy$stores.duration,mediaTrim=_imageProxy$stores.trim,imageLoadState=_imageProxy$stores.loadState,imageProcessState=_imageProxy$stores.processState,imageCropAspectRatio=_imageProxy$stores.cropAspectRatio,imageCropLimitToImage=_imageProxy$stores.cropLimitToImage,imageCropRect=_imageProxy$stores.crop,imageCropMinSize=_imageProxy$stores.cropMinSize,imageCropMaxSize=_imageProxy$stores.cropMaxSize,imageCropRange=_imageProxy$stores.cropRange,imageCropRectOrigin=_imageProxy$stores.cropOrigin,imageCropRectAspectRatio=_imageProxy$stores.cropRectAspectRatio,imageRotation=_imageProxy$stores.rotation,imageRotationRange=_imageProxy$stores.rotationRange,imageOutputSize=_imageProxy$stores.targetSize,imageFlipX=_imageProxy$stores.flipX,imageFlipY=_imageProxy$stores.flipY,imageBackgroundColor=_imageProxy$stores.backgroundColor,imageBackgroundImageSrc=_imageProxy$stores.backgroundImage,imageColorMatrix=_imageProxy$stores.colorMatrix,imageConvolutionMatrix=_imageProxy$stores.convolutionMatrix,imageGamma=_imageProxy$stores.gamma,imageVignette=_imageProxy$stores.vignette,imageNoise=_imageProxy$stores.noise,imageDecoration=_imageProxy$stores.decoration,imageAnnotation=_imageProxy$stores.annotation,imageRedaction=_imageProxy$stores.redaction,imageFrame=_imageProxy$stores.frame,imageState=_imageProxy$stores.state;component_subscribe($$self,imageFile,function(value){return $$invalidate(340,$imageFile=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(309,$imageSize=value);});component_subscribe($$self,mediaDuration,function(value){return $$invalidate(336,$mediaDuration=value);});component_subscribe($$self,mediaTrim,function(value){return $$invalidate(417,$mediaTrim=value);});component_subscribe($$self,imageLoadState,function(value){return $$invalidate(328,$imageLoadState=value);});component_subscribe($$self,imageProcessState,function(value){return $$invalidate(327,$imageProcessState=value);});component_subscribe($$self,imageCropAspectRatio,function(value){return $$invalidate(414,$imageCropAspectRatio=value);});component_subscribe($$self,imageCropLimitToImage,function(value){return $$invalidate(80,$imageCropLimitToImage=value);});component_subscribe($$self,imageCropRect,function(value){return $$invalidate(349,$imageCropRect=value);});component_subscribe($$self,imageRotation,function(value){return $$invalidate(312,$imageRotation=value);});component_subscribe($$self,imageFlipX,function(value){return $$invalidate(311,$imageFlipX=value);});component_subscribe($$self,imageFlipY,function(value){return $$invalidate(310,$imageFlipY=value);});component_subscribe($$self,imageBackgroundColor,function(value){return $$invalidate(318,$imageBackgroundColor=value);});component_subscribe($$self,imageDecoration,function(value){return $$invalidate(46,$imageDecoration=value);});component_subscribe($$self,imageAnnotation,function(value){return $$invalidate(47,$imageAnnotation=value);});component_subscribe($$self,imageRedaction,function(value){return $$invalidate(317,$imageRedaction=value);});component_subscribe($$self,imageFrame,function(value){return $$invalidate(45,$imageFrame=value);});component_subscribe($$self,imageState,function(value){return $$invalidate(402,$imageState=value);});var createImageSrcLoader=function createImageSrcLoader(src,token){var minDuration=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return new Promise(function(resolve,reject){// is a video
if(isVideoFile(src)){var metadataReader=isFirefox()?getVideoFileRotationMetadata(src):Promise.resolve();metadataReader.then(function(rotation){// let's load this source as a video file
var video=document.createElement('video');video.onerror=function(){return console.error(video.error);};video.playsInline=true;video.preload='auto';video.onloadeddata=function(){video.onloadeddata=undefined;video.dataset.rotation=rotation;videoFixDuration(video).then(function(){video.currentTime=willSetMediaInitialTimeOffset(video.duration,$mediaTrim||[[0,1]]);resolve(video);});};video.src=URL.createObjectURL(src);// this is needed to trigger load on iOS Safari
video.load();});return;}var cancelled=false;var timer;token.cancel=function(){return cancelled=true;};var now=Date.now();imageSourceToImageData(src).then(function(imageData){var dist=Date.now()-now;clearTimeout(timer);timer=setTimeout(function(){if(cancelled)return;resolve(imageData);},Math.max(0,minDuration-dist));})["catch"](reject);});};var _stores2=stores,images=_stores2.images,shapePreprocessor=_stores2.shapePreprocessor,imageScrambler=_stores2.imageScrambler,willRequest=_stores2.willRequest,willRequestResource=_stores2.willRequestResource;component_subscribe($$self,images,function(value){return $$invalidate(356,$images=value);});component_subscribe($$self,shapePreprocessor,function(value){return $$invalidate(355,$shapePreprocessor=value);});component_subscribe($$self,imageScrambler,function(value){return $$invalidate(319,$imageScrambler=value);});component_subscribe($$self,willRequest,function(value){return $$invalidate(76,$willRequest=value);});component_subscribe($$self,willRequestResource,function(value){return $$invalidate(82,$willRequestResource=value);});var backgroundImageDataCancelToken;var imageBackgroundImageData=derived(imageBackgroundImageSrc,function($backgroundImageSrc,set){if(!$backgroundImageSrc)return set(undefined);// cancel existing loader
if(backgroundImageDataCancelToken){backgroundImageDataCancelToken.cancel();backgroundImageDataCancelToken=undefined;}// new cancel token
backgroundImageDataCancelToken={cancel:noop$1};createImageSrcLoader($backgroundImageSrc,backgroundImageDataCancelToken).then(set)["catch"](function(err){// log to console for debugging purposes
});});// let the world know about state changes
var imageStateUnsub=imageState.subscribe(function(state){return eventProxy.pub('update',state);});// this will hold the currently selected util
var utilSelectedStore=writable();// current editor UI state
var uiState=writable({});setContext('ui',uiState);// utils can toggle pan and zoom
var allowPan=writable(true);component_subscribe($$self,allowPan,function(value){return $$invalidate(84,$allowPan=value);});var allowZoom=writable(true);component_subscribe($$self,allowZoom,function(value){return $$invalidate(86,$allowZoom=value);});var allowZoomControls=writable(true);component_subscribe($$self,allowZoomControls,function(value){return $$invalidate(354,$allowZoomControls=value);});var enablePanInputStore=writable(true);component_subscribe($$self,enablePanInputStore,function(value){return $$invalidate(415,$enablePanInputStore=value);});var enableZoomInputStore=writable(true);component_subscribe($$self,enableZoomInputStore,function(value){return $$invalidate(87,$enableZoomInputStore=value);});// so controls can be disabled from other component
var enableZoomControlsProp=writable();component_subscribe($$self,enableZoomControlsProp,function(value){return $$invalidate(88,$enableZoomControlsProp=value);});// so we can derive pan input status
var enablePanInputProp=writable();component_subscribe($$self,enablePanInputProp,function(value){return $$invalidate(416,$enablePanInputProp=value);});// current pan input status
var enablePanInputStatus=derived([enablePanInputProp,enablePanInputStore],function(){return $enablePanInputProp!==undefined?$enablePanInputProp:$enablePanInputStore;});component_subscribe($$self,enablePanInputStatus,function(value){return $$invalidate(85,$enablePanInputStatus=value);});//
// handles the view rect size, makes sure it is offset from the top
//
// root element reference used to read styles
var rootBackgroundColor=writable([0,0,0]);component_subscribe($$self,rootBackgroundColor,function(value){return $$invalidate(53,$rootBackgroundColor=value);});var rootForegroundColor=writable([1,1,1]);component_subscribe($$self,rootForegroundColor,function(value){return $$invalidate(399,$rootForegroundColor=value);});var rootLineColor=spring([1,1,1]);component_subscribe($$self,rootLineColor,function(value){return $$invalidate(398,$rootLineColor=value);});var rootColorSecondary=writable();// client rect is the editor rect excluding scroll offset
var clientRect=writable();component_subscribe($$self,clientRect,function(value){return $$invalidate(48,$clientRect=value);});// root rect is the editor rect including scroll offset
var rootRect=writable();component_subscribe($$self,rootRect,function(value){return $$invalidate(314,$rootRect=value);});// when in overlay mode force aspect ratio to aspect ratio of editor root
var syncRootAspectRatio=function syncRootAspectRatio(){// get current aspect ratio and get next aspect ratio, compare, if different, reset
var currentAspectRatio=$imageCropAspectRatio;var nextAspectRatio=rectAspectRatio($rootRect);if(currentAspectRatio&&currentAspectRatio===nextAspectRatio)return;// set aspect ratio
imageCropAspectRatio.set(rectAspectRatio($rootRect));// need to set history 0 point to this state
setInitialHistoryState();};var tabRect=writable(rectCreateEmpty());component_subscribe($$self,tabRect,function(value){return $$invalidate(75,$tabRect=value);});var toolRect=writable(rectCreateEmpty());component_subscribe($$self,toolRect,function(value){return $$invalidate(79,$toolRect=value);});var utilRect=writable();// is undefined because we wait till util is set before defining stage rect
component_subscribe($$self,utilRect,function(value){return $$invalidate(396,$utilRect=value);});//
// environment
//
var pointerAccuracy=mediaQueryStore('(pointer: fine)',function(matches){return matches?'pointer-fine':'pointer-coarse';});component_subscribe($$self,pointerAccuracy,function(value){return $$invalidate(334,$pointerAccuracy=value);});var pointerHoverable=mediaQueryStore('(hover: hover)',function(matches){return matches?'pointer-hover':'pointer-no-hover';});component_subscribe($$self,pointerHoverable,function(value){return $$invalidate(333,$pointerHoverable=value);});//
// app API
//
var isTransformingImage=writable(false);var isInteracting=writable(false);component_subscribe($$self,isInteracting,function(value){return $$invalidate(315,$isInteracting=value);});var isInteractingFraction=readable(undefined,function(set){var animator=spring(0);var updater=function updater(value){animator.set(value?1:0);};var subs=[isInteracting.subscribe(updater),animator.subscribe(set)];// destroy subs
return function(){return subs.forEach(function(unsub){return unsub();});};});component_subscribe($$self,isInteractingFraction,function(value){return $$invalidate(397,$isInteractingFraction=value);});// create animation stores
var shouldAnimate=writable();component_subscribe($$self,shouldAnimate,function(value){return $$invalidate(401,$shouldAnimate=value);});var isAnimated=writable();component_subscribe($$self,isAnimated,function(value){return $$invalidate(50,$isAnimated=value);});// Animations based on prefers-reduced-motion, automatically checks if user prefers reduced animations
setContext('isAnimated',isAnimated);var previewShouldUpscale=writable(previewUpscale);component_subscribe($$self,previewShouldUpscale,function(value){return $$invalidate(337,$previewShouldUpscale=value);});//
// image related
//
var imageIsStatic=writable(false);// if is set to true image is selection is dragged
component_subscribe($$self,imageIsStatic,function(value){return $$invalidate(407,$imageIsStatic=value);});setContext('imageIsStatic',imageIsStatic);var imageCropRectSnapshot=writable();component_subscribe($$self,imageCropRectSnapshot,function(value){return $$invalidate(408,$imageCropRectSnapshot=value);});var imageCropRectIntent=writable();// should always be set before setting `imageCropRect`
component_subscribe($$self,imageCropRectIntent,function(value){return $$invalidate(405,$imageCropRectIntent=value);});var imageCropRectPresentation=readable(undefined,function(set){var animator=writable(undefined);var update=function update(){if(!$imageCropRect)return;// no elasticity needed when dragging crop selection
if($imageIsStatic)return animator.set(rectClone$1($imageCropRect));// apply elasticity
var elasticRect=elastifyRects($imageCropRect,$imageCropRectIntent,imageCropRectElasticity*elasticityMultiplier);animator.set(elasticRect);};var subs=[// need to update presentation rect when crop rect is updated
imageCropRect.subscribe(update),// update parent store
animator.subscribe(set)];return function(){return subs.forEach(function(unsub){return unsub();});};});var imageSelectionRect=writable();component_subscribe($$self,imageSelectionRect,function(value){return $$invalidate(404,$imageSelectionRect=value);});var imageSelectionRectSnapshot=writable();component_subscribe($$self,imageSelectionRectSnapshot,function(value){return $$invalidate(406,$imageSelectionRectSnapshot=value);});var imageSelectionRectIntent=writable(undefined);// should always be set before setting `imageSelectionRect`
component_subscribe($$self,imageSelectionRectIntent,function(value){return $$invalidate(412,$imageSelectionRectIntent=value);});var imageSelectionRectOffset=writable(vectorCreateEmpty());component_subscribe($$self,imageSelectionRectOffset,function(value){return $$invalidate(413,$imageSelectionRectOffset=value);});var getFrameOutset=function getFrameOutset(presentationRect,imageFrame){if(!imageFrame||!presentationRect)return{top:0,right:0,bottom:0,left:0};var shapes=shapesFromCompositShape(imageFrame,presentationRect,preprocessShape);var bounds=shapesBounds(shapes,presentationRect);return{top:Math.abs(bounds.top),right:Math.abs(bounds.right),bottom:Math.abs(bounds.bottom),left:Math.abs(bounds.left)};};// let stageRecenterPrev;
var stageRecenter=writable({});var stageRectBase=derived([utilRect,tabRect,toolRect,stageRecenter],function(_ref223,set){var _ref224=_slicedToArray(_ref223,4),$utilRect=_ref224[0],$tabRect=_ref224[1],$toolRect=_ref224[2],$stageRecenter=_ref224[3];if(!$utilRect)return set(undefined);var utilOffsetY=0;// if only one util active, we don't have util tabs, so add additional offset
if(utilsFiltered.length===1&&!isOverlayModeEnabled&&layoutVerticalToolbarPreference!=='bottom'){utilOffsetY=$toolRect.y+$toolRect.height;}set(rectCreate($utilRect.x+$tabRect.x,$utilRect.y+$tabRect.y+utilOffsetY,$utilRect.width,$utilRect.height));});var prevStagePadding={left:0,right:0,top:0,bottom:0};var shouldPadPreview=writable(false);var stagePadding=derived([shouldPadPreview,imageFrame,stageRectBase,isInteracting],function(_ref225,set){var _ref226=_slicedToArray(_ref225,4),$shouldPadPreview=_ref226[0],$imageFrame=_ref226[1],$stageRectBase=_ref226[2],$isInteracting=_ref226[3];if(!$stageRectBase){return set({left:0,right:0,top:0,bottom:0});}// exit
if(!$shouldPadPreview)return;// a sane default padding around a frame
var size=Math.min($stageRectBase.width,$stageRectBase.height);// set frame padding
var newStagePadding=getFrameOutset({width:size,height:size},$imageFrame);// exit if no value changes
if(fixPrecision(prevStagePadding.top,4)===fixPrecision(newStagePadding.top,4)&&fixPrecision(prevStagePadding.bottom,4)===fixPrecision(newStagePadding.bottom,4)&&fixPrecision(prevStagePadding.right,4)===fixPrecision(newStagePadding.right,4)&&fixPrecision(prevStagePadding.left,4)===fixPrecision(newStagePadding.left,4))return;prevStagePadding=newStagePadding;set(newStagePadding);});component_subscribe($$self,stagePadding,function(value){return $$invalidate(347,$stagePadding=value);});var stagePadded=derived([shouldPadPreview,stagePadding],function(_ref227,set){var _ref228=_slicedToArray(_ref227,2),$shouldPadPreview=_ref228[0],$stagePadding=_ref228[1];if(!$shouldPadPreview)return set(false);set(Object.values($stagePadding).some(function(value){return value>0;}));});component_subscribe($$self,stagePadded,function(value){return $$invalidate(348,$stagePadded=value);});var utilRectPadded=derived([shouldPadPreview,utilRect,stagePadded,stagePadding],function(_ref229,set){var _ref230=_slicedToArray(_ref229,4),$shouldPadPreview=_ref230[0],$utilRect=_ref230[1],$stagePadded=_ref230[2],$stagePadding=_ref230[3];if(!$utilRect)return;if(!$shouldPadPreview||!$stagePadded)return set(_objectSpread({},$utilRect));set(rectCreate($utilRect.x+$stagePadding.left,$utilRect.y+$stagePadding.top,$utilRect.width-$stagePadding.left-$stagePadding.right,$utilRect.height-$stagePadding.top-$stagePadding.bottom));});var stageRect=derived([stageRectBase,stagePadded,stagePadding],function(_ref231,set){var _ref232=_slicedToArray(_ref231,3),$stageRectBase=_ref232[0],$stagePadded=_ref232[1],$stagePadding=_ref232[2];if(!$stageRectBase)return set(undefined);if(!$stagePadded)return set($stageRectBase);set(rectCreate($stageRectBase.x+$stagePadding.left,$stageRectBase.y+$stagePadding.top,$stageRectBase.width-$stagePadding.left-$stagePadding.right,$stageRectBase.height-$stagePadding.top-$stagePadding.bottom));});component_subscribe($$self,stageRect,function(value){return $$invalidate(313,$stageRect=value);});var imageStaticCorners=derived([imageIsStatic,imageSize,imageRotation],function(_ref233,set){var _ref234=_slicedToArray(_ref233,3),$imageIsStatic=_ref234[0],$imageSize=_ref234[1],$imageRotation=_ref234[2];// no need for bounds measuring if is not static image
if(!$imageIsStatic||!$imageSize)return set(undefined);var rect=rectCreateFromSize($imageSize);var rectRotatedCorners=rectRotate(rect,$imageRotation);set(rectRotatedCorners);});var imageStaticBounds=derived([imageStaticCorners],function(_ref235,set){var _ref236=_slicedToArray(_ref235,1),$imageStaticCorners=_ref236[0];if(!$imageStaticCorners)return set(undefined);var rectRotated=rectCreateFromPoints($imageStaticCorners);set(rectNormalizeOffset(rectRotated));});component_subscribe($$self,imageStaticBounds,function(value){return $$invalidate(350,$imageStaticBounds=value);});var stageScalar=derived([stageRect,imageCropRect,imageStaticBounds,previewShouldUpscale],function(_ref237,set){var _ref238=_slicedToArray(_ref237,4),$stageRect=_ref238[0],$imageCropRect=_ref238[1],$imageStaticBounds=_ref238[2],$previewShouldUpscale=_ref238[3];var isManipulatingImageCropRect=!!($imageCropRectSnapshot||$imageCropRectIntent);// update stage scalar, the crop output size relative to the stage, if image fits it's 1
if(!$stageRect||!$imageCropRect||isManipulatingImageCropRect)return;// use image bounds instead of crop
var _ref239=$imageStaticBounds||$imageCropRect,width=_ref239.width,height=_ref239.height;// calculate scale factor needed to fit crop rect to stage
var scalar=Math.min($stageRect.width/width,$stageRect.height/height);// always scaled down to fit stage, if is allowed to upscale, zoom to fit stage
var scale=$previewShouldUpscale?scalar:Math.min(1,scalar);set(scale);});component_subscribe($$self,stageScalar,function(value){return $$invalidate(410,$stageScalar=value);});var imageStaticVisualCorners=derived([imageIsStatic,imageSize,imageRotation,stageRect,utilRect,stageScalar],function(_ref240,set){var _ref241=_slicedToArray(_ref240,6),$imageIsStatic=_ref241[0],$imageSize=_ref241[1],$imageRotation=_ref241[2],$stageRect=_ref241[3],$utilRect=_ref241[4],$stageScalar=_ref241[5];// no need for bounds measuring if is not static image
if(!$imageIsStatic||!$stageRect||!$utilRect||!$imageSize)return set(undefined);var rect=rectCreateFromSize($imageSize);var rectScaled=rectNormalizeOffset(rectScale$1(rect,$stageScalar));var rectCentered=rectCenterRect($stageRect,rectScaled);rectScaled.x=rectCentered.x;rectScaled.y=rectCentered.y;var rectRotatedCorners=rectRotate(rectScaled,$imageRotation);set(rectRotatedCorners);});setContext('imageStaticVisualCorners',imageStaticVisualCorners);//
// Image selection
//
var imageSelectionZoom=writable(undefined);component_subscribe($$self,imageSelectionZoom,function(value){return $$invalidate(352,$imageSelectionZoom=value);});var imageSelectionStageFitScalar=derived([imageCropRect,stageRect],function(_ref242){var _ref243=_slicedToArray(_ref242,2),$imageCropRect=_ref243[0],$stageRect=_ref243[1];// wait a bit
if(!$stageRect||!$imageCropRect)return undefined;return Math.min($stageRect.width/$imageCropRect.width,$stageRect.height/$imageCropRect.height);});var imageSelectionRectScalar=derived([imageCropRect,imageSelectionRect],function(_ref244){var _ref245=_slicedToArray(_ref244,2),$imageCropRect=_ref245[0],$imageSelectionRect=_ref245[1];// wait a bit
if(!$imageCropRect||!$imageSelectionRect)return 1;return Math.min($imageCropRect.width/$imageSelectionRect.width,$imageCropRect.height/$imageSelectionRect.height);});component_subscribe($$self,imageSelectionRectScalar,function(value){return $$invalidate(90,$imageSelectionRectScalar=value);});var imageSelectionScalar=derived([imageSelectionZoom,imageSelectionRectScalar],function(_ref246){var _ref247=_slicedToArray(_ref246,2),$imageSelectionZoom=_ref247[0],$imageSelectionRectScalar=_ref247[1];// wait a bit
if(!$imageSelectionZoom||!$imageSelectionRectScalar)return 1;// calculate scalar  to get actual image size
return $imageSelectionRectScalar*$imageSelectionZoom;});component_subscribe($$self,imageSelectionScalar,function(value){return $$invalidate(411,$imageSelectionScalar=value);});var imageSelectionPan=writable(vectorCreateEmpty());component_subscribe($$self,imageSelectionPan,function(value){return $$invalidate(351,$imageSelectionPan=value);});var imageSelectionStoredState=writable({scalar:$imageSelectionScalar,translation:$imageSelectionPan});var imageSelectionStoredStateReset=function imageSelectionStoredStateReset(){imageSelectionStoredState.set({scalar:undefined,translation:vectorCreateEmpty()});};var imageSelectionRectPresentation=readable(undefined,function(set){var animator=spring(undefined,{precision:0.0001});var snapPixels=getDevicePixelRatio()===1?function(rect){return rectApply(rect,Math.round);}:passthrough;var updater=function updater(){if(!$imageSelectionRect)return;var instantUpdate=$isInteracting||!$shouldAnimate;// no elasticity needed if image is fixed
if($imageIsStatic){var rect=rectClone$1($imageSelectionRect);rectTranslate$1(rect,$imageSelectionRectOffset);rectTranslate$1(rect,$stageRect);return animator.set(rect,{hard:instantUpdate});}var elasticRect=elastifyRects($imageSelectionRect,$imageSelectionRectIntent,imageSelectionRectElasticity*elasticityMultiplier);// prevent negative size (can happen because of elastics)
if(elasticRect.width<0){elasticRect.width=0;elasticRect.x=$imageSelectionRect.x;}if(elasticRect.height<0){elasticRect.height=0;elasticRect.y=$imageSelectionRect.y;}// translate elastic rect x,y by stage rect x,y
rectTranslate$1(elasticRect,$stageRect);// translate
rectTranslate$1(elasticRect,$imageSelectionPan);// scale to zoom in view
rectScale$1(elasticRect,$imageSelectionScalar);// round to pixels on low res displays
!instantUpdate&&snapPixels(elasticRect);animator.set(elasticRect,{hard:instantUpdate});};var subs=[// need to update selection rect when stage is resized
stageRect.subscribe(updater),// listen for selection rect changes (as is assigned rect will always trigger, even if assigned same rect, this is needed to also update when intent changes)
imageSelectionRect.subscribe(updater),// if selection scalar changes need to update presentation
imageSelectionScalar.subscribe(updater),imageSelectionPan.subscribe(updater),// need to update if frame exceeds bounds
imageFrame.subscribe(updater),// update parent store
animator.subscribe(set)];// destroy subs
return function(){return subs.forEach(function(unsub){return unsub();});};});component_subscribe($$self,imageSelectionRectPresentation,function(value){return $$invalidate(55,$imageSelectionRectPresentation=value);});var imageSelectionRectStaticScalar=writable(1);component_subscribe($$self,imageSelectionRectStaticScalar,function(value){return $$invalidate(403,$imageSelectionRectStaticScalar=value);});var centerImageStaticBounds=function centerImageStaticBounds(){if(!$imageCropRect||!$stageRect)return;var rect=rectMultiply(rectClone$1($imageCropRect),$stageScalar||1);var rectOffset=rectCenterRect($stageRect,rectMultiply(rectClone$1($imageStaticBounds),$stageScalar));rectTranslate$1(rect,rectOffset);var selectionScaledWidth=$utilRect.width/rect.width;var selectionScaledHeight=$utilRect.height/rect.height;var scalar=Math.min(1,selectionScaledWidth,selectionScaledHeight);imageSelectionRectStaticScalar.set(scalar);rectScale$1(rect,scalar);// limit selection rect to util bounds
rectOffsetInRect(rect,_objectSpread(_objectSpread({},$utilRect),{},{x:0,y:0}));imageSelectionRect.set(rect);};//
var imageSelectionRectCentered=derived([stageRect,stageScalar,imageCropRect,imageSize],function(_ref248,set){var _ref249=_slicedToArray(_ref248,4),$stageRect=_ref249[0],$stageScalar=_ref249[1],$imageCropRect=_ref249[2],$imageSize=_ref249[3];// not ready yet
if(!$stageRect||!$imageCropRect&&!$imageSize)return;set(getImageSelectionRectCentered($stageRect,$stageScalar||1,$imageCropRect||$imageSize));});component_subscribe($$self,imageSelectionRectCentered,function(value){return $$invalidate(89,$imageSelectionRectCentered=value);});var getImageSelectionRectCentered=function getImageSelectionRectCentered(stageRect,stageScalar,cropRect){var imageCropRectFitsStage=cropRect.width<=stageRect.width&&cropRect.height<=stageRect.height;// if we have a crop rect and it fits the stage, center it
return imageCropRectFitsStage?// center the crop rectangle to the stage
rectCenterRect(stageRect,rectMultiply(rectClone$1(cropRect),stageScalar)):// render a rectangle based on the fixed crop aspect ratio, or the aspect ratio of the current crop rectangle, or as a last resort the input image
rectContainRect(stageRect,rectAspectRatio(cropRect));};// when scaling the stage we need to recenter the image selection
var stageRectPrev;var stageScalePrev;var calculateImageSelectionRect=function calculateImageSelectionRect(stageRectCurrent){// don't recalculate if no change
if(isOverlayModeEnabled&&stageRectPrev&&rectEqual(stageRectPrev,stageRectCurrent)&&stageScalePrev===$stageScalar)return;// position relative to image itself
if($imageIsStatic)return centerImageStaticBounds();// remember so we can compare later on if has changed
stageRectPrev=stageRectCurrent;stageScalePrev=$stageScalar;var centeredImageSelectionRect=getImageSelectionRectCentered(stageRectCurrent,$stageScalar,$imageCropRect||$imageSize);imageSelectionRect.set(centeredImageSelectionRect);};// this runs once so we use the correct scale for the initial image selection rect
var hasSetInitialStageScalar=false;var stageScalarUnsub=stageScalar.subscribe(function(scalar){// can't recalculate without these prosp
if(hasSetInitialStageScalar||scalar===undefined||!$imageCropRect)return;calculateImageSelectionRect($stageRect);hasSetInitialStageScalar=true;});// this recenters the crop when the window/stage is resized
var stageRectUnsub=stageRect.subscribe(function(rect){// can't recalculate without these prosp
if(!rect||$stageScalar===undefined||!$imageCropRect)return;calculateImageSelectionRect(rect);});var imageIsStaticUnsub=imageIsStatic.subscribe(function(isStatic){if(!isStatic&&$stageRect)calculateImageSelectionRect($stageRect);});// if we've taken a snapshot of the selection, also take a snapshot of the crop rect and the presentationScalar
// - cropRect so we can adjust it based on the adjustments to the imageSelectionRect
// - presentationScalar so we can use the snapshot for the calculation of the cropRect scale relative to the original imageSelectionRect (if we use the live $presentationScalar small rounding errors of the scalar result in weird glitches)
var presentationScalarSnapshot;var imageSelectionRectSnapshotUnsub=imageSelectionRectSnapshot.subscribe(function(rect){if(!rect){presentationScalarSnapshot=undefined;set_store_value(imageCropRectSnapshot,$imageCropRectSnapshot=undefined,$imageCropRectSnapshot);return;}presentationScalarSnapshot=$presentationScalar;var cropRectClone=rectClone$1($imageCropRect);imageCropRectSnapshot.set(cropRectClone);});// if image selection rect is being manipulated, and imageSelectionRectSnapshot has been defined, we also need to update the crop rect
var imageSelectionRectUnsub=imageSelectionRect.subscribe(function(rect){// only sync crop rect with image selection rect when no longer manipulating
if(!rect||!$imageSelectionRectSnapshot)return;var offset=rectSubtract(rectClone$1(rect),$imageSelectionRectSnapshot);rectDivide(offset,presentationScalarSnapshot);var crop=rectAdd(rectClone$1($imageCropRectSnapshot),offset);imageCropRect.set(crop);});var updateImageSelectionRect=function updateImageSelectionRect(rect){// if no rect, we can't do anything
// if no selection rect yet, we wait for a selection rect to be loaded
if(!rect||!$imageSelectionRect)return;// if image is static we only have to keep centering it
if($imageIsStatic){// keep centering
if(!$imageSelectionRectSnapshot)centerImageStaticBounds();return;}// don't update image selection rect while we're intertacting with the view, this prevents feedback loop from cropRect model updates
if($isInteracting||$imageSelectionRectSnapshot||$imageCropRectIntent)return;// only if crop aspect ratio differs from image selection aspect ratio we update image selection rectangle
var imageSelectionRectAspectRatio=rectAspectRatio($imageSelectionRect);var cropRectAspectRatio=rectAspectRatio(rect);if(fixPrecision(imageSelectionRectAspectRatio,6)===fixPrecision(cropRectAspectRatio,6))return;// TEMP DUPLICATE OF STAGESCALAR DERIVED STORE TO FIX ZOOM OUT AFTER WHEEL ISSUE
// reproduce -> crop view => resize selection rect vertically, tap recenter, zoom out with scroll wheel
var _ref250=$imageStaticBounds||$imageCropRect,width=_ref250.width,height=_ref250.height;var scalar=Math.min($stageRect.width/width,$stageRect.height/height);var size=sizeCreate(rect.width*scalar,rect.height*scalar);var tx=($imageSelectionRect.width-size.width)*0.5;var ty=($imageSelectionRect.height-size.height)*0.5;var selectionRect=rectCreate($imageSelectionRect.x+tx,$imageSelectionRect.y+ty,size.width,size.height);imageSelectionRect.set(selectionRect);};var imageCropRectUnsub=imageCropRect.subscribe(updateImageSelectionRect);var imageScalar=derived([stageScalar,imageCropRect,imageSelectionRect,imageIsStatic],function(_ref251,set){var _ref252=_slicedToArray(_ref251,4),$stageScalar=_ref252[0],$imageCropRect=_ref252[1],$imageSelectionRect=_ref252[2],$imageIsStatic=_ref252[3];// update the image scalar, the image zoom calculated by the image selection and the actual crop coordinates
if(!$stageScalar||!$imageCropRect||!$imageSelectionRect)return;// if image static bound set, the image is always centered in view
if($imageIsStatic)return set($imageSelectionRectStaticScalar);var selectionScaledWidth=$imageSelectionRect.width/$imageCropRect.width;var selectionScaledHeight=$imageSelectionRect.height/$imageCropRect.height;var scalar=Math.max(selectionScaledWidth,selectionScaledHeight)/$stageScalar;set(scalar);});var presentationScalar=derived([stageScalar,imageScalar],function(_ref253,set){var _ref254=_slicedToArray(_ref253,2),$stageScalar=_ref254[0],$imageScalar=_ref254[1];// can't scale presentation if no image scalar defined
if(!$imageScalar)return;var scalar=$stageScalar*$imageScalar;set(scalar);});component_subscribe($$self,presentationScalar,function(value){return $$invalidate(409,$presentationScalar=value);});//
// UI Elements
//
var prevFrameOutset={left:0,right:0,top:0,bottom:0};var frameOutset=derived([imageFrame,imageSelectionRect],function(_ref255,set){var _ref256=_slicedToArray(_ref255,2),$imageFrame=_ref256[0],$imageSelectionRect=_ref256[1];// exit
if(!$imageSelectionRect)return set(prevFrameOutset);// set frame padding
var newFrameOutset=getFrameOutset($imageSelectionRect,$imageFrame);// exit if no value changes
if(fixPrecision(prevFrameOutset.top,4)===fixPrecision(newFrameOutset.top,4)&&fixPrecision(prevFrameOutset.bottom,4)===fixPrecision(newFrameOutset.bottom,4)&&fixPrecision(prevFrameOutset.right,4)===fixPrecision(newFrameOutset.right,4)&&fixPrecision(prevFrameOutset.left,4)===fixPrecision(newFrameOutset.left,4))return;prevFrameOutset=newFrameOutset;set(newFrameOutset);});var frameHasOutset=derived([frameOutset],function(_ref257,set){var _ref258=_slicedToArray(_ref257,1),$frameOutset=_ref258[0];set(Object.values($frameOutset).some(function(value){return value>0;}));});var imageOutlineOpacity=spring(0.075,{stiffness:0.03,damping:0.4,precision:0.001});var imageOutline=derived([rootLineColor,rootBackgroundColor,imageOutlineOpacity,imageSelectionRectPresentation,imageSelectionScalar,imageFrame,frameHasOutset,frameOutset,stagePadded],function(_ref259,set){var _ref260=_slicedToArray(_ref259,9),$rootLineColor=_ref260[0],$rootBackgroundColor=_ref260[1],$colorOpacity=_ref260[2],$rect=_ref260[3],$rectScalar=_ref260[4],$imageFrame=_ref260[5],$frameHasOutset=_ref260[6],$frameOutset=_ref260[7],$stagePadded=_ref260[8];if(!$rect||isOverlayModeEnabled)return set([]);var x=$rect.x,y=$rect.y,width=$rect.width,height=$rect.height;x+=0.5;y+=0.5;width-=0.5;height-=0.5;var shapes=[];if($imageFrame){// draw dark or bright line around frame to make it stand out from background
if($frameHasOutset){var left=$frameOutset.left,right=$frameOutset.right,top=$frameOutset.top,bottom=$frameOutset.bottom;left*=$rectScalar;right*=$rectScalar;top*=$rectScalar;bottom*=$rectScalar;var isDarkBackground=isDarkColor($rootBackgroundColor);var shadeColor=isDarkBackground?[1,1,1,0.125]:[0,0,0,0.075];shapes.push({x:x-left-0.5,y:y-top-0.5,width:width+left+right+1,height:height+top+bottom+1,strokeWidth:1,strokeColor:shadeColor,opacity:$stagePadded?1:0.5});}// draw extra shading around edge so crop controls are extra visible
var isDarkOutline=isDarkColor($rootLineColor);var isDarkFrame=$imageFrame&&$imageFrame.frameColor&&isDarkColor($imageFrame.frameColor);if(!isDarkFrame&&!isDarkOutline){shapes.push({x:x-1,y:y-1,width:width+2,height:height+2,strokeWidth:2,strokeColor:[0,0,0,0.1],opacity:$colorOpacity});shapes.push({x:x+1,y:y+1,width:width-2,height:height-2,strokeWidth:2,strokeColor:[0,0,0,0.1],opacity:$colorOpacity});}}set([].concat(shapes,[// default outline
{x:x,y:y,width:width,height:height,strokeWidth:1,strokeColor:$rootLineColor,opacity:$colorOpacity}]));});// custom markup rendered on top of image
var imageOverlayMarkup=writable([]);component_subscribe($$self,imageOverlayMarkup,function(value){return $$invalidate(341,$imageOverlayMarkup=value);});// the resulting overlay markup
var imageOverlay=derived([imageOutline,imageOverlayMarkup],function(_ref261,set){var _ref262=_slicedToArray(_ref261,2),$imageOutline=_ref262[0],$imageOverlayMarkup=_ref262[1];set([].concat(_toConsumableArray($imageOutline),_toConsumableArray($imageOverlayMarkup)));});component_subscribe($$self,imageOverlay,function(value){return $$invalidate(83,$imageOverlay=value);});//
// Stage overlay
//
var overlayOpacity=spring(0,{precision:0.001});component_subscribe($$self,overlayOpacity,function(value){return $$invalidate(343,$overlayOpacity=value);});var overlayLeftRect=spring();component_subscribe($$self,overlayLeftRect,function(value){return $$invalidate(346,$overlayLeftRect=value);});var overlayTopRect=spring();component_subscribe($$self,overlayTopRect,function(value){return $$invalidate(345,$overlayTopRect=value);});var overlayRightRect=spring();component_subscribe($$self,overlayRightRect,function(value){return $$invalidate(344,$overlayRightRect=value);});var overlayBottomRect=spring();component_subscribe($$self,overlayBottomRect,function(value){return $$invalidate(342,$overlayBottomRect=value);});//
// Loading the preview
//
var imageVisualLoadComplete=writable(false);component_subscribe($$self,imageVisualLoadComplete,function(value){return $$invalidate(326,$imageVisualLoadComplete=value);});var imagePreviewSource=writable();component_subscribe($$self,imagePreviewSource,function(value){return $$invalidate(329,$imagePreviewSource=value);});var imagePreviewLoaderCancelToken;var imagePreview=derived([imageVisualLoadComplete,imagePreviewSource],function(_ref263,set){var _ref264=_slicedToArray(_ref263,2),$imageVisualLoadComplete=_ref264[0],$imagePreviewSource=_ref264[1];// no data, reset preview data
if(!$imageVisualLoadComplete||!$imagePreviewSource){set(undefined);return;}// cancel existing loader
if(imagePreviewLoaderCancelToken){imagePreviewLoaderCancelToken.cancel();$$invalidate(244,imagePreviewLoaderCancelToken=undefined);}// if image preview source is a canvas we can update immediately
if(isCanvas($imagePreviewSource)){// update image preview to canvas
return set(canvasClone($imagePreviewSource));}// try not to show preview loader if updating active images array
var minPreviewLoaderDuration=activeImages.length?0:$isAnimated?250:0;// load preview
$$invalidate(244,imagePreviewLoaderCancelToken={cancel:noop$1});createImageSrcLoader($imagePreviewSource,imagePreviewLoaderCancelToken,minPreviewLoaderDuration).then(set)["catch"](function(err){// update load state
set_store_value(imageLoadState,$imageLoadState.error=err,$imageLoadState);// log to console for debugging purposes
})["finally"](function(){// no longer loading
$$invalidate(244,imagePreviewLoaderCancelToken=undefined);});});$$subscribe_imagePreview();var setPreviewVideoPlayState=function setPreviewVideoPlayState(shouldPlay){// is not a video
if(!$mediaDuration||!$imagePreview)return;// toggle play state
if(shouldPlay&&$imagePreview.paused){$imagePreview.play()["catch"](function(){});// paused before could start playing, silence this error for now
}else if(!shouldPlay&&!$imagePreview.paused){$imagePreview.pause();}};var setPreviewVideoMuteState=function setPreviewVideoMuteState(isMuted){// is not a video
if(!$mediaDuration||!$imagePreview)return;// toggle mute state
var videoElement=$imagePreview;videoElement.muted=isMuted;};var _$$props$imagePreview2=$$props.imagePreviewCurrent,imagePreviewCurrent=_$$props$imagePreview2===void 0?undefined:_$$props$imagePreview2;//
// Calculates the image transforms and effects necessary for the preview
//
var imagePreviewModifiers=writable({});component_subscribe($$self,imagePreviewModifiers,function(value){return $$invalidate(331,$imagePreviewModifiers=value);});var interfaceImages=writable([]);component_subscribe($$self,interfaceImages,function(value){return $$invalidate(81,$interfaceImages=value);});// reset image UI previews when new file is loaded
var resetPreviews=function resetPreviews(){imageSelectionPan.set(vectorCreateEmpty());imageSelectionZoom.set(undefined);imageSelectionStoredStateReset();interfaceImages.set([]);};var imageTransforms=derived([stageRect,rootRect,imageSize,imageCropRectPresentation,imageSelectionRect,presentationScalar,imageRotation,imageFlipX,imageFlipY,imageSelectionScalar,imageSelectionPan,isTransformingImage],function(_ref265,set){var _ref266=_slicedToArray(_ref265,12),$stageRect=_ref266[0],$rootRect=_ref266[1],$imageSize=_ref266[2],$imageCropRectPresentation=_ref266[3],$imageSelectionRect=_ref266[4],$presentationScalar=_ref266[5],$imageRotation=_ref266[6],$imageFlipX=_ref266[7],$imageFlipY=_ref266[8],$imageSelectionScalar=_ref266[9],$imageSelectionPan=_ref266[10],$isTransformingImage=_ref266[11];if(!$stageRect||!$imageSelectionRect)return;var imageTransforms=calculateImageTransforms($stageRect,$rootRect,$imageSize,$imageCropRectPresentation,$imageSelectionRect,$imageSelectionScalar,$imageSelectionPan,$presentationScalar,$imageRotation,$imageFlipX,$imageFlipY);!$isTransformingImage&&imageTransformsSnapPixels(imageTransforms);set(imageTransforms);});component_subscribe($$self,imageTransforms,function(value){return $$invalidate(332,$imageTransforms=value);});var imageEffects=derived([imageColorMatrix,imageConvolutionMatrix,imageGamma,imageVignette,imageNoise],function(_ref267,set){var _ref268=_slicedToArray(_ref267,5),$colorMatrix=_ref268[0],$convolutionMatrix=_ref268[1],$gamma=_ref268[2],$vignette=_ref268[3],$noise=_ref268[4];var colorMatrices=$colorMatrix&&Object.keys($colorMatrix).map(function(name){return $colorMatrix[name];}).filter(Boolean);var effects={gamma:$gamma||undefined,vignette:$vignette||undefined,noise:$noise||undefined,convolutionMatrix:$convolutionMatrix||undefined,colorMatrix:colorMatrices&&colorMatrices.length&&getColorMatrixFromColorMatrices(colorMatrices)};set(effects);});//
// current environment variables
//
var windowWidth;var windowHeight;var shouldPreventSwipe=canPreventNavSwipe();var env=writable({});component_subscribe($$self,env,function(value){return $$invalidate(320,$env=value);});var initialPixelRatio=getDevicePixelRatio();var pixelRatio=readable(initialPixelRatio,function(set){var handleResolutionChange=function handleResolutionChange(){return set(getDevicePixelRatio());};var resolutionObserver=matchMedia("(resolution: ".concat(initialPixelRatio,"dppx)"));resolutionObserver.addListener(handleResolutionChange);return function(){return resolutionObserver.removeListener(handleResolutionChange);};});component_subscribe($$self,pixelRatio,function(value){return $$invalidate(54,$pixelRatio=value);});var history=historyCreate(function(){// $imageState is always a clone of the current state
return $imageState;},function(state){// set new state from history, $imageState will store a clone of the received state
set_store_value(imageState,$imageState=state,$imageState);// trigger recenter of image selection rect
tabRect.set($tabRect);});$$subscribe_history();var setInitialHistoryState=function setInitialHistoryState(){// set history state
var baseRect=_objectSpread({x:0,y:0},$imageSize);var baseCropRect=rectApply(rectContainRect(baseRect,$imageState.cropAspectRatio),Math.round);// note:
//
// currently undo doesn't step back to base state,
// that's why the hook willSetHistoryInitialState below as introduced
// will be fixed in version next major release of the editor
//
var baseEditorState=willSetHistoryInitialState(_objectSpread(_objectSpread({},$imageState),{},{//
// should be read from imageInitialProps?
rotation:0,crop:baseCropRect}),// add other reset values here?
//
// see note above
$imageState);//
// this will be the base state
var editorInitialHistoryState=[baseEditorState];// only add additional entry if base state and current state are different
if(JSON.stringify(baseEditorState)!==JSON.stringify($imageState)){editorInitialHistoryState.push(_objectSpread({},$imageState));}// loading done, set this as base state
history.set(editorInitialHistoryState);};var imageLoadStateUnsub=imageLoadState.subscribe(function(state){// no state yet
if(!state)return;// not ready yet
if(!state.complete)return;// set initial state after image load has completed
setInitialHistoryState();});var revert=function revert(){return willRevert().then(function(shouldReset){return shouldReset&&history.revert();});};//
// Visual processing of the image
//
var imageProcessingPreparing=writable(false);component_subscribe($$self,imageProcessingPreparing,function(value){return $$invalidate(321,$imageProcessingPreparing=value);});var handleExport=function handleExport(){// this will trigger status overlay fade in
set_store_value(imageProcessingPreparing,$imageProcessingPreparing=true,$imageProcessingPreparing);willProcessImage().then(function(shouldProcess){// nope, restore hide processing overlay and back to editing
if(!shouldProcess){set_store_value(imageProcessingPreparing,$imageProcessingPreparing=false,$imageProcessingPreparing);return;}// wait for status to be done fading in, then requests image writing
var unsub;unsub=statusOpacity.subscribe(function(value){if(value!==1)return;// stop listening for
unsub&&unsub();// request write image
dispatch('processImage');});});};var imageProcessStateUnsub=imageProcessState.subscribe(function(state){if(!state){set_store_value(imageProcessingPreparing,$imageProcessingPreparing=false,$imageProcessingPreparing);return;}set_store_value(imageProcessingPreparing,$imageProcessingPreparing=true,$imageProcessingPreparing);var complete=state.complete,abort=state.abort;if(complete||abort)set_store_value(imageProcessingPreparing,$imageProcessingPreparing=false,$imageProcessingPreparing);});var activeImages=storeList();component_subscribe($$self,activeImages,function(value){return $$invalidate(52,$activeImages=value);});var imageTransformsInterpolated=derived([activeImages],function(_ref269,set){var _ref270=_slicedToArray(_ref269,1),$activeImages=_ref270[0];if(!$activeImages.length)return set();var _$activeImages$=$activeImages[0],origin=_$activeImages$.origin,translation=_$activeImages$.translation,rotation=_$activeImages$.rotation,scale=_$activeImages$.scale;set({origin:origin,translation:translation,rotation:rotation,scale:scale});});var utilTools=writable();component_subscribe($$self,utilTools,function(value){return $$invalidate(335,$utilTools=value);});// bind from pan/zoom control
var zoomControls=[];// bind from pan/zoom control
var zoomMultiTouching;var imageSelectionMultiTouching=writable();var imagePreviewUpscale=writable();var imageSelectionZoomCurrent=derived([imageSelectionZoom,imagePreviewUpscale,stageScalar,imageSelectionStageFitScalar],function(_ref271){var _ref272=_slicedToArray(_ref271,4),$imageSelectionZoom=_ref272[0],$imagePreviewUpscale=_ref272[1],$stageScalar=_ref272[2],$imageSelectionStageFitScalar=_ref272[3];return $imageSelectionZoom?$imageSelectionZoom:$imagePreviewUpscale||$stageScalar<1?$imageSelectionStageFitScalar:1;});//
// Configure the available views
//
var utilStores=_objectSpread(_objectSpread({},stores),{},{// image
imageFile:imageFile,imageSize:imageSize,// video / animated gif
mediaDuration:mediaDuration,mediaTrim:mediaTrim,imageBackgroundColor:imageBackgroundColor,imageBackgroundImage:imageBackgroundImageSrc,imageCropAspectRatio:imageCropAspectRatio,imageCropMinSize:imageCropMinSize,imageCropMaxSize:imageCropMaxSize,imageCropLimitToImage:imageCropLimitToImage,imageCropRect:imageCropRect,imageCropRectOrigin:imageCropRectOrigin,imageCropRectSnapshot:imageCropRectSnapshot,imageCropRectAspectRatio:imageCropRectAspectRatio,imageCropRange:imageCropRange,imageRotation:imageRotation,imageRotationRange:imageRotationRange,imageFlipX:imageFlipX,imageFlipY:imageFlipY,imageOutputSize:imageOutputSize,// effects
imageColorMatrix:imageColorMatrix,imageConvolutionMatrix:imageConvolutionMatrix,imageGamma:imageGamma,imageVignette:imageVignette,imageNoise:imageNoise,// markup
imageDecoration:imageDecoration,imageAnnotation:imageAnnotation,imageRedaction:imageRedaction,imageFrame:imageFrame,// image preview for utils that need access to pixel data
imagePreview:imagePreview,// image preview source so utils can update preview
imagePreviewSource:imagePreviewSource,// top left position of image preview
imageTransforms:imageTransforms,// allows utils to control how the preview is presented (for example more opacity for mask)
imagePreviewModifiers:imagePreviewModifiers,// history state and update
history:history,// static env info
animation:shouldAnimate,pixelRatio:pixelRatio,elasticityMultiplier:elasticityMultiplier,scrollElasticity:scrollElasticity,rangeInputElasticity:rangeInputElasticity,redrawTrigger:redrawTrigger,// dynamic env info
pointerAccuracy:pointerAccuracy,pointerHoverable:pointerHoverable,env:env,rootRect:rootRect,stageRect:stageRect,stageRectBase:stageRectBase,stageRecenter:stageRecenter,stageScalar:stageScalar,stagePadding:stagePadding,stagePadded:stagePadded,presentationScalar:presentationScalar,imagePreviewUpscale:imagePreviewUpscale,utilRect:utilRect,utilRectPadded:utilRectPadded,allowPan:allowPan,allowZoom:allowZoom,allowZoomControls:allowZoomControls,enableZoomInput:enableZoomInputStore,enablePanInput:enablePanInputStore,enablePanInputStatus:enablePanInputStatus,imageSelectionMultiTouching:imageSelectionMultiTouching,rootBackgroundColor:rootBackgroundColor,rootForegroundColor:rootForegroundColor,rootLineColor:rootLineColor,rootColorSecondary:rootColorSecondary,imageOutlineOpacity:imageOutlineOpacity,// add tools to interface
utilTools:utilTools,// interaction
imageSelectionPan:imageSelectionPan,imageSelectionZoom:imageSelectionZoom,imageSelectionZoomCurrent:imageSelectionZoomCurrent,imageSelectionStageFitScalar:imageSelectionStageFitScalar,imageSelectionStoredState:imageSelectionStoredState,// toggle audio
muteAudioStore:muteAudioStore,// (write) add guides to ui (for example is used by markup util to add lines for shape manipulator)
imageOverlayMarkup:imageOverlayMarkup,// (write) interface images to render
interfaceImages:interfaceImages,// (write) set to true to disable animations
isInteracting:isInteracting,// (write) set to true when transforming image (move, translate, scale, rotate)
isTransformingImage:isTransformingImage,// (read) goes from 0 to 1 while interacting
isInteractingFraction:isInteractingFraction,// (write) the current intended crop rect
imageCropRectIntent:imageCropRectIntent,// (read) the current presented crop rect
imageCropRectPresentation:imageCropRectPresentation,// (write) the current limited size of the image selection rect
imageSelectionRect:imageSelectionRect,// (write) the inteded rectangle by the user
imageSelectionRectIntent:imageSelectionRectIntent,// (read) the current presentation of the image selection rect, includes elasticity etc.
imageSelectionRectPresentation:imageSelectionRectPresentation,// (read) a snapshot of the image selection rectangle, use to store the rectangle before modification so alterations to the rectangle can be applied to the snapshot
imageSelectionRectSnapshot:imageSelectionRectSnapshot,// scalar of image in view
imageScalar:imageScalar,// current image interpolated state
imageTransformsInterpolated:imageTransformsInterpolated,// effects applied to the image
imageEffects:imageEffects});// don't expose image store
delete utilStores.image;var utilsUniqueId="util-".concat(getUniqueId());var utilsVisible=[];// env
var iOS=isIOS();var getOrientation=function getOrientation(rect,layoutPreference){if(!$rootRect)return'landscape';if(layoutPreference==='auto')return rect.width>rect.height?'landscape':'portrait';if(layoutPreference==='horizontal')return rect.width<500?'portrait':'landscape';if(layoutPreference==='vertical')return rect.height<400?'landscape':'portrait';};var getColorPropertyValue=function getColorPropertyValue(name){var colorString=rootElementComputedStyle.getPropertyValue(name);return colorStringToColorArray(colorString);};var syncColor=function syncColor(property,store){var colorArray=getColorPropertyValue(property);// hide transparent color
if(!colorArray||colorArray[3]===0)return;// limit to opaque colors
colorArray.length=3;// update store
store.set(colorArray,{hard:!$isAnimated});};var syncColors=function syncColors(){syncColor('color',rootForegroundColor);enableCanvasAlpha?syncColor('--color-background',rootBackgroundColor):syncColor('background-color',rootBackgroundColor);syncColor('outline-color',rootLineColor);syncColor('--color-secondary',rootColorSecondary);};var handleTransitionEnd=function handleTransitionEnd(_ref273){var target=_ref273.target,propertyName=_ref273.propertyName;if(target!==root||!/background|outline/.test(propertyName))return;if(rootElementComputedStyle)syncColors();};var imageProps=derived([imageTransforms,imageEffects,imageBackgroundColor,imageBackgroundImageData],function(_ref274){var _ref275=_slicedToArray(_ref274,4),$imageTransforms=_ref275[0],$imageEffects=_ref275[1],backgroundColor=_ref275[2],backgroundImageData=_ref275[3];return $imageTransforms&&_objectSpread(_objectSpread(_objectSpread({},$imageTransforms),$imageEffects),{},{backgroundColor:backgroundColor,backgroundImage:backgroundImageData});});component_subscribe($$self,imageProps,function(value){return $$invalidate(330,$imageProps=value);});var addImagePreview=function addImagePreview(){// if is first image scale up slightly on entrance
var imageIntro=activeImages.length?undefined:{resize:1.05};// create the new image
var image=createImage($imagePreview,$imageSize,imageIntro);// new image on top
activeImages.unshift(image);// update images in activeImages array
updateImagePreviews($imageProps);};var updateImagePreviews=function updateImagePreviews(currentImageProps){activeImages.forEach(function(image,index){var opacity=index===0?1:0;var resize=1;image.set(_objectSpread(_objectSpread({},currentImageProps),{},{opacity:opacity,resize:resize}),$shouldAnimate);});};// if image preview changes, push it on the stack
var lastImagePreview;var statusOpacity=tweened(undefined,{duration:500});component_subscribe($$self,statusOpacity,function(value){return $$invalidate(51,$statusOpacity=value);});var loadTimer;// this adds a little delay to the status fade out after an image was processed
// needed because when the modal fades out this would otherwise create a weird flash (modal fade out, but status fade out as well showing interface)
var wasProcessingImage=writable(false);component_subscribe($$self,wasProcessingImage,function(value){return $$invalidate(325,$wasProcessingImage=value);});var statusState;var asideOffset=spring(undefined,{stiffness:0.1,damping:0.7,precision:0.25});component_subscribe($$self,asideOffset,function(value){return $$invalidate(77,$asideOffset=value);});var asideOpacity=spring(0,{stiffness:0.1,precision:0.05});component_subscribe($$self,asideOpacity,function(value){return $$invalidate(78,$asideOpacity=value);});var asideWidth=spring(0,{stiffness:0.02,damping:0.5,precision:0.25});component_subscribe($$self,asideWidth,function(value){return $$invalidate(323,$asideWidth=value);});var statusWidth=spring(undefined,{stiffness:0.02,damping:0.5,precision:0.25});component_subscribe($$self,statusWidth,function(value){return $$invalidate(324,$statusWidth=value);});var statusOffset=spring(undefined,{stiffness:0.02,damping:0.5,precision:0.25});component_subscribe($$self,statusOffset,function(value){return $$invalidate(322,$statusOffset=value);});var asideWidthUpdateTimer;var offsetAside=function offsetAside(e){// if error occured, or not animating, snap in possition
var hard=!!(statusState&&statusState.closeButton)||!$isAnimated;// where to render the progress indicator or close button
statusWidth.set(e.detail.width,{hard:hard});// offsets text so it's better centered to the viewport
statusOffset.set(Math.round(-e.detail.width*0.5),{hard:hard});};var handleCloseImageLoadError=function handleCloseImageLoadError(){dispatch('abortLoadImage');};var handleCloseImageProcessError=function handleCloseImageProcessError(){dispatch('abortProcessImage');set_store_value(imageProcessingPreparing,$imageProcessingPreparing=false,$imageProcessingPreparing);};// helper to block iOS and Firefox Android events so don't toggle nav
var preventDefault=function preventDefault(e){return e.preventDefault();};// prevents swipe to navigate back on iOS >= 13.4+
var handleTouchStart=shouldPreventSwipe?function(e){// get touch or event itself (fixes issue with chrome dev tools)
var event=e.touches?e.touches[0]:e;// if is not an attempt to swipe back or forward
if(event.pageX>20&&event.pageX<window.innerWidth-20)return;// stop the navigation attempt
preventDefault(e);}:noop$1;// context for children to know if a key is down
var pressedKeysStore=writable([]);component_subscribe($$self,pressedKeysStore,function(value){return $$invalidate(400,$pressedKeysStore=value);});setContext('keysPressed',pressedKeysStore);var handleKeydown=function handleKeydown(e){var keyCode=e.keyCode,metaKey=e.metaKey,ctrlKey=e.ctrlKey,shiftKey=e.shiftKey;// prevent tabbing through fields if editor is disabled
if(keyCode===9&&disabled){e.preventDefault();return;}// prevent spacebar from scrolling page
if(e.target&&keyCode===32&&root.contains(e.target)&&!isTextField(e.target)){e.preventDefault();}// undo/redo
if(keyCode===90&&(metaKey||ctrlKey)){if(shiftKey&&metaKey){// redo on MacOS
history.redo();}else{// undo
history.undo();}return;}else if(keyCode===89&&ctrlKey){// redo on Windows
history.redo();return;}// ignore IME popup keycode, fixes keycode 229 sticking around, as it's not triggered in keyup "If an Input Method Editor is processing key input and the event is keydown, return 229."
// https://lists.w3.org/Archives/Public/www-dom/2010JulSep/att-0182/keyCode-spec.html
if(keyCode===229)return;if(metaKey||ctrlKey)return;// add to set
var keySet=new Set([].concat(_toConsumableArray($pressedKeysStore),[keyCode]));pressedKeysStore.set(Array.from(keySet));};var handleKeyup=function handleKeyup(_ref276){var key=_ref276.key,keyCode=_ref276.keyCode;// this prevents holding the command key while panning image from resutling in sticky keys
if(key==='Meta')return pressedKeysStore.set([]);pressedKeysStore.set($pressedKeysStore.filter(function(pressedKey){return pressedKey!==keyCode;}));};// so no keys get stuck when user cmd-tabs out of the window, or when dev-tools open by key-press
var handleWindowBlur=function handleWindowBlur(){pressedKeysStore.set([]);};// block context menu on everything but text input fields
var handleContextMenu=function handleContextMenu(e){if(isTextField(e.target))return;e.preventDefault();};// handle files being dropped on the editor
var handleUserFile=function handleUserFile(file){// no file received, isn't an image file, is not a URL
if(// no file received
!file||// if it's a file object it should be a bitmap
isBinary(file)&&!isBitmap(file)||// if it's not a file object it should be a URL
!isBinary(file)&&!/^http/.test(file))return;// request load image
dispatch('loadImage',file);};var handleDropFiles=function handleDropFiles(e){// not allowed to drop
if(!enableDropImage)return;handleUserFile(e.detail.resources[0]);};var handleSelectFile=function handleSelectFile(file){if(!file)return;handleUserFile(file);};var browseFileSystem=function browseFileSystem(){if(!enableBrowseImage)return;browse().then(handleSelectFile);};var handlePaste=function handlePaste(e){// not allowed to paste
if(!enablePasteImage)return;// calculate percentage of editor that is in view
var xPercentage=clamp((window.innerWidth-Math.abs($rootRect.x))/$rootRect.width,0,1);var yPercentage=clamp((window.innerHeight-Math.abs($rootRect.y))/$rootRect.height,0,1);// editor needs to be in view
if(xPercentage<0.75&&yPercentage<0.75)return;// request load image
handleUserFile((e.clipboardData||window.clipboardData).files[0]);};//
// canvas drawing
//
var scrambledPreviewImage=undefined;var updateScrambledPreview=function updateScrambledPreview(imagePreviewData,imageScrambler,imageRedactionScalar,imageBackgroundColor){if(!imageScrambler)return;// remove transparency
var editorOptions={dataSizeScalar:imageRedactionScalar};if(imageBackgroundColor&&imageBackgroundColor[3]>0){editorOptions.backgroundColor=_toConsumableArray(imageBackgroundColor);}imageScrambler(imagePreviewData,editorOptions).then(function(scrambledCanvas){// we've created a new scrambled preview so force release memory of old one
if(scrambledPreviewImage)releaseCanvas(scrambledPreviewImage);// update scrambled preview with new image
$$invalidate(248,scrambledPreviewImage=scrambledCanvas);});};var blendShapes=[];// setup root portal for detail panel dropdown
var rootPortal;var rootPortalStore=writable();setContext('rootPortal',rootPortalStore);// setup root rect store for global access
setContext('rootRect',rootRect);var getStageState=function getStageState(){return{// add foreground color
foregroundColor:_toConsumableArray($rootForegroundColor),// add line color
lineColor:_toConsumableArray($rootLineColor),// add information on which util is active
utilVisibility:_objectSpread({},utilsVisibleFraction),// used to fade in elements when interacting
isInteracting:$isInteracting,isInteractingFraction:$isInteractingFraction,// add the root rectangle so will render can use width/height of root element
rootRect:rectClone$1($rootRect),// add the stage rectangle so will render knows where stage starts and ends
stageRect:rectClone$1($stageRect),// allows overriding dirty state
annotationShapesDirty:imageAnnotationShapesDirty,decorationShapesDirty:imageDecorationShapesDirty,frameShapesDirty:imageFrameShapesDirty,blendShapesDirty:imageBlendShapesDirty};};// test if some shapes have left/top/bottom/right offsets, if so, convert to crop space
// updates original shape (which at this point is a flattened shape (clone))
var positionDecorationShape=function positionDecorationShape(shape,selectionRect,scale){// need to calculate intermediate sizes so relative shapes are animated when the interface updates
// this calculation should result in a "springed" $imageCropRect
return shapeComputeDisplay(shape,sizeCreate(selectionRect.width/scale,selectionRect.height/scale));};// decoration is drawn relative to view space, so we need to translate relative to crop presentation rect
var transformDecorationShape=function transformDecorationShape(shape,selectionRect,scale){shape._translate=vectorCreateFromAny(selectionRect);shape._scale=scale;return shape;};var flattenShapes=function flattenShapes(shapes){var flattenedShapes=[];shapes.forEach(function(shape){return flattenedShapes.push(flattenShape(shape));});return flattenedShapes.filter(Boolean);};var flattenShape=function flattenShape(shape){// at this point shape is a copy of the original shape
if(shapeIsLine(shape)){shape.points=[vectorCreate(shape.x1,shape.y1),vectorCreate(shape.x2,shape.y2)];return shape;}// is empty text
if(shapeIsTextEmpty(shape)&&(!shape.backgroundColor||shape.backgroundColor[3]===0)){// make sure shape is still visible
if(shapeIsTextBlock(shape)){shape.width=5;shape.height=shape.lineHeight;}// set to empty text style
shape.strokeWidth=1;shape.strokeColor=[1,1,1,0.5];shape.backgroundColor=[0,0,0,0.1];return shape;}return shape;};// these hold computes shapes, so we don't have to compute on each frame if no changes
var canvasComputedAnnotationBaseShapes=[];var canvasComputedAnnotationShapes=[];var canvasComputedBlendShapes=[];var canvasComputedDecorationShapes=[];var canvasComputedFrameShapes=[];var canvasComputedScale;var canvasComputedSelectionRect={};var createCanvasState=function createCanvasState(canvasState,blendShapesToDraw,annotationShapesToDraw,decorationShapesToDraw,interfaceShapesToDraw,frameShapesToDraw){var annotationShapesDirty=canvasState.annotationShapesDirty,decorationShapesDirty=canvasState.decorationShapesDirty,frameShapesDirty=canvasState.frameShapesDirty,blendShapesDirty=canvasState.blendShapesDirty,selectionRect=canvasState.selectionRect,scale=canvasState.scale;// determine if canvas is dirty, if so, we need to recalculate shapes that rely on canvas
var canvasScaleChanged=canvasComputedScale!==scale;var canvasDirty=canvasScaleChanged||!rectEqual(canvasComputedSelectionRect,selectionRect);// remember dirty state so we can compare next draw
if(canvasDirty){canvasComputedScale=scale;canvasComputedSelectionRect=selectionRect;}// annotation shapes changed, or user changed annotation shapes in willRenderCanvas hook
if(annotationShapesDirty||annotationShapesToDraw!==$imageAnnotation){canvasComputedAnnotationBaseShapes=annotationShapesToDraw.filter(shapeIsVisible).map(shapeDeepCopy).sort(function(a,b){if(a.alwaysOnTop)return 1;if(b.alwaysOnTop)return-1;return 0;}).map(function(shape){return shapeComputeDisplay(shape,$imageSize);});}if(canvasScaleChanged||imageAnnotationRequiresPreprocessing||annotationShapesDirty||annotationShapesToDraw!==$imageAnnotation){canvasComputedAnnotationShapes=flattenShapes(canvasComputedAnnotationBaseShapes.map(function(shape){return preprocessShape(shape,{flipX:$imageFlipX,flipY:$imageFlipY,rotation:$imageRotation,scale:scale,context:rectCreateFromSize($imageSize)});}).flat());}// blend shapes changed
if(blendShapesDirty){canvasComputedBlendShapes=blendShapesToDraw.filter(shapeIsVisible).map(function(shape){return shapeComputeDisplay(shape,$imageSize);});}// decoration shapes changed, or user changed decoration shapes in willRenderCanvs hook, or canvas updated and decorations need to be recomputed
if(decorationShapesDirty||decorationShapesToDraw!==$imageDecoration||canvasDirty){canvasComputedDecorationShapes=flattenShapes(decorationShapesToDraw.filter(shapeIsVisible).map(shapeDeepCopy).sort(function(a,b){if(a.alwaysOnTop)return 1;if(b.alwaysOnTop)return-1;return 0;}).map(function(shape){return positionDecorationShape(shape,selectionRect,scale);}).map(function(shape){return preprocessShape(shape,{context:selectionRect});}).flat().map(function(shape){return transformDecorationShape(shape,selectionRect,scale);}));}// only recompute frame shapes if frame changed or selection rect changed
if(frameShapesDirty||frameShapesToDraw!==$imageFrame||canvasDirty){canvasComputedFrameShapes=frameShapesToDraw?flattenShapes([frameShapesToDraw].map(shapeDeepCopy).map(function(shape){return positionDecorationShape(shape,selectionRect,scale);}).map(preprocessShape).flat().map(function(shape){return transformDecorationShape(shape,selectionRect,scale);})):[];}var canvasComputedInterfaceShapes=flattenShapes(interfaceShapesToDraw.filter(shapeIsVisible));return{// only redraw if annotations are dirty
blendShapesDirty:blendShapesDirty,blendShapes:canvasComputedBlendShapes,// only redraw if annotations are dirty
annotationShapesDirty:annotationShapesDirty,annotationShapes:canvasComputedAnnotationShapes,// prepare decoration shapes (percentages to absolute values)
decorationShapesDirty:decorationShapesDirty,decorationShapes:canvasComputedDecorationShapes,// prepare frame shapes (percentages to absolute values)
frameShapesDirty:frameShapesDirty,frameShapes:canvasComputedFrameShapes,// prepare interface shapes (percentages to absolute values)
interfaceShapes:canvasComputedInterfaceShapes};};//
// for optimizing canvas calls
//
// mark image annotations as dirrty if the image annotations array is changed
var imageAnnotationShapesDirty=true;var markAnnotationShapesAsDirty=function markAnnotationShapesAsDirty(){return $$invalidate(57,imageAnnotationShapesDirty=true);};var imageAnnotationRequiresPreprocessing=true;var markAnnotationRequiresPreprocessing=function markAnnotationRequiresPreprocessing(){return $$invalidate(58,imageAnnotationRequiresPreprocessing=true);};// mark image decorations as dirty if the image decorations array is changed
var imageDecorationShapesDirty=true;var markDecorationShapesAsDirty=function markDecorationShapesAsDirty(){return $$invalidate(59,imageDecorationShapesDirty=true);};// mark image frames as dirrty if the image frames array is changed
var imageFrameShapesDirty=true;var markFrameShapesAsDirty=function markFrameShapesAsDirty(){return $$invalidate(60,imageFrameShapesDirty=true);};// mark blend shapes as dirty if the image blend shapes array is changed
var imageBlendShapesDirty=true;var markBlendShapesAsDirty=function markBlendShapesAsDirty(){return $$invalidate(61,imageBlendShapesDirty=true);};// clean up so memory is released correctly
onDestroy(function(){// make sure video is paused
setPreviewVideoPlayState(false);imageStateUnsub();stageRectUnsub();stageScalarUnsub();imageIsStaticUnsub();imageSelectionRectSnapshotUnsub();imageSelectionRectUnsub();imageCropRectUnsub();imageLoadStateUnsub();imageProcessStateUnsub();pointerAccuracy.destroy();pointerHoverable.destroy();imageProxy.destroy();activeImages.clear();// clear shape cache
canvasComputedAnnotationBaseShapes.length=0;canvasComputedAnnotationShapes.length=0;canvasComputedBlendShapes.length=0;canvasComputedDecorationShapes.length=0;canvasComputedFrameShapes.length=0;try{$$invalidate(203,imagePreviewCurrent=undefined);$$invalidate(245,lastImagePreview=undefined);}catch(err){}// this sometimes throws a Svelte $$invalidate error, not sure why
});var handleMeasureUtil=function handleMeasureUtil(e){// no change
if($utilRect&&rectEqual(e.detail,$utilRect))return;// update rect
set_store_value(utilRect,$utilRect=e.detail,$utilRect);};function onwindowresize(){$$invalidate(29,windowWidth=window_1$1.innerWidth);$$invalidate(30,windowHeight=window_1$1.innerHeight);}var measure_handler=function measure_handler(e){return set_store_value(toolRect,$toolRect=e.detail,$toolRect);};var select_handler=function select_handler(_ref277){var detail=_ref277.detail;return $$invalidate(41,utilSelected=detail);};var func=function func(panel,util){return util.id===panel;};function utilpanel_component_binding(value,panel){if($$self.$$.not_equal(pluginInterface[panel],value)){pluginInterface[panel]=value;($$invalidate(1,pluginInterface),$$invalidate(25,pluginOptions)),$$invalidate(241,pluginComponents);}}var show_handler=function show_handler(panel){return $$invalidate(56,utilsVisible=utilsVisible.concat(panel));};var hide_handler=function hide_handler(panel){return $$invalidate(56,utilsVisible=utilsVisible.filter(function(util){return util!==panel;}));};var fade_handler=function fade_handler(panel,_ref278){var detail=_ref278.detail;return $$invalidate(36,utilsVisibleFraction[panel]=detail,utilsVisibleFraction);};var measure_handler_1=function measure_handler_1(e){return set_store_value(tabRect,$tabRect=e.detail,$tabRect);};var func_1=function func_1(util){return util.id===utilSelected;};function utilpanel_component_binding_1(value){if($$self.$$.not_equal(pluginInterface[utilSelected],value)){pluginInterface[utilSelected]=value;($$invalidate(1,pluginInterface),$$invalidate(25,pluginOptions)),$$invalidate(241,pluginComponents);}}var show_handler_1=function show_handler_1(){return $$invalidate(56,utilsVisible=utilsVisible.concat(utilSelected));};var hide_handler_1=function hide_handler_1(){return $$invalidate(56,utilsVisible=utilsVisible.filter(function(util){return util!==utilSelected;}));};var fade_handler_1=function fade_handler_1(_ref279){var detail=_ref279.detail;return $$invalidate(36,utilsVisibleFraction[utilSelected]=detail,utilsVisibleFraction);};var func_2=function func_2(canvasState){// current draw state
var drawState=_objectSpread(_objectSpread({},canvasState),getStageState());// allow devs to add custom overlay to `imageOverlay`
var _willRenderCanvas=willRenderCanvas({annotationShapes:$imageAnnotation,decorationShapes:$imageDecoration,interfaceShapes:$imageOverlay,frameShapes:$imageFrame},drawState),annotationShapes=_willRenderCanvas.annotationShapes,decorationShapes=_willRenderCanvas.decorationShapes,interfaceShapes=_willRenderCanvas.interfaceShapes,frameShapes=_willRenderCanvas.frameShapes;// need to map shapes
return createCanvasState(drawState,blendShapes,annotationShapes,decorationShapes,interfaceShapes,frameShapes);};var func_3=function func_3(){// we've just drawn the shapes so mark as clean
$$invalidate(57,imageAnnotationShapesDirty=false);$$invalidate(58,imageAnnotationRequiresPreprocessing=false);$$invalidate(59,imageDecorationShapesDirty=false);$$invalidate(60,imageFrameShapesDirty=false);$$invalidate(61,imageBlendShapesDirty=false);};function div_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){rootPortal=$$value;$$invalidate(35,rootPortal);});}function canvaspanandzoom_zoomLevel_binding(value){zoomLevel=value;$$invalidate(0,zoomLevel),$$invalidate(233,markupEditorZoomLevel);}function canvaspanandzoom_zoomControls_binding(value){zoomControls=value;$$invalidate(31,zoomControls);}function canvaspanandzoom_zoomMultiTouching_binding(value){zoomMultiTouching=value;$$invalidate(32,zoomMultiTouching);}function div_binding_1($$value){binding_callbacks[$$value?'unshift':'push'](function(){root=$$value;$$invalidate(2,root);});}var measure_handler_2=function measure_handler_2(e){return set_store_value(clientRect,$clientRect=e.detail,$clientRect);};$$self.$$set=function($$props){if('class'in $$props)$$invalidate(204,klass=$$props["class"]);if('layout'in $$props)$$invalidate(205,layoutMode=$$props.layout);if('stores'in $$props)$$invalidate(206,stores=$$props.stores);if('locale'in $$props)$$invalidate(3,locale=$$props.locale);if('id'in $$props)$$invalidate(4,id=$$props.id);if('util'in $$props)$$invalidate(207,util=$$props.util);if('utils'in $$props)$$invalidate(208,utils=$$props.utils);if('animations'in $$props)$$invalidate(209,animations=$$props.animations);if('disabled'in $$props)$$invalidate(210,disabled=$$props.disabled);if('status'in $$props)$$invalidate(202,status=$$props.status);if('previewUpscale'in $$props)$$invalidate(211,previewUpscale=$$props.previewUpscale);if('previewPad'in $$props)$$invalidate(212,previewPad=$$props.previewPad);if('previewMaskOpacity'in $$props)$$invalidate(5,previewMaskOpacity=$$props.previewMaskOpacity);if('previewImageDataMaxSize'in $$props)$$invalidate(213,previewImageDataMaxSize=$$props.previewImageDataMaxSize);if('previewImageTextPixelRatio'in $$props)$$invalidate(6,previewImageTextPixelRatio=$$props.previewImageTextPixelRatio);if('markupMaskOpacity'in $$props)$$invalidate(7,markupMaskOpacity=$$props.markupMaskOpacity);if('zoomMaskOpacity'in $$props)$$invalidate(214,zoomMaskOpacity=$$props.zoomMaskOpacity);if('elasticityMultiplier'in $$props)$$invalidate(8,elasticityMultiplier=$$props.elasticityMultiplier);if('willRevert'in $$props)$$invalidate(215,willRevert=$$props.willRevert);if('willProcessImage'in $$props)$$invalidate(216,willProcessImage=$$props.willProcessImage);if('willRenderCanvas'in $$props)$$invalidate(9,willRenderCanvas=$$props.willRenderCanvas);if('willRenderToolbar'in $$props)$$invalidate(217,willRenderToolbar=$$props.willRenderToolbar);if('willSetHistoryInitialState'in $$props)$$invalidate(218,willSetHistoryInitialState=$$props.willSetHistoryInitialState);if('enableButtonExport'in $$props)$$invalidate(219,enableButtonExport=$$props.enableButtonExport);if('enableButtonRevert'in $$props)$$invalidate(220,enableButtonRevert=$$props.enableButtonRevert);if('enableNavigateHistory'in $$props)$$invalidate(221,enableNavigateHistory=$$props.enableNavigateHistory);if('enableToolbar'in $$props)$$invalidate(10,enableToolbar=$$props.enableToolbar);if('enableUtils'in $$props)$$invalidate(222,enableUtils=$$props.enableUtils);if('enableButtonClose'in $$props)$$invalidate(223,enableButtonClose=$$props.enableButtonClose);if('enableDropImage'in $$props)$$invalidate(224,enableDropImage=$$props.enableDropImage);if('enablePasteImage'in $$props)$$invalidate(225,enablePasteImage=$$props.enablePasteImage);if('enableBrowseImage'in $$props)$$invalidate(226,enableBrowseImage=$$props.enableBrowseImage);if('layoutDirectionPreference'in $$props)$$invalidate(227,layoutDirectionPreference=$$props.layoutDirectionPreference);if('layoutHorizontalUtilsPreference'in $$props)$$invalidate(228,layoutHorizontalUtilsPreference=$$props.layoutHorizontalUtilsPreference);if('layoutVerticalUtilsPreference'in $$props)$$invalidate(229,layoutVerticalUtilsPreference=$$props.layoutVerticalUtilsPreference);if('layoutVerticalToolbarPreference'in $$props)$$invalidate(230,layoutVerticalToolbarPreference=$$props.layoutVerticalToolbarPreference);if('layoutVerticalControlGroupsPreference'in $$props)$$invalidate(231,layoutVerticalControlGroupsPreference=$$props.layoutVerticalControlGroupsPreference);if('layoutVerticalControlTabsPreference'in $$props)$$invalidate(232,layoutVerticalControlTabsPreference=$$props.layoutVerticalControlTabsPreference);if('markupEditorZoomLevel'in $$props)$$invalidate(233,markupEditorZoomLevel=$$props.markupEditorZoomLevel);if('markupEditorZoomLevels'in $$props)$$invalidate(11,markupEditorZoomLevels=$$props.markupEditorZoomLevels);if('markupEditorZoomAdjustStep'in $$props)$$invalidate(12,markupEditorZoomAdjustStep=$$props.markupEditorZoomAdjustStep);if('markupEditorZoomAdjustFactor'in $$props)$$invalidate(13,markupEditorZoomAdjustFactor=$$props.markupEditorZoomAdjustFactor);if('markupEditorZoomAdjustWheelFactor'in $$props)$$invalidate(14,markupEditorZoomAdjustWheelFactor=$$props.markupEditorZoomAdjustWheelFactor);if('markupEditorInteractionMode'in $$props)$$invalidate(234,markupEditorInteractionMode=$$props.markupEditorInteractionMode);if('muteAudio'in $$props)$$invalidate(235,muteAudio=$$props.muteAudio);if('willSetMediaInitialTimeOffset'in $$props)$$invalidate(236,willSetMediaInitialTimeOffset=$$props.willSetMediaInitialTimeOffset);if('enablePan'in $$props)$$invalidate(15,enablePan=$$props.enablePan);if('enableZoom'in $$props)$$invalidate(16,enableZoom=$$props.enableZoom);if('enableZoomControls'in $$props)$$invalidate(237,enableZoomControls=$$props.enableZoomControls);if('enableZoomInput'in $$props)$$invalidate(17,enableZoomInput=$$props.enableZoomInput);if('enablePanInput'in $$props)$$invalidate(238,enablePanInput=$$props.enablePanInput);if('enableCanvasAlpha'in $$props)$$invalidate(18,enableCanvasAlpha=$$props.enableCanvasAlpha);if('enablePanLimit'in $$props)$$invalidate(19,enablePanLimit=$$props.enablePanLimit);if('panLimitGutterScalar'in $$props)$$invalidate(20,panLimitGutterScalar=$$props.panLimitGutterScalar);if('zoomPresetOptions'in $$props)$$invalidate(21,zoomPresetOptions=$$props.zoomPresetOptions);if('zoomAdjustStep'in $$props)$$invalidate(22,zoomAdjustStep=$$props.zoomAdjustStep);if('zoomAdjustFactor'in $$props)$$invalidate(23,zoomAdjustFactor=$$props.zoomAdjustFactor);if('zoomAdjustWheelFactor'in $$props)$$invalidate(24,zoomAdjustWheelFactor=$$props.zoomAdjustWheelFactor);if('zoomLevel'in $$props)$$invalidate(0,zoomLevel=$$props.zoomLevel);if('imagePreviewSrc'in $$props)$$invalidate(239,imagePreviewSrc=$$props.imagePreviewSrc);if('imageOrienter'in $$props)$$invalidate(240,imageOrienter=$$props.imageOrienter);if('pluginComponents'in $$props)$$invalidate(241,pluginComponents=$$props.pluginComponents);if('pluginOptions'in $$props)$$invalidate(25,pluginOptions=$$props.pluginOptions);if('root'in $$props)$$invalidate(2,root=$$props.root);if('imageSourceToImageData'in $$props)$$invalidate(26,imageSourceToImageData=$$props.imageSourceToImageData);if('imagePreviewCurrent'in $$props)$$invalidate(203,imagePreviewCurrent=$$props.imagePreviewCurrent);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*zoomLevel*/1|$$self.$$.dirty[7]&/*markupEditorZoomLevel*/65536){// @deprecated, remove in v9
$$invalidate(0,zoomLevel=zoomLevel===null?markupEditorZoomLevel:zoomLevel);}if($$self.$$.dirty[7]&/*muteAudio*/262144){muteAudioStore.set(muteAudio);}if($$self.$$.dirty[0]&/*elasticityMultiplier*/256){set_store_value(elasticityMultiplierStore,$elasticityMultiplierStore=elasticityMultiplier,$elasticityMultiplierStore);}if($$self.$$.dirty[6]&/*layoutMode*/524288){// set to new object to force redraw
$$invalidate(305,isOverlayModeEnabled=layoutMode==='overlay');}if($$self.$$.dirty[7]&/*enableUtils*/32|$$self.$$.dirty[9]&/*isOverlayModeEnabled*/67108864){$$invalidate(42,showUtils=enableUtils&&!isOverlayModeEnabled);}if($$self.$$.dirty[0]&/*pluginOptions, pluginInterface*/33554434){// map plugin options to plugin interface
if(pluginOptions){// for every plugin in plugin options
Object.entries(pluginOptions).forEach(function(_ref280){var _ref281=_slicedToArray(_ref280,2),name=_ref281[0],plugin=_ref281[1];// for every prop defined for this plugin
Object.entries(plugin).forEach(function(_ref282){var _ref283=_slicedToArray(_ref282,2),prop=_ref283[0],value=_ref283[1];// set value to interface
if(!pluginInterface[name])return;// set prop value
$$invalidate(1,pluginInterface[name][prop]=value,pluginInterface);});});}}if($$self.$$.dirty[0]&/*pluginInterface*/2|$$self.$$.dirty[7]&/*pluginComponents*/16777216){{var changed=false;// create plugin interfaces
pluginComponents.forEach(function(_ref284){var _ref285=_slicedToArray(_ref284,1),key=_ref285[0];if(pluginInterface[key])return;$$invalidate(1,pluginInterface[key]={},pluginInterface);changed=true;});if(changed){$$invalidate(243,registeredPluginsComponents=_toConsumableArray(pluginComponents));}}}if($$self.$$.dirty[6]&/*disabled*/16777216){disabledTransition.set(disabled?1:0);}if($$self.$$.dirty[6]&/*previewImageDataMaxSize*/134217728){maxImageDataSize=previewImageDataMaxSize?sizeMin(previewImageDataMaxSize,maxTextureSize):maxTextureSize;}if($$self.$$.dirty[11]&/*$images*/32768){imageProxy.update($images[0]);}if($$self.$$.dirty[11]&/*$shapePreprocessor*/16384){preprocessShape=$shapePreprocessor?function(shape,options){return $shapePreprocessor(shape,_objectSpread(_objectSpread({flipX:undefined,flipY:undefined,rotation:undefined},options),{},{isPreview:true}));}:passthrough;}if($$self.$$.dirty[7]&/*enableZoomControls*/1048576|$$self.$$.dirty[11]&/*$allowZoomControls*/8192){enableZoomControlsProp.set($allowZoomControls&&enableZoomControls);}if($$self.$$.dirty[7]&/*markupEditorInteractionMode, enablePanInput*/2228224){enablePanInputProp.set(markupEditorInteractionMode==='pan'?true:enablePanInput);}if($$self.$$.dirty[1]&/*$clientRect*/131072){$clientRect&&rootRect.set(rectCreate($clientRect.x,$clientRect.y,$clientRect.width,$clientRect.height));}if($$self.$$.dirty[9]&/*isOverlayModeEnabled*/67108864|$$self.$$.dirty[10]&/*$rootRect, $imageLoadState*/262160){$rootRect&&isOverlayModeEnabled&&$imageLoadState&&$imageLoadState.complete&&syncRootAspectRatio();}if($$self.$$.dirty[0]&/*locale*/8|$$self.$$.dirty[6]&/*utils*/4194304|$$self.$$.dirty[7]&/*registeredPluginsComponents*/67108864){$$invalidate(295,utilsFiltered=locale&&registeredPluginsComponents.length?utils||registeredPluginsComponents.map(function(_ref286){var _ref287=_slicedToArray(_ref286,1),id=_ref287[0];return id;}):[]);}if($$self.$$.dirty[9]&/*utilsFiltered*/65536){$$invalidate(43,shouldRenderTabs=utilsFiltered.length>1);}if($$self.$$.dirty[1]&/*shouldRenderTabs*/4096){if(!shouldRenderTabs)tabRect.set(rectCreateEmpty());}if($$self.$$.dirty[0]&/*enableToolbar*/1024){if(!enableToolbar)toolRect.set(rectCreateEmpty());}if($$self.$$.dirty[9]&/*supportsAnimations*/268435456|$$self.$$.dirty[10]&/*$isInteracting*/32){$$invalidate(308,canAnimate=!$isInteracting&&supportsAnimations);}if($$self.$$.dirty[11]&/*$prefersReducedMotion*/4096){$$invalidate(306,acceptsAnimations=!$prefersReducedMotion);}if($$self.$$.dirty[6]&/*animations*/8388608|$$self.$$.dirty[9]&/*canAnimate, acceptsAnimations*/671088640){// if the dev wants to run animations
set_store_value(shouldAnimate,$shouldAnimate=animations==='always'?canAnimate:animations==='never'?false:canAnimate&&acceptsAnimations,$shouldAnimate);}if($$self.$$.dirty[6]&/*animations*/8388608|$$self.$$.dirty[9]&/*supportsAnimations, acceptsAnimations*/402653184){// if the browser _can_ run animations when the dev wants to run animations
set_store_value(isAnimated,$isAnimated=animations==='always'?supportsAnimations:animations==='never'?false:supportsAnimations&&acceptsAnimations,$isAnimated);}if($$self.$$.dirty[6]&/*previewUpscale*/33554432|$$self.$$.dirty[9]&/*isOverlayModeEnabled*/67108864){previewShouldUpscale.set(previewUpscale||isOverlayModeEnabled);}if($$self.$$.dirty[6]&/*previewPad*/67108864){shouldPadPreview.set(previewPad);}if($$self.$$.dirty[0]&/*root*/4|$$self.$$.dirty[11]&/*$imageSelectionZoom*/2048){if(root){root.dispatchEvent(createPing('markupzoom',$imageSelectionZoom));// @deprecated
root.dispatchEvent(createPing('zoom',$imageSelectionZoom));}}if($$self.$$.dirty[0]&/*root*/4|$$self.$$.dirty[11]&/*$imageSelectionPan*/1024){if(root){root.dispatchEvent(createPing('markuppan',$imageSelectionPan));// @deprecated
root.dispatchEvent(createPing('pan',$imageSelectionPan));}}if($$self.$$.dirty[11]&/*$imageCropRect*/256){// reset selection stored state when crop rect is updated
if($imageCropRect)imageSelectionStoredStateReset();}if($$self.$$.dirty[11]&/*$imageStaticBounds*/512){$imageStaticBounds&&centerImageStaticBounds();}if($$self.$$.dirty[7]&/*registeredPluginsComponents*/67108864|$$self.$$.dirty[9]&/*utilsFiltered*/65536|$$self.$$.dirty[10]&/*$mediaDuration*/67108864){$$invalidate(296,utilsAvailable=registeredPluginsComponents.filter(function(_ref288){var _ref289=_slicedToArray(_ref288,1),id=_ref289[0];return utilsFiltered.includes(id);}).filter(function(_ref290){var _ref291=_slicedToArray(_ref290,2),isSupported=_ref291[1].isSupported;return isSupported({duration:$mediaDuration});}).map(function(_ref292){var _ref293=_slicedToArray(_ref292,2),id=_ref293[0],util=_ref293[1];return[id,util.Component];}));}if($$self.$$.dirty[9]&/*utilsAvailable*/131072){$$invalidate(251,utilsDefined=utilsAvailable.length);}if($$self.$$.dirty[6]&/*util*/2097152|$$self.$$.dirty[8]&/*utilsDefined*/8|$$self.$$.dirty[9]&/*utilsAvailable*/131072){$$invalidate(41,utilSelected=util&&typeof util==='string'&&utilsAvailable.find(function(_ref294){var _ref295=_slicedToArray(_ref294,1),id=_ref295[0];return id===util;})?util:utilsDefined>0?utilsAvailable[0][0]:undefined);}if($$self.$$.dirty[1]&/*utilSelected, $isAnimated*/525312){utilSelected&&imageOutlineOpacity.set(0.075,{hard:!$isAnimated});}if($$self.$$.dirty[6]&/*zoomMaskOpacity*/268435456){$$invalidate(303,OVERLAY_OPACITY_MAX=zoomMaskOpacity);}if($$self.$$.dirty[11]&/*$stagePadded, $stagePadding*/192){$$invalidate(304,overlayMin=$stagePadded?-Math.max.apply(Math,_toConsumableArray(Object.values($stagePadding))):0);}if($$self.$$.dirty[1]&/*$imageSelectionRectPresentation, $isAnimated*/17301504|$$self.$$.dirty[9]&/*overlayMin, OVERLAY_OPACITY_MAX*/50331648|$$self.$$.dirty[10]&/*$stageRect*/8){if($imageSelectionRectPresentation){var l=$imageSelectionRectPresentation.x-$stageRect.x;var _r6=$stageRect.x+$stageRect.width-($imageSelectionRectPresentation.x+$imageSelectionRectPresentation.width);var _t3=$imageSelectionRectPresentation.y-$stageRect.y;var b=$stageRect.y+$stageRect.height-($imageSelectionRectPresentation.y+$imageSelectionRectPresentation.height);var d=Math.min(l,_t3,_r6,b);overlayOpacity.set(d>overlayMin?0:Math.min(OVERLAY_OPACITY_MAX,Math.abs(d/OVERLAY_OPACITY_TWEEN_DIST)),{hard:!$isAnimated});}}if($$self.$$.dirty[1]&/*$pixelRatio*/8388608){// this slightly overlaps the overlay parts preventing bright background colors from shining through
$$invalidate(302,overlayOverlap=0.55/$pixelRatio);}if($$self.$$.dirty[1]&/*$isAnimated*/524288|$$self.$$.dirty[9]&/*overlayOverlap*/8388608|$$self.$$.dirty[10]&/*$stageRect*/8){$stageRect&&overlayLeftRect.set({x:0,y:$stageRect.y,width:$stageRect.x<OVERLAY_OPACITY_TWEEN_DIST?0:$stageRect.x,height:$stageRect.height+overlayOverlap},{hard:!$isAnimated});}if($$self.$$.dirty[1]&/*$isAnimated*/524288|$$self.$$.dirty[9]&/*overlayOverlap*/8388608|$$self.$$.dirty[10]&/*$stageRect, $rootRect*/24){$stageRect&&overlayTopRect.set({x:0,y:0,width:$rootRect.width,height:$stageRect.y+overlayOverlap},{hard:!$isAnimated});}if($$self.$$.dirty[1]&/*$isAnimated*/524288|$$self.$$.dirty[9]&/*overlayOverlap*/8388608|$$self.$$.dirty[10]&/*$stageRect, $rootRect*/24){if($stageRect){var _x95=$stageRect.x+$stageRect.width;var _width4=$rootRect.width-($stageRect.x+$stageRect.width);if(_width4<OVERLAY_OPACITY_TWEEN_DIST){_x95+=_width4;_width4=0;}overlayRightRect.set({x:_x95,y:$stageRect.y,width:_width4,height:$stageRect.height+overlayOverlap},{hard:!$isAnimated});}}if($$self.$$.dirty[1]&/*$isAnimated*/524288|$$self.$$.dirty[10]&/*$stageRect, $rootRect*/24){$stageRect&&overlayBottomRect.set({x:0,y:$stageRect.y+$stageRect.height,width:$rootRect.width,height:$rootRect.height-($stageRect.y+$stageRect.height)},{hard:!$isAnimated});}if($$self.$$.dirty[1]&/*$rootBackgroundColor*/4194304|$$self.$$.dirty[11]&/*$overlayLeftRect, $overlayOpacity*/36){$$invalidate(298,overlayLeft=$overlayLeftRect&&_objectSpread({id:OVERLAY_ID,backgroundColor:$rootBackgroundColor,opacity:$overlayOpacity},$overlayLeftRect));}if($$self.$$.dirty[1]&/*$rootBackgroundColor*/4194304|$$self.$$.dirty[11]&/*$overlayTopRect, $overlayOpacity*/20){$$invalidate(301,overlayTop=$overlayTopRect&&_objectSpread({id:OVERLAY_ID,backgroundColor:$rootBackgroundColor,opacity:$overlayOpacity},$overlayTopRect));}if($$self.$$.dirty[1]&/*$rootBackgroundColor*/4194304|$$self.$$.dirty[11]&/*$overlayRightRect, $overlayOpacity*/12){$$invalidate(300,overlayRight=$overlayRightRect&&_objectSpread({id:OVERLAY_ID,backgroundColor:$rootBackgroundColor,opacity:$overlayOpacity},$overlayRightRect));}if($$self.$$.dirty[1]&/*$rootBackgroundColor*/4194304|$$self.$$.dirty[11]&/*$overlayBottomRect, $overlayOpacity*/6){$$invalidate(299,overlayBottom=$overlayBottomRect&&_objectSpread({id:OVERLAY_ID,backgroundColor:$rootBackgroundColor,opacity:$overlayOpacity},$overlayBottomRect));}if($$self.$$.dirty[9]&/*overlayTop, overlayRight, overlayBottom, overlayLeft*/7864320){$$invalidate(297,gradientOverlays=[overlayTop,overlayRight,overlayBottom,overlayLeft].filter(Boolean));}if($$self.$$.dirty[9]&/*gradientOverlays*/262144|$$self.$$.dirty[11]&/*$imageOverlayMarkup*/1){// if overlay top changes
if(gradientOverlays&&$imageOverlayMarkup){// remove existing resize overlays
var overlayMarkupFiltered=$imageOverlayMarkup.filter(function(markup){return markup.id!==OVERLAY_ID;});imageOverlayMarkup.set([].concat(_toConsumableArray(overlayMarkupFiltered),_toConsumableArray(gradientOverlays)));}}if($$self.$$.dirty[7]&/*imagePreviewSrc*/4194304|$$self.$$.dirty[10]&/*$imageFile*/1073741824){imagePreviewSource.set(imagePreviewSrc?imagePreviewSrc:$imageFile||undefined);}if($$self.$$.dirty[10]&/*$imagePreview, $muteAudioStore*/536870976){// mute preview
$imagePreview&&setPreviewVideoMuteState($muteAudioStore);}if($$self.$$.dirty[0]&/*root*/4|$$self.$$.dirty[6]&/*imagePreviewCurrent*/131072|$$self.$$.dirty[10]&/*$imagePreview*/64){{$$invalidate(203,imagePreviewCurrent=$imagePreview);if($imagePreview)root.dispatchEvent(createPing('loadpreview',imagePreviewCurrent));}}if($$self.$$.dirty[10]&/*$imagePreviewSource*/524288){if($imagePreviewSource)resetPreviews();}if($$self.$$.dirty[10]&/*$history*/268435456){$$invalidate(256,canUndo=$history.index>0);}if($$self.$$.dirty[10]&/*$history*/268435456){$$invalidate(255,canRedo=$history.index<$history.length-1);}if($$self.$$.dirty[1]&/*zoomMultiTouching*/2){imageSelectionMultiTouching.set(zoomMultiTouching);}if($$self.$$.dirty[10]&/*$previewShouldUpscale*/134217728){imagePreviewUpscale.set($previewShouldUpscale);}if($$self.$$.dirty[0]&/*locale*/8|$$self.$$.dirty[9]&/*utilsFiltered, utilsAvailable*/196608){$$invalidate(44,utilsMerged=utilsFiltered.map(function(utilId){var util=utilsAvailable.find(function(_ref296){var _ref297=_slicedToArray(_ref296,1),id=_ref297[0];return utilId===id;});// [id, view]
if(!util)return;return{id:utilId,view:util[1],tabIcon:locale["".concat(utilId,"Icon")],tabLabel:locale["".concat(utilId,"Label")]};}).filter(Boolean)||[]);}if($$self.$$.dirty[1]&/*utilSelected*/1024){utilSelectedStore.set(utilSelected);}if($$self.$$.dirty[1]&/*utilsMerged, utilsVisibleFraction*/8224){$$invalidate(36,utilsVisibleFraction=utilsMerged.reduce(function(prev,curr){prev[curr.id]=utilsVisibleFraction&&utilsVisibleFraction[curr.id]||0;return prev;},{}));}if($$self.$$.dirty[1]&/*utilSelected*/1024){$$invalidate(74,tabsConfig={name:utilsUniqueId,selected:utilSelected});}if($$self.$$.dirty[1]&/*utilsMerged*/8192){$$invalidate(73,tabs=utilsMerged.map(function(util){return{id:util.id,icon:util.tabIcon,label:util.tabLabel};}));}if($$self.$$.dirty[1]&/*utilsMerged*/8192){$$invalidate(72,panels=utilsMerged.map(function(util){return util.id;}));}if($$self.$$.dirty[6]&/*klass*/262144){$$invalidate(71,className=arrayJoin(['PinturaRoot','PinturaRootComponent',klass]));}if($$self.$$.dirty[10]&/*$rootRect*/16){$$invalidate(291,horizontalSpace=$rootRect&&($rootRect.width>1000?'wide':$rootRect.width<600?'narrow':undefined));}if($$self.$$.dirty[10]&/*$rootRect*/16){$$invalidate(278,hasLimitedSpace=$rootRect&&($rootRect.width<=320||$rootRect.height<=460));}if($$self.$$.dirty[10]&/*$rootRect*/16){$$invalidate(290,verticalSpace=$rootRect&&($rootRect.height>1000?'tall':$rootRect.height<600?'short':undefined));}if($$self.$$.dirty[0]&/*root*/4){$$invalidate(258,isModal=root&&root.parentNode&&root.parentNode.classList.contains('PinturaModal'));}if($$self.$$.dirty[0]&/*windowWidth*/536870912|$$self.$$.dirty[8]&/*isModal*/1024|$$self.$$.dirty[10]&/*$rootRect*/16){$$invalidate(283,isCenteredHorizontally=isModal&&$rootRect&&windowWidth>$rootRect.width);}if($$self.$$.dirty[0]&/*windowHeight*/1073741824|$$self.$$.dirty[8]&/*isModal*/1024|$$self.$$.dirty[10]&/*$rootRect*/16){$$invalidate(282,isCenteredVertically=isModal&&$rootRect&&windowHeight>$rootRect.height);}if($$self.$$.dirty[9]&/*isCenteredHorizontally, isCenteredVertically*/24){$$invalidate(284,isCentered=isCenteredHorizontally&&isCenteredVertically);}if($$self.$$.dirty[0]&/*enableCanvasAlpha*/262144){$$invalidate(281,isTransparent=enableCanvasAlpha);}if($$self.$$.dirty[9]&/*horizontalSpace*/4096){$$invalidate(253,isNarrow=horizontalSpace==='narrow');}if($$self.$$.dirty[7]&/*layoutDirectionPreference*/1024|$$self.$$.dirty[10]&/*$rootRect*/16){$$invalidate(292,orientation=getOrientation($rootRect,layoutDirectionPreference));}if($$self.$$.dirty[9]&/*orientation*/8192){$$invalidate(70,isLandscape=orientation==='landscape');}if($$self.$$.dirty[8]&/*isNarrow*/32|$$self.$$.dirty[9]&/*verticalSpace*/2048){$$invalidate(280,isCompact=isNarrow||verticalSpace==='short');}if($$self.$$.dirty[0]&/*windowWidth*/536870912|$$self.$$.dirty[10]&/*$rootRect*/16){$$invalidate(279,hasSwipeNavigation=iOS&&$rootRect&&windowWidth===$rootRect.width&&!shouldPreventSwipe);}if($$self.$$.dirty[1]&/*zoomControls*/1|$$self.$$.dirty[10]&/*$utilTools*/33554432){$$invalidate(254,activeUtilTools=[].concat(_toConsumableArray($utilTools||[]),_toConsumableArray(zoomControls)).filter(Boolean));}if($$self.$$.dirty[7]&/*layoutHorizontalUtilsPreference*/2048){$$invalidate(289,navigationHorizontalPreference="has-navigation-preference-".concat(layoutHorizontalUtilsPreference));}if($$self.$$.dirty[7]&/*layoutVerticalUtilsPreference*/4096){$$invalidate(288,navigationVerticalPreference="has-navigation-preference-".concat(layoutVerticalUtilsPreference));}if($$self.$$.dirty[7]&/*layoutVerticalToolbarPreference*/8192){$$invalidate(285,toolbarVerticalPreference="has-toolbar-preference-".concat(layoutVerticalToolbarPreference));}if($$self.$$.dirty[7]&/*layoutVerticalControlGroupsPreference*/16384){$$invalidate(287,controlGroupsVerticalPreference="has-controlgroups-preference-".concat(layoutVerticalControlGroupsPreference));}if($$self.$$.dirty[7]&/*layoutVerticalControlTabsPreference*/32768){$$invalidate(286,controlTabsVerticalpreference="has-controltabs-preference-".concat(layoutVerticalControlTabsPreference));}if($$self.$$.dirty[10]&/*$rootRect*/16){// will update when root element is available (computed style is live, so is updated when the style is updated)
$$invalidate(294,rootRectDefined=$rootRect!==undefined&&$rootRect.width>0&&$rootRect.height>0);}if($$self.$$.dirty[0]&/*root*/4|$$self.$$.dirty[9]&/*rootRectDefined*/32768){$$invalidate(293,rootElementComputedStyle=rootRectDefined&&root&&getComputedStyle(root));}if($$self.$$.dirty[9]&/*rootElementComputedStyle*/16384){// sync for first time
if(rootElementComputedStyle)syncColors();}if($$self.$$.dirty[0]&/*enableToolbar*/1024|$$self.$$.dirty[1]&/*$isAnimated, shouldRenderTabs, showUtils*/530432|$$self.$$.dirty[6]&/*layoutMode, disabled*/17301504|$$self.$$.dirty[8]&/*isModal, hasLimitedSpace*/1073742848|$$self.$$.dirty[9]&/*orientation, horizontalSpace, verticalSpace, navigationHorizontalPreference, navigationVerticalPreference, controlGroupsVerticalPreference, controlTabsVerticalpreference, toolbarVerticalPreference, isCentered, isCenteredHorizontally, isCenteredVertically, isTransparent, isCompact, hasSwipeNavigation*/16383|$$self.$$.dirty[10]&/*$env, $pointerAccuracy, $pointerHoverable*/25166848){env.set(_objectSpread(_objectSpread({},$env),{},{layoutMode:layoutMode,orientation:orientation,horizontalSpace:horizontalSpace,verticalSpace:verticalSpace,navigationHorizontalPreference:navigationHorizontalPreference,navigationVerticalPreference:navigationVerticalPreference,controlGroupsVerticalPreference:controlGroupsVerticalPreference,controlTabsVerticalpreference:controlTabsVerticalpreference,toolbarVerticalPreference:toolbarVerticalPreference,isModal:isModal,isDisabled:disabled,isCentered:isCentered,isCenteredHorizontally:isCenteredHorizontally,isCenteredVertically:isCenteredVertically,isAnimated:$isAnimated,isTransparent:isTransparent,pointerAccuracy:$pointerAccuracy,pointerHoverable:$pointerHoverable,isCompact:isCompact,hasSwipeNavigation:hasSwipeNavigation,hasLimitedSpace:hasLimitedSpace,hasToolbar:enableToolbar,hasNavigation:shouldRenderTabs&&showUtils,isIOS:iOS,browserVersion:isChrome()?"chrome-".concat((navigator.userAgent.match(/Chrome\/([0-9]+)/)||[])[1]):undefined}));}if($$self.$$.dirty[10]&/*$env*/1024){$$invalidate(69,envStr=Object.entries($env).map(function(_ref298){var _ref299=_slicedToArray(_ref298,2),key=_ref299[0],value=_ref299[1];// is true boolean prop, use key
if(/^is|has/.test(key)){return value?toKebabCase(key):undefined;}// use value
return value;}).filter(Boolean).join(' '));}if($$self.$$.dirty[1]&/*utilSelected*/1024){// clear util tools when selected tool changes, when tool becomes active it will update the tools (if needed)
utilSelected&&utilTools.set([]);}if($$self.$$.dirty[10]&/*$imageTransforms, $imagePreviewModifiers*/6291456){$$invalidate(68,imageCanvasState=$imageTransforms&&Object.entries($imagePreviewModifiers).filter(function(_ref300){var _ref301=_slicedToArray(_ref300,2),value=_ref301[1];return value!=null;}).reduce(function(prev,_ref302){var _ref303=_slicedToArray(_ref302,2),value=_ref303[1];prev=_objectSpread(_objectSpread({},prev),value);return prev;},{}));}if($$self.$$.dirty[10]&/*$imageLoadState*/262144){//
// loading status
//
$$invalidate(275,isStartLoadingImageSource=$imageLoadState&&$imageLoadState.task==='any-to-file');}if($$self.$$.dirty[8]&/*isStartLoadingImageSource*/134217728){// reset active images when loading a new image source
if(isStartLoadingImageSource&&activeImages){activeImages.clear();}}if($$self.$$.dirty[10]&/*$imageProps*/1048576){// if image props are ready
$$invalidate(277,hasProps=!!$imageProps&&!!$imageProps.translation);}if($$self.$$.dirty[7]&/*lastImagePreview*/268435456|$$self.$$.dirty[8]&/*hasProps*/536870912|$$self.$$.dirty[10]&/*$imagePreview*/64){if(hasProps&&$imagePreview&&$imagePreview!==lastImagePreview){$$invalidate(245,lastImagePreview=$imagePreview);addImagePreview();}}if($$self.$$.dirty[8]&/*hasProps*/536870912|$$self.$$.dirty[10]&/*$imageProps*/1048576){// update images when image props change
hasProps&&updateImagePreviews($imageProps);}if($$self.$$.dirty[1]&/*$activeImages*/2097152){// clean active images array, removes 'inactive' images when their opacity is 0
if($activeImages&&$activeImages.length>1){var imagesToRemove=[];activeImages.forEach(function(image,index){if(index===0)return;if(image.get().opacity<=0)imagesToRemove.push(image);});imagesToRemove.forEach(function(image){return activeImages.remove(image);});}}if($$self.$$.dirty[0]&/*locale*/8|$$self.$$.dirty[8]&/*missingFeatures*/268435456){$$invalidate(38,isSupportsError=locale&&missingFeatures.length&&locale.labelSupportError(missingFeatures));}if($$self.$$.dirty[10]&/*$imageLoadState*/262144){$$invalidate(267,isImageLoadError=$imageLoadState&&!!$imageLoadState.error);}if($$self.$$.dirty[10]&/*$imageLoadState*/262144){$$invalidate(40,isWaitingForImage=!$imageLoadState||!$imageLoadState.complete&&$imageLoadState.task===undefined);}if($$self.$$.dirty[10]&/*$imageLoadState*/262144){$$invalidate(268,imageLoadProgress=$imageLoadState&&($imageLoadState.taskLengthComputable?$imageLoadState.taskProgress:Infinity));}if($$self.$$.dirty[8]&/*isStartLoadingImageSource*/134217728){if(isStartLoadingImageSource)set_store_value(imageVisualLoadComplete,$imageVisualLoadComplete=false,$imageVisualLoadComplete);}if($$self.$$.dirty[1]&/*$isAnimated*/524288|$$self.$$.dirty[7]&/*loadTimer*/536870912|$$self.$$.dirty[10]&/*$imageLoadState*/262144){if($imageLoadState&&$imageLoadState.complete){var minLoaderDuration=$isAnimated?250:0;// TODO: derive visual load complete from interface rest state instead of arbitrary timer
clearTimeout(loadTimer);$$invalidate(246,loadTimer=setTimeout(function(){set_store_value(imageVisualLoadComplete,$imageVisualLoadComplete=true,$imageVisualLoadComplete);},minLoaderDuration));}}if($$self.$$.dirty[1]&/*isWaitingForImage*/512|$$self.$$.dirty[8]&/*isImageLoadError*/524288|$$self.$$.dirty[10]&/*$imageLoadState, $imageVisualLoadComplete*/327680){$$invalidate(272,isLoadingImageData=$imageLoadState&&!isImageLoadError&&!isWaitingForImage&&!$imageVisualLoadComplete);}if($$self.$$.dirty[7]&/*imagePreviewLoaderCancelToken*/134217728|$$self.$$.dirty[10]&/*$imagePreviewSource, $imagePreview*/524352){// is creating a preview while an image source is set and the preview isn't ready or when a cancel token is found
$$invalidate(271,isCreatingImagePreview=!!$imagePreviewSource&&(!$imagePreview||!!imagePreviewLoaderCancelToken));}if($$self.$$.dirty[10]&/*$imageProcessingPreparing, $imageProcessState*/133120){//
// processing status
//
$$invalidate(266,isProcessingImage=!!($imageProcessingPreparing||$imageProcessState&&$imageProcessState.progress!==undefined&&!$imageProcessState.complete));}if($$self.$$.dirty[8]&/*isProcessingImage*/262144){if(isProcessingImage)setPreviewVideoPlayState(false);}if($$self.$$.dirty[1]&/*isWaitingForImage*/512|$$self.$$.dirty[10]&/*$imageLoadState*/262144){$$invalidate(269,imageLoadShowProgressIndicator=$imageLoadState&&!($imageLoadState.error||isWaitingForImage));}if($$self.$$.dirty[0]&/*locale*/8|$$self.$$.dirty[10]&/*$imageLoadState*/262144){$$invalidate(270,imageLoadStatusLabel=locale&&(!$imageLoadState?locale.statusLabelLoadImage($imageLoadState):!$imageLoadState.complete||$imageLoadState.error?stringReplace(locale.statusLabelLoadImage($imageLoadState),$imageLoadState.error&&$imageLoadState.error.metadata,'{','}'):locale.statusLabelLoadImage({progress:Infinity,task:'blob-to-bitmap'})));}if($$self.$$.dirty[0]&/*locale*/8|$$self.$$.dirty[10]&/*$imageProcessState*/131072){$$invalidate(265,imageProcessStatusLabel=$imageProcessState&&locale&&locale.statusLabelProcessImage($imageProcessState));}if($$self.$$.dirty[10]&/*$imageProcessState*/131072){$$invalidate(263,imageProcessProgress=$imageProcessState&&($imageProcessState.taskLengthComputable?$imageProcessState.taskProgress:Infinity));}if($$self.$$.dirty[10]&/*$imageProcessState*/131072){$$invalidate(264,imageProcessShowProgressIndicator=$imageProcessState&&!$imageProcessState.error);}if($$self.$$.dirty[10]&/*$imageProcessState*/131072){$$invalidate(262,isImageProcessingError=!!($imageProcessState&&$imageProcessState.error));}if($$self.$$.dirty[0]&/*locale*/8|$$self.$$.dirty[1]&/*isWaitingForImage*/512|$$self.$$.dirty[6]&/*status*/65536|$$self.$$.dirty[8]&/*isImageLoadError, isLoadingImageData, isCreatingImagePreview, imageLoadStatusLabel, imageLoadShowProgressIndicator, imageLoadProgress, isProcessingImage, imageProcessStatusLabel, isImageProcessingError, imageProcessShowProgressIndicator, imageProcessProgress*/33538048){if(status){var label;var progress;var showProgress;var isError;var errorCallback;if(isString(status))label=status;if(isNumber(status))progress=status;else if(Array.isArray(status)){var _status=status;var _status2=_slicedToArray(_status,3);label=_status2[0];progress=_status2[1];errorCallback=_status2[2];if(progress===false)isError=true;if(isNumber(progress))showProgress=true;}$$invalidate(33,statusState=(label||progress)&&{text:label,aside:isError||showProgress,progressIndicator:{visible:showProgress,progress:progress},closeButton:isError&&{label:locale.statusLabelButtonClose,icon:locale.statusIconButtonClose,onclick:errorCallback||function(){return $$invalidate(202,status=undefined);}}});}else if(locale&&isWaitingForImage||isImageLoadError||isLoadingImageData||isCreatingImagePreview){$$invalidate(33,statusState={text:imageLoadStatusLabel,aside:isImageLoadError||imageLoadShowProgressIndicator,progressIndicator:{visible:imageLoadShowProgressIndicator,progress:imageLoadProgress},closeButton:isImageLoadError&&{label:locale.statusLabelButtonClose,icon:locale.statusIconButtonClose,onclick:handleCloseImageLoadError}});}else if(locale&&isProcessingImage&&imageProcessStatusLabel){$$invalidate(33,statusState={text:imageProcessStatusLabel,aside:isImageProcessingError||imageProcessShowProgressIndicator,progressIndicator:{visible:imageProcessShowProgressIndicator,progress:imageProcessProgress},closeButton:isImageProcessingError&&{label:locale.statusLabelButtonClose,icon:locale.statusIconButtonClose,onclick:handleCloseImageProcessError}});}else{$$invalidate(33,statusState=undefined);}}if($$self.$$.dirty[6]&/*status*/65536){$$invalidate(274,isCustomStatus=status!==undefined);}if($$self.$$.dirty[1]&/*$isAnimated*/524288|$$self.$$.dirty[8]&/*isModal*/1024|$$self.$$.dirty[10]&/*$imageProcessState*/131072){if(isModal&&$imageProcessState&&$imageProcessState.complete){wasProcessingImage.set(true);setTimeout(function(){return wasProcessingImage.set(false);},$isAnimated?100:0);}}if($$self.$$.dirty[0]&/*root*/4|$$self.$$.dirty[1]&/*utilSelected*/1024|$$self.$$.dirty[10]&/*$imageVisualLoadComplete*/65536){$imageVisualLoadComplete&&root&&root.dispatchEvent(createPing('selectutil',utilSelected));}if($$self.$$.dirty[1]&/*isSupportsError, isWaitingForImage*/640|$$self.$$.dirty[8]&/*isImageLoadError, isLoadingImageData, isCreatingImagePreview, isProcessingImage, isCustomStatus*/93061120|$$self.$$.dirty[10]&/*$wasProcessingImage*/32768){$$invalidate(273,isStatusActive=$wasProcessingImage||isSupportsError||isWaitingForImage||isImageLoadError||isLoadingImageData||isCreatingImagePreview||isProcessingImage||isCustomStatus);}if($$self.$$.dirty[8]&/*isStatusActive*/33554432){set_store_value(statusOpacity,$statusOpacity=isStatusActive?1:0,$statusOpacity);}if($$self.$$.dirty[1]&/*$isAnimated*/524288|$$self.$$.dirty[8]&/*isStatusActive*/33554432){statusOpacity.set(isStatusActive?1:0,{duration:$isAnimated?500:1});}if($$self.$$.dirty[1]&/*$statusOpacity*/1048576){$$invalidate(39,isStatusVisible=$statusOpacity>0);}if($$self.$$.dirty[1]&/*statusState*/4){$$invalidate(261,hasAside=!!(statusState&&statusState.aside));}if($$self.$$.dirty[1]&/*isStatusVisible, statusState, $isAnimated*/524548|$$self.$$.dirty[7]&/*asideWidthUpdateTimer*/1073741824|$$self.$$.dirty[8]&/*hasAside*/8192|$$self.$$.dirty[10]&/*$statusWidth*/16384){if(isStatusVisible&&statusState){clearTimeout(asideWidthUpdateTimer);var springProps={hard:$isAnimated===false};// has aside
if(hasAside){// if error occured, or not animating, snap in possition
var hard=!!statusState.error||!$isAnimated;asideOpacity.set(1,springProps);// update offset of aside
asideOffset.set($statusWidth,{hard:hard});// update width of aside, this pushes message to left so it stays centered
$$invalidate(247,asideWidthUpdateTimer=setTimeout(function(){asideWidth.set(16,springProps);},1));}else{asideOpacity.set(0,springProps);$$invalidate(247,asideWidthUpdateTimer=setTimeout(function(){asideWidth.set(0,springProps);},1));}}}if($$self.$$.dirty[1]&/*isStatusVisible*/256){if(!isStatusVisible){statusOffset.set(undefined,{hard:true});asideOffset.set(undefined,{hard:true});asideWidth.set(0,{hard:true});}}if($$self.$$.dirty[10]&/*$asideWidth*/8192){$$invalidate(260,statusIndent=$asideWidth*0.5);}if($$self.$$.dirty[8]&/*statusIndent*/4096|$$self.$$.dirty[10]&/*$statusOffset*/4096){$$invalidate(67,statusTransform="transform: translateX(".concat($statusOffset-statusIndent,"px)"));}if($$self.$$.dirty[1]&/*isSupportsError*/128|$$self.$$.dirty[10]&/*$imagePreview*/64){// ready bool
$$invalidate(37,isReady=$imagePreview&&!isSupportsError);}if($$self.$$.dirty[1]&/*isReady*/64|$$self.$$.dirty[8]&/*needsInteractionLock, isModal*/3072){$$invalidate(257,preventTouchHandler=needsInteractionLock&&(isReady||isModal)?preventDefault:noop$1);}if($$self.$$.dirty[8]&/*preventTouchHandler*/512){$$invalidate(66,handleTouchMove=preventTouchHandler);}if($$self.$$.dirty[8]&/*preventTouchHandler*/512){$$invalidate(65,handlePointerMove=preventTouchHandler);}if($$self.$$.dirty[0]&/*locale*/8|$$self.$$.dirty[1]&/*$redrawTrigger*/262144|$$self.$$.dirty[7]&/*willRenderToolbar, enableButtonClose, enableButtonRevert, enableNavigateHistory, enableButtonExport*/93|$$self.$$.dirty[8]&/*canUndo, canRedo, activeUtilTools, isNarrow*/480|$$self.$$.dirty[10]&/*$env*/1024){// dynamic IO menu
$$invalidate(64,toolbarItems=locale&&$redrawTrigger&&runSafe(function(){return willRenderToolbar([['div','alpha',{"class":'PinturaNavGroup'},[['div','alpha-set',{"class":'PinturaNavSet'},[// button close
enableButtonClose&&['Button','close',{label:locale.labelClose,icon:locale.iconButtonClose,onclick:function onclick(){return dispatch('close');},hideLabel:true}],// button revert
enableButtonRevert&&['Button','revert',{label:locale.labelButtonRevert,icon:locale.iconButtonRevert,disabled:!canUndo,onclick:revert,hideLabel:true}]]]]],['div','beta',{"class":'PinturaNavGroup PinturaNavGroupFloat'},[enableNavigateHistory&&['div','history',{"class":'PinturaNavSet'},[['Button','undo',{label:locale.labelButtonUndo,icon:locale.iconButtonUndo,disabled:!canUndo,onclick:history.undo,hideLabel:true}],['Button','redo',{label:locale.labelButtonRedo,icon:locale.iconButtonRedo,disabled:!canRedo,onclick:history.redo,hideLabel:true}]]],activeUtilTools.length&&['div','plugin-tools',{"class":'PinturaNavSet'},activeUtilTools.filter(Boolean).map(// in
function(_ref304){var _ref305=_slicedToArray(_ref304,3),component=_ref305[0],key=_ref305[1],props=_ref305[2];return(// out
[component,key,_objectSpread({},props)]);})]]],['div','gamma',{"class":'PinturaNavGroup'},[enableButtonExport&&['Button','export',{label:locale.labelButtonExport,icon:isNarrow&&locale.iconButtonExport,"class":'PinturaButtonExport',onclick:handleExport,hideLabel:isNarrow}]]]],_objectSpread({},$env),function(){return redrawTrigger.set({});});}));}if($$self.$$.dirty[1]&/*$clientRect*/131072){$$invalidate(252,hasClientRect=$clientRect&&$clientRect.width>0&&$clientRect.height>0);}if($$self.$$.dirty[0]&/*locale*/8|$$self.$$.dirty[8]&/*hasClientRect, utilsDefined*/24){$$invalidate(63,canRender=hasClientRect&&locale&&utilsDefined);}if($$self.$$.dirty[10]&/*$imageRedaction*/128){// toggles on/off depending on active redaction shapes
$$invalidate(250,hasImageRedaction=$imageRedaction&&!!$imageRedaction.length);}if($$self.$$.dirty[8]&/*hasImageRedaction*/4|$$self.$$.dirty[9]&/*$imageSize*/1073741824|$$self.$$.dirty[10]&/*$imageRedaction*/128){// scales down resolution of scrambled image if redaction takes up more than half of view
$$invalidate(249,imageRedactionScalar=hasImageRedaction&&getImageRedactionScaleFactor($imageSize,$imageRedaction));}if($$self.$$.dirty[8]&/*hasImageRedaction, imageRedactionScalar*/6|$$self.$$.dirty[10]&/*$imagePreview, $imageScrambler, $imageBackgroundColor*/832){// only update/render preview if image redaction shapes are found
hasImageRedaction&&updateScrambledPreview($imagePreview,$imageScrambler,imageRedactionScalar,$imageBackgroundColor);}if($$self.$$.dirty[8]&/*scrambledPreviewImage*/1|$$self.$$.dirty[9]&/*$imageSize*/1073741824|$$self.$$.dirty[10]&/*$imageRedaction*/128){if($imageRedaction&&scrambledPreviewImage&&$imageSize){// used to calculate fraction x y coordinates of shape corners
var _$imageSize=$imageSize,_width5=_$imageSize.width,_height5=_$imageSize.height;// to blended shapes
$$invalidate(34,blendShapes=$imageRedaction.map(function(shape){var rect=rectCreate(shape.x,shape.y,shape.width,shape.height);var corners=rectRotate(rectClone$1(rect),shape.rotation);var backgroundCorners=corners.map(function(corner){return vectorCreate(corner.x/_width5,corner.y/_height5);});return _objectSpread(_objectSpread({},shape),{},{id:'redaction',flipX:false,flipY:false,cornerRadius:0,strokeWidth:0,strokeColor:undefined,backgroundColor:[0,0,0],backgroundImage:scrambledPreviewImage,backgroundImageRendering:'pixelated',backgroundCorners:backgroundCorners});}));}}if($$self.$$.dirty[1]&/*rootPortal*/16){rootPortal&&rootPortalStore.set(rootPortal);}if($$self.$$.dirty[0]&/*root*/4|$$self.$$.dirty[1]&/*isReady*/64){// now ready for interaction
isReady&&root.dispatchEvent(createPing('ready'));}if($$self.$$.dirty[1]&/*$imageAnnotation*/65536){markAnnotationShapesAsDirty();}if($$self.$$.dirty[9]&/*$imageSize*/1073741824|$$self.$$.dirty[10]&/*$imageRotation, $imageFlipX, $imageFlipY*/7){markAnnotationRequiresPreprocessing();}if($$self.$$.dirty[1]&/*$imageDecoration*/32768){markDecorationShapesAsDirty();}if($$self.$$.dirty[1]&/*$imageFrame*/16384){markFrameShapesAsDirty();}if($$self.$$.dirty[1]&/*blendShapes*/8){markBlendShapesAsDirty();}};$$invalidate(307,supportsAnimations=!isSoftwareRendering());imageTransformsSnapPixels=getDevicePixelRatio()===1?function(transforms){if(!transforms)return;vectorApply(transforms.origin,Math.round);vectorApply(transforms.translation,Math.round);}:passthrough;//
// support test status
//
$$invalidate(276,missingFeatures=[!supportsWebGL()&&'WebGL'].filter(Boolean));// These are again needed since iOS 15 (was needed for 12 and lower, but  wasn't needed for 13, 14)
// Now also needed for Firefox on Android
$$invalidate(259,needsInteractionLock=isIOS()||isAndroid()&&isFirefox());// used to route ping events
$$invalidate(62,routePing=createPingRouter(eventProxy.pub));return[zoomLevel,pluginInterface,root,locale,id,previewMaskOpacity,previewImageTextPixelRatio,markupMaskOpacity,elasticityMultiplier,willRenderCanvas,enableToolbar,markupEditorZoomLevels,markupEditorZoomAdjustStep,markupEditorZoomAdjustFactor,markupEditorZoomAdjustWheelFactor,enablePan,enableZoom,enableZoomInput,enableCanvasAlpha,enablePanLimit,panLimitGutterScalar,zoomPresetOptions,zoomAdjustStep,zoomAdjustFactor,zoomAdjustWheelFactor,pluginOptions,imageSourceToImageData,imagePreview,history,windowWidth,windowHeight,zoomControls,zoomMultiTouching,statusState,blendShapes,rootPortal,utilsVisibleFraction,isReady,isSupportsError,isStatusVisible,isWaitingForImage,utilSelected,showUtils,shouldRenderTabs,utilsMerged,$imageFrame,$imageDecoration,$imageAnnotation,$clientRect,$redrawTrigger,$isAnimated,$statusOpacity,$activeImages,$rootBackgroundColor,$pixelRatio,$imageSelectionRectPresentation,utilsVisible,imageAnnotationShapesDirty,imageAnnotationRequiresPreprocessing,imageDecorationShapesDirty,imageFrameShapesDirty,imageBlendShapesDirty,routePing,canRender,toolbarItems,handlePointerMove,handleTouchMove,statusTransform,imageCanvasState,envStr,isLandscape,className,panels,tabs,tabsConfig,$tabRect,$willRequest,$asideOffset,$asideOpacity,$toolRect,$imageCropLimitToImage,$interfaceImages,$willRequestResource,$imageOverlay,$allowPan,$enablePanInputStatus,$allowZoom,$enableZoomInputStore,$enableZoomControlsProp,$imageSelectionRectCentered,$imageSelectionRectScalar,$disabledTransition,muteAudioStore,redrawTrigger,elasticityMultiplierStore,disabledTransition,imageFile,imageSize,mediaDuration,mediaTrim,imageLoadState,imageProcessState,imageCropAspectRatio,imageCropLimitToImage,imageCropRect,imageRotation,imageFlipX,imageFlipY,imageBackgroundColor,imageDecoration,imageAnnotation,imageRedaction,imageFrame,imageState,images,shapePreprocessor,imageScrambler,willRequest,willRequestResource,allowPan,allowZoom,allowZoomControls,enablePanInputStore,enableZoomInputStore,enableZoomControlsProp,enablePanInputProp,enablePanInputStatus,rootBackgroundColor,rootForegroundColor,rootLineColor,clientRect,rootRect,tabRect,toolRect,utilRect,pointerAccuracy,pointerHoverable,isInteracting,isInteractingFraction,shouldAnimate,isAnimated,previewShouldUpscale,imageIsStatic,imageCropRectSnapshot,imageCropRectIntent,imageSelectionRect,imageSelectionRectSnapshot,imageSelectionRectIntent,imageSelectionRectOffset,stagePadding,stagePadded,stageRect,imageStaticBounds,stageScalar,imageSelectionZoom,imageSelectionRectScalar,imageSelectionScalar,imageSelectionPan,imageSelectionRectPresentation,imageSelectionRectStaticScalar,imageSelectionRectCentered,presentationScalar,imageOverlayMarkup,imageOverlay,overlayOpacity,overlayLeftRect,overlayTopRect,overlayRightRect,overlayBottomRect,imageVisualLoadComplete,imagePreviewSource,imagePreviewModifiers,interfaceImages,imageTransforms,env,pixelRatio,imageProcessingPreparing,activeImages,utilTools,utilStores,handleTransitionEnd,imageProps,statusOpacity,wasProcessingImage,asideOffset,asideOpacity,asideWidth,statusWidth,statusOffset,offsetAside,handleTouchStart,pressedKeysStore,handleKeydown,handleKeyup,handleWindowBlur,handleContextMenu,handleDropFiles,browseFileSystem,handlePaste,getStageState,createCanvasState,handleMeasureUtil,status,imagePreviewCurrent,klass,layoutMode,stores,util,utils,animations,disabled,previewUpscale,previewPad,previewImageDataMaxSize,zoomMaskOpacity,willRevert,willProcessImage,willRenderToolbar,willSetHistoryInitialState,enableButtonExport,enableButtonRevert,enableNavigateHistory,enableUtils,enableButtonClose,enableDropImage,enablePasteImage,enableBrowseImage,layoutDirectionPreference,layoutHorizontalUtilsPreference,layoutVerticalUtilsPreference,layoutVerticalToolbarPreference,layoutVerticalControlGroupsPreference,layoutVerticalControlTabsPreference,markupEditorZoomLevel,markupEditorInteractionMode,muteAudio,willSetMediaInitialTimeOffset,enableZoomControls,enablePanInput,imagePreviewSrc,imageOrienter,pluginComponents,sub,registeredPluginsComponents,imagePreviewLoaderCancelToken,lastImagePreview,loadTimer,asideWidthUpdateTimer,scrambledPreviewImage,imageRedactionScalar,hasImageRedaction,utilsDefined,hasClientRect,isNarrow,activeUtilTools,canRedo,canUndo,preventTouchHandler,isModal,needsInteractionLock,statusIndent,hasAside,isImageProcessingError,imageProcessProgress,imageProcessShowProgressIndicator,imageProcessStatusLabel,isProcessingImage,isImageLoadError,imageLoadProgress,imageLoadShowProgressIndicator,imageLoadStatusLabel,isCreatingImagePreview,isLoadingImageData,isStatusActive,isCustomStatus,isStartLoadingImageSource,missingFeatures,hasProps,hasLimitedSpace,hasSwipeNavigation,isCompact,isTransparent,isCenteredVertically,isCenteredHorizontally,isCentered,toolbarVerticalPreference,controlTabsVerticalpreference,controlGroupsVerticalPreference,navigationVerticalPreference,navigationHorizontalPreference,verticalSpace,horizontalSpace,orientation,rootElementComputedStyle,rootRectDefined,utilsFiltered,utilsAvailable,gradientOverlays,overlayLeft,overlayBottom,overlayRight,overlayTop,overlayOverlap,OVERLAY_OPACITY_MAX,overlayMin,isOverlayModeEnabled,acceptsAnimations,supportsAnimations,canAnimate,$imageSize,$imageFlipY,$imageFlipX,$imageRotation,$stageRect,$rootRect,$isInteracting,$imagePreview,$imageRedaction,$imageBackgroundColor,$imageScrambler,$env,$imageProcessingPreparing,$statusOffset,$asideWidth,$statusWidth,$wasProcessingImage,$imageVisualLoadComplete,$imageProcessState,$imageLoadState,$imagePreviewSource,$imageProps,$imagePreviewModifiers,$imageTransforms,$pointerHoverable,$pointerAccuracy,$utilTools,$mediaDuration,$previewShouldUpscale,$history,$muteAudioStore,$imageFile,$imageOverlayMarkup,$overlayBottomRect,$overlayOpacity,$overlayRightRect,$overlayTopRect,$overlayLeftRect,$stagePadding,$stagePadded,$imageCropRect,$imageStaticBounds,$imageSelectionPan,$imageSelectionZoom,$prefersReducedMotion,$allowZoomControls,$shapePreprocessor,$images,onwindowresize,measure_handler,select_handler,func,utilpanel_component_binding,show_handler,hide_handler,fade_handler,measure_handler_1,func_1,utilpanel_component_binding_1,show_handler_1,hide_handler_1,fade_handler_1,func_2,func_3,div_binding,canvaspanandzoom_zoomLevel_binding,canvaspanandzoom_zoomControls_binding,canvaspanandzoom_zoomMultiTouching_binding,div_binding_1,measure_handler_2];}var Ui=/*#__PURE__*/function(_SvelteComponent21){_inherits(Ui,_SvelteComponent21);var _super22=_createSuper(Ui);function Ui(options){var _this23;_classCallCheck(this,Ui);_this23=_super22.call(this);init(_assertThisInitialized(_this23),options,instance$x,create_fragment$x,safe_not_equal,{"class":204,layout:205,stores:206,locale:3,id:4,util:207,utils:208,animations:209,disabled:210,status:202,previewUpscale:211,previewPad:212,previewMaskOpacity:5,previewImageDataMaxSize:213,previewImageTextPixelRatio:6,markupMaskOpacity:7,zoomMaskOpacity:214,elasticityMultiplier:8,willRevert:215,willProcessImage:216,willRenderCanvas:9,willRenderToolbar:217,willSetHistoryInitialState:218,enableButtonExport:219,enableButtonRevert:220,enableNavigateHistory:221,enableToolbar:10,enableUtils:222,enableButtonClose:223,enableDropImage:224,enablePasteImage:225,enableBrowseImage:226,layoutDirectionPreference:227,layoutHorizontalUtilsPreference:228,layoutVerticalUtilsPreference:229,layoutVerticalToolbarPreference:230,layoutVerticalControlGroupsPreference:231,layoutVerticalControlTabsPreference:232,markupEditorZoomLevel:233,markupEditorZoomLevels:11,markupEditorZoomAdjustStep:12,markupEditorZoomAdjustFactor:13,markupEditorZoomAdjustWheelFactor:14,markupEditorInteractionMode:234,muteAudio:235,willSetMediaInitialTimeOffset:236,enablePan:15,enableZoom:16,enableZoomControls:237,enableZoomInput:17,enablePanInput:238,enableCanvasAlpha:18,enablePanLimit:19,panLimitGutterScalar:20,zoomPresetOptions:21,zoomAdjustStep:22,zoomAdjustFactor:23,zoomAdjustWheelFactor:24,zoomLevel:0,imagePreviewSrc:239,imageOrienter:240,pluginComponents:241,pluginOptions:25,sub:242,pluginInterface:1,root:2,imageSourceToImageData:26,imagePreview:27,imagePreviewCurrent:203,history:28},null,[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);return _this23;}_createClass(Ui,[{key:"class",get:function get(){return this.$$.ctx[204];},set:function set(klass){this.$$set({"class":klass});flush();}},{key:"layout",get:function get(){return this.$$.ctx[205];},set:function set(layoutMode){this.$$set({layout:layoutMode});flush();}},{key:"stores",get:function get(){return this.$$.ctx[206];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"locale",get:function get(){return this.$$.ctx[3];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"id",get:function get(){return this.$$.ctx[4];},set:function set(id){this.$$set({id:id});flush();}},{key:"util",get:function get(){return this.$$.ctx[207];},set:function set(util){this.$$set({util:util});flush();}},{key:"utils",get:function get(){return this.$$.ctx[208];},set:function set(utils){this.$$set({utils:utils});flush();}},{key:"animations",get:function get(){return this.$$.ctx[209];},set:function set(animations){this.$$set({animations:animations});flush();}},{key:"disabled",get:function get(){return this.$$.ctx[210];},set:function set(disabled){this.$$set({disabled:disabled});flush();}},{key:"status",get:function get(){return this.$$.ctx[202];},set:function set(status){this.$$set({status:status});flush();}},{key:"previewUpscale",get:function get(){return this.$$.ctx[211];},set:function set(previewUpscale){this.$$set({previewUpscale:previewUpscale});flush();}},{key:"previewPad",get:function get(){return this.$$.ctx[212];},set:function set(previewPad){this.$$set({previewPad:previewPad});flush();}},{key:"previewMaskOpacity",get:function get(){return this.$$.ctx[5];},set:function set(previewMaskOpacity){this.$$set({previewMaskOpacity:previewMaskOpacity});flush();}},{key:"previewImageDataMaxSize",get:function get(){return this.$$.ctx[213];},set:function set(previewImageDataMaxSize){this.$$set({previewImageDataMaxSize:previewImageDataMaxSize});flush();}},{key:"previewImageTextPixelRatio",get:function get(){return this.$$.ctx[6];},set:function set(previewImageTextPixelRatio){this.$$set({previewImageTextPixelRatio:previewImageTextPixelRatio});flush();}},{key:"markupMaskOpacity",get:function get(){return this.$$.ctx[7];},set:function set(markupMaskOpacity){this.$$set({markupMaskOpacity:markupMaskOpacity});flush();}},{key:"zoomMaskOpacity",get:function get(){return this.$$.ctx[214];},set:function set(zoomMaskOpacity){this.$$set({zoomMaskOpacity:zoomMaskOpacity});flush();}},{key:"elasticityMultiplier",get:function get(){return this.$$.ctx[8];},set:function set(elasticityMultiplier){this.$$set({elasticityMultiplier:elasticityMultiplier});flush();}},{key:"willRevert",get:function get(){return this.$$.ctx[215];},set:function set(willRevert){this.$$set({willRevert:willRevert});flush();}},{key:"willProcessImage",get:function get(){return this.$$.ctx[216];},set:function set(willProcessImage){this.$$set({willProcessImage:willProcessImage});flush();}},{key:"willRenderCanvas",get:function get(){return this.$$.ctx[9];},set:function set(willRenderCanvas){this.$$set({willRenderCanvas:willRenderCanvas});flush();}},{key:"willRenderToolbar",get:function get(){return this.$$.ctx[217];},set:function set(willRenderToolbar){this.$$set({willRenderToolbar:willRenderToolbar});flush();}},{key:"willSetHistoryInitialState",get:function get(){return this.$$.ctx[218];},set:function set(willSetHistoryInitialState){this.$$set({willSetHistoryInitialState:willSetHistoryInitialState});flush();}},{key:"enableButtonExport",get:function get(){return this.$$.ctx[219];},set:function set(enableButtonExport){this.$$set({enableButtonExport:enableButtonExport});flush();}},{key:"enableButtonRevert",get:function get(){return this.$$.ctx[220];},set:function set(enableButtonRevert){this.$$set({enableButtonRevert:enableButtonRevert});flush();}},{key:"enableNavigateHistory",get:function get(){return this.$$.ctx[221];},set:function set(enableNavigateHistory){this.$$set({enableNavigateHistory:enableNavigateHistory});flush();}},{key:"enableToolbar",get:function get(){return this.$$.ctx[10];},set:function set(enableToolbar){this.$$set({enableToolbar:enableToolbar});flush();}},{key:"enableUtils",get:function get(){return this.$$.ctx[222];},set:function set(enableUtils){this.$$set({enableUtils:enableUtils});flush();}},{key:"enableButtonClose",get:function get(){return this.$$.ctx[223];},set:function set(enableButtonClose){this.$$set({enableButtonClose:enableButtonClose});flush();}},{key:"enableDropImage",get:function get(){return this.$$.ctx[224];},set:function set(enableDropImage){this.$$set({enableDropImage:enableDropImage});flush();}},{key:"enablePasteImage",get:function get(){return this.$$.ctx[225];},set:function set(enablePasteImage){this.$$set({enablePasteImage:enablePasteImage});flush();}},{key:"enableBrowseImage",get:function get(){return this.$$.ctx[226];},set:function set(enableBrowseImage){this.$$set({enableBrowseImage:enableBrowseImage});flush();}},{key:"layoutDirectionPreference",get:function get(){return this.$$.ctx[227];},set:function set(layoutDirectionPreference){this.$$set({layoutDirectionPreference:layoutDirectionPreference});flush();}},{key:"layoutHorizontalUtilsPreference",get:function get(){return this.$$.ctx[228];},set:function set(layoutHorizontalUtilsPreference){this.$$set({layoutHorizontalUtilsPreference:layoutHorizontalUtilsPreference});flush();}},{key:"layoutVerticalUtilsPreference",get:function get(){return this.$$.ctx[229];},set:function set(layoutVerticalUtilsPreference){this.$$set({layoutVerticalUtilsPreference:layoutVerticalUtilsPreference});flush();}},{key:"layoutVerticalToolbarPreference",get:function get(){return this.$$.ctx[230];},set:function set(layoutVerticalToolbarPreference){this.$$set({layoutVerticalToolbarPreference:layoutVerticalToolbarPreference});flush();}},{key:"layoutVerticalControlGroupsPreference",get:function get(){return this.$$.ctx[231];},set:function set(layoutVerticalControlGroupsPreference){this.$$set({layoutVerticalControlGroupsPreference:layoutVerticalControlGroupsPreference});flush();}},{key:"layoutVerticalControlTabsPreference",get:function get(){return this.$$.ctx[232];},set:function set(layoutVerticalControlTabsPreference){this.$$set({layoutVerticalControlTabsPreference:layoutVerticalControlTabsPreference});flush();}},{key:"markupEditorZoomLevel",get:function get(){return this.$$.ctx[233];},set:function set(markupEditorZoomLevel){this.$$set({markupEditorZoomLevel:markupEditorZoomLevel});flush();}},{key:"markupEditorZoomLevels",get:function get(){return this.$$.ctx[11];},set:function set(markupEditorZoomLevels){this.$$set({markupEditorZoomLevels:markupEditorZoomLevels});flush();}},{key:"markupEditorZoomAdjustStep",get:function get(){return this.$$.ctx[12];},set:function set(markupEditorZoomAdjustStep){this.$$set({markupEditorZoomAdjustStep:markupEditorZoomAdjustStep});flush();}},{key:"markupEditorZoomAdjustFactor",get:function get(){return this.$$.ctx[13];},set:function set(markupEditorZoomAdjustFactor){this.$$set({markupEditorZoomAdjustFactor:markupEditorZoomAdjustFactor});flush();}},{key:"markupEditorZoomAdjustWheelFactor",get:function get(){return this.$$.ctx[14];},set:function set(markupEditorZoomAdjustWheelFactor){this.$$set({markupEditorZoomAdjustWheelFactor:markupEditorZoomAdjustWheelFactor});flush();}},{key:"markupEditorInteractionMode",get:function get(){return this.$$.ctx[234];},set:function set(markupEditorInteractionMode){this.$$set({markupEditorInteractionMode:markupEditorInteractionMode});flush();}},{key:"muteAudio",get:function get(){return this.$$.ctx[235];},set:function set(muteAudio){this.$$set({muteAudio:muteAudio});flush();}},{key:"willSetMediaInitialTimeOffset",get:function get(){return this.$$.ctx[236];},set:function set(willSetMediaInitialTimeOffset){this.$$set({willSetMediaInitialTimeOffset:willSetMediaInitialTimeOffset});flush();}},{key:"enablePan",get:function get(){return this.$$.ctx[15];},set:function set(enablePan){this.$$set({enablePan:enablePan});flush();}},{key:"enableZoom",get:function get(){return this.$$.ctx[16];},set:function set(enableZoom){this.$$set({enableZoom:enableZoom});flush();}},{key:"enableZoomControls",get:function get(){return this.$$.ctx[237];},set:function set(enableZoomControls){this.$$set({enableZoomControls:enableZoomControls});flush();}},{key:"enableZoomInput",get:function get(){return this.$$.ctx[17];},set:function set(enableZoomInput){this.$$set({enableZoomInput:enableZoomInput});flush();}},{key:"enablePanInput",get:function get(){return this.$$.ctx[238];},set:function set(enablePanInput){this.$$set({enablePanInput:enablePanInput});flush();}},{key:"enableCanvasAlpha",get:function get(){return this.$$.ctx[18];},set:function set(enableCanvasAlpha){this.$$set({enableCanvasAlpha:enableCanvasAlpha});flush();}},{key:"enablePanLimit",get:function get(){return this.$$.ctx[19];},set:function set(enablePanLimit){this.$$set({enablePanLimit:enablePanLimit});flush();}},{key:"panLimitGutterScalar",get:function get(){return this.$$.ctx[20];},set:function set(panLimitGutterScalar){this.$$set({panLimitGutterScalar:panLimitGutterScalar});flush();}},{key:"zoomPresetOptions",get:function get(){return this.$$.ctx[21];},set:function set(zoomPresetOptions){this.$$set({zoomPresetOptions:zoomPresetOptions});flush();}},{key:"zoomAdjustStep",get:function get(){return this.$$.ctx[22];},set:function set(zoomAdjustStep){this.$$set({zoomAdjustStep:zoomAdjustStep});flush();}},{key:"zoomAdjustFactor",get:function get(){return this.$$.ctx[23];},set:function set(zoomAdjustFactor){this.$$set({zoomAdjustFactor:zoomAdjustFactor});flush();}},{key:"zoomAdjustWheelFactor",get:function get(){return this.$$.ctx[24];},set:function set(zoomAdjustWheelFactor){this.$$set({zoomAdjustWheelFactor:zoomAdjustWheelFactor});flush();}},{key:"zoomLevel",get:function get(){return this.$$.ctx[0];},set:function set(zoomLevel){this.$$set({zoomLevel:zoomLevel});flush();}},{key:"imagePreviewSrc",get:function get(){return this.$$.ctx[239];},set:function set(imagePreviewSrc){this.$$set({imagePreviewSrc:imagePreviewSrc});flush();}},{key:"imageOrienter",get:function get(){return this.$$.ctx[240];},set:function set(imageOrienter){this.$$set({imageOrienter:imageOrienter});flush();}},{key:"pluginComponents",get:function get(){return this.$$.ctx[241];},set:function set(pluginComponents){this.$$set({pluginComponents:pluginComponents});flush();}},{key:"pluginOptions",get:function get(){return this.$$.ctx[25];},set:function set(pluginOptions){this.$$set({pluginOptions:pluginOptions});flush();}},{key:"sub",get:function get(){return this.$$.ctx[242];}},{key:"pluginInterface",get:function get(){return this.$$.ctx[1];}},{key:"root",get:function get(){return this.$$.ctx[2];},set:function set(root){this.$$set({root:root});flush();}},{key:"imageSourceToImageData",get:function get(){return this.$$.ctx[26];},set:function set(imageSourceToImageData){this.$$set({imageSourceToImageData:imageSourceToImageData});flush();}},{key:"imagePreview",get:function get(){return this.$$.ctx[27];}},{key:"imagePreviewCurrent",get:function get(){return this.$$.ctx[203];},set:function set(imagePreviewCurrent){this.$$set({imagePreviewCurrent:imagePreviewCurrent});flush();}},{key:"history",get:function get(){return this.$$.ctx[28];}}]);return Ui;}(SvelteComponent);// which props to filter out of exported props
var utilPrivateProps=['klass','stores','isVisible','isActive','isActiveFraction','locale'];var viewPrivateProps=[// methods
'history',// props
'klass','stores','navButtons','pluginComponents','pluginInterface','pluginOptions','sub','imagePreviewSrc','imagePreview','imagePreviewCurrent'];// properties that should be merged with current value if set
var mergeProps=['locale'];// view options array
var editorProps;var pluginProps=new Set([]);var propPluginRef={};// loops over plugins and registers all available options so we can define getters/setters
var pluginComponents=new Map();var setEditorViewPlugins=function setEditorViewPlugins(){for(var _len9=arguments.length,args=new Array(_len9),_key12=0;_key12<_len9;_key12++){args[_key12]=arguments[_key12];}args// remove invalid plugins
.filter(function(plugin){return!!plugin.util;})// register valid plugins
.forEach(function(plugin){var _plugin$util=_slicedToArray(plugin.util,3),id=_plugin$util[0],Component=_plugin$util[1],_plugin$util$=_plugin$util[2],isSupported=_plugin$util$===void 0?function(){return true;}:_plugin$util$;// already set
if(pluginComponents.has(id))return;// store
pluginComponents.set(id,{Component:Component,isSupported:isSupported});// get props
getComponentExportedProps(Component).filter(function(prop){return!utilPrivateProps.includes(prop);}).forEach(function(prop){pluginProps.add(prop);if(propPluginRef[prop]){propPluginRef[prop].push(id);return;}propPluginRef[prop]=[id];});});};var getEditorViewProps=function getEditorViewProps(){editorProps=new Set(getComponentExportedProps(Ui).filter(function(prop){return!viewPrivateProps.includes(prop);}));return[].concat(_toConsumableArray(editorProps),_toConsumableArray(pluginProps));};var attachEditorView=function attachEditorView(target,stores){var accessors={};// creates the editor component instance
var editor=new Ui({target:target,props:{stores:stores,pluginComponents:Array.from(pluginComponents)}});// destroys the editor component instance
var isDestroyed=false;var destroy=function destroy(){if(isDestroyed)return;if(isBrowser())window.removeEventListener('pagehide',destroy);if(!editor)return;isDestroyed=true;editor.$destroy();};// set up accessors for editor props
if(!editorProps)editorProps=new Set(getComponentExportedProps(Ui).filter(function(prop){return!viewPrivateProps.includes(prop);}));editorProps.forEach(function(prop){Object.defineProperty(accessors,prop,{get:function get(){return editor[prop];},set:mergeProps.includes(prop)?// merge new value with existing value
function(value){editor[prop]=_objectSpread(_objectSpread({},editor[prop]),value);}:// overwrite current value
function(value){return editor[prop]=value;}});});// this reads the imagePreview store so third parties can interact with image data
Object.defineProperty(accessors,'previewImageData',{get:function get(){return editor.imagePreviewCurrent;}});// set up accessors for plugin props
pluginProps.forEach(function(prop){var plugins=propPluginRef[prop];var plugin=plugins[0];// will always get value from first plugin, when plugins share a property the value will be in sync when set
Object.defineProperty(accessors,prop,{get:function get(){return editor.pluginInterface[plugin][prop];},set:function set(value){var opts=plugins.reduce(function(prev,plugin){prev[plugin]=_objectSpread(_objectSpread({},editor.pluginOptions[plugin]),{},_defineProperty({},prop,value));return prev;},{});editor.pluginOptions=_objectSpread(_objectSpread({},editor.pluginOptions),opts);}});});// add `element` root query
Object.defineProperty(accessors,'element',{get:function get(){return editor.root;},set:function set(){return undefined;}});// history shortcut
var history=editor.history;defineMethods(accessors,{on:function on(event,cb){// exit if editor was destroyed, will return stub function so unsubs can be called without issues
if(isDestroyed)return function(){// Do nothing
};// catch history events and route to history object
if(/undo|redo|revert|writehistory/.test(event))return history.on(event,cb);// gather unsub methods
var unsubs=[editor.sub(event,cb),editor.$on(event,function(e){return cb(e instanceof CustomEvent&&!e.detail?undefined:e);})].filter(Boolean);// set up unsubscribe group
return function(){return unsubs.forEach(function(unsub){return unsub();});};},updateImagePreview:function updateImagePreview(src){editor.imagePreviewSrc=src;},close:function close(){return!isDestroyed&&editor.pub('close');},destroy:destroy});Object.defineProperty(accessors,'history',{get:function get(){return{undo:function undo(){return history.undo();},redo:function redo(){return history.redo();},revert:function revert(){return history.revert();},get:function get(){return history.get();},getCollapsed:function getCollapsed(){var entries=history.get();return entries.splice(0,history.index+1);},set:function set(entries){return history.set(entries);},write:function write(state){return history.write(state);},get length(){return history.length();},get index(){return history.index;},set index(index){history.index=index;}};}});// clean up on window unload
if(isBrowser())window.addEventListener('pagehide',destroy);return accessors;};var editorEvents=[].concat(editorEventsToBubble,[// ui editor events
'init','update','undo','redo','revert','writehistory','destroy','show','hide','close','ready','zoom','pan','loadpreview','selectshape','updateshape','addshape','removeshape','selectstyle','markuptap','markupzoom','markuppan','selectutil','selectcontrol']);var dispatchElementEvent=function dispatchElementEvent(target,event,detail){return target.dispatchEvent(new CustomEvent(event,{detail:detail,bubbles:true,cancelable:true}));};var dispatchEditorEvents=function dispatchEditorEvents(editor,handler){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var _options$prefix=options.prefix,prefix=_options$prefix===void 0?'pintura:':_options$prefix;return editorEvents.map(function(event){return editor.on(event,function(value){return isElement(handler)?dispatchElementEvent(handler,"".concat(prefix).concat(event),value):handler(event,value);});});};var naturalAspectRatioToNumber=function naturalAspectRatioToNumber(value){// already valid value
if(value===undefined||isNumber(value))return value;// invalid
if(!isString(value))return false;// convert string to aspect ratio fraction
var str=value;// we interpret empty string as undefined
if(!str.length)return undefined;// get numbers
var _str$split$map$filter=str.split(/\/|:/g).map(function(value){return parseFloat(value.replace(/,/,'.'));}).filter(Boolean),_str$split$map$filter2=_slicedToArray(_str$split$map$filter,2),w=_str$split$map$filter2[0],h=_str$split$map$filter2[1];// invalid
if(!w)return false;// single value received
if(!h)return w;// lets convert to fraction
return Math.abs(w/h);};var arrayInsert=function arrayInsert(array,index,item){array.splice(index,0,item);return array;};// first index is always id, so if is string, it's a node
var isNode=function isNode(item){return isString(item[0]);};// if it's not a node, it's a nodelist
var isNodeList=function isNodeList(item){return!isNode(item);};var getNodeId=function getNodeId(node){return node[1];};var getNodeChildren=function getNodeChildren(node){return node[3]||[];};function createNode(instance,id,props,children){// if three arguments received, props can be children
if(Array.isArray(props)){children=props;props={};}// node is always array of four entries
return[instance,id,props||{},children||[]];}var insertNode=function insertNode(node,needle,haystack){var getIndex=arguments.length>3&&arguments[3]!==undefined?arguments[3]:function(index){return index;};var nodeList=findNodeList(needle,haystack);var targetIndex=nodeList.findIndex(function(item){return getNodeId(item)===needle;});arrayInsert(nodeList,getIndex(targetIndex),node);};var insertNodeBefore=function insertNodeBefore(node,needle,haystack){return insertNode(node,needle,haystack);};var insertNodeAfter=function insertNodeAfter(node,needle,haystack){return insertNode(node,needle,haystack,function(index){return index+1;});};var appendNode=function appendNode(node,haystack){// if is list, add to list
if(isNodeList(haystack))return haystack.push(node);// else it's a node, add to node children
haystack[3]=[].concat(_toConsumableArray(getNodeChildren(haystack)),[node]);};var removeNode=function removeNode(needle,haystack){var nodeList=findNodeList(needle,haystack);arrayRemove(nodeList,function(item){return getNodeId(item)===needle;});return nodeList;};var findNode=function findNode(needle,haystack){if(!haystack||!haystack.length)return;// haystack is a node, maybe node is a match or one of children is a match
if(isNode(haystack)){if(getNodeId(haystack)===needle){return haystack;}var res=findNode(needle,getNodeChildren(haystack));if(res)return res;}if(isNodeList(haystack)){var _iterator7=_createForOfIteratorHelper(haystack),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var child=_step7.value;var _res=findNode(needle,child);if(_res)return _res;}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}}};var findNodeList=function findNodeList(needle,haystack){// haystack is node list
if(isNodeList(haystack)){// lets search nodes in this haystack
if(haystack.find(function(item){return getNodeId(item)===needle;}))return haystack;// not found, lets move the search to the childnodes
return haystack.find(function(item){return findNodeList(needle,getNodeChildren(item));});}// is node, lets find in children
return findNodeList(needle,getNodeChildren(haystack));};var updateNode=function updateNode(node,props){var _node=_slicedToArray(node,3),nodeProps=_node[2];Object.assign(nodeProps,props);};var pastel=function pastel(){return(// prettier-ignore
[0.75,0.25,0.25,0,0,0.25,0.75,0.25,0,0,0.25,0.25,0.75,0,0,0,0,0,1,0]);};var chrome=function chrome(){return(// prettier-ignore
[1.398,-0.316,0.065,-0.273,0.201,-0.051,1.278,-0.080,-0.273,0.201,-0.051,0.119,1.151,-0.290,0.215,0,0,0,1,0]);};var fade=function fade(){return(// prettier-ignore
[1.073,-0.015,0.092,-0.115,-0.017,0.107,0.859,0.184,-0.115,-0.017,0.015,0.077,1.104,-0.115,-0.017,0,0,0,1,0]);};var warm=function warm(){return(// prettier-ignore
[1.06,0,0,0,0,0,1.01,0,0,0,0,0,0.93,0,0,0,0,0,1,0]);};var cold=function cold(){return(// prettier-ignore
[1.1,0,0,0,-.1,0,1.1,0,0,-.1,0,0,1.2,0,-.1,0,0,0,1,0]);};var invert=function invert(){return(// prettier-ignore
[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0]);};var monoDefault=function monoDefault(){return(// prettier-ignore
[0.212,0.715,0.114,0,0,0.212,0.715,0.114,0,0,0.212,0.715,0.114,0,0,0,0,0,1,0]);};var monoNoir=function monoNoir(){return(// prettier-ignore
[0.15,1.3,-0.25,0.1,-0.2,0.15,1.3,-0.25,0.1,-0.2,0.15,1.3,-0.25,0.1,-0.2,0,0,0,1,0]);};var monoWash=function monoWash(){return(// prettier-ignore
[0.163,0.518,0.084,-0.010,0.208,0.163,0.529,0.082,-0.020,0.210,0.171,0.529,0.084,0.000,0.214,0,0,0,1,0]);};var monoStark=function monoStark(){return(// prettier-ignore
[0.338,0.991,0.117,0.093,-0.196,0.302,1.049,0.096,0.078,-0.196,0.286,1.016,0.146,0.101,-0.196,0,0,0,1,0]);};var sepiaDefault=function sepiaDefault(){return(// prettier-ignore
[0.393,0.768,0.188,0,0,0.349,0.685,0.167,0,0,0.272,0.533,0.130,0,0,0,0,0,1,0]);};var sepiaBlues=function sepiaBlues(){return(// prettier-ignore
[0.289,0.620,0.185,0.000,0.077,0.257,0.566,0.163,0.000,0.115,0.200,0.430,0.128,0.000,0.188,0,0,0,1,0]);};var sepiaRust=function sepiaRust(){return(// prettier-ignore
[0.269,0.764,0.172,0.050,0.100,0.239,0.527,0.152,0.000,0.176,0.186,0.400,0.119,0.000,0.159,0,0,0,1,0]);};var sepiaColor=function sepiaColor(){return(// prettier-ignore
[0.547,0.764,0.134,0.000,-0.147,0.281,0.925,0.120,0.000,-0.135,0.225,0.558,0.330,0.000,-0.113,0,0,0,1,0]);};//
// default filter set
//
var filterFunctionsDefault={chrome:chrome,fade:fade,pastel:pastel,cold:cold,warm:warm,monoDefault:monoDefault,monoWash:monoWash,monoNoir:monoNoir,monoStark:monoStark,sepiaDefault:sepiaDefault,sepiaRust:sepiaRust,sepiaBlues:sepiaBlues,sepiaColor:sepiaColor};var filterOptionsDefault=[['Default',[[undefined,function(locale){return locale.labelDefault;}]]],['Classic',[['chrome',function(locale){return locale.filterLabelChrome;}],['fade',function(locale){return locale.filterLabelFade;}],['cold',function(locale){return locale.filterLabelCold;}],['warm',function(locale){return locale.filterLabelWarm;}],['pastel',function(locale){return locale.filterLabelPastel;}]]],['Monochrome',[['monoDefault',function(locale){return locale.filterLabelMonoDefault;}],['monoNoir',function(locale){return locale.filterLabelMonoNoir;}],['monoStark',function(locale){return locale.filterLabelMonoStark;}],['monoWash',function(locale){return locale.filterLabelMonoWash;}]]],['Sepia',[['sepiaDefault',function(locale){return locale.filterLabelSepiaDefault;}],['sepiaRust',function(locale){return locale.filterLabelSepiaRust;}],['sepiaBlues',function(locale){return locale.filterLabelSepiaBlues;}],['sepiaColor',function(locale){return locale.filterLabelSepiaColor;}]]]];var _plugin_filter_defaults={filterFunctions:filterFunctionsDefault,filterOptions:filterOptionsDefault};//#region markup
var propertyMap={borderColor:'strokeColor',borderWidth:'strokeWidth',lineWidth:'strokeWidth',fontColor:'color',lineColor:'strokeColor',src:'backgroundImage',fit:'backgroundSize'};var convertValue=function convertValue(value){if(value===0)return 0;if(value==='0%')return 0;if(value==='0px')return 0;if(/px$/.test(value))return parseInt(value,10);if(/\%$/.test(value))return value;if(value<=1)return"".concat(value*100,"%");};var addValues=function addValues(a,b){var _a,_b;if(/%$/.test(a)){_a=parseFloat(a);_b=parseFloat(b);return"".concat(_a+_b,"%");}if(/px$/.test(a)){_a=parseInt(a,10);_b=parseInt(b,10);return"".concat(_a+_b,"px");}};var shapeFromLegacyMarkup=function shapeFromLegacyMarkup(crop,type,style){var shape=Object.keys(style).reduce(function(res,prop){var value=style[prop];// rename prop
prop=propertyMap[prop]||prop;// if is px value
if(/px$/.test(value)){value=convertValue(value);}// if is number convert to percentage
else if(/^(?:x|y|left|right|top|bottom|width|height|fontSize|borderWidth|strokeWidth)$/.test(prop)&&typeof value==='number'){// except for widths and font sizes, change to those to absolute values
if(prop==='strokeWidth'||prop==='borderWidth'||prop==='fontSize'){var minAxis=Math.min(crop.width,crop.height);value="".concat(minAxis*value,"px");}value=convertValue(value);}// if is color value
if(/color/i.test(prop)&&value)value=colorStringToColorArray(value);if(value===null)value=undefined;res[prop]=value;return res;},{});if(type==='line'){if(shape.lineDecoration.length>=1)shape.lineEnd='arrow';if(shape.lineDecoration.length===2)shape.lineStart='arrow';shape.x1=shape.x;shape.y1=shape.y;shape.x2=addValues(shape.x,shape.width);shape.y2=addValues(shape.y,shape.height);delete shape.x;delete shape.y;delete shape.width;delete shape.height;delete shape.lineDecoration;delete shape.lineStyle;}if(type==='text'){// need y to be absolute to calculate correct sizes
if(!isNumber(shape.y)){var minAxis=Math.min(crop.width,crop.height);shape.y=minAxis*(parseFloat(shape.y)/100);}shape.y=shape.y-shape.fontSize;delete shape.width;delete shape.height;delete shape.borderStyle;shape.lineHeight=shape.lineHeight||'120%';}if(type==='ellipse'){var w,_h2;// calculate `rx` and `ry` based on `width` and `h`eight`
if(/%$/.test(shape.width)){w=parseFloat(shape.width)/100;_h2=parseFloat(shape.height)/100;var widthAbsolute=w*crop.width;var heightAbsolute=_h2*crop.height;w=widthAbsolute/crop.width*100;_h2=heightAbsolute/crop.height*100;}else{w=shape.width;_h2=shape.height;}shape.rx=w*0.5;shape.ry=_h2*0.5;if(/%$/.test(shape.width)){shape.rx+='%';shape.ry+='%';}shape.x=addValues(shape.x,shape.rx);shape.y=addValues(shape.y,shape.ry);delete shape.width;delete shape.height;delete shape.borderStyle;}if(type==='rect'){delete shape.borderStyle;}if(type==='path'){// remove points that are too close
var out=[];var lastAdded;var _iterator8=_createForOfIteratorHelper(shape.points),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var point=_step8.value;// always add first
if(!lastAdded){out.push(point);lastAdded=point;continue;}// if too far, skip
var dist=vectorDistanceSquared(lastAdded,point);if(dist<0.000000001)continue;// add!
out.push(point);lastAdded=point;// set new last point
lastAdded=point;}//
}catch(err){_iterator8.e(err);}finally{_iterator8.f();}shape.points=out.map(function(point){return{x:convertValue(point.x),y:convertValue(point.y)};});}return shape;};//#endregion
//#region crop
var getOffsetPointOnEdge=function getOffsetPointOnEdge(length,rotation){var a=length;var A=1.5707963267948966;var B=rotation;var C=1.5707963267948966-rotation;var sinA=Math.sin(A);var sinB=Math.sin(B);var sinC=Math.sin(C);var cosC=Math.cos(C);var ratio=a/sinA;var b=ratio*sinB;var c=ratio*sinC;return vectorCreate(cosC*b,cosC*c);};var getRotatedRectSize=function getRotatedRectSize(rect,rotation){var w=rect.width;var h=rect.height;var hor=getOffsetPointOnEdge(w,rotation);var ver=getOffsetPointOnEdge(h,rotation);var tl=vectorCreate(rect.x+Math.abs(hor.x),rect.y-Math.abs(hor.y));var tr=vectorCreate(rect.x+rect.width+Math.abs(ver.y),rect.y+Math.abs(ver.x));var bl=vectorCreate(rect.x-Math.abs(ver.y),rect.y+rect.height-Math.abs(ver.x));return{width:vectorDistance(tl,tr),height:vectorDistance(tl,bl)};};var getBoundsAroundCenter=function getBoundsAroundCenter(imageSize,center){var cx=center.x>0.5?1-center.x:center.x;var cy=center.y>0.5?1-center.y:center.y;return sizeCreate(cx*2*imageSize.width,cy*2*imageSize.height);};var getCanvasSize=function getCanvasSize(imageSize,canvasAspectRatio){var zoom=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var imageAspectRatio=imageSize.height/imageSize.width;// determine actual pixels on x and y axis
var canvasWidth=1;var canvasHeight=canvasAspectRatio;var imgWidth=1;var imgHeight=imageAspectRatio;if(imgHeight>canvasHeight){imgHeight=canvasHeight;imgWidth=imgHeight/imageAspectRatio;}var scalar=Math.max(canvasWidth/imgWidth,canvasHeight/imgHeight);var width=imageSize.width/(zoom*scalar*imgWidth);var height=width*canvasAspectRatio;return{width:width,height:height};};var getCenteredCropRect=function getCenteredCropRect(imageSize,aspectRatio){var width=imageSize.width;var height=width*aspectRatio;if(height>imageSize.height){height=imageSize.height;width=height/aspectRatio;}var x=(imageSize.width-width)*0.5;var y=(imageSize.height-height)*0.5;return rectCreate(x,y,width,height);};var getCorrectedLegacyAspectRatio=function getCorrectedLegacyAspectRatio(imageSize,aspectRatio){return aspectRatio!=null?// fox the aspect ratio
1/aspectRatio:// set image aspect ratio
imageSize.width/imageSize.height;};var imagePropertiesFromLegacyCrop=function imagePropertiesFromLegacyCrop(imageSize,_ref306){var flip=_ref306.flip,aspectRatio=_ref306.aspectRatio,rotation=_ref306.rotation,center=_ref306.center,zoom=_ref306.zoom,scaleToFit=_ref306.scaleToFit;var res={flipX:false,flipY:false};// is centered crop
var isCenteredCrop=!center||center&&center.x===0.5&&center.y===0.5;// handle basic props
if(flip&&flip.horizontal)res.flipX=flip.horizontal;if(flip&&flip.vertical)res.flipY=flip.vertical;// fix aspect ratio, in FilePond and editor v6 it's height/width instead of width/height
var correctedAspectRatio=getCorrectedLegacyAspectRatio(imageSize,aspectRatio);// image bounds
var cropLimit=!(scaleToFit===false);var canvasSize=getCanvasSize(imageSize,aspectRatio,zoom);var cropSize=isCenteredCrop?imageSize:getBoundsAroundCenter(imageSize,cropLimit?center:{x:0.5,y:0.5});var cropCentered=getCenteredCropRect(imageSize,aspectRatio);// has different aspect ratio than image
if(aspectRatio||!isCenteredCrop||zoom){res.crop=rectContainRect(rectCreateFromSize(cropSize),correctedAspectRatio);}if(typeof rotation==='number'&&rotation!==null){if(rotation!=null)res.rotation=rotation;var rotatedCropSize=getRotatedRectSize(cropCentered,rotation);var _scalar5=Math.max(rotatedCropSize.width/cropSize.width,rotatedCropSize.height/cropSize.height);// crop position in non-rotated image
var cropCenter=vectorCreate(center.x*imageSize.width,center.y*imageSize.height);// get rotated image center
var rotatedImageSize=getImageTransformedRect(imageSize,rotation);var rotatedImageCenter=sizeCenter(rotatedImageSize);var rotatedImageOffset=vectorCreate((rotatedImageSize.width-imageSize.width)*0.5,(rotatedImageSize.height-imageSize.height)*0.5);var cropPoints=rectRotate({x:rotatedImageOffset.x+cropCenter.x-canvasSize.width/_scalar5*0.5,y:rotatedImageOffset.y+cropCenter.y-canvasSize.height/_scalar5*0.5,width:canvasSize.width/_scalar5,height:canvasSize.height/_scalar5},rotation);var cropBoundsPoints=vectorsRotate(cropPoints.map(vectorClone),rotation,rotatedImageCenter.x,rotatedImageCenter.y);var cropBoundsPointsCenter=rectCenter(rectCreateFromPoints(cropBoundsPoints));var deRotatedCropBoundsPoints=vectorsRotate(cropBoundsPoints.map(vectorClone),-(rotation*2),cropBoundsPointsCenter.x,cropBoundsPointsCenter.y);res.crop=rectCreateFromPoints(deRotatedCropBoundsPoints);}else if(zoom!=null){rectScale$1(res.crop,1/zoom);}if(!cropLimit){res.cropLimitToImage=false;}return res;};//#endregion
var isLegacyData=function isLegacyData(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if('markup'in data||'color'in data||'filter'in data)return true;var crop=data.crop;if(crop&&('flip'in crop||'center'in crop||'aspectRatio'in crop||'rotation'in crop))return true;return false;};var legacyDataToImageState=function legacyDataToImageState(editor,imageSize){var data=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var res={};// test if isn't legacy data
if(!isLegacyData(data))return data;if(data.crop){Object.assign(res,imagePropertiesFromLegacyCrop(imageSize,data.crop));}if(data.markup){var markup=Array.isArray(data.markup)?data.markup:Object.values(data.markup);res.decoration=markup.map(function(markup){return shapeFromLegacyMarkup(res.crop||imageSize,markup[0],markup[1]);});}if(data.color||data.colors){var colors=data.color||data.colors;Object.keys(colors).filter(function(key){return colors[key];}).map(function(key){return[key,Array.isArray(colors[key].matrix)?colors[key].matrix:Object.values(colors[key].matrix)];}).forEach(function(_ref307){var _ref308=_slicedToArray(_ref307,2),key=_ref308[0],value=_ref308[1];if(!res.colorMatrix)res.colorMatrix={};res.colorMatrix[key]=value;});}if(data.filter||data.filters){var filter=data.filters||data.filter;if(!res.colorMatrix)res.colorMatrix={};var filterFunctions=editor?editor['filterFunctions']:filterFunctionsDefault;res.colorMatrix.filter=typeof filter==='string'&&filterFunctions[filter]?filterFunctions[filter]():filter.matrix;}var resize=data.size?data.size:data.resize?data.resize.size:false;if(resize&&resize.width&&resize.height){res.targetSize={width:resize.width,height:resize.height};}return res;};var isOperaMini=function isOperaMini(){return Object.prototype.toString.call(window['operamini'])==='[object OperaMini]';};var hasPromises=function hasPromises(){return'Promise'in window;};var hasCreateObjectURL=function hasCreateObjectURL(){return'URL'in window&&'createObjectURL'in window.URL;};var hasVisibility=function hasVisibility(){return'visibilityState'in document;};var hasTiming=function hasTiming(){return'performance'in window;};// iOS 8.x
var hasFileConstructor=function hasFileConstructor(){return'File'in window;};// excludes IE11
var result$2=null;var isModernBrowser=function isModernBrowser(){if(result$2===null)result$2=isBrowser()&&// Can't run on Opera Mini due to lack of everything
!isOperaMini()&&// Require these APIs to feature detect a modern browser
hasVisibility()&&hasPromises()&&hasFileConstructor()&&hasCreateObjectURL()&&hasTiming();return result$2;};var brightness={base:0,min:-0.25,max:0.25,getLabel:function getLabel(value){return toPercentageNumber(value/0.25);},getStore:function getStore(_ref309){var imageColorMatrix=_ref309.imageColorMatrix;return imageColorMatrix;},getValue:function getValue(store){if(!store.brightness)return;return store.brightness[4];},setValue:function setValue(store,v){return store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore
brightness:[1,0,0,0,v,0,1,0,0,v,0,0,1,0,v,0,0,0,1,0]});});}};var contrast={base:1,min:0.5,max:1.5,getLabel:function getLabel(value){return toPercentageNumber(-1+(value-0.5)*2);},getStore:function getStore(_ref310){var imageColorMatrix=_ref310.imageColorMatrix;return imageColorMatrix;},getValue:function getValue(store){if(!store.contrast)return;return store.contrast[0];},setValue:function setValue(store,v){return store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore
contrast:[v,0,0,0,.5*(1-v),0,v,0,0,.5*(1-v),0,0,v,0,.5*(1-v),0,0,0,1,0]});});}};var saturation={base:1,min:0,max:2,getLabel:function getLabel(value){return toPercentageNumber(value-1);},getStore:function getStore(_ref311){var imageColorMatrix=_ref311.imageColorMatrix;return imageColorMatrix;},getValue:function getValue(store){if(!store.saturation)return;return(store.saturation[0]-0.213)/0.787;},setValue:function setValue(store,v){return store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore
saturation:[.213+.787*v,.715-.715*v,.072-.072*v,0,0,.213-.213*v,.715+.285*v,.072-.072*v,0,0,.213-.213*v,.715-.715*v,.072+.928*v,0,0,0,0,0,1,0]});});}};var exposure={base:1,min:0.5,max:1.5,getLabel:function getLabel(value){return toPercentageNumber(-1+(value-0.5)*2);},getStore:function getStore(_ref312){var imageColorMatrix=_ref312.imageColorMatrix;return imageColorMatrix;},getValue:function getValue(store){if(!store.exposure)return;return store.exposure[0];},setValue:function setValue(store,v){return store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore
exposure:[v,0,0,0,0,0,v,0,0,0,0,0,v,0,0,0,0,0,1,0]});});}};var gamma={base:1,min:0.15,max:4,getLabel:function getLabel(value){if(value<1){return toPercentageNumber((value-0.15)/0.85-1);}return toPercentageNumber((value-1)/3);},getStore:function getStore(_ref313){var imageGamma=_ref313.imageGamma;return imageGamma;}};var vignette={base:0,min:-1,max:1,getStore:function getStore(_ref314){var imageVignette=_ref314.imageVignette;return imageVignette;}};var clarity={base:0,min:-1,max:1,getStore:function getStore(_ref315){var imageConvolutionMatrix=_ref315.imageConvolutionMatrix;return imageConvolutionMatrix;},getValue:function getValue(store){if(!store.clarity)return;if(store.clarity[0]===0){return store.clarity[1]/-1;}else{return store.clarity[1]/-2;}},setValue:function setValue(store,v){store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore
clarity:v>=0?[0,-1*v,0,-1*v,1+4*v,-1*v,0,-1*v,0]:[-1*v,-2*v,-1*v,-2*v,1+-3*v,-2*v,-1*v,-2*v,-1*v]});});}};var temperature={base:0,min:-1,max:1,getStore:function getStore(_ref316){var imageColorMatrix=_ref316.imageColorMatrix;return imageColorMatrix;},getValue:function getValue(store){if(!store.temperature)return;var v=store.temperature[0];if(v>=1){return(v-1)/0.1;}return(1-v)/-0.15;},setValue:function setValue(store,v){return store.update(function(matrices){return _objectSpread(_objectSpread({},matrices),{},{// prettier-ignore
temperature:v>0?[1+v*.1,0,0,0,0,0,1,0,0,0,0,0,1+-v*.1,0,0,0,0,0,1,0]:[1+v*.15,0,0,0,0,0,1+v*.05,0,0,0,0,0,1+-v*.15,0,0,0,0,0,1,0]});});}};var finetuneControlConfigurationDefault={gamma:gamma,brightness:brightness,contrast:contrast,saturation:saturation,exposure:exposure,temperature:temperature,clarity:clarity,vignette:vignette};var finetuneOptionsDefault=[['brightness',function(locale){return locale.finetuneLabelBrightness;}],['contrast',function(locale){return locale.finetuneLabelContrast;}],['saturation',function(locale){return locale.finetuneLabelSaturation;}],['exposure',function(locale){return locale.finetuneLabelExposure;}],['temperature',function(locale){return locale.finetuneLabelTemperature;}],['gamma',function(locale){return locale.finetuneLabelGamma;}],!isSoftwareRendering()&&['clarity',function(locale){return locale.finetuneLabelClarity;}],['vignette',function(locale){return locale.finetuneLabelVignette;}]].filter(Boolean);var _plugin_finetune_defaults={finetuneControlConfiguration:finetuneControlConfigurationDefault,finetuneOptions:finetuneOptionsDefault};/*
TODO: fix inverse fn in getValue
export const hue = {
    base: 0,
    min: 0,
    max: Math.PI,
    getStore: ({ imageColorMatrix }) => imageColorMatrix,
    getValue: (store) => {
        if (!store.hue) return;

        const v = store.hue[1];

        const o = -(Math.acos((0.715 - v) / Math.sqrt(2) / 0.715) - Math.PI / 4);

        return o;
    },
    setValue: (store, v: number) => {
        store.update((matrices) => {
            // const value = v * (Math.PI);

            const cos = Math.cos(v);
            const sin = Math.sin(v);

            const a00 = 0.213 + cos * 0.787 - sin * 0.213;
            const a01 = 0.715 - cos * 0.715 - sin * 0.715;
            const a02 = 0.072 - cos * 0.072 + sin * 0.928;
            const a10 = 0.213 - cos * 0.213 + sin * 0.143;
            const a11 = 0.715 + cos * 0.285 + sin * 0.14;
            const a12 = 0.072 - cos * 0.072 - sin * 0.283;
            const a20 = 0.213 - cos * 0.213 - sin * 0.787;
            const a21 = 0.715 - cos * 0.715 + sin * 0.715;
            const a22 = 0.072 + cos * 0.928 + sin * 0.072;

            return {
                ...matrices,

                // prettier-ignore
                hue: [
                    a00, a01, a02, 0, 0,
                    a10, a11, a12, 0, 0,
                    a20, a21, a22, 0, 0,
                      0,   0,   0, 1, 0,
                ]
            };
        });
    },
};
*/var solidSharp={shape:{frameColor:[1,1,1],frameStyle:'solid',frameSize:'2.5%'},thumb:'<rect stroke-width="5" x="0" y="0" width="100%" height="100%"/>'};var solidRound={shape:{frameColor:[1,1,1],frameStyle:'solid',frameSize:'2.5%',frameRound:true},thumb:'<rect stroke-width="5" x="0" y="0" width="100%" height="100%" rx="12%"/>'};var lineSingle={shape:{frameColor:[1,1,1],frameStyle:'line',frameInset:'2.5%',frameSize:'.3125%',frameRadius:0},thumb:'<div style="top:.5em;left:.5em;right:.5em;bottom:.5em;box-shadow:inset 0 0 0 1px currentColor"></div>'};var lineMultiple={shape:{frameColor:[1,1,1],frameStyle:'line',frameAmount:2,frameInset:'2.5%',frameSize:'.3125%',frameOffset:'1.25%',frameRadius:0},thumb:'<div style="top:.75em;left:.75em;right:.75em;bottom:.75em; outline: 3px double"></div>'};var edgeSeparate={shape:{frameColor:[1,1,1],frameStyle:'edge',frameInset:'2.5%',frameOffset:'5%',frameSize:'.3125%'},thumb:'<div style="top:.75em;left:.5em;bottom:.75em;border-left:1px solid"></div><div style="top:.75em;right:.5em;bottom:.75em;border-right:1px solid"></div><div style="top:.5em;left:.75em;right:.75em;border-top:1px solid"></div><div style="bottom:.5em;left:.75em;right:.75em;border-bottom:1px solid"></div>'};var edgeCross={shape:{frameColor:[1,1,1],frameStyle:'edge',frameInset:'2.5%',frameSize:'.3125%'},thumb:'<div style="top:-.5em;left:.5em;right:.5em;bottom:-.5em; box-shadow: inset 0 0 0 1px currentColor"></div><div style="top:.5em;left:-.5em;right:-.5em;bottom:.5em;box-shadow:inset 0 0 0 1px currentColor"></div>'};var edgeOverlap={shape:{frameColor:[1,1,1],frameStyle:'edge',frameOffset:'1.5%',frameSize:'.3125%'},thumb:'<div style="top:.3125em;left:.5em;bottom:.3125em;border-left:1px solid"></div><div style="top:.3125em;right:.5em;bottom:.3125em;border-right:1px solid"></div><div style="top:.5em;left:.3125em;right:.3125em;border-top:1px solid"></div><div style="bottom:.5em;left:.3125em;right:.3125em;border-bottom:1px solid"></div>'};var hook={shape:{frameColor:[1,1,1],frameStyle:'hook',frameInset:'2.5%',frameSize:'.3125%',frameLength:'5%'},thumb:'<div style="top:.5em;left:.5em;width:.75em;height:.75em; border-left: 1px solid;border-top: 1px solid;"></div><div style="top:.5em;right:.5em;width:.75em;height:.75em; border-right: 1px solid;border-top: 1px solid;"></div><div style="bottom:.5em;left:.5em;width:.75em;height:.75em; border-left: 1px solid;border-bottom: 1px solid;"></div><div style="bottom:.5em;right:.5em;width:.75em;height:.75em; border-right: 1px solid;border-bottom: 1px solid;"></div>'};var polaroid={shape:{frameColor:[1,1,1],frameStyle:'polaroid'},thumb:'<rect stroke-width="20%" x="-5%" y="-5%" width="110%" height="96%"/>'};var frameStylesDefault={solidSharp:solidSharp,solidRound:solidRound,lineSingle:lineSingle,lineMultiple:lineMultiple,edgeSeparate:edgeSeparate,edgeCross:edgeCross,edgeOverlap:edgeOverlap,hook:hook,polaroid:polaroid};var frameOptionsDefault=[[undefined,function(locale){return locale.labelNone;}],['solidSharp',function(locale){return locale.frameLabelMatSharp;}],['solidRound',function(locale){return locale.frameLabelMatRound;}],['lineSingle',function(locale){return locale.frameLabelLineSingle;}],['lineMultiple',function(locale){return locale.frameLabelLineMultiple;}],['edgeCross',function(locale){return locale.frameLabelEdgeCross;}],['edgeSeparate',function(locale){return locale.frameLabelEdgeSeparate;}],['edgeOverlap',function(locale){return locale.frameLabelEdgeOverlap;}],['hook',function(locale){return locale.frameLabelCornerHooks;}],['polaroid',function(locale){return locale.frameLabelPolaroid;}]];var _plugin_frame_defaults={frameStyles:frameStylesDefault,frameOptions:frameOptionsDefault};var RGBToHSV=function RGBToHSV(r,g,b){var v=Math.max(r,g,b),n=v-Math.min(r,g,b);var h=n&&(v==r?(g-b)/n:v==g?2+(b-r)/n:4+(r-g)/n);return[60*(h<0?h+6:h)/360,v&&n/v,v];};var HSVToRGB=function HSVToRGB(h,s,v){var r,g,b;var i=Math.floor(h*6);var f=h*6-i;var p=v*(1-s);var q=v*(1-f*s);var t=v*(1-(1-f)*s);switch(i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q;break;}return[r,g,b];};/* src/core/ui/components/ColorPreview.svelte generated by Svelte v3.52.0 */function create_fragment$w(ctx){var div;var span;var div_style_value;return{c:function c(){div=element("div");span=element("span");attr(div,"class","PinturaColorPreview");attr(div,"title",/*title*/ctx[0]);attr(div,"style",div_style_value="--color:".concat(/*colorValue*/ctx[1]));},m:function m(target,anchor){insert(target,div,anchor);append(div,span);},p:function p(ctx,_ref317){var _ref318=_slicedToArray(_ref317,1),dirty=_ref318[0];if(dirty&/*title*/1){attr(div,"title",/*title*/ctx[0]);}if(dirty&/*colorValue*/2&&div_style_value!==(div_style_value="--color:".concat(/*colorValue*/ctx[1]))){attr(div,"style",div_style_value);}},i:noop,o:noop,d:function d(detaching){if(detaching)detach(div);}};}function instance$w($$self,$$props,$$invalidate){var colorValue;var _$$props$color=$$props.color,color=_$$props$color===void 0?undefined:_$$props$color;var _$$props$title3=$$props.title,title=_$$props$title3===void 0?undefined:_$$props$title3;$$self.$$set=function($$props){if('color'in $$props)$$invalidate(2,color=$$props.color);if('title'in $$props)$$invalidate(0,title=$$props.title);};$$self.$$.update=function(){if($$self.$$.dirty&/*color*/4){$$invalidate(1,colorValue=color?colorArrayToRGBA(color):'transparent');}};return[title,colorValue,color];}var ColorPreview=/*#__PURE__*/function(_SvelteComponent22){_inherits(ColorPreview,_SvelteComponent22);var _super23=_createSuper(ColorPreview);function ColorPreview(options){var _this24;_classCallCheck(this,ColorPreview);_this24=_super23.call(this);init(_assertThisInitialized(_this24),options,instance$w,create_fragment$w,safe_not_equal,{color:2,title:0});return _this24;}return _createClass(ColorPreview);}(SvelteComponent);/* src/core/ui/components/ColorPicker.svelte generated by Svelte v3.52.0 */function create_if_block_4$4(ctx){var span;var t;return{c:function c(){span=element("span");t=text(/*label*/ctx[0]);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[0]&/*label*/1)set_data(t,/*label*/ctx[0]);},d:function d(detaching){if(detaching)detach(span);}};}// (168:4) 
function create_label_slot(ctx){var span;var colorpreview;var t;var current;colorpreview=new ColorPreview({props:{color:/*value*/ctx[4],title:localize(/*title*/ctx[8],/*locale*/ctx[10])}});var if_block=!/*hidePresetLabel*/ctx[9]&&create_if_block_4$4(ctx);return{c:function c(){span=element("span");create_component(colorpreview.$$.fragment);t=space();if(if_block)if_block.c();attr(span,"slot","label");attr(span,"class","PinturaButtonLabel");},m:function m(target,anchor){insert(target,span,anchor);mount_component(colorpreview,span,null);append(span,t);if(if_block)if_block.m(span,null);current=true;},p:function p(ctx,dirty){var colorpreview_changes={};if(dirty[0]&/*value*/16)colorpreview_changes.color=/*value*/ctx[4];if(dirty[0]&/*title, locale*/1280)colorpreview_changes.title=localize(/*title*/ctx[8],/*locale*/ctx[10]);colorpreview.$set(colorpreview_changes);if(!/*hidePresetLabel*/ctx[9]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block_4$4(ctx);if_block.c();if_block.m(span,null);}}else if(if_block){if_block.d(1);if_block=null;}},i:function i(local){if(current)return;transition_in(colorpreview.$$.fragment,local);current=true;},o:function o(local){transition_out(colorpreview.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(span);destroy_component(colorpreview);if(if_block)if_block.d();}};}// (179:8) {#if enablePicker}
function create_if_block_2$5(ctx){var div3;var div2;var div1;var div0;var div0_style_value;var div1_style_value;var div2_style_value;var t0;var slider;var t1;var current;var mounted;var dispose;slider=new Slider({props:{"class":"PinturaHuePicker",knobStyle:"background-color:".concat(/*valueAsRGBAFullySaturated*/ctx[19]),onchange:/*updateHue*/ctx[24],value:/*hue*/ctx[14],min:0,max:1,step:0.01}});var if_block=/*enableOpacity*/ctx[11]&&create_if_block_3$4(ctx);return{c:function c(){div3=element("div");div2=element("div");div1=element("div");div0=element("div");t0=space();create_component(slider.$$.fragment);t1=space();if(if_block)if_block.c();attr(div0,"role","button");attr(div0,"aria-label","Saturation slider");attr(div0,"class","PinturaPickerKnob");attr(div0,"tabindex","0");attr(div0,"style",div0_style_value="background-color:".concat(/*valueAsRGBAFullyOpaque*/ctx[18],";"));attr(div1,"class","PinturaPickerKnobController");attr(div1,"style",div1_style_value="transform:translate(".concat(/*sx*/ctx[22],"%,").concat(/*sy*/ctx[21],"%)"));attr(div2,"class","PinturaSaturationPicker");attr(div2,"style",div2_style_value="background-color: ".concat(/*valueAsRGBAFullySaturated*/ctx[19]));attr(div3,"class","PinturaPicker");},m:function m(target,anchor){insert(target,div3,anchor);append(div3,div2);append(div2,div1);append(div1,div0);/*div2_binding*/ctx[32](div2);append(div3,t0);mount_component(slider,div3,null);append(div3,t1);if(if_block)if_block.m(div3,null);current=true;if(!mounted){dispose=[listen(div0,"nudge",/*handleNudge*/ctx[27]),action_destroyer(nudgeable.call(null,div0,{preventDefault:true})),listen(div2,"pointerdown",/*handlePointerDown*/ctx[26])];mounted=true;}},p:function p(ctx,dirty){if(!current||dirty[0]&/*valueAsRGBAFullyOpaque*/262144&&div0_style_value!==(div0_style_value="background-color:".concat(/*valueAsRGBAFullyOpaque*/ctx[18],";"))){attr(div0,"style",div0_style_value);}if(!current||dirty[0]&/*sx, sy*/6291456&&div1_style_value!==(div1_style_value="transform:translate(".concat(/*sx*/ctx[22],"%,").concat(/*sy*/ctx[21],"%)"))){attr(div1,"style",div1_style_value);}if(!current||dirty[0]&/*valueAsRGBAFullySaturated*/524288&&div2_style_value!==(div2_style_value="background-color: ".concat(/*valueAsRGBAFullySaturated*/ctx[19]))){attr(div2,"style",div2_style_value);}var slider_changes={};if(dirty[0]&/*valueAsRGBAFullySaturated*/524288)slider_changes.knobStyle="background-color:".concat(/*valueAsRGBAFullySaturated*/ctx[19]);if(dirty[0]&/*hue*/16384)slider_changes.value=/*hue*/ctx[14];slider.$set(slider_changes);if(/*enableOpacity*/ctx[11]){if(if_block){if_block.p(ctx,dirty);if(dirty[0]&/*enableOpacity*/2048){transition_in(if_block,1);}}else{if_block=create_if_block_3$4(ctx);if_block.c();transition_in(if_block,1);if_block.m(div3,null);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}},i:function i(local){if(current)return;transition_in(slider.$$.fragment,local);transition_in(if_block);current=true;},o:function o(local){transition_out(slider.$$.fragment,local);transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div3);/*div2_binding*/ctx[32](null);destroy_component(slider);if(if_block)if_block.d();mounted=false;run_all(dispose);}};}// (213:16) {#if enableOpacity}
function create_if_block_3$4(ctx){var slider;var current;slider=new Slider({props:{"class":"PinturaOpacityPicker",knobStyle:"background-color:".concat(/*valueAsRGBA*/ctx[16]),trackStyle:"background-image:linear-gradient(to right,".concat(/*valueAsRGBAFullyTransparent*/ctx[17],",").concat(/*valueAsRGBAFullyOpaque*/ctx[18],")"),onchange:/*updateOpacity*/ctx[25],value:/*opacity*/ctx[15],min:0,max:1,step:0.01}});return{c:function c(){create_component(slider.$$.fragment);},m:function m(target,anchor){mount_component(slider,target,anchor);current=true;},p:function p(ctx,dirty){var slider_changes={};if(dirty[0]&/*valueAsRGBA*/65536)slider_changes.knobStyle="background-color:".concat(/*valueAsRGBA*/ctx[16]);if(dirty[0]&/*valueAsRGBAFullyTransparent, valueAsRGBAFullyOpaque*/393216)slider_changes.trackStyle="background-image:linear-gradient(to right,".concat(/*valueAsRGBAFullyTransparent*/ctx[17],",").concat(/*valueAsRGBAFullyOpaque*/ctx[18],")");if(dirty[0]&/*opacity*/32768)slider_changes.value=/*opacity*/ctx[15];slider.$set(slider_changes);},i:function i(local){if(current)return;transition_in(slider.$$.fragment,local);current=true;},o:function o(local){transition_out(slider.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(slider,detaching);}};}// (229:8) {#if enablePresets}
function create_if_block$7(ctx){var radiogroup;var current;radiogroup=new RadioGroup({props:{label:localize(/*locale*/ctx[10].labelColorPalette,/*locale*/ctx[10]),"class":arrayJoin(['PinturaColorPresets',/*hidePresetLabel*/ctx[9]?'PinturaColorPresetsGrid':'PinturaColorPresetsList']),hideLabel:false,name:/*name*/ctx[1],value:/*value*/ctx[4],optionGroupClass:"PinturaListOptionGroup",optionClass:"PinturaListOption",options:/*options*/ctx[2].map(/*func*/ctx[33]),selectedIndex:/*selectedIndex*/ctx[3],optionMapper:/*optionMapper*/ctx[7],optionLabelClass:/*optionLabelClass*/ctx[6],onchange:/*func_1*/ctx[34],$$slots:{option:[create_option_slot$4,function(_ref319){var option=_ref319.option;return{45:option};},function(_ref320){var option=_ref320.option;return[0,option?16384:0];}],group:[create_group_slot,function(_ref321){var option=_ref321.option;return{45:option};},function(_ref322){var option=_ref322.option;return[0,option?16384:0];}]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(radiogroup.$$.fragment);},m:function m(target,anchor){mount_component(radiogroup,target,anchor);current=true;},p:function p(ctx,dirty){var radiogroup_changes={};if(dirty[0]&/*locale*/1024)radiogroup_changes.label=localize(/*locale*/ctx[10].labelColorPalette,/*locale*/ctx[10]);if(dirty[0]&/*hidePresetLabel*/512)radiogroup_changes["class"]=arrayJoin(['PinturaColorPresets',/*hidePresetLabel*/ctx[9]?'PinturaColorPresetsGrid':'PinturaColorPresetsList']);if(dirty[0]&/*name*/2)radiogroup_changes.name=/*name*/ctx[1];if(dirty[0]&/*value*/16)radiogroup_changes.value=/*value*/ctx[4];if(dirty[0]&/*options, locale*/1028)radiogroup_changes.options=/*options*/ctx[2].map(/*func*/ctx[33]);if(dirty[0]&/*selectedIndex*/8)radiogroup_changes.selectedIndex=/*selectedIndex*/ctx[3];if(dirty[0]&/*optionMapper*/128)radiogroup_changes.optionMapper=/*optionMapper*/ctx[7];if(dirty[0]&/*optionLabelClass*/64)radiogroup_changes.optionLabelClass=/*optionLabelClass*/ctx[6];if(dirty[0]&/*hidePresetLabel*/512|dirty[1]&/*$$scope, option*/49152){radiogroup_changes.$$scope={dirty:dirty,ctx:ctx};}radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radiogroup,detaching);}};}// (251:16) 
function create_group_slot(ctx){var span;var t_value=/*option*/ctx[45].label+"";var t;return{c:function c(){span=element("span");t=text(t_value);attr(span,"slot","group");},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[1]&/*option*/16384&&t_value!==(t_value=/*option*/ctx[45].label+""))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (256:20) {#if !hidePresetLabel}
function create_if_block_1$6(ctx){var span;var t_value=/*option*/ctx[45].label+"";var t;return{c:function c(){span=element("span");t=text(t_value);attr(span,"class","PinturaButtonLabel");},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[1]&/*option*/16384&&t_value!==(t_value=/*option*/ctx[45].label+""))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (254:16) 
function create_option_slot$4(ctx){var span;var colorpreview;var t;var current;colorpreview=new ColorPreview({props:{title:/*option*/ctx[45].label,color:/*option*/ctx[45].value}});var if_block=!/*hidePresetLabel*/ctx[9]&&create_if_block_1$6(ctx);return{c:function c(){span=element("span");create_component(colorpreview.$$.fragment);t=space();if(if_block)if_block.c();attr(span,"slot","option");},m:function m(target,anchor){insert(target,span,anchor);mount_component(colorpreview,span,null);append(span,t);if(if_block)if_block.m(span,null);current=true;},p:function p(ctx,dirty){var colorpreview_changes={};if(dirty[1]&/*option*/16384)colorpreview_changes.title=/*option*/ctx[45].label;if(dirty[1]&/*option*/16384)colorpreview_changes.color=/*option*/ctx[45].value;colorpreview.$set(colorpreview_changes);if(!/*hidePresetLabel*/ctx[9]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block_1$6(ctx);if_block.c();if_block.m(span,null);}}else if(if_block){if_block.d(1);if_block=null;}},i:function i(local){if(current)return;transition_in(colorpreview.$$.fragment,local);current=true;},o:function o(local){transition_out(colorpreview.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(span);destroy_component(colorpreview);if(if_block)if_block.d();}};}// (177:4) 
function create_details_slot(ctx){var div;var t;var current;var if_block0=/*enablePicker*/ctx[13]&&create_if_block_2$5(ctx);var if_block1=/*enablePresets*/ctx[12]&&create_if_block$7(ctx);return{c:function c(){div=element("div");if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();attr(div,"slot","details");attr(div,"class","PinturaColorPickerPanel");},m:function m(target,anchor){insert(target,div,anchor);if(if_block0)if_block0.m(div,null);append(div,t);if(if_block1)if_block1.m(div,null);current=true;},p:function p(ctx,dirty){if(/*enablePicker*/ctx[13]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*enablePicker*/8192){transition_in(if_block0,1);}}else{if_block0=create_if_block_2$5(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(div,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*enablePresets*/ctx[12]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[0]&/*enablePresets*/4096){transition_in(if_block1,1);}}else{if_block1=create_if_block$7(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(div,null);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block0)if_block0.d();if(if_block1)if_block1.d();}};}function create_fragment$v(ctx){var panel;var current;panel=new Panel({props:{buttonClass:arrayJoin(['PinturaColorPickerButton',/*buttonClass*/ctx[5]]),$$slots:{details:[create_details_slot],label:[create_label_slot]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(panel.$$.fragment);},m:function m(target,anchor){mount_component(panel,target,anchor);current=true;},p:function p(ctx,dirty){var panel_changes={};if(dirty[0]&/*buttonClass*/32)panel_changes.buttonClass=arrayJoin(['PinturaColorPickerButton',/*buttonClass*/ctx[5]]);if(dirty[0]&/*locale, hidePresetLabel, name, value, options, selectedIndex, optionMapper, optionLabelClass, enablePresets, valueAsRGBA, valueAsRGBAFullyTransparent, valueAsRGBAFullyOpaque, opacity, enableOpacity, valueAsRGBAFullySaturated, hue, input, sx, sy, enablePicker, label, title*/8388575|dirty[1]&/*$$scope*/32768){panel_changes.$$scope={dirty:dirty,ctx:ctx};}panel.$set(panel_changes);},i:function i(local){if(current)return;transition_in(panel.$$.fragment,local);current=true;},o:function o(local){transition_out(panel.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(panel,detaching);}};}function instance$v($$self,$$props,$$invalidate){var sx;var sy;var _$$props$label4=$$props.label,label=_$$props$label4===void 0?undefined:_$$props$label4;var _$$props$name4=$$props.name,name=_$$props$name4===void 0?undefined:_$$props$name4;var _$$props$options3=$$props.options,options=_$$props$options3===void 0?[]:_$$props$options3;var _$$props$selectedInde3=$$props.selectedIndex,selectedIndex=_$$props$selectedInde3===void 0?-1:_$$props$selectedInde3;var _$$props$value4=$$props.value,value=_$$props$value4===void 0?undefined:_$$props$value4;var _$$props$buttonClass3=$$props.buttonClass,buttonClass=_$$props$buttonClass3===void 0?undefined:_$$props$buttonClass3;var _$$props$optionLabelC3=$$props.optionLabelClass,optionLabelClass=_$$props$optionLabelC3===void 0?undefined:_$$props$optionLabelC3;var _$$props$optionMapper3=$$props.optionMapper,optionMapper=_$$props$optionMapper3===void 0?undefined:_$$props$optionMapper3;var _$$props$onchange4=$$props.onchange,onchange=_$$props$onchange4===void 0?undefined:_$$props$onchange4;var _$$props$title4=$$props.title,title=_$$props$title4===void 0?undefined:_$$props$title4;var _$$props$hidePresetLa=$$props.hidePresetLabel,hidePresetLabel=_$$props$hidePresetLa===void 0?true:_$$props$hidePresetLa;var _$$props$locale4=$$props.locale,locale=_$$props$locale4===void 0?undefined:_$$props$locale4;var _$$props$enableOpacit=$$props.enableOpacity,enableOpacity=_$$props$enableOpacit===void 0?true:_$$props$enableOpacit;var _$$props$enablePreset=$$props.enablePresets,enablePresets=_$$props$enablePreset===void 0?true:_$$props$enablePreset;var _$$props$enablePicker=$$props.enablePicker,enablePicker=_$$props$enablePicker===void 0?true:_$$props$enablePicker;// inputs
var hue;var saturation;var brightness;var opacity;// shortcuts
var valueAsRGB;var valueAsRGBA;var valueAsRGBAFullyTransparent;var valueAsRGBAFullyOpaque;var valueAsRGBAFullySaturated;// remember previous value
var valuePrev;var updateProps=function updateProps(color,syncControls){valueAsRGB=[color[0],color[1],color[2]];if(syncControls){var valueAsHSV=RGBToHSV.apply(void 0,_toConsumableArray(valueAsRGB));$$invalidate(14,hue=valueAsHSV[0]);$$invalidate(29,saturation=valueAsHSV[1]);$$invalidate(30,brightness=valueAsHSV[2]);$$invalidate(15,opacity=isNumber(color[3])?color[3]:1);}$$invalidate(16,valueAsRGBA=colorArrayToRGBA(color));$$invalidate(17,valueAsRGBAFullyTransparent=colorArrayToRGBA([].concat(_toConsumableArray(valueAsRGB),[0])));$$invalidate(18,valueAsRGBAFullyOpaque=colorArrayToRGBA([].concat(_toConsumableArray(valueAsRGB),[1])));$$invalidate(19,valueAsRGBAFullySaturated=colorArrayToRGBA(HSVToRGB(hue,1,1)));};var update=function update(){var rgb=HSVToRGB(hue,saturation,brightness);var rgba=[].concat(_toConsumableArray(rgb),[opacity]);updateProps(rgba);onchange(rgba);};var updateColorArray=function updateColorArray(arr){var rgba=arr.length===3?[].concat(_toConsumableArray(arr),[1]):arr;updateProps(rgba,true);onchange(rgba);};var updateHue=function updateHue(h){$$invalidate(14,hue=h);if(opacity===0)$$invalidate(15,opacity=1);update();};var updateSaturationAndBrightness=function updateSaturationAndBrightness(s,b){$$invalidate(29,saturation=s);$$invalidate(30,brightness=b);if(opacity===0)$$invalidate(15,opacity=1);update();};var updateOpacity=function updateOpacity(o){$$invalidate(15,opacity=o);update();};var setValueByOffset=function setValueByOffset(offset,inputSize){var x=clamp(offset.x/inputSize.width,0,1);var y=clamp(offset.y/inputSize.height,0,1);updateSaturationAndBrightness(x,1-y);};var input;var inputSize;var inputOffset;var inputPageOffset;var handlePointerDown=function handlePointerDown(e){e.stopPropagation();inputSize=sizeCreate(input.offsetWidth,input.offsetHeight);inputOffset=vectorCreateFromPointerEventOffset(e);inputPageOffset=vectorCreateFromPointerEvent(e);setValueByOffset(inputOffset,inputSize);document.documentElement.addEventListener('pointermove',handlePointerMove);document.documentElement.addEventListener('pointerup',handlePointerUp);};var handlePointerMove=function handlePointerMove(e){var d=vectorSubtract(vectorCreateFromPointerEvent(e),inputPageOffset);setValueByOffset(vectorAdd(vectorClone(inputOffset),d),inputSize);};var handlePointerUp=function handlePointerUp(e){inputSize=undefined;document.documentElement.removeEventListener('pointermove',handlePointerMove);document.documentElement.removeEventListener('pointerup',handlePointerUp);};var handleNudge=function handleNudge(e){inputSize=sizeCreate(input.offsetWidth,input.offsetHeight);var x=sx/100*inputSize.width;var y=sy/100*inputSize.height;setValueByOffset({x:x+e.detail.x,y:y+e.detail.y},inputSize);};function div2_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){input=$$value;$$invalidate(20,input);});}var func=function func(_ref323){var _ref324=_slicedToArray(_ref323,2),color=_ref324[0],label=_ref324[1];return[color,isFunction(label)?label(locale):label];};var func_1=function func_1(detail){return updateColorArray(detail.value);};$$self.$$set=function($$props){if('label'in $$props)$$invalidate(0,label=$$props.label);if('name'in $$props)$$invalidate(1,name=$$props.name);if('options'in $$props)$$invalidate(2,options=$$props.options);if('selectedIndex'in $$props)$$invalidate(3,selectedIndex=$$props.selectedIndex);if('value'in $$props)$$invalidate(4,value=$$props.value);if('buttonClass'in $$props)$$invalidate(5,buttonClass=$$props.buttonClass);if('optionLabelClass'in $$props)$$invalidate(6,optionLabelClass=$$props.optionLabelClass);if('optionMapper'in $$props)$$invalidate(7,optionMapper=$$props.optionMapper);if('onchange'in $$props)$$invalidate(28,onchange=$$props.onchange);if('title'in $$props)$$invalidate(8,title=$$props.title);if('hidePresetLabel'in $$props)$$invalidate(9,hidePresetLabel=$$props.hidePresetLabel);if('locale'in $$props)$$invalidate(10,locale=$$props.locale);if('enableOpacity'in $$props)$$invalidate(11,enableOpacity=$$props.enableOpacity);if('enablePresets'in $$props)$$invalidate(12,enablePresets=$$props.enablePresets);if('enablePicker'in $$props)$$invalidate(13,enablePicker=$$props.enablePicker);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*value*/16|$$self.$$.dirty[1]&/*valuePrev*/1){// update initial value if supplied
if(value&&(!valuePrev||!arrayEqual(value,valuePrev))){$$invalidate(31,valuePrev=_toConsumableArray(value));updateProps(value,true);}}if($$self.$$.dirty[0]&/*saturation*/536870912){$$invalidate(22,sx=saturation*100);}if($$self.$$.dirty[0]&/*brightness*/1073741824){$$invalidate(21,sy=100-brightness*100);}};return[label,name,options,selectedIndex,value,buttonClass,optionLabelClass,optionMapper,title,hidePresetLabel,locale,enableOpacity,enablePresets,enablePicker,hue,opacity,valueAsRGBA,valueAsRGBAFullyTransparent,valueAsRGBAFullyOpaque,valueAsRGBAFullySaturated,input,sy,sx,updateColorArray,updateHue,updateOpacity,handlePointerDown,handleNudge,onchange,saturation,brightness,valuePrev,div2_binding,func,func_1];}var ColorPicker=/*#__PURE__*/function(_SvelteComponent23){_inherits(ColorPicker,_SvelteComponent23);var _super24=_createSuper(ColorPicker);function ColorPicker(options){var _this25;_classCallCheck(this,ColorPicker);_this25=_super24.call(this);init(_assertThisInitialized(_this25),options,instance$v,create_fragment$v,safe_not_equal,{label:0,name:1,options:2,selectedIndex:3,value:4,buttonClass:5,optionLabelClass:6,optionMapper:7,onchange:28,title:8,hidePresetLabel:9,locale:10,enableOpacity:11,enablePresets:12,enablePicker:13},null,[-1,-1]);return _this25;}return _createClass(ColorPicker);}(SvelteComponent);var upperCaseFirstLetter=function upperCaseFirstLetter(str){return str.charAt(0).toUpperCase()+str.slice(1);};var result$1=null;var canCheckFontAvailability=function canCheckFontAvailability(){if(result$1===null){if(!isBrowser())result$1=false;else{try{// if browser can detect font as non existend then it supports font checking (only chrome)
// @ts-ignore
result$1=document.fonts.check('16px TestNonExistingFont')===false;}catch(err){// if throws assume can't check
result$1=false;}}}return result$1;};var toLocaleFn=function toLocaleFn(key,localePrefix){return function(locale){return locale[localePrefix?"".concat(localePrefix).concat(upperCaseFirstLetter(key)):key];};};var mapToSizeOption=function mapToSizeOption(v){return[v,"".concat(v)];};var createLocaleMapper=function createLocaleMapper(options,localePrefix){return function(key){return[options[key],toLocaleFn(key,localePrefix)];};};var toolColorDefault=[1,0.2549,0.2118];var toolStrokeWidthDefault='0.5%';var toolStrokeColorDefault=[1,1,1,0];//#region tools
var toolShapeDefaults={eraser:function eraser(){return{eraseRadius:0};},path:function path(){return{points:[]};},line:function line(){return{x1:0,y1:0,x2:0,y2:0,disableErase:false};},rectangle:function rectangle(){return{x:0,y:0,width:0,height:0};},ellipse:function ellipse(){return{x:0,y:0,rx:0,ry:0};},text:function text(){return{x:0,y:0,text:'Text'};}};var createToolStyle=function createToolStyle(type){var shape=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var options=arguments.length>2?arguments[2]:undefined;if(!toolShapeDefaults[type])return;var _ref325=options||{},_ref325$position=_ref325.position,position=_ref325$position===void 0?'relative':_ref325$position,_ref325$inputMode=_ref325.inputMode,inputMode=_ref325$inputMode===void 0?'drag':_ref325$inputMode;var shapeDef=_objectSpread(_objectSpread({},toolShapeDefaults[type]()),shape);return[shapeDef,{position:position,inputMode:inputMode}];};var createToolStyles=function createToolStyles(tools){return _objectSpread({sharpie:createToolStyle('path',{strokeWidth:toolStrokeWidthDefault,strokeColor:[].concat(toolColorDefault),disableErase:false,disableResize:true,disableMove:true}),eraser:createToolStyle('eraser'),path:createToolStyle('path',{pathClose:undefined,strokeWidth:toolStrokeWidthDefault,strokeColor:[].concat(toolColorDefault),backgroundColor:[0,0,0,0]},{inputMode:'step'}),line:createToolStyle('line',{strokeColor:[].concat(toolColorDefault),strokeWidth:toolStrokeWidthDefault}),arrow:createToolStyle('line',{lineStart:'none',lineEnd:'arrow-solid',strokeColor:[].concat(toolColorDefault),strokeWidth:toolStrokeWidthDefault}),rectangle:createToolStyle('rectangle',{strokeColor:[].concat(toolStrokeColorDefault),backgroundColor:[].concat(toolColorDefault)}),ellipse:createToolStyle('ellipse',{strokeColor:[].concat(toolStrokeColorDefault),backgroundColor:[].concat(toolColorDefault)}),text:createToolStyle('text',{color:[].concat(toolColorDefault),fontSize:'2%'})},tools);};//#endregion
//#region toolbar
var createToolbarItem=function createToolbarItem(tool,label,props){return[tool,label||toLocaleFn(tool,'shapeLabelTool'),_objectSpread({icon:toLocaleFn(tool,'shapeIconTool')},props)];};var createToolbar=function createToolbar(){var tools=arguments.length>0&&arguments[0]!==undefined?arguments[0]:['move','view','sharpie','eraser','path','line','arrow','rectangle','ellipse','text','preset'];return tools.map(function(tool){// default tool definition, assume locale in
if(isString(tool))return createToolbarItem(tool);// tool def with propery
if(Array.isArray(tool)){// state update of tool with key in locale object
if(isObject(tool[1]))return createToolbarItem(tool[0],undefined,tool[1]);// should be string, string
return createToolbarItem(tool[0],tool[1],tool[2]);}}).filter(Boolean);};//#endregion
//#region style option defaults
var createDefaultColorOptions=function createDefaultColorOptions(){return{transparent:[1,1,1,0],white:[1,1,1],silver:[0.8667,0.8667,0.8667],gray:[0.6667,0.6667,0.6667],black:[0,0,0],navy:[0,0.1216,0.2471],blue:[0,0.4549,0.851],aqua:[0.498,0.8588,1],teal:[0.2235,0.8,0.8],olive:[0.2392,0.6,0.4392],green:[0.1804,0.8,0.251],yellow:[1,0.8627,0],orange:[1,0.5216,0.1059],red:[1,0.2549,0.2118],maroon:[0.5216,0.0784,0.2941],fuchsia:[0.9412,0.0706,0.7451],purple:[0.6941,0.051,0.7882]};};var createDefaultFontSizeOptions=function createDefaultFontSizeOptions(){return[16,18,20,24,30,36,48,64,72,96,128,144];};var createDefaultLineHeightOptions=createDefaultFontSizeOptions;var createDefaultFontScaleOptions=function createDefaultFontScaleOptions(){return{extraSmall:'2%',small:'4%',mediumSmall:'8%',medium:'10%',mediumLarge:'15%',large:'20%',extraLarge:'25%'};};var createDefaultLineHeightScaleOptions=function createDefaultLineHeightScaleOptions(){return{extraSmall:'40%',small:'60%',mediumSmall:'100%',medium:'120%',mediumLarge:'140%',large:'180%',extraLarge:'220%'};};var createDefaultStrokeWidthOptions=function createDefaultStrokeWidthOptions(){return[1,2,3,4,6,8,12,16,20,24,32,48,64];};var createDefaultStrokeScaleOptions=function createDefaultStrokeScaleOptions(){return{extraSmall:'0.25%',small:'0.5%',mediumSmall:'1%',medium:'1.75%',mediumLarge:'2.5%',large:'3.5%',extraLarge:'5%'};};var createDefaultLineEndStyleOptions=function createDefaultLineEndStyleOptions(){return['bar','arrow','arrowSolid','circle','circleSolid','square','squareSolid'];};var createDefaultFontFamilyOptions=function createDefaultFontFamilyOptions(){return[["Helvetica, Arial, Verdana, 'Droid Sans', sans-serif",'Sans Serif'],["'Arial Black', 'Avenir-Black', 'Arial Bold'",'Black'],["'Arial Narrow', 'Futura-CondensedMedium'",'Narrow'],["'Trebuchet MS'",'Humanist'],["Georgia, 'Avenir-Black', 'Times New Roman', 'Droid Serif', serif",'Serif'],["Palatino",'Old-Style'],["'Times New Roman', 'TimesNewRomanPSMT'",'Transitional'],["Menlo, Monaco, 'Lucida Console', monospace",'Monospaced'],["'Courier New', monospace",'Slab Serif']];};var createDefaultTextAlignOptions=function createDefaultTextAlignOptions(){return['left','center','right'];};var createDefaultFontStyleOptions=function createDefaultFontStyleOptions(){return[['normal','bold'],['italic','normal'],['italic','bold']];};//#endregion
//#region style options
var createColorOptions=function createColorOptions(colors){return Object.keys(colors).map(createLocaleMapper(colors,'shapeTitleColor'));};var createFontSizeOptions=function createFontSizeOptions(sizes){return sizes.map(mapToSizeOption);};var createFontScaleOptions=function createFontScaleOptions(scales){return Object.keys(scales).map(createLocaleMapper(scales,'labelSize'));};var createLineHeightOptions=function createLineHeightOptions(sizes){return sizes.map(mapToSizeOption);};var createLineHeightScaleOptions=function createLineHeightScaleOptions(scales){return Object.keys(scales).map(createLocaleMapper(scales,'labelSize'));};var createStrokeWidthOptions=function createStrokeWidthOptions(sizes){return sizes.map(mapToSizeOption);};var createStrokeScaleOptions=function createStrokeScaleOptions(scales){return Object.keys(scales).map(createLocaleMapper(scales,'labelSize'));};var createFontFamilyOptions=function createFontFamilyOptions(fonts){return _toConsumableArray(fonts);};var createFontStyleOptions=function createFontStyleOptions(styles){return styles.map(function(style){return[style,function(locale){return locale["shapeLabelFontStyle".concat(style.filter(function(v){return v!=='normal';}).map(upperCaseFirstLetter).join(''))];}];});};var createLineEndStyleOptions=function createLineEndStyleOptions(styles){return styles.map(function(style){return[toKebabCase(style),function(locale){return locale["shapeTitleLineDecoration".concat(upperCaseFirstLetter(style))];},{icon:function icon(locale){return locale["shapeIconLineDecoration".concat(upperCaseFirstLetter(style))];}}];});};var createTextAlignOptions=function createTextAlignOptions(options){return options.map(function(align){return[align,function(locale){return locale["shapeTitleTextAlign".concat(upperCaseFirstLetter(align))];},{hideLabel:true,icon:function icon(locale){return locale["shapeIconTextAlign".concat(upperCaseFirstLetter(align))];}}];});};var createControlOptions=function createControlOptions(items,options){var _ref326=options||{},defaultKey=_ref326.defaultKey,defaultValue=_ref326.defaultValue,defaultOptions=_ref326.defaultOptions;var arr=[];if(defaultKey)arr[0]=[defaultValue,function(locale){return locale[defaultKey];},_objectSpread({},defaultOptions)];return[].concat(arr,_toConsumableArray(items));};//#endregion
//#region shape style controls
var someFontsAvailableInStack=function someFontsAvailableInStack(stack){return stack.split(',').map(function(name){return name.trim();}).some(function(name){return document.fonts.check("16px ".concat(name));});};var createColorControl=function createColorControl(items){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return[ColorPicker,_objectSpread({title:function title(locale){return locale.labelColor;},options:createControlOptions(items)},options)];};var createSliderControl=function createSliderControl(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[ToggleSlider,_objectSpread({},options)];};var FontTestClass='PinturaFontTest';var createFontFamilyControl=function createFontFamilyControl(fontFamilies){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{defaultKey:'labelDefault'};return[Dropdown,{title:function title(locale){return locale.shapeTitleFontFamily;},onload:function onload(_ref327){var _ref327$options=_ref327.options,options=_ref327$options===void 0?[]:_ref327$options;// can't check for font availability so don't try
if(!canCheckFontAvailability())return;options// map to font stack (option value)
.map(function(_ref328){var _ref329=_slicedToArray(_ref328,1),stack=_ref329[0];return stack;})// filter out undefined
.filter(Boolean)// filter out fonts that are available
.filter(function(stack){return!someFontsAvailableInStack(stack);})// remaining fonts should have dom elements for future check
.forEach(function(stack){// get as id
var testId="".concat(FontTestClass,"-").concat(stack.replace(/[^a-zA-Z0-9]+/g,'').toLowerCase());// already added this tester
if(document.getElementById(testId))return;// add font tester, this triggers browser to download font
document.body.append(h('span',{textContent:' ',id:testId,"class":FontTestClass,style:"font-family:".concat(stack,";font-size:0;color:transparent;")}));});},ondestroy:function ondestroy(){// can't check for font availability so no need to clean up
if(!canCheckFontAvailability())return;// clean up testers
var testers=document.querySelectorAll('.PinturaFontTest');testers.forEach(function(tester){return tester.remove();});},optionLabelStyle:function optionLabelStyle(value){return"font-family: ".concat(value);},options:createControlOptions(fontFamilies,options),optionFilter:function optionFilter(fontFamilyOption){// don't filter if not in browser context
if(!canCheckFontAvailability())return true;// get font stack
var _fontFamilyOption=_slicedToArray(fontFamilyOption,1),stack=_fontFamilyOption[0];// allow if undefined
if(!stack)return true;// filter out fonts that aren't available
var res=someFontsAvailableInStack(stack);return res;}}];};var createBackgroundColorControl=function createBackgroundColorControl(items){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return[ColorPicker,_objectSpread({title:function title(locale){return locale.shapeTitleBackgroundColor;},options:createControlOptions(items)},options)];};var createStrokeColorControl=function createStrokeColorControl(items){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return[ColorPicker,_objectSpread({title:function title(locale){return locale.shapeTitleStrokeColor;},options:createControlOptions(items),buttonClass:'PinturaColorPickerButtonStroke',onchange:function onchange(value,shape){// get shape strokeWidth as number
var strokeWidth=shape.strokeWidth;var strokeWidthParsed=isNumber(strokeWidth)||isString(strokeWidth)?parseFloat(strokeWidth):0;// already has outline
if(strokeWidthParsed>0)return;// set outline to first stroke width
shape.strokeWidth=options&&options.defaultStrokeWidth||'0.5%';}},options)];};var createStrokeWidthControl=function createStrokeWidthControl(items){return[Dropdown,{title:function title(locale){return locale.shapeTitleStrokeWidth;},options:function options(shape){if(hasProp(shape,'backgroundColor'))return createControlOptions(items,{defaultKey:'shapeLabelStrokeNone'});return createControlOptions(items);},onchange:function onchange(value,shape){// no width selected
if(!value)return;// get shape strokeColor
var strokeColor=shape.strokeColor||[];// already has visible stroke color or has no stroke color
if(strokeColor[3])return;// duplicate color and assign to shape
var color=_toConsumableArray(strokeColor);color[3]=1;shape.strokeColor[3]=color;}}];};var createLineControl=function createLineControl(items,titleKey,optionIconStyle){return[Dropdown,{title:function title(locale){return locale[titleKey];},options:createControlOptions(items,{defaultKey:'labelNone',defaultOptions:{icon:"<g stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\".125em\"><path d=\"M5,12 H14\"/></g>"}}),optionIconStyle:optionIconStyle}];};var createLineStartStyleControl=function createLineStartStyleControl(items){return createLineControl(items,'shapeTitleLineStart',"transform: scaleX(-1)");};var createLineEndStyleControl=function createLineEndStyleControl(items){return createLineControl(items,'shapeTitleLineEnd');};var createFontColorControl=function createFontColorControl(items){return[ColorPicker,{title:function title(locale){return locale.shapeTitleTextColor;},options:createControlOptions(items)}];};var createFontStyleControl=function createFontStyleControl(items){return[Dropdown,{title:function title(locale){return locale.shapeTitleFontStyle;},optionLabelStyle:function optionLabelStyle(value){return value&&"font-style:".concat(value[0],";font-weight:").concat(value[1]);},options:createControlOptions(items,{defaultKey:'shapeLabelFontStyleNormal'})}];};var createFontSizeControl=function createFontSizeControl(items,options){// TODO: remove percentage value from this control
if(!options&&!items.find(function(_ref330){var _ref331=_slicedToArray(_ref330,1),value=_ref331[0];return value==='4%';})){options={defaultKey:'labelAuto',defaultValue:'4%'};}return[Dropdown,{title:function title(locale){return locale.shapeTitleFontSize;},options:createControlOptions(items,options)}];};var createTextAlignControl=function createTextAlignControl(items){return[RadioGroup,{title:function title(locale){return locale.shapeTitleTextAlign;},options:createControlOptions(items)}];};var createLineHeightControl=function createLineHeightControl(items,options){if(!options&&!items.find(function(_ref332){var _ref333=_slicedToArray(_ref332,1),value=_ref333[0];return value==='120%';})){options={defaultKey:'labelAuto',defaultValue:'120%'};}return[Dropdown,{title:function title(locale){return locale.shapeTitleLineHeight;},options:createControlOptions(items,options)}];};var autoFormatNumberItems=function autoFormatNumberItems(arr){return arr.map(mapToSizeOption);};var createShapeStyleControls=function createShapeStyleControls(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _options$colorOptions=options.colorOptions,colorOptions=_options$colorOptions===void 0?createColorOptions(createDefaultColorOptions()):_options$colorOptions,_options$lineEndStyle=options.lineEndStyleOptions,lineEndStyleOptions=_options$lineEndStyle===void 0?createLineEndStyleOptions(createDefaultLineEndStyleOptions()):_options$lineEndStyle,_options$fontFamilyOp=options.fontFamilyOptions,fontFamilyOptions=_options$fontFamilyOp===void 0?createFontFamilyOptions(createDefaultFontFamilyOptions()):_options$fontFamilyOp,_options$fontStyleOpt=options.fontStyleOptions,fontStyleOptions=_options$fontStyleOpt===void 0?createFontStyleOptions(createDefaultFontStyleOptions()):_options$fontStyleOpt,_options$textAlignOpt=options.textAlignOptions,textAlignOptions=_options$textAlignOpt===void 0?createTextAlignOptions(createDefaultTextAlignOptions()):_options$textAlignOpt;// these are let because we might overwrite them later when autoformatting
var _options$strokeWidthO=options.strokeWidthOptions,strokeWidthOptions=_options$strokeWidthO===void 0?createStrokeScaleOptions(createDefaultStrokeScaleOptions()):_options$strokeWidthO,_options$fontSizeOpti=options.fontSizeOptions,fontSizeOptions=_options$fontSizeOpti===void 0?createFontScaleOptions(createDefaultFontScaleOptions()):_options$fontSizeOpti,_options$lineHeightOp=options.lineHeightOptions,lineHeightOptions=_options$lineHeightOp===void 0?createLineHeightScaleOptions(createDefaultLineHeightScaleOptions()):_options$lineHeightOp;// auto format items that are all numbers
var _map=[fontSizeOptions,lineHeightOptions,strokeWidthOptions].map(function(items){if(Array.isArray(items)&&items.every(isNumber)){return autoFormatNumberItems(items);}return items;});var _map2=_slicedToArray(_map,3);fontSizeOptions=_map2[0];lineHeightOptions=_map2[1];strokeWidthOptions=_map2[2];var controls={// generic
defaultColor:colorOptions&&createColorControl(colorOptions),defaultNumber:createSliderControl(),defaultPercentage:createSliderControl({getValue:function getValue(value){return parseFloat(value);},setValue:function setValue(value){return"".concat(value,"%");},step:0.05,label:function label(value,min,max){return"".concat(Math.round(value/max*100),"%");},labelClass:'PinturaPercentageLabel'}),// shape background
backgroundColor:colorOptions&&createBackgroundColorControl(colorOptions),// line/outline
strokeColor:colorOptions&&createStrokeColorControl(colorOptions),strokeWidth:strokeWidthOptions&&createStrokeWidthControl(strokeWidthOptions),// line
lineStart:lineEndStyleOptions&&createLineStartStyleControl(lineEndStyleOptions),lineEnd:lineEndStyleOptions&&createLineEndStyleControl(lineEndStyleOptions),// text
color:colorOptions&&createFontColorControl(colorOptions),fontFamily:fontFamilyOptions&&createFontFamilyControl(fontFamilyOptions),fontStyle_fontWeight:fontStyleOptions&&createFontStyleControl(fontStyleOptions),fontSize:fontSizeOptions&&createFontSizeControl(fontSizeOptions),lineHeight:lineHeightOptions&&createLineHeightControl(lineHeightOptions),textAlign:textAlignOptions&&createTextAlignControl(textAlignOptions),// rect
cornerRadius:['defaultPercentage',{min:0,max:50,title:function title(locale){return locale.shapeTitleCornerRadius;}}],// generic options
frameColor:['defaultColor'],frameSize:['defaultPercentage',{min:0.2,max:10,title:function title(locale){return locale.labelSize;}}],frameInset:['defaultPercentage',{min:0.5,max:10,title:function title(locale){return locale.labelInset;}}],frameOffset:['defaultPercentage',{min:0.5,max:10,title:function title(locale){return locale.labelOffset;}}],frameRadius:['defaultPercentage',{min:0.5,max:10,title:function title(locale){return locale.labelRadius;}}],frameAmount:['defaultNumber',{min:1,max:5,step:1,title:function title(locale){return locale.labelAmount;}}]};// assign custom entries (eraseRadius), maybe expand in future to assign all items this way
Object.entries(options).forEach(function(_ref334){var _ref335=_slicedToArray(_ref334,2),key=_ref335[0],value=_ref335[1];if(controls[key])return;controls[key]=value;});return controls;};//#endregion
/* src/core/ui/components/Measure.svelte generated by Svelte v3.52.0 */function create_fragment$u(ctx){var div;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[4]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[3],null);return{c:function c(){div=element("div");if(default_slot)default_slot.c();attr(div,"class",/*klass*/ctx[0]);},m:function m(target,anchor){insert(target,div,anchor);if(default_slot){default_slot.m(div,null);}current=true;if(!mounted){dispose=[listen(div,"measure",function(){if(is_function(/*didMount*/ctx[1]&&/*handleResize*/ctx[2]))(/*didMount*/ctx[1]&&/*handleResize*/ctx[2]).apply(this,arguments);}),action_destroyer(measurable.call(null,div))];mounted=true;}},p:function p(new_ctx,_ref336){var _ref337=_slicedToArray(_ref336,1),dirty=_ref337[0];ctx=new_ctx;if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope*/8)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[3],!current?get_all_dirty_from_scope(/*$$scope*/ctx[3]):get_slot_changes(default_slot_template,/*$$scope*/ctx[3],dirty,null),null);}}if(!current||dirty&/*klass*/1){attr(div,"class",/*klass*/ctx[0]);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(default_slot)default_slot.d(detaching);mounted=false;run_all(dispose);}};}function instance$u($$self,$$props,$$invalidate){var _$$props$$$slots13=$$props.$$slots,slots=_$$props$$$slots13===void 0?{}:_$$props$$$slots13,$$scope=$$props.$$scope;var dispatch=createEventDispatcher();var _$$props$class14=$$props["class"],klass=_$$props$class14===void 0?null:_$$props$class14;var didMount=false;var handleResize=function handleResize(_ref338){var detail=_ref338.detail;return dispatch('measure',detail);};onMount(function(){return $$invalidate(1,didMount=true);});$$self.$$set=function($$props){if('class'in $$props)$$invalidate(0,klass=$$props["class"]);if('$$scope'in $$props)$$invalidate(3,$$scope=$$props.$$scope);};return[klass,didMount,handleResize,$$scope,slots];}var Measure=/*#__PURE__*/function(_SvelteComponent24){_inherits(Measure,_SvelteComponent24);var _super25=_createSuper(Measure);function Measure(options){var _this26;_classCallCheck(this,Measure);_this26=_super25.call(this);init(_assertThisInitialized(_this26),options,instance$u,create_fragment$u,safe_not_equal,{"class":0});return _this26;}return _createClass(Measure);}(SvelteComponent);/* src/core/ui/components/Util.svelte generated by Svelte v3.52.0 */var get_footer_slot_changes=function get_footer_slot_changes(dirty){return{};};var get_footer_slot_context=function get_footer_slot_context(ctx){return{};};var get_main_slot_changes=function get_main_slot_changes(dirty){return{};};var get_main_slot_context=function get_main_slot_context(ctx){return{};};var get_header_slot_changes=function get_header_slot_changes(dirty){return{};};var get_header_slot_context=function get_header_slot_context(ctx){return{};};// (10:0) {#if hasHeader}
function create_if_block_2$4(ctx){var div;var current;var header_slot_template=/*#slots*/ctx[4].header;var header_slot=create_slot(header_slot_template,ctx,/*$$scope*/ctx[3],get_header_slot_context);return{c:function c(){div=element("div");if(header_slot)header_slot.c();attr(div,"class","PinturaUtilHeader");},m:function m(target,anchor){insert(target,div,anchor);if(header_slot){header_slot.m(div,null);}current=true;},p:function p(ctx,dirty){if(header_slot){if(header_slot.p&&(!current||dirty&/*$$scope*/8)){update_slot_base(header_slot,header_slot_template,ctx,/*$$scope*/ctx[3],!current?get_all_dirty_from_scope(/*$$scope*/ctx[3]):get_slot_changes(header_slot_template,/*$$scope*/ctx[3],dirty,get_header_slot_changes),get_header_slot_context);}}},i:function i(local){if(current)return;transition_in(header_slot,local);current=true;},o:function o(local){transition_out(header_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(header_slot)header_slot.d(detaching);}};}// (17:22) <Measure class="PinturaStage" on:measure />
function fallback_block(ctx){var measure;var current;measure=new Measure({props:{"class":"PinturaStage"}});measure.$on("measure",/*measure_handler*/ctx[5]);return{c:function c(){create_component(measure.$$.fragment);},m:function m(target,anchor){mount_component(measure,target,anchor);current=true;},p:noop,i:function i(local){if(current)return;transition_in(measure.$$.fragment,local);current=true;},o:function o(local){transition_out(measure.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(measure,detaching);}};}// (20:0) {#if hasFooter}
function create_if_block_1$5(ctx){var div;var current;var footer_slot_template=/*#slots*/ctx[4].footer;var footer_slot=create_slot(footer_slot_template,ctx,/*$$scope*/ctx[3],get_footer_slot_context);return{c:function c(){div=element("div");if(footer_slot)footer_slot.c();attr(div,"class","PinturaUtilFooter");},m:function m(target,anchor){insert(target,div,anchor);if(footer_slot){footer_slot.m(div,null);}current=true;},p:function p(ctx,dirty){if(footer_slot){if(footer_slot.p&&(!current||dirty&/*$$scope*/8)){update_slot_base(footer_slot,footer_slot_template,ctx,/*$$scope*/ctx[3],!current?get_all_dirty_from_scope(/*$$scope*/ctx[3]):get_slot_changes(footer_slot_template,/*$$scope*/ctx[3],dirty,get_footer_slot_changes),get_footer_slot_context);}}},i:function i(local){if(current)return;transition_in(footer_slot,local);current=true;},o:function o(local){transition_out(footer_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(footer_slot)footer_slot.d(detaching);}};}function create_fragment$t(ctx){var t0;var div;var t1;var t2;var if_block2_anchor;var current;var if_block0=/*hasHeader*/ctx[1]&&create_if_block_2$4(ctx);var main_slot_template=/*#slots*/ctx[4].main;var main_slot=create_slot(main_slot_template,ctx,/*$$scope*/ctx[3],get_main_slot_context);var main_slot_or_fallback=main_slot||fallback_block(ctx);var if_block1=/*hasFooter*/ctx[2]&&create_if_block_1$5(ctx);var if_block2=false;return{c:function c(){if(if_block0)if_block0.c();t0=space();div=element("div");if(main_slot_or_fallback)main_slot_or_fallback.c();t1=space();if(if_block1)if_block1.c();t2=space();if_block2_anchor=empty();attr(div,"class","PinturaUtilMain");},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t0,anchor);insert(target,div,anchor);if(main_slot_or_fallback){main_slot_or_fallback.m(div,null);}/*div_binding*/ctx[6](div);insert(target,t1,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,t2,anchor);insert(target,if_block2_anchor,anchor);current=true;},p:function p(ctx,_ref339){var _ref340=_slicedToArray(_ref339,1),dirty=_ref340[0];if(/*hasHeader*/ctx[1]){if(if_block0){if_block0.p(ctx,dirty);if(dirty&/*hasHeader*/2){transition_in(if_block0,1);}}else{if_block0=create_if_block_2$4(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t0.parentNode,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(main_slot){if(main_slot.p&&(!current||dirty&/*$$scope*/8)){update_slot_base(main_slot,main_slot_template,ctx,/*$$scope*/ctx[3],!current?get_all_dirty_from_scope(/*$$scope*/ctx[3]):get_slot_changes(main_slot_template,/*$$scope*/ctx[3],dirty,get_main_slot_changes),get_main_slot_context);}}if(/*hasFooter*/ctx[2]){if(if_block1){if_block1.p(ctx,dirty);if(dirty&/*hasFooter*/4){transition_in(if_block1,1);}}else{if_block1=create_if_block_1$5(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(t2.parentNode,t2);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(main_slot_or_fallback,local);transition_in(if_block1);transition_in(if_block2);current=true;},o:function o(local){transition_out(if_block0);transition_out(main_slot_or_fallback,local);transition_out(if_block1);transition_out(if_block2);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t0);if(detaching)detach(div);if(main_slot_or_fallback)main_slot_or_fallback.d(detaching);/*div_binding*/ctx[6](null);if(detaching)detach(t1);if(if_block1)if_block1.d(detaching);if(detaching)detach(t2);if(detaching)detach(if_block2_anchor);}};}function instance$t($$self,$$props,$$invalidate){var _$$props11=$$props,_$$props11$$$slots=_$$props11.$$slots,slots=_$$props11$$$slots===void 0?{}:_$$props11$$$slots,$$scope=_$$props11.$$scope;var _$$props12=$$props,_$$props12$hasHeader=_$$props12.hasHeader,hasHeader=_$$props12$hasHeader===void 0?!!$$props.$$slots.header:_$$props12$hasHeader;var _$$props13=$$props,_$$props13$hasFooter=_$$props13.hasFooter,hasFooter=_$$props13$hasFooter===void 0?!!$$props.$$slots.footer:_$$props13$hasFooter;var _$$props14=$$props,_$$props14$root=_$$props14.root,root=_$$props14$root===void 0?undefined:_$$props14$root;function measure_handler(event){bubble.call(this,$$self,event);}function div_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){root=$$value;$$invalidate(0,root);});}$$self.$$set=function($$new_props){$$invalidate(7,$$props=assign(assign({},$$props),exclude_internal_props($$new_props)));if('hasHeader'in $$new_props)$$invalidate(1,hasHeader=$$new_props.hasHeader);if('hasFooter'in $$new_props)$$invalidate(2,hasFooter=$$new_props.hasFooter);if('root'in $$new_props)$$invalidate(0,root=$$new_props.root);if('$$scope'in $$new_props)$$invalidate(3,$$scope=$$new_props.$$scope);};$$props=exclude_internal_props($$props);return[root,hasHeader,hasFooter,$$scope,slots,measure_handler,div_binding];}var Util=/*#__PURE__*/function(_SvelteComponent25){_inherits(Util,_SvelteComponent25);var _super26=_createSuper(Util);function Util(options){var _this27;_classCallCheck(this,Util);_this27=_super26.call(this);init(_assertThisInitialized(_this27),options,instance$t,create_fragment$t,safe_not_equal,{hasHeader:1,hasFooter:2,root:0});return _this27;}return _createClass(Util);}(SvelteComponent);/* src/core/ui/components/RangeInput.svelte generated by Svelte v3.52.0 */function create_if_block$6(ctx){var div;var div_style_value;return{c:function c(){div=element("div");attr(div,"class","PinturaRangeInputMeter");attr(div,"style",div_style_value="transform: translateX(".concat(/*$position*/ctx[9].x-/*svgPadding*/ctx[11].x,"px) translateY(").concat(/*$position*/ctx[9].y-/*svgPadding*/ctx[11].y,"px)"));},m:function m(target,anchor){insert(target,div,anchor);div.innerHTML=/*svg*/ctx[7];},p:function p(ctx,dirty){if(dirty[0]&/*svg*/128)div.innerHTML=/*svg*/ctx[7];if(dirty[0]&/*$position*/512&&div_style_value!==(div_style_value="transform: translateX(".concat(/*$position*/ctx[9].x-/*svgPadding*/ctx[11].x,"px) translateY(").concat(/*$position*/ctx[9].y-/*svgPadding*/ctx[11].y,"px)"))){attr(div,"style",div_style_value);}},d:function d(detaching){if(detaching)detach(div);}};}function create_fragment$s(ctx){var div1;var span;var t0;var button;var t1;var button_disabled_value;var t2;var div0;var interactable_action;var mounted;var dispose;var if_block=/*$position*/ctx[9]&&create_if_block$6(ctx);return{c:function c(){div1=element("div");span=element("span");t0=space();button=element("button");t1=text(/*labelReset*/ctx[1]);t2=space();div0=element("div");if(if_block)if_block.c();attr(span,"class","PinturaRangeInputValue");attr(button,"class","PinturaRangeInputReset");attr(button,"type","button");button.disabled=button_disabled_value=/*value*/ctx[0]===/*base*/ctx[2];attr(div0,"class","PinturaRangeInputInner");attr(div0,"style",/*rangeMask*/ctx[8]);attr(div0,"data-value-limited",/*isLimited*/ctx[5]);attr(div1,"class","PinturaRangeInput");attr(div1,"tabindex","0");},m:function m(target,anchor){insert(target,div1,anchor);append(div1,span);span.innerHTML=/*valueLabel*/ctx[3];append(div1,t0);append(div1,button);append(button,t1);append(div1,t2);append(div1,div0);if(if_block)if_block.m(div0,null);if(!mounted){dispose=[listen(button,"click",/*handleReset*/ctx[16]),listen(div0,"interactionstart",/*handleDragStart*/ctx[12]),listen(div0,"interactionupdate",/*handleDragMove*/ctx[14]),listen(div0,"interactionend",/*handleDragEnd*/ctx[15]),listen(div0,"interactionrelease",/*handleDragRelease*/ctx[13]),action_destroyer(interactable_action=interactable.call(null,div0,{inertia:/*$isAnimated*/ctx[6]})),listen(div0,"measure",/*measure_handler*/ctx[36]),action_destroyer(measurable.call(null,div0)),listen(div1,"wheel",/*handleWheel*/ctx[18],{passive:false}),listen(div1,"nudge",/*handleNudge*/ctx[19]),action_destroyer(nudgeable.call(null,div1,{direction:'horizontal',preventDefault:true}))];mounted=true;}},p:function p(ctx,dirty){if(dirty[0]&/*valueLabel*/8)span.innerHTML=/*valueLabel*/ctx[3];if(dirty[0]&/*labelReset*/2)set_data(t1,/*labelReset*/ctx[1]);if(dirty[0]&/*value, base*/5&&button_disabled_value!==(button_disabled_value=/*value*/ctx[0]===/*base*/ctx[2])){button.disabled=button_disabled_value;}if(/*$position*/ctx[9]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block$6(ctx);if_block.c();if_block.m(div0,null);}}else if(if_block){if_block.d(1);if_block=null;}if(dirty[0]&/*rangeMask*/256){attr(div0,"style",/*rangeMask*/ctx[8]);}if(dirty[0]&/*isLimited*/32){attr(div0,"data-value-limited",/*isLimited*/ctx[5]);}if(interactable_action&&is_function(interactable_action.update)&&dirty[0]&/*$isAnimated*/64)interactable_action.update.call(null,{inertia:/*$isAnimated*/ctx[6]});},i:noop,o:noop,d:function d(detaching){if(detaching)detach(div1);if(if_block)if_block.d();mounted=false;run_all(dispose);}};}var radiusBig=2;// 2
var radiusSmall=0.75;// .75
var indicatorSpacing=10;var indicatorInterval=5;var indicatorCount=40;// must be even
function instance$s($$self,$$props,$$invalidate){var range;var valueMinLimited;var valueMaxLimited;var barSize;var baseFraction;var isLimited;var rangeMask;var $isAnimated;var $position;var _$$props$labelReset=$$props.labelReset,labelReset=_$$props$labelReset===void 0?'Reset':_$$props$labelReset;var _$$props$direction2=$$props.direction,direction=_$$props$direction2===void 0?'x':_$$props$direction2;var _$$props$min3=$$props.min,min=_$$props$min3===void 0?0:_$$props$min3;var _$$props$max3=$$props.max,max=_$$props$max3===void 0?1:_$$props$max3;var _$$props$base=$$props.base,base=_$$props$base===void 0?min:_$$props$base;var _$$props$value5=$$props.value,value=_$$props$value5===void 0?0:_$$props$value5;var _$$props$valueLabel=$$props.valueLabel,valueLabel=_$$props$valueLabel===void 0?0:_$$props$valueLabel;var _$$props$valueMin2=$$props.valueMin,valueMin=_$$props$valueMin2===void 0?undefined:_$$props$valueMin2;var _$$props$valueMax2=$$props.valueMax,valueMax=_$$props$valueMax2===void 0?undefined:_$$props$valueMax2;var _$$props$oninputstart=$$props.oninputstart,oninputstart=_$$props$oninputstart===void 0?noop$1:_$$props$oninputstart;var _$$props$oninputmove=$$props.oninputmove,oninputmove=_$$props$oninputmove===void 0?noop$1:_$$props$oninputmove;var _$$props$oninputend=$$props.oninputend,oninputend=_$$props$oninputend===void 0?noop$1:_$$props$oninputend;var _$$props$elasticity3=$$props.elasticity,elasticity=_$$props$elasticity3===void 0?0:_$$props$elasticity3;var _$$props$nudgeMultipl=$$props.nudgeMultiplier,nudgeMultiplier=_$$props$nudgeMultipl===void 0?undefined:_$$props$nudgeMultipl;var _$$props$step2=$$props.step,step=_$$props$step2===void 0?8:_$$props$step2;//
// context
//
var isAnimated=getContext('isAnimated');component_subscribe($$self,isAnimated,function(value){return $$invalidate(6,$isAnimated=value);});var round=function round(number,increment,offset){return Math.ceil((number-offset)/increment)*increment+offset;};var size;var svg;var svgSize;var svgPadding={x:2,y:0};var createPathCircle=function createPathCircle(cx,cy,r){return"M ".concat(cx-r," ").concat(cy," a ").concat(r," ").concat(r," 0 1 0 0 -1");};function getMask(limitedMin,limitedMax){var step=1/indicatorCount;var from=toFraction(limitedMin,min,max);var to=toFraction(limitedMax,min,max);var fromSnapped=fixPrecision(round(from,step,0)-step*0.5);var toSnapped=fixPrecision(round(to,step,0)-step*0.5);return"--range-mask-from:".concat(fromSnapped*100,"%;--range-mask-to:").concat(toSnapped*100,"%");}//
// Dragging related
//
var interactionOrigin=undefined;var interactionReleased=false;var interactionRange;var interactionOptions={snap:false,elastic:false};var handleDragStart=function handleDragStart(){interactionReleased=false;interactionOrigin=get_store_value(position);interactionRange=[valueToPosition(valueMin!=null?valueMin:min,direction),valueToPosition(valueMax!=null?valueMax:max,direction)];oninputstart();};var handleDragRelease=function handleDragRelease(){interactionReleased=true;};var handleDragMove=function handleDragMove(_ref341){var detail=_ref341.detail;interactionOptions.snap=!interactionReleased;interactionOptions.elastic=!interactionReleased;translatePosition(interactionOrigin,detail.translation,interactionOptions);};var handleDragEnd=function handleDragEnd(_ref342){var detail=_ref342.detail;interactionOptions.snap=false;interactionOptions.elastic=false;var valueAtPosition=translatePosition(interactionOrigin,detail.translation,interactionOptions);interactionOrigin=undefined;interactionRange=undefined;// if is near base position, set to base
if(Math.abs(valueAtPosition-base)<0.01)return oninputend(base);oninputend(valueAtPosition);};var translatePosition=function translatePosition(origin,translation,options){var target=origin[direction]+translation[direction];var targetLimited=clamp(target,interactionRange[1][direction],interactionRange[0][direction]);var targetElastic=elasticity?targetLimited+elastify(target-targetLimited,elasticity):targetLimited;var targetVisual=options.elastic?targetElastic:targetLimited;// set position
var targetValid=vectorCreate(0,0);targetValid[direction]=targetVisual;position.set(targetValid,{hard:options.snap});return clamp(positionToValue(targetValid,direction),min,max);};var handleReset=function handleReset(){$$invalidate(0,value=clamp(base,valueMinLimited,valueMaxLimited));oninputstart();oninputend(value);};//
// Meter position and value updates
//
var position=spring();component_subscribe($$self,position,function(value){return $$invalidate(9,$position=value);});var valueToPosition=function valueToPosition(value,axis){var offset=(size[axis]-barSize[axis])*0.5;var fraction=toFraction(value,min,max);var v=fraction*barSize[axis]-barSize[axis]*0.5;var pos=offset-v;return{x:axis==='x'?pos:0,y:axis==='y'?pos:0};};var positionToValue=function positionToValue(position,axis){var dist=position[axis]-size[axis]*0.5;var fraction=-(dist/barSize[axis]);return min+fraction*range;};var positionUnsub=position.subscribe(function(currentPosition){// if not positioned yet or is not interacting we're not interested in this event
if(!currentPosition||!interactionOrigin)return;oninputmove(clamp(positionToValue(currentPosition,direction),min,max));});var updatePosition=function updatePosition(value){var interactionRange=[valueToPosition(valueMin!=null?valueMin:min,direction),valueToPosition(valueMax!=null?valueMax:max,direction)];var target={x:direction==='x'?$position.x+value:0,y:direction==='y'?$position.y+value:0};var targetLimited=clamp(target[direction],interactionRange[1][direction],interactionRange[0][direction]);var positionTarget=_objectSpread(_objectSpread({},$position),{},_defineProperty({},direction,targetLimited));set_store_value(position,$position=positionTarget,$position);var result=clamp(positionToValue(positionTarget,direction),min,max);oninputstart();oninputmove(result);oninputend(result);};var handleWheel=function handleWheel(e){// don't run default actions, prevent other actions from running
e.preventDefault();e.stopPropagation();// apply wheel delta to offset
var delta=getWheelDelta(e)*step;updatePosition(delta);};var handleNudge=function handleNudge(_ref343){var detail=_ref343.detail;updatePosition(detail[direction]*Math.abs(nudgeMultiplier||8));};onDestroy(function(){positionUnsub();});var measure_handler=function measure_handler(e){return $$invalidate(4,size=vectorCreateFromSize(e.detail));};$$self.$$set=function($$props){if('labelReset'in $$props)$$invalidate(1,labelReset=$$props.labelReset);if('direction'in $$props)$$invalidate(20,direction=$$props.direction);if('min'in $$props)$$invalidate(21,min=$$props.min);if('max'in $$props)$$invalidate(22,max=$$props.max);if('base'in $$props)$$invalidate(2,base=$$props.base);if('value'in $$props)$$invalidate(0,value=$$props.value);if('valueLabel'in $$props)$$invalidate(3,valueLabel=$$props.valueLabel);if('valueMin'in $$props)$$invalidate(23,valueMin=$$props.valueMin);if('valueMax'in $$props)$$invalidate(24,valueMax=$$props.valueMax);if('oninputstart'in $$props)$$invalidate(25,oninputstart=$$props.oninputstart);if('oninputmove'in $$props)$$invalidate(26,oninputmove=$$props.oninputmove);if('oninputend'in $$props)$$invalidate(27,oninputend=$$props.oninputend);if('elasticity'in $$props)$$invalidate(28,elasticity=$$props.elasticity);if('nudgeMultiplier'in $$props)$$invalidate(29,nudgeMultiplier=$$props.nudgeMultiplier);if('step'in $$props)$$invalidate(30,step=$$props.step);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*max, min*/6291456){//
// derived
//
$$invalidate(32,range=max-min);}if($$self.$$.dirty[0]&/*valueMin, min*/10485760){$$invalidate(34,valueMinLimited=valueMin!=null?Math.max(valueMin,min):min);}if($$self.$$.dirty[0]&/*valueMax, max*/20971520){$$invalidate(33,valueMaxLimited=valueMax!=null?Math.min(valueMax,max):max);}if($$self.$$.dirty[0]&/*base, min, max*/6291460){$$invalidate(35,baseFraction=toFraction(base,min,max));}if($$self.$$.dirty[0]&/*size*/16|$$self.$$.dirty[1]&/*baseFraction*/16){if(size){var centerY=size.y*0.5;var indicatorCenter=indicatorCount*baseFraction;var d='';var svgWidth;var svgHeight=size.y;var centerShape='';for(var i=0;i<=indicatorCount;i++){var _x96=svgPadding.x+i*indicatorSpacing;var _y3=centerY;var _r7=i%indicatorInterval===0?radiusBig:radiusSmall;d+=createPathCircle(_x96,_y3,_r7)+' ';svgWidth=_x96+svgPadding.x;if(i===indicatorCenter){centerShape="<path d=\"M".concat(_x96," ").concat(_y3-4," l2 3 l-2 -1 l-2 1 z\"/>");}}$$invalidate(7,svg="<svg width=\"".concat(svgWidth,"\" height=\"").concat(svgHeight,"\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 ").concat(svgWidth," ").concat(svgHeight,"\" aria-hidden=\"true\" focusable=\"false\">\n        ").concat(centerShape,"\n        <rect rx=\"4\" ry=\"4\" y=\"").concat(centerY-4,"\"\" height=\"8\"/>\n        <path fill-rule=\"evenodd\" d=\"").concat(d.trim(),"\"/></svg>"));$$invalidate(31,svgSize={x:svgWidth-svgPadding.x*2,y:svgHeight});}}if($$self.$$.dirty[0]&/*size*/16|$$self.$$.dirty[1]&/*svgSize*/1){barSize=size&&svgSize;}if($$self.$$.dirty[0]&/*min, max*/6291456|$$self.$$.dirty[1]&/*valueMinLimited, valueMaxLimited*/12){$$invalidate(5,isLimited=valueMinLimited!==min||valueMaxLimited!==max);}if($$self.$$.dirty[0]&/*isLimited*/32|$$self.$$.dirty[1]&/*valueMinLimited, valueMaxLimited*/12){$$invalidate(8,rangeMask=isLimited?getMask(valueMinLimited,valueMaxLimited):'');}if($$self.$$.dirty[0]&/*size, value, direction, $isAnimated*/1048657|$$self.$$.dirty[1]&/*range*/2){// if has size (range is in here so the position is updated if the range is changed)
if(range&&size&&size.x&&size.y){position.set(valueToPosition(value,direction),{hard:$isAnimated===false});}}};return[value,labelReset,base,valueLabel,size,isLimited,$isAnimated,svg,rangeMask,$position,isAnimated,svgPadding,handleDragStart,handleDragRelease,handleDragMove,handleDragEnd,handleReset,position,handleWheel,handleNudge,direction,min,max,valueMin,valueMax,oninputstart,oninputmove,oninputend,elasticity,nudgeMultiplier,step,svgSize,range,valueMaxLimited,valueMinLimited,baseFraction,measure_handler];}var RangeInput=/*#__PURE__*/function(_SvelteComponent26){_inherits(RangeInput,_SvelteComponent26);var _super27=_createSuper(RangeInput);function RangeInput(options){var _this28;_classCallCheck(this,RangeInput);_this28=_super27.call(this);init(_assertThisInitialized(_this28),options,instance$s,create_fragment$s,safe_not_equal,{labelReset:1,direction:20,min:21,max:22,base:2,value:0,valueLabel:3,valueMin:23,valueMax:24,oninputstart:25,oninputmove:26,oninputend:27,elasticity:28,nudgeMultiplier:29,step:30},null,[-1,-1]);return _this28;}return _createClass(RangeInput);}(SvelteComponent);/* src/core/ui/components/Toolbar.svelte generated by Svelte v3.52.0 */function create_fragment$r(ctx){var div1;var div0;var current;var mounted;var dispose;var default_slot_template=/*#slots*/ctx[7]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[6],null);return{c:function c(){div1=element("div");div0=element("div");if(default_slot)default_slot.c();attr(div0,"class","PinturaToolbarInner");attr(div1,"class","PinturaToolbar");attr(div1,"data-layout",/*layout*/ctx[1]);attr(div1,"data-overflow",/*overflow*/ctx[0]);},m:function m(target,anchor){insert(target,div1,anchor);append(div1,div0);if(default_slot){default_slot.m(div0,null);}current=true;if(!mounted){dispose=[listen(div0,"measure",/*handleChildResizeEvent*/ctx[3]),action_destroyer(measurable.call(null,div0)),listen(div1,"measure",/*handleParentResizeEvent*/ctx[2]),action_destroyer(measurable.call(null,div1))];mounted=true;}},p:function p(ctx,_ref344){var _ref345=_slicedToArray(_ref344,1),dirty=_ref345[0];if(default_slot){if(default_slot.p&&(!current||dirty&/*$$scope*/64)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[6],!current?get_all_dirty_from_scope(/*$$scope*/ctx[6]):get_slot_changes(default_slot_template,/*$$scope*/ctx[6],dirty,null),null);}}if(!current||dirty&/*layout*/2){attr(div1,"data-layout",/*layout*/ctx[1]);}if(!current||dirty&/*overflow*/1){attr(div1,"data-overflow",/*overflow*/ctx[0]);}},i:function i(local){if(current)return;transition_in(default_slot,local);current=true;},o:function o(local){transition_out(default_slot,local);current=false;},d:function d(detaching){if(detaching)detach(div1);if(default_slot)default_slot.d(detaching);mounted=false;run_all(dispose);}};}function instance$r($$self,$$props,$$invalidate){var layout;var _$$props$$$slots14=$$props.$$slots,slots=_$$props$$$slots14===void 0?{}:_$$props$$$slots14,$$scope=$$props.$$scope;var childWidth=0;var childMaxWidth=0;var parentWidth=0;var overflow;var testOverflow=function testOverflow(){$$invalidate(0,overflow=layout==='compact'&&childWidth>parentWidth?'overflow':undefined);};var handleParentResizeEvent=function handleParentResizeEvent(_ref346){var detail=_ref346.detail;var width=detail.width;$$invalidate(5,parentWidth=width);testOverflow();};var handleChildResizeEvent=function handleChildResizeEvent(_ref347){var detail=_ref347.detail;var width=detail.width;if(width>childMaxWidth){$$invalidate(4,childMaxWidth=width);}childWidth=width;if(!overflow)testOverflow();};$$self.$$set=function($$props){if('$$scope'in $$props)$$invalidate(6,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty&/*childMaxWidth, parentWidth*/48){$$invalidate(1,layout=childMaxWidth>parentWidth?'compact':'default');}};return[overflow,layout,handleParentResizeEvent,handleChildResizeEvent,childMaxWidth,parentWidth,$$scope,slots];}var Toolbar=/*#__PURE__*/function(_SvelteComponent27){_inherits(Toolbar,_SvelteComponent27);var _super28=_createSuper(Toolbar);function Toolbar(options){var _this29;_classCallCheck(this,Toolbar);_this29=_super28.call(this);init(_assertThisInitialized(_this29),options,instance$r,create_fragment$r,safe_not_equal,{});return _this29;}return _createClass(Toolbar);}(SvelteComponent);var DirectionRectMap=(_DirectionRectMap={},_defineProperty(_DirectionRectMap,Top,function(rect){return{x:rect.x,y:rect.y};}),_defineProperty(_DirectionRectMap,TopRight,function(rect){return{x:rect.x+rect.width,y:rect.y};}),_defineProperty(_DirectionRectMap,Right,function(rect){return{x:rect.x+rect.width,y:rect.y};}),_defineProperty(_DirectionRectMap,BottomRight,function(rect){return{x:rect.x+rect.width,y:rect.y+rect.height};}),_defineProperty(_DirectionRectMap,Bottom,function(rect){return{x:rect.x,y:rect.y+rect.height};}),_defineProperty(_DirectionRectMap,BottomLeft,function(rect){return{x:rect.x,y:rect.y+rect.height};}),_defineProperty(_DirectionRectMap,Left,function(rect){return{x:rect.x,y:rect.y};}),_defineProperty(_DirectionRectMap,TopLeft,function(rect){return{x:rect.x,y:rect.y};}),_DirectionRectMap);/* src/core/ui/components/RectManipulator.svelte generated by Svelte v3.52.0 */function get_each_context$5(ctx,list,i){var child_ctx=ctx.slice();child_ctx[14]=list[i].key;child_ctx[15]=list[i].translate;child_ctx[16]=list[i].scale;child_ctx[17]=list[i].type;child_ctx[18]=list[i].opacity;return child_ctx;}// (110:0) {#each mappedDirections as { key, translate, scale, type, opacity }
function create_each_block$5(key_1,ctx){var div;var div_aria_label_value;var div_tabindex_value;var div_data_direction_value;var div_data_shape_value;var div_style_value;var mounted;var dispose;return{key:key_1,first:null,c:function c(){div=element("div");attr(div,"role","button");attr(div,"aria-label",div_aria_label_value="Drag ".concat(/*type*/ctx[17]," ").concat(/*key*/ctx[14]));attr(div,"tabindex",div_tabindex_value=/*type*/ctx[17]==='edge'?-1:0);attr(div,"class","PinturaRectManipulator");attr(div,"data-direction",div_data_direction_value=/*key*/ctx[14]);attr(div,"data-shape",div_data_shape_value="".concat(/*type*/ctx[17]==='edge'?'edge':"".concat(/*style*/ctx[0])));attr(div,"style",div_style_value="--tx:".concat(/*translate*/ctx[15].x,";--ty:").concat(/*translate*/ctx[15].y,";--sx:").concat(/*scale*/ctx[16].x,";--sy:").concat(/*scale*/ctx[16].y,";opacity:").concat(/*opacity*/ctx[18]));this.first=div;},m:function m(target,anchor){insert(target,div,anchor);if(!mounted){dispose=[listen(div,"nudge",function(){if(is_function(/*nudge*/ctx[6](/*key*/ctx[14])))/*nudge*/ctx[6](/*key*/ctx[14]).apply(this,arguments);}),action_destroyer(nudgeable.call(null,div,{preventDefault:true})),listen(div,"interactionstart",function(){if(is_function(/*route*/ctx[5]('resizestart',/*key*/ctx[14])))/*route*/ctx[5]('resizestart',/*key*/ctx[14]).apply(this,arguments);}),listen(div,"interactionupdate",function(){if(is_function(/*route*/ctx[5]('resizemove',/*key*/ctx[14])))/*route*/ctx[5]('resizemove',/*key*/ctx[14]).apply(this,arguments);}),listen(div,"interactionend",function(){if(is_function(/*route*/ctx[5]('resizeend',/*key*/ctx[14])))/*route*/ctx[5]('resizeend',/*key*/ctx[14]).apply(this,arguments);}),action_destroyer(interactable.call(null,div))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(dirty&/*mappedDirections*/2&&div_aria_label_value!==(div_aria_label_value="Drag ".concat(/*type*/ctx[17]," ").concat(/*key*/ctx[14]))){attr(div,"aria-label",div_aria_label_value);}if(dirty&/*mappedDirections*/2&&div_tabindex_value!==(div_tabindex_value=/*type*/ctx[17]==='edge'?-1:0)){attr(div,"tabindex",div_tabindex_value);}if(dirty&/*mappedDirections*/2&&div_data_direction_value!==(div_data_direction_value=/*key*/ctx[14])){attr(div,"data-direction",div_data_direction_value);}if(dirty&/*mappedDirections, style*/3&&div_data_shape_value!==(div_data_shape_value="".concat(/*type*/ctx[17]==='edge'?'edge':"".concat(/*style*/ctx[0])))){attr(div,"data-shape",div_data_shape_value);}if(dirty&/*mappedDirections*/2&&div_style_value!==(div_style_value="--tx:".concat(/*translate*/ctx[15].x,";--ty:").concat(/*translate*/ctx[15].y,";--sx:").concat(/*scale*/ctx[16].x,";--sy:").concat(/*scale*/ctx[16].y,";opacity:").concat(/*opacity*/ctx[18]))){attr(div,"style",div_style_value);}},d:function d(detaching){if(detaching)detach(div);mounted=false;run_all(dispose);}};}function create_fragment$q(ctx){var each_blocks=[];var each_1_lookup=new Map();var each_1_anchor;var each_value=/*mappedDirections*/ctx[1];var get_key=function get_key(ctx){return(/*key*/ctx[14]);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$5(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$5(key,child_ctx));}return{c:function c(){for(var _i27=0;_i27<each_blocks.length;_i27+=1){each_blocks[_i27].c();}each_1_anchor=empty();},m:function m(target,anchor){for(var _i28=0;_i28<each_blocks.length;_i28+=1){each_blocks[_i28].m(target,anchor);}insert(target,each_1_anchor,anchor);},p:function p(ctx,_ref348){var _ref349=_slicedToArray(_ref348,1),dirty=_ref349[0];if(dirty&/*mappedDirections, style, nudge, route*/99){each_value=/*mappedDirections*/ctx[1];each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value,each_1_lookup,each_1_anchor.parentNode,destroy_block,create_each_block$5,each_1_anchor,get_each_context$5);}},i:noop,o:noop,d:function d(detaching){for(var _i29=0;_i29<each_blocks.length;_i29+=1){each_blocks[_i29].d(detaching);}if(detaching)detach(each_1_anchor);}};}function instance$q($$self,$$props,$$invalidate){var mappedDirections;var $selectionOpacity;var $selectionScale;var $isAnimated;var _$$props$rect=$$props.rect,rect=_$$props$rect===void 0?null:_$$props$rect;var _$$props$visible2=$$props.visible,visible=_$$props$visible2===void 0?false:_$$props$visible2;var _$$props$style4=$$props.style,style=_$$props$style4===void 0?undefined:_$$props$style4;// contex
var isAnimated=getContext('isAnimated');component_subscribe($$self,isAnimated,function(value){return $$invalidate(11,$isAnimated=value);});// is `undefined` to prevent bounce when first rendering view
var selectionScale=spring(undefined,{precision:0.0001,stiffness:0.2,damping:0.4});component_subscribe($$self,selectionScale,function(value){return $$invalidate(10,$selectionScale=value);});var selectionOpacity=spring(0,{precision:0.001});component_subscribe($$self,selectionOpacity,function(value){return $$invalidate(9,$selectionOpacity=value);});//
// dragging
//
var currentDirection;var dispatch=createEventDispatcher();var route=function route(type,direction){return function(_ref350){var detail=_ref350.detail;// don't handle other interactions while manipulating on axis
if(currentDirection&&direction!==currentDirection)return;// ignore move and end events if no direction has been set
if(type!=='resizestart'&&currentDirection===undefined)return;// set new direction
if(type==='resizestart')currentDirection=direction;// release direction
if(type==='resizeend')currentDirection=undefined;dispatch(type,{direction:direction,translation:detail&&detail.translation});};};var nudge=function nudge(direction){return function(_ref351){var detail=_ref351.detail;dispatch("resizestart",{direction:direction,translation:{x:0,y:0}});dispatch("resizemove",{direction:direction,translation:detail});dispatch("resizeend",{direction:direction,translation:{x:0,y:0}});};};$$self.$$set=function($$props){if('rect'in $$props)$$invalidate(7,rect=$$props.rect);if('visible'in $$props)$$invalidate(8,visible=$$props.visible);if('style'in $$props)$$invalidate(0,style=$$props.style);};$$self.$$.update=function(){if($$self.$$.dirty&/*visible, $isAnimated*/2304){selectionScale.set(visible?1:0.5,{hard:$isAnimated===false});}if($$self.$$.dirty&/*visible, $isAnimated*/2304){selectionOpacity.set(visible?1:0,{hard:$isAnimated===false});}if($$self.$$.dirty&/*rect, $selectionScale, $selectionOpacity*/1664){//
// rendering
//
$$invalidate(1,mappedDirections=Object.keys(Direction).map(function(key,i){// get direction enum
var direction=Direction[key];// get position from direction
var position=DirectionRectMap[direction](rect);// corner or edge
var type=direction.length===1?'edge':'corner';var isCorner=type==='corner';return{key:direction,type:type,scale:{x:/^(t|b)$/.test(direction)?rect.width:isCorner?clamp($selectionScale,0.5,1.25):1,y:/^(r|l)$/.test(direction)?rect.height:isCorner?clamp($selectionScale,0.5,1.25):1},translate:{x:position.x,y:position.y},opacity:$selectionOpacity};}));}};return[style,mappedDirections,isAnimated,selectionScale,selectionOpacity,route,nudge,rect,visible,$selectionOpacity,$selectionScale,$isAnimated];}var RectManipulator=/*#__PURE__*/function(_SvelteComponent28){_inherits(RectManipulator,_SvelteComponent28);var _super29=_createSuper(RectManipulator);function RectManipulator(options){var _this30;_classCallCheck(this,RectManipulator);_this30=_super29.call(this);init(_assertThisInitialized(_this30),options,instance$q,create_fragment$q,safe_not_equal,{rect:7,visible:8,style:0});return _this30;}return _createClass(RectManipulator);}(SvelteComponent);var gesturable=function gesturable(element){function dispatch(type,detail){element.dispatchEvent(new CustomEvent(type,{detail:detail}));}var handleGestureStart=function handleGestureStart(e){e.preventDefault();element.addEventListener('gesturechange',handleGestureChange);element.addEventListener('gestureend',handleGestureEnd);dispatch('gesturedown');};var handleGestureChange=function handleGestureChange(e){e.preventDefault();dispatch('gestureupdate',e.scale);};var handleGestureEnd=function handleGestureEnd(e){dispatch('gestureup',e.scale);e.preventDefault();clean();};var clean=function clean(){element.removeEventListener('gesturechange',handleGestureChange);element.removeEventListener('gestureend',handleGestureEnd);};element.addEventListener('gesturestart',handleGestureStart);return{destroy:function destroy(){clean();element.removeEventListener('gesturestart',handleGestureStart);}};};var DirectionInversionTable=(_DirectionInversionTa={},_defineProperty(_DirectionInversionTa,Top,Bottom),_defineProperty(_DirectionInversionTa,Right,Left),_defineProperty(_DirectionInversionTa,Bottom,Top),_defineProperty(_DirectionInversionTa,Left,Right),_defineProperty(_DirectionInversionTa,TopLeft,BottomRight),_defineProperty(_DirectionInversionTa,TopRight,BottomLeft),_defineProperty(_DirectionInversionTa,BottomRight,TopLeft),_defineProperty(_DirectionInversionTa,BottomLeft,TopRight),_DirectionInversionTa);var getTranslationInfo=function getTranslationInfo(target){var translateToRight=target===Right||target===TopRight||target===BottomRight;var translateToLeft=target===Left||target===BottomLeft||target===TopLeft;var translateToTop=target===Top||target===TopRight||target===TopLeft;var translateToBottom=target===Bottom||target===BottomRight||target===BottomLeft;var translateHorizontally=target===Left||target===Right;var translateVertically=target===Top||target===Bottom;var translateAxis=translateHorizontally||translateVertically;return[translateToRight,translateToLeft,translateToTop,translateToBottom,translateHorizontally,translateVertically,translateAxis];};var limitRectDirectionTranslation=function limitRectDirectionTranslation(rect,transform,bounds){var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};// the transforms to apply
var target=transform.target,translate=transform.translate;// the transform requirements
var aspectRatio=options.aspectRatio,minSize=options.minSize,maxSize=options.maxSize;// get anchor coordinates and x,y position we need this for relative scaling of the view rectangle
var anchor=DirectionInversionTable[target];var anchorDirectionCoordinates=DirectionCoordinateTable[anchor];var anchorPosition=vectorAdd(vectorCreate(rect.x,rect.y),vectorCreate(anchorDirectionCoordinates[0]*rect.width,anchorDirectionCoordinates[1]*rect.height));// get coordinate of direction
var targetDirectionCoordinates=DirectionCoordinateTable[target];var targetPosition=vectorAdd(rectClone$1(rect),vectorCreate(targetDirectionCoordinates[0]*rect.width,targetDirectionCoordinates[1]*rect.height));// bools to determine which direction the interaction is moving in
var _getTranslationInfo=getTranslationInfo(target),_getTranslationInfo2=_slicedToArray(_getTranslationInfo,7),translateToRight=_getTranslationInfo2[0],translateToLeft=_getTranslationInfo2[1],translateToTop=_getTranslationInfo2[2],translateToBottom=_getTranslationInfo2[3],translateHorizontally=_getTranslationInfo2[4],translateVertically=_getTranslationInfo2[5],translateAxis=_getTranslationInfo2[6];var tx=translate.x;var ty=translate.y;if(translateHorizontally)ty=0;else if(translateVertically)tx=0;var _getInteractionBounds=getInteractionBounds(anchorPosition,target,bounds,{aspectRatio:aspectRatio,minSize:minSize,maxSize:maxSize}),innerBounds=_getInteractionBounds.inner,outerBounds=_getInteractionBounds.outer;// current bounds
var _rectToBounds5=rectToBounds(rect),_rectToBounds6=_slicedToArray(_rectToBounds5,4),t=_rectToBounds6[0],r=_rectToBounds6[1],b=_rectToBounds6[2],l=_rectToBounds6[3];// update view bounds with anchor based on translation direction (one side is always locked)
if(translateToRight)l=anchorPosition.x;else if(translateToLeft)r=anchorPosition.x;if(translateToBottom)t=anchorPosition.y;else if(translateToTop)b=anchorPosition.y;// update view bounds with interaction limits
if(translateToRight){var innerR=innerBounds.x+innerBounds.width;var outerR=outerBounds.x+outerBounds.width;r=clamp(targetPosition.x+tx,innerR,outerR);}else if(translateToLeft){var innerL=outerBounds.x;var outerL=innerBounds.x;l=clamp(targetPosition.x+tx,innerL,outerL);}if(translateToBottom){var innerB=innerBounds.y+innerBounds.height;var outerB=outerBounds.y+outerBounds.height;b=clamp(targetPosition.y+ty,innerB,outerB);}else if(translateToTop){var innerT=outerBounds.y;var outerT=innerBounds.y;t=clamp(targetPosition.y+ty,innerT,outerT);}// min size is respected
if(l>innerBounds.x){l=innerBounds.x;}if(r<innerBounds.x+innerBounds.width){r=innerBounds.x+innerBounds.width;}if(t>innerBounds.y){t=innerBounds.y;}if(b<innerBounds.y+innerBounds.height){b=innerBounds.y+innerBounds.height;}// max size is respected
if(l<outerBounds.x){var dx=outerBounds.x-l;l=outerBounds.x;r+=dx;}if(r>outerBounds.x+outerBounds.width){var _dx=r-(outerBounds.x+outerBounds.width);r=outerBounds.x+outerBounds.width;l-=_dx;}if(t<outerBounds.y){var dy=outerBounds.y-t;t=outerBounds.y;b+=dy;}if(b>outerBounds.y+outerBounds.height){var _dy=b-(outerBounds.y+outerBounds.height);b=outerBounds.y+outerBounds.height;t-=_dy;}// if aspect ratio is set we need to scale both axis
if(aspectRatio){// if translating over horizontal or vertical axis we need to update the other axis based on the aspect ratio as well
if(translateAxis){var _dx2=r-l;var _dy2=b-t;if(translateHorizontally){_dy2=_dx2/aspectRatio;t=anchorPosition.y-_dy2*0.5;b=anchorPosition.y+_dy2*0.5;}else if(translateVertically){_dx2=_dy2*aspectRatio;l=anchorPosition.x-_dx2*0.5;r=anchorPosition.x+_dx2*0.5;}}// we're translating one of the corners in both the x and y direction, need to make sure it conforms to aspect ratio
else{var pointer=vectorCreate(targetPosition.x+tx-anchorPosition.x,targetPosition.y+ty-anchorPosition.y);// translations cannot be inverted, limited by anchor position
if(target===TopRight){pointer.x=Math.max(0,pointer.x);pointer.y=Math.min(0,pointer.y);}else if(target===BottomRight){pointer.x=Math.max(0,pointer.x);pointer.y=Math.max(0,pointer.y);}else if(target===BottomLeft){pointer.x=Math.min(0,pointer.x);pointer.y=Math.max(0,pointer.y);}else if(target===TopLeft){pointer.x=Math.min(0,pointer.x);pointer.y=Math.min(0,pointer.y);}// calculate the translation pointer, then get its length, now create a new pointer based on the aspect ratio, and scale it based on the original (limited) length
var pointerLength=vectorLength(pointer);var pointerLengthMin=vectorLength(vectorCreate(innerBounds.width,innerBounds.height));var pointerLengthMax=vectorLength(vectorCreate(outerBounds.width,outerBounds.height));var pointerLengthLimited=clamp(pointerLength,pointerLengthMin,pointerLengthMax);var pointerAspectRatio=vectorCreate(aspectRatio,1);var pointerScaled=vectorMultiply(vectorNormalize(pointerAspectRatio),pointerLengthLimited);if(target===TopRight){r=anchorPosition.x+pointerScaled.x;t=anchorPosition.y-pointerScaled.y;}else if(target===BottomRight){r=anchorPosition.x+pointerScaled.x;b=anchorPosition.y+pointerScaled.y;}else if(target===BottomLeft){l=anchorPosition.x-pointerScaled.x;b=anchorPosition.y+pointerScaled.y;}else if(target===TopLeft){l=anchorPosition.x-pointerScaled.x;t=anchorPosition.y-pointerScaled.y;}}}return rectCreate(l,t,r-l,b-t);};var getInteractionBounds=function getInteractionBounds(anchor,dir,bounds,options){var aspectRatio=options.aspectRatio,minSize=options.minSize,maxSize=options.maxSize;var translateToRight=dir===Right||dir===TopRight||dir===BottomRight;var translateToLeft=dir===Left||dir===BottomLeft||dir===TopLeft;var translateToTop=dir===Top||dir===TopRight||dir===TopLeft;var translateToBottom=dir===Bottom||dir===BottomRight||dir===BottomLeft;var translateHorizontally=dir===Left||dir===Right;var translateVertically=dir===Top||dir===Bottom;// limit bounds based on anchor and direction
var limitedBounds=rectClone$1(bounds);if(translateToRight){limitedBounds.x=anchor.x;limitedBounds.width-=anchor.x;}else if(translateToLeft){limitedBounds.width=anchor.x;}if(translateToBottom){limitedBounds.y=anchor.y;limitedBounds.height-=anchor.y;}else if(translateToTop){limitedBounds.height=anchor.y;}// limit max size based on bounds
var maxSizeLimitedToBounds=rectCreateFromDimensions(Math.min(limitedBounds.width,maxSize.width),Math.min(limitedBounds.height,maxSize.height));if(aspectRatio){// limit height
if(translateHorizontally){var verticalSpace=Math.min(anchor.y,bounds.height-anchor.y);maxSizeLimitedToBounds.height=Math.min(verticalSpace*2,maxSizeLimitedToBounds.height);}// limit width
else if(translateVertically){var horizontalSpace=Math.min(anchor.x,bounds.width-anchor.x);maxSizeLimitedToBounds.width=Math.min(horizontalSpace*2,maxSizeLimitedToBounds.width);}}var minSizeLimited=aspectRatio?sizeCreateFromRect(rectCoverRect(rectCreateFromSize(minSize),aspectRatio)):minSize;var maxSizeLimited=aspectRatio?sizeCreateFromRect(rectContainRect(maxSizeLimitedToBounds,aspectRatio)):maxSizeLimitedToBounds;var l,r,t,b;// set bounds
if(translateToRight)l=anchor.x;else if(translateToLeft)r=anchor.x;if(translateToBottom)t=anchor.y;else if(translateToTop)b=anchor.y;// inner
if(translateToRight){r=l+minSizeLimited.width;}else if(translateToLeft){l=r-minSizeLimited.width;}if(translateToBottom){b=t+minSizeLimited.height;}else if(translateToTop){t=b-minSizeLimited.height;}if(translateHorizontally){t=anchor.y-minSizeLimited.height*0.5;b=anchor.y+minSizeLimited.height*0.5;}else if(translateVertically){l=anchor.x-minSizeLimited.width*0.5;r=anchor.x+minSizeLimited.width*0.5;}var inner=rectCreateFromPoints([vectorCreate(l,t),vectorCreate(r,b)]);// outer
if(translateToRight){r=l+maxSizeLimited.width;}else if(translateToLeft){l=r-maxSizeLimited.width;}if(translateToBottom){b=t+maxSizeLimited.height;}else if(translateToTop){t=b-maxSizeLimited.height;}if(translateHorizontally){t=anchor.y-maxSizeLimited.height*0.5;b=anchor.y+maxSizeLimited.height*0.5;}else if(translateVertically){l=anchor.x-maxSizeLimited.width*0.5;r=anchor.x+maxSizeLimited.width*0.5;}// limit outer to stage
l=Math.max(bounds.x,l);r=Math.min(bounds.x+bounds.width,r);t=Math.max(bounds.y,t);b=Math.min(bounds.y+bounds.height,b);var outer=rectCreateFromPoints([vectorCreate(l,t),vectorCreate(r,b)]);// hud(bounds).purple();
return{inner:inner,outer:outer};};var applyRectDirectionTranslation=function applyRectDirectionTranslation(rect,transform){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};// the transforms to apply
var target=transform.target,translate=transform.translate;// the transform requirements
var aspectRatio=options.aspectRatio,minSize=options.minSize;// get anchor coordinates and x,y position we need this for relative scaling of the view rectangle
var anchor=DirectionInversionTable[target];var anchorDirectionCoordinates=DirectionCoordinateTable[anchor];var anchorPosition=vectorAdd(rectClone$1(rect),vectorCreate(anchorDirectionCoordinates[0]*rect.width,anchorDirectionCoordinates[1]*rect.height));// get coordinate of direction
var targetDirectionCoordinates=DirectionCoordinateTable[target];var targetPosition=vectorAdd(rectClone$1(rect),vectorCreate(targetDirectionCoordinates[0]*rect.width,targetDirectionCoordinates[1]*rect.height));// bools to determine which direction the interaction is moving in
var _getTranslationInfo3=getTranslationInfo(target),_getTranslationInfo4=_slicedToArray(_getTranslationInfo3,7),translateToRight=_getTranslationInfo4[0],translateToLeft=_getTranslationInfo4[1],translateToTop=_getTranslationInfo4[2],translateToBottom=_getTranslationInfo4[3],translateHorizontally=_getTranslationInfo4[4],translateVertically=_getTranslationInfo4[5],translateAxis=_getTranslationInfo4[6];var tx=translate.x;var ty=translate.y;if(translateHorizontally)ty=0;else if(translateVertically)tx=0;// current bounds
var _rectToBounds7=rectToBounds(rect),_rectToBounds8=_slicedToArray(_rectToBounds7,4),t=_rectToBounds8[0],r=_rectToBounds8[1],b=_rectToBounds8[2],l=_rectToBounds8[3];// update view bounds with anchor based on translation direction (one side is always locked)
if(translateToRight)l=anchorPosition.x;else if(translateToLeft)r=anchorPosition.x;if(translateToBottom)t=anchorPosition.y;else if(translateToTop)b=anchorPosition.y;// update view bounds with interaction limits
if(translateToRight){r=targetPosition.x+tx;}else if(translateToLeft){l=targetPosition.x+tx;}if(translateToBottom){b=targetPosition.y+ty;}else if(translateToTop){t=targetPosition.y+ty;}if(minSize&&translateHorizontally&&b-t<minSize.height){var dy=minSize.height-(b-t);t-=dy*0.5;b+=dy*0.5;}// make sure min size is respected
if(minSize&&translateVertically&&r-l<minSize.width){var dx=minSize.width-(r-l);l-=dx*0.5;r+=dx*0.5;}// if aspect ratio is set we need to scale both axis
if(aspectRatio){// if translating over horizontal or vertical axis we need to update the other axis based on the aspect ratio as well
if(translateAxis){var _dx3=r-l;var _dy3=b-t;if(translateHorizontally){_dy3=_dx3/aspectRatio;t=anchorPosition.y-_dy3*0.5;b=anchorPosition.y+_dy3*0.5;}else if(translateVertically){_dx3=_dy3*aspectRatio;l=anchorPosition.x-_dx3*0.5;r=anchorPosition.x+_dx3*0.5;}}// we're translating one of the corners in both the x and y direction, need to make sure it conforms to aspect ratio
else{var pointer=vectorCreate(targetPosition.x+tx-anchorPosition.x,targetPosition.y+ty-anchorPosition.y);// translations cannot be inverted, limited by anchor position
if(target===TopRight){pointer.x=Math.max(0,pointer.x);pointer.y=Math.min(0,pointer.y);}else if(target===BottomRight){pointer.x=Math.max(0,pointer.x);pointer.y=Math.max(0,pointer.y);}else if(target===BottomLeft){pointer.x=Math.min(0,pointer.x);pointer.y=Math.max(0,pointer.y);}else if(target===TopLeft){pointer.x=Math.min(0,pointer.x);pointer.y=Math.min(0,pointer.y);}// calculate the translation pointer, then get its length, now create a new pointer based on the aspect ratio, and scale it based on the original (limited) length
var pointerLength=vectorLength(pointer);var pointerAspectRatio=vectorCreate(aspectRatio,1);var pointerScaled=vectorMultiply(vectorNormalize(pointerAspectRatio),pointerLength);if(target===TopRight){r=anchorPosition.x+pointerScaled.x;t=anchorPosition.y-pointerScaled.y;}else if(target===BottomRight){r=anchorPosition.x+pointerScaled.x;b=anchorPosition.y+pointerScaled.y;}else if(target===BottomLeft){l=anchorPosition.x-pointerScaled.x;b=anchorPosition.y+pointerScaled.y;}else if(target===TopLeft){l=anchorPosition.x-pointerScaled.x;t=anchorPosition.y-pointerScaled.y;}}}return rectCreate(l,t,r-l,b-t);};var radToDeg=function radToDeg(rad){return rad*180/Math.PI;};/* src/core/ui/plugins/crop/components/ImageRotator.svelte generated by Svelte v3.52.0 */function create_fragment$p(ctx){var div;var rangeinput;var current;rangeinput=new RangeInput({props:{elasticity:/*elasticity*/ctx[5],min:/*min*/ctx[9],max:/*max*/ctx[10],value:/*value*/ctx[11],valueMin:Math.max(/*min*/ctx[9],/*valueMin*/ctx[0]),valueMax:Math.min(/*max*/ctx[10],/*valueMax*/ctx[1]),labelReset:/*labelReset*/ctx[6],base:/*center*/ctx[12],valueLabel:"".concat(Math.round(radToDeg(/*value*/ctx[11])),"&deg;"),oninputstart:/*oninputstart*/ctx[2],oninputmove:/*func*/ctx[17],oninputend:/*func_1*/ctx[18]}});return{c:function c(){div=element("div");create_component(rangeinput.$$.fragment);attr(div,"class","PinturaImageRotator");},m:function m(target,anchor){insert(target,div,anchor);mount_component(rangeinput,div,null);current=true;},p:function p(ctx,_ref352){var _ref353=_slicedToArray(_ref352,1),dirty=_ref353[0];var rangeinput_changes={};if(dirty&/*elasticity*/32)rangeinput_changes.elasticity=/*elasticity*/ctx[5];if(dirty&/*min*/512)rangeinput_changes.min=/*min*/ctx[9];if(dirty&/*max*/1024)rangeinput_changes.max=/*max*/ctx[10];if(dirty&/*value*/2048)rangeinput_changes.value=/*value*/ctx[11];if(dirty&/*min, valueMin*/513)rangeinput_changes.valueMin=Math.max(/*min*/ctx[9],/*valueMin*/ctx[0]);if(dirty&/*max, valueMax*/1026)rangeinput_changes.valueMax=Math.min(/*max*/ctx[10],/*valueMax*/ctx[1]);if(dirty&/*labelReset*/64)rangeinput_changes.labelReset=/*labelReset*/ctx[6];if(dirty&/*center*/4096)rangeinput_changes.base=/*center*/ctx[12];if(dirty&/*value*/2048)rangeinput_changes.valueLabel="".concat(Math.round(radToDeg(/*value*/ctx[11])),"&deg;");if(dirty&/*oninputstart*/4)rangeinput_changes.oninputstart=/*oninputstart*/ctx[2];if(dirty&/*oninputmove, sign, turns*/392)rangeinput_changes.oninputmove=/*func*/ctx[17];if(dirty&/*oninputend, sign, turns*/400)rangeinput_changes.oninputend=/*func_1*/ctx[18];rangeinput.$set(rangeinput_changes);},i:function i(local){if(current)return;transition_in(rangeinput.$$.fragment,local);current=true;},o:function o(local){transition_out(rangeinput.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(rangeinput);}};}var MARGIN=0.000000001;function instance$p($$self,$$props,$$invalidate){var min;var max;var center;var range;var sign;var turns;var value;var rotation=$$props.rotation;var valueMin=$$props.valueMin;var valueMax=$$props.valueMax;var _$$props$oninputstart2=$$props.oninputstart,oninputstart=_$$props$oninputstart2===void 0?noop$1:_$$props$oninputstart2;var _$$props$oninputmove2=$$props.oninputmove,oninputmove=_$$props$oninputmove2===void 0?noop$1:_$$props$oninputmove2;var _$$props$oninputend2=$$props.oninputend,oninputend=_$$props$oninputend2===void 0?noop$1:_$$props$oninputend2;var _$$props$elasticity4=$$props.elasticity,elasticity=_$$props$elasticity4===void 0?0:_$$props$elasticity4;var _$$props$labelReset2=$$props.labelReset,labelReset=_$$props$labelReset2===void 0?undefined:_$$props$labelReset2;var _$$props$rotationMin=$$props.rotationMin,rotationMin=_$$props$rotationMin===void 0?undefined:_$$props$rotationMin;var _$$props$rotationMax=$$props.rotationMax,rotationMax=_$$props$rotationMax===void 0?undefined:_$$props$rotationMax;var func=function func(value){return oninputmove(sign*turns+value);};var func_1=function func_1(value){return oninputend(sign*turns+value);};$$self.$$set=function($$props){if('rotation'in $$props)$$invalidate(13,rotation=$$props.rotation);if('valueMin'in $$props)$$invalidate(0,valueMin=$$props.valueMin);if('valueMax'in $$props)$$invalidate(1,valueMax=$$props.valueMax);if('oninputstart'in $$props)$$invalidate(2,oninputstart=$$props.oninputstart);if('oninputmove'in $$props)$$invalidate(3,oninputmove=$$props.oninputmove);if('oninputend'in $$props)$$invalidate(4,oninputend=$$props.oninputend);if('elasticity'in $$props)$$invalidate(5,elasticity=$$props.elasticity);if('labelReset'in $$props)$$invalidate(6,labelReset=$$props.labelReset);if('rotationMin'in $$props)$$invalidate(14,rotationMin=$$props.rotationMin);if('rotationMax'in $$props)$$invalidate(15,rotationMax=$$props.rotationMax);};$$self.$$.update=function(){if($$self.$$.dirty&/*rotationMin*/16384){$$invalidate(9,min=rotationMin+MARGIN);}if($$self.$$.dirty&/*rotationMax*/32768){$$invalidate(10,max=rotationMax-MARGIN);}if($$self.$$.dirty&/*min, max*/1536){$$invalidate(12,center=min+(max-min)*0.5);}if($$self.$$.dirty&/*rotationMax*/32768){$$invalidate(16,range=rotationMax*2);}if($$self.$$.dirty&/*rotation*/8192){$$invalidate(8,sign=Math.sign(rotation));}if($$self.$$.dirty&/*rotation, range*/73728){$$invalidate(7,turns=Math.round(Math.abs(rotation)/range)*range);}if($$self.$$.dirty&/*rotation, sign, turns*/8576){$$invalidate(11,value=rotation-sign*turns);}};return[valueMin,valueMax,oninputstart,oninputmove,oninputend,elasticity,labelReset,turns,sign,min,max,value,center,rotation,rotationMin,rotationMax,range,func,func_1];}var ImageRotator=/*#__PURE__*/function(_SvelteComponent29){_inherits(ImageRotator,_SvelteComponent29);var _super30=_createSuper(ImageRotator);function ImageRotator(options){var _this31;_classCallCheck(this,ImageRotator);_this31=_super30.call(this);init(_assertThisInitialized(_this31),options,instance$p,create_fragment$p,safe_not_equal,{rotation:13,valueMin:0,valueMax:1,oninputstart:2,oninputmove:3,oninputend:4,elasticity:5,labelReset:6,rotationMin:14,rotationMax:15});return _this31;}return _createClass(ImageRotator);}(SvelteComponent);/* src/core/ui/plugins/crop/components/ImageInfo.svelte generated by Svelte v3.52.0 */function create_fragment$o(ctx){var div;var p;var t0;var t1;var t2;return{c:function c(){div=element("div");p=element("p");t0=text(/*width*/ctx[0]);t1=text(" × ");t2=text(/*height*/ctx[1]);attr(div,"class","PinturaImageInfo");},m:function m(target,anchor){insert(target,div,anchor);append(div,p);append(p,t0);append(p,t1);append(p,t2);},p:function p(ctx,_ref354){var _ref355=_slicedToArray(_ref354,1),dirty=_ref355[0];if(dirty&/*width*/1)set_data(t0,/*width*/ctx[0]);if(dirty&/*height*/2)set_data(t2,/*height*/ctx[1]);},i:noop,o:noop,d:function d(detaching){if(detaching)detach(div);}};}function instance$o($$self,$$props,$$invalidate){var width=$$props.width;var height=$$props.height;$$self.$$set=function($$props){if('width'in $$props)$$invalidate(0,width=$$props.width);if('height'in $$props)$$invalidate(1,height=$$props.height);};return[width,height];}var ImageInfo=/*#__PURE__*/function(_SvelteComponent30){_inherits(ImageInfo,_SvelteComponent30);var _super31=_createSuper(ImageInfo);function ImageInfo(options){var _this32;_classCallCheck(this,ImageInfo);_this32=_super31.call(this);init(_assertThisInitialized(_this32),options,instance$o,create_fragment$o,safe_not_equal,{width:0,height:1});return _this32;}return _createClass(ImageInfo);}(SvelteComponent);var getSelectionPresetOptionIcon=function getSelectionPresetOptionIcon(value){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _options$width3=options.width,width=_options$width3===void 0?24:_options$width3,_options$height3=options.height,height=_options$height3===void 0?24:_options$height3,_options$bounds=options.bounds,bounds=_options$bounds===void 0?16:_options$bounds,_options$radius=options.radius,radius=_options$radius===void 0?3:_options$radius;var aspectRatio=isArray(value)?getAspectRatio(value[0],value[1]):value;var aspectRatioDefined=!!aspectRatio;aspectRatio=aspectRatioDefined?aspectRatio:1;var x;var y;var w;var h;w=aspectRatio>1?bounds:aspectRatio*bounds;h=w/aspectRatio;x=Math.round((width-w)*0.5);y=Math.round((height-h)*0.5);var fill=aspectRatioDefined?'currentColor':'none';var stroke=aspectRatioDefined?'none':'currentColor';var strokeWidth=width/16;var strokeDashArray=[width/12,width/6].join(' ');return"<rect fill=\"".concat(fill,"\" stroke=\"").concat(stroke,"\" stroke-width=\"").concat(strokeWidth,"\" stroke-dasharray=\"").concat(strokeDashArray,"\" x=\"").concat(x,"\" y=\"").concat(y,"\" width=\"").concat(w,"\" height=\"").concat(h,"\" rx=\"").concat(radius,"\"/>");};/* src/core/ui/plugins/crop/components/CropPresetList.svelte generated by Svelte v3.52.0 */function create_controls_slot(ctx){var radiogroup;var current;radiogroup=new RadioGroup({props:{"class":"PinturaPresetListFilter",layout:"row",options:/*filterOptions*/ctx[8],selectedIndex:/*selectedFilterIndex*/ctx[7],onchange:/*handleChangeFilter*/ctx[10]}});return{c:function c(){create_component(radiogroup.$$.fragment);},m:function m(target,anchor){mount_component(radiogroup,target,anchor);current=true;},p:function p(ctx,dirty){var radiogroup_changes={};if(dirty&/*filterOptions*/256)radiogroup_changes.options=/*filterOptions*/ctx[8];if(dirty&/*selectedFilterIndex*/128)radiogroup_changes.selectedIndex=/*selectedFilterIndex*/ctx[7];radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radiogroup,detaching);}};}function create_fragment$n(ctx){var dropdown;var current;dropdown=new Dropdown({props:{icon:/*icon*/ctx[0],label:/*label*/ctx[1],labelClass:/*labelClass*/ctx[2],hideLabel:/*hideLabel*/ctx[3],options:/*filteredOptions*/ctx[9],selectedIndex:/*selectedIndex*/ctx[4],onchange:/*onchange*/ctx[5],optionMapper:/*optionMapper*/ctx[6],$$slots:{controls:[create_controls_slot]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(dropdown.$$.fragment);},m:function m(target,anchor){mount_component(dropdown,target,anchor);current=true;},p:function p(ctx,_ref356){var _ref357=_slicedToArray(_ref356,1),dirty=_ref357[0];var dropdown_changes={};if(dirty&/*icon*/1)dropdown_changes.icon=/*icon*/ctx[0];if(dirty&/*label*/2)dropdown_changes.label=/*label*/ctx[1];if(dirty&/*labelClass*/4)dropdown_changes.labelClass=/*labelClass*/ctx[2];if(dirty&/*hideLabel*/8)dropdown_changes.hideLabel=/*hideLabel*/ctx[3];if(dirty&/*filteredOptions*/512)dropdown_changes.options=/*filteredOptions*/ctx[9];if(dirty&/*selectedIndex*/16)dropdown_changes.selectedIndex=/*selectedIndex*/ctx[4];if(dirty&/*onchange*/32)dropdown_changes.onchange=/*onchange*/ctx[5];if(dirty&/*optionMapper*/64)dropdown_changes.optionMapper=/*optionMapper*/ctx[6];if(dirty&/*$$scope, filterOptions, selectedFilterIndex*/262528){dropdown_changes.$$scope={dirty:dirty,ctx:ctx};}dropdown.$set(dropdown_changes);},i:function i(local){if(current)return;transition_in(dropdown.$$.fragment,local);current=true;},o:function o(local){transition_out(dropdown.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(dropdown,detaching);}};}var style='fill="none" stroke="currentColor"';function instance$n($$self,$$props,$$invalidate){var filteredOptions;var selectedFilterIndex;var filterOptions;var icon=$$props.icon;var label=$$props.label;var labelClass=$$props.labelClass;var hideLabel=$$props.hideLabel;var options=$$props.options;var selectedIndex=$$props.selectedIndex;var onchange=$$props.onchange;var optionMapper=$$props.optionMapper;var _$$props$filter=$$props.filter,filter=_$$props$filter===void 0?'landscape':_$$props$filter;var _$$props$onfilterchan=$$props.onfilterchange,onfilterchange=_$$props$onfilterchan===void 0?noop$1:_$$props$onfilterchan;var getIcon=function getIcon(x,y,width,height,r){return"\n    <rect ".concat(style," x=\"").concat(x,"\" y=\"").concat(y,"\" width=\"").concat(width,"\" height=\"").concat(height,"\" rx=\"").concat(r,"\"/>");};var getCheckmark=function getCheckmark(x,y){return"<path ".concat(style," d=\"M").concat(x," ").concat(y," l2 2 l3 -4\"/>");};var mapGroupedOptions=function mapGroupedOptions(options,map){return(options||[]).map(function(option){// group
if(isString(option[0])){option[1]=option[1].map(map);return option;}// single
return map(option);});};var createOptionMapper=function createOptionMapper(filter){return function(item){var _item3=_slicedToArray(item,3),value=_item3[0],label=_item3[1],_item3$=_item3[2],options=_item3$===void 0?{}:_item3$;if(isNumber(value)){options.hidden=filter==='landscape'?value<1:value>1;}return[value,label,options];};};var handleChangeFilter=function handleChangeFilter(item){$$invalidate(11,filter=item.value);onfilterchange(item.value);};$$self.$$set=function($$props){if('icon'in $$props)$$invalidate(0,icon=$$props.icon);if('label'in $$props)$$invalidate(1,label=$$props.label);if('labelClass'in $$props)$$invalidate(2,labelClass=$$props.labelClass);if('hideLabel'in $$props)$$invalidate(3,hideLabel=$$props.hideLabel);if('options'in $$props)$$invalidate(12,options=$$props.options);if('selectedIndex'in $$props)$$invalidate(4,selectedIndex=$$props.selectedIndex);if('onchange'in $$props)$$invalidate(5,onchange=$$props.onchange);if('optionMapper'in $$props)$$invalidate(6,optionMapper=$$props.optionMapper);if('filter'in $$props)$$invalidate(11,filter=$$props.filter);if('onfilterchange'in $$props)$$invalidate(13,onfilterchange=$$props.onfilterchange);};$$self.$$.update=function(){if($$self.$$.dirty&/*options, filter*/6144){$$invalidate(9,filteredOptions=mapGroupedOptions(options,createOptionMapper(filter)));}if($$self.$$.dirty&/*filter*/2048){$$invalidate(7,selectedFilterIndex=filter==='landscape'?0:1);}if($$self.$$.dirty&/*selectedFilterIndex*/128){$$invalidate(8,filterOptions=[['landscape','Landscape',{hideLabel:true,icon:getIcon(2,6,19,12,2)+(selectedFilterIndex===0?getCheckmark(9,12):'')}],['portrait','Portrait',{hideLabel:true,icon:getIcon(5,3,13,18,2)+(selectedFilterIndex===1?getCheckmark(9,12):'')}]]);}};return[icon,label,labelClass,hideLabel,selectedIndex,onchange,optionMapper,selectedFilterIndex,filterOptions,filteredOptions,handleChangeFilter,filter,options,onfilterchange];}var CropPresetList=/*#__PURE__*/function(_SvelteComponent31){_inherits(CropPresetList,_SvelteComponent31);var _super32=_createSuper(CropPresetList);function CropPresetList(options){var _this33;_classCallCheck(this,CropPresetList);_this33=_super32.call(this);init(_assertThisInitialized(_this33),options,instance$n,create_fragment$n,safe_not_equal,{icon:0,label:1,labelClass:2,hideLabel:3,options:12,selectedIndex:4,onchange:5,optionMapper:6,filter:11,onfilterchange:13});return _this33;}return _createClass(CropPresetList);}(SvelteComponent);// this makes sure that the new rectangle doesn't have corners outside of the quad
var EDGE_DISTANCE_FACTOR=0.9999;var PRECISION=6;var fixVectorPrecision=function fixVectorPrecision(v){return vectorApply(v,function(v){return fixPrecision(v,PRECISION);});};var rectFixPrecision=function rectFixPrecision(r){return rectApply(r,function(v){return fixPrecision(v,PRECISION);});};var quadFixPrecision=function quadFixPrecision(q){return q.map(fixVectorPrecision);};var floatEquals=function floatEquals(a,b){var margin=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0.0001;return Math.abs(a-b)<margin;};var getRectLimitedToQuad=function getRectLimitedToQuad(rectOrigin,rectTarget,transform,quad){var options=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var aspectRatio=options.aspectRatio;rectOrigin=rectFixPrecision(rectOrigin);quad=quadFixPrecision(quad);var anchor=rectGetCornerByTarget(rectOrigin,DirectionInversionTable[transform.target]);var anchorFixed=vectorApply(anchor,function(v){return fixPrecision(v,PRECISION);});var minSize=aspectRatio?rectCoverRect(options.minSize,aspectRatio):options.minSize;var maxSize=aspectRatio?rectContainRect(options.maxSize,aspectRatio):options.maxSize;var rectTargetCorner=rectGetCornerByTarget(rectTarget,transform.target);// prevent scaling the target size smaller than 0
var dist=vectorDistance(rectTargetCorner,anchor);if(dist<1){rectTarget=rectClone$1(rectOrigin);var _scalar6=Math.min(minSize.width/rectOrigin.width,minSize.height/rectOrigin.height);rectScale$1(rectTarget,_scalar6,anchor);}// clamp between min and max size
rectTarget=rectClamp(rectClone$1(rectTarget),minSize,maxSize,anchor);var rect=rectClone$1(rectTarget);rectTarget=rectFixPrecision(rectTarget);var quadEdges=quadToLines(quad,1);var cornersOrigin=rectGetCorners(rectOrigin);var cornersTarget=rectGetCorners(rectTarget);var anchorIndex=cornersOrigin.findIndex(function(corner){return vectorEqual(vectorApply(corner,function(v){return fixPrecision(v,PRECISION);}),anchorFixed);});var getLineIntersectionWithQuad=function getLineIntersectionWithQuad(line){return quadEdges.map(function(quadEdge){return lineLineIntersection(quadEdge,line);}).filter(Boolean).pop();};// when aspect ratio is locked we can scale the original rectangle relatively to closest intersectionpoint
if(aspectRatio){var intersections=cornersTarget.map(function(target,index){// skip anchor
if(index===anchorIndex)return;// start ray slightly away from anchor so we don't intersect with quad edge
var dir=vectorCreate(anchor.x-target.x,anchor.y-target.y);vectorNormalize(dir);vectorMultiply(dir,0.5);// draw line from anchor to target to find intersection with quad edge
var rayOrigin=vectorCreate(anchor.x-dir.x,anchor.y-dir.y);var ray=lineCreate(rayOrigin,fixVectorPrecision(target));var intersection=getLineIntersectionWithQuad(ray);if(!intersection)return;var origin=cornersOrigin[index];return{intersection:intersection,cornerDist:vectorDistance(anchor,origin),intersectionDist:vectorDistance(anchor,intersection)};}).filter(Boolean);if(intersections.length){var _scalar7=intersections.reduce(function(scalar,current){var currentScalar=current.intersectionDist/current.cornerDist;return currentScalar<scalar?currentScalar:scalar;},Number.MAX_SAFE_INTEGER);rect=rectClone$1(rectOrigin);rectScale$1(rect,_scalar7,anchor);}}else{// if not a fixed aspect ratio
var isManipulatingEdge=transform.target.length===1;// is true if quad is rotated
var isRotated=!(quad[0].y===quad[1].y||quad[0].x===quad[1].x);// get intersections
var _intersections=cornersOrigin.map(function(cornerOrigin,index){// skip anchor
if(index===anchorIndex)return;var cornerTarget=cornersTarget[index];var isDiagonal=!floatEquals(cornerTarget.x,anchorFixed.x)&&!floatEquals(cornerTarget.y,anchorFixed.y);// we ignore the diagonal ray if the quad isn't rotated this makes for better ux
if(!isManipulatingEdge&&!isRotated&&isDiagonal)return;if(isManipulatingEdge&&(floatEquals(cornerTarget.x,anchorFixed.x)||floatEquals(cornerTarget.y,anchorFixed.y)))return;var rayOrigin=vectorClone(isManipulatingEdge?cornerOrigin:anchor);// start ray slightly away from anchor so we don't intersect with quad edge
var dir=vectorSubtract(vectorClone(rayOrigin),cornerTarget);vectorNormalize(dir);vectorMultiply(dir,0.5);if(isManipulatingEdge){vectorAdd(rayOrigin,dir);}else{vectorSubtract(rayOrigin,dir);}var ray=lineCreate(rayOrigin,cornerTarget);var intersection=getLineIntersectionWithQuad(ray);if(!intersection)return;return intersection;}).filter(Boolean);if(_intersections.length){var _getTranslationInfo5=getTranslationInfo(transform.target),_getTranslationInfo6=_slicedToArray(_getTranslationInfo5,4),translateToRight=_getTranslationInfo6[0],translateToLeft=_getTranslationInfo6[1],translateToTop=_getTranslationInfo6[2],translateToBottom=_getTranslationInfo6[3];var _rectToBounds9=rectToBounds(rectTarget),_rectToBounds10=_slicedToArray(_rectToBounds9,4),_t4=_rectToBounds10[0],_r8=_rectToBounds10[1],b=_rectToBounds10[2],l=_rectToBounds10[3];_intersections.forEach(function(_ref358){var x=_ref358.x,y=_ref358.y;var pX=fixPrecision(x,PRECISION);var pY=fixPrecision(y,PRECISION);if(translateToTop&&!floatEquals(pY,anchorFixed.y)){_t4=Math.max(_t4,y);}if(translateToRight&&!floatEquals(pX,anchorFixed.x)){_r8=Math.min(_r8,x);}if(translateToBottom&&!floatEquals(pY,anchorFixed.y)){b=Math.min(b,y);}if(translateToLeft&&!floatEquals(pX,anchorFixed.x)){l=Math.max(l,x);}});// new rect
rect=rectCreateFromBounds([_t4,_r8,b,l]);// scale back a bit so doesn't overlap with quad
rectScale$1(rect,EDGE_DISTANCE_FACTOR,anchor);}}// make sure is at least one pixel wide and high
rectClamp(rect,minSize,maxSize,anchor);return rect;};/* src/core/ui/plugins/crop/index.svelte generated by Svelte v3.52.0 */function create_default_slot_2$2(ctx){var dynamiccomponenttree;var current;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*cropTools*/ctx[11]}});return{c:function c(){create_component(dynamiccomponenttree.$$.fragment);},m:function m(target,anchor){mount_component(dynamiccomponenttree,target,anchor);current=true;},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty[0]&/*cropTools*/2048)dynamiccomponenttree_changes.items=/*cropTools*/ctx[11];dynamiccomponenttree.$set(dynamiccomponenttree_changes);},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(dynamiccomponenttree,detaching);}};}// (1524:4) 
function create_header_slot(ctx){var div;var toolbar;var current;toolbar=new Toolbar({props:{$$slots:{"default":[create_default_slot_2$2]},$$scope:{ctx:ctx}}});return{c:function c(){div=element("div");create_component(toolbar.$$.fragment);attr(div,"slot","header");},m:function m(target,anchor){insert(target,div,anchor);mount_component(toolbar,div,null);current=true;},p:function p(ctx,dirty){var toolbar_changes={};if(dirty[0]&/*cropTools*/2048|dirty[7]&/*$$scope*/2){toolbar_changes.$$scope={dirty:dirty,ctx:ctx};}toolbar.$set(toolbar_changes);},i:function i(local){if(current)return;transition_in(toolbar.$$.fragment,local);current=true;},o:function o(local){transition_out(toolbar.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(toolbar);}};}// (1554:12) {#if shouldRenderImageSelection && shouldRenderImageSelectionRecenterButton}
function create_if_block_5$2(ctx){var button;var current;button=new Button({props:{onclick:/*handleRecenterAction*/ctx[88],label:/*locale*/ctx[4].cropLabelButtonRecenter,icon:/*locale*/ctx[4].cropIconButtonRecenter,"class":"PinturaButtonCenter",disabled:!/*canCenter*/ctx[9],hideLabel:true,style:"opacity: ".concat(/*$recenterOpacity*/ctx[29],"; transform: translate3d(").concat(/*$recenterOffset*/ctx[30].x,"px, ").concat(/*$recenterOffset*/ctx[30].y,"px, 0)")}});return{c:function c(){create_component(button.$$.fragment);},m:function m(target,anchor){mount_component(button,target,anchor);current=true;},p:function p(ctx,dirty){var button_changes={};if(dirty[0]&/*locale*/16)button_changes.label=/*locale*/ctx[4].cropLabelButtonRecenter;if(dirty[0]&/*locale*/16)button_changes.icon=/*locale*/ctx[4].cropIconButtonRecenter;if(dirty[0]&/*canCenter*/512)button_changes.disabled=!/*canCenter*/ctx[9];if(dirty[0]&/*$recenterOpacity, $recenterOffset*/1610612736)button_changes.style="opacity: ".concat(/*$recenterOpacity*/ctx[29],"; transform: translate3d(").concat(/*$recenterOffset*/ctx[30].x,"px, ").concat(/*$recenterOffset*/ctx[30].y,"px, 0)");button.$set(button_changes);},i:function i(local){if(current)return;transition_in(button.$$.fragment,local);current=true;},o:function o(local){transition_out(button.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(button,detaching);}};}// (1566:12) {#if shouldRenderImageSelection}
function create_if_block_4$3(ctx){var rectmanipulator;var current;rectmanipulator=new RectManipulator({props:{rect:/*imageSelectionRectOffset*/ctx[8],visible:/*$isActive*/ctx[12],style:/*cropImageSelectionCornerStyle*/ctx[1]}});rectmanipulator.$on("resizestart",/*handleSelectionGrab*/ctx[68]);rectmanipulator.$on("resizemove",/*handleSelectionDrag*/ctx[69]);rectmanipulator.$on("resizeend",/*handleSelectionRelease*/ctx[70]);return{c:function c(){create_component(rectmanipulator.$$.fragment);},m:function m(target,anchor){mount_component(rectmanipulator,target,anchor);current=true;},p:function p(ctx,dirty){var rectmanipulator_changes={};if(dirty[0]&/*imageSelectionRectOffset*/256)rectmanipulator_changes.rect=/*imageSelectionRectOffset*/ctx[8];if(dirty[0]&/*$isActive*/4096)rectmanipulator_changes.visible=/*$isActive*/ctx[12];if(dirty[0]&/*cropImageSelectionCornerStyle*/2)rectmanipulator_changes.style=/*cropImageSelectionCornerStyle*/ctx[1];rectmanipulator.$set(rectmanipulator_changes);},i:function i(local){if(current)return;transition_in(rectmanipulator.$$.fragment,local);current=true;},o:function o(local){transition_out(rectmanipulator.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(rectmanipulator,detaching);}};}// (1579:8) {#if shouldRenderInfoIndicator}
function create_if_block_3$3(ctx){var imageinfo;var current;imageinfo=new ImageInfo({props:{width:Math.round(/*$imageCropRect*/ctx[13].width),height:Math.round(/*$imageCropRect*/ctx[13].height)}});return{c:function c(){create_component(imageinfo.$$.fragment);},m:function m(target,anchor){mount_component(imageinfo,target,anchor);current=true;},p:function p(ctx,dirty){var imageinfo_changes={};if(dirty[0]&/*$imageCropRect*/8192)imageinfo_changes.width=Math.round(/*$imageCropRect*/ctx[13].width);if(dirty[0]&/*$imageCropRect*/8192)imageinfo_changes.height=Math.round(/*$imageCropRect*/ctx[13].height);imageinfo.$set(imageinfo_changes);},i:function i(local){if(current)return;transition_in(imageinfo.$$.fragment,local);current=true;},o:function o(local){transition_out(imageinfo.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(imageinfo,detaching);}};}// (1530:4) 
function create_main_slot$1(ctx){var div1;var div0;var t0;var interactable_action;var t1;var current;var mounted;var dispose;var if_block0=/*shouldRenderImageSelection*/ctx[21]&&/*shouldRenderImageSelectionRecenterButton*/ctx[10]&&create_if_block_5$2(ctx);var if_block1=/*shouldRenderImageSelection*/ctx[21]&&create_if_block_4$3(ctx);var if_block2=/*shouldRenderInfoIndicator*/ctx[22]&&create_if_block_3$3(ctx);return{c:function c(){div1=element("div");div0=element("div");if(if_block0)if_block0.c();t0=space();if(if_block1)if_block1.c();t1=space();if(if_block2)if_block2.c();attr(div0,"class","PinturaStage");attr(div1,"slot","main");},m:function m(target,anchor){insert(target,div1,anchor);append(div1,div0);if(if_block0)if_block0.m(div0,null);append(div0,t0);if(if_block1)if_block1.m(div0,null);/*div0_binding*/ctx[162](div0);append(div1,t1);if(if_block2)if_block2.m(div1,null);current=true;if(!mounted){dispose=[action_destroyer(measurable.call(null,div0)),listen(div0,"measure",/*measure_handler_1*/ctx[160]),listen(div0,"wheel",function(){if(is_function(/*cropEnableZoom*/ctx[2]&&/*handleWheel*/ctx[87]))(/*cropEnableZoom*/ctx[2]&&/*handleWheel*/ctx[87]).apply(this,arguments);},{passive:false}),listen(div0,"interactionstart",/*handleImageDragStart*/ctx[74]),listen(div0,"interactionupdate",/*handleImageDrag*/ctx[75]),listen(div0,"interactionrelease",/*handleImageDragRelease*/ctx[77]),listen(div0,"interactionend",/*handleImageDragEnd*/ctx[76]),action_destroyer(interactable_action=interactable.call(null,div0,{drag:true,inertia:true,pinch:/*cropEnableZoom*/ctx[2],shouldStartInteraction:interactable_function$1,getEventPosition:/*interactable_function_1*/ctx[163]})),listen(div0,"gesturedown",/*handleGestureStart*/ctx[84]),listen(div0,"gestureupdate",/*handleGestureUpdate*/ctx[85]),listen(div0,"gestureup",/*handleGestureEnd*/ctx[86]),action_destroyer(gesturable.call(null,div0))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(/*shouldRenderImageSelection*/ctx[21]&&/*shouldRenderImageSelectionRecenterButton*/ctx[10]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*shouldRenderImageSelection, shouldRenderImageSelectionRecenterButton*/2098176){transition_in(if_block0,1);}}else{if_block0=create_if_block_5$2(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(div0,t0);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*shouldRenderImageSelection*/ctx[21]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[0]&/*shouldRenderImageSelection*/2097152){transition_in(if_block1,1);}}else{if_block1=create_if_block_4$3(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(div0,null);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}if(interactable_action&&is_function(interactable_action.update)&&dirty[0]&/*cropEnableZoom, $rootRect*/16777220)interactable_action.update.call(null,{drag:true,inertia:true,pinch:/*cropEnableZoom*/ctx[2],shouldStartInteraction:interactable_function$1,getEventPosition:/*interactable_function_1*/ctx[163]});if(/*shouldRenderInfoIndicator*/ctx[22]){if(if_block2){if_block2.p(ctx,dirty);if(dirty[0]&/*shouldRenderInfoIndicator*/4194304){transition_in(if_block2,1);}}else{if_block2=create_if_block_3$3(ctx);if_block2.c();transition_in(if_block2,1);if_block2.m(div1,null);}}else if(if_block2){group_outros();transition_out(if_block2,1,1,function(){if_block2=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);transition_in(if_block2);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);transition_out(if_block2);current=false;},d:function d(detaching){if(detaching)detach(div1);if(if_block0)if_block0.d();if(if_block1)if_block1.d();/*div0_binding*/ctx[162](null);if(if_block2)if_block2.d();mounted=false;run_all(dispose);}};}// (1587:8) {#if shouldRenderFooter}
function create_if_block$5(ctx){var tablist;var t;var tabpanels;var current;var tablist_spread_levels=[{"class":"PinturaControlList"},{tabs:/*tabs*/ctx[7]},/*tabsConfig*/ctx[18]];var tablist_props={$$slots:{"default":[create_default_slot_1$3,function(_ref359){var tab=_ref359.tab;return{217:tab};},function(_ref360){var tab=_ref360.tab;return[0,0,0,0,0,0,0,tab?1:0];}]},$$scope:{ctx:ctx}};for(var i=0;i<tablist_spread_levels.length;i+=1){tablist_props=assign(tablist_props,tablist_spread_levels[i]);}tablist=new TabList({props:tablist_props});tablist.$on("select",/*select_handler*/ctx[161]);var tabpanels_spread_levels=[{"class":"PinturaControlPanels"},{panelClass:"PinturaControlPanel"},{panels:/*panels*/ctx[17]},/*tabsConfig*/ctx[18]];var tabpanels_props={$$slots:{"default":[create_default_slot$a,function(_ref361){var panel=_ref361.panel;return{216:panel};},function(_ref362){var panel=_ref362.panel;return[0,0,0,0,0,0,panel?1073741824:0];}]},$$scope:{ctx:ctx}};for(var _i30=0;_i30<tabpanels_spread_levels.length;_i30+=1){tabpanels_props=assign(tabpanels_props,tabpanels_spread_levels[_i30]);}tabpanels=new TabPanels({props:tabpanels_props});return{c:function c(){create_component(tablist.$$.fragment);t=space();create_component(tabpanels.$$.fragment);},m:function m(target,anchor){mount_component(tablist,target,anchor);insert(target,t,anchor);mount_component(tabpanels,target,anchor);current=true;},p:function p(ctx,dirty){var tablist_changes=dirty[0]&/*tabs, tabsConfig*/262272?get_spread_update(tablist_spread_levels,[tablist_spread_levels[0],dirty[0]&/*tabs*/128&&{tabs:/*tabs*/ctx[7]},dirty[0]&/*tabsConfig*/262144&&get_spread_object(/*tabsConfig*/ctx[18])]):{};if(dirty[7]&/*$$scope, tab*/3){tablist_changes.$$scope={dirty:dirty,ctx:ctx};}tablist.$set(tablist_changes);var tabpanels_changes=dirty[0]&/*panels, tabsConfig*/393216?get_spread_update(tabpanels_spread_levels,[tabpanels_spread_levels[0],tabpanels_spread_levels[1],dirty[0]&/*panels*/131072&&{panels:/*panels*/ctx[17]},dirty[0]&/*tabsConfig*/262144&&get_spread_object(/*tabsConfig*/ctx[18])]):{};if(dirty[0]&/*$elasticityMultiplier, $imageRotation, locale, $imageRotationRange, cropRotationRange, imageZoomLevelMin, $imageZoomLevelRange, $imageZoomLevel*/511721496|dirty[6]&/*panel*/1073741824|dirty[7]&/*$$scope*/2){tabpanels_changes.$$scope={dirty:dirty,ctx:ctx};}tabpanels.$set(tabpanels_changes);},i:function i(local){if(current)return;transition_in(tablist.$$.fragment,local);transition_in(tabpanels.$$.fragment,local);current=true;},o:function o(local){transition_out(tablist.$$.fragment,local);transition_out(tabpanels.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(tablist,detaching);if(detaching)detach(t);destroy_component(tabpanels,detaching);}};}// (1588:12) <TabList                 class="PinturaControlList"                 {tabs}                 {...tabsConfig}                 on:select={({ detail }) => (transformSelected = detail)}                 let:tab             >
function create_default_slot_1$3(ctx){var span;var t_value=/*tab*/ctx[217].label+"";var t;return{c:function c(){span=element("span");t=text(t_value);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[7]&/*tab*/1&&t_value!==(t_value=/*tab*/ctx[217].label+""))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (1618:59) 
function create_if_block_2$3(ctx){var rangeinput;var current;rangeinput=new RangeInput({props:{elasticity:/*$elasticityMultiplier*/ctx[25]*/*rangeInputElasticity*/ctx[43],base:imageZoomLevelBase,min:/*imageZoomLevelMin*/ctx[23],max:imageZoomLevelMax,valueMin:/*$imageZoomLevelRange*/ctx[27][0],valueMax:/*$imageZoomLevelRange*/ctx[27][1],value:/*$imageZoomLevel*/ctx[28],labelReset:/*locale*/ctx[4].labelReset,valueLabel:"".concat(Math.round(/*$imageZoomLevel*/ctx[28]*100),"%"),oninputstart:/*handleResizeStart*/ctx[81],oninputmove:/*handleResizeMove*/ctx[82],oninputend:/*handleResizeEnd*/ctx[83]}});return{c:function c(){create_component(rangeinput.$$.fragment);},m:function m(target,anchor){mount_component(rangeinput,target,anchor);current=true;},p:function p(ctx,dirty){var rangeinput_changes={};if(dirty[0]&/*$elasticityMultiplier*/33554432)rangeinput_changes.elasticity=/*$elasticityMultiplier*/ctx[25]*/*rangeInputElasticity*/ctx[43];if(dirty[0]&/*imageZoomLevelMin*/8388608)rangeinput_changes.min=/*imageZoomLevelMin*/ctx[23];if(dirty[0]&/*$imageZoomLevelRange*/134217728)rangeinput_changes.valueMin=/*$imageZoomLevelRange*/ctx[27][0];if(dirty[0]&/*$imageZoomLevelRange*/134217728)rangeinput_changes.valueMax=/*$imageZoomLevelRange*/ctx[27][1];if(dirty[0]&/*$imageZoomLevel*/268435456)rangeinput_changes.value=/*$imageZoomLevel*/ctx[28];if(dirty[0]&/*locale*/16)rangeinput_changes.labelReset=/*locale*/ctx[4].labelReset;if(dirty[0]&/*$imageZoomLevel*/268435456)rangeinput_changes.valueLabel="".concat(Math.round(/*$imageZoomLevel*/ctx[28]*100),"%");rangeinput.$set(rangeinput_changes);},i:function i(local){if(current)return;transition_in(rangeinput.$$.fragment,local);current=true;},o:function o(local){transition_out(rangeinput.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(rangeinput,detaching);}};}// (1605:16) {#if panel === cropUniqueId + '-rotation'}
function create_if_block_1$4(ctx){var imagerotator;var current;imagerotator=new ImageRotator({props:{elasticity:/*$elasticityMultiplier*/ctx[25]*/*rangeInputElasticity*/ctx[43],rotation:/*$imageRotation*/ctx[14],labelReset:/*locale*/ctx[4].labelReset,valueMin:/*$imageRotationRange*/ctx[26][0],valueMax:/*$imageRotationRange*/ctx[26][1],rotationMin:-/*cropRotationRange*/ctx[3],rotationMax:/*cropRotationRange*/ctx[3],oninputstart:/*handleRotateStart*/ctx[71],oninputmove:/*handleRotateMove*/ctx[72],oninputend:/*handleRotateEnd*/ctx[73]}});return{c:function c(){create_component(imagerotator.$$.fragment);},m:function m(target,anchor){mount_component(imagerotator,target,anchor);current=true;},p:function p(ctx,dirty){var imagerotator_changes={};if(dirty[0]&/*$elasticityMultiplier*/33554432)imagerotator_changes.elasticity=/*$elasticityMultiplier*/ctx[25]*/*rangeInputElasticity*/ctx[43];if(dirty[0]&/*$imageRotation*/16384)imagerotator_changes.rotation=/*$imageRotation*/ctx[14];if(dirty[0]&/*locale*/16)imagerotator_changes.labelReset=/*locale*/ctx[4].labelReset;if(dirty[0]&/*$imageRotationRange*/67108864)imagerotator_changes.valueMin=/*$imageRotationRange*/ctx[26][0];if(dirty[0]&/*$imageRotationRange*/67108864)imagerotator_changes.valueMax=/*$imageRotationRange*/ctx[26][1];if(dirty[0]&/*cropRotationRange*/8)imagerotator_changes.rotationMin=-/*cropRotationRange*/ctx[3];if(dirty[0]&/*cropRotationRange*/8)imagerotator_changes.rotationMax=/*cropRotationRange*/ctx[3];imagerotator.$set(imagerotator_changes);},i:function i(local){if(current)return;transition_in(imagerotator.$$.fragment,local);current=true;},o:function o(local){transition_out(imagerotator.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(imagerotator,detaching);}};}// (1598:12) <TabPanels                 class="PinturaControlPanels"                 panelClass="PinturaControlPanel"                 {panels}                 {...tabsConfig}                 let:panel             >
function create_default_slot$a(ctx){var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block_1$4,create_if_block_2$3];var if_blocks=[];function select_block_type(ctx,dirty){if(/*panel*/ctx[216]===/*cropUniqueId*/ctx[93]+'-rotation')return 0;if(/*panel*/ctx[216]===/*cropUniqueId*/ctx[93]+'-zoom')return 1;return-1;}if(~(current_block_type_index=select_block_type(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){if(if_block)if_block.c();if_block_anchor=empty();},m:function m(target,anchor){if(~current_block_type_index){if_blocks[current_block_type_index].m(target,anchor);}insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}else{if_block=null;}}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(~current_block_type_index){if_blocks[current_block_type_index].d(detaching);}if(detaching)detach(if_block_anchor);}};}// (1586:4) 
function create_footer_slot$6(ctx){var div;var current;var if_block=/*shouldRenderFooter*/ctx[19]&&create_if_block$5(ctx);return{c:function c(){div=element("div");if(if_block)if_block.c();attr(div,"slot","footer");attr(div,"style",/*footerStyle*/ctx[16]);},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);current=true;},p:function p(ctx,dirty){if(/*shouldRenderFooter*/ctx[19]){if(if_block){if_block.p(ctx,dirty);if(dirty[0]&/*shouldRenderFooter*/524288){transition_in(if_block,1);}}else{if_block=create_if_block$5(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,null);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if(!current||dirty[0]&/*footerStyle*/65536){attr(div,"style",/*footerStyle*/ctx[16]);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();}};}function create_fragment$m(ctx){var util;var updating_root;var current;function util_root_binding(value){/*util_root_binding*/ctx[164](value);}var util_props={hasHeader:/*shouldRenderToolbar*/ctx[20],$$slots:{footer:[create_footer_slot$6],main:[create_main_slot$1],header:[create_header_slot]},$$scope:{ctx:ctx}};if(/*root*/ctx[15]!==void 0){util_props.root=/*root*/ctx[15];}util=new Util({props:util_props});binding_callbacks.push(function(){return bind(util,'root',util_root_binding);});util.$on("measure",/*measure_handler*/ctx[165]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*shouldRenderToolbar*/1048576)util_changes.hasHeader=/*shouldRenderToolbar*/ctx[20];if(dirty[0]&/*footerStyle, panels, tabsConfig, $elasticityMultiplier, $imageRotation, locale, $imageRotationRange, cropRotationRange, imageZoomLevelMin, $imageZoomLevelRange, $imageZoomLevel, tabs, transformSelected, shouldRenderFooter, $imageCropRect, shouldRenderInfoIndicator, stageRef, cropEnableZoom, $rootRect, imageSelectionRectOffset, $isActive, cropImageSelectionCornerStyle, shouldRenderImageSelection, canCenter, $recenterOpacity, $recenterOffset, shouldRenderImageSelectionRecenterButton, cropTools*/2146402302|dirty[7]&/*$$scope*/2){util_changes.$$scope={dirty:dirty,ctx:ctx};}if(!updating_root&&dirty[0]&/*root*/32768){updating_root=true;util_changes.root=/*root*/ctx[15];add_flush_callback(function(){return updating_root=false;});}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}var imageZoomLevelMax=1;var imageZoomLevelBase=0;var interactable_function$1=function interactable_function$1(e,element){return e.target===element;};function instance$m($$self,$$props,$$invalidate){var hasCropSelectPresetOptions;var cropTools;var imageZoomLevelMin;var imageSelectionOffset;var imageSelectionCenter;var imageSelectionCenteredRect;var isImageSelectionDisplayed;var isImageSelectionCentered;var isResizingSelection;var isMaxSelectionRect;var isOverlayMode;var canZoomToCenter;var canCenter;var shouldRenderInfoIndicator;var shouldRenderImageSelection;var shouldRenderImageSelectionRecenterButton;var imageSelectionRectOffset;var hasPlentyVerticalSpace;var shouldRenderPresetSelect;var shouldRenderToolbar;var couldRenderZoomInput;var shouldRenderZoomInput;var shouldRenderFooter;var tabsConfig;var tabs;var panels;var footerStyle;var $footerOffset;var $isActive,$$unsubscribe_isActive=noop,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(12,$isActive=$$value);}),isActive;};var $isAnimated;var $env;var $imageSelectionGuides;var $imageOverlayMarkup;var $stagePadded;var $imagePreviewModifiers;var $imageSelectionRectPresentation;var $isInteracting;var $imageIsStatic;var $imageCropRect;var $imageScalar;var $presentationScalar;var $utilRectPadded;var $imageSelectionRectSnapshot;var $imageSelectionRect;var $stageRect;var $isTransformingImage;var $imageCropRangeAspectRatio;var $imageSize;var $imageRotation;var $imageCropLimitToImage;var $imageCropMinSize;var $rootRect;var $imageCropRectIntent;var $imageCropRange;var $imageCropRectOrigin;var $imageCropAspectRatio;var $imageCropMaxSize;var $imageStaticVisualCorners;var $imageSelectionRectIntent;var $utilTools;var $imageOutputSize;var $selectedPresetIndex;var $formattedCropPresetOptions;var $imageFlipY;var $imageFlipX;var $redrawTrigger;var $elasticityMultiplier;var $imageRotationRange;var $imageZoomLevelRange;var $imageZoomLevel;var $recenterOpacity;var $recenterOffset;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});var name='crop';var isActive=$$props.isActive;$$subscribe_isActive();var stores=$$props.stores;var _$$props$cropImageSel=$$props.cropImageSelectionCornerStyle,cropImageSelectionCornerStyle=_$$props$cropImageSel===void 0?'circle':_$$props$cropImageSel;var _$$props$cropWillRend=$$props.cropWillRenderImageSelectionGuides,cropWillRenderImageSelectionGuides=_$$props$cropWillRend===void 0?function(interaction,interactionFraction){var isRotating=interaction=='rotate';return{rows:isRotating?5:3,cols:isRotating?5:3,opacity:interactionFraction*0.25};}:_$$props$cropWillRend;var _$$props$cropAutoCent=$$props.cropAutoCenterImageSelectionTimeout,cropAutoCenterImageSelectionTimeout=_$$props$cropAutoCent===void 0?undefined:_$$props$cropAutoCent;var _$$props$cropEnableZo=$$props.cropEnableZoomMatchImageAspectRatio,cropEnableZoomMatchImageAspectRatio=_$$props$cropEnableZo===void 0?true:_$$props$cropEnableZo;var _$$props$cropEnableRo=$$props.cropEnableRotateMatchImageAspectRatio,cropEnableRotateMatchImageAspectRatio=_$$props$cropEnableRo===void 0?'never':_$$props$cropEnableRo;var _$$props$cropEnableRo2=$$props.cropEnableRotationInput,cropEnableRotationInput=_$$props$cropEnableRo2===void 0?true:_$$props$cropEnableRo2;var _$$props$cropEnableZo2=$$props.cropEnableZoom,cropEnableZoom=_$$props$cropEnableZo2===void 0?true:_$$props$cropEnableZo2;var _$$props$cropEnableZo3=$$props.cropEnableZoomInput,cropEnableZoomInput=_$$props$cropEnableZo3===void 0?true:_$$props$cropEnableZo3;var _$$props$cropEnableZo4=$$props.cropEnableZoomAutoHide,cropEnableZoomAutoHide=_$$props$cropEnableZo4===void 0?true:_$$props$cropEnableZo4;var _$$props$cropEnableIm=$$props.cropEnableImageSelection,cropEnableImageSelection=_$$props$cropEnableIm===void 0?true:_$$props$cropEnableIm;var _$$props$cropEnableIn=$$props.cropEnableInfoIndicator,cropEnableInfoIndicator=_$$props$cropEnableIn===void 0?false:_$$props$cropEnableIn;var _$$props$cropEnableZo5=$$props.cropEnableZoomTowardsWheelPosition,cropEnableZoomTowardsWheelPosition=_$$props$cropEnableZo5===void 0?true:_$$props$cropEnableZo5;var _$$props$cropEnableLi=$$props.cropEnableLimitWheelInputToCropSelection,cropEnableLimitWheelInputToCropSelection=_$$props$cropEnableLi===void 0?true:_$$props$cropEnableLi;var _$$props$cropEnableCe=$$props.cropEnableCenterImageSelection,cropEnableCenterImageSelection=_$$props$cropEnableCe===void 0?true:_$$props$cropEnableCe;var _$$props$cropEnableBu=$$props.cropEnableButtonRotateLeft,cropEnableButtonRotateLeft=_$$props$cropEnableBu===void 0?true:_$$props$cropEnableBu;var _$$props$cropEnableBu2=$$props.cropEnableButtonRotateRight,cropEnableButtonRotateRight=_$$props$cropEnableBu2===void 0?false:_$$props$cropEnableBu2;var _$$props$cropEnableBu3=$$props.cropEnableButtonFlipHorizontal,cropEnableButtonFlipHorizontal=_$$props$cropEnableBu3===void 0?true:_$$props$cropEnableBu3;var _$$props$cropEnableBu4=$$props.cropEnableButtonFlipVertical,cropEnableButtonFlipVertical=_$$props$cropEnableBu4===void 0?false:_$$props$cropEnableBu4;var _$$props$cropSelectPr=$$props.cropSelectPresetOptions,cropSelectPresetOptions=_$$props$cropSelectPr===void 0?undefined:_$$props$cropSelectPr;var _$$props$cropEnableSe=$$props.cropEnableSelectPreset,cropEnableSelectPreset=_$$props$cropEnableSe===void 0?true:_$$props$cropEnableSe;var _$$props$cropEnableFi=$$props.cropEnableFilterMatchAspectRatio,cropEnableFilterMatchAspectRatio=_$$props$cropEnableFi===void 0?true:_$$props$cropEnableFi;var _$$props$cropSelectPr2=$$props.cropSelectPresetFilter,cropSelectPresetFilter=_$$props$cropSelectPr2===void 0?false:_$$props$cropSelectPr2;var _$$props$cropEnableBu5=$$props.cropEnableButtonToggleCropLimit,cropEnableButtonToggleCropLimit=_$$props$cropEnableBu5===void 0?false:_$$props$cropEnableBu5;var _$$props$cropWillRend2=$$props.cropWillRenderTools,cropWillRenderTools=_$$props$cropWillRend2===void 0?passthrough:_$$props$cropWillRend2;var _$$props$cropActiveTr=$$props.cropActiveTransformTool,cropActiveTransformTool=_$$props$cropActiveTr===void 0?'rotation':_$$props$cropActiveTr;var _$$props$cropMinimize=$$props.cropMinimizeToolbar,cropMinimizeToolbar=_$$props$cropMinimize===void 0?'auto':_$$props$cropMinimize;var _$$props$cropInteract=$$props.cropInteractionFocus,cropInteractionFocus=_$$props$cropInteract===void 0?'image':_$$props$cropInteract;var _$$props$cropRotation=$$props.cropRotationRange,cropRotationRange=_$$props$cropRotation===void 0?QUART_PI:_$$props$cropRotation;var _$$props$cropMaskOpac=$$props.cropMaskOpacity,cropMaskOpacity=_$$props$cropMaskOpac===void 0?0.85:_$$props$cropMaskOpac;var _$$props$locale5=$$props.locale,locale=_$$props$locale5===void 0?{}:_$$props$locale5;// context
var isAnimated=getContext('isAnimated');component_subscribe($$self,isAnimated,function(value){return $$invalidate(139,$isAnimated=value);});var elasticityMultiplier=getContext('elasticityMultiplier');component_subscribe($$self,elasticityMultiplier,function(value){return $$invalidate(25,$elasticityMultiplier=value);});var redrawTrigger=getContext('redrawTrigger');component_subscribe($$self,redrawTrigger,function(value){return $$invalidate(159,$redrawTrigger=value);});var imageIsStatic=getContext('imageIsStatic');component_subscribe($$self,imageIsStatic,function(value){return $$invalidate(145,$imageIsStatic=value);});var imageStaticVisualCorners=getContext('imageStaticVisualCorners');component_subscribe($$self,imageStaticVisualCorners,function(value){return $$invalidate(181,$imageStaticVisualCorners=value);});// state
var interaction='idle';// formatted crop select options
var formattedCropPresetOptions=writable();component_subscribe($$self,formattedCropPresetOptions,function(value){return $$invalidate(156,$formattedCropPresetOptions=value);});// #region helpers
var isCustomCrop=function isCustomCrop(){return $imageCropAspectRatio===undefined;};var turnAspectRatio=function turnAspectRatio(aspectRatio){return 1/aspectRatio;};var applyCropPresetFilter=function applyCropPresetFilter(filter){// no change
if(!cropEnableFilterMatchAspectRatio||cropSelectPresetFilter===filter)return;// change
$$invalidate(95,cropSelectPresetFilter=filter);// square or free, exit
if(!$imageCropAspectRatio||$imageCropAspectRatio===1)return;if(!hasValidRotatedCropAspectRatio())return;set_store_value(imageCropAspectRatio,$imageCropAspectRatio=turnAspectRatio($imageCropAspectRatio),$imageCropAspectRatio);};var hasValidRotatedCropAspectRatio=function hasValidRotatedCropAspectRatio(){// no options available, forced crop aspect ratio
if($imageCropAspectRatio===1||!hasCropSelectPresetOptions)return false;// get rotated
var rotatedImageCropAspectRatio=turnAspectRatio($imageCropAspectRatio);// options available but no valid option in list
if(!flattenOptions($formattedCropPresetOptions).find(function(_ref363){var _ref364=_slicedToArray(_ref363,1),aspectRatio=_ref364[0];return aspectRatio===rotatedImageCropAspectRatio;})){return false;}return true;};var isCropMaxSize=function isCropMaxSize(imageCropRect,imageSize,imageRotation){return isRotatedSideways(imageRotation)?imageSize.width===Math.round(imageCropRect.height)||imageSize.height===Math.round(imageCropRect.width):imageSize.width===Math.round(imageCropRect.width)||imageSize.height===Math.round(imageCropRect.height);};var isCropCentered=function isCropCentered(imageCropRect,imageSize,imageRotation){var imageSizeRotated=sizeApply(sizeRotate(sizeClone(imageSize),imageRotation),function(v){return Math.abs(Math.round(v));});var imageCenter=sizeCenter(imageSizeRotated);var cropCenter=rectCenter(imageCropRect);return vectorEqual(imageCenter,cropCenter);};var canMatchCropAspectRatioToRotation=function canMatchCropAspectRatioToRotation(){return(// is custom crop mode
(isCustomCrop()||// can match preset crop and preset is available
cropEnableRotateMatchImageAspectRatio==='always'&&hasValidRotatedCropAspectRatio())&&isCropCentered($imageCropRect,$imageSize,$imageRotation)&&isCropMaxSize($imageCropRect,$imageSize,$imageRotation));};var applyRotation=function applyRotation(value){if(cropEnableRotateMatchImageAspectRatio!=='never'&&canMatchCropAspectRatioToRotation()){set_store_value(imageRotation,$imageRotation+=value,$imageRotation);var isRotated=isRotatedSideways($imageRotation);var w=isRotated?$imageSize.height:$imageSize.width;var _h3=isRotated?$imageSize.width:$imageSize.height;set_store_value(imageCropRect,$imageCropRect=rectCreate(0,0,w,_h3),$imageCropRect);if(!isCustomCrop())set_store_value(imageCropAspectRatio,$imageCropAspectRatio=getAspectRatio(w,_h3),$imageCropAspectRatio);}else{set_store_value(imageRotation,$imageRotation+=value,$imageRotation);}};//#endregion
var _stores3=stores,history=_stores3.history,env=_stores3.env,isInteracting=_stores3.isInteracting,isInteractingFraction=_stores3.isInteractingFraction,isTransformingImage=_stores3.isTransformingImage,rootRect=_stores3.rootRect,stageRect=_stores3.stageRect,utilRect=_stores3.utilRect,utilRectPadded=_stores3.utilRectPadded,rootLineColor=_stores3.rootLineColor,allowPan=_stores3.allowPan,allowZoom=_stores3.allowZoom,rangeInputElasticity=_stores3.rangeInputElasticity,presentationScalar=_stores3.presentationScalar,utilTools=_stores3.utilTools,imagePreviewModifiers=_stores3.imagePreviewModifiers,imageOutlineOpacity=_stores3.imageOutlineOpacity,imageFlipX=_stores3.imageFlipX,imageFlipY=_stores3.imageFlipY,imageRotation=_stores3.imageRotation,imageRotationRange=_stores3.imageRotationRange,imageOutputSize=_stores3.imageOutputSize,imageSelectionRect=_stores3.imageSelectionRect,imageSelectionRectSnapshot=_stores3.imageSelectionRectSnapshot,imageSelectionRectIntent=_stores3.imageSelectionRectIntent,imageSelectionRectPresentation=_stores3.imageSelectionRectPresentation,imageCropRectIntent=_stores3.imageCropRectIntent,imageCropRectOrigin=_stores3.imageCropRectOrigin,imageCropRect=_stores3.imageCropRect,imageCropMinSize=_stores3.imageCropMinSize,imageCropMaxSize=_stores3.imageCropMaxSize,imageCropRange=_stores3.imageCropRange,imageCropAspectRatio=_stores3.imageCropAspectRatio,imageCropLimitToImage=_stores3.imageCropLimitToImage,imageSize=_stores3.imageSize,imageScalar=_stores3.imageScalar,imageOverlayMarkup=_stores3.imageOverlayMarkup,stagePadded=_stores3.stagePadded,stageRecenter=_stores3.stageRecenter;component_subscribe($$self,env,function(value){return $$invalidate(140,$env=value);});component_subscribe($$self,isInteracting,function(value){return $$invalidate(144,$isInteracting=value);});component_subscribe($$self,isTransformingImage,function(value){return $$invalidate(174,$isTransformingImage=value);});component_subscribe($$self,rootRect,function(value){return $$invalidate(24,$rootRect=value);});component_subscribe($$self,stageRect,function(value){return $$invalidate(151,$stageRect=value);});component_subscribe($$self,utilRectPadded,function(value){return $$invalidate(148,$utilRectPadded=value);});component_subscribe($$self,presentationScalar,function(value){return $$invalidate(147,$presentationScalar=value);});component_subscribe($$self,utilTools,function(value){return $$invalidate(183,$utilTools=value);});component_subscribe($$self,imagePreviewModifiers,function(value){return $$invalidate(173,$imagePreviewModifiers=value);});component_subscribe($$self,imageFlipX,function(value){return $$invalidate(158,$imageFlipX=value);});component_subscribe($$self,imageFlipY,function(value){return $$invalidate(157,$imageFlipY=value);});component_subscribe($$self,imageRotation,function(value){return $$invalidate(14,$imageRotation=value);});component_subscribe($$self,imageRotationRange,function(value){return $$invalidate(26,$imageRotationRange=value);});component_subscribe($$self,imageOutputSize,function(value){return $$invalidate(184,$imageOutputSize=value);});component_subscribe($$self,imageSelectionRect,function(value){return $$invalidate(150,$imageSelectionRect=value);});component_subscribe($$self,imageSelectionRectSnapshot,function(value){return $$invalidate(149,$imageSelectionRectSnapshot=value);});component_subscribe($$self,imageSelectionRectIntent,function(value){return $$invalidate(182,$imageSelectionRectIntent=value);});component_subscribe($$self,imageSelectionRectPresentation,function(value){return $$invalidate(143,$imageSelectionRectPresentation=value);});component_subscribe($$self,imageCropRectIntent,function(value){return $$invalidate(176,$imageCropRectIntent=value);});component_subscribe($$self,imageCropRectOrigin,function(value){return $$invalidate(178,$imageCropRectOrigin=value);});component_subscribe($$self,imageCropRect,function(value){return $$invalidate(13,$imageCropRect=value);});component_subscribe($$self,imageCropMinSize,function(value){return $$invalidate(154,$imageCropMinSize=value);});component_subscribe($$self,imageCropMaxSize,function(value){return $$invalidate(180,$imageCropMaxSize=value);});component_subscribe($$self,imageCropRange,function(value){return $$invalidate(177,$imageCropRange=value);});component_subscribe($$self,imageCropAspectRatio,function(value){return $$invalidate(179,$imageCropAspectRatio=value);});component_subscribe($$self,imageCropLimitToImage,function(value){return $$invalidate(153,$imageCropLimitToImage=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(152,$imageSize=value);});component_subscribe($$self,imageScalar,function(value){return $$invalidate(146,$imageScalar=value);});component_subscribe($$self,imageOverlayMarkup,function(value){return $$invalidate(172,$imageOverlayMarkup=value);});component_subscribe($$self,stagePadded,function(value){return $$invalidate(142,$stagePadded=value);});// #endregion
// #region adjusting crop selection
// let presentationScalarSnapshot;
// let imageSelectionRectMinSize;
// let imageSelectionRectMaxSize;
var imageSelectionTranslator;var handleSelectionGrab=function handleSelectionGrab(){interaction='select';// now interacting
set_store_value(isInteracting,$isInteracting=true,$isInteracting);// we remember the current view rect and crop rect, because that is the crop rect we use as a starting point to transform while dragging
set_store_value(imageSelectionRectSnapshot,$imageSelectionRectSnapshot=rectClone$1($imageSelectionRect),$imageSelectionRectSnapshot);// which translator to use
imageSelectionTranslator=$imageIsStatic?translateStaticSelection:translateImageSelection;};var handleSelectionDrag=function handleSelectionDrag(_ref365){var detail=_ref365.detail;var _imageSelectionTransl=imageSelectionTranslator(detail.direction,detail.translation),boundsLimited=_imageSelectionTransl.boundsLimited,boundsIntent=_imageSelectionTransl.boundsIntent;// now transforming image
set_store_value(isTransformingImage,$isTransformingImage=true,$isTransformingImage);// update actual image selection rectangle
set_store_value(imageSelectionRectIntent,$imageSelectionRectIntent=boundsIntent,$imageSelectionRectIntent);// intent needs to be updated first because has no listeners attached
set_store_value(imageSelectionRect,$imageSelectionRect=boundsLimited,$imageSelectionRect);};var handleSelectionRelease=function handleSelectionRelease(_ref366){var detail=_ref366.detail;var _imageSelectionTransl2=imageSelectionTranslator(detail.direction,detail.translation),boundsLimited=_imageSelectionTransl2.boundsLimited;// no longer transforming image
set_store_value(isTransformingImage,$isTransformingImage=false,$isTransformingImage);// we're no longer interacting with the image selection, we need to set this here so the image selection presentation is animated when applying the new bounds below
set_store_value(isInteracting,$isInteracting=false,$isInteracting);// no more intent as we're finalizing the selection, so before setting the final selection, we set this to undefined | intent needs to be updated first because has no listeners attached
set_store_value(imageSelectionRectIntent,$imageSelectionRectIntent=undefined,$imageSelectionRectIntent);// confirm the limited rect if actually made a change
if(vectorLength(detail.translation)){set_store_value(imageSelectionRect,$imageSelectionRect=boundsLimited,$imageSelectionRect);history.write();}// need to set this to undefined after setting the final rect, the snapshot is used to calculate the crop rect transform
set_store_value(imageSelectionRectSnapshot,$imageSelectionRectSnapshot=undefined,$imageSelectionRectSnapshot);// done interacting with selection
interaction=undefined;};var translateStaticSelection=function translateStaticSelection(target,translate){// - selection may grow to max bounds (util bounds when _not_ static image)
// - when image is static selection may grow to image polygon edges
// - when not static image the image preview(!) is scaled to fit the selection, actual image size is not affected
// - we always need to make sure the selection adheres to the aspect ratio of the min size
var directionTranslation={target:target,translate:translate};var imageSelectionRectMinSize=sizeScale(sizeClone($imageCropMinSize),$presentationScalar);var imageSelectionRectMaxSize=sizeScale(sizeClone($imageCropMaxSize),$presentationScalar);// make sure not smaller
var rectIntended=limitRectDirectionTranslation($imageSelectionRectSnapshot,directionTranslation,_objectSpread(_objectSpread({},$utilRectPadded),{},{x:0,y:0}),{aspectRatio:$imageCropAspectRatio,minSize:imageSelectionRectMinSize,maxSize:imageSelectionRectMaxSize});// limit selection rect to util bounds
rectIntended=rectLimitInRect(rectIntended,_objectSpread(_objectSpread({},$utilRectPadded),{},{x:0,y:0}),$imageCropAspectRatio);// no limits
if(!$imageCropLimitToImage){return{boundsLimited:rectIntended,boundsIntent:rectIntended};}// limit to image
var rectLimited=getRectLimitedToQuad($imageSelectionRectSnapshot,rectIntended,directionTranslation,$imageStaticVisualCorners,{aspectRatio:$imageCropAspectRatio,minSize:imageSelectionRectMinSize,maxSize:imageSelectionRectMaxSize});return{boundsLimited:rectLimited,boundsIntent:rectLimited};};var translateImageSelection=function translateImageSelection(target,translate){var directionTranslation={target:target,translate:translate};var imageSelectionRectMinSize=sizeScale(sizeClone($imageCropMinSize),$presentationScalar);var imageSelectionRectMaxSize=sizeScale(sizeClone($imageCropMaxSize),$presentationScalar);var rectIntended=applyRectDirectionTranslation($imageSelectionRectSnapshot,directionTranslation,{aspectRatio:$imageCropAspectRatio,// used to make sure that min size is respected when dragging from centered anchor point (dragging edge), if we don't do this we get unwanted elastic effects when the presented image is scaled while dragging an edge
minSize:imageSelectionRectMinSize});// limit rectangle to util bounds
var rectLimited=limitRectDirectionTranslation($imageSelectionRectSnapshot,directionTranslation,_objectSpread(_objectSpread({},$utilRectPadded),{},{x:0,y:0}),{aspectRatio:$imageCropAspectRatio,minSize:imageSelectionRectMinSize,maxSize:imageSelectionRectMaxSize});return{boundsLimited:rectLimited,boundsIntent:rectIntended};};// #endregion
// #region rotating
var handleRotateStart=function handleRotateStart(){interaction='rotate';// now interacting with view
set_store_value(isInteracting,$isInteracting=true,$isInteracting);// we need to know the origin of the crop so we can "shrink" the image to fit the crop rect while rotating
set_store_value(imageCropRectOrigin,$imageCropRectOrigin=rectClone$1($imageCropRect),$imageCropRectOrigin);};var handleRotateMove=function handleRotateMove(value){// now transforming image
set_store_value(isTransformingImage,$isTransformingImage=true,$isTransformingImage);set_store_value(imageRotation,$imageRotation=value,$imageRotation);// will auto validate
};var handleRotateEnd=function handleRotateEnd(value){// no longer transforming image
set_store_value(isTransformingImage,$isTransformingImage=false,$isTransformingImage);// we're done interacting
set_store_value(isInteracting,$isInteracting=false,$isInteracting);// apply our final rotation value
set_store_value(imageRotation,$imageRotation=value,$imageRotation);history.write();// done, so we no longer need to "shrink" the image
set_store_value(imageCropRectOrigin,$imageCropRectOrigin=undefined,$imageCropRectOrigin);};// #endregion
// #region moving
var interactionCropRect=undefined;var interactionCropRectForce=undefined;var handleImageDragStart=function handleImageDragStart(){interaction='pan';interactionCropRectForce=undefined;set_store_value(isInteracting,$isInteracting=true,$isInteracting);interactionCropRect=rectClone$1($imageCropRect);};var handleImageDrag=function handleImageDrag(_ref367){var detail=_ref367.detail;// now transforming image
set_store_value(isTransformingImage,$isTransformingImage=true,$isTransformingImage);manipulateImage(detail);};var handleImageDragEnd=function handleImageDragEnd(_ref368){var detail=_ref368.detail;// no longer transforming image
set_store_value(isTransformingImage,$isTransformingImage=false,$isTransformingImage);// done interacting
set_store_value(isInteracting,$isInteracting=false,$isInteracting);// apply translation to the crop rect only if did make changes
if(vectorLength(detail.translation)>0||detail.scalar!==0){manipulateImage(detail);history.write();}// no intent (needs to be set before crop rect is updated)
set_store_value(imageCropRectIntent,$imageCropRectIntent=undefined,$imageCropRectIntent);// now done
interactionCropRect=undefined;};var handleImageDragRelease=function handleImageDragRelease(_ref369){var translation=_ref369.detail.translation;// flip translation direction as we are dragging crop selection
if($imageIsStatic)translation=vectorInvert(vectorClone(translation));interactionCropRectForce=translation;set_store_value(isInteracting,$isInteracting=false,$isInteracting);};var manipulateImage=function manipulateImage(_ref370){var translation=_ref370.translation,scalar=_ref370.scalar;// flip translation direction as we are dragging crop selection
if($imageIsStatic){scalar=1;translation=vectorInvert(vectorClone(translation));}var imageSelectionRectZoomFactor=Math.min($imageSelectionRect.width/$imageCropRect.width,$imageSelectionRect.height/$imageCropRect.height);var scaledTranslation=vectorMultiply(vectorClone(translation),1/imageSelectionRectZoomFactor);// while we're interacting we apply changes to the original crop rectangle, after we apply a force
var cropIntent;if(!interactionCropRectForce){cropIntent=rectTranslate$1(rectClone$1(interactionCropRect),vectorInvert(vectorClone(scaledTranslation)));if(scalar!==undefined)rectScale$1(cropIntent,1/scalar);}else{// we apply the force to the existing crop rect so animation is not borked
var forceTranslation=vectorSubtract(vectorClone(interactionCropRectForce),translation);interactionCropRectForce=translation;cropIntent=rectTranslate$1(rectClone$1($imageCropRect),forceTranslation);}// update crop rect
set_store_value(imageCropRectIntent,$imageCropRectIntent=cropIntent,$imageCropRectIntent);// auto calculates an elastic effect if bounds exceeded (needs to be set before crop rect is updated)
set_store_value(imageCropRect,$imageCropRect=cropIntent,$imageCropRect);// auto limits to bounds if needed
};// #endregion
// #region resize with range input
var IMAGE_ZOOM_LEVEL_MIN=-1;var calculateZoomLevel=function calculateZoomLevel(imageSize,size,imageRotation){if(isRotatedSideways(imageRotation)){return 1-1/Math.min(imageSize.height/size.width,imageSize.width/size.height);}return 1-1/Math.min(imageSize.width/size.width,imageSize.height/size.height);};var imageCropRangeAspectRatio=derived([imageCropRange,imageCropRect],function(_ref371,set){var _ref372=_slicedToArray(_ref371,2),$imageCropRange=_ref372[0],$imageCropRect=_ref372[1];if(!$imageCropRect)return;var _$imageCropRange=_slicedToArray($imageCropRange,2),minSize=_$imageCropRange[0],maxSize=_$imageCropRange[1];var aspectRatio=rectAspectRatio($imageCropRect);set([sizeCreateFromRect(rectApply(rectCoverRect(minSize,aspectRatio),fixPrecision)),sizeCreateFromRect(rectApply(rectContainRect(maxSize,aspectRatio),fixPrecision))]);});component_subscribe($$self,imageCropRangeAspectRatio,function(value){return $$invalidate(175,$imageCropRangeAspectRatio=value);});// this is the max value range that can be set (triggers white range indicator bar)
var imageZoomLevelRange=derived([imageSize,imageCropLimitToImage,imageCropMinSize,imageCropMaxSize,imageCropRange,imageRotation],function(_ref373,set){var _ref374=_slicedToArray(_ref373,6),$imageSize=_ref374[0],$imageCropLimitToImage=_ref374[1],$imageCropMinSize=_ref374[2],$imageCropMaxSize=_ref374[3],$imageCropRange=_ref374[4],$imageRotation=_ref374[5];if(!$imageSize)return;var rangeMinSize=$imageCropRange[0];var rangeMaxSize=$imageCropRange[1];var minZoom;var maxZoom;// can't zoom out
if($imageCropLimitToImage){minZoom=calculateZoomLevel($imageSize,rangeMaxSize,$imageRotation);maxZoom=Math.min(rangeMinSize.width/$imageCropMinSize.width,rangeMinSize.height/$imageCropMinSize.height);}else{minZoom=IMAGE_ZOOM_LEVEL_MIN;maxZoom=1;}var range=[minZoom,maxZoom].map(function(v){return fixPrecision(v);});set(range);});component_subscribe($$self,imageZoomLevelRange,function(value){return $$invalidate(27,$imageZoomLevelRange=value);});var imageZoomLevel=derived([imageSize,imageCropRect,imageCropRange,imageRotation],function(_ref375,set){var _ref376=_slicedToArray(_ref375,4),$imageSize=_ref376[0],$imageCropRect=_ref376[1],$imageCropRange=_ref376[2],$imageRotation=_ref376[3];// need to check if this value is set, could be that it's empty while loading a new image
if(!$imageSize||!$imageCropRect)return set(0);var z;var rangeMinSize=$imageCropRange[0];var rangeMaxSize=$imageCropRange[1];var currentCropWidth=$imageCropRect.width;var currentCropHeight=$imageCropRect.height;var currentCropAspectRatio=rectAspectRatio($imageCropRect);var imageRect=isRotatedSideways($imageRotation)?sizeCreate($imageSize.height,$imageSize.width):$imageSize;var imageCropMaxRect=rectContainRect(imageRect,currentCropAspectRatio);if(currentCropWidth<=imageCropMaxRect.width||currentCropHeight<=imageCropMaxRect.height){// zoomed in
var w=imageCropMaxRect.width-rangeMinSize.width;var _h4=imageCropMaxRect.height-rangeMinSize.height;// cannot zoom in
if(w===0||_h4===0){z=1;}else{z=1-Math.min((currentCropWidth-rangeMinSize.width)/w,(currentCropHeight-rangeMinSize.height)/_h4);}}else{// zoomed out
var _w=rangeMaxSize.width-imageCropMaxRect.width;var _h5=rangeMaxSize.height-imageCropMaxRect.height;var _r9=rectContainRect({width:_w,height:_h5},currentCropAspectRatio);z=-Math.min((currentCropWidth-imageCropMaxRect.width)/_r9.width,(currentCropHeight-imageCropMaxRect.height)/_r9.height);}set(z);});component_subscribe($$self,imageZoomLevel,function(value){return $$invalidate(28,$imageZoomLevel=value);});var snapshotCropRect=function snapshotCropRect(){interactionCropRect=rectClone$1($imageCropRect);};var resizeImage=function resizeImage(zoom){var aspectRatio=rectAspectRatio(interactionCropRect);var targetWidth;var targetHeight;var r;var imageRect=isRotatedSideways($imageRotation)?sizeCreate($imageSize.height,$imageSize.width):$imageSize;var imageCropMaxRect=rectContainRect(imageRect,aspectRatio);if(zoom>=0){// zoom in
var rangeWidth=imageCropMaxRect.width-$imageCropRange[0].width;var rangeHeight=imageCropMaxRect.height-$imageCropRange[0].height;targetWidth=imageCropMaxRect.width-rangeWidth*zoom;targetHeight=imageCropMaxRect.height-rangeHeight*zoom;r=rectCoverRect({width:targetWidth,height:targetHeight},aspectRatio);}else{// zoom out
var _rangeWidth=$imageCropRange[1].width-imageCropMaxRect.width;var _rangeHeight=$imageCropRange[1].height-imageCropMaxRect.height;targetWidth=imageCropMaxRect.width+_rangeWidth*-zoom;targetHeight=imageCropMaxRect.height+_rangeHeight*-zoom;r=rectContainRect({width:targetWidth,height:targetHeight},aspectRatio);}targetWidth=r.width;targetHeight=r.height;var targetX=interactionCropRect.x+interactionCropRect.width*0.5-targetWidth*0.5;var targetY=interactionCropRect.y+interactionCropRect.height*0.5-targetHeight*0.5;set_store_value(imageCropRect,$imageCropRect={x:targetX,y:targetY,width:targetWidth,height:targetHeight},$imageCropRect);};var handleResizeStart=function handleResizeStart(){interaction='zoom';// now interacting with view
set_store_value(isInteracting,$isInteracting=true,$isInteracting);snapshotCropRect();};var handleResizeMove=function handleResizeMove(value){// now transforming image
set_store_value(isTransformingImage,$isTransformingImage=false,$isTransformingImage);// value range from 0 (no zoom) to 1 (100% zoom, 1x1 pixel)
resizeImage(value);};var handleResizeEnd=function handleResizeEnd(value){resizeImage(value);history.write();// no longer transforming image
set_store_value(isTransformingImage,$isTransformingImage=false,$isTransformingImage);// we're done interacting
set_store_value(isInteracting,$isInteracting=false,$isInteracting);// now done
interactionCropRect=undefined;};//#endregion
// #region resize with gesture (MacBook trackpad Safari)
var gestureOriginCropRect;var handleGestureStart=function handleGestureStart(){interaction='zoom';// don't handle gesture as we're already handling input with interactable
if(interactionCropRect)return;gestureOriginCropRect=rectClone$1($imageCropRect);// now interacting
set_store_value(isInteracting,$isInteracting=true,$isInteracting);};var handleGestureUpdate=function handleGestureUpdate(_ref377){var detail=_ref377.detail;// don't handle gesture as we're already handling input with interactable
if(!gestureOriginCropRect)return;// now transforming image
set_store_value(isTransformingImage,$isTransformingImage=true,$isTransformingImage);handleScaleGesture(detail);};var handleScaleGesture=function handleScaleGesture(scale){var cropIntent=rectScale$1(rectClone$1(gestureOriginCropRect),1/scale);set_store_value(imageCropRectIntent,$imageCropRectIntent=cropIntent,$imageCropRectIntent);set_store_value(imageCropRect,$imageCropRect=cropIntent,$imageCropRect);};var handleGestureEnd=function handleGestureEnd(_ref378){var detail=_ref378.detail;// don't handle gesture as we're already handling input with interactable
if(!gestureOriginCropRect)return;// no longer transforming image
set_store_value(isTransformingImage,$isTransformingImage=false,$isTransformingImage);// no longer interacting
set_store_value(isInteracting,$isInteracting=false,$isInteracting);handleScaleGesture(detail);// no intent (needs to be set before crop rect is updated)
set_store_value(imageCropRectIntent,$imageCropRectIntent=undefined,$imageCropRectIntent);gestureOriginCropRect=undefined;history.write();};// #endregion
// #region resizing with wheel
var zoomHistoryTimeoutId;var handleWheel=function handleWheel(e){var stageWheelPosition=getEventPositionInStage(e,$rootRect,$stageRect);// only block input if wheel is used within image rectangle
if(cropEnableLimitWheelInputToCropSelection&&!rectContainsPoint($imageSelectionRect,stageWheelPosition))return;interaction='zoom';// now interacting
set_store_value(isInteracting,$isInteracting=true,$isInteracting);// transforming image
set_store_value(isTransformingImage,$isTransformingImage=true,$isTransformingImage);// don't run default actions, prevent other actions from running
e.preventDefault();e.stopPropagation();// convert wheel delta to scalar
var delta=getWheelDelta(e);var scalar=1+delta/100;// get current crop rect
var currentCropRect=rectClone$1($imageCropRect);// if already zoomed in, block further zoom in instructions
var isMinSize=Math.min($imageCropRect.width/$imageCropMinSize.width,$imageCropRect.height/$imageCropMinSize.height)===1;// if is fully zoomed out and trying to zoom out more and crop shape is free, fit image aspect ratio
if(cropEnableZoomMatchImageAspectRatio&&$imageCropLimitToImage){var isAtMaxCropSize=isCropMaxSize($imageCropRect,$imageSize,$imageRotation);if(isCustomCrop()&&isAtMaxCropSize&&delta>0&&isImageSelectionCentered){set_store_value(isInteracting,$isInteracting=false,$isInteracting);// no longer transforming image
set_store_value(isTransformingImage,$isTransformingImage=false,$isTransformingImage);var _newCropRect=isRotatedSideways($imageRotation)?rectCreateFromSize({height:$imageSize.width,width:$imageSize.height}):rectCreateFromSize($imageSize);// no change, exit
if(rectEqual(currentCropRect,_newCropRect))return;// if we were previously zooming in we need to clear the timeout to prevent two history entries
clearTimeout(zoomHistoryTimeoutId);// test if crop rect in history is same as new crop rect, this is possible when zooming in and out real quick
if(rectEqual(history.state.crop,_newCropRect))return;// store new crop rect
set_store_value(imageCropRect,$imageCropRect=_newCropRect,$imageCropRect);history.write();return;}}// by default when zooming, zoom from center of crop rectangle
var origin=rectCenter($imageCropRect);// when zooming in, zoom in on the part of the image below the mouse cursor
var shouldZoomTowardsWheelPosition=cropEnableZoomTowardsWheelPosition&&cropInteractionFocus!=='selection';if(shouldZoomTowardsWheelPosition&&delta<0&&!isMinSize){var selectionOffset=vectorSubtract(vectorClone(stageWheelPosition),$imageSelectionRect);var imageSelectionScale=Math.min($imageSelectionRect.width/$imageCropRect.width,$imageSelectionRect.height/$imageCropRect.height);// if wheel is inside image selection rectangle (slightly expanded version), we zoom based on position in the rectangle, if not, we use the selection center
var expandedImageSelection=rectScale$1(rectClone$1($imageSelectionRect),1.1);origin=rectContainsPoint(expandedImageSelection,stageWheelPosition)?vectorAdd(rectClone$1($imageCropRect),vectorMultiply(selectionOffset,1/imageSelectionScale)):origin;}var newCropRect=rectScale$1(rectClone$1($imageCropRect),scalar,origin);// determin if is new crop rect exceeds min or max size, if so, limit
if(!sizeContains($imageCropRangeAspectRatio[1],newCropRect)){// exceeds max size, limit to max size and position at new crop rect center
newCropRect=rectCreateWithCenter(rectCenter(newCropRect),$imageCropRangeAspectRatio[1]);}if(!sizeContains(newCropRect,$imageCropRangeAspectRatio[0])){// exceeds min size, limit to min size and position at new crop rect center
newCropRect=rectCreateWithCenter(rectCenter(newCropRect),$imageCropRangeAspectRatio[0]);}// no change, exit
if(rectEqual(currentCropRect,newCropRect,fixPrecision)){set_store_value(isInteracting,$isInteracting=false,$isInteracting);// no longer transforming image
set_store_value(isTransformingImage,$isTransformingImage=false,$isTransformingImage);return;}// attempt to update the rectangle, we use fixPrecision so the width and height are nice integers when at max zoom (this makes sure the `isMinSize` variable is set to true at this point)
set_store_value(imageCropRect,$imageCropRect=rectApply(newCropRect,function(v){return fixPrecision(v,5);}),$imageCropRect);// done!
set_store_value(isInteracting,$isInteracting=false,$isInteracting);// no longer transforming image
set_store_value(isTransformingImage,$isTransformingImage=false,$isTransformingImage);// write history timer
clearTimeout(zoomHistoryTimeoutId);zoomHistoryTimeoutId=setTimeout(function(){history.write();},500);};// #endregion
// #region recenter
// the 'measure' event triggers the editor to center and scale up the crop
createEventDispatcher();var handleRecenterAction=function handleRecenterAction(){// force recenter
stageRecenter.set({});};// auto recenter after timeout
var cropAutoCenterImageSelectionTimeoutId;// animations
var recenterOpacity=spring(0,{precision:0.0001});component_subscribe($$self,recenterOpacity,function(value){return $$invalidate(29,$recenterOpacity=value);});var recenterOffset=spring();component_subscribe($$self,recenterOffset,function(value){return $$invalidate(30,$recenterOffset=value);});//
// enable seeing the image outside of the crop area, and disable the vignette effect
//
var setPreviewModifiers=function setPreviewModifiers(){set_store_value(imagePreviewModifiers,$imagePreviewModifiers['crop']={maskOpacity:cropMaskOpacity,maskMarkupOpacity:cropMaskOpacity},$imagePreviewModifiers);// trigger store update
imagePreviewModifiers.set($imagePreviewModifiers);};var clearPreviewModifiers=function clearPreviewModifiers(){delete $imagePreviewModifiers['crop'];// trigger store update
imagePreviewModifiers.set($imagePreviewModifiers);};// #region crop selection presets
var selectedPresetIndex=derived([imageCropAspectRatio,imageOutputSize,formattedCropPresetOptions],function(_ref379,set){var _ref380=_slicedToArray(_ref379,3),$cropAspectRatio=_ref380[0],$imageOutputSize=_ref380[1],$formattedCropPresetOptions=_ref380[2];if(!hasCropSelectPresetOptions)return;var options=flattenOptions($formattedCropPresetOptions);var matchedOptionValue=_toConsumableArray(options).// to value
map(function(option){return option[0];}).// sort sizes first
sort(function(a,b){if(isArray(a[0])&&!isArray(b[0]))return 1;return-1;}).// match value
find(function(value){if(isArray(value)&&$imageOutputSize){// size + aspect ratio
var _value2=_slicedToArray(value,2),_width6=_value2[0],_height6=_value2[1];var outputSizeMatches=$imageOutputSize.width===_width6&&$imageOutputSize.height===_height6;var aspectRatioMatches=$cropAspectRatio===getAspectRatio(_width6,_height6);return outputSizeMatches&&aspectRatioMatches;}// aspect ratio
return value===$cropAspectRatio;});// no options found, exit
if(!matchedOptionValue)return set(undefined);var index=options.// to value
map(function(option){return option[0];}).// find index of matching value
findIndex(function(value){return isArray(value)?arrayEqual(value,matchedOptionValue):value===matchedOptionValue;});set(index);});component_subscribe($$self,selectedPresetIndex,function(value){return $$invalidate(155,$selectedPresetIndex=value);});var getAspectRatioBySelectedIndex=function getAspectRatioBySelectedIndex(selectedIndex,options){if(!hasCropSelectPresetOptions||selectedIndex===-1||selectedIndex===undefined)return;var selectedValue=flattenOptions(options)[selectedIndex][0];return!selectedValue?undefined:isArray(selectedValue)?getAspectRatio(selectedValue[0],selectedValue[1]):selectedValue;};// #endregion
// #region crop guides
var imageSelectionGuides=derived([rootLineColor,imageSelectionRectPresentation,isInteractingFraction],function(_ref381,set){var _ref382=_slicedToArray(_ref381,3),$rootLineColor=_ref382[0],$rect=_ref382[1],$isInteractingFraction=_ref382[2];var _cropWillRenderImageS=cropWillRenderImageSelectionGuides(interaction,$isInteractingFraction),rows=_cropWillRenderImageS.rows,cols=_cropWillRenderImageS.cols,opacity=_cropWillRenderImageS.opacity;if(!$rect||opacity<=0)return set([]);var x=$rect.x,y=$rect.y,width=$rect.width,height=$rect.height;var w=width/cols;var h=height/rows;var shapes=[];// rows
for(var _r10=1;_r10<=rows-1;_r10++){var yo=y+h*_r10;shapes.push({id:"image-selection-guide-row-".concat(_r10),points:[vectorCreate(x,yo),vectorCreate(x+width,yo)],opacity:opacity,strokeWidth:1,strokeColor:$rootLineColor});}// cols
for(var c=1;c<=cols-1;c++){var xo=x+w*c;shapes.push({id:"image-selection-guide-col-".concat(c),points:[vectorCreate(xo,y),vectorCreate(xo,y+height)],opacity:opacity,strokeWidth:1,strokeColor:$rootLineColor});}set(shapes);});component_subscribe($$self,imageSelectionGuides,function(value){return $$invalidate(141,$imageSelectionGuides=value);});var syncGuides=function syncGuides(){// remove existing guides
var overlayMarkup=$imageOverlayMarkup.filter(function(markup){return!/^image\-selection\-guide/.test(markup.id);});if($isActive){set_store_value(imageOverlayMarkup,$imageOverlayMarkup=[].concat(_toConsumableArray(overlayMarkup),_toConsumableArray($imageSelectionGuides)),$imageOverlayMarkup);}else{set_store_value(imageOverlayMarkup,$imageOverlayMarkup=overlayMarkup,$imageOverlayMarkup);}};var cropUniqueId="crop-".concat(getUniqueId());var transformInitial=cropEnableRotationInput?cropActiveTransformTool:'zoom';var transformToolInitial=cropUniqueId+'-'+transformInitial;var transformSelected=transformToolInitial;var root=undefined;// fixes rendering issue with stage being empty in overlay mode, this basically redispatches the measure event so the stage is correctly measured
var stageRef;var footerOffset=spring($isAnimated?20:0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(138,$footerOffset=value);});function measure_handler_1(event){bubble.call(this,$$self,event);}var select_handler=function select_handler(_ref383){var detail=_ref383.detail;return $$invalidate(5,transformSelected=detail);};function div0_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){stageRef=$$value;$$invalidate(6,stageRef);});}var interactable_function_1=function interactable_function_1(e){return getEventPositionInViewport(e);};function util_root_binding(value){root=value;$$invalidate(15,root);}function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('isActive'in $$props)$$subscribe_isActive($$invalidate(0,isActive=$$props.isActive));if('stores'in $$props)$$invalidate(97,stores=$$props.stores);if('cropImageSelectionCornerStyle'in $$props)$$invalidate(1,cropImageSelectionCornerStyle=$$props.cropImageSelectionCornerStyle);if('cropWillRenderImageSelectionGuides'in $$props)$$invalidate(98,cropWillRenderImageSelectionGuides=$$props.cropWillRenderImageSelectionGuides);if('cropAutoCenterImageSelectionTimeout'in $$props)$$invalidate(99,cropAutoCenterImageSelectionTimeout=$$props.cropAutoCenterImageSelectionTimeout);if('cropEnableZoomMatchImageAspectRatio'in $$props)$$invalidate(100,cropEnableZoomMatchImageAspectRatio=$$props.cropEnableZoomMatchImageAspectRatio);if('cropEnableRotateMatchImageAspectRatio'in $$props)$$invalidate(101,cropEnableRotateMatchImageAspectRatio=$$props.cropEnableRotateMatchImageAspectRatio);if('cropEnableRotationInput'in $$props)$$invalidate(102,cropEnableRotationInput=$$props.cropEnableRotationInput);if('cropEnableZoom'in $$props)$$invalidate(2,cropEnableZoom=$$props.cropEnableZoom);if('cropEnableZoomInput'in $$props)$$invalidate(103,cropEnableZoomInput=$$props.cropEnableZoomInput);if('cropEnableZoomAutoHide'in $$props)$$invalidate(104,cropEnableZoomAutoHide=$$props.cropEnableZoomAutoHide);if('cropEnableImageSelection'in $$props)$$invalidate(105,cropEnableImageSelection=$$props.cropEnableImageSelection);if('cropEnableInfoIndicator'in $$props)$$invalidate(106,cropEnableInfoIndicator=$$props.cropEnableInfoIndicator);if('cropEnableZoomTowardsWheelPosition'in $$props)$$invalidate(107,cropEnableZoomTowardsWheelPosition=$$props.cropEnableZoomTowardsWheelPosition);if('cropEnableLimitWheelInputToCropSelection'in $$props)$$invalidate(108,cropEnableLimitWheelInputToCropSelection=$$props.cropEnableLimitWheelInputToCropSelection);if('cropEnableCenterImageSelection'in $$props)$$invalidate(109,cropEnableCenterImageSelection=$$props.cropEnableCenterImageSelection);if('cropEnableButtonRotateLeft'in $$props)$$invalidate(110,cropEnableButtonRotateLeft=$$props.cropEnableButtonRotateLeft);if('cropEnableButtonRotateRight'in $$props)$$invalidate(111,cropEnableButtonRotateRight=$$props.cropEnableButtonRotateRight);if('cropEnableButtonFlipHorizontal'in $$props)$$invalidate(112,cropEnableButtonFlipHorizontal=$$props.cropEnableButtonFlipHorizontal);if('cropEnableButtonFlipVertical'in $$props)$$invalidate(113,cropEnableButtonFlipVertical=$$props.cropEnableButtonFlipVertical);if('cropSelectPresetOptions'in $$props)$$invalidate(114,cropSelectPresetOptions=$$props.cropSelectPresetOptions);if('cropEnableSelectPreset'in $$props)$$invalidate(115,cropEnableSelectPreset=$$props.cropEnableSelectPreset);if('cropEnableFilterMatchAspectRatio'in $$props)$$invalidate(116,cropEnableFilterMatchAspectRatio=$$props.cropEnableFilterMatchAspectRatio);if('cropSelectPresetFilter'in $$props)$$invalidate(95,cropSelectPresetFilter=$$props.cropSelectPresetFilter);if('cropEnableButtonToggleCropLimit'in $$props)$$invalidate(117,cropEnableButtonToggleCropLimit=$$props.cropEnableButtonToggleCropLimit);if('cropWillRenderTools'in $$props)$$invalidate(118,cropWillRenderTools=$$props.cropWillRenderTools);if('cropActiveTransformTool'in $$props)$$invalidate(119,cropActiveTransformTool=$$props.cropActiveTransformTool);if('cropMinimizeToolbar'in $$props)$$invalidate(120,cropMinimizeToolbar=$$props.cropMinimizeToolbar);if('cropInteractionFocus'in $$props)$$invalidate(121,cropInteractionFocus=$$props.cropInteractionFocus);if('cropRotationRange'in $$props)$$invalidate(3,cropRotationRange=$$props.cropRotationRange);if('cropMaskOpacity'in $$props)$$invalidate(122,cropMaskOpacity=$$props.cropMaskOpacity);if('locale'in $$props)$$invalidate(4,locale=$$props.locale);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*$isActive*/4096|$$self.$$.dirty[3]&/*cropInteractionFocus*/268435456){imageIsStatic.set(cropInteractionFocus==='selection'&&$isActive);}if($$self.$$.dirty[3]&/*cropSelectPresetOptions*/2097152){$$invalidate(129,hasCropSelectPresetOptions=cropSelectPresetOptions&&Array.isArray(cropSelectPresetOptions)&&cropSelectPresetOptions.length);}if($$self.$$.dirty[3]&/*cropSelectPresetOptions*/2097152|$$self.$$.dirty[4]&/*hasCropSelectPresetOptions*/32){formattedCropPresetOptions.set(hasCropSelectPresetOptions?cropSelectPresetOptions:[]);}if($$self.$$.dirty[0]&/*$isActive*/4096){$isActive&&imageOutlineOpacity.set(1);}if($$self.$$.dirty[0]&/*$isActive*/4096){// fully disable pan and zoom when crop tool is active
allowPan.set(!$isActive);}if($$self.$$.dirty[0]&/*$isActive*/4096){allowZoom.set(!$isActive);}if($$self.$$.dirty[4]&/*$env*/65536){$$invalidate(124,isOverlayMode=$env.layoutMode==='overlay');}if($$self.$$.dirty[3]&/*cropEnableSelectPreset*/4194304|$$self.$$.dirty[4]&/*isOverlayMode*/1){$$invalidate(128,shouldRenderPresetSelect=cropEnableSelectPreset&&!isOverlayMode);}if($$self.$$.dirty[4]&/*$utilRectPadded, $imageSelectionRect*/83886080){// determine if we can center the crop, if we can, show the crop center button
$$invalidate(137,imageSelectionCenteredRect=$utilRectPadded&&$imageSelectionRect&&rectCenterRect($utilRectPadded,$imageSelectionRect));}if($$self.$$.dirty[4]&/*$imageSelectionRect, imageSelectionCenteredRect*/67117056){$$invalidate(135,isImageSelectionDisplayed=!!($imageSelectionRect&&imageSelectionCenteredRect));}if($$self.$$.dirty[4]&/*isImageSelectionDisplayed, $imageSelectionRect, imageSelectionCenteredRect*/67119104){$$invalidate(133,isImageSelectionCentered=isImageSelectionDisplayed&&rectEqual($imageSelectionRect,imageSelectionCenteredRect,function(value){return fixPrecision(value,5);}));}if($$self.$$.dirty[0]&/*locale, $imageRotation*/16400|$$self.$$.dirty[3]&/*cropWillRenderTools, cropEnableButtonRotateLeft, cropEnableButtonRotateRight, cropEnableButtonFlipHorizontal, cropEnableButtonFlipVertical, cropSelectPresetFilter, cropEnableButtonToggleCropLimit*/52297732|$$self.$$.dirty[4]&/*shouldRenderPresetSelect, hasCropSelectPresetOptions, isImageSelectionCentered, $imageSize, $imageCropMinSize, $imageCropLimitToImage, $env*/1879114288|$$self.$$.dirty[5]&/*$redrawTrigger, $imageFlipY, $imageFlipX, $selectedPresetIndex, $formattedCropPresetOptions*/31){// #region dynamic toolbar
$$invalidate(11,cropTools=$redrawTrigger&&cropWillRenderTools([cropEnableButtonRotateLeft&&['Button','rotate-left',{label:locale.cropLabelButtonRotateLeft,labelClass:'PinturaToolbarContentWide',icon:locale.cropIconButtonRotateLeft,onclick:function onclick(){applyRotation(-Math.PI/2);history.write();}}],cropEnableButtonRotateRight&&['Button','rotate-right',{label:locale.cropLabelButtonRotateRight,labelClass:'PinturaToolbarContentWide',icon:locale.cropIconButtonRotateRight,onclick:function onclick(){applyRotation(Math.PI/2);history.write();}}],cropEnableButtonFlipHorizontal&&['Button','flip-horizontal',{label:locale.cropLabelButtonFlipHorizontal,labelClass:'PinturaToolbarContentWide',icon:locale.cropIconButtonFlipHorizontal,onclick:function onclick(){if(isRotatedSideways($imageRotation)){set_store_value(imageFlipY,$imageFlipY=!$imageFlipY,$imageFlipY);}else{set_store_value(imageFlipX,$imageFlipX=!$imageFlipX,$imageFlipX);}history.write();}}],cropEnableButtonFlipVertical&&['Button','flip-vertical',{label:locale.cropLabelButtonFlipVertical,labelClass:'PinturaToolbarContentWide',icon:locale.cropIconButtonFlipVertical,onclick:function onclick(){if(isRotatedSideways($imageRotation)){set_store_value(imageFlipX,$imageFlipX=!$imageFlipX,$imageFlipX);}else{set_store_value(imageFlipY,$imageFlipY=!$imageFlipY,$imageFlipY);}history.write();}}],shouldRenderPresetSelect&&hasCropSelectPresetOptions&&[cropSelectPresetFilter===false?'Dropdown':CropPresetList,'select-preset',{icon:localize(locale.cropIconSelectPreset,locale,getAspectRatioBySelectedIndex($selectedPresetIndex,$formattedCropPresetOptions)),label:localize(locale.cropLabelSelectPreset,locale,getAspectRatioBySelectedIndex($selectedPresetIndex,$formattedCropPresetOptions)),labelClass:'PinturaToolbarContentWide',options:$formattedCropPresetOptions,filter:cropSelectPresetFilter,onfilterchange:applyCropPresetFilter,selectedIndex:$selectedPresetIndex,onchange:function onchange(_ref384){var value=_ref384.value;if(isArray(value)){set_store_value(imageCropAspectRatio,$imageCropAspectRatio=getAspectRatio(value[0],value[1]),$imageCropAspectRatio);set_store_value(imageOutputSize,$imageOutputSize=sizeCreateFromArray(value),$imageOutputSize);}else{set_store_value(imageCropAspectRatio,$imageCropAspectRatio=value,$imageCropAspectRatio);}if(isImageSelectionCentered){handleRecenterAction();}history.write();},optionMapper:function optionMapper(option){// if no aspect ratio found we enable the option by default
var disabled=false;// get aspect ratio for this option
var optionAspectRatio=isArray(option.value)?option.value[0]/option.value[1]:option.value;// can be undefined in which case we don't need to check anything
if(optionAspectRatio){var maxCropSize=getMaxSizeInRect($imageSize,$imageRotation,optionAspectRatio);disabled=maxCropSize.width<$imageCropMinSize.width||maxCropSize.height<$imageCropMinSize.height;}// add icon for this option
option.icon=getSelectionPresetOptionIcon(option.value,{bounds:14});return _objectSpread(_objectSpread({},option),{},{disabled:disabled});}}],cropEnableButtonToggleCropLimit&&['Dropdown','select-crop-limit',{icon:localize(locale.cropIconCropBoundary,locale,$imageCropLimitToImage),label:locale.cropLabelCropBoundary,labelClass:'PinturaToolbarContentWide',onchange:function onchange(_ref385){var value=_ref385.value;set_store_value(imageCropLimitToImage,$imageCropLimitToImage=value,$imageCropLimitToImage);history.write();},options:[[true,locale.cropLabelCropBoundaryEdge,{icon:localize(locale.cropIconCropBoundary,locale,true)}],[false,locale.cropLabelCropBoundaryNone,{icon:localize(locale.cropIconCropBoundary,locale,false)}]]}]].filter(Boolean),$env,function(){return redrawTrigger.set({});}).filter(Boolean));}if($$self.$$.dirty[0]&/*$isActive, cropTools*/6144|$$self.$$.dirty[3]&/*cropMinimizeToolbar*/134217728|$$self.$$.dirty[4]&/*$env, isOverlayMode*/65537){set_store_value(utilTools,$utilTools=$isActive&&// should always minimize OR no room OR is overlay mode
cropMinimizeToolbar!=='never'&&(cropMinimizeToolbar==='always'||$env.verticalSpace==='short'||isOverlayMode)?cropTools.map(function(_ref386){var _ref387=_slicedToArray(_ref386,3),name=_ref387[0],id=_ref387[1],props=_ref387[2];// is node children
if(Array.isArray(props))return[name,id,props];// is props
return[name,id,_objectSpread(_objectSpread({},props),{},{hideLabel:true})];}):[],$utilTools);}if($$self.$$.dirty[4]&/*$imageCropLimitToImage*/536870912){$$invalidate(23,imageZoomLevelMin=$imageCropLimitToImage?0:IMAGE_ZOOM_LEVEL_MIN);}if($$self.$$.dirty[4]&/*$utilRectPadded, $stageRect*/150994944){// #endregion
$$invalidate(130,imageSelectionOffset=$utilRectPadded&&vectorCreate(-($stageRect.x-$utilRectPadded.x),-($stageRect.y-$utilRectPadded.y)));}if($$self.$$.dirty[4]&/*$imageSelectionRectPresentation, imageSelectionOffset*/524352){// normalized crop bounds, we use these to limit the crop interactions to the view
$$invalidate(131,imageSelectionCenter=$imageSelectionRectPresentation&&vectorCreate(snapToPixel($imageSelectionRectPresentation.x+$imageSelectionRectPresentation.width*0.5+imageSelectionOffset.x),snapToPixel($imageSelectionRectPresentation.y+$imageSelectionRectPresentation.height*0.5+imageSelectionOffset.y)));}if($$self.$$.dirty[4]&/*$imageSelectionRectSnapshot*/33554432){$$invalidate(134,isResizingSelection=$imageSelectionRectSnapshot!=null);}if($$self.$$.dirty[4]&/*$utilRectPadded, imageSelectionCenteredRect*/16785408){$$invalidate(136,isMaxSelectionRect=$utilRectPadded&&imageSelectionCenteredRect&&(imageSelectionCenteredRect.height===$utilRectPadded.height||imageSelectionCenteredRect.width===$utilRectPadded.width));}if($$self.$$.dirty[4]&/*isMaxSelectionRect, $presentationScalar, $imageScalar*/12587008){$$invalidate(132,canZoomToCenter=!isMaxSelectionRect&&$presentationScalar<1&&$imageScalar<1);}if($$self.$$.dirty[4]&/*isImageSelectionDisplayed, isResizingSelection, isImageSelectionCentered, canZoomToCenter*/3840){$$invalidate(9,canCenter=isImageSelectionDisplayed&&!isResizingSelection&&(!isImageSelectionCentered||canZoomToCenter));}if($$self.$$.dirty[0]&/*$imageCropRect*/8192|$$self.$$.dirty[3]&/*cropEnableInfoIndicator*/8192|$$self.$$.dirty[4]&/*isOverlayMode*/1){$$invalidate(22,shouldRenderInfoIndicator=cropEnableInfoIndicator&&!!$imageCropRect&&!isOverlayMode);}if($$self.$$.dirty[4]&/*$imageSelectionRectPresentation, imageSelectionOffset*/524352){$$invalidate(8,imageSelectionRectOffset=$imageSelectionRectPresentation&&imageSelectionOffset&&{x:$imageSelectionRectPresentation.x+imageSelectionOffset.x,y:$imageSelectionRectPresentation.y+imageSelectionOffset.y,width:$imageSelectionRectPresentation.width,height:$imageSelectionRectPresentation.height});}if($$self.$$.dirty[0]&/*imageSelectionRectOffset*/256|$$self.$$.dirty[3]&/*cropEnableImageSelection*/4096|$$self.$$.dirty[4]&/*isOverlayMode*/1){$$invalidate(21,shouldRenderImageSelection=cropEnableImageSelection&&!!imageSelectionRectOffset&&!isOverlayMode);}if($$self.$$.dirty[3]&/*cropEnableCenterImageSelection, cropAutoCenterImageSelectionTimeout*/65600|$$self.$$.dirty[4]&/*imageSelectionCenter, $imageIsStatic*/2097280){$$invalidate(10,shouldRenderImageSelectionRecenterButton=cropEnableCenterImageSelection&&!!imageSelectionCenter&&!cropAutoCenterImageSelectionTimeout&&!$imageIsStatic);}if($$self.$$.dirty[0]&/*canCenter*/512|$$self.$$.dirty[3]&/*cropAutoCenterImageSelectionTimeout, cropAutoCenterImageSelectionTimeoutId*/1073741888|$$self.$$.dirty[4]&/*$isInteracting*/1048576){if(canCenter&&cropAutoCenterImageSelectionTimeout&&!$isInteracting){clearTimeout(cropAutoCenterImageSelectionTimeoutId);$$invalidate(123,cropAutoCenterImageSelectionTimeoutId=setTimeout(handleRecenterAction,cropAutoCenterImageSelectionTimeout));}}if($$self.$$.dirty[3]&/*cropAutoCenterImageSelectionTimeoutId*/1073741824|$$self.$$.dirty[4]&/*$isInteracting*/1048576){if($isInteracting)clearTimeout(cropAutoCenterImageSelectionTimeoutId);}if($$self.$$.dirty[0]&/*shouldRenderImageSelectionRecenterButton, canCenter*/1536|$$self.$$.dirty[4]&/*$isAnimated*/32768){recenterOpacity.set(shouldRenderImageSelectionRecenterButton&&canCenter?1:0,{hard:$isAnimated===false});}if($$self.$$.dirty[4]&/*imageSelectionCenter, $isAnimated*/32896){recenterOffset.set(imageSelectionCenter,{hard:$isAnimated===false});}if($$self.$$.dirty[0]&/*$isActive*/4096|$$self.$$.dirty[4]&/*$stagePadded*/262144){if($isActive&&!$stagePadded){setPreviewModifiers();}else{clearPreviewModifiers();}}if($$self.$$.dirty[4]&/*$imageSelectionGuides*/131072){// if overlay top changes
$imageSelectionGuides&&syncGuides();}if($$self.$$.dirty[4]&/*$env*/65536){// #endregion
//
// Transform tabs
//
$$invalidate(127,hasPlentyVerticalSpace=$env.verticalSpace!=='short');}if($$self.$$.dirty[3]&/*cropMinimizeToolbar*/134217728|$$self.$$.dirty[4]&/*isOverlayMode, hasPlentyVerticalSpace*/9){$$invalidate(20,shouldRenderToolbar=// should show if is not allowed to hide and is not in overlay mode
cropMinimizeToolbar==='never'&&!isOverlayMode||// or if plenty space and should not force hide
hasPlentyVerticalSpace&&cropMinimizeToolbar!=='always');}if($$self.$$.dirty[0]&/*cropEnableZoom*/4|$$self.$$.dirty[3]&/*cropEnableZoomInput*/1024){$$invalidate(126,couldRenderZoomInput=cropEnableZoom&&cropEnableZoomInput);}if($$self.$$.dirty[3]&/*cropEnableZoomAutoHide*/2048|$$self.$$.dirty[4]&/*hasPlentyVerticalSpace, couldRenderZoomInput*/12){$$invalidate(125,shouldRenderZoomInput=cropEnableZoomAutoHide?hasPlentyVerticalSpace&&couldRenderZoomInput:couldRenderZoomInput);}if($$self.$$.dirty[3]&/*cropEnableRotationInput*/512|$$self.$$.dirty[4]&/*shouldRenderZoomInput*/2){$$invalidate(19,shouldRenderFooter=cropEnableRotationInput||shouldRenderZoomInput);}if($$self.$$.dirty[4]&/*shouldRenderZoomInput*/2){if(!shouldRenderZoomInput){$$invalidate(5,transformSelected=transformToolInitial);}}if($$self.$$.dirty[0]&/*transformSelected*/32){$$invalidate(18,tabsConfig={name:cropUniqueId,selected:transformSelected});}if($$self.$$.dirty[0]&/*locale*/16|$$self.$$.dirty[3]&/*cropEnableRotationInput*/512|$$self.$$.dirty[4]&/*shouldRenderZoomInput*/2){$$invalidate(7,tabs=[cropEnableRotationInput&&{id:cropUniqueId+'-rotation',label:locale.cropLabelTabRotation},shouldRenderZoomInput&&{id:cropUniqueId+'-zoom',label:locale.cropLabelTabZoom}].filter(Boolean));}if($$self.$$.dirty[0]&/*tabs*/128){$$invalidate(17,panels=tabs.map(function(tab){return tab.id;}));}if($$self.$$.dirty[0]&/*stageRef*/64|$$self.$$.dirty[4]&/*isOverlayMode*/1){if(stageRef&&!stageRef.children.length&&isOverlayMode){stageRef.dispatchEvent(new CustomEvent('measure',{detail:stageRef.rect}));}}if($$self.$$.dirty[0]&/*$isActive*/4096|$$self.$$.dirty[4]&/*$isAnimated*/32768){$isAnimated&&footerOffset.set($isActive?0:20);}if($$self.$$.dirty[4]&/*$footerOffset*/16384){$$invalidate(16,footerStyle=$footerOffset?"transform: translateY(".concat($footerOffset,"px)"):undefined);}};return[isActive,cropImageSelectionCornerStyle,cropEnableZoom,cropRotationRange,locale,transformSelected,stageRef,tabs,imageSelectionRectOffset,canCenter,shouldRenderImageSelectionRecenterButton,cropTools,$isActive,$imageCropRect,$imageRotation,root,footerStyle,panels,tabsConfig,shouldRenderFooter,shouldRenderToolbar,shouldRenderImageSelection,shouldRenderInfoIndicator,imageZoomLevelMin,$rootRect,$elasticityMultiplier,$imageRotationRange,$imageZoomLevelRange,$imageZoomLevel,$recenterOpacity,$recenterOffset,isAnimated,elasticityMultiplier,redrawTrigger,imageIsStatic,imageStaticVisualCorners,formattedCropPresetOptions,env,isInteracting,isTransformingImage,rootRect,stageRect,utilRectPadded,rangeInputElasticity,presentationScalar,utilTools,imagePreviewModifiers,imageFlipX,imageFlipY,imageRotation,imageRotationRange,imageOutputSize,imageSelectionRect,imageSelectionRectSnapshot,imageSelectionRectIntent,imageSelectionRectPresentation,imageCropRectIntent,imageCropRectOrigin,imageCropRect,imageCropMinSize,imageCropMaxSize,imageCropRange,imageCropAspectRatio,imageCropLimitToImage,imageSize,imageScalar,imageOverlayMarkup,stagePadded,handleSelectionGrab,handleSelectionDrag,handleSelectionRelease,handleRotateStart,handleRotateMove,handleRotateEnd,handleImageDragStart,handleImageDrag,handleImageDragEnd,handleImageDragRelease,imageCropRangeAspectRatio,imageZoomLevelRange,imageZoomLevel,handleResizeStart,handleResizeMove,handleResizeEnd,handleGestureStart,handleGestureUpdate,handleGestureEnd,handleWheel,handleRecenterAction,recenterOpacity,recenterOffset,selectedPresetIndex,imageSelectionGuides,cropUniqueId,footerOffset,cropSelectPresetFilter,name,stores,cropWillRenderImageSelectionGuides,cropAutoCenterImageSelectionTimeout,cropEnableZoomMatchImageAspectRatio,cropEnableRotateMatchImageAspectRatio,cropEnableRotationInput,cropEnableZoomInput,cropEnableZoomAutoHide,cropEnableImageSelection,cropEnableInfoIndicator,cropEnableZoomTowardsWheelPosition,cropEnableLimitWheelInputToCropSelection,cropEnableCenterImageSelection,cropEnableButtonRotateLeft,cropEnableButtonRotateRight,cropEnableButtonFlipHorizontal,cropEnableButtonFlipVertical,cropSelectPresetOptions,cropEnableSelectPreset,cropEnableFilterMatchAspectRatio,cropEnableButtonToggleCropLimit,cropWillRenderTools,cropActiveTransformTool,cropMinimizeToolbar,cropInteractionFocus,cropMaskOpacity,cropAutoCenterImageSelectionTimeoutId,isOverlayMode,shouldRenderZoomInput,couldRenderZoomInput,hasPlentyVerticalSpace,shouldRenderPresetSelect,hasCropSelectPresetOptions,imageSelectionOffset,imageSelectionCenter,canZoomToCenter,isImageSelectionCentered,isResizingSelection,isImageSelectionDisplayed,isMaxSelectionRect,imageSelectionCenteredRect,$footerOffset,$isAnimated,$env,$imageSelectionGuides,$stagePadded,$imageSelectionRectPresentation,$isInteracting,$imageIsStatic,$imageScalar,$presentationScalar,$utilRectPadded,$imageSelectionRectSnapshot,$imageSelectionRect,$stageRect,$imageSize,$imageCropLimitToImage,$imageCropMinSize,$selectedPresetIndex,$formattedCropPresetOptions,$imageFlipY,$imageFlipX,$redrawTrigger,measure_handler_1,select_handler,div0_binding,interactable_function_1,util_root_binding,measure_handler];}var Crop=/*#__PURE__*/function(_SvelteComponent32){_inherits(Crop,_SvelteComponent32);var _super33=_createSuper(Crop);function Crop(options){var _this34;_classCallCheck(this,Crop);_this34=_super33.call(this);init(_assertThisInitialized(_this34),options,instance$m,create_fragment$m,safe_not_equal,{name:96,isActive:0,stores:97,cropImageSelectionCornerStyle:1,cropWillRenderImageSelectionGuides:98,cropAutoCenterImageSelectionTimeout:99,cropEnableZoomMatchImageAspectRatio:100,cropEnableRotateMatchImageAspectRatio:101,cropEnableRotationInput:102,cropEnableZoom:2,cropEnableZoomInput:103,cropEnableZoomAutoHide:104,cropEnableImageSelection:105,cropEnableInfoIndicator:106,cropEnableZoomTowardsWheelPosition:107,cropEnableLimitWheelInputToCropSelection:108,cropEnableCenterImageSelection:109,cropEnableButtonRotateLeft:110,cropEnableButtonRotateRight:111,cropEnableButtonFlipHorizontal:112,cropEnableButtonFlipVertical:113,cropSelectPresetOptions:114,cropEnableSelectPreset:115,cropEnableFilterMatchAspectRatio:116,cropSelectPresetFilter:95,cropEnableButtonToggleCropLimit:117,cropWillRenderTools:118,cropActiveTransformTool:119,cropMinimizeToolbar:120,cropInteractionFocus:121,cropRotationRange:3,cropMaskOpacity:122,locale:4},null,[-1,-1,-1,-1,-1,-1,-1,-1]);return _this34;}_createClass(Crop,[{key:"name",get:function get(){return this.$$.ctx[96];}},{key:"isActive",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"stores",get:function get(){return this.$$.ctx[97];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"cropImageSelectionCornerStyle",get:function get(){return this.$$.ctx[1];},set:function set(cropImageSelectionCornerStyle){this.$$set({cropImageSelectionCornerStyle:cropImageSelectionCornerStyle});flush();}},{key:"cropWillRenderImageSelectionGuides",get:function get(){return this.$$.ctx[98];},set:function set(cropWillRenderImageSelectionGuides){this.$$set({cropWillRenderImageSelectionGuides:cropWillRenderImageSelectionGuides});flush();}},{key:"cropAutoCenterImageSelectionTimeout",get:function get(){return this.$$.ctx[99];},set:function set(cropAutoCenterImageSelectionTimeout){this.$$set({cropAutoCenterImageSelectionTimeout:cropAutoCenterImageSelectionTimeout});flush();}},{key:"cropEnableZoomMatchImageAspectRatio",get:function get(){return this.$$.ctx[100];},set:function set(cropEnableZoomMatchImageAspectRatio){this.$$set({cropEnableZoomMatchImageAspectRatio:cropEnableZoomMatchImageAspectRatio});flush();}},{key:"cropEnableRotateMatchImageAspectRatio",get:function get(){return this.$$.ctx[101];},set:function set(cropEnableRotateMatchImageAspectRatio){this.$$set({cropEnableRotateMatchImageAspectRatio:cropEnableRotateMatchImageAspectRatio});flush();}},{key:"cropEnableRotationInput",get:function get(){return this.$$.ctx[102];},set:function set(cropEnableRotationInput){this.$$set({cropEnableRotationInput:cropEnableRotationInput});flush();}},{key:"cropEnableZoom",get:function get(){return this.$$.ctx[2];},set:function set(cropEnableZoom){this.$$set({cropEnableZoom:cropEnableZoom});flush();}},{key:"cropEnableZoomInput",get:function get(){return this.$$.ctx[103];},set:function set(cropEnableZoomInput){this.$$set({cropEnableZoomInput:cropEnableZoomInput});flush();}},{key:"cropEnableZoomAutoHide",get:function get(){return this.$$.ctx[104];},set:function set(cropEnableZoomAutoHide){this.$$set({cropEnableZoomAutoHide:cropEnableZoomAutoHide});flush();}},{key:"cropEnableImageSelection",get:function get(){return this.$$.ctx[105];},set:function set(cropEnableImageSelection){this.$$set({cropEnableImageSelection:cropEnableImageSelection});flush();}},{key:"cropEnableInfoIndicator",get:function get(){return this.$$.ctx[106];},set:function set(cropEnableInfoIndicator){this.$$set({cropEnableInfoIndicator:cropEnableInfoIndicator});flush();}},{key:"cropEnableZoomTowardsWheelPosition",get:function get(){return this.$$.ctx[107];},set:function set(cropEnableZoomTowardsWheelPosition){this.$$set({cropEnableZoomTowardsWheelPosition:cropEnableZoomTowardsWheelPosition});flush();}},{key:"cropEnableLimitWheelInputToCropSelection",get:function get(){return this.$$.ctx[108];},set:function set(cropEnableLimitWheelInputToCropSelection){this.$$set({cropEnableLimitWheelInputToCropSelection:cropEnableLimitWheelInputToCropSelection});flush();}},{key:"cropEnableCenterImageSelection",get:function get(){return this.$$.ctx[109];},set:function set(cropEnableCenterImageSelection){this.$$set({cropEnableCenterImageSelection:cropEnableCenterImageSelection});flush();}},{key:"cropEnableButtonRotateLeft",get:function get(){return this.$$.ctx[110];},set:function set(cropEnableButtonRotateLeft){this.$$set({cropEnableButtonRotateLeft:cropEnableButtonRotateLeft});flush();}},{key:"cropEnableButtonRotateRight",get:function get(){return this.$$.ctx[111];},set:function set(cropEnableButtonRotateRight){this.$$set({cropEnableButtonRotateRight:cropEnableButtonRotateRight});flush();}},{key:"cropEnableButtonFlipHorizontal",get:function get(){return this.$$.ctx[112];},set:function set(cropEnableButtonFlipHorizontal){this.$$set({cropEnableButtonFlipHorizontal:cropEnableButtonFlipHorizontal});flush();}},{key:"cropEnableButtonFlipVertical",get:function get(){return this.$$.ctx[113];},set:function set(cropEnableButtonFlipVertical){this.$$set({cropEnableButtonFlipVertical:cropEnableButtonFlipVertical});flush();}},{key:"cropSelectPresetOptions",get:function get(){return this.$$.ctx[114];},set:function set(cropSelectPresetOptions){this.$$set({cropSelectPresetOptions:cropSelectPresetOptions});flush();}},{key:"cropEnableSelectPreset",get:function get(){return this.$$.ctx[115];},set:function set(cropEnableSelectPreset){this.$$set({cropEnableSelectPreset:cropEnableSelectPreset});flush();}},{key:"cropEnableFilterMatchAspectRatio",get:function get(){return this.$$.ctx[116];},set:function set(cropEnableFilterMatchAspectRatio){this.$$set({cropEnableFilterMatchAspectRatio:cropEnableFilterMatchAspectRatio});flush();}},{key:"cropSelectPresetFilter",get:function get(){return this.$$.ctx[95];},set:function set(cropSelectPresetFilter){this.$$set({cropSelectPresetFilter:cropSelectPresetFilter});flush();}},{key:"cropEnableButtonToggleCropLimit",get:function get(){return this.$$.ctx[117];},set:function set(cropEnableButtonToggleCropLimit){this.$$set({cropEnableButtonToggleCropLimit:cropEnableButtonToggleCropLimit});flush();}},{key:"cropWillRenderTools",get:function get(){return this.$$.ctx[118];},set:function set(cropWillRenderTools){this.$$set({cropWillRenderTools:cropWillRenderTools});flush();}},{key:"cropActiveTransformTool",get:function get(){return this.$$.ctx[119];},set:function set(cropActiveTransformTool){this.$$set({cropActiveTransformTool:cropActiveTransformTool});flush();}},{key:"cropMinimizeToolbar",get:function get(){return this.$$.ctx[120];},set:function set(cropMinimizeToolbar){this.$$set({cropMinimizeToolbar:cropMinimizeToolbar});flush();}},{key:"cropInteractionFocus",get:function get(){return this.$$.ctx[121];},set:function set(cropInteractionFocus){this.$$set({cropInteractionFocus:cropInteractionFocus});flush();}},{key:"cropRotationRange",get:function get(){return this.$$.ctx[3];},set:function set(cropRotationRange){this.$$set({cropRotationRange:cropRotationRange});flush();}},{key:"cropMaskOpacity",get:function get(){return this.$$.ctx[122];},set:function set(cropMaskOpacity){this.$$set({cropMaskOpacity:cropMaskOpacity});flush();}},{key:"locale",get:function get(){return this.$$.ctx[4];},set:function set(locale){this.$$set({locale:locale});flush();}}]);return Crop;}(SvelteComponent);// @ts-ignore
var _plugin_crop={util:['crop',Crop]};/* src/core/ui/plugins/filter/index.svelte generated by Svelte v3.52.0 */function create_option_slot$3(ctx){var div1;var div0;var option=/*option*/ctx[76];var t0;var span;var t1_value=(isFunction(/*option*/ctx[76].label)?/*option*/ctx[76].label(/*locale*/ctx[2]):/*option*/ctx[76].label)+"";var t1;var mounted;var dispose;function measure_handler_1(){var _ctx9;for(var _len10=arguments.length,args=new Array(_len10),_key13=0;_key13<_len10;_key13++){args[_key13]=arguments[_key13];}return(/*measure_handler_1*/(_ctx9=ctx)[51].apply(_ctx9,[/*option*/ctx[76]].concat(args)));}var assign_div0=function assign_div0(){return(/*div0_binding*/ctx[52](div0,option));};var unassign_div0=function unassign_div0(){return(/*div0_binding*/ctx[52](null,option));};return{c:function c(){div1=element("div");div0=element("div");t0=space();span=element("span");t1=text(t1_value);attr(div0,"class",FILTER_PREVIEW_CLASS_NAME);attr(div1,"slot","option");attr(div1,"class","PinturaFilterOption");},m:function m(target,anchor){insert(target,div1,anchor);append(div1,div0);assign_div0();append(div1,t0);append(div1,span);append(span,t1);if(!mounted){dispose=[listen(div0,"measure",measure_handler_1),action_destroyer(measurable.call(null,div0))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(option!==/*option*/ctx[76]){unassign_div0();option=/*option*/ctx[76];assign_div0();}if(dirty[0]&/*locale*/4|dirty[2]&/*option*/16384&&t1_value!==(t1_value=(isFunction(/*option*/ctx[76].label)?/*option*/ctx[76].label(/*locale*/ctx[2]):/*option*/ctx[76].label)+""))set_data(t1,t1_value);},d:function d(detaching){if(detaching)detach(div1);unassign_div0();mounted=false;run_all(dispose);}};}// (388:8) <Scrollable             elasticity={$elasticityMultiplier * scrollElasticity}             onscroll={(offset) => (tileScrollOffset = offset)}             bind:maskFeatherStartOpacity={tileLeftOpacity}             bind:maskFeatherEndOpacity={tileRightOpacity}             bind:maskFeatherSize={tileMargin}             on:measure={(e) => (tileScrollContainerRect = e.detail)}         >
function create_default_slot$9(ctx){var radiogroup;var current;radiogroup=new RadioGroup({props:{locale:/*locale*/ctx[2],layout:"row",options:/*filterOptions*/ctx[3],selectedIndex:/*selectedFilterIndex*/ctx[12],onchange:/*handleChangeFilter*/ctx[32],$$slots:{option:[create_option_slot$3,function(_ref388){var option=_ref388.option;return{76:option};},function(_ref389){var option=_ref389.option;return[0,0,option?16384:0];}]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(radiogroup.$$.fragment);},m:function m(target,anchor){mount_component(radiogroup,target,anchor);current=true;},p:function p(ctx,dirty){var radiogroup_changes={};if(dirty[0]&/*locale*/4)radiogroup_changes.locale=/*locale*/ctx[2];if(dirty[0]&/*filterOptions*/8)radiogroup_changes.options=/*filterOptions*/ctx[3];if(dirty[0]&/*selectedFilterIndex*/4096)radiogroup_changes.selectedIndex=/*selectedFilterIndex*/ctx[12];if(dirty[0]&/*locale, tileElements*/1028|dirty[2]&/*$$scope, option*/49152){radiogroup_changes.$$scope={dirty:dirty,ctx:ctx};}radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radiogroup,detaching);}};}// (379:4) 
function create_footer_slot$5(ctx){var div;var scrollable;var updating_maskFeatherStartOpacity;var updating_maskFeatherEndOpacity;var updating_maskFeatherSize;var current;var mounted;var dispose;function scrollable_maskFeatherStartOpacity_binding(value){/*scrollable_maskFeatherStartOpacity_binding*/ctx[54](value);}function scrollable_maskFeatherEndOpacity_binding(value){/*scrollable_maskFeatherEndOpacity_binding*/ctx[55](value);}function scrollable_maskFeatherSize_binding(value){/*scrollable_maskFeatherSize_binding*/ctx[56](value);}var scrollable_props={elasticity:/*$elasticityMultiplier*/ctx[13]*/*scrollElasticity*/ctx[19],onscroll:/*func*/ctx[53],$$slots:{"default":[create_default_slot$9]},$$scope:{ctx:ctx}};if(/*tileLeftOpacity*/ctx[4]!==void 0){scrollable_props.maskFeatherStartOpacity=/*tileLeftOpacity*/ctx[4];}if(/*tileRightOpacity*/ctx[5]!==void 0){scrollable_props.maskFeatherEndOpacity=/*tileRightOpacity*/ctx[5];}if(/*tileMargin*/ctx[6]!==void 0){scrollable_props.maskFeatherSize=/*tileMargin*/ctx[6];}scrollable=new Scrollable({props:scrollable_props});binding_callbacks.push(function(){return bind(scrollable,'maskFeatherStartOpacity',scrollable_maskFeatherStartOpacity_binding);});binding_callbacks.push(function(){return bind(scrollable,'maskFeatherEndOpacity',scrollable_maskFeatherEndOpacity_binding);});binding_callbacks.push(function(){return bind(scrollable,'maskFeatherSize',scrollable_maskFeatherSize_binding);});scrollable.$on("measure",/*measure_handler_2*/ctx[57]);return{c:function c(){div=element("div");create_component(scrollable.$$.fragment);attr(div,"slot","footer");attr(div,"style",/*footerStyle*/ctx[11]);},m:function m(target,anchor){insert(target,div,anchor);mount_component(scrollable,div,null);current=true;if(!mounted){dispose=[listen(div,"transitionend",/*handleTransitionEnd*/ctx[30]),listen(div,"measure",/*measure_handler_3*/ctx[58]),action_destroyer(measurable.call(null,div,{observePosition:true}))];mounted=true;}},p:function p(ctx,dirty){var scrollable_changes={};if(dirty[0]&/*$elasticityMultiplier*/8192)scrollable_changes.elasticity=/*$elasticityMultiplier*/ctx[13]*/*scrollElasticity*/ctx[19];if(dirty[0]&/*tileScrollOffset*/128)scrollable_changes.onscroll=/*func*/ctx[53];if(dirty[0]&/*locale, filterOptions, selectedFilterIndex, tileElements*/5132|dirty[2]&/*$$scope*/32768){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}if(!updating_maskFeatherStartOpacity&&dirty[0]&/*tileLeftOpacity*/16){updating_maskFeatherStartOpacity=true;scrollable_changes.maskFeatherStartOpacity=/*tileLeftOpacity*/ctx[4];add_flush_callback(function(){return updating_maskFeatherStartOpacity=false;});}if(!updating_maskFeatherEndOpacity&&dirty[0]&/*tileRightOpacity*/32){updating_maskFeatherEndOpacity=true;scrollable_changes.maskFeatherEndOpacity=/*tileRightOpacity*/ctx[5];add_flush_callback(function(){return updating_maskFeatherEndOpacity=false;});}if(!updating_maskFeatherSize&&dirty[0]&/*tileMargin*/64){updating_maskFeatherSize=true;scrollable_changes.maskFeatherSize=/*tileMargin*/ctx[6];add_flush_callback(function(){return updating_maskFeatherSize=false;});}scrollable.$set(scrollable_changes);if(!current||dirty[0]&/*footerStyle*/2048){attr(div,"style",/*footerStyle*/ctx[11]);}},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(scrollable);mounted=false;run_all(dispose);}};}function create_fragment$l(ctx){var util;var current;util=new Util({props:{$$slots:{footer:[create_footer_slot$5]},$$scope:{ctx:ctx}}});util.$on("measure",/*measure_handler*/ctx[59]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*footerStyle, footerRect, $elasticityMultiplier, tileScrollOffset, tileLeftOpacity, tileRightOpacity, tileMargin, tileScrollContainerRect, locale, filterOptions, selectedFilterIndex, tileElements*/16380|dirty[2]&/*$$scope*/32768){util_changes.$$scope={dirty:dirty,ctx:ctx};}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}var FILTER_PREVIEW_CLASS_NAME='PinturaFilterPreview';function instance$l($$self,$$props,$$invalidate){var filterOptionsFlattened;var selectedFilterIndex;var footerStyle;var $footerOffset;var $imageColorMatrix;var $imageTiles;var $imagePreview;var $isActiveFraction,$$unsubscribe_isActiveFraction=noop,$$subscribe_isActiveFraction=function $$subscribe_isActiveFraction(){return $$unsubscribe_isActiveFraction(),$$unsubscribe_isActiveFraction=subscribe(isActiveFraction,function($$value){return $$invalidate(43,$isActiveFraction=$$value);}),isActiveFraction;};var $interfaceImages;var $imageBackgroundColor;var $imageSize;var $imageGamma;var $imageTransforms;var $tileRects;var $utilRect;var $stageRectBase;var $isActive,$$unsubscribe_isActive=noop,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(49,$isActive=$$value);}),isActive;};var $animation;var $canvasSize;var $elasticityMultiplier;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActiveFraction();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});var name='filter';var isActive=$$props.isActive;$$subscribe_isActive();var isActiveFraction=$$props.isActiveFraction;$$subscribe_isActiveFraction();var stores=$$props.stores;var locale=$$props.locale;var filterFunctions=$$props.filterFunctions;var filterOptions=$$props.filterOptions;// context
var elasticityMultiplier=getContext('elasticityMultiplier');component_subscribe($$self,elasticityMultiplier,function(value){return $$invalidate(13,$elasticityMultiplier=value);});// connect filter choice to stores
var _stores4=stores,history=_stores4.history,interfaceImages=_stores4.interfaceImages,stageRectBase=_stores4.stageRectBase,utilRect=_stores4.utilRect,animation=_stores4.animation,scrollElasticity=_stores4.scrollElasticity,imageSize=_stores4.imageSize,imagePreview=_stores4.imagePreview,imageCropRect=_stores4.imageCropRect,imageRotation=_stores4.imageRotation,imageFlipX=_stores4.imageFlipX,imageFlipY=_stores4.imageFlipY,imageBackgroundColor=_stores4.imageBackgroundColor,imageGamma=_stores4.imageGamma,imageColorMatrix=_stores4.imageColorMatrix,allowPan=_stores4.allowPan,allowZoom=_stores4.allowZoom,allowZoomControls=_stores4.allowZoomControls;component_subscribe($$self,interfaceImages,function(value){return $$invalidate(60,$interfaceImages=value);});component_subscribe($$self,stageRectBase,function(value){return $$invalidate(48,$stageRectBase=value);});component_subscribe($$self,utilRect,function(value){return $$invalidate(47,$utilRect=value);});component_subscribe($$self,animation,function(value){return $$invalidate(50,$animation=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(62,$imageSize=value);});component_subscribe($$self,imagePreview,function(value){return $$invalidate(42,$imagePreview=value);});component_subscribe($$self,imageBackgroundColor,function(value){return $$invalidate(61,$imageBackgroundColor=value);});component_subscribe($$self,imageGamma,function(value){return $$invalidate(44,$imageGamma=value);});component_subscribe($$self,imageColorMatrix,function(value){return $$invalidate(40,$imageColorMatrix=value);});var getFilterIndex=function getFilterIndex(imageColorMatrix,filterOptionsFlattened){if(!imageColorMatrix||!imageColorMatrix['filter']||!filterOptionsFlattened)return 0;var filterColorMatrix=imageColorMatrix['filter'];return filterOptionsFlattened.// get id and compare matrices
findIndex(function(_ref390){var _ref391=_slicedToArray(_ref390,1),id=_ref391[0];if(!filterFunctions[id])return false;var matrix=filterFunctions[id]();return arrayEqual(matrix,filterColorMatrix);});};var tileRects=writable({});component_subscribe($$self,tileRects,function(value){return $$invalidate(46,$tileRects=value);});var handleTileResize=function handleTileResize(item,rect){return set_store_value(tileRects,$tileRects[item.value]=rect,$tileRects);};var canvasSize=derived(tileRects,function($tileRects){if(!$tileRects[undefined])return;var tileRectFirst=$tileRects[undefined];if($canvasSize&&sizeEqual($canvasSize,tileRectFirst))return $canvasSize;return sizeClone(tileRectFirst);});component_subscribe($$self,canvasSize,function(value){return $$invalidate(63,$canvasSize=value);});var imageTransforms=derived([isActive,canvasSize,imageCropRect,imageSize,imageRotation,imageFlipX,imageFlipY],function(_ref392,set){var _ref393=_slicedToArray(_ref392,7),$isActive=_ref393[0],$canvasSize=_ref393[1],$imageCropRect=_ref393[2],$imageSize=_ref393[3],$imageRotation=_ref393[4],$imageFlipX=_ref393[5],$imageFlipY=_ref393[6];if(!$isActive||!$canvasSize||!$imageSize)return $imageTransforms;var imageRect=rectCreateFromSize($imageSize);var imageCenter=rectCenter(imageRect);// get base crop rect so we can correctly apply transforms
var cropRectBase=getBaseCropRect($imageSize,$imageCropRect,$imageRotation);var cropRectBaseCenter=rectCenter(cropRectBase);var imageTranslation=vectorSubtract(vectorClone(imageCenter),cropRectBaseCenter);var imageOrigin=vectorInvert(vectorClone(imageTranslation));// scalar
var imageScalar=Math.max($canvasSize.width/$imageCropRect.width,$canvasSize.height/$imageCropRect.height);// update preview transforms
set({origin:imageOrigin,translation:imageTranslation,rotation:{x:$imageFlipY?Math.PI:0,y:$imageFlipX?Math.PI:0,z:$imageRotation},scale:imageScalar});});component_subscribe($$self,imageTransforms,function(value){return $$invalidate(45,$imageTransforms=value);});var cloneImageTransforms=function cloneImageTransforms(imageTransforms){return{origin:vectorClone(imageTransforms.origin),translation:vectorClone(imageTransforms.translation),rotation:_objectSpread({},imageTransforms.rotation),// perspective: vectorClone(imageTransforms.perspective),
scale:imageTransforms.scale};};//
// Footer
//
var footerOffset=spring($animation?20:0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(39,$footerOffset=value);});var tileCornerRadius;var tileElements={};var handleTransitionEnd=function handleTransitionEnd(e){if(e.target.className!==FILTER_PREVIEW_CLASS_NAME)return;$$invalidate(36,tileCornerRadius=Object.keys(tileElements).reduce(function(prev,curr){var element=tileElements[curr];var style=getComputedStyle(element);var corners=['top-left','top-right','bottom-left','bottom-right'].map(function(corner){return style.getPropertyValue("border-".concat(corner,"-radius"));}).map(unitToPixels).// this better aligns WebGL rounded corner with css rounded corner
map(function(v){return v*1.25;});prev[curr]=corners;return prev;},{}));};var tileLeftOpacity;// set by Scrollable
var tileRightOpacity;// set by Scrollable
var tileMargin;// set by Scrollable
var tileScrollOffset={x:0,y:0};var tileScrollContainerRect;var tileWrapperOffset;var footerRect;var imageTiles=writable([]);component_subscribe($$self,imageTiles,function(value){return $$invalidate(41,$imageTiles=value);});// clones an image tile for use in canvas
var cloneImageTile=function cloneImageTile(tile){var clone=_objectSpread(_objectSpread({},tile),{},{data:$imagePreview,size:$imageSize,offset:_objectSpread({},tile.offset),mask:_objectSpread({},tile.mask),backgroundColor:$imageBackgroundColor});clone.opacity=$isActiveFraction;clone.offset.y+=$footerOffset;clone.mask.y+=$footerOffset;clone.id='filter';return clone;};var filterInterfaceImages=function filterInterfaceImages(){return $interfaceImages.filter(function(tile){return tile.id!=='filter';});};var handleChangeFilter=function handleChangeFilter(_ref394){var value=_ref394.value;set_store_value(imageColorMatrix,$imageColorMatrix=_objectSpread(_objectSpread({},$imageColorMatrix),{},{filter:isFunction(filterFunctions[value])?filterFunctions[value]():undefined}),$imageColorMatrix);history.write();};// when destroyed we need to make sure all filter image previews are cleared
onDestroy(function(){interfaceImages.set([]);});var measure_handler_1=function measure_handler_1(option,e){return handleTileResize(option,e.detail);};function div0_binding($$value,option){binding_callbacks[$$value?'unshift':'push'](function(){tileElements[option.value]=$$value;$$invalidate(10,tileElements);});}var func=function func(offset){return $$invalidate(7,tileScrollOffset=offset);};function scrollable_maskFeatherStartOpacity_binding(value){tileLeftOpacity=value;$$invalidate(4,tileLeftOpacity);}function scrollable_maskFeatherEndOpacity_binding(value){tileRightOpacity=value;$$invalidate(5,tileRightOpacity);}function scrollable_maskFeatherSize_binding(value){tileMargin=value;$$invalidate(6,tileMargin);}var measure_handler_2=function measure_handler_2(e){return $$invalidate(8,tileScrollContainerRect=e.detail);};var measure_handler_3=function measure_handler_3(e){return $$invalidate(9,footerRect=e.detail);};function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('isActive'in $$props)$$subscribe_isActive($$invalidate(0,isActive=$$props.isActive));if('isActiveFraction'in $$props)$$subscribe_isActiveFraction($$invalidate(1,isActiveFraction=$$props.isActiveFraction));if('stores'in $$props)$$invalidate(34,stores=$$props.stores);if('locale'in $$props)$$invalidate(2,locale=$$props.locale);if('filterFunctions'in $$props)$$invalidate(35,filterFunctions=$$props.filterFunctions);if('filterOptions'in $$props)$$invalidate(3,filterOptions=$$props.filterOptions);};$$self.$$.update=function(){if($$self.$$.dirty[1]&/*$isActive*/262144){// enable pan and zoom
allowPan.set($isActive);}if($$self.$$.dirty[1]&/*$isActive*/262144){allowZoom.set($isActive);}if($$self.$$.dirty[1]&/*$isActive*/262144){allowZoomControls.set($isActive);}if($$self.$$.dirty[0]&/*filterOptions*/8){$$invalidate(38,filterOptionsFlattened=flattenOptions(filterOptions));}if($$self.$$.dirty[1]&/*$imageColorMatrix, filterOptionsFlattened*/640){$$invalidate(12,selectedFilterIndex=getFilterIndex($imageColorMatrix,filterOptionsFlattened));}if($$self.$$.dirty[1]&/*$animation, $isActive*/786432){$animation&&footerOffset.set($isActive?0:20);}if($$self.$$.dirty[0]&/*footerRect*/512|$$self.$$.dirty[1]&/*$isActive, $utilRect, $stageRectBase*/458752){if($isActive&&$utilRect&&$stageRectBase&&footerRect){$$invalidate(37,tileWrapperOffset={x:$stageRectBase.x-$utilRect.x,y:$stageRectBase.y-$utilRect.y+footerRect.y});}}if($$self.$$.dirty[0]&/*tileScrollOffset, tileScrollContainerRect, tileMargin, tileLeftOpacity, tileRightOpacity*/496|$$self.$$.dirty[1]&/*$imageTransforms, tileWrapperOffset, tileCornerRadius, filterOptionsFlattened, $tileRects, $imageColorMatrix, filterFunctions, $imageGamma*/58096){if($imageTransforms&&tileWrapperOffset&&tileScrollOffset&&tileScrollContainerRect&&tileCornerRadius){var boundsX=tileWrapperOffset.x+tileScrollContainerRect.x;var offsetX=boundsX+tileScrollOffset.x;var offsetY=tileWrapperOffset.y;var containerLeft=tileScrollContainerRect.x+tileWrapperOffset.x;var containerRight=containerLeft+tileScrollContainerRect.width;imageTiles.set(filterOptionsFlattened.map(function(_ref395,i){var _ref396=_slicedToArray(_ref395,1),id=_ref396[0];var tileRect=$tileRects[id];// test if is outside of view
var tileLeft=tileScrollOffset.x+tileRect.x;var tileRight=tileLeft+tileRect.width;if(tileRight<0||tileLeft>tileScrollContainerRect.width)return false;var x=offsetX+tileRect.x;var y=offsetY+tileRect.y;var preview=cloneImageTransforms($imageTransforms);preview.offset=vectorCreate(tileRect.width*0.5+x,tileRect.height*0.5+y);var clipX=0;var clipWidth=0;preview.maskOpacity=1;preview.mask=rectCreate(x+clipX,y,tileRect.width+clipWidth,tileRect.height);preview.maskFeather=[1,0,1,0,1,containerRight,1,containerRight];if(tileLeft<tileMargin&&tileLeftOpacity<1){preview.maskFeather[0]=tileLeftOpacity;preview.maskFeather[1]=containerLeft;preview.maskFeather[2]=1;preview.maskFeather[3]=containerLeft+tileMargin;}if(tileRight>tileScrollContainerRect.width-tileMargin&&tileRightOpacity<1){preview.maskFeather[4]=tileRightOpacity;preview.maskFeather[5]=containerRight-tileMargin;preview.maskFeather[6]=1;preview.maskFeather[7]=containerRight;}preview.maskCornerRadius=tileCornerRadius[id];var colorMatrices=$imageColorMatrix&&Object.keys($imageColorMatrix).filter(function(name){return name!='filter';}).map(function(name){return $imageColorMatrix[name];})||[];if(isFunction(filterFunctions[id])){colorMatrices.push(filterFunctions[id]());}preview.colorMatrix=colorMatrices.length?getColorMatrixFromColorMatrices(colorMatrices):undefined;preview.gamma=$imageGamma;return preview;}).filter(Boolean));}}if($$self.$$.dirty[1]&/*$isActiveFraction, $imageTiles, $footerOffset, $imagePreview*/7424){// Will update `interfaceImages` store when
// - $isActiveFraction is updated
// - $imageTiles is updated
// - $footerOffset is updated
if($isActiveFraction>0&&$imageTiles){var images=[].concat(_toConsumableArray(filterInterfaceImages()),_toConsumableArray($imageTiles.map(cloneImageTile)));// images
interfaceImages.set(images);}else{interfaceImages.set(// remove filter tiles
filterInterfaceImages());}}if($$self.$$.dirty[1]&/*$footerOffset*/256){$$invalidate(11,footerStyle=$footerOffset?"transform: translateY(".concat($footerOffset,"px)"):undefined);}};return[isActive,isActiveFraction,locale,filterOptions,tileLeftOpacity,tileRightOpacity,tileMargin,tileScrollOffset,tileScrollContainerRect,footerRect,tileElements,footerStyle,selectedFilterIndex,$elasticityMultiplier,elasticityMultiplier,interfaceImages,stageRectBase,utilRect,animation,scrollElasticity,imageSize,imagePreview,imageBackgroundColor,imageGamma,imageColorMatrix,tileRects,handleTileResize,canvasSize,imageTransforms,footerOffset,handleTransitionEnd,imageTiles,handleChangeFilter,name,stores,filterFunctions,tileCornerRadius,tileWrapperOffset,filterOptionsFlattened,$footerOffset,$imageColorMatrix,$imageTiles,$imagePreview,$isActiveFraction,$imageGamma,$imageTransforms,$tileRects,$utilRect,$stageRectBase,$isActive,$animation,measure_handler_1,div0_binding,func,scrollable_maskFeatherStartOpacity_binding,scrollable_maskFeatherEndOpacity_binding,scrollable_maskFeatherSize_binding,measure_handler_2,measure_handler_3,measure_handler];}var Filter=/*#__PURE__*/function(_SvelteComponent33){_inherits(Filter,_SvelteComponent33);var _super34=_createSuper(Filter);function Filter(options){var _this35;_classCallCheck(this,Filter);_this35=_super34.call(this);init(_assertThisInitialized(_this35),options,instance$l,create_fragment$l,safe_not_equal,{name:33,isActive:0,isActiveFraction:1,stores:34,locale:2,filterFunctions:35,filterOptions:3},null,[-1,-1,-1]);return _this35;}_createClass(Filter,[{key:"name",get:function get(){return this.$$.ctx[33];}},{key:"isActive",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"isActiveFraction",get:function get(){return this.$$.ctx[1];},set:function set(isActiveFraction){this.$$set({isActiveFraction:isActiveFraction});flush();}},{key:"stores",get:function get(){return this.$$.ctx[34];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"locale",get:function get(){return this.$$.ctx[2];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"filterFunctions",get:function get(){return this.$$.ctx[35];},set:function set(filterFunctions){this.$$set({filterFunctions:filterFunctions});flush();}},{key:"filterOptions",get:function get(){return this.$$.ctx[3];},set:function set(filterOptions){this.$$set({filterOptions:filterOptions});flush();}}]);return Filter;}(SvelteComponent);// @ts-ignore
var _plugin_filter={util:['filter',Filter]};/* src/core/ui/plugins/finetune/index.svelte generated by Svelte v3.52.0 */function create_default_slot_2$1(ctx){var span;var t_value=/*tab*/ctx[42].label+"";var t;return{c:function c(){span=element("span");t=text(t_value);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[1]&/*tab*/2048&&t_value!==(t_value=/*tab*/ctx[42].label+""))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (160:8) <Scrollable             elasticity={$elasticityMultiplier * scrollElasticity}             class="PinturaControlListScroller"         >
function create_default_slot_1$2(ctx){var tablist;var current;var tablist_spread_levels=[{"class":"PinturaControlList"},{tabs:/*tabs*/ctx[1]},/*tabsConfig*/ctx[5]];var tablist_props={$$slots:{"default":[create_default_slot_2$1,function(_ref397){var tab=_ref397.tab;return{42:tab};},function(_ref398){var tab=_ref398.tab;return[0,tab?2048:0];}]},$$scope:{ctx:ctx}};for(var i=0;i<tablist_spread_levels.length;i+=1){tablist_props=assign(tablist_props,tablist_spread_levels[i]);}tablist=new TabList({props:tablist_props});tablist.$on("select",/*select_handler*/ctx[24]);return{c:function c(){create_component(tablist.$$.fragment);},m:function m(target,anchor){mount_component(tablist,target,anchor);current=true;},p:function p(ctx,dirty){var tablist_changes=dirty[0]&/*tabs, tabsConfig*/34?get_spread_update(tablist_spread_levels,[tablist_spread_levels[0],dirty[0]&/*tabs*/2&&{tabs:/*tabs*/ctx[1]},dirty[0]&/*tabsConfig*/32&&get_spread_object(/*tabsConfig*/ctx[5])]):{};if(dirty[1]&/*$$scope, tab*/6144){tablist_changes.$$scope={dirty:dirty,ctx:ctx};}tablist.$set(tablist_changes);},i:function i(local){if(current)return;transition_in(tablist.$$.fragment,local);current=true;},o:function o(local){transition_out(tablist.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(tablist,detaching);}};}// (175:8) <TabPanels             class="PinturaControlPanels"             panelClass="PinturaControlPanel"             {panels}             {...tabsConfig}             let:panel         >
function create_default_slot$8(ctx){var rangeinput;var current;var rangeinput_spread_levels=[/*$rangeInputConfig*/ctx[7][/*panel*/ctx[41]]];var rangeinput_props={};for(var i=0;i<rangeinput_spread_levels.length;i+=1){rangeinput_props=assign(rangeinput_props,rangeinput_spread_levels[i]);}rangeinput=new RangeInput({props:rangeinput_props});return{c:function c(){create_component(rangeinput.$$.fragment);},m:function m(target,anchor){mount_component(rangeinput,target,anchor);current=true;},p:function p(ctx,dirty){var rangeinput_changes=dirty[0]&/*$rangeInputConfig*/128|dirty[1]&/*panel*/1024?get_spread_update(rangeinput_spread_levels,[get_spread_object(/*$rangeInputConfig*/ctx[7][/*panel*/ctx[41]])]):{};rangeinput.$set(rangeinput_changes);},i:function i(local){if(current)return;transition_in(rangeinput.$$.fragment,local);current=true;},o:function o(local){transition_out(rangeinput.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(rangeinput,detaching);}};}// (159:4) 
function create_footer_slot$4(ctx){var div;var scrollable;var t;var tabpanels;var current;scrollable=new Scrollable({props:{elasticity:/*$elasticityMultiplier*/ctx[6]*/*scrollElasticity*/ctx[9],"class":"PinturaControlListScroller",$$slots:{"default":[create_default_slot_1$2]},$$scope:{ctx:ctx}}});var tabpanels_spread_levels=[{"class":"PinturaControlPanels"},{panelClass:"PinturaControlPanel"},{panels:/*panels*/ctx[4]},/*tabsConfig*/ctx[5]];var tabpanels_props={$$slots:{"default":[create_default_slot$8,function(_ref399){var panel=_ref399.panel;return{41:panel};},function(_ref400){var panel=_ref400.panel;return[0,panel?1024:0];}]},$$scope:{ctx:ctx}};for(var i=0;i<tabpanels_spread_levels.length;i+=1){tabpanels_props=assign(tabpanels_props,tabpanels_spread_levels[i]);}tabpanels=new TabPanels({props:tabpanels_props});return{c:function c(){div=element("div");create_component(scrollable.$$.fragment);t=space();create_component(tabpanels.$$.fragment);attr(div,"slot","footer");attr(div,"style",/*footerStyle*/ctx[3]);},m:function m(target,anchor){insert(target,div,anchor);mount_component(scrollable,div,null);append(div,t);mount_component(tabpanels,div,null);current=true;},p:function p(ctx,dirty){var scrollable_changes={};if(dirty[0]&/*$elasticityMultiplier*/64)scrollable_changes.elasticity=/*$elasticityMultiplier*/ctx[6]*/*scrollElasticity*/ctx[9];if(dirty[0]&/*tabs, tabsConfig, tabSelected*/38|dirty[1]&/*$$scope*/4096){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);var tabpanels_changes=dirty[0]&/*panels, tabsConfig*/48?get_spread_update(tabpanels_spread_levels,[tabpanels_spread_levels[0],tabpanels_spread_levels[1],dirty[0]&/*panels*/16&&{panels:/*panels*/ctx[4]},dirty[0]&/*tabsConfig*/32&&get_spread_object(/*tabsConfig*/ctx[5])]):{};if(dirty[0]&/*$rangeInputConfig*/128|dirty[1]&/*$$scope, panel*/5120){tabpanels_changes.$$scope={dirty:dirty,ctx:ctx};}tabpanels.$set(tabpanels_changes);if(!current||dirty[0]&/*footerStyle*/8){attr(div,"style",/*footerStyle*/ctx[3]);}},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);transition_in(tabpanels.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);transition_out(tabpanels.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(scrollable);destroy_component(tabpanels);}};}function create_fragment$k(ctx){var util;var current;util=new Util({props:{$$slots:{footer:[create_footer_slot$4]},$$scope:{ctx:ctx}}});util.$on("measure",/*measure_handler*/ctx[25]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*footerStyle, panels, tabsConfig, $rangeInputConfig, $elasticityMultiplier, tabs, tabSelected*/254|dirty[1]&/*$$scope*/4096){util_changes.$$scope={dirty:dirty,ctx:ctx};}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}function instance$k($$self,$$props,$$invalidate){var tabs;var tabSelected;var tabsConfig;var panels;var footerStyle;var $footerOffset;var $isActive,$$unsubscribe_isActive=noop,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(21,$isActive=$$value);}),isActive;};var $animation;var $panelValues;var $elasticityMultiplier;var $rangeInputConfig;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});var name='finetune';var stores=$$props.stores;var isActive=$$props.isActive;$$subscribe_isActive();var _$$props$locale6=$$props.locale,locale=_$$props$locale6===void 0?{}:_$$props$locale6;var finetuneControlConfiguration=$$props.finetuneControlConfiguration;var finetuneOptions=$$props.finetuneOptions;var _$$props$finetuneNudg=$$props.finetuneNudgePrecision,finetuneNudgePrecision=_$$props$finetuneNudg===void 0?undefined:_$$props$finetuneNudg;var _stores5=stores,history=_stores5.history,animation=_stores5.animation,scrollElasticity=_stores5.scrollElasticity,rangeInputElasticity=_stores5.rangeInputElasticity,imageColorMatrix=_stores5.imageColorMatrix,imageConvolutionMatrix=_stores5.imageConvolutionMatrix,imageGamma=_stores5.imageGamma,imageVignette=_stores5.imageVignette,imageNoise=_stores5.imageNoise,allowPan=_stores5.allowPan,allowZoom=_stores5.allowZoom,allowZoomControls=_stores5.allowZoomControls;component_subscribe($$self,animation,function(value){return $$invalidate(22,$animation=value);});var imageEffectStores={imageColorMatrix:imageColorMatrix,imageConvolutionMatrix:imageConvolutionMatrix,imageGamma:imageGamma,imageVignette:imageVignette,imageNoise:imageNoise};//
// context
//
var elasticityMultiplier=getContext('elasticityMultiplier');component_subscribe($$self,elasticityMultiplier,function(value){return $$invalidate(6,$elasticityMultiplier=value);});//
// Tabs
//
var uid="finetune-".concat(getUniqueId());//
// Range inputs
//
var panelValues=writable({});component_subscribe($$self,panelValues,function(value){return $$invalidate(23,$panelValues=value);});var rangeInputConfig=writable({});component_subscribe($$self,rangeInputConfig,function(value){return $$invalidate(7,$rangeInputConfig=value);});var updateRangeInputState=function updateRangeInputState(){set_store_value(rangeInputConfig,$rangeInputConfig=Object.keys($panelValues).reduce(function(config,id){var _finetuneControlConfi=finetuneControlConfiguration[id],base=_finetuneControlConfi.base,min=_finetuneControlConfi.min,max=_finetuneControlConfi.max,getLabel=_finetuneControlConfi.getLabel,getStore=_finetuneControlConfi.getStore,_finetuneControlConfi2=_finetuneControlConfi.setValue,setValue=_finetuneControlConfi2===void 0?function(store,v){return store.set(v);}:_finetuneControlConfi2;var store=getStore(imageEffectStores);var value=$panelValues[id]!=null?$panelValues[id]:base;config[id]={base:base,min:min,max:max,value:value,valueLabel:getLabel?getLabel(value,min,max,max-min):Math.round(100*value),oninputmove:function oninputmove(v){setValue(store,v);},oninputend:function oninputend(v){setValue(store,v);history.write();},elasticity:$elasticityMultiplier*rangeInputElasticity,labelReset:locale.labelReset,nudgeMultiplier:finetuneNudgePrecision};return config;},{}),$rangeInputConfig);};// need to unsubscribe when redrawing vie
var unsubs=[];var subscribePanelStores=function subscribePanelStores(config){if(unsubs)unsubs.forEach(function(unsub){return unsub();});unsubs=panels.map(function(id){var _config$id=config[id],getStore=_config$id.getStore,_config$id$getValue=_config$id.getValue,getValue=_config$id$getValue===void 0?passthrough:_config$id$getValue;var store=getStore(imageEffectStores);return store.subscribe(function(value){var currentValue=value!=null?getValue(value):value;set_store_value(panelValues,$panelValues=_objectSpread(_objectSpread({},$panelValues),{},_defineProperty({},id,currentValue)),$panelValues);});});};//
// Footer
//
var footerOffset=spring($animation?20:0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(20,$footerOffset=value);});var select_handler=function select_handler(_ref401){var detail=_ref401.detail;return $$invalidate(2,tabSelected=detail);};function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('stores'in $$props)$$invalidate(15,stores=$$props.stores);if('isActive'in $$props)$$subscribe_isActive($$invalidate(0,isActive=$$props.isActive));if('locale'in $$props)$$invalidate(16,locale=$$props.locale);if('finetuneControlConfiguration'in $$props)$$invalidate(17,finetuneControlConfiguration=$$props.finetuneControlConfiguration);if('finetuneOptions'in $$props)$$invalidate(18,finetuneOptions=$$props.finetuneOptions);if('finetuneNudgePrecision'in $$props)$$invalidate(19,finetuneNudgePrecision=$$props.finetuneNudgePrecision);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*$isActive*/2097152){// enable pan and zoom
allowPan.set($isActive);}if($$self.$$.dirty[0]&/*$isActive*/2097152){allowZoom.set($isActive);}if($$self.$$.dirty[0]&/*$isActive*/2097152){allowZoomControls.set($isActive);}if($$self.$$.dirty[0]&/*finetuneOptions, locale*/327680){$$invalidate(1,tabs=finetuneOptions?finetuneOptions.map(function(_ref402){var _ref403=_slicedToArray(_ref402,2),id=_ref403[0],label=_ref403[1];return{id:id,label:isFunction(label)?label(locale):label};}):[]);}if($$self.$$.dirty[0]&/*tabs*/2){$$invalidate(2,tabSelected=tabs.length&&tabs[0].id);}if($$self.$$.dirty[0]&/*tabSelected*/4){$$invalidate(5,tabsConfig={name:uid,selected:tabSelected});}if($$self.$$.dirty[0]&/*tabs*/2){$$invalidate(4,panels=tabs.map(function(tab){return tab.id;}));}if($$self.$$.dirty[0]&/*finetuneControlConfiguration*/131072){finetuneControlConfiguration&&subscribePanelStores(finetuneControlConfiguration);}if($$self.$$.dirty[0]&/*finetuneControlConfiguration, $panelValues*/8519680){finetuneControlConfiguration&&$panelValues&&updateRangeInputState();}if($$self.$$.dirty[0]&/*$animation, $isActive*/6291456){$animation&&footerOffset.set($isActive?0:20);}if($$self.$$.dirty[0]&/*$footerOffset*/1048576){$$invalidate(3,footerStyle=$footerOffset?"transform: translateY(".concat($footerOffset,"px)"):undefined);}};return[isActive,tabs,tabSelected,footerStyle,panels,tabsConfig,$elasticityMultiplier,$rangeInputConfig,animation,scrollElasticity,elasticityMultiplier,panelValues,rangeInputConfig,footerOffset,name,stores,locale,finetuneControlConfiguration,finetuneOptions,finetuneNudgePrecision,$footerOffset,$isActive,$animation,$panelValues,select_handler,measure_handler];}var Finetune=/*#__PURE__*/function(_SvelteComponent34){_inherits(Finetune,_SvelteComponent34);var _super35=_createSuper(Finetune);function Finetune(options){var _this36;_classCallCheck(this,Finetune);_this36=_super35.call(this);init(_assertThisInitialized(_this36),options,instance$k,create_fragment$k,safe_not_equal,{name:14,stores:15,isActive:0,locale:16,finetuneControlConfiguration:17,finetuneOptions:18,finetuneNudgePrecision:19},null,[-1,-1]);return _this36;}_createClass(Finetune,[{key:"name",get:function get(){return this.$$.ctx[14];}},{key:"stores",get:function get(){return this.$$.ctx[15];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"isActive",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"locale",get:function get(){return this.$$.ctx[16];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"finetuneControlConfiguration",get:function get(){return this.$$.ctx[17];},set:function set(finetuneControlConfiguration){this.$$set({finetuneControlConfiguration:finetuneControlConfiguration});flush();}},{key:"finetuneOptions",get:function get(){return this.$$.ctx[18];},set:function set(finetuneOptions){this.$$set({finetuneOptions:finetuneOptions});flush();}},{key:"finetuneNudgePrecision",get:function get(){return this.$$.ctx[19];},set:function set(finetuneNudgePrecision){this.$$set({finetuneNudgePrecision:finetuneNudgePrecision});flush();}}]);return Finetune;}(SvelteComponent);// @ts-ignore
var _plugin_finetune={util:['finetune',Finetune]};var arrayIndexWrap=function arrayIndexWrap(index,arr){var l=arr.length;if(index<0)return index%l+l;if(index>=l)return index%l;return index;};/* src/core/ui/components/ShapeManipulator.svelte generated by Svelte v3.52.0 */function get_each_context$4(ctx,list,i){var child_ctx=ctx.slice();child_ctx[48]=list[i].key;child_ctx[49]=list[i].index;child_ctx[50]=list[i].translate;child_ctx[51]=list[i].scale;child_ctx[14]=list[i].rotate;child_ctx[52]=list[i].dir;child_ctx[53]=list[i].center;child_ctx[54]=list[i].type;child_ctx[2]=list[i].visible;return child_ctx;}// (259:4) {#if type === 'edge' && visible}
function create_if_block_1$3(ctx){var div;var div_style_value;return{c:function c(){div=element("div");attr(div,"class","PinturaShapeManipulator");attr(div,"data-control","point");attr(div,"style",div_style_value="pointer-events:none;transform: translate3d(".concat(/*center*/ctx[53].x,"px, ").concat(/*center*/ctx[53].y,"px, 0) scale(").concat(/*$selectionScale*/ctx[5],", ").concat(/*$selectionScale*/ctx[5],"); opacity: ").concat(/*$selectionOpacity*/ctx[4]));},m:function m(target,anchor){insert(target,div,anchor);},p:function p(ctx,dirty){if(dirty[0]&/*resizeControls, $selectionScale, $selectionOpacity*/56&&div_style_value!==(div_style_value="pointer-events:none;transform: translate3d(".concat(/*center*/ctx[53].x,"px, ").concat(/*center*/ctx[53].y,"px, 0) scale(").concat(/*$selectionScale*/ctx[5],", ").concat(/*$selectionScale*/ctx[5],"); opacity: ").concat(/*$selectionOpacity*/ctx[4]))){attr(div,"style",div_style_value);}},d:function d(detaching){if(detaching)detach(div);}};}// (238:0) {#each resizeControls as { key, index, translate, scale, rotate, dir, center, type, visible }
function create_each_block$4(key_1,ctx){var div;var div_aria_label_value;var div_tabindex_value;var div_data_control_value;var div_style_value;var t;var if_block_anchor;var mounted;var dispose;function nudge_handler(){var _ctx10;for(var _len11=arguments.length,args=new Array(_len11),_key14=0;_key14<_len11;_key14++){args[_key14]=arguments[_key14];}return(/*nudge_handler*/(_ctx10=ctx)[19].apply(_ctx10,[/*index*/ctx[49]].concat(args)));}var if_block=/*type*/ctx[54]==='edge'&&/*visible*/ctx[2]&&create_if_block_1$3(ctx);return{key:key_1,first:null,c:function c(){div=element("div");t=space();if(if_block)if_block.c();if_block_anchor=empty();attr(div,"role","button");attr(div,"aria-label",div_aria_label_value="Drag ".concat(/*type*/ctx[54]," ").concat(/*key*/ctx[48]));attr(div,"tabindex",div_tabindex_value=/*type*/ctx[54]==='edge'?-1:0);attr(div,"class","PinturaShapeManipulator");attr(div,"data-control",div_data_control_value=/*type*/ctx[54]);attr(div,"style",div_style_value="cursor:".concat(/*dir*/ctx[52]?/*dir*/ctx[52]+'-resize':'move',";opacity:").concat(/*$selectionOpacity*/ctx[4],";--tx:").concat(/*translate*/ctx[50].x,";--ty:").concat(/*translate*/ctx[50].y,";--r:").concat(/*type*/ctx[54]==='edge'?/*rotate*/ctx[14]:0,"rad;--sx:").concat(/*type*/ctx[54]==='point'?/*$selectionScale*/ctx[5]:/*scale*/ctx[51].x,";--sy:").concat(/*type*/ctx[54]==='point'?/*$selectionScale*/ctx[5]:/*scale*/ctx[51].y,";"));this.first=div;},m:function m(target,anchor){insert(target,div,anchor);insert(target,t,anchor);if(if_block)if_block.m(target,anchor);insert(target,if_block_anchor,anchor);if(!mounted){dispose=[listen(div,"keydown",/*handleKeyDown*/ctx[7]),listen(div,"keyup",/*handleKeyUp*/ctx[8]),listen(div,"nudge",nudge_handler),action_destroyer(nudgeable.call(null,div,{preventDefault:true})),listen(div,"interactionstart",function(){if(is_function(/*resize*/ctx[11]('start',/*index*/ctx[49])))/*resize*/ctx[11]('start',/*index*/ctx[49]).apply(this,arguments);}),listen(div,"interactionupdate",function(){if(is_function(/*resize*/ctx[11]('move',/*index*/ctx[49])))/*resize*/ctx[11]('move',/*index*/ctx[49]).apply(this,arguments);}),listen(div,"interactionend",function(){if(is_function(/*resize*/ctx[11]('end',/*index*/ctx[49])))/*resize*/ctx[11]('end',/*index*/ctx[49]).apply(this,arguments);}),action_destroyer(interactable.call(null,div))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(dirty[0]&/*resizeControls*/8&&div_aria_label_value!==(div_aria_label_value="Drag ".concat(/*type*/ctx[54]," ").concat(/*key*/ctx[48]))){attr(div,"aria-label",div_aria_label_value);}if(dirty[0]&/*resizeControls*/8&&div_tabindex_value!==(div_tabindex_value=/*type*/ctx[54]==='edge'?-1:0)){attr(div,"tabindex",div_tabindex_value);}if(dirty[0]&/*resizeControls*/8&&div_data_control_value!==(div_data_control_value=/*type*/ctx[54])){attr(div,"data-control",div_data_control_value);}if(dirty[0]&/*resizeControls, $selectionOpacity, $selectionScale*/56&&div_style_value!==(div_style_value="cursor:".concat(/*dir*/ctx[52]?/*dir*/ctx[52]+'-resize':'move',";opacity:").concat(/*$selectionOpacity*/ctx[4],";--tx:").concat(/*translate*/ctx[50].x,";--ty:").concat(/*translate*/ctx[50].y,";--r:").concat(/*type*/ctx[54]==='edge'?/*rotate*/ctx[14]:0,"rad;--sx:").concat(/*type*/ctx[54]==='point'?/*$selectionScale*/ctx[5]:/*scale*/ctx[51].x,";--sy:").concat(/*type*/ctx[54]==='point'?/*$selectionScale*/ctx[5]:/*scale*/ctx[51].y,";"))){attr(div,"style",div_style_value);}if(/*type*/ctx[54]==='edge'&&/*visible*/ctx[2]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block_1$3(ctx);if_block.c();if_block.m(if_block_anchor.parentNode,if_block_anchor);}}else if(if_block){if_block.d(1);if_block=null;}},d:function d(detaching){if(detaching)detach(div);if(detaching)detach(t);if(if_block)if_block.d(detaching);if(detaching)detach(if_block_anchor);mounted=false;run_all(dispose);}};}// (269:0) {#if enableRotatePoints}
function create_if_block$4(ctx){var div;var div_style_value;var mounted;var dispose;return{c:function c(){div=element("div");attr(div,"role","button");attr(div,"aria-label","Drag rotator");attr(div,"tabindex","0");attr(div,"class","PinturaShapeManipulator");attr(div,"data-control","rotate");attr(div,"style",div_style_value="transform: translate3d(".concat(/*rotatorPoint*/ctx[0].x,"px, ").concat(/*rotatorPoint*/ctx[0].y,"px, 0) scale(").concat(/*$selectionScale*/ctx[5],", ").concat(/*$selectionScale*/ctx[5],"); opacity: ").concat(/*$selectionOpacity*/ctx[4]));},m:function m(target,anchor){insert(target,div,anchor);if(!mounted){dispose=[listen(div,"keydown",/*handleKeyDown*/ctx[7]),listen(div,"keyup",/*handleKeyUp*/ctx[8]),listen(div,"nudge",/*handleRotateNudge*/ctx[13]),action_destroyer(nudgeable.call(null,div,{preventDefault:true})),listen(div,"interactionstart",/*rotate*/ctx[14]('start')),listen(div,"interactionupdate",/*rotate*/ctx[14]('move')),listen(div,"interactionend",/*rotate*/ctx[14]('end')),action_destroyer(interactable.call(null,div))];mounted=true;}},p:function p(ctx,dirty){if(dirty[0]&/*rotatorPoint, $selectionScale, $selectionOpacity*/49&&div_style_value!==(div_style_value="transform: translate3d(".concat(/*rotatorPoint*/ctx[0].x,"px, ").concat(/*rotatorPoint*/ctx[0].y,"px, 0) scale(").concat(/*$selectionScale*/ctx[5],", ").concat(/*$selectionScale*/ctx[5],"); opacity: ").concat(/*$selectionOpacity*/ctx[4]))){attr(div,"style",div_style_value);}},d:function d(detaching){if(detaching)detach(div);mounted=false;run_all(dispose);}};}function create_fragment$j(ctx){var each_blocks=[];var each_1_lookup=new Map();var t;var if_block_anchor;var each_value=/*resizeControls*/ctx[3];var get_key=function get_key(ctx){return(/*key*/ctx[48]);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$4(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$4(key,child_ctx));}var if_block=/*enableRotatePoints*/ctx[1]&&create_if_block$4(ctx);return{c:function c(){for(var _i31=0;_i31<each_blocks.length;_i31+=1){each_blocks[_i31].c();}t=space();if(if_block)if_block.c();if_block_anchor=empty();},m:function m(target,anchor){for(var _i32=0;_i32<each_blocks.length;_i32+=1){each_blocks[_i32].m(target,anchor);}insert(target,t,anchor);if(if_block)if_block.m(target,anchor);insert(target,if_block_anchor,anchor);},p:function p(ctx,dirty){if(dirty[0]&/*resizeControls, $selectionScale, $selectionOpacity, handleKeyDown, handleKeyUp, handleResizeNudge, resize*/6584){each_value=/*resizeControls*/ctx[3];each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value,each_1_lookup,t.parentNode,destroy_block,create_each_block$4,t,get_each_context$4);}if(/*enableRotatePoints*/ctx[1]){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block$4(ctx);if_block.c();if_block.m(if_block_anchor.parentNode,if_block_anchor);}}else if(if_block){if_block.d(1);if_block=null;}},i:noop,o:noop,d:function d(detaching){for(var _i33=0;_i33<each_blocks.length;_i33+=1){each_blocks[_i33].d(detaching);}if(detaching)detach(t);if(if_block)if_block.d(detaching);if(detaching)detach(if_block_anchor);}};}function instance$j($$self,$$props,$$invalidate){var resizeControls;var $isAnimated;var $selectionOpacity;var $selectionScale;var dispatch=createEventDispatcher();// which cursor to render
var EIGTH_PI=QUART_PI*0.5;var N=HALF_PI;var N0=N-EIGTH_PI;var N1=N+EIGTH_PI;var S=-HALF_PI;var S0=S-EIGTH_PI;var S1=S+EIGTH_PI;var E=PI;var E0=E-EIGTH_PI;var E1=-PI+EIGTH_PI;var W0=EIGTH_PI;var W1=-EIGTH_PI;var NW=N-QUART_PI;var NW0=NW-EIGTH_PI;var NW1=NW+EIGTH_PI;var NE=PI-QUART_PI;var NE0=NE-EIGTH_PI;var NE1=NE+EIGTH_PI;var SE=S-QUART_PI;var SE0=SE+EIGTH_PI;var SE1=SE-EIGTH_PI;var SW=S+QUART_PI;var SW0=SW+EIGTH_PI;var SW1=SW-EIGTH_PI;var _$$props$visible3=$$props.visible,visible=_$$props$visible3===void 0?false:_$$props$visible3;var _$$props$points=$$props.points,points=_$$props$points===void 0?[]:_$$props$points;var _$$props$rotatorPoint=$$props.rotatorPoint,rotatorPoint=_$$props$rotatorPoint===void 0?undefined:_$$props$rotatorPoint;var _$$props$enableDragEd=$$props.enableDragEdges,enableDragEdges=_$$props$enableDragEd===void 0?true:_$$props$enableDragEd;var _$$props$enableDragPo=$$props.enableDragPoints,enableDragPoints=_$$props$enableDragPo===void 0?true:_$$props$enableDragPo;var _$$props$enableRotate=$$props.enableRotatePoints,enableRotatePoints=_$$props$enableRotate===void 0?true:_$$props$enableRotate;// contex
var isAnimated=getContext('isAnimated');component_subscribe($$self,isAnimated,function(value){return $$invalidate(18,$isAnimated=value);});// internal
var shiftKey=false;var handleKeyDown=function handleKeyDown(e){return shiftKey=e.shiftKey;};var handleKeyUp=function handleKeyUp(e){return shiftKey=false;};// state
var selectionScale=spring(0.5,{precision:0.0001,stiffness:0.3,damping:0.7});component_subscribe($$self,selectionScale,function(value){return $$invalidate(5,$selectionScale=value);});var selectionOpacity=spring(0,{precision:0.001,stiffness:0.3,damping:0.7});component_subscribe($$self,selectionOpacity,function(value){return $$invalidate(4,$selectionOpacity=value);});var rotate=function rotate(type){return function(_ref404){var detail=_ref404.detail;// always make sure we have a translation to work with
var translation=detail&&detail.translation?detail.translation:vectorCreate(0,0);dispatch("rotate".concat(type),{translation:translation,shiftKey:shiftKey});};};var resize=function resize(type,indexes){return function(_ref405){var detail=_ref405.detail;// always make sure we have a translation to work with
var translation=detail&&detail.translation?detail.translation:vectorCreate(0,0);// done transforming the points
dispatch("resize".concat(type),_objectSpread(_objectSpread({},detail),{},{indexes:indexes,translation:translation,shiftKey:shiftKey}));};};// https://en.wikipedia.org/wiki/Radian#/media/File:Degree-Radian_Conversion.svg
var getDirectionByAngle=function getDirectionByAngle(angle){var dir='';var isNorth=angle<=N1&&angle>=N0;var isSouth=angle>=S0&&angle<=S1;var isEast=angle<=E1||angle>=E0;var isWest=angle>=W1&&angle<=W0;var isNorthEast=angle>=NE0&&angle<=NE1;var isNorthWest=angle>=NW0&&angle<=NW1;var isSouthEast=angle<=SE0&&angle>=SE1;var isSouthWest=angle<=SW0&&angle>=SW1;if(isNorth||isSouth)dir='ns';if(isEast||isWest)dir='ew';if(isNorthEast||isSouthWest)dir='nesw';if(isNorthWest||isSouthEast)dir='nwse';return dir;};// 2 points -> [corner, corner]
// 3 points => [corner, edge, corner, edge, corner, edge],
// 4 points => [corner, edge, corner, edge, corner, edge, corner, edge]
var mapPointsToControls=function mapPointsToControls(points,axis){var i=0;var center=vectorCenter(points);var out=[];var l=points.length;// const isLine = l === 2 || l > 4;
// const isAxisLimited = axis !== 'both';
var _loop2=function _loop2(){var i0=arrayIndexWrap(i-1,points);// const i1 = i;
var i2=arrayIndexWrap(i+1,points);var p0=points[i0];var p1=points[i];var p2=points[i2];var dir=Math.atan2(p2.y-p1.y,p2.x-p1.x);// can drag vertices
if(enableDragPoints){var a=vectorNormalize(vectorCreate(p0.x-p1.x,p0.y-p1.y));var b=vectorNormalize(vectorCreate(p2.x-p1.x,p2.y-p1.y));var cornerVector=vectorCreate(a.x+b.x,a.y+b.y);var _dir=!enableDragEdges?undefined:enableDragPoints&&getDirectionByAngle(Math.atan2(cornerVector.y,cornerVector.x));out.push({index:[i],key:"point-".concat(i),type:'point',scale:{x:1,y:1},translate:{x:p1.x,y:p1.y},angle:undefined,rotate:enableRotatePoints,center:p1,dir:_dir});}// skip edge dragging
if(!enableDragEdges)return"continue";if(Array.isArray(enableDragEdges)&&!enableDragEdges.some(function(_ref406){var _ref407=_slicedToArray(_ref406,2),indexFrom=_ref407[0],indexTo=_ref407[1];return i===indexFrom&&i2===indexTo;}))return"continue";var mid=vectorCreate(p1.x+(p2.x-p1.x)*0.5,p1.y+(p2.y-p1.y)*0.5);// create edge
out.push({index:[i,i2],key:"edge-".concat(i),type:'edge',scale:{x:vectorDistance(p1,p2),y:1},translate:{x:p1.x,y:p1.y},angle:dir,rotate:dir,center:mid,visible:Array.isArray(enableDragEdges),dir:getDirectionByAngle(Math.atan2(center.y-mid.y,center.x-mid.x))});};for(;i<l;i++){var _ret2=_loop2();if(_ret2==="continue")continue;}return out;};var handleResizeNudge=function handleResizeNudge(indexes,translation){dispatch("resizestart",{indexes:indexes,translation:vectorCreateEmpty()});dispatch("resizemove",{indexes:indexes,translation:translation});dispatch("resizeend",{indexes:indexes,translation:vectorCreateEmpty()});};var handleRotateNudge=function handleRotateNudge(_ref408){var detail=_ref408.detail;dispatch("rotatestart",{translation:vectorCreateEmpty()});dispatch("rotatemove",{translation:detail});dispatch("rotateend",{translation:vectorCreateEmpty()});};var nudge_handler=function nudge_handler(index,_ref409){var detail=_ref409.detail;return handleResizeNudge(index,detail);};$$self.$$set=function($$props){if('visible'in $$props)$$invalidate(2,visible=$$props.visible);if('points'in $$props)$$invalidate(15,points=$$props.points);if('rotatorPoint'in $$props)$$invalidate(0,rotatorPoint=$$props.rotatorPoint);if('enableDragEdges'in $$props)$$invalidate(16,enableDragEdges=$$props.enableDragEdges);if('enableDragPoints'in $$props)$$invalidate(17,enableDragPoints=$$props.enableDragPoints);if('enableRotatePoints'in $$props)$$invalidate(1,enableRotatePoints=$$props.enableRotatePoints);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*visible, $isAnimated*/262148){selectionScale.set(visible?1:0.5,{hard:$isAnimated===false});}if($$self.$$.dirty[0]&/*visible, $isAnimated*/262148){selectionOpacity.set(visible?1:0,{hard:$isAnimated===false});}if($$self.$$.dirty[0]&/*points*/32768){$$invalidate(3,resizeControls=mapPointsToControls(points));}};return[rotatorPoint,enableRotatePoints,visible,resizeControls,$selectionOpacity,$selectionScale,isAnimated,handleKeyDown,handleKeyUp,selectionScale,selectionOpacity,resize,handleResizeNudge,handleRotateNudge,rotate,points,enableDragEdges,enableDragPoints,$isAnimated,nudge_handler];}var ShapeManipulator=/*#__PURE__*/function(_SvelteComponent35){_inherits(ShapeManipulator,_SvelteComponent35);var _super36=_createSuper(ShapeManipulator);function ShapeManipulator(options){var _this37;_classCallCheck(this,ShapeManipulator);_this37=_super36.call(this);init(_assertThisInitialized(_this37),options,instance$j,create_fragment$j,safe_not_equal,{visible:2,points:15,rotatorPoint:0,enableDragEdges:16,enableDragPoints:17,enableRotatePoints:1},null,[-1,-1]);return _this37;}return _createClass(ShapeManipulator);}(SvelteComponent);var getEventPositionInEditor=function getEventPositionInEditor(e,viewOffset){var positionInViewport=getEventPositionInViewport(e);return vectorSubtract(positionInViewport,viewOffset);};var cursorMoveToEnd=function cursorMoveToEnd(field){return field.selectionStart=field.selectionEnd=field.value.length;};var result=null;var supportsVisualViewport=function supportsVisualViewport(){if(result===null){result=isBrowser()&&'visualViewport'in window;}return result;};var createSoftKeyboardObserver=function createSoftKeyboardObserver(cb){if(!supportsVisualViewport())return false;var heightNormal=visualViewport.height;var testState=function testState(){cb(visualViewport.height<heightNormal?'visible':'hidden');};visualViewport.addEventListener('resize',testState);return function(){return visualViewport.removeEventListener('resize',testState);};};/* src/core/ui/components/InputForm.svelte generated by Svelte v3.52.0 */function create_fragment$i(ctx){var div2;var div1;var button0;var t0;var div0;var t1;var button1;var current;var mounted;var dispose;button0=new Button({props:{onclick:/*oncancel*/ctx[1],label:/*labelCancel*/ctx[5],icon:/*iconCancel*/ctx[7],hideLabel:!/*labelCancelShow*/ctx[6]}});var default_slot_template=/*#slots*/ctx[20]["default"];var default_slot=create_slot(default_slot_template,ctx,/*$$scope*/ctx[19],null);button1=new Button({props:{onclick:/*onconfirm*/ctx[0],label:/*labelConfirm*/ctx[2],icon:/*iconConfirm*/ctx[4],hideLabel:!/*labelConfirmShow*/ctx[3],"class":"PinturaInputFormButtonConfirm"}});return{c:function c(){div2=element("div");div1=element("div");create_component(button0.$$.fragment);t0=space();div0=element("div");if(default_slot)default_slot.c();t1=space();create_component(button1.$$.fragment);attr(div0,"class","PinturaInputFormFields");attr(div1,"class","PinturaInputFormInner");attr(div2,"class","PinturaInputForm");attr(div2,"style",/*style*/ctx[9]);},m:function m(target,anchor){insert(target,div2,anchor);append(div2,div1);mount_component(button0,div1,null);append(div1,t0);append(div1,div0);if(default_slot){default_slot.m(div0,null);}append(div1,t1);mount_component(button1,div1,null);/*div2_binding*/ctx[21](div2);current=true;if(!mounted){dispose=[listen(div2,"focusin",/*handleFocusIn*/ctx[10]),listen(div2,"focusout",/*handleFocusOut*/ctx[11]),listen(div2,"measure",/*handleMeasure*/ctx[12]),action_destroyer(measurable.call(null,div2))];mounted=true;}},p:function p(ctx,dirty){var button0_changes={};if(dirty[0]&/*oncancel*/2)button0_changes.onclick=/*oncancel*/ctx[1];if(dirty[0]&/*labelCancel*/32)button0_changes.label=/*labelCancel*/ctx[5];if(dirty[0]&/*iconCancel*/128)button0_changes.icon=/*iconCancel*/ctx[7];if(dirty[0]&/*labelCancelShow*/64)button0_changes.hideLabel=!/*labelCancelShow*/ctx[6];button0.$set(button0_changes);if(default_slot){if(default_slot.p&&(!current||dirty[0]&/*$$scope*/524288)){update_slot_base(default_slot,default_slot_template,ctx,/*$$scope*/ctx[19],!current?get_all_dirty_from_scope(/*$$scope*/ctx[19]):get_slot_changes(default_slot_template,/*$$scope*/ctx[19],dirty,null),null);}}var button1_changes={};if(dirty[0]&/*onconfirm*/1)button1_changes.onclick=/*onconfirm*/ctx[0];if(dirty[0]&/*labelConfirm*/4)button1_changes.label=/*labelConfirm*/ctx[2];if(dirty[0]&/*iconConfirm*/16)button1_changes.icon=/*iconConfirm*/ctx[4];if(dirty[0]&/*labelConfirmShow*/8)button1_changes.hideLabel=!/*labelConfirmShow*/ctx[3];button1.$set(button1_changes);if(!current||dirty[0]&/*style*/512){attr(div2,"style",/*style*/ctx[9]);}},i:function i(local){if(current)return;transition_in(button0.$$.fragment,local);transition_in(default_slot,local);transition_in(button1.$$.fragment,local);current=true;},o:function o(local){transition_out(button0.$$.fragment,local);transition_out(default_slot,local);transition_out(button1.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div2);destroy_component(button0);if(default_slot)default_slot.d(detaching);destroy_component(button1);/*div2_binding*/ctx[21](null);mounted=false;run_all(dispose);}};}var panelDelay=200;function instance$i($$self,$$props,$$invalidate){var computedStyle;var shouldStickToKeyboard;var style;var _$$props$$$slots15=$$props.$$slots,slots=_$$props$$$slots15===void 0?{}:_$$props$$$slots15,$$scope=$$props.$$scope;var onconfirm=$$props.onconfirm;var oncancel=$$props.oncancel;var _$$props$autoFocus=$$props.autoFocus,autoFocus=_$$props$autoFocus===void 0?true:_$$props$autoFocus;var _$$props$autoPosition=$$props.autoPositionCursor,autoPositionCursor=_$$props$autoPosition===void 0?true:_$$props$autoPosition;var labelConfirm=$$props.labelConfirm;var _$$props$labelConfirm=$$props.labelConfirmShow,labelConfirmShow=_$$props$labelConfirm===void 0?true:_$$props$labelConfirm;var iconConfirm=$$props.iconConfirm;var labelCancel=$$props.labelCancel;var _$$props$labelCancelS=$$props.labelCancelShow,labelCancelShow=_$$props$labelCancelS===void 0?false:_$$props$labelCancelS;var iconCancel=$$props.iconCancel;var _$$props$panelOffset=$$props.panelOffset,panelOffset=_$$props$panelOffset===void 0?vectorCreateEmpty():_$$props$panelOffset;var panelVisible=false;var panelHeight=undefined;var panelRevealTimeout=undefined;var panelPosition='';var panelOpacity=0;var root;var isTextarea=function isTextarea(element){return /textarea/i.test(element);};var preventTextAreaScrollingOnIOS=function preventTextAreaScrollingOnIOS(element){// preventsDefault on textarea events when can no longer scroll up or down in textarea
var lastScreenY;var handleTouchStart=function handleTouchStart(e){return lastScreenY=e.touches[0].screenY;};var handleTouchMove=function handleTouchMove(e){var currentScreenY=e.touches[0].screenY;var target=e.target;if(/textarea/i.test(target.nodeName)){// moving down
if(currentScreenY>lastScreenY){if(target.scrollTop==0){e.preventDefault();}}else// moving up
if(currentScreenY<lastScreenY){if(target.scrollTop+target.offsetHeight==target.scrollHeight){e.preventDefault();}}else{e.preventDefault();}lastScreenY=currentScreenY;}else{e.preventDefault();}};element.addEventListener('touchstart',handleTouchStart);element.addEventListener('touchmove',handleTouchMove);return function(){element.removeEventListener('touchstart',handleTouchStart);element.removeEventListener('touchmove',handleTouchMove);};};var focus=function focus(){var field=root.querySelector('input, textarea');field.focus();// only select when showing for first time
if(panelOpacity>=1)return;field.select();};var show=function show(){panelVisible=true;// browser does not support keyboard listener, place modal at top of view
if(!unsubSoftKeyboardListener&&(isIOS()||isAndroid())){$$invalidate(16,panelPosition='top:1em;bottom:auto;');}// prevent interacting with the root element
if(isIOS())preventTextAreaScrollingOnIOS(root);// reveal
$$invalidate(17,panelOpacity=1);};var hide=function hide(){panelVisible=false;$$invalidate(17,panelOpacity=0);};var handleSoftKeyboard=function handleSoftKeyboard(keyboardState){// shouldn't stick, we'll stick it to the top of the viewport so the keyboard doesn't obscure the input field
if(!shouldStickToKeyboard){$$invalidate(16,panelPosition="top: 4.5em; bottom: auto");return;}// no need to continue, already hidden
if(keyboardState==='hidden'&&!panelVisible){focus();return;}// gonna update position here
clearTimeout(panelRevealTimeout);panelRevealTimeout=undefined;// position
$$invalidate(16,panelPosition="top:".concat(visualViewport.height-panelHeight-panelOffset.y,"px"));// if a soft keyboard is detected, turn into modal mode
if(keyboardState==='visible'){// stick to keyboard
$$invalidate(8,root.dataset.layout='stick',root);// need to refocus
focus();// place above keyboard
show();}else// keyboard is hidden
{hide();}};var focusDateTime;var handleFocusIn=function handleFocusIn(e){if(!isTextarea(e.target))return;// we need to remember focus time so we can detect unrealistic blur event caused by soft keyboard shenanigans
focusDateTime=Date.now();// move cursor
if(autoPositionCursor)cursorMoveToEnd(e.target);// wait a couple milliseconds
clearTimeout(panelRevealTimeout);panelRevealTimeout=setTimeout(show,panelDelay);};var handleFocusOut=function handleFocusOut(e){var focusDuration=Date.now()-focusDateTime;if(focusDuration>50)return;// unrealistic blur, refocus
e.stopPropagation();focus();};var unsubSoftKeyboardListener=createSoftKeyboardObserver(handleSoftKeyboard);var handleMeasure=function handleMeasure(_ref410){var detail=_ref410.detail;panelHeight=detail.height;};onMount(function(){if(!autoFocus)return;focus();});onDestroy(function(){unsubSoftKeyboardListener&&unsubSoftKeyboardListener();});function div2_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){root=$$value;$$invalidate(8,root);});}$$self.$$set=function($$props){if('onconfirm'in $$props)$$invalidate(0,onconfirm=$$props.onconfirm);if('oncancel'in $$props)$$invalidate(1,oncancel=$$props.oncancel);if('autoFocus'in $$props)$$invalidate(13,autoFocus=$$props.autoFocus);if('autoPositionCursor'in $$props)$$invalidate(14,autoPositionCursor=$$props.autoPositionCursor);if('labelConfirm'in $$props)$$invalidate(2,labelConfirm=$$props.labelConfirm);if('labelConfirmShow'in $$props)$$invalidate(3,labelConfirmShow=$$props.labelConfirmShow);if('iconConfirm'in $$props)$$invalidate(4,iconConfirm=$$props.iconConfirm);if('labelCancel'in $$props)$$invalidate(5,labelCancel=$$props.labelCancel);if('labelCancelShow'in $$props)$$invalidate(6,labelCancelShow=$$props.labelCancelShow);if('iconCancel'in $$props)$$invalidate(7,iconCancel=$$props.iconCancel);if('panelOffset'in $$props)$$invalidate(15,panelOffset=$$props.panelOffset);if('$$scope'in $$props)$$invalidate(19,$$scope=$$props.$$scope);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*root*/256){$$invalidate(18,computedStyle=root&&getComputedStyle(root));}if($$self.$$.dirty[0]&/*computedStyle*/262144){shouldStickToKeyboard=computedStyle&&computedStyle.getPropertyValue('--editor-modal')==='1';}if($$self.$$.dirty[0]&/*panelOpacity, panelPosition*/196608){$$invalidate(9,style="opacity:".concat(panelOpacity,";").concat(panelPosition));}};return[onconfirm,oncancel,labelConfirm,labelConfirmShow,iconConfirm,labelCancel,labelCancelShow,iconCancel,root,style,handleFocusIn,handleFocusOut,handleMeasure,autoFocus,autoPositionCursor,panelOffset,panelPosition,panelOpacity,computedStyle,$$scope,slots,div2_binding];}var InputForm=/*#__PURE__*/function(_SvelteComponent36){_inherits(InputForm,_SvelteComponent36);var _super37=_createSuper(InputForm);function InputForm(options){var _this38;_classCallCheck(this,InputForm);_this38=_super37.call(this);init(_assertThisInitialized(_this38),options,instance$i,create_fragment$i,safe_not_equal,{onconfirm:0,oncancel:1,autoFocus:13,autoPositionCursor:14,labelConfirm:2,labelConfirmShow:3,iconConfirm:4,labelCancel:5,labelCancelShow:6,iconCancel:7,panelOffset:15},null,[-1,-1]);return _this38;}return _createClass(InputForm);}(SvelteComponent);var t=function t(text){return document.createTextNode(text);};var replaceDivWithBr=function replaceDivWithBr(html){return(isSafari()&&html.endsWith('<div><br></div>')?html.replace(/<div><br><\/div>$/,'<br><br>'):html).replace(/<div><br><\/div>/g,'<br>').replace(/<\/div>/g,'').replace(/<div>/g,'<br>');};/* src/core/ui/components/ContentEditable.svelte generated by Svelte v3.52.0 */function create_fragment$h(ctx){var pre;var pre_data_wrap_content_value;var mounted;var dispose;return{c:function c(){pre=element("pre");attr(pre,"class","PinturaContentEditable");attr(pre,"data-wrap-content",pre_data_wrap_content_value=!/*wrapLines*/ctx[3]&&!/*allowNewline*/ctx[4]?'nowrap':'wrap');attr(pre,"contenteditable","");attr(pre,"spellcheck",/*spellcheck*/ctx[0]);attr(pre,"autocorrect",/*autocorrect*/ctx[1]);attr(pre,"autocapitalize",/*autocapitalize*/ctx[2]);attr(pre,"style",/*contentStyle*/ctx[6]);},m:function m(target,anchor){insert(target,pre,anchor);/*pre_binding*/ctx[23](pre);if(!mounted){dispose=[listen(pre,"input",/*handleInput*/ctx[11]),listen(pre,"compositionend",/*handleCompositionEnd*/ctx[10]),listen(pre,"paste",/*handlePaste*/ctx[12]),listen(pre,"keydown",/*handleKeydown*/ctx[8]),listen(pre,"keyup",/*handleKeyup*/ctx[9]),listen(pre,"blur",/*handleBlur*/ctx[7])];mounted=true;}},p:function p(ctx,dirty){if(dirty[0]&/*wrapLines, allowNewline*/24&&pre_data_wrap_content_value!==(pre_data_wrap_content_value=!/*wrapLines*/ctx[3]&&!/*allowNewline*/ctx[4]?'nowrap':'wrap')){attr(pre,"data-wrap-content",pre_data_wrap_content_value);}if(dirty[0]&/*spellcheck*/1){attr(pre,"spellcheck",/*spellcheck*/ctx[0]);}if(dirty[0]&/*autocorrect*/2){attr(pre,"autocorrect",/*autocorrect*/ctx[1]);}if(dirty[0]&/*autocapitalize*/4){attr(pre,"autocapitalize",/*autocapitalize*/ctx[2]);}if(dirty[0]&/*contentStyle*/64){attr(pre,"style",/*contentStyle*/ctx[6]);}},i:noop,o:noop,d:function d(detaching){if(detaching)detach(pre);/*pre_binding*/ctx[23](null);mounted=false;run_all(dispose);}};}function instance$h($$self,$$props,$$invalidate){var isReady;var _$$props$spellcheck=$$props.spellcheck,spellcheck=_$$props$spellcheck===void 0?'false':_$$props$spellcheck;var _$$props$autocorrect=$$props.autocorrect,autocorrect=_$$props$autocorrect===void 0?'off':_$$props$autocorrect;var _$$props$autocapitali=$$props.autocapitalize,autocapitalize=_$$props$autocapitali===void 0?'off':_$$props$autocapitali;var _$$props$wrapLines=$$props.wrapLines,wrapLines=_$$props$wrapLines===void 0?true:_$$props$wrapLines;var _$$props$allowNewline=$$props.allowNewline,allowNewline=_$$props$allowNewline===void 0?true:_$$props$allowNewline;var _$$props$textStyles=$$props.textStyles,textStyles=_$$props$textStyles===void 0?false:_$$props$textStyles;var _$$props$formatInput=$$props.formatInput,formatInput=_$$props$formatInput===void 0?passthrough:_$$props$formatInput;var _$$props$formatPaste=$$props.formatPaste,formatPaste=_$$props$formatPaste===void 0?passthrough:_$$props$formatPaste;var _$$props$style5=$$props.style,style=_$$props$style5===void 0?undefined:_$$props$style5;var _$$props$innerHTML=$$props.innerHTML,innerHTML=_$$props$innerHTML===void 0?undefined:_$$props$innerHTML;var _$$props$oninput=$$props.oninput,oninput=_$$props$oninput===void 0?noop$1:_$$props$oninput;var confirm=function confirm(){return confirmInputState();};var focus=function focus(){return element&&element.focus();};var select=function select(){if(!element)return;var range=document.createRange();range.selectNodeContents(element);var selection=getSelectionSafe();selection.removeAllRanges();selection.addRange(range);};// events
var dispatchEvent=createEventDispatcher();// reference to contenteditable element
var element;// use <br> for line breaks
document.execCommand('defaultParagraphSeparator',false,'br');var setInnerHTML=function setInnerHTML(html){if(html===element.innerHTML)return;$$invalidate(5,element.innerHTML=html,element);if(element===document.activeElement)select();};var removeTextStyles=function removeTextStyles(html){return html.replace(/<\/?(?:i|b|em|strong)>/,'');};var updateInnerHTML=function updateInnerHTML(){// sync property
$$invalidate(13,innerHTML=element.innerHTML);// let others know
var currentValue=replaceDivWithBr(innerHTML);dispatchEvent('input',currentValue);oninput(currentValue);// always scroll to top
requestAnimationFrame(function(){return element&&element.scrollTo(0,0);});};var confirmInputState=function confirmInputState(){// bookmark caret positions
insertBookmarks(element);// remove styles
var html=textStyles?element.innerHTML:removeTextStyles(element.innerHTML);// update HTML (don't remove caret positions)
$$invalidate(5,element.innerHTML=formatInput(html),element);// select bookmarks and remove from DOM
selectBookmarks(element);// content updated
updateInnerHTML();};var handleBlur=function handleBlur(){dispatchEvent('blur');};var handleConfirm=function handleConfirm(){dispatchEvent('confirm');};var handleCancel=function handleCancel(){dispatchEvent('cancel');};var handleKeydown=function handleKeydown(e){// is escape key, cancel
if(/escape/i.test(e.code)){e.stopPropagation();return handleCancel();}// stop here
if(!/enter/i.test(e.code))return;// don't let others handle return while in text area
e.stopPropagation();// is cmd + enter or ctrl + enter
if(e.ctrlKey||e.metaKey)return handleConfirm();// block return when newlines not allowed
if(!allowNewline)e.preventDefault();};var handleKeyup=function handleKeyup(){};var handleCompositionEnd=function handleCompositionEnd(e){if(e.data==='')return;confirmInputState();};var handleInput=function handleInput(e){var inputType=e.inputType;// more info on when inputType is which value
// https://rawgit.com/w3c/input-events/v1/index.html#interface-InputEvent-Attributes
if(inputType==='insertCompositionText'||inputType==='deleteCompositionText'){// we're composing (to for example write é, or Japanese characters),
// if so, wait for composition end before formatting content
return;}confirmInputState();};var handlePaste=function handlePaste(e){e.preventDefault();// remove styles
var plainText=e.clipboardData.getData('text/plain');var html=textStyles?plainText:removeTextStyles(plainText);// format the pasted text before adding
var text=formatPaste(html);if(!text.length)return;// get range for current selection and replace with text
var range=getSelectionSafe().getRangeAt(0);range.deleteContents();range.insertNode(document.createTextNode(text));// content updated
updateInnerHTML();};//#region bookmarks
var createBookmark=function createBookmark(name){var bookmarkNode=h('span');bookmarkNode.dataset.bookmark=name;return bookmarkNode;};var insertBookmark=function insertBookmark(node,offset,name){// create the bookmark element
var bookmarkNode=createBookmark(name);// split up in two text nodes and insert
if(node.nodeType===Node.TEXT_NODE){var _text=node.textContent;if(name==='start'){var before=t(_text.substr(0,offset));var after=t(_text.substr(offset));node.replaceWith(before,bookmarkNode,after);}else{var _before=t(_text.substr(0,offset));var _after=t(_text.substr(offset));node.replaceWith(_before,bookmarkNode,_after);}}else// is node
if(node.nodeType===Node.ELEMENT_NODE){node.insertBefore(bookmarkNode,node.childNodes[offset]);}};var getSelectionSafe=function getSelectionSafe(){var root=element.getRootNode();// chrome needs to select from shadowRoot if in Shadow DOM
// firefox can select from document and doesn't have getSelection support on shadowRoot
// safari cannot deal with text selection in shadowRoot at this time (MacOS Safari 16)
return'getSelection'in root?root.getSelection():document.getSelection();};var insertBookmarks=function insertBookmarks(element){var selection=getSelectionSafe();if(!(selection.getRangeAt&&selection.rangeCount))return;var range=selection.getRangeAt(0);var startOffset=range.startOffset,endOffset=range.endOffset,startContainer=range.startContainer,endContainer=range.endContainer;// range needs to be in element
if(!element.contains(range.startContainer)||!element.contains(range.endContainer))return;// should break up one text container
if(startContainer.nodeType===Node.TEXT_NODE&&startContainer===endContainer){var _text2=startContainer.textContent;var before=_text2.substr(0,startOffset);var bookmarkStart=createBookmark('start');var selected=endOffset-startOffset>0?_text2.substr(startOffset,endOffset):'';var bookmarkEnd=createBookmark('end');var after=_text2.substr(endOffset);startContainer.replaceWith(before,bookmarkStart,selected,bookmarkEnd,after);}else// should add to separate containers
{insertBookmark(startContainer,startOffset,'start');insertBookmark(endContainer,// if is same container need to move to next index as we've just added start bookmark
endOffset+(startContainer===endContainer?1:0),'end');}};var selectBookmarks=function selectBookmarks(element){// get locations of bookmarks
var bookmarkStart=findBookmark(element,'start');var bookmarkEnd=findBookmark(element,'end');// remove bookmarks (if found)
if(!bookmarkStart||!bookmarkEnd)return;// set caret positions
var range=document.createRange();range.setStart(bookmarkStart,0);range.setEnd(bookmarkEnd,0);var selection=getSelectionSafe();selection.removeAllRanges();selection.addRange(range);// remove bookmarks
bookmarkStart.remove();bookmarkEnd.remove();};var findBookmark=function findBookmark(element,name){var children=element.children;for(var i=0;i<children.length;i++){var node=children[i];if(node.dataset.bookmark===name)return node;if(node.children.length){var bookmarkNode=findBookmark(node,name);if(bookmarkNode)return bookmarkNode;}}return;};// add extra space on left or right side of content input so special symbols
// are rendered on correct line while waiting for completion
var contentStyle;function pre_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){element=$$value;$$invalidate(5,element);});}$$self.$$set=function($$props){if('spellcheck'in $$props)$$invalidate(0,spellcheck=$$props.spellcheck);if('autocorrect'in $$props)$$invalidate(1,autocorrect=$$props.autocorrect);if('autocapitalize'in $$props)$$invalidate(2,autocapitalize=$$props.autocapitalize);if('wrapLines'in $$props)$$invalidate(3,wrapLines=$$props.wrapLines);if('allowNewline'in $$props)$$invalidate(4,allowNewline=$$props.allowNewline);if('textStyles'in $$props)$$invalidate(14,textStyles=$$props.textStyles);if('formatInput'in $$props)$$invalidate(15,formatInput=$$props.formatInput);if('formatPaste'in $$props)$$invalidate(16,formatPaste=$$props.formatPaste);if('style'in $$props)$$invalidate(17,style=$$props.style);if('innerHTML'in $$props)$$invalidate(13,innerHTML=$$props.innerHTML);if('oninput'in $$props)$$invalidate(18,oninput=$$props.oninput);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*element*/32){// set value when html property is set and element reference is bound
$$invalidate(22,isReady=!!element);}if($$self.$$.dirty[0]&/*isReady, innerHTML*/4202496){if(isReady&&innerHTML)setInnerHTML(innerHTML);}if($$self.$$.dirty[0]&/*wrapLines, allowNewline, style*/131096){if(!wrapLines&&allowNewline){// TODO: no fix for center text yet
var contentStyleAdditional=style.includes(':right')?'text-indent:-100px!important':!style.includes(':center')?'min-width:calc(100% + 100px)!important':'';$$invalidate(6,contentStyle=style+';overflow:visible;'+contentStyleAdditional);}else{$$invalidate(6,contentStyle=style);}}};return[spellcheck,autocorrect,autocapitalize,wrapLines,allowNewline,element,contentStyle,handleBlur,handleKeydown,handleKeyup,handleCompositionEnd,handleInput,handlePaste,innerHTML,textStyles,formatInput,formatPaste,style,oninput,confirm,focus,select,isReady,pre_binding];}var ContentEditable=/*#__PURE__*/function(_SvelteComponent37){_inherits(ContentEditable,_SvelteComponent37);var _super38=_createSuper(ContentEditable);function ContentEditable(options){var _this39;_classCallCheck(this,ContentEditable);_this39=_super38.call(this);init(_assertThisInitialized(_this39),options,instance$h,create_fragment$h,safe_not_equal,{spellcheck:0,autocorrect:1,autocapitalize:2,wrapLines:3,allowNewline:4,textStyles:14,formatInput:15,formatPaste:16,style:17,innerHTML:13,oninput:18,confirm:19,focus:20,select:21},null,[-1,-1]);return _this39;}_createClass(ContentEditable,[{key:"spellcheck",get:function get(){return this.$$.ctx[0];},set:function set(spellcheck){this.$$set({spellcheck:spellcheck});flush();}},{key:"autocorrect",get:function get(){return this.$$.ctx[1];},set:function set(autocorrect){this.$$set({autocorrect:autocorrect});flush();}},{key:"autocapitalize",get:function get(){return this.$$.ctx[2];},set:function set(autocapitalize){this.$$set({autocapitalize:autocapitalize});flush();}},{key:"wrapLines",get:function get(){return this.$$.ctx[3];},set:function set(wrapLines){this.$$set({wrapLines:wrapLines});flush();}},{key:"allowNewline",get:function get(){return this.$$.ctx[4];},set:function set(allowNewline){this.$$set({allowNewline:allowNewline});flush();}},{key:"textStyles",get:function get(){return this.$$.ctx[14];},set:function set(textStyles){this.$$set({textStyles:textStyles});flush();}},{key:"formatInput",get:function get(){return this.$$.ctx[15];},set:function set(formatInput){this.$$set({formatInput:formatInput});flush();}},{key:"formatPaste",get:function get(){return this.$$.ctx[16];},set:function set(formatPaste){this.$$set({formatPaste:formatPaste});flush();}},{key:"style",get:function get(){return this.$$.ctx[17];},set:function set(style){this.$$set({style:style});flush();}},{key:"innerHTML",get:function get(){return this.$$.ctx[13];},set:function set(innerHTML){this.$$set({innerHTML:innerHTML});flush();}},{key:"oninput",get:function get(){return this.$$.ctx[18];},set:function set(oninput){this.$$set({oninput:oninput});flush();}},{key:"confirm",get:function get(){return this.$$.ctx[19];}},{key:"focus",get:function get(){return this.$$.ctx[20];}},{key:"select",get:function get(){return this.$$.ctx[21];}}]);return ContentEditable;}(SvelteComponent);var textToHTML=function textToHTML(text){var html=text// collapse space sequences
.replace(/ {2,}/g,' ')// handle non breaking space characters
.replace(/&/g,'&amp;').replace(/\u00a0/g,'&nbsp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')// lines
.split('\n')// to br's
.join('<br>');return html;};var htmlToText=function htmlToText(html){var text=replaceDivWithBr(html).split('<br>').join('\n').replace(/&nbsp;/g,String.fromCharCode(160)).replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>');return text;};var fromPercentage=function fromPercentage(value,context){return isString(value)?parseFloat(value)/100*context:value;};var toPercentagePoint=function toPercentagePoint(point,context){return{x:toPercentage(point.x,context.width),y:toPercentage(point.y,context.height)};};/* src/core/ui/components/ShapeLayoutEditor.svelte generated by Svelte v3.52.0 */function get_each_context$3(ctx,list,i){var child_ctx=ctx.slice();child_ctx[218]=list[i];child_ctx[220]=i;return child_ctx;}// (3441:12) {#each shapeNavList as item, index (item.id)}
function create_each_block$3(key_1,ctx){var li;var button;var colorpreview;var t0;var span;var t1_value=/*item*/ctx[218].name+"";var t1;var button_aria_label_value;var t2;var current;var mounted;var dispose;colorpreview=new ColorPreview({props:{color:/*item*/ctx[218].color}});function click_handler(){return(/*click_handler*/ctx[146](/*index*/ctx[220]));}return{key:key_1,first:null,c:function c(){li=element("li");button=element("button");create_component(colorpreview.$$.fragment);t0=space();span=element("span");t1=text(t1_value);t2=space();attr(button,"class","PinturaShapeListItem");attr(button,"type","button");attr(button,"aria-label",button_aria_label_value="Select shape "+/*item*/ctx[218].name);this.first=li;},m:function m(target,anchor){insert(target,li,anchor);append(li,button);mount_component(colorpreview,button,null);append(button,t0);append(button,span);append(span,t1);append(li,t2);current=true;if(!mounted){dispose=listen(button,"click",click_handler);mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;var colorpreview_changes={};if(dirty[0]&/*shapeNavList*/524288)colorpreview_changes.color=/*item*/ctx[218].color;colorpreview.$set(colorpreview_changes);if((!current||dirty[0]&/*shapeNavList*/524288)&&t1_value!==(t1_value=/*item*/ctx[218].name+""))set_data(t1,t1_value);if(!current||dirty[0]&/*shapeNavList*/524288&&button_aria_label_value!==(button_aria_label_value="Select shape "+/*item*/ctx[218].name)){attr(button,"aria-label",button_aria_label_value);}},i:function i(local){if(current)return;transition_in(colorpreview.$$.fragment,local);current=true;},o:function o(local){transition_out(colorpreview.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(li);destroy_component(colorpreview);mounted=false;dispose();}};}// (3457:4) {#if shouldRenderShapeManipulator}
function create_if_block_4$2(ctx){var shapemanipulator;var current;shapemanipulator=new ShapeManipulator({props:{visible:true,points:/*shapeManipulatorPoints*/ctx[10],rotatorPoint:/*shapeManipulatorRotationPointPosition*/ctx[25],enableDragEdges:/*allowEdgeControls*/ctx[15],enableDragPoints:/*allowCornerControls*/ctx[27],enableRotatePoints:/*allowRotateControls*/ctx[13]}});shapemanipulator.$on("resizestart",/*handleManipulatorResizeGrab*/ctx[35]);shapemanipulator.$on("resizemove",/*handleManipulatorResizeDrag*/ctx[36]);shapemanipulator.$on("resizeend",/*handleManipulatorResizeEnd*/ctx[37]);shapemanipulator.$on("rotatestart",/*handleManipulatorRotateGrab*/ctx[38]);shapemanipulator.$on("rotatemove",/*handleManipulatorRotateDrag*/ctx[39]);shapemanipulator.$on("rotateend",/*handleManipulatorRotateEnd*/ctx[40]);return{c:function c(){create_component(shapemanipulator.$$.fragment);},m:function m(target,anchor){mount_component(shapemanipulator,target,anchor);current=true;},p:function p(ctx,dirty){var shapemanipulator_changes={};if(dirty[0]&/*shapeManipulatorPoints*/1024)shapemanipulator_changes.points=/*shapeManipulatorPoints*/ctx[10];if(dirty[0]&/*shapeManipulatorRotationPointPosition*/33554432)shapemanipulator_changes.rotatorPoint=/*shapeManipulatorRotationPointPosition*/ctx[25];if(dirty[0]&/*allowEdgeControls*/32768)shapemanipulator_changes.enableDragEdges=/*allowEdgeControls*/ctx[15];if(dirty[0]&/*allowCornerControls*/134217728)shapemanipulator_changes.enableDragPoints=/*allowCornerControls*/ctx[27];if(dirty[0]&/*allowRotateControls*/8192)shapemanipulator_changes.enableRotatePoints=/*allowRotateControls*/ctx[13];shapemanipulator.$set(shapemanipulator_changes);},i:function i(local){if(current)return;transition_in(shapemanipulator.$$.fragment,local);current=true;},o:function o(local){transition_out(shapemanipulator.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapemanipulator,detaching);}};}// (3474:4) {#if shouldRenderTextInput}
function create_if_block_1$2(ctx){var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block_2$2,create_if_block_3$2];var if_blocks=[];function select_block_type(ctx,dirty){if(/*textInputMode*/ctx[4]==='modal')return 0;if(/*textInputMode*/ctx[4]==='inline')return 1;return-1;}if(~(current_block_type_index=select_block_type(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){if(if_block)if_block.c();if_block_anchor=empty();},m:function m(target,anchor){if(~current_block_type_index){if_blocks[current_block_type_index].m(target,anchor);}insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}else{if_block=null;}}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(~current_block_type_index){if_blocks[current_block_type_index].d(detaching);}if(detaching)detach(if_block_anchor);}};}// (3498:45) 
function create_if_block_3$2(ctx){var div;var contenteditable;var current;var mounted;var dispose;var contenteditable_props={formatInput:/*formatContentEditable*/ctx[42],wrapLines:!!/*activeMarkupComputed*/ctx[12].width,allowNewline:/*shapeAllowNewline*/ctx[26],style:/*textInputTextStyles*/ctx[24]};contenteditable=new ContentEditable({props:contenteditable_props});/*contenteditable_binding*/ctx[149](contenteditable);contenteditable.$on("input",/*handleTextInput*/ctx[43]);contenteditable.$on("keyup",/*handleTextInputKeyUp*/ctx[46]);contenteditable.$on("cancel",/*handleTextCancel*/ctx[48]);contenteditable.$on("confirm",/*handleTextConfirm*/ctx[47]);return{c:function c(){div=element("div");create_component(contenteditable.$$.fragment);attr(div,"class","PinturaInlineInput");attr(div,"style",/*textInputPositionStyles*/ctx[23]);},m:function m(target,anchor){insert(target,div,anchor);mount_component(contenteditable,div,null);current=true;if(!mounted){dispose=listen(div,"focusout",/*focusout_handler*/ctx[150]);mounted=true;}},p:function p(ctx,dirty){var contenteditable_changes={};if(dirty[0]&/*activeMarkupComputed*/4096)contenteditable_changes.wrapLines=!!/*activeMarkupComputed*/ctx[12].width;if(dirty[0]&/*shapeAllowNewline*/67108864)contenteditable_changes.allowNewline=/*shapeAllowNewline*/ctx[26];if(dirty[0]&/*textInputTextStyles*/16777216)contenteditable_changes.style=/*textInputTextStyles*/ctx[24];contenteditable.$set(contenteditable_changes);if(!current||dirty[0]&/*textInputPositionStyles*/8388608){attr(div,"style",/*textInputPositionStyles*/ctx[23]);}},i:function i(local){if(current)return;transition_in(contenteditable.$$.fragment,local);current=true;},o:function o(local){transition_out(contenteditable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);/*contenteditable_binding*/ctx[149](null);destroy_component(contenteditable);mounted=false;dispose();}};}// (3475:8) {#if textInputMode === 'modal'}
function create_if_block_2$2(ctx){var inputform;var current;inputform=new InputForm({props:{panelOffset:/*offset*/ctx[2],onconfirm:/*handleTextConfirm*/ctx[47],oncancel:/*handleTextCancel*/ctx[48],labelCancel:/*locale*/ctx[5].shapeLabelInputCancel,iconCancel:/*locale*/ctx[5].shapeIconInputCancel,labelConfirm:/*locale*/ctx[5].shapeLabelInputConfirm,iconConfirm:/*locale*/ctx[5].shapeIconInputConfirm,$$slots:{"default":[create_default_slot$7]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(inputform.$$.fragment);},m:function m(target,anchor){mount_component(inputform,target,anchor);current=true;},p:function p(ctx,dirty){var inputform_changes={};if(dirty[0]&/*offset*/4)inputform_changes.panelOffset=/*offset*/ctx[2];if(dirty[0]&/*locale*/32)inputform_changes.labelCancel=/*locale*/ctx[5].shapeLabelInputCancel;if(dirty[0]&/*locale*/32)inputform_changes.iconCancel=/*locale*/ctx[5].shapeIconInputCancel;if(dirty[0]&/*locale*/32)inputform_changes.labelConfirm=/*locale*/ctx[5].shapeLabelInputConfirm;if(dirty[0]&/*locale*/32)inputform_changes.iconConfirm=/*locale*/ctx[5].shapeIconInputConfirm;if(dirty[0]&/*textInputTextStyles, textInput, textInputText*/20971648|dirty[7]&/*$$scope*/16){inputform_changes.$$scope={dirty:dirty,ctx:ctx};}inputform.$set(inputform_changes);},i:function i(local){if(current)return;transition_in(inputform.$$.fragment,local);current=true;},o:function o(local){transition_out(inputform.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(inputform,detaching);}};}// (3476:12) <InputForm                 panelOffset={offset}                 onconfirm={handleTextConfirm}                 oncancel={handleTextCancel}                 labelCancel={locale.shapeLabelInputCancel}                 iconCancel={locale.shapeIconInputCancel}                 labelConfirm={locale.shapeLabelInputConfirm}                 iconConfirm={locale.shapeIconInputConfirm}             >
function create_default_slot$7(ctx){var textarea;var mounted;var dispose;return{c:function c(){textarea=element("textarea");attr(textarea,"spellcheck","false");attr(textarea,"autocorrect","off");attr(textarea,"autocapitalize","off");attr(textarea,"style",/*textInputTextStyles*/ctx[24]);},m:function m(target,anchor){insert(target,textarea,anchor);/*textarea_binding*/ctx[147](textarea);set_input_value(textarea,/*textInputText*/ctx[22]);if(!mounted){dispose=[listen(textarea,"keydown",/*handleTextInputKeyDown*/ctx[45]),listen(textarea,"keypress",/*handleTextInputAttempt*/ctx[44]),listen(textarea,"keyup",/*handleTextInputKeyUp*/ctx[46]),listen(textarea,"input",/*handleTextInput*/ctx[43]),listen(textarea,"input",/*textarea_input_handler*/ctx[148])];mounted=true;}},p:function p(ctx,dirty){if(dirty[0]&/*textInputTextStyles*/16777216){attr(textarea,"style",/*textInputTextStyles*/ctx[24]);}if(dirty[0]&/*textInputText*/4194304){set_input_value(textarea,/*textInputText*/ctx[22]);}},d:function d(detaching){if(detaching)detach(textarea);/*textarea_binding*/ctx[147](null);mounted=false;run_all(dispose);}};}// (3522:4) {#if $markupControlsOpacity > 0}
function create_if_block$3(ctx){var div;var dynamiccomponenttree;var current;var mounted;var dispose;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*shapeControls*/ctx[20],key:/*activeShapeId*/ctx[9]}});return{c:function c(){div=element("div");create_component(dynamiccomponenttree.$$.fragment);attr(div,"class","PinturaShapeControls");attr(div,"style",/*markupControlsStyle*/ctx[21]);},m:function m(target,anchor){insert(target,div,anchor);mount_component(dynamiccomponenttree,div,null);current=true;if(!mounted){dispose=[listen(div,"measure",/*measure_handler_1*/ctx[151]),action_destroyer(measurable.call(null,div))];mounted=true;}},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty[0]&/*shapeControls*/1048576)dynamiccomponenttree_changes.items=/*shapeControls*/ctx[20];if(dirty[0]&/*activeShapeId*/512)dynamiccomponenttree_changes.key=/*activeShapeId*/ctx[9];dynamiccomponenttree.$set(dynamiccomponenttree_changes);if(!current||dirty[0]&/*markupControlsStyle*/2097152){attr(div,"style",/*markupControlsStyle*/ctx[21]);}},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(dynamiccomponenttree);mounted=false;run_all(dispose);}};}function create_fragment$g(ctx){var div;var nav;var ul;var each_blocks=[];var each_1_lookup=new Map();var t0;var t1;var t2;var interactable_action;var current;var mounted;var dispose;var each_value=/*shapeNavList*/ctx[19];var get_key=function get_key(ctx){return(/*item*/ctx[218].id);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$3(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$3(key,child_ctx));}var if_block0=/*shouldRenderShapeManipulator*/ctx[14]&&create_if_block_4$2(ctx);var if_block1=/*shouldRenderTextInput*/ctx[11]&&create_if_block_1$2(ctx);var if_block2=/*$markupControlsOpacity*/ctx[16]>0&&create_if_block$3(ctx);return{c:function c(){div=element("div");nav=element("nav");ul=element("ul");for(var _i34=0;_i34<each_blocks.length;_i34+=1){each_blocks[_i34].c();}t0=space();if(if_block0)if_block0.c();t1=space();if(if_block1)if_block1.c();t2=space();if(if_block2)if_block2.c();attr(nav,"class","PinturaShapeList");attr(nav,"data-visible",/*showShapeList*/ctx[17]);attr(div,"class","PinturaShapeEditor");attr(div,"tabindex","0");},m:function m(target,anchor){insert(target,div,anchor);append(div,nav);append(nav,ul);for(var _i35=0;_i35<each_blocks.length;_i35+=1){each_blocks[_i35].m(ul,null);}append(div,t0);if(if_block0)if_block0.m(div,null);append(div,t1);if(if_block1)if_block1.m(div,null);append(div,t2);if(if_block2)if_block2.m(div,null);/*div_binding*/ctx[152](div);current=true;if(!mounted){dispose=[listen(nav,"focusin",/*handleFocusIn*/ctx[51]),listen(nav,"focusout",/*handleFocusOut*/ctx[52]),listen(div,"keydown",function(){if(is_function(/*disabled*/ctx[1]?noop$1:/*handleKey*/ctx[41]))(/*disabled*/ctx[1]?noop$1:/*handleKey*/ctx[41]).apply(this,arguments);}),listen(div,"nudge",function(){if(is_function(/*disabled*/ctx[1]?noop$1:/*handleNudge*/ctx[50]))(/*disabled*/ctx[1]?noop$1:/*handleNudge*/ctx[50]).apply(this,arguments);}),listen(div,"measure",/*measure_handler*/ctx[145]),listen(div,"pointermove",function(){if(is_function(/*disabled*/ctx[1]?noop$1:/*handlePointerMove*/ctx[53]))(/*disabled*/ctx[1]?noop$1:/*handlePointerMove*/ctx[53]).apply(this,arguments);}),listen(div,"interactionstart",function(){if(is_function(/*disabled*/ctx[1]?noop$1:/*handleInteractionStart*/ctx[30]))(/*disabled*/ctx[1]?noop$1:/*handleInteractionStart*/ctx[30]).apply(this,arguments);}),listen(div,"interactionupdate",function(){if(is_function(/*disabled*/ctx[1]?noop$1:/*handleInteractionUpdate*/ctx[32]))(/*disabled*/ctx[1]?noop$1:/*handleInteractionUpdate*/ctx[32]).apply(this,arguments);}),listen(div,"interactioncancel",function(){if(is_function(/*disabled*/ctx[1]?noop$1:/*handleInteractionCancel*/ctx[31]))(/*disabled*/ctx[1]?noop$1:/*handleInteractionCancel*/ctx[31]).apply(this,arguments);}),listen(div,"interactionrelease",function(){if(is_function(/*disabled*/ctx[1]?noop$1:/*handleInteractionRelease*/ctx[33]))(/*disabled*/ctx[1]?noop$1:/*handleInteractionRelease*/ctx[33]).apply(this,arguments);}),listen(div,"interactionend",function(){if(is_function(/*disabled*/ctx[1]?noop$1:/*handleInteractionEnd*/ctx[34]))(/*disabled*/ctx[1]?noop$1:/*handleInteractionEnd*/ctx[34]).apply(this,arguments);}),action_destroyer(measurable.call(null,div)),action_destroyer(nudgeable.call(null,div)),action_destroyer(interactable_action=interactable.call(null,div,{drag:true,inertia:true,multiTouch:false,shouldStartInteraction:interactable_function,getEventPosition:/*interactable_function_1*/ctx[153]}))];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(dirty[0]&/*shapeNavList, selectShape, markup*/524353){each_value=/*shapeNavList*/ctx[19];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value,each_1_lookup,ul,outro_and_destroy_block,create_each_block$3,null,get_each_context$3);check_outros();}if(!current||dirty[0]&/*showShapeList*/131072){attr(nav,"data-visible",/*showShapeList*/ctx[17]);}if(/*shouldRenderShapeManipulator*/ctx[14]){if(if_block0){if_block0.p(ctx,dirty);if(dirty[0]&/*shouldRenderShapeManipulator*/16384){transition_in(if_block0,1);}}else{if_block0=create_if_block_4$2(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(div,t1);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(/*shouldRenderTextInput*/ctx[11]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[0]&/*shouldRenderTextInput*/2048){transition_in(if_block1,1);}}else{if_block1=create_if_block_1$2(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(div,t2);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}if(/*$markupControlsOpacity*/ctx[16]>0){if(if_block2){if_block2.p(ctx,dirty);if(dirty[0]&/*$markupControlsOpacity*/65536){transition_in(if_block2,1);}}else{if_block2=create_if_block$3(ctx);if_block2.c();transition_in(if_block2,1);if_block2.m(div,null);}}else if(if_block2){group_outros();transition_out(if_block2,1,1,function(){if_block2=null;});check_outros();}if(interactable_action&&is_function(interactable_action.update)&&dirty[0]&/*rootRect*/8)interactable_action.update.call(null,{drag:true,inertia:true,multiTouch:false,shouldStartInteraction:interactable_function,getEventPosition:/*interactable_function_1*/ctx[153]});},i:function i(local){if(current)return;for(var _i36=0;_i36<each_value.length;_i36+=1){transition_in(each_blocks[_i36]);}transition_in(if_block0);transition_in(if_block1);transition_in(if_block2);current=true;},o:function o(local){for(var _i37=0;_i37<each_blocks.length;_i37+=1){transition_out(each_blocks[_i37]);}transition_out(if_block0);transition_out(if_block1);transition_out(if_block2);current=false;},d:function d(detaching){if(detaching)detach(div);for(var _i38=0;_i38<each_blocks.length;_i38+=1){each_blocks[_i38].d();}if(if_block0)if_block0.d();if(if_block1)if_block1.d();if(if_block2)if_block2.d();/*div_binding*/ctx[152](null);mounted=false;run_all(dispose);}};}var POLYGON_END_PATH_DISTANCE_SQUARED=256;var POLYGON_VERTEX_MIN_DISTANCE_SQUARED=100;var ROTATION_CONTROL_OFFSET=20;var MIN_TEXT_MARKUP_WIDTH=10;var markupHoverShapeId='markup-hover';var shapeControlDist=16;var interactable_function=function interactable_function(e,element){return e.target===element;};function instance$g($$self,$$props,$$invalidate){var activeMarkup;var activeMarkupSelected;var activeShapeIsDraft;var activeShapeId;var activeMarkupComputed;var activeMarkupItemIsDraft;var shapeActivePoints;var allowResizeControls;var allowRotateControls;var allowEdgeControls;var allowCornerControls;var shouldRenderShapeManipulator;var shapeActiveScreenPoints;var shapeManipulatorPoints;var shapeAllowNewline;var shapeManipulatorRotationPoint;var shapeManipulatorRotationPointPosition;var currentPointerPosition;var isTextMarkupSelected;var shouldRenderTextInput;var textShapeOrigin;var textShapeDisplayOrigin;var textSizeDisplayOrigin;var textRectDisplayOrigin;var textInputText;var textInputTextStyles;var textInputPositionStyles;var controlledMarkupItem;var allowShapeFlip;var allowShapeChangeTextLayout;var allowShapeDuplicate;var allowShapeRemove;var allowShapeReorder;var allowShapeInput;var allowShapeAdjustOpacity;var markupControlsAnchorPosition;var shapeControlsPosition;var markupControlsStyle;var shapeControls;var shapeNavList;var $markupControlsOpacity;var $isAnimated;var $keysPressedStored;var _$$props$uid=$$props.uid,uid=_$$props$uid===void 0?getUniqueId():_$$props$uid;var ui=$$props.ui;var _$$props$disabled4=$$props.disabled,disabled=_$$props$disabled4===void 0?false:_$$props$disabled4;var markup=$$props.markup;var offset=$$props.offset;var _$$props$contextRotat=$$props.contextRotation,contextRotation=_$$props$contextRotat===void 0?0:_$$props$contextRotat;var _$$props$contextFlipX=$$props.contextFlipX,contextFlipX=_$$props$contextFlipX===void 0?false:_$$props$contextFlipX;var _$$props$contextFlipY=$$props.contextFlipY,contextFlipY=_$$props$contextFlipY===void 0?false:_$$props$contextFlipY;var _$$props$contextZoom=$$props.contextZoom,contextZoom=_$$props$contextZoom===void 0?1:_$$props$contextZoom;var _$$props$active=$$props.active,active=_$$props$active===void 0?false:_$$props$active;var _$$props$opacity2=$$props.opacity,opacity=_$$props$opacity2===void 0?1:_$$props$opacity2;var parentRect=$$props.parentRect;var rootRect=$$props.rootRect;var utilRect=$$props.utilRect;var hoverColor=$$props.hoverColor;var _$$props$textInputMod=$$props.textInputMode,textInputMode=_$$props$textInputMod===void 0?'inline':_$$props$textInputMod;var _$$props$oninteractio=$$props.oninteractionstart,oninteractionstart=_$$props$oninteractio===void 0?noop$1:_$$props$oninteractio;var _$$props$oninteractio2=$$props.oninteractionupdate,oninteractionupdate=_$$props$oninteractio2===void 0?noop$1:_$$props$oninteractio2;var _$$props$oninteractio3=$$props.oninteractionrelease,oninteractionrelease=_$$props$oninteractio3===void 0?noop$1:_$$props$oninteractio3;var _$$props$oninteractio4=$$props.oninteractionend,oninteractionend=_$$props$oninteractio4===void 0?noop$1:_$$props$oninteractio4;var _$$props$oninteractio5=$$props.oninteractioncancel,oninteractioncancel=_$$props$oninteractio5===void 0?noop$1:_$$props$oninteractio5;var _$$props$onaddshape=$$props.onaddshape,onaddshape=_$$props$onaddshape===void 0?noop$1:_$$props$onaddshape;var _$$props$onupdateshap=$$props.onupdateshape,onupdateshape=_$$props$onupdateshap===void 0?noop$1:_$$props$onupdateshap;var _$$props$onselectshap=$$props.onselectshape,onselectshape=_$$props$onselectshap===void 0?noop$1:_$$props$onselectshap;var _$$props$onremoveshap=$$props.onremoveshape,onremoveshape=_$$props$onremoveshap===void 0?noop$1:_$$props$onremoveshap;var _$$props$ontapshape=$$props.ontapshape,ontapshape=_$$props$ontapshape===void 0?noop$1:_$$props$ontapshape;var _$$props$onhovershape=$$props.onhovershape,onhovershape=_$$props$onhovershape===void 0?noop$1:_$$props$onhovershape;var _$$props$onhovercanva=$$props.onhovercanvas,onhovercanvas=_$$props$onhovercanva===void 0?noop$1:_$$props$onhovercanva;var _$$props$ontapcanvas=$$props.ontapcanvas,ontapcanvas=_$$props$ontapcanvas===void 0?noop$1:_$$props$ontapcanvas;var _$$props$beforeSelect=$$props.beforeSelectShape,beforeSelectShape=_$$props$beforeSelect===void 0?function(){return true;}:_$$props$beforeSelect;var _$$props$beforeDesele=$$props.beforeDeselectShape,beforeDeselectShape=_$$props$beforeDesele===void 0?function(){return true;}:_$$props$beforeDesele;var _$$props$beforeRemove=$$props.beforeRemoveShape,beforeRemoveShape=_$$props$beforeRemove===void 0?function(){return true;}:_$$props$beforeRemove;var _$$props$beforeUpdate=$$props.beforeUpdateShape,beforeUpdateShape=_$$props$beforeUpdate===void 0?function(shape,props){return props;}:_$$props$beforeUpdate;var _$$props$willRenderSh=$$props.willRenderShapeControls,willRenderShapeControls=_$$props$willRenderSh===void 0?passthrough:_$$props$willRenderSh;var _$$props$willStartInt=$$props.willStartInteraction,willStartInteraction=_$$props$willStartInt===void 0?function(position,rect){return true;}:_$$props$willStartInt;var mapEditorPointToImagePoint=$$props.mapEditorPointToImagePoint;var mapImagePointToEditorPoint=$$props.mapImagePointToEditorPoint;var _$$props$eraseRadius=$$props.eraseRadius,eraseRadius=_$$props$eraseRadius===void 0?undefined:_$$props$eraseRadius;var _$$props$selectRadius=$$props.selectRadius,selectRadius=_$$props$selectRadius===void 0?undefined:_$$props$selectRadius;var _$$props$enableButton4=$$props.enableButtonFlipVertical,enableButtonFlipVertical=_$$props$enableButton4===void 0?false:_$$props$enableButton4;var _$$props$enableTapToA=$$props.enableTapToAddText,enableTapToAddText=_$$props$enableTapToA===void 0?true:_$$props$enableTapToA;var locale=$$props.locale;var isAnimated=getContext('isAnimated');component_subscribe($$self,isAnimated,function(value){return $$invalidate(144,$isAnimated=value);});//
// Cache
//
var updateShape=function updateShape(shape,props,parentRect){var propsToUpdate=beforeUpdateShape(_objectSpread({},shape),props,_objectSpread({},parentRect));shapeUpdateProps(shape,propsToUpdate,parentRect);};var snapRelativeToAnchor=function snapRelativeToAnchor(anchor,target){var length=vectorDistance(anchor,target);var angle=vectorAngleBetween(anchor,target);var angleSnapInterval=Math.PI/8;var angleSnapped=angleSnapInterval*Math.round(angle/angleSnapInterval)-contextRotation%angleSnapInterval;target.x=anchor.x+length*Math.cos(angleSnapped);target.y=anchor.y+length*Math.sin(angleSnapped);};//#region polygon helpers
var circleOverlapsWithLine=function circleOverlapsWithLine(point,radius,from,to){var ac=vectorCreate(point.x-from.x,point.y-from.y);var ab=vectorCreate(to.x-from.x,to.y-from.y);var ab2=vectorDot(ab,ab);var acab=vectorDot(ac,ab);var t=acab/ab2;t=t<0?0:t;t=t>1?1:t;var h=vectorCreate(ab.x*t+from.x-point.x,ab.y*t+from.y-point.y);var h2=vectorDot(h,h);return h2<=radius*radius;};var circleOverlapsWithPath=function circleOverlapsWithPath(position,radius,points){var l=points.length;for(var i=0;i<l-1;i++){if(circleOverlapsWithLine(position,radius,points[i],points[i+1]))return true;}return false;};var circleOverlapsWithPolygon=function circleOverlapsWithPolygon(position,radius,points){if(pointInPoly$1(position,points))return true;if(circleOverlapsWithPath(position,radius,points))return true;return circleOverlapsWithLine(position,radius,points[0],points[points.length-1]);};var circleOverlapsWithEllipse=function circleOverlapsWithEllipse(position,radius,ellipse,rotation,flipX,flipY){var points=ellipseToPolygon(vectorCreate(ellipse.x,ellipse.y),ellipse.rx,ellipse.ry,rotation,flipX,flipY,12);return circleOverlapsWithPolygon(position,radius,points);};var circleOverlapsWithRect=function circleOverlapsWithRect(position,radius,rect,rotation,pivot){return circleOverlapsWithPolygon(position,radius,rectRotate(rect,rotation,pivot||rectCenter(rect)));};var shapeToPoly=function shapeToPoly(computedShape){var resolution=arguments.length>1&&arguments[1]!==undefined?arguments[1]:12;if(shapeIsRect(computedShape)){return rectRotate(computedShape,computedShape.rotation,rectCenter(computedShape));}else if(shapeIsText(computedShape)){var computedRect=getMarkupShapeRect(computedShape);return rectRotate(computedRect,computedShape.rotation,rectCenter(computedRect));}else if(shapeIsEllipse(computedShape)){return ellipseToPolygon(vectorCreate(computedShape.x,computedShape.y),computedShape.rx,computedShape.ry,computedShape.rotation,computedShape.flipX,computedShape.flipY,resolution);}return[];};//#endregion
//#region createShape eraseShape
var keysPressedStored=getContext('keysPressed');component_subscribe($$self,keysPressedStored,function(value){return $$invalidate(166,$keysPressedStored=value);});// draw shape manipulator edges
var getShapeUpdateRotation=function getShapeUpdateRotation(rotation,flipX,flipY){if(rotation===0)return rotation;if(flipX&&flipY)return rotation;if(flipX)return-rotation;if(flipY)return-rotation;return rotation;};var createShape=function createShape(shapeDefault){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};// state
var interactionOrigin;var interactionRadius;var interactionPosition;var isEllipse=shapeIsEllipse(shapeDefault);var isText=shapeIsText(shapeDefault);var isRelative=options.position==='relative';var isSteppedInputMode=options.inputMode==='step';if(shapeIsPath(shapeDefault)){// stepped input mode
if(isSteppedInputMode){var isFirstPoint=false;var getPoint=function getPoint(previousPoint,pointerPosition){// has started drawing? only handle end
var draft=getMarkupItemDraft();// if has previous point
var previousPointComputed=previousPoint&&vectorCreate(fromPercentage(previousPoint.x,parentRect.width),fromPercentage(previousPoint.y,parentRect.height));// point in editor view
var previousPointInEditor=previousPointComputed&&mapImagePointToEditorPoint(previousPointComputed);// if shift is held snap to last point
if($keysPressedStored.includes(16)&&previousPointInEditor)snapRelativeToAnchor(previousPointInEditor,pointerPosition);var currentPoint=mapEditorPointToImagePoint(pointerPosition);// get first point as absolute
var originPoint=draft.points.length?draft.points[0]:currentPoint;var originPointComputed=vectorCreate(fromPercentage(originPoint.x,parentRect.width),fromPercentage(originPoint.y,parentRect.height));// point in editor view
var originPointInEditor=mapImagePointToEditorPoint(originPointComputed);// distance between origin and new point
var distFromOriginSquared=vectorDistanceSquared(originPointInEditor,pointerPosition);// clicked second point at same location, discard draft
if(!isFirstPoint&&draft.points.length===1&&distFromOriginSquared<36){return discardMarkupItemDraft();}// minimum of three points to create a polygon
if(draft.points.length>2&&distFromOriginSquared<=POLYGON_END_PATH_DISTANCE_SQUARED){draft.pathClose=true;// select the draft
selectShape(draft);var shape=confirmMarkupItemDraft();onaddshape(shape);return;}// clicked at same location as previous point, confirm as line
var hasVisibleStroke=draft.strokeWidth&&draft.strokeColor&&(draft.strokeColor[3]===undefined||draft.strokeColor[3]>0);var distFromPreviousSquared=vectorDistanceSquared(previousPointInEditor,pointerPosition);if(hasVisibleStroke&&draft.points.length>1&&distFromPreviousSquared<POLYGON_END_PATH_DISTANCE_SQUARED){// open path
draft.pathClose=false;draft.backgroundColor=[0,0,0,0];// select the draft
selectShape(draft);var _shape=confirmMarkupItemDraft();onaddshape(_shape);return;}// distance between previous and new point needs to be sufficient
if(draft.points.length>0){if(distFromPreviousSquared<POLYGON_VERTEX_MIN_DISTANCE_SQUARED)return;}// return new point!
return isRelative?toPercentagePoint(currentPoint,parentRect):currentPoint;};return{start:function start(e){var origin=e.detail.origin;interactionRadius=4;interactionOrigin=vectorClone(origin);interactionPosition=vectorClone(origin);// has started drawing? only handle end
var draft=getMarkupItemDraft();if(draft){// add next point
var previousPoint=draft.points[draft.points.length-1];var computedPoint=getPoint(previousPoint,interactionOrigin);if(computedPoint)draft.points=[].concat(_toConsumableArray(draft.points),[computedPoint]);return syncShapes();}// first point
isFirstPoint=true;},update:function update(e){// this only runs for first point so we can drag to start AND tap to start a path
if(!isFirstPoint)return;// get draft ref
var draft=getMarkupItemDraft();if(!draft)return;// get next point
var previousPoint=draft.points[0];var computedPoint=getPoint(previousPoint,vectorCreate(interactionOrigin.x+e.detail.translation.x,interactionOrigin.y+e.detail.translation.y));if(!computedPoint)return;// first point is pointerdown, keep overwriting next point
draft.points[1]=computedPoint;// update view
syncShapes();},release:function release(e){return e.detail.preventInertia();},cancel:function cancel(e){return discardMarkupItemDraft();},end:function end(e){if(!isFirstPoint)return;// hasn't started drawing yet, let's add origin
var originPoint=mapEditorPointToImagePoint(interactionOrigin);var computedPoint=isRelative?toPercentagePoint(originPoint,parentRect):originPoint;// if is tap
var isTap=e.detail.isTap;if(isTap){// if any shape below pointer select the shape and discard the path
var foundShapes=getShapesNearPosition(originPoint,0,shapeCanSelect);if(foundShapes.length)return discardMarkupItemDraft();}// add to markup so it's drawn
addMarkupItemDraft(_objectSpread(_objectSpread({},shapeDefault),{},{points:[computedPoint]}));}};}// drag input mode
return{start:function start(e){var origin=e.detail.origin;interactionRadius=4;interactionOrigin=vectorClone(origin);interactionPosition=vectorClone(origin);var originPoint=mapEditorPointToImagePoint(origin);var computedPoint=isRelative?toPercentagePoint(originPoint,parentRect):originPoint;// add to markup so it's drawn
addMarkupItemDraft(_objectSpread(_objectSpread({},shapeDefault),{},{points:[computedPoint]}));},update:function update(e){var draft=getMarkupItemDraft();var translation=e.detail.translation;// position
var pointerPosition=vectorCreate(interactionOrigin.x+translation.x,interactionOrigin.y+translation.y);// distance between interaction and pointer if it's too close, we don't draw this point
var dist=vectorDistance(interactionPosition,pointerPosition);if(fixPrecision(dist,5)<=interactionRadius)return;// get angle between interaction and pointer
var angle=vectorAngleBetween(pointerPosition,interactionPosition);// move brush towards pointer at angle
var moveDist=interactionRadius-dist;interactionPosition.x+=moveDist*Math.cos(angle);interactionPosition.y+=moveDist*Math.sin(angle);// create point
var point=mapEditorPointToImagePoint(interactionPosition);var computedPoint=isRelative?toPercentagePoint(point,parentRect):point;draft.points=draft.points.concat(computedPoint);syncShapes();},release:function release(e){return e.detail.preventInertia();},cancel:function cancel(){discardMarkupItemDraft();},end:function end(e){if(e.detail.isTap)return discardMarkupItemDraft();var shape=confirmMarkupItemDraft();onaddshape(shape);}};}else if(isEllipse||isText||shapeIsRect(shapeDefault)){return{start:function start(e){var origin=e.detail.origin;// need to remember origin so we can correctly apply interaction translation
interactionOrigin=vectorClone(origin);var mappedOriginPosition=mapEditorPointToImagePoint(interactionOrigin);var computedOriginPosition=isRelative?toPercentagePoint(mappedOriginPosition,parentRect):mappedOriginPosition;var rotation=-1*getShapeUpdateRotation(contextRotation,contextFlipX,contextFlipY);// add to markup so it's drawn
var draft=_objectSpread(_objectSpread({},shapeDefault),{},{rotation:rotation},computedOriginPosition);// de-flip shape
draft.flipX=contextFlipX;draft.flipY=contextFlipY;// remove position
delete draft.position;// hide initially
draft.opacity=0;// set base position props
var initProps=isEllipse?['rx','ry']:['width','height'];initProps.forEach(function(prop){// skip existing props
// if (hasProp(draft, prop)) return;
// set base props
draft[prop]=isRelative?'0%':0;});addMarkupItemDraft(draft);},update:function update(e){var draft=getMarkupItemDraft();draft.opacity=1;var aspectRatio=draft.aspectRatio;var translation=e.detail.translation;// limit to aspect ratio
if(aspectRatio){var _t5=Math.abs(translation.x)*aspectRatio;translation.x=translation.x;translation.y=_t5*Math.sign(translation.y);}// position
var pointerPosition=vectorCreate(interactionOrigin.x+translation.x,interactionOrigin.y+translation.y);var mappedOriginPosition=mapEditorPointToImagePoint(interactionOrigin);var mappedPointerPosition=mapEditorPointToImagePoint(pointerPosition);var pivot={x:mappedOriginPosition.x+(mappedPointerPosition.x-mappedOriginPosition.x)*0.5,y:mappedOriginPosition.y+(mappedPointerPosition.y-mappedOriginPosition.y)*0.5};var rotation=getShapeUpdateRotation(contextRotation,contextFlipX,contextFlipY);vectorRotate(mappedOriginPosition,rotation,pivot);vectorRotate(mappedPointerPosition,rotation,pivot);var l=Math.min(mappedOriginPosition.x,mappedPointerPosition.x);var t=Math.min(mappedOriginPosition.y,mappedPointerPosition.y);var r=Math.max(mappedOriginPosition.x,mappedPointerPosition.x);var b=Math.max(mappedOriginPosition.y,mappedPointerPosition.y);var width=r-l;var height=b-t;var props={};if(isEllipse){props.x=l+width*0.5;props.y=t+height*0.5;props.rx=width*0.5;props.ry=height*0.5;}else{props.x=l;props.y=t;props.width=width;props.height=height;}updateShape(draft,props,parentRect);syncShapes();},release:function release(e){e.detail.preventInertia();},cancel:function cancel(e){discardMarkupItemDraft();},end:function end(e){var draft=getMarkupItemDraft();if(e.detail.isTap){// will cancel if is not text shape
if(!shapeIsText(draft)||!enableTapToAddText||interactionTarget)return discardMarkupItemDraft();// will add 'auto' text shape if not targetting other shape
delete draft.width;delete draft.height;if(draft.disableNewline!==false)delete draft.textAlign;// position the shape correctly
var draftComputedShape=shapeComputeDisplay(_objectSpread({},draft),parentRect);var size=textToSize(draft.text,draftComputedShape);var mappedOriginPosition=mapEditorPointToImagePoint({x:interactionOrigin.x,y:interactionOrigin.y-size.height*0.5});var mappedPointerPosition=mapEditorPointToImagePoint({x:interactionOrigin.x+size.width,y:interactionOrigin.y+size.height*0.5});var pivot={x:mappedOriginPosition.x+(mappedPointerPosition.x-mappedOriginPosition.x)*0.5,y:mappedOriginPosition.y+(mappedPointerPosition.y-mappedOriginPosition.y)*0.5};var rotation=getShapeUpdateRotation(contextRotation,contextFlipX,contextFlipY);vectorRotate(mappedOriginPosition,rotation,pivot);vectorRotate(mappedPointerPosition,rotation,pivot);var l=Math.min(mappedOriginPosition.x,mappedPointerPosition.x);var _t6=Math.min(mappedOriginPosition.y,mappedPointerPosition.y);draft.x=isString(draft.x)?toPercentage(l,parentRect.width):l;draft.y=isString(draft.y)?toPercentage(_t6,parentRect.height):_t6;}// reveal
draft.opacity=1;// finish markup
if(!shapeIsText(draft)){var shape=confirmMarkupItemDraft();onaddshape(shape);}// select the draft
selectShape(draft);// also enable editing the text
if(shapeIsText(draft))editMarkupItem(draft);}};}else if(shapeIsLine(shapeDefault)){return{start:function start(e){var origin=e.detail.origin;var originMapped=mapEditorPointToImagePoint(origin);var originSnapped=vectorApply(originMapped,snapToPixel);interactionOrigin=vectorClone(origin);// add to markup so it's drawn
addMarkupItemDraft(_objectSpread(_objectSpread({},shapeDefault),{},{x1:isRelative?toPercentage(originSnapped.x,parentRect.width):originSnapped.x,y1:isRelative?toPercentage(originSnapped.y,parentRect.height):originSnapped.y,x2:isRelative?toPercentage(originSnapped.x,parentRect.width):originSnapped.x,y2:isRelative?toPercentage(originSnapped.y,parentRect.height):originSnapped.y,opacity:0}));},update:function update(e){var draft=getMarkupItemDraft();var translation=e.detail.translation;var interactionTarget=vectorAdd(vectorClone(interactionOrigin),translation);// shift pressed
if($keysPressedStored.includes(16)){var length=vectorDistance(interactionOrigin,interactionTarget);var angle=vectorAngleBetween(interactionOrigin,interactionTarget);var angleSnapInterval=Math.PI/4;var angleSnapped=angleSnapInterval*Math.round(angle/angleSnapInterval);interactionTarget.x=interactionOrigin.x+length*Math.cos(angleSnapped);interactionTarget.y=interactionOrigin.y+length*Math.sin(angleSnapped);}// update line end position
var point=mapEditorPointToImagePoint(interactionTarget);updateMarkupShape(draft,{x2:isRelative?toPercentage(point.x,parentRect.width):point.x,y2:isRelative?toPercentage(point.y,parentRect.height):point.y,opacity:1});syncShapes();},release:function release(e){return e.detail.preventInertia();},cancel:function cancel(e){discardMarkupItemDraft();},end:function end(e){var draft=getMarkupItemDraft();if(e.detail.isTap)return discardMarkupItemDraft();draft.opacity=1;// finish markup
var shape=confirmMarkupItemDraft();onaddshape(shape);// select the draft
selectShape(shape);}};}};var eraseShape=function eraseShape(){var origin;var positionPrevious;var eraseRadiusSquared=eraseRadius*eraseRadius;var erase=function erase(positionA,positionB){var forceErase=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var d2=vectorDistanceSquared(positionA,positionB);// skip, too close to previous point
if(!forceErase&&d2<2)return false;var shapesThatCanBeErased=markup.filter(function(shape){return!shape.disableErase;});// if line is shorter than radius do simple erase operation, find all points within range from current position
var shapesFound;if(d2<eraseRadiusSquared){shapesFound=getShapesNearPosition(mapEditorPointToImagePoint(positionB),eraseRadius);}else{shapesFound=getShapesBetweenPoints(shapesThatCanBeErased,mapEditorPointToImagePoint(positionA),mapEditorPointToImagePoint(positionB),eraseRadius);}var shapesRemoved=removeMarkupItems(shapesFound);shapesRemoved.forEach(onremoveshape);return true;};return{start:function start(e){origin=vectorCreate(Math.round(e.detail.origin.x),Math.round(e.detail.origin.y));erase(origin,origin,true);positionPrevious=origin;},update:function update(e){var translation=e.detail.translation;var positionCurrent=vectorCreate(Math.round(origin.x+translation.x),Math.round(origin.y+translation.y));if(erase(positionPrevious,positionCurrent)){positionPrevious=vectorClone(positionCurrent);}},release:function release(e){return e.detail.preventInertia();},end:function end(){}};};//#endregion
//
// Mapping coordinates
//
var getImagePointWithScreenTranslation=function getImagePointWithScreenTranslation(point,translation){var pointInScreenSpace=mapImagePointToEditorPoint(point);return mapEditorPointToImagePoint(vectorAdd(pointInScreenSpace,translation));};//
// Interaction
//
//#region translateShape rotateShape resizeShape
var translateShape=function translateShape(shapeCurrent,shapeOriginComputed,translation){if(shapeIsLine(shapeCurrent)){var beginImageOffset=getImagePointWithScreenTranslation(shapeLineGetStartPoint(shapeOriginComputed),translation);var endImageOffset=getImagePointWithScreenTranslation(shapeLineGetEndPoint(shapeOriginComputed),translation);updateShape(shapeCurrent,{x1:beginImageOffset.x,y1:beginImageOffset.y,x2:endImageOffset.x,y2:endImageOffset.y},parentRect);}else if(shapeCurrent.points){updateShape(shapeCurrent,{points:shapeOriginComputed.points.map(function(point){return getImagePointWithScreenTranslation(point,translation);})},parentRect);}else if(shapeIsRect(shapeCurrent)||shapeIsText(shapeCurrent)||shapeIsEllipse(shapeCurrent)){var imagePoint=getImagePointWithScreenTranslation(shapeOriginComputed,translation);updateShape(shapeCurrent,imagePoint,parentRect);}syncShapes();};var IndexFlipXMap={0:1,1:0,2:3,3:2};var IndexFlipYMap={0:3,1:2,2:1,3:0};var resizeShape=function resizeShape(shapeCurrent,shapeOriginComputed,indexes,translation,options){// is a line of points
if(shapeIsLine(shapeCurrent)||shapeIsPath(shapeCurrent)&&hasProp(shapeCurrent,'pathClose')){var _indexes=indexes,_indexes2=_slicedToArray(_indexes,1),targetIndex=_indexes2[0];var snap=$keysPressedStored.includes(16)?snapRelativeToAnchor:function(_,target){return target;};var getPoint;var snapPoint;var setPoint;if(shapeIsLine(shapeCurrent)){// start
if(targetIndex===0){getPoint=function getPoint(){return shapeLineGetStartPoint(shapeOriginComputed);};// snap angle relative to opposite point
snapPoint=function snapPoint(point){return snap(shapeLineGetEndPoint(shapeOriginComputed),point);};setPoint=function setPoint(shape,point){shape.x1=point.x;shape.y1=point.y;};}else// end
if(targetIndex===1){getPoint=function getPoint(){return shapeLineGetEndPoint(shapeOriginComputed);};// snap angle relative to opposite point
snapPoint=function snapPoint(point){return snap(shapeLineGetStartPoint(shapeOriginComputed),point);};setPoint=function setPoint(shape,point){shape.x2=point.x;shape.y2=point.y;};}}else{var computedPoints=shapeOriginComputed.points;getPoint=function getPoint(){return computedPoints[targetIndex];};snapPoint=function snapPoint(point){var pointBefore=computedPoints[arrayIndexWrap(targetIndex-1,computedPoints)];var pointAfter=computedPoints[arrayIndexWrap(targetIndex+1,computedPoints)];snap(pointBefore,point);snap(pointAfter,point);};setPoint=function setPoint(shape,point){return shape.points[targetIndex]=point;};}var point=getImagePointWithScreenTranslation(getPoint(),translation);snapPoint(point);setPoint(shapeCurrent,point);}else// is a box
if(shapeHasSize(shapeCurrent)||shapeIsEllipse(shapeCurrent)||shapeIsTextBox(shapeCurrent)){var hasAutoHeight=false;var shapeOriginRect;if(shapeIsEllipse(shapeCurrent)){shapeOriginRect=rectCreateFromEllipse(shapeOriginComputed);}else if(shapeHasSize(shapeCurrent)){shapeOriginRect=rectCreateFromAny(shapeOriginComputed);}else{// is text with 'width' only
hasAutoHeight=true;shapeOriginRect=rectCreateFromAny(shapeOriginComputed);var size=textToSize(shapeOriginComputed.text,shapeOriginComputed);shapeOriginRect.height=size.height;}var shapeAspectRatio;if(shapeCurrent.aspectRatio){shapeAspectRatio=shapeCurrent.aspectRatio;}else if(options.shiftKey&&!hasAutoHeight){shapeAspectRatio=shapeOriginRect.width/shapeOriginRect.height;}// current shape
var rectAligned=rectCreateFromAny(shapeOriginRect);var rectAlignedCenterPosition=rectCenter(rectAligned);var rectRotation=shapeCurrent.rotation;var rectAlignedCorners=rectGetCorners(rectAligned);var rectCorners=rectRotate(rectAligned,rectRotation);// is translating one corner
if(indexes.length===1){// corner
var cornerIndex=indexes[0];if(shapeCurrent.flipX)cornerIndex=IndexFlipXMap[cornerIndex];if(shapeCurrent.flipY)cornerIndex=IndexFlipYMap[cornerIndex];var _rectAlignedCorners=_slicedToArray(rectAlignedCorners,4),tl=_rectAlignedCorners[0],tr=_rectAlignedCorners[1],br=_rectAlignedCorners[2],bl=_rectAlignedCorners[3];var screenTargetPosition=mapImagePointToEditorPoint(rectCorners[cornerIndex]);vectorAdd(screenTargetPosition,translation);var imageTargetPosition=mapEditorPointToImagePoint(screenTargetPosition);var imageTargetTranslation=vectorCreate(imageTargetPosition.x-rectCorners[cornerIndex].x,imageTargetPosition.y-rectCorners[cornerIndex].y);// if (shapeCurrent.flipX) imageTargetTranslation.x = -imageTargetTranslation.x;
// if (shapeCurrent.flipY) imageTargetTranslation.y = -imageTargetTranslation.y;
var imageTargetTranslationAligned=vectorRotate(vectorClone(imageTargetTranslation),-rectRotation);var imageTargetPositionAligned=vectorCreate(rectAlignedCorners[cornerIndex].x+imageTargetTranslationAligned.x,rectAlignedCorners[cornerIndex].y+imageTargetTranslationAligned.y);var anchor;if(cornerIndex===0)anchor=br;if(cornerIndex===1)anchor=bl;if(cornerIndex===2)anchor=tl;if(cornerIndex===3)anchor=tr;// create an aligned and updated rectangle
var rectAlignedResized=rectCreateFromPoints([anchor,imageTargetPositionAligned]);// limit rect
if(shapeAspectRatio){// get size that adheres to aspect ratio but still fits current rectangle
var _rectContainRect=rectContainRect(rectAlignedResized,shapeAspectRatio),_width7=_rectContainRect.width,_height7=_rectContainRect.height;var _rectToBounds11=rectToBounds(rectAlignedResized),_rectToBounds12=_slicedToArray(_rectToBounds11,4),_t7=_rectToBounds12[0],_r11=_rectToBounds12[1],b=_rectToBounds12[2],l=_rectToBounds12[3];// update size
rectAlignedResized.width=_width7;rectAlignedResized.height=_height7;// align to anchor
if(imageTargetPositionAligned.y<anchor.y){rectAlignedResized.y=b-_height7;}if(imageTargetPositionAligned.x<anchor.x){rectAlignedResized.x=_r11-_width7;}}// rotate the aligned rectangle around it's original pivot point
var rr=rectRotate(rectAlignedResized,rectRotation,rectAlignedCenterPosition);// now calculate the new center and then rotate the tl and br corners around that center to find their new positions
var rrc=vectorCenter(rr);var p1=vectorRotate(rr[0],-rectRotation,rrc);var p2=vectorRotate(rr[2],-rectRotation,rrc);// if (shapeCurrent.flipX || shapeCurrent.flipY) {
//     vectorsFlip([p1, p2], shapeCurrent.flipX, shapeCurrent.flipY, rectAlignedCenterPosition.x, rectAlignedCenterPosition.y)
// }
var rectUpdated=rectCreateFromPoints([p1,p2]);updateShape(shapeCurrent,shapeIsEllipse(shapeCurrent)?ellipseCreateFromRect(rectUpdated):rectUpdated,parentRect);}else// is translating two corner points
{// 0-1 -> 2-3
// 1-2 -> 3-0
// 2-3 -> 0-1
// 3-0 -> 1-2
indexes=indexes.map(function(index){if(shapeCurrent.flipX)index=IndexFlipXMap[index];if(shapeCurrent.flipY)index=IndexFlipYMap[index];return index;});var _indexes$map=indexes.map(function(index){return rectCorners[index];}),_indexes$map2=_slicedToArray(_indexes$map,2),cornerA=_indexes$map2[0],cornerB=_indexes$map2[1];var mid={x:cornerA.x+(cornerB.x-cornerA.x)*0.5,y:cornerA.y+(cornerB.y-cornerA.y)*0.5};var _indexes$map3=indexes.map(function(index){return rectAlignedCorners[index];}),_indexes$map4=_slicedToArray(_indexes$map3,2),cornerAlignedA=_indexes$map4[0],cornerAlignedB=_indexes$map4[1];var _indexes$map5=indexes.map(function(index){var mappedIndex=index+2;if(mappedIndex<4)return rectAlignedCorners[mappedIndex];return rectAlignedCorners[mappedIndex-4];}),_indexes$map6=_slicedToArray(_indexes$map5,2),cornerAlignedC=_indexes$map6[0],cornerAlignedD=_indexes$map6[1];// const midAligned = {
//     x: cornerAlignedA.x + (cornerAlignedB.x - cornerAlignedA.x) * .5,
//     y: cornerAlignedA.y + (cornerAlignedB.y - cornerAlignedA.y) * .5
// };
var midAnchorAligned={x:cornerAlignedC.x+(cornerAlignedD.x-cornerAlignedC.x)*0.5,y:cornerAlignedC.y+(cornerAlignedD.y-cornerAlignedC.y)*0.5};var _screenTargetPosition=mapImagePointToEditorPoint(mid);vectorAdd(_screenTargetPosition,translation);var _imageTargetPosition=mapEditorPointToImagePoint(_screenTargetPosition);var _imageTargetTranslation=vectorCreate(_imageTargetPosition.x-mid.x,_imageTargetPosition.y-mid.y);// if (shapeCurrent.flipX) imageTargetTranslation.x = -imageTargetTranslation.x;
// if (shapeCurrent.flipY) imageTargetTranslation.y = -imageTargetTranslation.y;
var _imageTargetTranslationAligned=vectorRotate(vectorClone(_imageTargetTranslation),-rectRotation);// const imageTargetPositionAligned = vectorCreate(
//     midAligned.x + imageTargetTranslationAligned.x,
//     midAligned.y + imageTargetTranslationAligned.y,
// );
var d=vectorSubtract(vectorClone(cornerAlignedA),cornerAlignedB);var f=vectorApply(d,function(v){return 1-Math.abs(Math.sign(v));});var _t8=vectorCreate(_imageTargetTranslationAligned.x*f.x,_imageTargetTranslationAligned.y*f.y);vectorAdd(cornerAlignedA,_t8);vectorAdd(cornerAlignedB,_t8);var _rectAlignedResized=rectCreateFromPoints(rectAlignedCorners);// limit rect
if(shapeAspectRatio){var _width8=_rectAlignedResized.width;var _height8=_rectAlignedResized.height;if(f.y===0){_height8=_width8/shapeAspectRatio;}else{_width8=_height8*shapeAspectRatio;}// update size
_rectAlignedResized.width=_width8;_rectAlignedResized.height=_height8;// align to anchor
if(f.y===0){_rectAlignedResized.y=midAnchorAligned.y-_height8*0.5;}else{_rectAlignedResized.x=midAnchorAligned.x-_width8*0.5;}}// rotate the aligned rectangle around it's original pivot point
var _rr=rectRotate(_rectAlignedResized,rectRotation,rectAlignedCenterPosition);// now calculate the new center and then rotate the tl and br corners around that center to find their new positions
var _rrc=vectorCenter(_rr);var _p2=vectorRotate(_rr[0],-rectRotation,_rrc);var _p3=vectorRotate(_rr[2],-rectRotation,_rrc);// if (shapeCurrent.flipX || shapeCurrent.flipY) {
//     vectorsFlip([p1, p2], shapeCurrent.flipX, shapeCurrent.flipY, rectAlignedCenterPosition.x, rectAlignedCenterPosition.y)
// }
var _rectUpdated=rectCreateFromPoints([_p2,_p3]);var _props;if(shapeIsEllipse(shapeCurrent)){_props=ellipseCreateFromRect(_rectUpdated);}else if(shapeHasSize(shapeCurrent)){_props=_rectUpdated;}else if(hasAutoHeight){_props={x:_rectUpdated.x,y:_rectUpdated.y,width:_rectUpdated.width};}updateShape(shapeCurrent,_props,parentRect);}}// redraw
syncShapes();};var rotatorInitialPosition;var rotateShape=function rotateShape(shapeCurrent,shapeOriginComputed,translation,options){// calculate angle between translated rotation control and origin
var shapeRect=getMarkupShapeRect(shapeComputeDisplay(shapeDeepCopy(shapeCurrent),parentRect));var shapeCenter=rectCenter(shapeRect);var p=getImagePointWithScreenTranslation(rotatorInitialPosition,translation);var shapeRotation=vectorAngleBetween(p,shapeCenter)+Math.PI/2;if(options.shiftKey){var rotatorSnapInterval=Math.PI/16;shapeRotation=rotatorSnapInterval*Math.round(shapeRotation/rotatorSnapInterval)-contextRotation%rotatorSnapInterval;}updateShape(shapeCurrent,{rotation:shapeRotation},parentRect);syncShapes();};var getMarkupItemDraft=function getMarkupItemDraft(){if(!markup.length)return;return markup.find(shapeIsDraft);};var getMarkupItemDraftIndex=function getMarkupItemDraftIndex(){if(!markup.length)return;return markup.findIndex(shapeIsDraft);};var addMarkupItemDraft=function addMarkupItemDraft(shape){var sync=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(getMarkupItemDraft())return;shapeMakeDraft(shape);return addShape(shape,sync);};var confirmMarkupItemDraft=function confirmMarkupItemDraft(){var markupItem=getMarkupItemDraft();if(!markupItem)return;shapeMakeFinal(markupItem);syncShapes();return markupItem;};var discardMarkupItemDraft=function discardMarkupItemDraft(){if(!getMarkupItemDraft())return;markup.splice(getMarkupItemDraftIndex(),1);syncShapes();};var createMarkupItem=function createMarkupItem(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return _objectSpread({id:getUniqueId()},props);};var syncShapes=function syncShapes(){return $$invalidate(0,markup);};var addShape=function addShape(shape){var sync=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;markup.push(shape);// sync markup array
if(sync)syncShapes();return shape;};var removeMarkupShapeProps=function removeMarkupShapeProps(shape){var props=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var sync=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;props.filter(Boolean).forEach(function(prop){return delete shape[prop];});// sync markup array
if(!sync)return;syncShapes();};var updateMarkupShape=function updateMarkupShape(shape,props){var sync=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;// update markup
shape=Object.assign(shape,props);// sync markup array
if(!sync)return;syncShapes();};var updateMarkupShapeProperty=function updateMarkupShapeProperty(shape,name,value){var sync=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;shape[name]=value;// sync markup array
if(!sync)return;syncShapes();};var updateMarkupItemsShapeProperty=function updateMarkupItemsShapeProperty(name,value){var sync=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;markup.forEach(function(shape){return updateMarkupShapeProperty(shape,name,value,false);});// sync markup array
if(!sync)return;syncShapes();};var updateMarkupShapeItems=function updateMarkupShapeItems(props){var sync=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;markup.forEach(function(markupItem){return updateMarkupShape(markupItem,props,false);});// sync markup array
if(!sync)return;syncShapes();};var getActiveMarkupItem=function getActiveMarkupItem(){return _toConsumableArray(markup).reverse().find(shapeIsSelected);};var hasActiveMarkupItem=function hasActiveMarkupItem(){return!!getActiveMarkupItem();};var removeShape=function removeShape(shapeToRemove){if(!beforeRemoveShape(shapeToRemove))return false;$$invalidate(0,markup=markup.filter(function(shape){return shape!==shapeToRemove;}));onremoveshape(shapeToRemove);};var removeActiveMarkupItem=function removeActiveMarkupItem(){var activeShape=getActiveMarkupItem();if(!activeShape)return;// get removable markup items,
var removableShapes=markup.filter(function(shape){return shapeCanRemove(shape)&&shapeCanSelect(shape);});// find index of active shape so we can select the next active shape on removal
var index=removableShapes.findIndex(function(shape){return shape===activeShape;});// remove the active ship from the shape array
var didRemove=removeShape(activeShape);if(didRemove===false)return;// remember selection
previousSelectedShape=activeShape;// if no more markup items, release active shape
if(removableShapes.length-1<=0)return blurShapes();// select next active markup item
var indexNext=index-1<0?removableShapes.length-1:index-1;selectShape(removableShapes[indexNext]);};var previousSelectedShape=undefined;var blurShapes=function blurShapes(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _options$storePreviou=options.storePrevious,storePrevious=_options$storePreviou===void 0?true:_options$storePreviou;// clear text state cache, when a text shape is blurred the changes are confirmed
Object.keys(ShapeTextStateCache).forEach(function(key){return ShapeTextStateCache[key]={};});// remember shape
if(storePrevious)previousSelectedShape=getSelectedShape();updateMarkupShapeItems({isSelected:false,isEditing:false,_prerender:false});};var getSelectedShape=function getSelectedShape(){return markup.find(shapeIsSelected);};var selectShape=function selectShape(shape){var sync=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;// can't select draft
if(shapeIsDraft(shape))return;// get currently selected shape
var selectedShapeCurrent=getSelectedShape();var selectedShape=selectedShapeCurrent||previousSelectedShape;// was already selected
var wasSelectedShape=shapeIsSelected(shape);// reset previous selected shape
previousSelectedShape=undefined;// if is returned false will cancel select operation
if(!beforeSelectShape(selectedShape,shape))return;// remove selected state from other markup
blurShapes();// select
shapeSelect(shape);// selected this shape
!wasSelectedShape&&onselectshape(shape);// sync
if(!sync)return;syncShapes();};var deselectMarkupItem=function deselectMarkupItem(markupItem){// we're blurring an active text field, should confirm state if inline text editing
if(textInput&&textInput.confirm&&markupItem.isEditing)textInput.confirm();updateMarkupShape(markupItem,{isSelected:false,isEditing:false,_prerender:false});};var editMarkupItem=function editMarkupItem(markupItem){updateMarkupShape(markupItem,{isSelected:true,isEditing:true,_prerender:textInputMode==='inline'});};var finishEditMarkupItem=function finishEditMarkupItem(markupItem){updateMarkupShape(markupItem,{isSelected:true,isEditing:false,_prerender:false});};var removeMarkupItems=function removeMarkupItems(shapesToRemove){if(!shapesToRemove.length)return[];var shapesToRemoveFiltered=shapesToRemove.filter(beforeRemoveShape);$$invalidate(0,markup=markup.filter(function(shape){return!shapesToRemoveFiltered.includes(shape);}));return shapesToRemoveFiltered;};var getTextShapeRect=function getTextShapeRect(shape){var size=textToSize(shape.text,shape);return rectCreate(shape.x,shape.y,shape.width?Math.min(shape.width,size.width):size.width,shape.height?Math.min(shape.height,size.height):size.height);};var getMarkupShapeRect=function getMarkupShapeRect(shape){// has own rect
if(shapeHasSize(shape))return rectCreateFromAny(shape);if(shapeIsEllipse(shape))return rectCreateFromEllipse(shape);// calculate the size on canvas
var rect=getTextShapeRect(shape);rect.width=Math.max(MIN_TEXT_MARKUP_WIDTH,shape.width||rect.width);return rect;};var getShapesNearPosition=function getShapesNearPosition(position){var range=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var shapeFilter=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(){return true;};return _toConsumableArray(markup).// reverse the array, want to select from top to bottom
reverse().// filter out shapes we're not interested in
filter(shapeFilter).// need priority indicator
map(function(shape){return{shape:shape,priority:1};}).// find markup near pointer
filter(function(result){// get shape
var shape=result.shape;// we need to know where the shape will end up
var computedShape=shapeComputeDisplay(shapeDeepCopy(shape),parentRect);// add stroke width to range
var r=range+(computedShape.strokeWidth||0);// test if clicked in rect
if(shapeIsRect(computedShape)){return circleOverlapsWithRect(position,r,computedShape,shape.rotation);}// test if clicked on text
if(shapeIsText(computedShape)){var shapeRect=getMarkupShapeRect(computedShape);var isPositionInBounds=circleOverlapsWithRect(position,r,shapeRect,shape.rotation);var isPositionInVisual=false;if(isPositionInBounds&&!shapeIsSelected(shape)){var visualRect=getTextShapeRect(computedShape);if(shape.textAlign==='right'&&!shape.flipX){visualRect.x=shapeRect.x+shapeRect.width-visualRect.width;}if(shape.textAlign==='center'){visualRect.x=shapeRect.x+shapeRect.width*0.5-visualRect.width*0.5;}isPositionInVisual=circleOverlapsWithRect(position,r,visualRect,shape.rotation,rectCenter(shapeRect));if(!isPositionInVisual)result.priority=-1;}return isPositionInBounds;}// test if click on ellipse
if(shapeIsEllipse(computedShape)){return circleOverlapsWithEllipse(position,r,computedShape,shape.rotation,shape.flipX,shape.flipY);}// test if clicked on line
if(shapeIsLine(computedShape)){// radius around click position, test if line intersects
return circleOverlapsWithLine(position,Math.max(16,r),shapeLineGetStartPoint(computedShape),shapeLineGetEndPoint(computedShape));// always increase range when selecting lines
}// test if clicked inside polygon
if(shapeIsPath(computedShape)&&computedShape.pathClose){return circleOverlapsWithPolygon(position,r,computedShape.points);}// test if clicked on path
if(shapeIsPath(computedShape)){// radius around click position, test if line intersects
return circleOverlapsWithPath(position,Math.max(16,r),computedShape.points);// always increase range when selecting lines
}return false;}).sort(function(a,b){if(a.priority<b.priority)return 1;if(a.priority>b.priority)return-1;return 0;}).map(function(item){return item.shape;});};var getShapesBetweenPoints=function getShapesBetweenPoints(shapes,a,b){var range=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;// make sure range is not negative
var r=Math.abs(range);// create line
var line=lineCreate(a,b);// eraseLine should be in image space
var eraseLine=lineExtend(line,r);// create line polygon
var erasePoly=lineExtrude(eraseLine,r);// loop over shapes and find intersecting shapes
var res=shapes.filter(function(shape){var computedShape=shapeComputeDisplay(shapeDeepCopy(shape),parentRect);// if shape is line or path
if(shapeIsLine(computedShape)||shapeIsPath(computedShape)){var points=computedShape.points?_toConsumableArray(computedShape.points):[shapeLineGetStartPoint(computedShape),shapeLineGetEndPoint(computedShape)];return!!linePointsIntersection(eraseLine,points);}// else turn into polygon and compare polygons
return polyIntersectsWithPoly(erasePoly,shapeToPoly(computedShape));});return res;};//#region shape base interaction
var interactionPoint=undefined;var interactionTimer=undefined;var interactionTarget=undefined;var interactionShape=undefined;var interactionShapeOrigin=undefined;var interactionShapeOriginComputed=undefined;var interactionShapeWasSelected=false;var isInteracting=false;var handleInteractionStart=function handleInteractionStart(e){var origin=e.detail.origin;interactionShape=undefined;interactionShapeOrigin=undefined;interactionShapeOriginComputed=undefined;interactionShapeWasSelected=false;interactionTarget=undefined;clearTimeout(interactionTimer);interactionTimer=setTimeout(function(){return $$invalidate(118,isInteracting=true);},250);// if is editing text
var draft=getMarkupItemDraft();if(draft&&!(shapeIsPath(draft)&&hasProp(draft,'pathClose')))confirmMarkupItemDraft();// test if target is a shape, if not, run interaction handler
interactionPoint=mapEditorPointToImagePoint(vectorClone(origin));var foundShapes=getShapesNearPosition(interactionPoint,selectRadius,function(shape){return shapeCanSelect(shape);});var targettedMarkupItem=foundShapes.length&&foundShapes.shift();// confirm text when moving between shapes
if(activeMarkup&&shapeIsTextEditing(activeMarkup))handleTextConfirm();// deselect
if(!targettedMarkupItem&&activeMarkup&&shapeIsTextEditing(activeMarkup))deselectMarkupItem(activeMarkup);// if is clicking outside of canvas, don't create new shape
if(!willStartInteraction(origin))return;// check if markup was targetted
if(targettedMarkupItem&&shapeIsSelected(targettedMarkupItem)){interactionShapeWasSelected=true;interactionShape=targettedMarkupItem;// create a deep copy so we can check on end interaction if the shape was changed
interactionShapeOrigin=shapeDeepCopy(interactionShape);// clone shape we're interacting with so we can update it properly
interactionShapeOriginComputed=shapeComputeDisplay(shapeDeepCopy(interactionShape),parentRect);return;}// set target
interactionTarget=targettedMarkupItem||undefined;// started interacting
var didStartInteraction=oninteractionstart(e);// drag current targetted it as fallback interaction,
// helps make sticker interaction easier
if(!didStartInteraction&&targettedMarkupItem){// select
selectShape(targettedMarkupItem);interactionShape=targettedMarkupItem;// create a deep copy so we can check on end interaction if the shape was changed
interactionShapeOrigin=shapeDeepCopy(interactionShape);// clone shape we're interacting with so we can update it properly
interactionShapeOriginComputed=shapeComputeDisplay(shapeDeepCopy(interactionShape),parentRect);}};var resetInteraction=function resetInteraction(){clearTimeout(interactionTimer);interactionTimer=undefined;$$invalidate(118,isInteracting=false);};var handleInteractionCancel=function handleInteractionCancel(e){resetInteraction();oninteractioncancel(e);};var handleInteractionUpdate=function handleInteractionUpdate(e){var translation=e.detail.translation;// is interacting with shape
if(interactionShape){// prevent moving if not allowed
if(!shapeCanMove(interactionShape))return;// prevent moving if is editing text
if(shapeIsTextEditing(interactionShape))return;return translateShape(interactionShape,interactionShapeOriginComputed,translation);}oninteractionupdate(e);};var handleInteractionRelease=function handleInteractionRelease(e){resetInteraction();// test if is text and if we double tapped, if so, switch to text edit mode
if(interactionShape){if(shapeIsTextEditing(interactionShape)){handleTextCancel();}else// if tapped shape, and shape is text, and shape was selected
if(e.detail.isTap&&interactionShapeWasSelected&&shapeIsText(interactionShape)&&shapeCanInput(interactionShape)!==false){editMarkupItem(interactionShape);}return;}oninteractionrelease(e);};var handleInteractionEnd=function handleInteractionEnd(e){var isSelectInteraction=interactionTarget&&e.detail.isTap;if(e.detail.isTap)ontapcanvas({target:interactionShape||interactionTarget,position:interactionPoint});// shape remains active so user can resize, rotate
if(interactionShape){ontapshape(interactionShape);if(!shapeEqual(interactionShape,interactionShapeOrigin)){onupdateshape(interactionShape);}interactionShape=undefined;return;}// can we deselect the current shape?
var currentSelectedShape=getSelectedShape();var allowDeselectShape=currentSelectedShape?beforeDeselectShape(currentSelectedShape,interactionTarget||undefined):true;if(allowDeselectShape){blurShapes({storePrevious:false});}oninteractionend(e);if(allowDeselectShape&&isSelectInteraction){selectShape(interactionTarget);}};//#endregion
//
// Shape manipulation
//
var getMarkupShapePoints=function getMarkupShapePoints(shape){if(shapeIsRect(shape)){// too small to draw
if(shape.width<1&&shape.height<1)return;var center=rectCenter(shape);var points=rectGetCorners(shape);if(shape.flipX||shape.flipY){vectorsFlip(points,shape.flipX,shape.flipY,center.x,center.y);}return vectorsRotate(points,shape.rotation,center.x,center.y);}if(shapeIsEllipse(shape)){if(shape.rx<1&&shape.ry<1)return;var _center=shape;var _points=rectGetCorners(rectCreateFromEllipse(shape));if(shape.flipX||shape.flipY){vectorsFlip(_points,shape.flipX,shape.flipY,_center.x,_center.y);}return vectorsRotate(_points,shape.rotation,_center.x,_center.y);}if(shapeIsLine(shape)){return[shapeLineGetStartPoint(shape),shapeLineGetEndPoint(shape)];}if(shapeIsPath(shape)){return _toConsumableArray(shape.points);}if(shapeIsText(shape)){// too small to draw
if(shape.width<5&&shape.height<5)return;var rect=getMarkupShapeRect(shape);rect.width=Math.max(MIN_TEXT_MARKUP_WIDTH,rect.width);var _center2=rectCenter(rect);var _points2=rectGetCorners(rect);if(shape.flipX||shape.flipY){vectorsFlip(_points2,shape.flipX,shape.flipY,_center2.x,_center2.y);}return vectorsRotate(_points2,shape.rotation,_center2.x,_center2.y);}return[];};var getShapeRotationPoint=function getShapeRotationPoint(shape){var points=getMarkupShapePoints(shape);var origin;var dir;if(shape.flipY){origin=vectorCenter([points[0],points[1]]);dir=vectorNormalize(vectorCreate(points[1].x-points[2].x,points[1].y-points[2].y));}else{origin=vectorCenter([points[2],points[3]]);dir=vectorNormalize(vectorCreate(points[2].x-points[1].x,points[2].y-points[1].y));}vectorMultiply(dir,ROTATION_CONTROL_OFFSET/contextZoom);return{origin:origin,dir:dir};};var getShapeRotationPointOnScreen=function getShapeRotationPointOnScreen(shape){var markupPoint=getShapeRotationPoint(shape);var screenPosition=mapImagePointToEditorPoint({x:markupPoint.origin.x+markupPoint.dir.x,y:markupPoint.origin.y+markupPoint.dir.y});var screenOrigin=mapImagePointToEditorPoint(markupPoint.origin);return{origin:screenOrigin,position:screenPosition};};var showHover=function showHover(shape){var shapePoints=getMarkupShapePoints(shapeComputeDisplay(shapeDeepCopy(shape),parentRect));if(!shapePoints)return;var points=shapePoints.map(mapImagePointToEditorPoint);var pathClose=shape.pathClose?true:shapeIsPath(shape)||shapeIsLine(shape)?false:true;var outlineShadow={id:markupHoverShapeId,points:points.map(function(p){return vectorCreate(p.x+1,p.y+1);}),strokeColor:[0,0,0,0.1],strokeWidth:2,pathClose:pathClose};var outline={id:markupHoverShapeId,points:points,strokeColor:hoverColor,//[3 / 255, 169 / 255, 244 / 255],
strokeWidth:2,pathClose:pathClose};// remove any previous hover shapes
var res=ui.filter(function(shape){return shape.id!==markupHoverShapeId;});// update ui
$$invalidate(54,ui=[].concat(_toConsumableArray(res),[outlineShadow,outline]));};var hideHover=function hideHover(){// remove shapes
var res=ui.filter(function(shape){return shape.id!==markupHoverShapeId;});// no shapes removed, don't update ui
if(res.length===ui.length)return;$$invalidate(54,ui=res);};var hoverShape;// draw shape manipulator edges
var ShapeManipulatorUid="markup-manipulator-segment-"+uid;var redrawManipulatorLines=function redrawManipulatorLines(opacity,shape,pointerPosition){var isPath=shapeIsPath(shape);var isPolygon=isPath&&hasProp(shape,'pathClose');var hasStroke=isPolygon&&shapeHasStroke(shape);var isDraft=shapeIsDraft(shape);var isTextEditing=shapeIsTextEditing(shape);// don't draw line manipulator on sharpie draft
if(isDraft&&isPath&&!isPolygon)return;// create manipulator outline segments
var segments=[];var screenPoints=_toConsumableArray(shapeActiveScreenPoints);var screenPointsLast=screenPoints[screenPoints.length-1];var screenPointsFirst=screenPoints[0];var shadowOpacity=(isTextEditing?0.05:0.1)*opacity;var lineOpacity=(isTextEditing?0.5:1)*opacity;var strokeColorShadow=[0,0,0];var strokeColor=[1,1,1];var strokeWidth=isTextEditing?1:1.5;// if shift is held snap to last point
if($keysPressedStored.includes(16)&&screenPointsLast&&pointerPosition)snapRelativeToAnchor(screenPointsLast,pointerPosition);var distToOriginSquared=screenPoints.length&&isPolygon&&isDraft&&pointerPosition?vectorDistanceSquared(screenPointsFirst,pointerPosition):Infinity;var distToLastSquared=screenPoints.length&&isPolygon&&isDraft&&pointerPosition?vectorDistanceSquared(screenPointsLast,pointerPosition):Infinity;var canClosePath=distToOriginSquared<=POLYGON_END_PATH_DISTANCE_SQUARED;var canEndPath=distToLastSquared<=POLYGON_END_PATH_DISTANCE_SQUARED;// if we can't close the path we draw a line from the last point to the pointer position
if(!canClosePath&&pointerPosition)screenPoints.push(pointerPosition);var canDrawLine=screenPoints.length>1;var closeSelectionPath=shape.pathClose?true:shapeIsPath(shape)||shapeIsLine(shape)?screenPoints.length>2&&canClosePath:true;// shadows
canDrawLine&&segments.push({id:ShapeManipulatorUid,points:screenPoints.map(function(p){return vectorCreate(p.x+1,p.y+1);}),pathClose:closeSelectionPath,strokeColor:strokeColorShadow,strokeWidth:2,opacity:shadowOpacity});isPolygon&&segments.push.apply(segments,_toConsumableArray(screenPoints.map(function(point){return _objectSpread(_objectSpread({id:ShapeManipulatorUid},point),{},{rx:strokeWidth*2,ry:strokeWidth*2,backgroundColor:strokeColorShadow,opacity:shadowOpacity});})));if(shapeManipulatorRotationPoint){// add rotator line shadow
segments.push({id:ShapeManipulatorUid,points:[vectorCreate(shapeManipulatorRotationPoint.origin.x+1,shapeManipulatorRotationPoint.origin.y+1),vectorCreate(shapeManipulatorRotationPoint.position.x+1,shapeManipulatorRotationPoint.position.y+1)],strokeColor:strokeColorShadow,strokeWidth:2,opacity:shadowOpacity});}// lines
canDrawLine&&segments.push({id:ShapeManipulatorUid,points:screenPoints,pathClose:closeSelectionPath,strokeColor:strokeColor,strokeWidth:strokeWidth,backgroundColor:isDraft&&shape.backgroundColor&&shape.backgroundColor[3]>0?shape.backgroundColor:[0,0,0,0],opacity:lineOpacity});isPolygon&&segments.push.apply(segments,_toConsumableArray(screenPoints.map(function(point){return _objectSpread(_objectSpread({id:ShapeManipulatorUid},point),{},{rx:strokeWidth*3,ry:strokeWidth*3,backgroundColor:[0.5,0.5,0.5],strokeWidth:strokeWidth,strokeColor:strokeColor});})));isPolygon&&isDraft&&// !canEndPath &&
shapeActiveScreenPoints.length>=3&&segments.push(_objectSpread(_objectSpread({},screenPointsFirst),{},{id:ShapeManipulatorUid,rx:strokeWidth*(canClosePath?5:4),ry:strokeWidth*(canClosePath?5:4),backgroundColor:canClosePath?hoverColor:[0.5,0.5,0.5],strokeWidth:strokeWidth,strokeColor:strokeColor}));isPolygon&&isDraft&&hasStroke&&!canClosePath&&shapeActivePoints.length>=2&&segments.push(_objectSpread(_objectSpread({},screenPointsLast),{},{id:ShapeManipulatorUid,rx:strokeWidth*(canEndPath?5:4),ry:strokeWidth*(canEndPath?5:4),backgroundColor:canEndPath?hoverColor:[0.5,0.5,0.5],strokeWidth:strokeWidth,strokeColor:strokeColor}));if(shapeManipulatorRotationPoint){// add rotator line
segments.push({id:ShapeManipulatorUid,points:[{x:shapeManipulatorRotationPoint.origin.x,y:shapeManipulatorRotationPoint.origin.y},{x:shapeManipulatorRotationPoint.position.x,y:shapeManipulatorRotationPoint.position.y}],strokeColor:strokeColor,strokeWidth:strokeWidth,opacity:lineOpacity});}// replace existing segments
$$invalidate(54,ui=ui.filter(function(guide){return guide.id!==ShapeManipulatorUid;}).concat(segments));};var removeMarkupManipulatorLines=function removeMarkupManipulatorLines(){$$invalidate(54,ui=ui.filter(function(guide){return guide.id!==ShapeManipulatorUid;}));};var togglePrerender=function togglePrerender(isActive){if(!isActive)return updateMarkupShapeItems({_prerender:false});var shape=markup.find(function(markupItem){return markupItem.isEditing;});if(!shape)return;updateMarkupShape(shape,{_prerender:textInputMode==='inline'});};var handleManipulatorResizeGrab=function handleManipulatorResizeGrab(e){$$invalidate(118,isInteracting=true);interactionShape=activeMarkup;interactionShapeOriginComputed=activeMarkupComputed;};var handleManipulatorResizeDrag=function handleManipulatorResizeDrag(e){// is possible when using multiple fingers (scale canvas + drag / resize)
if(!interactionShape){$$invalidate(118,isInteracting=false);return;}var _e$detail2=e.detail,translation=_e$detail2.translation,indexes=_e$detail2.indexes,shiftKey=_e$detail2.shiftKey;resizeShape(interactionShape,interactionShapeOriginComputed,indexes,translation,{shiftKey:shiftKey});};var handleManipulatorResizeEnd=function handleManipulatorResizeEnd(e){// is possible when using multiple fingers (scale canvas + drag / resize)
if(!interactionShape){$$invalidate(118,isInteracting=false);return;}selectShape(interactionShape);var isTap=e.detail.isTap;if(isTap)ontapshape(interactionShape);interactionShape=undefined;$$invalidate(118,isInteracting=false);onupdateshape(activeMarkup);};var handleManipulatorRotateGrab=function handleManipulatorRotateGrab(e){rotatorInitialPosition=getShapeRotationPoint(activeMarkupComputed).origin;$$invalidate(118,isInteracting=true);interactionShape=activeMarkup;interactionShapeOriginComputed=activeMarkupComputed;};var handleManipulatorRotateDrag=function handleManipulatorRotateDrag(e){// is possible when using multiple fingers (scale canvas + drag / resize)
if(!interactionShape){$$invalidate(118,isInteracting=false);return;}var _e$detail3=e.detail,translation=_e$detail3.translation,shiftKey=_e$detail3.shiftKey;rotateShape(interactionShape,interactionShapeOriginComputed,translation,{shiftKey:shiftKey});};var handleManipulatorRotateEnd=function handleManipulatorRotateEnd(){// is possible when using multiple fingers (scale canvas + drag / resize)
if(!interactionShape){$$invalidate(118,isInteracting=false);return;}selectShape(interactionShape);interactionShape=undefined;$$invalidate(118,isInteracting=false);onupdateshape(activeMarkup);};//
// Keyboard
//
var handleKey=function handleKey(e){// get key type
var key=e.key;var isEscape=/escape/i.test(key);// if (isEscape && getMarkupItemDraft()) {
//     e.preventDefault();
//     e.stopPropagation();
//     discardMarkupItemDraft();
//     return;
// }
// only handle key input if a shape has been selected
if(!hasActiveMarkupItem())return;// if is escape deselect active item
if(isEscape){e.preventDefault();e.stopPropagation();return deselectMarkupItem(activeMarkup);}// if is tab, select next markup item
/*
if (/arrow/i.test(key)) {
    const success = e.shiftKey 
        ? selectPreviousMarkupItem(activeMarkup)
        : selectNextMarkupItem(activeMarkup);
    
    if (success) {
        e.preventDefault();
        e.stopPropagation();
    }
}
*/ // if is remove active
if(/backspace|delete/i.test(key)&&!isTextInputElement(e.target)){// prevent back navigation on Firefox
e.preventDefault();// remove the item
removeActiveMarkupItem();}// if is duplicate active shape keyboard shortcut
if(allowShapeDuplicate&&key==='d'&&(e.metaKey||e.ctrlKey)){e.preventDefault();e.stopPropagation();duplicateActiveMarkup();}};var isTextInputElement=function isTextInputElement(element){return element.isContentEditable||/input|textarea/i.test(element.nodeName);};//
// Text input
//
var textInput;var getTextShapeOriginSnapshot=function getTextShapeOriginSnapshot(){return _objectSpread({},activeMarkup);};var getTextInputTextStyles=function getTextInputTextStyles(shapeComputed,mode){var _shapeComputed$textAl=shapeComputed.textAlign,textAlign=_shapeComputed$textAl===void 0?'left':_shapeComputed$textAl,_shapeComputed$fontFa=shapeComputed.fontFamily,fontFamily=_shapeComputed$fontFa===void 0?'sans-serif':_shapeComputed$fontFa,_shapeComputed$fontWe=shapeComputed.fontWeight,fontWeight=_shapeComputed$fontWe===void 0?'normal':_shapeComputed$fontWe,_shapeComputed$fontSt=shapeComputed.fontStyle,fontStyle=_shapeComputed$fontSt===void 0?'normal':_shapeComputed$fontSt;var fontSize=shapeComputed.fontSize;var imp='!important';var cosmetic="text-align:".concat(textAlign).concat(imp,";font-family:").concat(fontFamily).concat(imp,";font-weight:").concat(fontWeight).concat(imp,";font-style:").concat(fontStyle).concat(imp,";");if(mode==='modal')return cosmetic;var color=colorArrayToRGBA(shapeComputed.color);var lineHeight=shapeComputed.lineHeight;var initialLineOffset=Math.max(0,fontSize-lineHeight)*0.5;return"--bottom-inset:".concat(initialLineOffset,"px;padding:").concat(initialLineOffset,"px 0 0").concat(imp,";color:").concat(color).concat(imp,";font-size:").concat(fontSize,"px").concat(imp,";line-height:").concat(lineHeight,"px").concat(imp,";").concat(cosmetic);};var getTextInputPositionStyles=function getTextInputPositionStyles(shapeComputed,offset,contextZoom,contextRotation){var center;var size;if(shapeComputed.width&&shapeComputed.height){// text box
center=rectCenter(shapeComputed);size=sizeCreateFromAny(shapeComputed);}else{// text line
size=textToSize(activeMarkup.text,activeMarkupComputed);// if has fix width, we'll use that
size.width=activeMarkupComputed.width||size.width;center=vectorCreate(shapeComputed.x+size.width*0.5,shapeComputed.y+size.height*0.5);}var lineHeight=Math.max(0,shapeComputed.fontSize-shapeComputed.lineHeight)+shapeComputed.lineHeight;var position=mapImagePointToEditorPoint(center);var tx=position.x-offset.x-size.width*0.5;var ty=position.y-offset.y-size.height*0.5;var flipX=shapeComputed.flipX;var flipY=shapeComputed.flipY;var r=shapeComputed.rotation;if(contextFlipX&&contextFlipY){flipX=!flipX;flipY=!flipY;}else if(contextFlipX){flipX=!flipX;r=-r;}else if(contextFlipY){flipY=!flipY;r=-r;}r+=contextRotation;var sx=contextZoom*(flipX?-1:1);var sy=contextZoom*(flipY?-1:1);return"--line-height:".concat(lineHeight,"px;width:").concat(size.width,"px;height:").concat(size.height,"px;transform:translate(").concat(tx,"px,").concat(ty,"px) rotate(").concat(r,"rad) scale(").concat(sx,", ").concat(sy,")");};// sets the contenteditable text when user clicks text shape
var syncTextInput=function syncTextInput(){return updateTextInputValue(textInputText);};var updateTextInputValue=function updateTextInputValue(text){$$invalidate(7,textInput.innerHTML=textToHTML(text),textInput);};// cleans up single line text
var removeLineBreaks=function removeLineBreaks(text){var lines=text.// split on lines so we can create compressed normal line of text
split(/[\n\r]/g);if(lines.length>1){return lines.// remove spaces around lines
map(function(str){return str.trim();}).// remove empty strings
filter(function(str){return str.length;}).// create new line
join(' ');}// just return line
return lines[0];};var getTextInputValue=function getTextInputValue(element){var textInputValue;if(element.value===undefined){textInputValue=htmlToText(element.innerHTML);}else{textInputValue=element.value;}var value=shapeIsTextBlock(activeMarkup)&&activeMarkup.disableNewline!==false?removeLineBreaks(textInputValue):textInputValue;return value;};var formatContentEditable=function formatContentEditable(html){// check if can input
var canInput=shapeCanInput(activeMarkup,html);return canInput===true?html:canInput;};var handleTextInput=function handleTextInput(){var value=getTextInputValue(textInput);var canInput=shapeCanInput(activeMarkup,value);var text=canInput===true?value:canInput;var x=textShapeDisplayOrigin.x;var y=textShapeDisplayOrigin.y;// if does not have height we need to adjust offset if is rotated
if(!activeMarkup.height){// draw origin rect
var originRotatedRect=rectRotate(_objectSpread({},textRectDisplayOrigin),activeMarkup.rotation);// draw current rect
var size=textToSize(text,activeMarkupComputed);var currentRotatedRect=rectRotate(_objectSpread({x:x,y:y},size),activeMarkup.rotation);var _originRotatedRect=_slicedToArray(originRotatedRect,3),originTopLeft=_originRotatedRect[0],originBottomRight=_originRotatedRect[2];var _currentRotatedRect=_slicedToArray(currentRotatedRect,3),currentTopLeft=_currentRotatedRect[0],currentBottomRight=_currentRotatedRect[2];var a=originTopLeft;var b=currentTopLeft;// if flipped we need to 'extend' the text field in the opposite direction
if(activeMarkup.flipX){a=originBottomRight;b=currentBottomRight;}// move
var d=vectorSubtract(vectorClone(a),b);x+=d.x;y+=d.y;}updateMarkupShape(activeMarkup,{x:isString(textShapeOrigin.x)?toPercentage(x,parentRect.width):x,y:isString(textShapeOrigin.y)?toPercentage(y,parentRect.height):y,text:text});};var handleTextInputAttempt=function handleTextInputAttempt(e){var target=e.target,key=e.key;var currentValue=target.value||target.innerText;var selectionStart=target.selectionStart||0;var selectionEnd=target.selectionEnd||currentValue.length;var currentValueStart=currentValue.substring(0,selectionStart);var currentValueEnd=currentValue.substring(selectionEnd);var intendedValue=currentValueStart+key+currentValueEnd;var filteredValue=shapeCanInput(activeMarkup,intendedValue);if(filteredValue!==intendedValue)return e.preventDefault();};// prevent moving shape when focusing text field, and close field if escape pressed
var handleTextInputKeyDown=function handleTextInputKeyDown(e){// block newlines for auto width text that doesn't allow newlines
if(shapeIsTextBlock(activeMarkup)&&/enter/i.test(e.code)&&activeMarkup.disableNewline!==false)return e.preventDefault();if(/arrow/i.test(e.code))return e.stopPropagation();if(/escape/i.test(e.key))return handleTextCancel();};// handle alt/ctrl/cmd + return
var handleTextInputKeyUp=function handleTextInputKeyUp(e){// get key type
var key=e.key,ctrlKey=e.ctrlKey,altKey=e.altKey;// confirm multi line text elements
if(/enter/i.test(key)&&(ctrlKey||altKey))return handleTextConfirm();};var handleTextConfirm=function handleTextConfirm(){// if was draft, now need to confirm
var wasDraft=activeShapeIsDraft;if(activeShapeIsDraft)confirmMarkupItemDraft();// final text input check
textInput&&textInput.confirm&&textInput.confirm();handleTextInput();// done
finishEditMarkupItem(activeMarkup);if(wasDraft)onaddshape(activeMarkup);else onupdateshape(activeMarkup);};var handleTextCancel=function handleTextCancel(){if(activeShapeIsDraft){discardMarkupItemDraft();}else{updateMarkupShape(activeMarkup,{text:textShapeOrigin.text,x:textShapeOrigin.x,y:textShapeOrigin.y});finishEditMarkupItem(activeMarkup);}};//#region shape popup menu actions
var getShapeSizeTranslation=function getShapeSizeTranslation(originRect,targetRect,_ref411){var flipX=_ref411.flipX,flipY=_ref411.flipY,rotation=_ref411.rotation;var anchor=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'top left';var a,b;// draw origin rect
var _rectRotate=rectRotate(originRect,rotation),_rectRotate2=_slicedToArray(_rectRotate,4),originTopLeft=_rectRotate2[0],originTopRight=_rectRotate2[1],originBottomRight=_rectRotate2[2],originBottomLeft=_rectRotate2[3];// draw target rect
var _rectRotate3=rectRotate(targetRect,rotation),_rectRotate4=_slicedToArray(_rectRotate3,4),targetTopLeft=_rectRotate4[0],targetTopRight=_rectRotate4[1],targetBottomRight=_rectRotate4[2],targetBottomLeft=_rectRotate4[3];if(anchor==='top center'){// for now doesn't matter if it's flipped horizontal
var originMid=vectorCenter(flipY?[originBottomLeft,originBottomRight]:[originTopLeft,originTopRight]);var targetMid=vectorCenter(flipY?[targetBottomLeft,targetBottomRight]:[targetTopLeft,targetTopRight]);a=originMid;b=targetMid;}else if(anchor==='top right'&&!flipX||anchor==='top left'&&flipX){// tr
a=flipY?originBottomRight:originTopRight;b=flipY?targetBottomRight:targetTopRight;}else{// tl
a=flipY?originBottomLeft:originTopLeft;b=flipY?targetBottomLeft:targetTopLeft;}return vectorSubtract(vectorClone(a),b);};var translateRelative=function translateRelative(current,position,translation){return vectorCreate(isString(current.x)?toPercentage(position.x+translation.x,parentRect.width):position.x+translation.x,isString(current.y)?toPercentage(position.y+translation.y,parentRect.height):position.y+translation.y);};var ShapeTextStateCache={};var handleEditTextActiveMarkup=function handleEditTextActiveMarkup(){return editMarkupItem(activeMarkup);};var handleTextSwitchLayout=function handleTextSwitchLayout(){var shapeTextSize=sizeApply(textToSize(activeMarkup.text,activeMarkupComputed),function(v){return Math.ceil(v);});var isFixedBox=hasProp(activeMarkup,'height');var isAutoHeightBox=!isFixedBox&&hasProp(activeMarkup,'width');// set/get cache entries for this text shape
var key=activeMarkup.id;var cache=ShapeTextStateCache[key];if(!cache){ShapeTextStateCache[key]={};cache=ShapeTextStateCache[key];}var toAutoWidth=function toAutoWidth(sizeFrom){// remove width prop
var _activeMarkupComputed=activeMarkupComputed,width=_activeMarkupComputed.width,autoSizeProps=_objectWithoutProperties(_activeMarkupComputed,_excluded2);var sizeTo=textToSize(activeMarkup.text,autoSizeProps);// this will change dimensions so if rotated we have to calculate new position
var translation=getShapeSizeTranslation(rectCreate(activeMarkupComputed.x,activeMarkupComputed.y,sizeFrom.width,sizeFrom.height),rectCreate(activeMarkupComputed.x,activeMarkupComputed.y,sizeTo.width,sizeTo.height),activeMarkupComputed,"top ".concat(activeMarkup.textAlign));var shouldRemoveTextAlign=activeMarkupComputed.disableNewline!==false;// switch to auto mode
removeMarkupShapeProps(activeMarkup,['width','height',shouldRemoveTextAlign&&'textAlign']);// update position based on size translation
updateMarkupShape(activeMarkup,_objectSpread({},translateRelative(activeMarkup,activeMarkupComputed,translation)));};var toAutoHeight=function toAutoHeight(sizeFrom){// -> switch to auto height mode
var sizeTo=sizeCreate(cache.width||activeMarkupComputed.width||shapeTextSize.width,shapeTextSize.height);var textAlign=cache.textAlign||'left';// this will change dimensions so if rotated we have to calculate new position
var translation=getShapeSizeTranslation(rectCreate(activeMarkupComputed.x,activeMarkupComputed.y,sizeFrom.width,sizeFrom.height),rectCreate(activeMarkupComputed.x,activeMarkupComputed.y,sizeTo.width,sizeTo.height),activeMarkupComputed,"top ".concat(textAlign));// switch to auto-height mode
removeMarkupShapeProps(activeMarkup,['height']);// update position based on size translation
updateMarkupShape(activeMarkup,_objectSpread(_objectSpread({},translateRelative(activeMarkup,activeMarkupComputed,translation)),{},{width:isString(activeMarkup.width)?toPercentage(sizeTo.width,parentRect.width):sizeTo.width,textAlign:textAlign}));};var toFixedSize=function toFixedSize(sizeFrom){// this can change dimensions so we need to recalculate position
var sizeTo=sizeCreate(cache.width||shapeTextSize.width,cache.height||shapeTextSize.height);var textAlign=cache.textAlign||'left';// this will change dimensions so if rotated we have to calculate new position
var translation=getShapeSizeTranslation(rectCreate(activeMarkupComputed.x,activeMarkupComputed.y,sizeFrom.width,sizeFrom.height),rectCreate(activeMarkupComputed.x,activeMarkupComputed.y,sizeTo.width,sizeTo.height),activeMarkupComputed,"top ".concat(textAlign));// switch to fixed box, use stored alignment or default to left text align
updateMarkupShape(activeMarkup,_objectSpread(_objectSpread({},translateRelative(activeMarkup,activeMarkupComputed,translation)),{},{width:isString(activeMarkup.width)?toPercentage(sizeTo.width,parentRect.width):sizeTo.width,height:isString(activeMarkup.width)?toPercentage(sizeTo.height,parentRect.height):sizeTo.height,textAlign:textAlign}));};if(isFixedBox){// store size so we can restore it later
cache.textAlign=activeMarkup.textAlign;cache.width=activeMarkupComputed.width;cache.height=activeMarkupComputed.height;var sizeFrom=sizeCreate(activeMarkupComputed.width,activeMarkupComputed.height);if(shapeCanChangeTextLayout(activeMarkup,'auto-height')){toAutoHeight(sizeFrom);}else if(shapeCanChangeTextLayout(activeMarkup,'auto-width')){toAutoWidth(sizeFrom);}}else if(isAutoHeightBox){// store alignment so we can restore it later
cache.textAlign=activeMarkup.textAlign;cache.width=activeMarkupComputed.width;// -> switch to auto width
var _sizeFrom=sizeCreate(activeMarkupComputed.width,shapeTextSize.height);if(shapeCanChangeTextLayout(activeMarkup,'auto-width')){toAutoWidth(_sizeFrom);}else if(shapeCanChangeTextLayout(activeMarkup,'fixed-size')){toFixedSize(_sizeFrom);}}else{// -> switch to fixed size or auto height
cache.textAlign=activeMarkup.textAlign;var _sizeFrom2=sizeCreate(Math.ceil(shapeTextSize.width),Math.ceil(shapeTextSize.height));if(shapeCanChangeTextLayout(activeMarkup,'fixed-size')){toFixedSize(_sizeFrom2);}else if(shapeCanChangeTextLayout(activeMarkup,'auto-height')){toAutoHeight(_sizeFrom2);}}};var handleFlipX=function handleFlipX(e){e.stopPropagation();var flipX=activeMarkup.flipX||false;updateMarkupShapeProperty(activeMarkup,'flipX',!flipX);onupdateshape(activeMarkup);};var handleFlipY=function handleFlipY(e){e.stopPropagation();var flipY=activeMarkup.flipY||false;updateMarkupShapeProperty(activeMarkup,'flipY',!flipY);onupdateshape(activeMarkup);};var handleAdjustOpacity=function handleAdjustOpacity(value){updateMarkupShapeProperty(activeMarkup,'opacity',value);};var handleConfirmOpacity=function handleConfirmOpacity(value){handleAdjustOpacity(value);onupdateshape(activeMarkup);};var handleRemoveActiveMarkup=function handleRemoveActiveMarkup(e){e.stopPropagation();e.target.blur();// cancels focus of remove button
removeActiveMarkupItem();};var handleMoveToFrontActiveMarkup=function handleMoveToFrontActiveMarkup(e){e.stopPropagation();// test if is not already at top of stack, if so, exit
var index=markup.findIndex(function(shape){return shape===activeMarkup;});if(index===markup.length-1)return;// add to last index
$$invalidate(0,markup=markup.filter(function(markupItem){return markupItem!==activeMarkup;}).concat([activeMarkup]));onupdateshape(activeMarkup);};var handleDuplicateActiveMarkup=function handleDuplicateActiveMarkup(e){e.stopPropagation();duplicateActiveMarkup();};var duplicateActiveMarkup=function duplicateActiveMarkup(){// create clone
var clone=shapeDeepCopy(activeMarkup);clone.id=getUniqueId();var duplicationOffset=vectorCreate(50,-50);// offset
if(hasProp(clone,'points')){var computedProps=shapeGetPropsPixelValues(clone,['points'],parentRect);computedProps.points.forEach(function(point){point.x+=duplicationOffset.x;point.y+=duplicationOffset.y;});shapeUpdateProps(clone,computedProps,parentRect);}else if(shapeIsLine(clone)){var _computedProps=shapeGetPropsPixelValues(clone,['x1','y1','x2','y2'],parentRect);_computedProps.x1+=duplicationOffset.x;_computedProps.y1+=duplicationOffset.y;_computedProps.x2+=duplicationOffset.x;_computedProps.y2+=duplicationOffset.y;shapeUpdateProps(clone,_computedProps,parentRect);}else{var currentPosition=shapeGetPropsPixelValues(clone,['x','y'],parentRect);currentPosition.x+=50;currentPosition.y-=50;shapeUpdateProps(clone,currentPosition,parentRect);}// add clone
markup.push(clone);// added
onaddshape(clone);// select clone
selectShape(clone);};//#endregion
var getMarkupControlsAnchorPosition=function getMarkupControlsAnchorPosition(rect){return vectorApply(vectorCreate(rect.x+rect.width*0.5,rect.y),snapToPixel);};//
// show & position markup controls panel
//
var markupControlsOpacity=spring(0,{stiffness:0.2,damping:0.7});component_subscribe($$self,markupControlsOpacity,function(value){return $$invalidate(16,$markupControlsOpacity=value);});var shapeControlsSize;var getShapeControlPositionOnCanvas=function getShapeControlPositionOnCanvas(position){var left=utilRect.x;var top=utilRect.y;var right=left+utilRect.width;var x=Math.max(position.x-shapeControlsSize.width*0.5,left);var y=Math.max(position.y-shapeControlsSize.height-shapeControlDist,top);if(x+shapeControlsSize.width>right)x=right-shapeControlsSize.width;return vectorCreate(x,y);};var TextLayoutChangeIcon=function TextLayoutChangeIcon(locale,shape){var _shape$disableTextLay=shape.disableTextLayout,disableTextLayout=_shape$disableTextLay===void 0?[]:_shape$disableTextLay;// is fixed size
if('height'in shape){if(disableTextLayout.includes('auto-height')){// next is auto-width, no need to set as is empty
return locale.shapeIconButtonTextLayoutAutoWidth;}else{// next is auto-height
return locale.shapeIconButtonTextLayoutAutoHeight;}}else// is auto-height
if('width'in shape){if(disableTextLayout.includes('auto-width')){// next is fixed-size
return locale.shapeIconButtonTextLayoutFixedSize;}else{// next is auto-width, no need to set as is empty
return locale.shapeIconButtonTextLayoutAutoWidth;}}else// is auto-width
{// next is fixed-size
if(disableTextLayout.includes('fixed-size')){// next is fixed-size
return locale.shapeIconButtonTextLayoutAutoHeight;}else{// next is auto-width, no need to set as is empty
return locale.shapeIconButtonTextLayoutFixedSize;}}};var TextLayoutChangeLabel=function TextLayoutChangeLabel(locale,shape){var _shape$disableTextLay2=shape.disableTextLayout,disableTextLayout=_shape$disableTextLay2===void 0?[]:_shape$disableTextLay2;// is fixed size
if('height'in shape){if(disableTextLayout.includes('auto-height')){// next is auto-width, no need to set as is empty
return locale.shapeTitleButtonTextLayoutAutoWidth;}else{// next is auto-height
return locale.shapeTitleButtonTextLayoutAutoHeight;}}else// is auto-height
if('width'in shape){if(disableTextLayout.includes('auto-width')){// next is fixed-size
return locale.shapeTitleButtonTextLayoutFixedSize;}else{// next is auto-width, no need to set as is empty
return locale.shapeTitleButtonTextLayoutAutoWidth;}}else// is auto-width
{// next is fixed-size
if(disableTextLayout.includes('fixed-size')){// next is fixed-size
return locale.shapeTitleButtonTextLayoutAutoHeight;}else{// next is auto-width, no need to set as is empty
return locale.shapeTitleButtonTextLayoutFixedSize;}}};var handleNudge=function handleNudge(e){var shape=getActiveMarkupItem();if(!shape)return;if(shapeIsTextEditing(shape))return;if(!shapeCanMove(shape))return;interactionShape=shape;interactionShapeOriginComputed=shapeComputeDisplay(shapeDeepCopy(interactionShape),parentRect);translateShape(interactionShape,interactionShapeOriginComputed,e.detail);};// shape navigator
var showShapeList=false;var handleFocusIn=function handleFocusIn(e){$$invalidate(17,showShapeList=true);};var handleFocusOut=function handleFocusOut(_ref412){var relatedTarget=_ref412.relatedTarget;// still in list
if(relatedTarget&&relatedTarget.classList.contains('shape-selector__button'))return;$$invalidate(17,showShapeList=false);};// change cursor style
var lastImagePosition=vectorCreateEmpty();var pointerPositionInEditor=undefined;var handlePointerMove=function handlePointerMove(e){// not handled for touch interaction
if(e.pointerType==='touch')return;// if interactionTimer is set an interaction was started
if(isInteracting||interactionTimer)setHoverShape(undefined);var editorPosition=getEventPositionInEditor(e,rootRect);var imagePosition=vectorApply(mapEditorPointToImagePoint(editorPosition),function(v){return Math.round(v);});if(vectorEqual(imagePosition,lastImagePosition))return;lastImagePosition=vectorClone(imagePosition);$$invalidate(120,pointerPositionInEditor=editorPosition);if(isInteracting||interactionTimer)return;onhovercanvas(editorPosition,imagePosition);// no hover effect when creating markup
if(activeMarkupItemIsDraft)return;var _getShapesNearPositio=getShapesNearPosition(imagePosition,0,shapeCanSelect),_getShapesNearPositio2=_slicedToArray(_getShapesNearPositio,1),shape=_getShapesNearPositio2[0];// can't hover draft
if(shape&&shapeIsDraft(shape))return;setHoverShape(shape);};var setHoverShape=function setHoverShape(shape){// let others know we're hovering this shape
onhovershape(shape);// update interface
$$invalidate(119,hoverShape=shape);};// clean up
onDestroy(function(){// clean up invisible lines
removeMarkupManipulatorLines();// clean up hover lines
hideHover();});// element ref
var element;function measure_handler(event){bubble.call(this,$$self,event);}var click_handler=function click_handler(index){return selectShape(markup[index]);};function textarea_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){textInput=$$value;$$invalidate(7,textInput);});}function textarea_input_handler(){textInputText=this.value;(((($$invalidate(22,textInputText),$$invalidate(11,shouldRenderTextInput)),$$invalidate(123,activeMarkup)),$$invalidate(137,isTextMarkupSelected)),$$invalidate(1,disabled)),$$invalidate(0,markup);}function contenteditable_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){textInput=$$value;$$invalidate(7,textInput);});}var focusout_handler=function focusout_handler(){// need to focus root shape editor node as otherwise next escape press closes modal when in modal
element&&element.focus();};var measure_handler_1=function measure_handler_1(e){return $$invalidate(8,shapeControlsSize=e.detail);};function div_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){element=$$value;$$invalidate(18,element);});}var interactable_function_1=function interactable_function_1(e){return getEventPositionInEditor(e,rootRect);};$$self.$$set=function($$props){if('uid'in $$props)$$invalidate(55,uid=$$props.uid);if('ui'in $$props)$$invalidate(54,ui=$$props.ui);if('disabled'in $$props)$$invalidate(1,disabled=$$props.disabled);if('markup'in $$props)$$invalidate(0,markup=$$props.markup);if('offset'in $$props)$$invalidate(2,offset=$$props.offset);if('contextRotation'in $$props)$$invalidate(56,contextRotation=$$props.contextRotation);if('contextFlipX'in $$props)$$invalidate(57,contextFlipX=$$props.contextFlipX);if('contextFlipY'in $$props)$$invalidate(58,contextFlipY=$$props.contextFlipY);if('contextZoom'in $$props)$$invalidate(59,contextZoom=$$props.contextZoom);if('active'in $$props)$$invalidate(60,active=$$props.active);if('opacity'in $$props)$$invalidate(61,opacity=$$props.opacity);if('parentRect'in $$props)$$invalidate(62,parentRect=$$props.parentRect);if('rootRect'in $$props)$$invalidate(3,rootRect=$$props.rootRect);if('utilRect'in $$props)$$invalidate(63,utilRect=$$props.utilRect);if('hoverColor'in $$props)$$invalidate(64,hoverColor=$$props.hoverColor);if('textInputMode'in $$props)$$invalidate(4,textInputMode=$$props.textInputMode);if('oninteractionstart'in $$props)$$invalidate(65,oninteractionstart=$$props.oninteractionstart);if('oninteractionupdate'in $$props)$$invalidate(66,oninteractionupdate=$$props.oninteractionupdate);if('oninteractionrelease'in $$props)$$invalidate(67,oninteractionrelease=$$props.oninteractionrelease);if('oninteractionend'in $$props)$$invalidate(68,oninteractionend=$$props.oninteractionend);if('oninteractioncancel'in $$props)$$invalidate(69,oninteractioncancel=$$props.oninteractioncancel);if('onaddshape'in $$props)$$invalidate(70,onaddshape=$$props.onaddshape);if('onupdateshape'in $$props)$$invalidate(71,onupdateshape=$$props.onupdateshape);if('onselectshape'in $$props)$$invalidate(72,onselectshape=$$props.onselectshape);if('onremoveshape'in $$props)$$invalidate(73,onremoveshape=$$props.onremoveshape);if('ontapshape'in $$props)$$invalidate(74,ontapshape=$$props.ontapshape);if('onhovershape'in $$props)$$invalidate(75,onhovershape=$$props.onhovershape);if('onhovercanvas'in $$props)$$invalidate(76,onhovercanvas=$$props.onhovercanvas);if('ontapcanvas'in $$props)$$invalidate(77,ontapcanvas=$$props.ontapcanvas);if('beforeSelectShape'in $$props)$$invalidate(78,beforeSelectShape=$$props.beforeSelectShape);if('beforeDeselectShape'in $$props)$$invalidate(79,beforeDeselectShape=$$props.beforeDeselectShape);if('beforeRemoveShape'in $$props)$$invalidate(80,beforeRemoveShape=$$props.beforeRemoveShape);if('beforeUpdateShape'in $$props)$$invalidate(81,beforeUpdateShape=$$props.beforeUpdateShape);if('willRenderShapeControls'in $$props)$$invalidate(82,willRenderShapeControls=$$props.willRenderShapeControls);if('willStartInteraction'in $$props)$$invalidate(83,willStartInteraction=$$props.willStartInteraction);if('mapEditorPointToImagePoint'in $$props)$$invalidate(84,mapEditorPointToImagePoint=$$props.mapEditorPointToImagePoint);if('mapImagePointToEditorPoint'in $$props)$$invalidate(85,mapImagePointToEditorPoint=$$props.mapImagePointToEditorPoint);if('eraseRadius'in $$props)$$invalidate(86,eraseRadius=$$props.eraseRadius);if('selectRadius'in $$props)$$invalidate(87,selectRadius=$$props.selectRadius);if('enableButtonFlipVertical'in $$props)$$invalidate(88,enableButtonFlipVertical=$$props.enableButtonFlipVertical);if('enableTapToAddText'in $$props)$$invalidate(89,enableTapToAddText=$$props.enableTapToAddText);if('locale'in $$props)$$invalidate(5,locale=$$props.locale);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*disabled, markup*/3){$$invalidate(123,activeMarkup=!disabled&&markup&&(getMarkupItemDraft()||getActiveMarkupItem()));}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824){$$invalidate(142,activeMarkupSelected=!!activeMarkup);}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824){$$invalidate(134,activeShapeIsDraft=activeMarkup&&shapeIsDraft(activeMarkup));}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824|$$self.$$.dirty[4]&/*activeShapeIsDraft*/1024){$$invalidate(9,activeShapeId=activeMarkup&&!activeShapeIsDraft?activeMarkup.id:undefined);}if($$self.$$.dirty[0]&/*rootRect*/8|$$self.$$.dirty[2]&/*parentRect*/1|$$self.$$.dirty[3]&/*activeMarkup*/1073741824){// rootRect is in there so it recomputes the shape when the editor is resized
$$invalidate(12,activeMarkupComputed=rootRect&&activeMarkup&&shapeComputeDisplay(shapeDeepCopy(activeMarkup),parentRect));}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824|$$self.$$.dirty[4]&/*activeShapeIsDraft*/1024){$$invalidate(121,activeMarkupItemIsDraft=!!(activeMarkup&&activeShapeIsDraft));}if($$self.$$.dirty[0]&/*activeMarkupComputed*/4096|$$self.$$.dirty[1]&/*opacity*/1073741824|$$self.$$.dirty[3]&/*activeMarkup*/1073741824){// $: shapeProps = activeMarkup || undefined;
// TODO: we use opacity to trigger a redraw of the active points, this should be changed to the image zoom factor in a future release
//  && !shapeIsPath(activeMarkupComputed)
$$invalidate(141,shapeActivePoints=activeMarkup&&opacity&&getMarkupShapePoints(activeMarkupComputed)||[]);}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824){$$invalidate(143,allowResizeControls=activeMarkup&&shapeCanResize(activeMarkup)&&!shapeIsTextEditing(activeMarkup));}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824){$$invalidate(13,allowRotateControls=activeMarkup&&shapeCanRotate(activeMarkup)&&!shapeIsTextEditing(activeMarkup));}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824|$$self.$$.dirty[4]&/*allowResizeControls*/524288){$$invalidate(15,allowEdgeControls=allowResizeControls&&hasProp(activeMarkup,'text')&&!activeMarkup.height?[[1,2],[3,0]]:activeMarkup&&(shapeIsLine(activeMarkup)||shapeIsPath(activeMarkup))?false:allowResizeControls);}if($$self.$$.dirty[0]&/*allowEdgeControls*/32768|$$self.$$.dirty[3]&/*activeMarkup*/1073741824|$$self.$$.dirty[4]&/*allowResizeControls*/524288){$$invalidate(27,allowCornerControls=activeMarkup?Array.isArray(allowEdgeControls)?false:allowResizeControls:false);}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824|$$self.$$.dirty[4]&/*shapeActivePoints*/131072){$$invalidate(14,shouldRenderShapeManipulator=activeMarkup&&shapeActivePoints.length>1);}if($$self.$$.dirty[2]&/*mapImagePointToEditorPoint*/8388608|$$self.$$.dirty[4]&/*shapeActivePoints*/131072){$$invalidate(139,shapeActiveScreenPoints=shapeActivePoints.map(mapImagePointToEditorPoint));}if($$self.$$.dirty[0]&/*offset*/4|$$self.$$.dirty[4]&/*shapeActiveScreenPoints*/32768){$$invalidate(10,shapeManipulatorPoints=shapeActiveScreenPoints.map(function(point){return vectorCreate(point.x-offset.x,point.y-offset.y);}));}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824|$$self.$$.dirty[4]&/*activeMarkupSelected*/262144){$$invalidate(26,shapeAllowNewline=activeMarkupSelected&&(shapeIsTextBox(activeMarkup)?// has selected text box, if text box has disableNewline property, follow setting, else allow new lines
hasProp(activeMarkup,'disableNewline')?!activeMarkup.disableNewline:true:// has selected something else, only disable new lines if disableNewline is explicitly set to false
activeMarkup.disableNewline===false));}if($$self.$$.dirty[2]&/*mapImagePointToEditorPoint*/8388608|$$self.$$.dirty[3]&/*hoverShape*/67108864){hoverShape&&mapImagePointToEditorPoint&&!shapeIsSelected(hoverShape)&&shapeCanSelect(hoverShape)?showHover(hoverShape):hideHover();}if($$self.$$.dirty[0]&/*shouldRenderShapeManipulator, allowRotateControls, shapeManipulatorPoints, activeMarkupComputed*/29696|$$self.$$.dirty[1]&/*opacity*/1073741824){// TODO: we use opacity to trigger a redraw of the active points,
// this should be changed to the image zoom factor in a future release
$$invalidate(140,shapeManipulatorRotationPoint=shouldRenderShapeManipulator&&allowRotateControls&&opacity&&shapeManipulatorPoints&&getShapeRotationPointOnScreen(activeMarkupComputed));}if($$self.$$.dirty[0]&/*offset*/4|$$self.$$.dirty[4]&/*shapeManipulatorRotationPoint*/65536){$$invalidate(25,shapeManipulatorRotationPointPosition=shapeManipulatorRotationPoint&&vectorCreate(shapeManipulatorRotationPoint.position.x-offset.x,shapeManipulatorRotationPoint.position.y-offset.y));}if($$self.$$.dirty[3]&/*activeMarkup, pointerPositionInEditor*/1207959552|$$self.$$.dirty[4]&/*activeShapeIsDraft*/1024){$$invalidate(138,currentPointerPosition=activeShapeIsDraft&&shapeIsPath(activeMarkup)&&pointerPositionInEditor);}if($$self.$$.dirty[1]&/*opacity*/1073741824|$$self.$$.dirty[3]&/*activeMarkup*/1073741824|$$self.$$.dirty[4]&/*shapeActiveScreenPoints, currentPointerPosition*/49152){// add contextPresentationRect so we redraw active markup each frame
if(activeMarkup&&shapeActiveScreenPoints&&opacity>0){redrawManipulatorLines(opacity,activeMarkup,currentPointerPosition);}}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824){if(!activeMarkup){removeMarkupManipulatorLines();}}if($$self.$$.dirty[1]&/*active*/536870912){togglePrerender(active);}if($$self.$$.dirty[0]&/*textInput, textInputMode*/144){// auto focus text input when created and in inline mode
if(textInput&&textInputMode==='inline')textInput.focus();}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824){$$invalidate(137,isTextMarkupSelected=activeMarkup&&shapeIsText(activeMarkup));}if($$self.$$.dirty[3]&/*activeMarkup*/1073741824|$$self.$$.dirty[4]&/*isTextMarkupSelected*/8192){$$invalidate(11,shouldRenderTextInput=isTextMarkupSelected&&shapeCanInput(activeMarkup)!==false&&shapeIsTextEditing(activeMarkup));}if($$self.$$.dirty[0]&/*shouldRenderTextInput*/2048){$$invalidate(133,textShapeOrigin=shouldRenderTextInput?getTextShapeOriginSnapshot():undefined);}if($$self.$$.dirty[2]&/*parentRect*/1|$$self.$$.dirty[4]&/*textShapeOrigin*/512){$$invalidate(135,textShapeDisplayOrigin=textShapeOrigin&&shapeComputeDisplay(_objectSpread({},textShapeOrigin),parentRect));}if($$self.$$.dirty[4]&/*textShapeDisplayOrigin*/2048){$$invalidate(136,textSizeDisplayOrigin=textShapeDisplayOrigin&&textToSize(textShapeDisplayOrigin.text,textShapeDisplayOrigin));}if($$self.$$.dirty[4]&/*textShapeDisplayOrigin, textSizeDisplayOrigin*/6144){textRectDisplayOrigin=textShapeDisplayOrigin&&rectCreate(textShapeDisplayOrigin.x,textShapeDisplayOrigin.y,textSizeDisplayOrigin.width,textSizeDisplayOrigin.height);}if($$self.$$.dirty[0]&/*shouldRenderTextInput*/2048|$$self.$$.dirty[3]&/*activeMarkup*/1073741824){$$invalidate(22,textInputText=shouldRenderTextInput?activeMarkup.text:'');}if($$self.$$.dirty[0]&/*shouldRenderTextInput, activeMarkupComputed, textInputMode*/6160){$$invalidate(24,textInputTextStyles=shouldRenderTextInput&&getTextInputTextStyles(activeMarkupComputed,textInputMode));}if($$self.$$.dirty[0]&/*shouldRenderTextInput, activeMarkupComputed, offset*/6148|$$self.$$.dirty[1]&/*contextZoom, contextRotation*/301989888){$$invalidate(23,textInputPositionStyles=shouldRenderTextInput&&getTextInputPositionStyles(activeMarkupComputed,offset,contextZoom,contextRotation));}if($$self.$$.dirty[0]&/*shouldRenderTextInput, textInput, textInputMode*/2192){if(shouldRenderTextInput&&textInput&&textInputMode==='inline')syncTextInput();}if($$self.$$.dirty[3]&/*activeMarkup, activeMarkupItemIsDraft*/1342177280|$$self.$$.dirty[4]&/*controlledMarkupItem*/8){$$invalidate(127,controlledMarkupItem=activeMarkup&&!activeMarkupItemIsDraft?activeMarkup:controlledMarkupItem);}if($$self.$$.dirty[4]&/*controlledMarkupItem*/8){$$invalidate(129,allowShapeFlip=controlledMarkupItem&&shapeCanFlip(controlledMarkupItem));}if($$self.$$.dirty[4]&/*controlledMarkupItem*/8){$$invalidate(124,allowShapeChangeTextLayout=controlledMarkupItem&&shapeCanChangeTextLayout(controlledMarkupItem));}if($$self.$$.dirty[4]&/*controlledMarkupItem*/8){$$invalidate(126,allowShapeDuplicate=controlledMarkupItem&&shapeCanDuplicate(controlledMarkupItem));}if($$self.$$.dirty[4]&/*controlledMarkupItem*/8){$$invalidate(125,allowShapeRemove=controlledMarkupItem&&shapeCanRemove(controlledMarkupItem));}if($$self.$$.dirty[4]&/*controlledMarkupItem*/8){$$invalidate(128,allowShapeReorder=controlledMarkupItem&&shapeCanReorder(controlledMarkupItem));}if($$self.$$.dirty[4]&/*controlledMarkupItem*/8){$$invalidate(122,allowShapeInput=controlledMarkupItem&&shapeCanInput(controlledMarkupItem)!==false);}if($$self.$$.dirty[4]&/*controlledMarkupItem*/8){$$invalidate(130,allowShapeAdjustOpacity=controlledMarkupItem&&hasProp(controlledMarkupItem,'backgroundImage')&&shapeCanStyle(controlledMarkupItem,'opacity'));}if($$self.$$.dirty[0]&/*shouldRenderTextInput*/2048|$$self.$$.dirty[3]&/*activeMarkup, activeMarkupItemIsDraft, isInteracting*/1375731712|$$self.$$.dirty[4]&/*$isAnimated*/1048576){markupControlsOpacity.set(activeMarkup&&!activeMarkupItemIsDraft&&!isInteracting&&!shouldRenderTextInput?1:0,{hard:$isAnimated===false});}if($$self.$$.dirty[0]&/*shapeManipulatorPoints*/1024|$$self.$$.dirty[3]&/*activeMarkup, activeMarkupItemIsDraft*/1342177280|$$self.$$.dirty[4]&/*markupControlsAnchorPosition*/256){$$invalidate(132,markupControlsAnchorPosition=activeMarkup&&!activeMarkupItemIsDraft&&shapeManipulatorPoints.length?getMarkupControlsAnchorPosition(rectCreateFromPoints(shapeManipulatorPoints)):markupControlsAnchorPosition);}if($$self.$$.dirty[0]&/*shapeControlsSize*/256|$$self.$$.dirty[2]&/*utilRect*/2|$$self.$$.dirty[4]&/*markupControlsAnchorPosition*/256){$$invalidate(131,shapeControlsPosition=markupControlsAnchorPosition&&shapeControlsSize&&utilRect&&getShapeControlPositionOnCanvas(markupControlsAnchorPosition));}if($$self.$$.dirty[0]&/*$markupControlsOpacity*/65536|$$self.$$.dirty[4]&/*shapeControlsPosition*/128){$$invalidate(21,markupControlsStyle=shapeControlsPosition&&"transform: translate(".concat(shapeControlsPosition.x,"px, ").concat(shapeControlsPosition.y,"px);opacity:").concat($markupControlsOpacity));}if($$self.$$.dirty[0]&/*activeShapeId, locale, markup*/545|$$self.$$.dirty[2]&/*willRenderShapeControls, enableButtonFlipVertical*/68157440|$$self.$$.dirty[3]&/*activeMarkup, allowShapeInput*/1610612736|$$self.$$.dirty[4]&/*allowShapeAdjustOpacity, allowShapeFlip, allowShapeReorder, controlledMarkupItem, allowShapeDuplicate, allowShapeRemove, allowShapeChangeTextLayout*/127){$$invalidate(20,shapeControls=activeShapeId&&willRenderShapeControls&&runSafe(function(){return willRenderShapeControls([allowShapeAdjustOpacity&&['div','alpha',{"class":'PinturaShapeControlsGroup'},[['Slider','adjust-opacity',{onrelease:handleConfirmOpacity,onchange:handleAdjustOpacity,step:0.01,value:hasProp(activeMarkup,'opacity')?activeMarkup.opacity:1,label:function label(value,min,max){return"".concat(Math.round(value/max*100),"%");},min:0,max:1,direction:'x'}]]],['div','beta',{"class":'PinturaShapeControlsGroup'},[allowShapeFlip&&['Button','flip-horizontal',{onclick:handleFlipX,label:locale.shapeTitleButtonFlipHorizontal,icon:locale.shapeIconButtonFlipHorizontal,hideLabel:true}],allowShapeFlip&&enableButtonFlipVertical&&['Button','flip-vertical',{onclick:handleFlipY,label:locale.shapeTitleButtonFlipVertical,icon:locale.shapeIconButtonFlipVertical,hideLabel:true}],allowShapeReorder&&['Button','to-front',{onclick:handleMoveToFrontActiveMarkup,label:locale.shapeTitleButtonMoveToFront,icon:locale.shapeIconButtonMoveToFront,hideLabel:true,disabled:markup[markup.length-1]===controlledMarkupItem}],allowShapeDuplicate&&['Button','duplicate',{onclick:handleDuplicateActiveMarkup,label:locale.shapeTitleButtonDuplicate,icon:locale.shapeIconButtonDuplicate,hideLabel:true}],allowShapeRemove&&['Button','remove',{onclick:handleRemoveActiveMarkup,label:locale.shapeTitleButtonRemove,icon:locale.shapeIconButtonRemove,hideLabel:true}]].filter(Boolean)],allowShapeInput&&allowShapeChangeTextLayout&&['div','gamma',{"class":'PinturaShapeControlsGroup'},[['Button','text-layout',{onclick:handleTextSwitchLayout,label:localize(TextLayoutChangeLabel,locale,activeMarkup),icon:localize(TextLayoutChangeIcon,locale,activeMarkup),hideLabel:true}]]],allowShapeInput&&['div','delta',{"class":'PinturaShapeControlsGroup'},[['Button','edit-text',{label:locale.shapeLabelInputText,onclick:handleEditTextActiveMarkup}]]]].filter(Boolean),activeShapeId);}));}if($$self.$$.dirty[0]&/*markup, locale*/33){$$invalidate(19,shapeNavList=markup.filter(shapeCanSelect).filter(function(shape){return!shapeIsDraft(shape);}).map(function(shape){return{id:shape.id,color:shapeIsText(shape)?shape.color:shapeIsLine(shape)?shape.strokeColor:shape.backgroundColor,name:shape.name||locale["shapeLabelTool".concat(capitalizeFirstLetter(shapeGetDescription(shape)))]};}));}};return[markup,disabled,offset,rootRect,textInputMode,locale,selectShape,textInput,shapeControlsSize,activeShapeId,shapeManipulatorPoints,shouldRenderTextInput,activeMarkupComputed,allowRotateControls,shouldRenderShapeManipulator,allowEdgeControls,$markupControlsOpacity,showShapeList,element,shapeNavList,shapeControls,markupControlsStyle,textInputText,textInputPositionStyles,textInputTextStyles,shapeManipulatorRotationPointPosition,shapeAllowNewline,allowCornerControls,isAnimated,keysPressedStored,handleInteractionStart,handleInteractionCancel,handleInteractionUpdate,handleInteractionRelease,handleInteractionEnd,handleManipulatorResizeGrab,handleManipulatorResizeDrag,handleManipulatorResizeEnd,handleManipulatorRotateGrab,handleManipulatorRotateDrag,handleManipulatorRotateEnd,handleKey,formatContentEditable,handleTextInput,handleTextInputAttempt,handleTextInputKeyDown,handleTextInputKeyUp,handleTextConfirm,handleTextCancel,markupControlsOpacity,handleNudge,handleFocusIn,handleFocusOut,handlePointerMove,ui,uid,contextRotation,contextFlipX,contextFlipY,contextZoom,active,opacity,parentRect,utilRect,hoverColor,oninteractionstart,oninteractionupdate,oninteractionrelease,oninteractionend,oninteractioncancel,onaddshape,onupdateshape,onselectshape,onremoveshape,ontapshape,onhovershape,onhovercanvas,ontapcanvas,beforeSelectShape,beforeDeselectShape,beforeRemoveShape,beforeUpdateShape,willRenderShapeControls,willStartInteraction,mapEditorPointToImagePoint,mapImagePointToEditorPoint,eraseRadius,selectRadius,enableButtonFlipVertical,enableTapToAddText,createShape,eraseShape,getMarkupItemDraft,getMarkupItemDraftIndex,addMarkupItemDraft,confirmMarkupItemDraft,discardMarkupItemDraft,createMarkupItem,syncShapes,addShape,removeMarkupShapeProps,updateMarkupShape,updateMarkupShapeProperty,updateMarkupItemsShapeProperty,updateMarkupShapeItems,getActiveMarkupItem,hasActiveMarkupItem,removeShape,removeActiveMarkupItem,blurShapes,deselectMarkupItem,editMarkupItem,finishEditMarkupItem,removeMarkupItems,getTextShapeRect,getMarkupShapeRect,getShapesNearPosition,getShapesBetweenPoints,isInteracting,hoverShape,pointerPositionInEditor,activeMarkupItemIsDraft,allowShapeInput,activeMarkup,allowShapeChangeTextLayout,allowShapeRemove,allowShapeDuplicate,controlledMarkupItem,allowShapeReorder,allowShapeFlip,allowShapeAdjustOpacity,shapeControlsPosition,markupControlsAnchorPosition,textShapeOrigin,activeShapeIsDraft,textShapeDisplayOrigin,textSizeDisplayOrigin,isTextMarkupSelected,currentPointerPosition,shapeActiveScreenPoints,shapeManipulatorRotationPoint,shapeActivePoints,activeMarkupSelected,allowResizeControls,$isAnimated,measure_handler,click_handler,textarea_binding,textarea_input_handler,contenteditable_binding,focusout_handler,measure_handler_1,div_binding,interactable_function_1];}var ShapeLayoutEditor=/*#__PURE__*/function(_SvelteComponent38){_inherits(ShapeLayoutEditor,_SvelteComponent38);var _super39=_createSuper(ShapeLayoutEditor);function ShapeLayoutEditor(options){var _this40;_classCallCheck(this,ShapeLayoutEditor);_this40=_super39.call(this);init(_assertThisInitialized(_this40),options,instance$g,create_fragment$g,safe_not_equal,{uid:55,ui:54,disabled:1,markup:0,offset:2,contextRotation:56,contextFlipX:57,contextFlipY:58,contextZoom:59,active:60,opacity:61,parentRect:62,rootRect:3,utilRect:63,hoverColor:64,textInputMode:4,oninteractionstart:65,oninteractionupdate:66,oninteractionrelease:67,oninteractionend:68,oninteractioncancel:69,onaddshape:70,onupdateshape:71,onselectshape:72,onremoveshape:73,ontapshape:74,onhovershape:75,onhovercanvas:76,ontapcanvas:77,beforeSelectShape:78,beforeDeselectShape:79,beforeRemoveShape:80,beforeUpdateShape:81,willRenderShapeControls:82,willStartInteraction:83,mapEditorPointToImagePoint:84,mapImagePointToEditorPoint:85,eraseRadius:86,selectRadius:87,enableButtonFlipVertical:88,enableTapToAddText:89,locale:5,createShape:90,eraseShape:91,getMarkupItemDraft:92,getMarkupItemDraftIndex:93,addMarkupItemDraft:94,confirmMarkupItemDraft:95,discardMarkupItemDraft:96,createMarkupItem:97,syncShapes:98,addShape:99,removeMarkupShapeProps:100,updateMarkupShape:101,updateMarkupShapeProperty:102,updateMarkupItemsShapeProperty:103,updateMarkupShapeItems:104,getActiveMarkupItem:105,hasActiveMarkupItem:106,removeShape:107,removeActiveMarkupItem:108,blurShapes:109,selectShape:6,deselectMarkupItem:110,editMarkupItem:111,finishEditMarkupItem:112,removeMarkupItems:113,getTextShapeRect:114,getMarkupShapeRect:115,getShapesNearPosition:116,getShapesBetweenPoints:117},null,[-1,-1,-1,-1,-1,-1,-1,-1]);return _this40;}_createClass(ShapeLayoutEditor,[{key:"createShape",get:function get(){return this.$$.ctx[90];}},{key:"eraseShape",get:function get(){return this.$$.ctx[91];}},{key:"getMarkupItemDraft",get:function get(){return this.$$.ctx[92];}},{key:"getMarkupItemDraftIndex",get:function get(){return this.$$.ctx[93];}},{key:"addMarkupItemDraft",get:function get(){return this.$$.ctx[94];}},{key:"confirmMarkupItemDraft",get:function get(){return this.$$.ctx[95];}},{key:"discardMarkupItemDraft",get:function get(){return this.$$.ctx[96];}},{key:"createMarkupItem",get:function get(){return this.$$.ctx[97];}},{key:"syncShapes",get:function get(){return this.$$.ctx[98];}},{key:"addShape",get:function get(){return this.$$.ctx[99];}},{key:"removeMarkupShapeProps",get:function get(){return this.$$.ctx[100];}},{key:"updateMarkupShape",get:function get(){return this.$$.ctx[101];}},{key:"updateMarkupShapeProperty",get:function get(){return this.$$.ctx[102];}},{key:"updateMarkupItemsShapeProperty",get:function get(){return this.$$.ctx[103];}},{key:"updateMarkupShapeItems",get:function get(){return this.$$.ctx[104];}},{key:"getActiveMarkupItem",get:function get(){return this.$$.ctx[105];}},{key:"hasActiveMarkupItem",get:function get(){return this.$$.ctx[106];}},{key:"removeShape",get:function get(){return this.$$.ctx[107];}},{key:"removeActiveMarkupItem",get:function get(){return this.$$.ctx[108];}},{key:"blurShapes",get:function get(){return this.$$.ctx[109];}},{key:"selectShape",get:function get(){return this.$$.ctx[6];}},{key:"deselectMarkupItem",get:function get(){return this.$$.ctx[110];}},{key:"editMarkupItem",get:function get(){return this.$$.ctx[111];}},{key:"finishEditMarkupItem",get:function get(){return this.$$.ctx[112];}},{key:"removeMarkupItems",get:function get(){return this.$$.ctx[113];}},{key:"getTextShapeRect",get:function get(){return this.$$.ctx[114];}},{key:"getMarkupShapeRect",get:function get(){return this.$$.ctx[115];}},{key:"getShapesNearPosition",get:function get(){return this.$$.ctx[116];}},{key:"getShapesBetweenPoints",get:function get(){return this.$$.ctx[117];}}]);return ShapeLayoutEditor;}(SvelteComponent);/* src/core/ui/components/ShapeStyleControls.svelte generated by Svelte v3.52.0 */function get_each_context$2(ctx,list,i){var child_ctx=ctx.slice();child_ctx[9]=list[i];return child_ctx;}// (25:12) {#each controls as control (control.id)}
function create_each_block$2(key_1,ctx){var li;var span;var t0_value=localize(/*control*/ctx[9].componentProps.title,/*locale*/ctx[1])+"";var t0;var t1;var switch_instance;var t2;var current;var switch_instance_spread_levels=[/*control*/ctx[9].componentProps];var switch_value=/*control*/ctx[9].component;function switch_props(ctx){var switch_instance_props={};for(var i=0;i<switch_instance_spread_levels.length;i+=1){switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);}return{props:switch_instance_props};}if(switch_value){switch_instance=construct_svelte_component(switch_value,switch_props());}return{key:key_1,first:null,c:function c(){li=element("li");span=element("span");t0=text(t0_value);t1=space();if(switch_instance)create_component(switch_instance.$$.fragment);t2=space();attr(span,"class","PinturaShapeStyleLabel");attr(li,"class","PinturaShapeStyle");this.first=li;},m:function m(target,anchor){insert(target,li,anchor);append(li,span);append(span,t0);append(li,t1);if(switch_instance)mount_component(switch_instance,li,null);append(li,t2);current=true;},p:function p(new_ctx,dirty){ctx=new_ctx;if((!current||dirty&/*controls, locale*/3)&&t0_value!==(t0_value=localize(/*control*/ctx[9].componentProps.title,/*locale*/ctx[1])+""))set_data(t0,t0_value);var switch_instance_changes=dirty&/*controls*/1?get_spread_update(switch_instance_spread_levels,[get_spread_object(/*control*/ctx[9].componentProps)]):{};if(switch_value!==(switch_value=/*control*/ctx[9].component)){if(switch_instance){group_outros();var old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,function(){destroy_component(old_component,1);});check_outros();}if(switch_value){switch_instance=construct_svelte_component(switch_value,switch_props());create_component(switch_instance.$$.fragment);transition_in(switch_instance.$$.fragment,1);mount_component(switch_instance,li,t2);}else{switch_instance=null;}}else if(switch_value){switch_instance.$set(switch_instance_changes);}},i:function i(local){if(current)return;if(switch_instance)transition_in(switch_instance.$$.fragment,local);current=true;},o:function o(local){if(switch_instance)transition_out(switch_instance.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(li);if(switch_instance)destroy_component(switch_instance);}};}// (23:4) <Scrollable class="PinturaShapeStyles" elasticity={scrollElasticity}>
function create_default_slot$6(ctx){var ul;var each_blocks=[];var each_1_lookup=new Map();var current;var each_value=/*controls*/ctx[0];var get_key=function get_key(ctx){return(/*control*/ctx[9].id);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$2(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$2(key,child_ctx));}return{c:function c(){ul=element("ul");for(var _i39=0;_i39<each_blocks.length;_i39+=1){each_blocks[_i39].c();}attr(ul,"class","PinturaShapeStyleList");},m:function m(target,anchor){insert(target,ul,anchor);for(var _i40=0;_i40<each_blocks.length;_i40+=1){each_blocks[_i40].m(ul,null);}current=true;},p:function p(ctx,dirty){if(dirty&/*controls, localize, locale*/3){each_value=/*controls*/ctx[0];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value,each_1_lookup,ul,outro_and_destroy_block,create_each_block$2,null,get_each_context$2);check_outros();}},i:function i(local){if(current)return;for(var _i41=0;_i41<each_value.length;_i41+=1){transition_in(each_blocks[_i41]);}current=true;},o:function o(local){for(var _i42=0;_i42<each_blocks.length;_i42+=1){transition_out(each_blocks[_i42]);}current=false;},d:function d(detaching){if(detaching)detach(ul);for(var _i43=0;_i43<each_blocks.length;_i43+=1){each_blocks[_i43].d();}}};}function create_fragment$f(ctx){var div;var scrollable;var current;scrollable=new Scrollable({props:{"class":"PinturaShapeStyles",elasticity:/*scrollElasticity*/ctx[2],$$slots:{"default":[create_default_slot$6]},$$scope:{ctx:ctx}}});return{c:function c(){div=element("div");create_component(scrollable.$$.fragment);attr(div,"style",/*style*/ctx[3]);},m:function m(target,anchor){insert(target,div,anchor);mount_component(scrollable,div,null);current=true;},p:function p(ctx,_ref413){var _ref414=_slicedToArray(_ref413,1),dirty=_ref414[0];var scrollable_changes={};if(dirty&/*scrollElasticity*/4)scrollable_changes.elasticity=/*scrollElasticity*/ctx[2];if(dirty&/*$$scope, controls, locale*/4099){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);if(!current||dirty&/*style*/8){attr(div,"style",/*style*/ctx[3]);}},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(scrollable);}};}function instance$f($$self,$$props,$$invalidate){var style;var $opacity;var $isAnimated;var _$$props$isActive3=$$props.isActive,isActive=_$$props$isActive3===void 0?false:_$$props$isActive3;var _$$props$controls=$$props.controls,controls=_$$props$controls===void 0?[]:_$$props$controls;var locale=$$props.locale;var scrollElasticity=$$props.scrollElasticity;// context
var isAnimated=getContext('isAnimated');component_subscribe($$self,isAnimated,function(value){return $$invalidate(8,$isAnimated=value);});var opacity=spring(0,{stiffness:0.25,damping:0.9});component_subscribe($$self,opacity,function(value){return $$invalidate(7,$opacity=value);});$$self.$$set=function($$props){if('isActive'in $$props)$$invalidate(6,isActive=$$props.isActive);if('controls'in $$props)$$invalidate(0,controls=$$props.controls);if('locale'in $$props)$$invalidate(1,locale=$$props.locale);if('scrollElasticity'in $$props)$$invalidate(2,scrollElasticity=$$props.scrollElasticity);};$$self.$$.update=function(){if($$self.$$.dirty&/*isActive, $isAnimated*/320){opacity.set(isActive?1:0,{hard:$isAnimated===false});}if($$self.$$.dirty&/*$opacity, isActive*/192){$$invalidate(3,style="opacity:".concat($opacity,";").concat(!isActive?'pointer-events:none;':'').concat($opacity<=0?'visibility:hidden':''));}};return[controls,locale,scrollElasticity,style,isAnimated,opacity,isActive,$opacity,$isAnimated];}var ShapeStyleControls=/*#__PURE__*/function(_SvelteComponent39){_inherits(ShapeStyleControls,_SvelteComponent39);var _super40=_createSuper(ShapeStyleControls);function ShapeStyleControls(options){var _this41;_classCallCheck(this,ShapeStyleControls);_this41=_super40.call(this);init(_assertThisInitialized(_this41),options,instance$f,create_fragment$f,safe_not_equal,{isActive:6,controls:0,locale:1,scrollElasticity:2});return _this41;}return _createClass(ShapeStyleControls);}(SvelteComponent);/* src/core/ui/components/ShapeStyleEditor.svelte generated by Svelte v3.52.0 */function get_each_context$1(ctx,list,i){var child_ctx=ctx.slice();child_ctx[12]=list[i].key;child_ctx[3]=list[i].controls;child_ctx[13]=list[i].isActive;return child_ctx;}// (143:4) {#each currentStyleControlSets as { key, controls, isActive }
function create_each_block$1(key_1,ctx){var first;var shapestylecontrols;var current;shapestylecontrols=new ShapeStyleControls({props:{isActive:/*isActive*/ctx[13],controls:/*controls*/ctx[3],locale:/*locale*/ctx[1],scrollElasticity:/*scrollElasticity*/ctx[2]}});return{key:key_1,first:null,c:function c(){first=empty();create_component(shapestylecontrols.$$.fragment);this.first=first;},m:function m(target,anchor){insert(target,first,anchor);mount_component(shapestylecontrols,target,anchor);current=true;},p:function p(new_ctx,dirty){ctx=new_ctx;var shapestylecontrols_changes={};if(dirty&/*currentStyleControlSets*/16)shapestylecontrols_changes.isActive=/*isActive*/ctx[13];if(dirty&/*currentStyleControlSets*/16)shapestylecontrols_changes.controls=/*controls*/ctx[3];if(dirty&/*locale*/2)shapestylecontrols_changes.locale=/*locale*/ctx[1];if(dirty&/*scrollElasticity*/4)shapestylecontrols_changes.scrollElasticity=/*scrollElasticity*/ctx[2];shapestylecontrols.$set(shapestylecontrols_changes);},i:function i(local){if(current)return;transition_in(shapestylecontrols.$$.fragment,local);current=true;},o:function o(local){transition_out(shapestylecontrols.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(first);destroy_component(shapestylecontrols,detaching);}};}function create_fragment$e(ctx){var div;var each_blocks=[];var each_1_lookup=new Map();var div_class_value;var current;var each_value=/*currentStyleControlSets*/ctx[4];var get_key=function get_key(ctx){return(/*key*/ctx[12]);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context$1(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block$1(key,child_ctx));}return{c:function c(){div=element("div");for(var _i44=0;_i44<each_blocks.length;_i44+=1){each_blocks[_i44].c();}attr(div,"class",div_class_value=arrayJoin(['PinturaShapeStyleEditor',/*klass*/ctx[0]]));},m:function m(target,anchor){insert(target,div,anchor);for(var _i45=0;_i45<each_blocks.length;_i45+=1){each_blocks[_i45].m(div,null);}current=true;},p:function p(ctx,_ref415){var _ref416=_slicedToArray(_ref415,1),dirty=_ref416[0];if(dirty&/*currentStyleControlSets, locale, scrollElasticity*/22){each_value=/*currentStyleControlSets*/ctx[4];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value,each_1_lookup,div,outro_and_destroy_block,create_each_block$1,null,get_each_context$1);check_outros();}if(!current||dirty&/*klass*/1&&div_class_value!==(div_class_value=arrayJoin(['PinturaShapeStyleEditor',/*klass*/ctx[0]]))){attr(div,"class",div_class_value);}},i:function i(local){if(current)return;for(var _i46=0;_i46<each_value.length;_i46+=1){transition_in(each_blocks[_i46]);}current=true;},o:function o(local){for(var _i47=0;_i47<each_blocks.length;_i47+=1){transition_out(each_blocks[_i47]);}current=false;},d:function d(detaching){if(detaching)detach(div);for(var _i48=0;_i48<each_blocks.length;_i48+=1){each_blocks[_i48].d();}}};}function instance$e($$self,$$props,$$invalidate){var controlKeys;var activeControls;var currentStyleControlSets;var _$$props$class15=$$props["class"],klass=_$$props$class15===void 0?undefined:_$$props$class15;var _$$props$controls2=$$props.controls,controls=_$$props$controls2===void 0?{}:_$$props$controls2;var _$$props$shape=$$props.shape,shape=_$$props$shape===void 0?undefined:_$$props$shape;var _onchange=$$props.onchange;var locale=$$props.locale;var scrollElasticity=$$props.scrollElasticity;var getShapeControls=function getShapeControls(shape){var activeControls=controlKeys.filter(function(styleKey){return styleKey.split('_').every(function(styleKey){return(// shape needs to have the property
hasProp(shape,styleKey)&&// shape needs to be able to style the property
shapeCanStyle(shape,styleKey));});}).map(function(styleKey){var styleKeys=styleKey.split('_');var currentValue=styleKeys.length>1?styleKeys.map(function(key){return shape[key];}):shape[styleKey];var _controls$styleKey=_slicedToArray(controls[styleKey],2),component=_controls$styleKey[0],componentProps=_controls$styleKey[1];// is reference to other control or string representation of component
if(isString(component)){// exif if not a valid default control
if(controls[component]){// create component based on reference
var componentCustomProps=_objectSpread({},componentProps);var _controls$component=_slicedToArray(controls[component],2);component=_controls$component[0];componentProps=_controls$component[1];componentProps=_objectSpread(_objectSpread({},componentProps),componentCustomProps);}else if(component==='Dropdown'){component=Dropdown;}else{// skip
return;}}var options=isFunction(componentProps.options)?componentProps.options(shape):componentProps.options;return{id:styleKey,component:component,componentProps:_objectSpread(_objectSpread({},componentProps),{},{// set the options prop
options:options,// defaults
locale:locale,value:currentValue,optionLabelClass:'PinturaButtonLabel',onchange:function onchange(detail){var value=isObject(detail)&&!isArray(detail)?detail.value:detail;// allow custom changes
if(componentProps.onchange)componentProps.onchange(value,shape);// internal change
var props=styleKeys.length>1?styleKeys.reduce(function(prev,key,index){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},key,Array.isArray(value)?value[index]:value));},{}):_defineProperty({},styleKey,value);_onchange(props);}})};}).filter(Boolean);return activeControls;};var styleControlSets=[];var getStyleControlSets=function getStyleControlSets(key,controls){var controlSet=styleControlSets.find(function(controlSet){return controlSet.key===key;});if(!controlSet){// create
controlSet={key:key,controls:controls};// add
styleControlSets.push(controlSet);}// hide all
styleControlSets.forEach(function(controlSet){return controlSet.isActive=false;});// update active controls
controlSet.controls=controls;// show active
controlSet.isActive=true;return styleControlSets;};$$self.$$set=function($$props){if('class'in $$props)$$invalidate(0,klass=$$props["class"]);if('controls'in $$props)$$invalidate(3,controls=$$props.controls);if('shape'in $$props)$$invalidate(5,shape=$$props.shape);if('onchange'in $$props)$$invalidate(6,_onchange=$$props.onchange);if('locale'in $$props)$$invalidate(1,locale=$$props.locale);if('scrollElasticity'in $$props)$$invalidate(2,scrollElasticity=$$props.scrollElasticity);};$$self.$$.update=function(){if($$self.$$.dirty&/*controls*/8){// finds the controls needed to style the selected shape
$$invalidate(8,controlKeys=Object.keys(controls).filter(function(key){return controls[key];}));}if($$self.$$.dirty&/*shape, controlKeys*/288){$$invalidate(7,activeControls=shape&&Object.keys(shape).length&&controlKeys&&shapeCanStyle(shape)?getShapeControls(shape):[]);}if($$self.$$.dirty&/*shape, activeControls*/160){$$invalidate(4,currentStyleControlSets=getStyleControlSets(shape&&Object.keys(shape).length?Object.keys(shape).join('_'):'none',activeControls||[]));}};return[klass,locale,scrollElasticity,controls,currentStyleControlSets,shape,_onchange,activeControls,controlKeys];}var ShapeStyleEditor=/*#__PURE__*/function(_SvelteComponent40){_inherits(ShapeStyleEditor,_SvelteComponent40);var _super41=_createSuper(ShapeStyleEditor);function ShapeStyleEditor(options){var _this42;_classCallCheck(this,ShapeStyleEditor);_this42=_super41.call(this);init(_assertThisInitialized(_this42),options,instance$e,create_fragment$e,safe_not_equal,{"class":0,controls:3,shape:5,onchange:6,locale:1,scrollElasticity:2});return _this42;}return _createClass(ShapeStyleEditor);}(SvelteComponent);/* src/core/ui/components/DragButton.svelte generated by Svelte v3.52.0 */var document_1$1=globals.document;function create_fragment$d(ctx){var t;var button;var mounted;var dispose;return{c:function c(){t=space();button=element("button");attr(button,"class","PinturaDragButton");attr(button,"type","button");attr(button,"title",/*title*/ctx[1]);button.disabled=/*disabled*/ctx[2];},m:function m(target,anchor){insert(target,t,anchor);insert(target,button,anchor);button.innerHTML=/*html*/ctx[0];/*button_binding*/ctx[11](button);if(!mounted){dispose=[listen(document_1$1.body,"load",/*handleLoad*/ctx[5],true),listen(document_1$1.body,"error",/*handleError*/ctx[6],true),listen(button,"pointerdown",/*handleDown*/ctx[4])];mounted=true;}},p:function p(ctx,_ref417){var _ref418=_slicedToArray(_ref417,1),dirty=_ref418[0];if(dirty&/*html*/1)button.innerHTML=/*html*/ctx[0];if(dirty&/*title*/2){attr(button,"title",/*title*/ctx[1]);}if(dirty&/*disabled*/4){button.disabled=/*disabled*/ctx[2];}},i:noop,o:noop,d:function d(detaching){if(detaching)detach(t);if(detaching)detach(button);/*button_binding*/ctx[11](null);mounted=false;run_all(dispose);}};}function instance$d($$self,$$props,$$invalidate){var html=$$props.html;var title=$$props.title;var onclick=$$props.onclick;var _$$props$disabled5=$$props.disabled,disabled=_$$props$disabled5===void 0?false:_$$props$disabled5;var _$$props$ongrab2=$$props.ongrab,ongrab=_$$props$ongrab2===void 0?noop$1:_$$props$ongrab2;var _$$props$ondrag=$$props.ondrag,ondrag=_$$props$ondrag===void 0?noop$1:_$$props$ondrag;var _$$props$ondrop=$$props.ondrop,ondrop=_$$props$ondrop===void 0?noop$1:_$$props$ondrop;var element;var isOverButton=function isOverButton(e){return vectorDistanceSquared(downPosition,vectorCreate(e.pageX,e.pageY))<256;};var downPosition;var handleDown=function handleDown(e){downPosition=vectorCreate(e.pageX,e.pageY);ongrab(e);document.documentElement.addEventListener('pointermove',handleMove);document.documentElement.addEventListener('pointerup',handleUp);};var handleUp=function handleUp(e){document.documentElement.removeEventListener('pointermove',handleMove);document.documentElement.removeEventListener('pointerup',handleUp);var upPosition=vectorCreate(e.pageX,e.pageY);// must have moved enough distance to drop
if(vectorDistanceSquared(downPosition,upPosition)<32)return onclick(e);// cant drop in button /
if(isOverButton(e))return;// was dragging
ondrop(e);};var handleMove=function handleMove(e){// must have moved enough distance from button
if(isOverButton(e))return;// dragging out of button
ondrag(e);};// image loading
var isImageTarget=function isImageTarget(target){return element&&element.contains(target)&&target.nodeName==='IMG';};var handleLoad=function handleLoad(_ref419){var target=_ref419.target;if(!isImageTarget(target))return;$$invalidate(3,element.dataset.load=true,element);};var handleError=function handleError(_ref420){var target=_ref420.target;if(!isImageTarget(target))return;$$invalidate(3,element.dataset.error=true,element);};function button_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){element=$$value;$$invalidate(3,element);});}$$self.$$set=function($$props){if('html'in $$props)$$invalidate(0,html=$$props.html);if('title'in $$props)$$invalidate(1,title=$$props.title);if('onclick'in $$props)$$invalidate(7,onclick=$$props.onclick);if('disabled'in $$props)$$invalidate(2,disabled=$$props.disabled);if('ongrab'in $$props)$$invalidate(8,ongrab=$$props.ongrab);if('ondrag'in $$props)$$invalidate(9,ondrag=$$props.ondrag);if('ondrop'in $$props)$$invalidate(10,ondrop=$$props.ondrop);};$$self.$$.update=function(){if($$self.$$.dirty&/*element*/8){if(element&&element.querySelector('img'))$$invalidate(3,element.dataset.loader=true,element);}};return[html,title,disabled,element,handleDown,handleLoad,handleError,onclick,ongrab,ondrag,ondrop,button_binding];}var DragButton=/*#__PURE__*/function(_SvelteComponent41){_inherits(DragButton,_SvelteComponent41);var _super42=_createSuper(DragButton);function DragButton(options){var _this43;_classCallCheck(this,DragButton);_this43=_super42.call(this);init(_assertThisInitialized(_this43),options,instance$d,create_fragment$d,safe_not_equal,{html:0,title:1,onclick:7,disabled:2,ongrab:8,ondrag:9,ondrop:10});return _this43;}return _createClass(DragButton);}(SvelteComponent);/* src/core/ui/components/ShapePresetsList.svelte generated by Svelte v3.52.0 */function get_each_context(ctx,list,i){var child_ctx=ctx.slice();child_ctx[14]=list[i];return child_ctx;}// (25:4) {#each presets as preset (preset.id)}
function create_each_block(key_1,ctx){var li;var dragbutton;var t;var didMountPresetThumb_action;var current;var mounted;var dispose;function func(){return(/*func*/ctx[10](/*preset*/ctx[14]));}function func_1(){var _ctx11;for(var _len12=arguments.length,args=new Array(_len12),_key15=0;_key15<_len12;_key15++){args[_key15]=arguments[_key15];}return(/*func_1*/(_ctx11=ctx)[11].apply(_ctx11,[/*preset*/ctx[14]].concat(args)));}function func_2(){var _ctx12;for(var _len13=arguments.length,args=new Array(_len13),_key16=0;_key16<_len13;_key16++){args[_key16]=arguments[_key16];}return(/*func_2*/(_ctx12=ctx)[12].apply(_ctx12,[/*preset*/ctx[14]].concat(args)));}function func_3(){var _ctx13;for(var _len14=arguments.length,args=new Array(_len14),_key17=0;_key17<_len14;_key17++){args[_key17]=arguments[_key17];}return(/*func_3*/(_ctx13=ctx)[13].apply(_ctx13,[/*preset*/ctx[14]].concat(args)));}dragbutton=new DragButton({props:{onclick:func,ongrab:func_1,ondrag:func_2,ondrop:func_3,disabled:/*disabled*/ctx[1]||/*preset*/ctx[14].disabled,title:/*preset*/ctx[14].title,html:/*preset*/ctx[14].thumb}});return{key:key_1,first:null,c:function c(){li=element("li");create_component(dragbutton.$$.fragment);t=space();attr(li,"class","PinturaShapePreset");attr(li,"style",/*style*/ctx[6]);this.first=li;},m:function m(target,anchor){insert(target,li,anchor);mount_component(dragbutton,li,null);append(li,t);current=true;if(!mounted){dispose=action_destroyer(didMountPresetThumb_action=/*didMountPresetThumb*/ctx[8].call(null,li,/*preset*/ctx[14]));mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;var dragbutton_changes={};if(dirty&/*onclickpreset, presets*/5)dragbutton_changes.onclick=func;if(dirty&/*ongrabpreset, presets*/9)dragbutton_changes.ongrab=func_1;if(dirty&/*ondragpreset, presets*/17)dragbutton_changes.ondrag=func_2;if(dirty&/*ondroppreset, presets*/33)dragbutton_changes.ondrop=func_3;if(dirty&/*disabled, presets*/3)dragbutton_changes.disabled=/*disabled*/ctx[1]||/*preset*/ctx[14].disabled;if(dirty&/*presets*/1)dragbutton_changes.title=/*preset*/ctx[14].title;if(dirty&/*presets*/1)dragbutton_changes.html=/*preset*/ctx[14].thumb;dragbutton.$set(dragbutton_changes);if(!current||dirty&/*style*/64){attr(li,"style",/*style*/ctx[6]);}if(didMountPresetThumb_action&&is_function(didMountPresetThumb_action.update)&&dirty&/*presets*/1)didMountPresetThumb_action.update.call(null,/*preset*/ctx[14]);},i:function i(local){if(current)return;transition_in(dragbutton.$$.fragment,local);current=true;},o:function o(local){transition_out(dragbutton.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(li);destroy_component(dragbutton);mounted=false;dispose();}};}function create_fragment$c(ctx){var ul;var each_blocks=[];var each_1_lookup=new Map();var current;var each_value=/*presets*/ctx[0];var get_key=function get_key(ctx){return(/*preset*/ctx[14].id);};for(var i=0;i<each_value.length;i+=1){var child_ctx=get_each_context(ctx,each_value,i);var key=get_key(child_ctx);each_1_lookup.set(key,each_blocks[i]=create_each_block(key,child_ctx));}return{c:function c(){ul=element("ul");for(var _i49=0;_i49<each_blocks.length;_i49+=1){each_blocks[_i49].c();}attr(ul,"class","PinturaShapePresetsList");},m:function m(target,anchor){insert(target,ul,anchor);for(var _i50=0;_i50<each_blocks.length;_i50+=1){each_blocks[_i50].m(ul,null);}current=true;},p:function p(ctx,_ref421){var _ref422=_slicedToArray(_ref421,1),dirty=_ref422[0];if(dirty&/*style, presets, onclickpreset, ongrabpreset, ondragpreset, ondroppreset, disabled*/127){each_value=/*presets*/ctx[0];group_outros();each_blocks=update_keyed_each(each_blocks,dirty,get_key,1,ctx,each_value,each_1_lookup,ul,outro_and_destroy_block,create_each_block,null,get_each_context);check_outros();}},i:function i(local){if(current)return;for(var _i51=0;_i51<each_value.length;_i51+=1){transition_in(each_blocks[_i51]);}current=true;},o:function o(local){for(var _i52=0;_i52<each_blocks.length;_i52+=1){transition_out(each_blocks[_i52]);}current=false;},d:function d(detaching){if(detaching)detach(ul);for(var _i53=0;_i53<each_blocks.length;_i53+=1){each_blocks[_i53].d();}}};}function instance$c($$self,$$props,$$invalidate){var style;var $opacity;var presets=$$props.presets;var _$$props$disabled6=$$props.disabled,disabled=_$$props$disabled6===void 0?undefined:_$$props$disabled6;var onclickpreset=$$props.onclickpreset;var _$$props$ongrabpreset=$$props.ongrabpreset,ongrabpreset=_$$props$ongrabpreset===void 0?undefined:_$$props$ongrabpreset;var _$$props$ondragpreset=$$props.ondragpreset,ondragpreset=_$$props$ondragpreset===void 0?undefined:_$$props$ondragpreset;var _$$props$ondroppreset=$$props.ondroppreset,ondroppreset=_$$props$ondroppreset===void 0?undefined:_$$props$ondroppreset;var opacity=spring(0,{stiffness:0.25,damping:0.9});component_subscribe($$self,opacity,function(value){return $$invalidate(9,$opacity=value);});var didMountPresetThumb=function didMountPresetThumb(element,item){return item.mount&&item.mount(element.firstChild,item);};onMount(function(){return opacity.set(1);});var func=function func(preset){return onclickpreset(preset.id);};var func_1=function func_1(preset,e){return ongrabpreset&&ongrabpreset(preset.id,e);};var func_2=function func_2(preset,e){return ondragpreset&&ondragpreset(preset.id,e);};var func_3=function func_3(preset,e){return ondroppreset&&ondroppreset(preset.id,e);};$$self.$$set=function($$props){if('presets'in $$props)$$invalidate(0,presets=$$props.presets);if('disabled'in $$props)$$invalidate(1,disabled=$$props.disabled);if('onclickpreset'in $$props)$$invalidate(2,onclickpreset=$$props.onclickpreset);if('ongrabpreset'in $$props)$$invalidate(3,ongrabpreset=$$props.ongrabpreset);if('ondragpreset'in $$props)$$invalidate(4,ondragpreset=$$props.ondragpreset);if('ondroppreset'in $$props)$$invalidate(5,ondroppreset=$$props.ondroppreset);};$$self.$$.update=function(){if($$self.$$.dirty&/*$opacity*/512){$$invalidate(6,style="opacity:".concat($opacity));}};return[presets,disabled,onclickpreset,ongrabpreset,ondragpreset,ondroppreset,style,opacity,didMountPresetThumb,$opacity,func,func_1,func_2,func_3];}var ShapePresetsList=/*#__PURE__*/function(_SvelteComponent42){_inherits(ShapePresetsList,_SvelteComponent42);var _super43=_createSuper(ShapePresetsList);function ShapePresetsList(options){var _this44;_classCallCheck(this,ShapePresetsList);_this44=_super43.call(this);init(_assertThisInitialized(_this44),options,instance$c,create_fragment$c,safe_not_equal,{presets:0,disabled:1,onclickpreset:2,ongrabpreset:3,ondragpreset:4,ondroppreset:5});return _this44;}return _createClass(ShapePresetsList);}(SvelteComponent);var isSVGMarkup=function isSVGMarkup(str){return /<svg /.test(str);};/* src/core/ui/components/ShapePresetsPalette.svelte generated by Svelte v3.52.0 */function create_if_block_6(ctx){var dynamiccomponenttree;var current;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*presetToolbar*/ctx[10]}});return{c:function c(){create_component(dynamiccomponenttree.$$.fragment);},m:function m(target,anchor){mount_component(dynamiccomponenttree,target,anchor);current=true;},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty&/*presetToolbar*/1024)dynamiccomponenttree_changes.items=/*presetToolbar*/ctx[10];dynamiccomponenttree.$set(dynamiccomponenttree_changes);},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(dynamiccomponenttree,detaching);}};}// (159:4) {#if shouldRenderPresets}
function create_if_block$2(ctx){var current_block_type_index;var if_block;var if_block_anchor;var current;var if_block_creators=[create_if_block_1$1,create_else_block$1];var if_blocks=[];function select_block_type_1(ctx,dirty){if(/*shouldGroupPresets*/ctx[8])return 0;return 1;}current_block_type_index=select_block_type_1(ctx);if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);return{c:function c(){if_block.c();if_block_anchor=empty();},m:function m(target,anchor){if_blocks[current_block_type_index].m(target,anchor);insert(target,if_block_anchor,anchor);current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type_1(ctx);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(if_block_anchor.parentNode,if_block_anchor);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if_blocks[current_block_type_index].d(detaching);if(detaching)detach(if_block_anchor);}};}// (208:8) {:else}
function create_else_block$1(ctx){var div;var t;var scrollable;var current;var if_block=/*presetToolbar*/ctx[10]&&create_if_block_5$1(ctx);scrollable=new Scrollable({props:{scrollAutoCancel:/*shouldRenderPresets*/ctx[9],elasticity:/*scrollElasticity*/ctx[0],$$slots:{"default":[create_default_slot_5]},$$scope:{ctx:ctx}}});return{c:function c(){div=element("div");if(if_block)if_block.c();t=space();create_component(scrollable.$$.fragment);attr(div,"class","PinturaShapePresetsFlat");},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);append(div,t);mount_component(scrollable,div,null);current=true;},p:function p(ctx,dirty){if(/*presetToolbar*/ctx[10]){if(if_block){if_block.p(ctx,dirty);if(dirty&/*presetToolbar*/1024){transition_in(if_block,1);}}else{if_block=create_if_block_5$1(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,t);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}var scrollable_changes={};if(dirty&/*shouldRenderPresets*/512)scrollable_changes.scrollAutoCancel=/*shouldRenderPresets*/ctx[9];if(dirty&/*scrollElasticity*/1)scrollable_changes.elasticity=/*scrollElasticity*/ctx[0];if(dirty&/*$$scope, presetsMapped, onaddpreset, ongrabpreset, ondragpreset, ondroppreset*/536871070){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);},i:function i(local){if(current)return;transition_in(if_block);transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(if_block);transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();destroy_component(scrollable);}};}// (161:8) {#if shouldGroupPresets}
function create_if_block_1$1(ctx){var div;var scrollable;var t;var tabpanels;var current;scrollable=new Scrollable({props:{elasticity:/*scrollElasticity*/ctx[0],"class":"PinturaShapePresetsGroups",$$slots:{"default":[create_default_slot_2]},$$scope:{ctx:ctx}}});var tabpanels_spread_levels=[{"class":"PinturaControlPanels"},{panelClass:"PinturaControlPanel"},{panels:/*panels*/ctx[11]},/*tabsConfig*/ctx[12]];var tabpanels_props={$$slots:{"default":[create_default_slot$5,function(_ref423){var panel=_ref423.panel,panelIsActive=_ref423.panelIsActive;return{26:panel,27:panelIsActive};},function(_ref424){var panel=_ref424.panel,panelIsActive=_ref424.panelIsActive;return(panel?67108864:0)|(panelIsActive?134217728:0);}]},$$scope:{ctx:ctx}};for(var i=0;i<tabpanels_spread_levels.length;i+=1){tabpanels_props=assign(tabpanels_props,tabpanels_spread_levels[i]);}tabpanels=new TabPanels({props:tabpanels_props});return{c:function c(){div=element("div");create_component(scrollable.$$.fragment);t=space();create_component(tabpanels.$$.fragment);attr(div,"class","PinturaShapePresetsGrouped");},m:function m(target,anchor){insert(target,div,anchor);mount_component(scrollable,div,null);append(div,t);mount_component(tabpanels,div,null);current=true;},p:function p(ctx,dirty){var scrollable_changes={};if(dirty&/*scrollElasticity*/1)scrollable_changes.elasticity=/*scrollElasticity*/ctx[0];if(dirty&/*$$scope, tabs, tabsConfig, tabSelected, presetToolbar*/536876128){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);var tabpanels_changes=dirty&/*panels, tabsConfig*/6144?get_spread_update(tabpanels_spread_levels,[tabpanels_spread_levels[0],tabpanels_spread_levels[1],dirty&/*panels*/2048&&{panels:/*panels*/ctx[11]},dirty&/*tabsConfig*/4096&&get_spread_object(/*tabsConfig*/ctx[12])]):{};if(dirty&/*$$scope, panelIsActive, shouldRenderPresets, scrollElasticity, presetTabs, panel, onaddpreset, ongrabpreset, ondragpreset, ondroppreset*/738206239){tabpanels_changes.$$scope={dirty:dirty,ctx:ctx};}tabpanels.$set(tabpanels_changes);},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);transition_in(tabpanels.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);transition_out(tabpanels.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(scrollable);destroy_component(tabpanels);}};}// (211:16) {#if presetToolbar}
function create_if_block_5$1(ctx){var dynamiccomponenttree;var current;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*presetToolbar*/ctx[10]}});return{c:function c(){create_component(dynamiccomponenttree.$$.fragment);},m:function m(target,anchor){mount_component(dynamiccomponenttree,target,anchor);current=true;},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty&/*presetToolbar*/1024)dynamiccomponenttree_changes.items=/*presetToolbar*/ctx[10];dynamiccomponenttree.$set(dynamiccomponenttree_changes);},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(dynamiccomponenttree,detaching);}};}// (215:16) <Scrollable scrollAutoCancel={shouldRenderPresets} elasticity={scrollElasticity}>
function create_default_slot_5(ctx){var shapepresetslist;var current;shapepresetslist=new ShapePresetsList({props:{presets:/*presetsMapped*/ctx[7],onclickpreset:/*onaddpreset*/ctx[1],ongrabpreset:/*ongrabpreset*/ctx[2],ondragpreset:/*ondragpreset*/ctx[3],ondroppreset:/*ondroppreset*/ctx[4]}});return{c:function c(){create_component(shapepresetslist.$$.fragment);},m:function m(target,anchor){mount_component(shapepresetslist,target,anchor);current=true;},p:function p(ctx,dirty){var shapepresetslist_changes={};if(dirty&/*presetsMapped*/128)shapepresetslist_changes.presets=/*presetsMapped*/ctx[7];if(dirty&/*onaddpreset*/2)shapepresetslist_changes.onclickpreset=/*onaddpreset*/ctx[1];if(dirty&/*ongrabpreset*/4)shapepresetslist_changes.ongrabpreset=/*ongrabpreset*/ctx[2];if(dirty&/*ondragpreset*/8)shapepresetslist_changes.ondragpreset=/*ondragpreset*/ctx[3];if(dirty&/*ondroppreset*/16)shapepresetslist_changes.ondroppreset=/*ondroppreset*/ctx[4];shapepresetslist.$set(shapepresetslist_changes);},i:function i(local){if(current)return;transition_in(shapepresetslist.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetslist.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapepresetslist,detaching);}};}// (164:20) {#if presetToolbar}
function create_if_block_4$1(ctx){var dynamiccomponenttree;var current;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*presetToolbar*/ctx[10]}});return{c:function c(){create_component(dynamiccomponenttree.$$.fragment);},m:function m(target,anchor){mount_component(dynamiccomponenttree,target,anchor);current=true;},p:function p(ctx,dirty){var dynamiccomponenttree_changes={};if(dirty&/*presetToolbar*/1024)dynamiccomponenttree_changes.items=/*presetToolbar*/ctx[10];dynamiccomponenttree.$set(dynamiccomponenttree_changes);},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(dynamiccomponenttree,detaching);}};}// (175:24) {#if tab.icon}
function create_if_block_3$1(ctx){var icon;var current;icon=new Icon({props:{$$slots:{"default":[create_default_slot_4]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);},m:function m(target,anchor){mount_component(icon,target,anchor);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty&/*$$scope, tab*/805306368){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);}};}// (176:28) <Icon>
function create_default_slot_4(ctx){var g;var raw_value=/*tab*/ctx[28].icon+"";return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty&/*tab*/268435456&&raw_value!==(raw_value=/*tab*/ctx[28].icon+""))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (178:24) {#if !tab.hideLabel}
function create_if_block_2$1(ctx){var span;var t_value=/*tab*/ctx[28].label+"";var t;return{c:function c(){span=element("span");t=text(t_value);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty&/*tab*/268435456&&t_value!==(t_value=/*tab*/ctx[28].label+""))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (167:20) <TabList                         class="PinturaControlList"                         {tabs}                         {...tabsConfig}                         layout="compact"                         on:select={({ detail }) => (tabSelected = detail)}                         let:tab                     >
function create_default_slot_3(ctx){var t;var if_block1_anchor;var current;var if_block0=/*tab*/ctx[28].icon&&create_if_block_3$1(ctx);var if_block1=!/*tab*/ctx[28].hideLabel&&create_if_block_2$1(ctx);return{c:function c(){if(if_block0)if_block0.c();t=space();if(if_block1)if_block1.c();if_block1_anchor=empty();},m:function m(target,anchor){if(if_block0)if_block0.m(target,anchor);insert(target,t,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,if_block1_anchor,anchor);current=true;},p:function p(ctx,dirty){if(/*tab*/ctx[28].icon){if(if_block0){if_block0.p(ctx,dirty);if(dirty&/*tab*/268435456){transition_in(if_block0,1);}}else{if_block0=create_if_block_3$1(ctx);if_block0.c();transition_in(if_block0,1);if_block0.m(t.parentNode,t);}}else if(if_block0){group_outros();transition_out(if_block0,1,1,function(){if_block0=null;});check_outros();}if(!/*tab*/ctx[28].hideLabel){if(if_block1){if_block1.p(ctx,dirty);}else{if_block1=create_if_block_2$1(ctx);if_block1.c();if_block1.m(if_block1_anchor.parentNode,if_block1_anchor);}}else if(if_block1){if_block1.d(1);if_block1=null;}},i:function i(local){if(current)return;transition_in(if_block0);current=true;},o:function o(local){transition_out(if_block0);current=false;},d:function d(detaching){if(if_block0)if_block0.d(detaching);if(detaching)detach(t);if(if_block1)if_block1.d(detaching);if(detaching)detach(if_block1_anchor);}};}// (163:16) <Scrollable elasticity={scrollElasticity} class="PinturaShapePresetsGroups">
function create_default_slot_2(ctx){var t;var tablist;var current;var if_block=/*presetToolbar*/ctx[10]&&create_if_block_4$1(ctx);var tablist_spread_levels=[{"class":"PinturaControlList"},{tabs:/*tabs*/ctx[5]},/*tabsConfig*/ctx[12],{layout:"compact"}];var tablist_props={$$slots:{"default":[create_default_slot_3,function(_ref425){var tab=_ref425.tab;return{28:tab};},function(_ref426){var tab=_ref426.tab;return tab?268435456:0;}]},$$scope:{ctx:ctx}};for(var i=0;i<tablist_spread_levels.length;i+=1){tablist_props=assign(tablist_props,tablist_spread_levels[i]);}tablist=new TabList({props:tablist_props});tablist.$on("select",/*select_handler*/ctx[18]);return{c:function c(){if(if_block)if_block.c();t=space();create_component(tablist.$$.fragment);},m:function m(target,anchor){if(if_block)if_block.m(target,anchor);insert(target,t,anchor);mount_component(tablist,target,anchor);current=true;},p:function p(ctx,dirty){if(/*presetToolbar*/ctx[10]){if(if_block){if_block.p(ctx,dirty);if(dirty&/*presetToolbar*/1024){transition_in(if_block,1);}}else{if_block=create_if_block_4$1(ctx);if_block.c();transition_in(if_block,1);if_block.m(t.parentNode,t);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}var tablist_changes=dirty&/*tabs, tabsConfig*/4128?get_spread_update(tablist_spread_levels,[tablist_spread_levels[0],dirty&/*tabs*/32&&{tabs:/*tabs*/ctx[5]},dirty&/*tabsConfig*/4096&&get_spread_object(/*tabsConfig*/ctx[12]),tablist_spread_levels[3]]):{};if(dirty&/*$$scope, tab*/805306368){tablist_changes.$$scope={dirty:dirty,ctx:ctx};}tablist.$set(tablist_changes);},i:function i(local){if(current)return;transition_in(if_block);transition_in(tablist.$$.fragment,local);current=true;},o:function o(local){transition_out(if_block);transition_out(tablist.$$.fragment,local);current=false;},d:function d(detaching){if(if_block)if_block.d(detaching);if(detaching)detach(t);destroy_component(tablist,detaching);}};}// (192:20) <Scrollable                         scroll={panelIsActive ? { scrollOffset: 0, animate: false } : undefined}                         scrollAutoCancel={shouldRenderPresets}                         elasticity={scrollElasticity}                     >
function create_default_slot_1$1(ctx){var shapepresetslist;var current;shapepresetslist=new ShapePresetsList({props:{presets:/*presetTabs*/ctx[13][/*panel*/ctx[26]].items,disabled:/*presetTabs*/ctx[13][/*panel*/ctx[26]].disabled,onclickpreset:/*onaddpreset*/ctx[1],ongrabpreset:/*ongrabpreset*/ctx[2],ondragpreset:/*ondragpreset*/ctx[3],ondroppreset:/*ondroppreset*/ctx[4]}});return{c:function c(){create_component(shapepresetslist.$$.fragment);},m:function m(target,anchor){mount_component(shapepresetslist,target,anchor);current=true;},p:function p(ctx,dirty){var shapepresetslist_changes={};if(dirty&/*presetTabs, panel*/67117056)shapepresetslist_changes.presets=/*presetTabs*/ctx[13][/*panel*/ctx[26]].items;if(dirty&/*presetTabs, panel*/67117056)shapepresetslist_changes.disabled=/*presetTabs*/ctx[13][/*panel*/ctx[26]].disabled;if(dirty&/*onaddpreset*/2)shapepresetslist_changes.onclickpreset=/*onaddpreset*/ctx[1];if(dirty&/*ongrabpreset*/4)shapepresetslist_changes.ongrabpreset=/*ongrabpreset*/ctx[2];if(dirty&/*ondragpreset*/8)shapepresetslist_changes.ondragpreset=/*ondragpreset*/ctx[3];if(dirty&/*ondroppreset*/16)shapepresetslist_changes.ondroppreset=/*ondroppreset*/ctx[4];shapepresetslist.$set(shapepresetslist_changes);},i:function i(local){if(current)return;transition_in(shapepresetslist.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetslist.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapepresetslist,detaching);}};}// (184:16) <TabPanels                     class="PinturaControlPanels"                     panelClass="PinturaControlPanel"                     {panels}                     {...tabsConfig}                     let:panel                     let:panelIsActive                 >
function create_default_slot$5(ctx){var scrollable;var current;scrollable=new Scrollable({props:{scroll:/*panelIsActive*/ctx[27]?{scrollOffset:0,animate:false}:undefined,scrollAutoCancel:/*shouldRenderPresets*/ctx[9],elasticity:/*scrollElasticity*/ctx[0],$$slots:{"default":[create_default_slot_1$1]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(scrollable.$$.fragment);},m:function m(target,anchor){mount_component(scrollable,target,anchor);current=true;},p:function p(ctx,dirty){var scrollable_changes={};if(dirty&/*panelIsActive*/134217728)scrollable_changes.scroll=/*panelIsActive*/ctx[27]?{scrollOffset:0,animate:false}:undefined;if(dirty&/*shouldRenderPresets*/512)scrollable_changes.scrollAutoCancel=/*shouldRenderPresets*/ctx[9];if(dirty&/*scrollElasticity*/1)scrollable_changes.elasticity=/*scrollElasticity*/ctx[0];if(dirty&/*$$scope, presetTabs, panel, onaddpreset, ongrabpreset, ondragpreset, ondroppreset*/603987998){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(scrollable,detaching);}};}function create_fragment$b(ctx){var div;var current_block_type_index;var if_block;var current;var if_block_creators=[create_if_block$2,create_if_block_6];var if_blocks=[];function select_block_type(ctx,dirty){if(/*shouldRenderPresets*/ctx[9])return 0;if(/*presetToolbar*/ctx[10])return 1;return-1;}if(~(current_block_type_index=select_block_type(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){div=element("div");if(if_block)if_block.c();attr(div,"class","PinturaShapePresetsPalette");},m:function m(target,anchor){insert(target,div,anchor);if(~current_block_type_index){if_blocks[current_block_type_index].m(div,null);}current=true;},p:function p(ctx,_ref427){var _ref428=_slicedToArray(_ref427,1),dirty=_ref428[0];var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(div,null);}else{if_block=null;}}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(~current_block_type_index){if_blocks[current_block_type_index].d();}}};}function instance$b($$self,$$props,$$invalidate){var presetsMapped;var shouldRenderPresets;var shouldGroupPresets;var tabs;var presetTabs;var tabSelected;var tabsConfig;var panels;var presetToolbar;var locale=$$props.locale;var presets=$$props.presets;var scrollElasticity=$$props.scrollElasticity;var _$$props$enableSelect=$$props.enableSelectImage,enableSelectImage=_$$props$enableSelect===void 0?true:_$$props$enableSelect;var _$$props$willRenderPr=$$props.willRenderPresetToolbar,willRenderPresetToolbar=_$$props$willRenderPr===void 0?passthrough:_$$props$willRenderPr;var _$$props$onaddpreset=$$props.onaddpreset,onaddpreset=_$$props$onaddpreset===void 0?noop$1:_$$props$onaddpreset;var _$$props$ongrabpreset2=$$props.ongrabpreset,ongrabpreset=_$$props$ongrabpreset2===void 0?undefined:_$$props$ongrabpreset2;var _$$props$ondragpreset2=$$props.ondragpreset,ondragpreset=_$$props$ondragpreset2===void 0?undefined:_$$props$ondragpreset2;var _$$props$ondroppreset2=$$props.ondroppreset,ondroppreset=_$$props$ondroppreset2===void 0?undefined:_$$props$ondroppreset2;var uid="presets-".concat(getUniqueId());var isPresetGroup=function isPresetGroup(item){return isArray(item)&&isString(item[0])&&isArray(item[1]);};var getPresetThumb=function getPresetThumb(value){var alt=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';// could be svg
if(isSVGMarkup(value))return value;// test if is emoji
if(isEmoji(value))return getEmojiSVG(value,alt);// must be URL
return"<img src=\"".concat(value,"\" alt=\"").concat(alt,"\"/>");};var getAltFromSrc=function getAltFromSrc(src){return getFilenameWithoutExtension(getFilenameFromURL(src));};var excludedStickerItemProps=['src','alt','thumb','shape','id','mount','disabled'];var mapPreset=function mapPreset(item){var id=item;var src;var shape;var shapeProps;var thumb;var alt;var mount;var disabled;// if item is a string, it's either an emoji or a URL
if(isString(item)){// is emoji
if(isEmoji(item)){src=item;alt=item;thumb=getPresetThumb(src,alt);}else// must be URL
{src=item;alt=getAltFromSrc(src);thumb=getPresetThumb(src,alt);}}else{// set custom thumbnail if defined
src=item.src;alt=item.alt||(isString(src)?getAltFromSrc(src):isString(item.thumb)?getAltFromSrc(item.thumb):undefined);thumb=getPresetThumb(item.thumb||src,alt);shape=item.shape;mount=item.mount;disabled=item.disabled;shapeProps=Object.keys(item).reduce(function(prev,curr){if(excludedStickerItemProps.includes(curr))return prev;prev[curr]=item[curr];return prev;},{});}return{id:id,src:src,thumb:thumb,shape:shape,shapeProps:shapeProps,alt:alt,title:alt,mount:mount,disabled:disabled};};var mapPresets=function mapPresets(items){return items.map(function(item){if(isPresetGroup(item)){return _objectSpread(_objectSpread({},item[2]),{},{id:"".concat(uid,"-").concat(item[0].toLowerCase()),label:item[0],items:mapPresets(item[1])});}return mapPreset(item);});};var select_handler=function select_handler(_ref429){var detail=_ref429.detail;return $$invalidate(6,tabSelected=detail);};$$self.$$set=function($$props){if('locale'in $$props)$$invalidate(14,locale=$$props.locale);if('presets'in $$props)$$invalidate(15,presets=$$props.presets);if('scrollElasticity'in $$props)$$invalidate(0,scrollElasticity=$$props.scrollElasticity);if('enableSelectImage'in $$props)$$invalidate(16,enableSelectImage=$$props.enableSelectImage);if('willRenderPresetToolbar'in $$props)$$invalidate(17,willRenderPresetToolbar=$$props.willRenderPresetToolbar);if('onaddpreset'in $$props)$$invalidate(1,onaddpreset=$$props.onaddpreset);if('ongrabpreset'in $$props)$$invalidate(2,ongrabpreset=$$props.ongrabpreset);if('ondragpreset'in $$props)$$invalidate(3,ondragpreset=$$props.ondragpreset);if('ondroppreset'in $$props)$$invalidate(4,ondroppreset=$$props.ondroppreset);};$$self.$$.update=function(){if($$self.$$.dirty&/*presets*/32768){$$invalidate(7,presetsMapped=mapPresets(presets));}if($$self.$$.dirty&/*presetsMapped*/128){$$invalidate(9,shouldRenderPresets=presetsMapped.length);}if($$self.$$.dirty&/*shouldRenderPresets, presetsMapped*/640){$$invalidate(8,shouldGroupPresets=shouldRenderPresets&&presetsMapped.some(function(preset){return!!preset.items;}));}if($$self.$$.dirty&/*shouldGroupPresets, presetsMapped*/384){$$invalidate(5,tabs=shouldGroupPresets&&presetsMapped);}if($$self.$$.dirty&/*shouldGroupPresets, presetsMapped*/384){$$invalidate(13,presetTabs=shouldGroupPresets&&presetsMapped.reduce(function(prev,curr){prev[curr.id]=curr;return prev;},{}));}if($$self.$$.dirty&/*tabSelected, tabs*/96){$$invalidate(6,tabSelected=tabSelected||tabs&&(tabs.find(function(tab){return!tab.disabled;})||{}).id);}if($$self.$$.dirty&/*tabSelected*/64){$$invalidate(12,tabsConfig={name:uid,selected:tabSelected});}if($$self.$$.dirty&/*tabs*/32){$$invalidate(11,panels=tabs&&tabs.map(function(tab){return tab.id;}));}if($$self.$$.dirty&/*locale, willRenderPresetToolbar, enableSelectImage, onaddpreset*/212994){$$invalidate(10,presetToolbar=locale&&willRenderPresetToolbar([enableSelectImage&&['Button','browse',{label:locale.shapeLabelButtonSelectSticker,icon:locale.shapeIconButtonSelectSticker,onclick:function onclick(){browse().then(function(file){if(!file)return;onaddpreset(file);});}}]]));}};return[scrollElasticity,onaddpreset,ongrabpreset,ondragpreset,ondroppreset,tabs,tabSelected,presetsMapped,shouldGroupPresets,shouldRenderPresets,presetToolbar,panels,tabsConfig,presetTabs,locale,presets,enableSelectImage,willRenderPresetToolbar,select_handler];}var ShapePresetsPalette=/*#__PURE__*/function(_SvelteComponent43){_inherits(ShapePresetsPalette,_SvelteComponent43);var _super44=_createSuper(ShapePresetsPalette);function ShapePresetsPalette(options){var _this45;_classCallCheck(this,ShapePresetsPalette);_this45=_super44.call(this);init(_assertThisInitialized(_this45),options,instance$b,create_fragment$b,safe_not_equal,{locale:14,presets:15,scrollElasticity:0,enableSelectImage:16,willRenderPresetToolbar:17,onaddpreset:1,ongrabpreset:2,ondragpreset:3,ondroppreset:4});return _this45;}return _createClass(ShapePresetsPalette);}(SvelteComponent);var createPingDispatcher=function createPingDispatcher(node){return function(type,data){node.dispatchEvent(createPing(type,data));};};/* src/core/ui/components/ShapeUtil.svelte generated by Svelte v3.52.0 */function create_if_block_5(ctx){var shapelayouteditor;var updating_markup;var updating_ui;var current;var shapelayouteditor_spread_levels=[{locale:/*locale*/ctx[4]},{uid:/*utilKey*/ctx[14]},{parentRect:/*$parentRect*/ctx[29]},{rootRect:/*$rootRect*/ctx[43]},{utilRect:/*$utilRectPadded*/ctx[30]},{offset:/*markupOffset*/ctx[38]},{disabled:/*$enablePanInputStatus*/ctx[28]},{contextRotation:/*imageRotation*/ctx[17]},{contextFlipX:/*imageFlipX*/ctx[18]},{contextFlipY:/*imageFlipY*/ctx[19]},{contextZoom:/*$imageSelectionZoomCurrent*/ctx[42]},{active:/*$isActive*/ctx[26]},{opacity:/*$isActiveFraction*/ctx[45]},{hoverColor:/*$rootColorSecondary*/ctx[46]},{eraseRadius:/*toolEraseRadius*/ctx[37]},{selectRadius:/*toolSelectRadius*/ctx[6]},{enableButtonFlipVertical:/*enableButtonFlipVertical*/ctx[9]},{mapEditorPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[15]},{mapImagePointToEditorPoint:/*mapImagePointToScreenPoint*/ctx[16]},{enableTapToAddText:/*enableTapToAddText*/ctx[12]},{textInputMode:/*textInputMode*/ctx[7]},{willStartInteraction:/*handleWillStartInteraction*/ctx[80]},{oninteractionstart:/*handleInteractionStart*/ctx[66]},{oninteractionupdate:/*handleInteractionUpdate*/ctx[67]},{oninteractionrelease:/*handleInteractionRelease*/ctx[68]},{oninteractionend:/*handleInteractionEnd*/ctx[70]},{oninteractioncancel:/*handleInteractionCancel*/ctx[69]},{onhovershape:/*handleHoverShape*/ctx[74]},{ontapcanvas:/*handleTapCanvas*/ctx[73]},{onaddshape:/*func_1*/ctx[122]},{onselectshape:/*func_2*/ctx[123]},{ontapshape:/*func_3*/ctx[124]},{onupdateshape:/*func_4*/ctx[125]},{onremoveshape:/*func_5*/ctx[126]},/*layoutEditorHooks*/ctx[32]];function shapelayouteditor_markup_binding(value){/*shapelayouteditor_markup_binding*/ctx[128](value);}function shapelayouteditor_ui_binding(value){/*shapelayouteditor_ui_binding*/ctx[129](value);}var shapelayouteditor_props={};for(var i=0;i<shapelayouteditor_spread_levels.length;i+=1){shapelayouteditor_props=assign(shapelayouteditor_props,shapelayouteditor_spread_levels[i]);}if(/*$shapes*/ctx[27]!==void 0){shapelayouteditor_props.markup=/*$shapes*/ctx[27];}if(/*$imageOverlayMarkup*/ctx[44]!==void 0){shapelayouteditor_props.ui=/*$imageOverlayMarkup*/ctx[44];}shapelayouteditor=new ShapeLayoutEditor({props:shapelayouteditor_props});/*shapelayouteditor_binding*/ctx[127](shapelayouteditor);binding_callbacks.push(function(){return bind(shapelayouteditor,'markup',shapelayouteditor_markup_binding);});binding_callbacks.push(function(){return bind(shapelayouteditor,'ui',shapelayouteditor_ui_binding);});return{c:function c(){create_component(shapelayouteditor.$$.fragment);},m:function m(target,anchor){mount_component(shapelayouteditor,target,anchor);current=true;},p:function p(ctx,dirty){var shapelayouteditor_changes=dirty[0]&/*locale, utilKey, $parentRect, $utilRectPadded, $enablePanInputStatus, imageRotation, imageFlipX, imageFlipY, $isActive, toolSelectRadius, enableButtonFlipVertical, mapScreenPointToImagePoint, mapImagePointToScreenPoint, enableTapToAddText, textInputMode, ping*/1955582672|dirty[1]&/*$rootRect, markupOffset, $imageSelectionZoomCurrent, $isActiveFraction, $rootColorSecondary, toolEraseRadius, layoutEditorHooks*/55490|dirty[2]&/*handleWillStartInteraction, handleInteractionStart, handleInteractionUpdate, handleInteractionRelease, handleInteractionEnd, handleInteractionCancel, handleHoverShape, handleTapCanvas, handleMarkupUpdate*/793072?get_spread_update(shapelayouteditor_spread_levels,[dirty[0]&/*locale*/16&&{locale:/*locale*/ctx[4]},dirty[0]&/*utilKey*/16384&&{uid:/*utilKey*/ctx[14]},dirty[0]&/*$parentRect*/536870912&&{parentRect:/*$parentRect*/ctx[29]},dirty[1]&/*$rootRect*/4096&&{rootRect:/*$rootRect*/ctx[43]},dirty[0]&/*$utilRectPadded*/1073741824&&{utilRect:/*$utilRectPadded*/ctx[30]},dirty[1]&/*markupOffset*/128&&{offset:/*markupOffset*/ctx[38]},dirty[0]&/*$enablePanInputStatus*/268435456&&{disabled:/*$enablePanInputStatus*/ctx[28]},dirty[0]&/*imageRotation*/131072&&{contextRotation:/*imageRotation*/ctx[17]},dirty[0]&/*imageFlipX*/262144&&{contextFlipX:/*imageFlipX*/ctx[18]},dirty[0]&/*imageFlipY*/524288&&{contextFlipY:/*imageFlipY*/ctx[19]},dirty[1]&/*$imageSelectionZoomCurrent*/2048&&{contextZoom:/*$imageSelectionZoomCurrent*/ctx[42]},dirty[0]&/*$isActive*/67108864&&{active:/*$isActive*/ctx[26]},dirty[1]&/*$isActiveFraction*/16384&&{opacity:/*$isActiveFraction*/ctx[45]},dirty[1]&/*$rootColorSecondary*/32768&&{hoverColor:/*$rootColorSecondary*/ctx[46]},dirty[1]&/*toolEraseRadius*/64&&{eraseRadius:/*toolEraseRadius*/ctx[37]},dirty[0]&/*toolSelectRadius*/64&&{selectRadius:/*toolSelectRadius*/ctx[6]},dirty[0]&/*enableButtonFlipVertical*/512&&{enableButtonFlipVertical:/*enableButtonFlipVertical*/ctx[9]},dirty[0]&/*mapScreenPointToImagePoint*/32768&&{mapEditorPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[15]},dirty[0]&/*mapImagePointToScreenPoint*/65536&&{mapImagePointToEditorPoint:/*mapImagePointToScreenPoint*/ctx[16]},dirty[0]&/*enableTapToAddText*/4096&&{enableTapToAddText:/*enableTapToAddText*/ctx[12]},dirty[0]&/*textInputMode*/128&&{textInputMode:/*textInputMode*/ctx[7]},dirty[2]&/*handleWillStartInteraction*/262144&&{willStartInteraction:/*handleWillStartInteraction*/ctx[80]},dirty[2]&/*handleInteractionStart*/16&&{oninteractionstart:/*handleInteractionStart*/ctx[66]},dirty[2]&/*handleInteractionUpdate*/32&&{oninteractionupdate:/*handleInteractionUpdate*/ctx[67]},dirty[2]&/*handleInteractionRelease*/64&&{oninteractionrelease:/*handleInteractionRelease*/ctx[68]},dirty[2]&/*handleInteractionEnd*/256&&{oninteractionend:/*handleInteractionEnd*/ctx[70]},dirty[2]&/*handleInteractionCancel*/128&&{oninteractioncancel:/*handleInteractionCancel*/ctx[69]},dirty[2]&/*handleHoverShape*/4096&&{onhovershape:/*handleHoverShape*/ctx[74]},dirty[2]&/*handleTapCanvas*/2048&&{ontapcanvas:/*handleTapCanvas*/ctx[73]},dirty[0]&/*ping*/8388608|dirty[2]&/*handleMarkupUpdate*/524288&&{onaddshape:/*func_1*/ctx[122]},dirty[0]&/*ping*/8388608&&{onselectshape:/*func_2*/ctx[123]},dirty[0]&/*ping*/8388608&&{ontapshape:/*func_3*/ctx[124]},dirty[0]&/*ping*/8388608|dirty[2]&/*handleMarkupUpdate*/524288&&{onupdateshape:/*func_4*/ctx[125]},dirty[0]&/*ping*/8388608|dirty[2]&/*handleMarkupUpdate*/524288&&{onremoveshape:/*func_5*/ctx[126]},dirty[1]&/*layoutEditorHooks*/2&&get_spread_object(/*layoutEditorHooks*/ctx[32])]):{};if(!updating_markup&&dirty[0]&/*$shapes*/134217728){updating_markup=true;shapelayouteditor_changes.markup=/*$shapes*/ctx[27];add_flush_callback(function(){return updating_markup=false;});}if(!updating_ui&&dirty[1]&/*$imageOverlayMarkup*/8192){updating_ui=true;shapelayouteditor_changes.ui=/*$imageOverlayMarkup*/ctx[44];add_flush_callback(function(){return updating_ui=false;});}shapelayouteditor.$set(shapelayouteditor_changes);},i:function i(local){if(current)return;transition_in(shapelayouteditor.$$.fragment,local);current=true;},o:function o(local){transition_out(shapelayouteditor.$$.fragment,local);current=false;},d:function d(detaching){/*shapelayouteditor_binding*/ctx[127](null);destroy_component(shapelayouteditor,detaching);}};}// (912:4) 
function create_main_slot(ctx){var div;var div_style_value;var current;var mounted;var dispose;var if_block=/*shouldRenderShapeEditor*/ctx[39]&&create_if_block_5(ctx);return{c:function c(){div=element("div");if(if_block)if_block.c();attr(div,"slot","main");attr(div,"style",div_style_value="cursor:".concat(/*cursor*/ctx[35]));},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);/*div_binding*/ctx[130](div);current=true;if(!mounted){dispose=[listen(div,"keydown",/*handleKey*/ctx[71]),action_destroyer(dropable.call(null,div)),listen(div,"dropfiles",function(){if(is_function(/*enablePresetDropImage*/ctx[11]?/*handleDropFiles*/ctx[79]:noop$1))(/*enablePresetDropImage*/ctx[11]?/*handleDropFiles*/ctx[79]:noop$1).apply(this,arguments);}),action_destroyer(measurable.call(null,div)),listen(div,"measure",/*measure_handler_1*/ctx[120])];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(/*shouldRenderShapeEditor*/ctx[39]){if(if_block){if_block.p(ctx,dirty);if(dirty[1]&/*shouldRenderShapeEditor*/256){transition_in(if_block,1);}}else{if_block=create_if_block_5(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,null);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if(!current||dirty[1]&/*cursor*/16&&div_style_value!==(div_style_value="cursor:".concat(/*cursor*/ctx[35]))){attr(div,"style",div_style_value);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();/*div_binding*/ctx[130](null);mounted=false;run_all(dispose);}};}// (1045:38) 
function create_if_block_4(ctx){var shapepresetspalette;var current;shapepresetspalette=new ShapePresetsPalette({props:{locale:/*locale*/ctx[4],presets:/*shapePresets*/ctx[13],enableSelectImage:/*enablePresetSelectImage*/ctx[10],willRenderPresetToolbar:/*runWillRenderPresetToolbarHook*/ctx[33],onaddpreset:/*handleAddPreset*/ctx[78],ongrabpreset:/*handleGrabPreset*/ctx[75],ondragpreset:/*handleDragPreset*/ctx[76],ondroppreset:/*handleDropPreset*/ctx[77],scrollElasticity:/*computedScrollElasticity*/ctx[34]}});return{c:function c(){create_component(shapepresetspalette.$$.fragment);},m:function m(target,anchor){mount_component(shapepresetspalette,target,anchor);current=true;},p:function p(ctx,dirty){var shapepresetspalette_changes={};if(dirty[0]&/*locale*/16)shapepresetspalette_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*shapePresets*/8192)shapepresetspalette_changes.presets=/*shapePresets*/ctx[13];if(dirty[0]&/*enablePresetSelectImage*/1024)shapepresetspalette_changes.enableSelectImage=/*enablePresetSelectImage*/ctx[10];if(dirty[1]&/*runWillRenderPresetToolbarHook*/4)shapepresetspalette_changes.willRenderPresetToolbar=/*runWillRenderPresetToolbarHook*/ctx[33];if(dirty[1]&/*computedScrollElasticity*/8)shapepresetspalette_changes.scrollElasticity=/*computedScrollElasticity*/ctx[34];shapepresetspalette.$set(shapepresetspalette_changes);},i:function i(local){if(current)return;transition_in(shapepresetspalette.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetspalette.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapepresetspalette,detaching);}};}// (980:8) {#if shouldRenderControls}
function create_if_block$1(ctx){var div;var current_block_type_index;var if_block0;var t;var if_block1_anchor;var current;var if_block_creators=[create_if_block_3,create_else_block];var if_blocks=[];function select_block_type_1(ctx,dirty){if(/*shouldRenderPresets*/ctx[36])return 0;return 1;}current_block_type_index=select_block_type_1(ctx);if_block0=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);var if_block1=/*showToolbar*/ctx[41]&&create_if_block_1(ctx);return{c:function c(){div=element("div");if_block0.c();t=space();if(if_block1)if_block1.c();if_block1_anchor=empty();attr(div,"class","PinturaControlPanels");},m:function m(target,anchor){insert(target,div,anchor);if_blocks[current_block_type_index].m(div,null);insert(target,t,anchor);if(if_block1)if_block1.m(target,anchor);insert(target,if_block1_anchor,anchor);current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type_1(ctx);if(current_block_type_index===previous_block_index){if_blocks[current_block_type_index].p(ctx,dirty);}else{group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();if_block0=if_blocks[current_block_type_index];if(!if_block0){if_block0=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block0.c();}else{if_block0.p(ctx,dirty);}transition_in(if_block0,1);if_block0.m(div,null);}if(/*showToolbar*/ctx[41]){if(if_block1){if_block1.p(ctx,dirty);if(dirty[1]&/*showToolbar*/1024){transition_in(if_block1,1);}}else{if_block1=create_if_block_1(ctx);if_block1.c();transition_in(if_block1,1);if_block1.m(if_block1_anchor.parentNode,if_block1_anchor);}}else if(if_block1){group_outros();transition_out(if_block1,1,1,function(){if_block1=null;});check_outros();}},i:function i(local){if(current)return;transition_in(if_block0);transition_in(if_block1);current=true;},o:function o(local){transition_out(if_block0);transition_out(if_block1);current=false;},d:function d(detaching){if(detaching)detach(div);if_blocks[current_block_type_index].d();if(detaching)detach(t);if(if_block1)if_block1.d(detaching);if(detaching)detach(if_block1_anchor);}};}// (996:16) {:else}
function create_else_block(ctx){var div;var shapestyleeditor;var current;shapestyleeditor=new ShapeStyleEditor({props:{locale:/*locale*/ctx[4],shape:/*markupShapeSelected*/ctx[24],onchange:/*handleUpdateSelectedMarkupShape*/ctx[72],controls:/*shapeControls*/ctx[8],scrollElasticity:/*computedScrollElasticity*/ctx[34]}});return{c:function c(){div=element("div");create_component(shapestyleeditor.$$.fragment);attr(div,"class","PinturaControlPanel");},m:function m(target,anchor){insert(target,div,anchor);mount_component(shapestyleeditor,div,null);current=true;},p:function p(ctx,dirty){var shapestyleeditor_changes={};if(dirty[0]&/*locale*/16)shapestyleeditor_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*markupShapeSelected*/16777216)shapestyleeditor_changes.shape=/*markupShapeSelected*/ctx[24];if(dirty[0]&/*shapeControls*/256)shapestyleeditor_changes.controls=/*shapeControls*/ctx[8];if(dirty[1]&/*computedScrollElasticity*/8)shapestyleeditor_changes.scrollElasticity=/*computedScrollElasticity*/ctx[34];shapestyleeditor.$set(shapestyleeditor_changes);},i:function i(local){if(current)return;transition_in(shapestyleeditor.$$.fragment,local);current=true;},o:function o(local){transition_out(shapestyleeditor.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(shapestyleeditor);}};}// (982:16) {#if shouldRenderPresets}
function create_if_block_3(ctx){var div;var shapepresetspalette;var current;shapepresetspalette=new ShapePresetsPalette({props:{locale:/*locale*/ctx[4],presets:/*shapePresets*/ctx[13],enableSelectImage:/*enablePresetSelectImage*/ctx[10],willRenderPresetToolbar:/*runWillRenderPresetToolbarHook*/ctx[33],onaddpreset:/*handleAddPreset*/ctx[78],ongrabpreset:/*handleGrabPreset*/ctx[75],ondragpreset:/*handleDragPreset*/ctx[76],ondroppreset:/*handleDropPreset*/ctx[77],scrollElasticity:/*computedScrollElasticity*/ctx[34]}});return{c:function c(){div=element("div");create_component(shapepresetspalette.$$.fragment);attr(div,"class","PinturaControlPanel");},m:function m(target,anchor){insert(target,div,anchor);mount_component(shapepresetspalette,div,null);current=true;},p:function p(ctx,dirty){var shapepresetspalette_changes={};if(dirty[0]&/*locale*/16)shapepresetspalette_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*shapePresets*/8192)shapepresetspalette_changes.presets=/*shapePresets*/ctx[13];if(dirty[0]&/*enablePresetSelectImage*/1024)shapepresetspalette_changes.enableSelectImage=/*enablePresetSelectImage*/ctx[10];if(dirty[1]&/*runWillRenderPresetToolbarHook*/4)shapepresetspalette_changes.willRenderPresetToolbar=/*runWillRenderPresetToolbarHook*/ctx[33];if(dirty[1]&/*computedScrollElasticity*/8)shapepresetspalette_changes.scrollElasticity=/*computedScrollElasticity*/ctx[34];shapepresetspalette.$set(shapepresetspalette_changes);},i:function i(local){if(current)return;transition_in(shapepresetspalette.$$.fragment,local);current=true;},o:function o(local){transition_out(shapepresetspalette.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(shapepresetspalette);}};}// (1009:12) {#if showToolbar}
function create_if_block_1(ctx){var scrollable;var current;scrollable=new Scrollable({props:{"class":"PinturaControlListScroller",elasticity:/*computedScrollElasticity*/ctx[34],$$slots:{"default":[create_default_slot$4]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(scrollable.$$.fragment);},m:function m(target,anchor){mount_component(scrollable,target,anchor);current=true;},p:function p(ctx,dirty){var scrollable_changes={};if(dirty[1]&/*computedScrollElasticity*/8)scrollable_changes.elasticity=/*computedScrollElasticity*/ctx[34];if(dirty[0]&/*locale, toolsFiltered, toolActive*/33554449|dirty[5]&/*$$scope*/512){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(scrollable,detaching);}};}// (1027:28) {#if option.icon}
function create_if_block_2(ctx){var icon;var current;icon=new Icon({props:{$$slots:{"default":[create_default_slot_1]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(icon.$$.fragment);},m:function m(target,anchor){mount_component(icon,target,anchor);current=true;},p:function p(ctx,dirty){var icon_changes={};if(dirty[0]&/*locale*/16|dirty[5]&/*$$scope, option*/768){icon_changes.$$scope={dirty:dirty,ctx:ctx};}icon.$set(icon_changes);},i:function i(local){if(current)return;transition_in(icon.$$.fragment,local);current=true;},o:function o(local){transition_out(icon.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(icon,detaching);}};}// (1028:32) <Icon                                     >
function create_default_slot_1(ctx){var g;var raw_value=(isFunction(/*option*/ctx[163].icon)?/*option*/ctx[163].icon(/*locale*/ctx[4]):/*option*/ctx[163].icon)+"";return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=raw_value;},p:function p(ctx,dirty){if(dirty[0]&/*locale*/16|dirty[5]&/*option*/256&&raw_value!==(raw_value=(isFunction(/*option*/ctx[163].icon)?/*option*/ctx[163].icon(/*locale*/ctx[4]):/*option*/ctx[163].icon)+""))g.innerHTML=raw_value;},d:function d(detaching){if(detaching)detach(g);}};}// (1026:24) 
function create_option_slot$2(ctx){var div;var t0;var span;var t1_value=(isFunction(/*option*/ctx[163].label)?/*option*/ctx[163].label(/*locale*/ctx[4]):/*option*/ctx[163].label)+"";var t1;var current;var if_block=/*option*/ctx[163].icon&&create_if_block_2(ctx);return{c:function c(){div=element("div");if(if_block)if_block.c();t0=space();span=element("span");t1=text(t1_value);attr(div,"slot","option");},m:function m(target,anchor){insert(target,div,anchor);if(if_block)if_block.m(div,null);append(div,t0);append(div,span);append(span,t1);current=true;},p:function p(ctx,dirty){if(/*option*/ctx[163].icon){if(if_block){if_block.p(ctx,dirty);if(dirty[5]&/*option*/256){transition_in(if_block,1);}}else{if_block=create_if_block_2(ctx);if_block.c();transition_in(if_block,1);if_block.m(div,t0);}}else if(if_block){group_outros();transition_out(if_block,1,1,function(){if_block=null;});check_outros();}if((!current||dirty[0]&/*locale*/16|dirty[5]&/*option*/256)&&t1_value!==(t1_value=(isFunction(/*option*/ctx[163].label)?/*option*/ctx[163].label(/*locale*/ctx[4]):/*option*/ctx[163].label)+""))set_data(t1,t1_value);},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();}};}// (1010:16) <Scrollable                     class="PinturaControlListScroller"                     elasticity={computedScrollElasticity}                 >
function create_default_slot$4(ctx){var radiogroup;var current;radiogroup=new RadioGroup({props:{locale:/*locale*/ctx[4],"class":"PinturaControlList",optionClass:"PinturaControlListOption",layout:"row",options:/*toolsFiltered*/ctx[25],selectedIndex:/*toolsFiltered*/ctx[25].findIndex(/*func*/ctx[121]),onchange:/*updateActiveTool*/ctx[65],$$slots:{option:[create_option_slot$2,function(_ref430){var option=_ref430.option;return{163:option};},function(_ref431){var option=_ref431.option;return[0,0,0,0,0,option?256:0];}]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(radiogroup.$$.fragment);},m:function m(target,anchor){mount_component(radiogroup,target,anchor);current=true;},p:function p(ctx,dirty){var radiogroup_changes={};if(dirty[0]&/*locale*/16)radiogroup_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*toolsFiltered*/33554432)radiogroup_changes.options=/*toolsFiltered*/ctx[25];if(dirty[0]&/*toolsFiltered, toolActive*/33554433)radiogroup_changes.selectedIndex=/*toolsFiltered*/ctx[25].findIndex(/*func*/ctx[121]);if(dirty[0]&/*locale*/16|dirty[5]&/*$$scope, option*/768){radiogroup_changes.$$scope={dirty:dirty,ctx:ctx};}radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radiogroup,detaching);}};}// (979:4) 
function create_footer_slot$3(ctx){var div;var current_block_type_index;var if_block;var current;var if_block_creators=[create_if_block$1,create_if_block_4];var if_blocks=[];function select_block_type(ctx,dirty){if(/*shouldRenderControls*/ctx[40])return 0;if(/*shouldRenderPresets*/ctx[36])return 1;return-1;}if(~(current_block_type_index=select_block_type(ctx))){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);}return{c:function c(){div=element("div");if(if_block)if_block.c();attr(div,"slot","footer");attr(div,"style",/*footerStyle*/ctx[31]);},m:function m(target,anchor){insert(target,div,anchor);if(~current_block_type_index){if_blocks[current_block_type_index].m(div,null);}current=true;},p:function p(ctx,dirty){var previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx);if(current_block_type_index===previous_block_index){if(~current_block_type_index){if_blocks[current_block_type_index].p(ctx,dirty);}}else{if(if_block){group_outros();transition_out(if_blocks[previous_block_index],1,1,function(){if_blocks[previous_block_index]=null;});check_outros();}if(~current_block_type_index){if_block=if_blocks[current_block_type_index];if(!if_block){if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);if_block.c();}else{if_block.p(ctx,dirty);}transition_in(if_block,1);if_block.m(div,null);}else{if_block=null;}}if(!current||dirty[1]&/*footerStyle*/1){attr(div,"style",/*footerStyle*/ctx[31]);}},i:function i(local){if(current)return;transition_in(if_block);current=true;},o:function o(local){transition_out(if_block);current=false;},d:function d(detaching){if(detaching)detach(div);if(~current_block_type_index){if_blocks[current_block_type_index].d();}}};}function create_fragment$a(ctx){var util;var current;util=new Util({props:{$$slots:{footer:[create_footer_slot$3],main:[create_main_slot]},$$scope:{ctx:ctx}}});util.$on("measure",/*measure_handler*/ctx[131]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*locale, toolsFiltered, toolActive, shapePresets, enablePresetSelectImage, markupShapeSelected, shapeControls, pingHub, enablePresetDropImage, utilKey, $parentRect, $utilRectPadded, $enablePanInputStatus, imageRotation, imageFlipX, imageFlipY, $isActive, toolSelectRadius, enableButtonFlipVertical, mapScreenPointToImagePoint, mapImagePointToScreenPoint, enableTapToAddText, textInputMode, ping, markupEditor, $shapes*/2146435025|dirty[1]&/*footerStyle, computedScrollElasticity, showToolbar, runWillRenderPresetToolbarHook, shouldRenderPresets, shouldRenderControls, cursor, $rootRect, markupOffset, $imageSelectionZoomCurrent, $isActiveFraction, $rootColorSecondary, toolEraseRadius, layoutEditorHooks, $imageOverlayMarkup, shouldRenderShapeEditor*/65535|dirty[5]&/*$$scope*/512){util_changes.$$scope={dirty:dirty,ctx:ctx};}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}var isPanning=false;function instance$a($$self,$$props,$$invalidate){var toolsFiltered;var hasShapeControls;var showToolbar;var hasTools;var hasActiveTool;var shouldRenderControls;var shouldRenderShapeEditor;var markupOffset;var markupShapeKeys;var markupSelected;var markupEditing;var markupToolShape;var markupToolStylesComputed;var markupShapeSelected;var toolEraseRadius;var shouldRenderPresets;var shouldStickToImage;var userEnabledPanModeWithKeyboard;var userEnabledPanModeWithButton;var enablePanMode;var isEditingText;var cursor;var ping;var computedScrollElasticity;var runWillRenderPresetToolbarHook;var layoutEditorHooks;var footerStyle;var $footerOffset;var $isActive,$$unsubscribe_isActive=noop,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(26,$isActive=$$value);}),isActive;};var $isAnimated;var $shapes,$$unsubscribe_shapes=noop,$$subscribe_shapes=function $$subscribe_shapes(){return $$unsubscribe_shapes(),$$unsubscribe_shapes=subscribe(shapes,function($$value){return $$invalidate(27,$shapes=$$value);}),shapes;};var $env;var $redrawTrigger;var $elasticityMultiplier;var $stageRect;var $imageSelectionZoomCurrent;var $imageSelectionPan;var $stageScalar;var $imageSelectionRect;var $enablePanInputStatus;var $keysPressedStore;var $parentRect,$$unsubscribe_parentRect=noop,$$subscribe_parentRect=function $$subscribe_parentRect(){return $$unsubscribe_parentRect(),$$unsubscribe_parentRect=subscribe(parentRect,function($$value){return $$invalidate(29,$parentRect=$$value);}),parentRect;};var $imageCropRect;var $shapePreprocessor;var $ui;var $utilRectPadded;var $isVisible,$$unsubscribe_isVisible=noop,$$subscribe_isVisible=function $$subscribe_isVisible(){return $$unsubscribe_isVisible(),$$unsubscribe_isVisible=subscribe(isVisible,function($$value){return $$invalidate(118,$isVisible=$$value);}),isVisible;};var $imagePreviewModifiers;var $rootRect;var $imageOverlayMarkup;var $isActiveFraction,$$unsubscribe_isActiveFraction=noop,$$subscribe_isActiveFraction=function $$subscribe_isActiveFraction(){return $$unsubscribe_isActiveFraction(),$$unsubscribe_isActiveFraction=subscribe(isActiveFraction,function($$value){return $$invalidate(45,$isActiveFraction=$$value);}),isActiveFraction;};var $rootColorSecondary;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_shapes();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_parentRect();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_isVisible();});$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActiveFraction();});var isActive=$$props.isActive;$$subscribe_isActive();var isActiveFraction=$$props.isActiveFraction;$$subscribe_isActiveFraction();var isVisible=$$props.isVisible;$$subscribe_isVisible();var stores=$$props.stores;var _$$props$locale7=$$props.locale,locale=_$$props$locale7===void 0?{}:_$$props$locale7;var shapes=$$props.shapes;$$subscribe_shapes();var _$$props$toolbar=$$props.toolbar,toolbar=_$$props$toolbar===void 0?[]:_$$props$toolbar;var _$$props$toolShapes=$$props.toolShapes,toolShapes=_$$props$toolShapes===void 0?{}:_$$props$toolShapes;var _$$props$toolActive=$$props.toolActive,toolActive=_$$props$toolActive===void 0?undefined:_$$props$toolActive;var _$$props$toolSelectRa=$$props.toolSelectRadius,toolSelectRadius=_$$props$toolSelectRa===void 0?undefined:_$$props$toolSelectRa;var _$$props$toolRetainSt=$$props.toolRetainStyles,toolRetainStyles=_$$props$toolRetainSt===void 0?false:_$$props$toolRetainSt;var _$$props$textInputMod2=$$props.textInputMode,textInputMode=_$$props$textInputMod2===void 0?undefined:_$$props$textInputMod2;var _$$props$shapeControl=$$props.shapeControls,shapeControls=_$$props$shapeControl===void 0?{}:_$$props$shapeControl;var _$$props$enableButton5=$$props.enableButtonFlipVertical,enableButtonFlipVertical=_$$props$enableButton5===void 0?false:_$$props$enableButton5;var _$$props$enablePreset2=$$props.enablePresetSelectImage,enablePresetSelectImage=_$$props$enablePreset2===void 0?true:_$$props$enablePreset2;var _$$props$enablePreset3=$$props.enablePresetDropImage,enablePresetDropImage=_$$props$enablePreset3===void 0?true:_$$props$enablePreset3;var _$$props$enableSelect2=$$props.enableSelectToolToAddShape,enableSelectToolToAddShape=_$$props$enableSelect2===void 0?false:_$$props$enableSelect2;var _$$props$enableAutoSe=$$props.enableAutoSelectMoveTool,enableAutoSelectMoveTool=_$$props$enableAutoSe===void 0?['line','arrow','path','rectangle','ellipse','text']:_$$props$enableAutoSe;var _$$props$enableTapToA2=$$props.enableTapToAddText,enableTapToAddText=_$$props$enableTapToA2===void 0?false:_$$props$enableTapToA2;var _$$props$enableMoveTo=$$props.enableMoveTool,enableMoveTool=_$$props$enableMoveTo===void 0?false:_$$props$enableMoveTo;var _$$props$enableViewTo=$$props.enableViewTool,enableViewTool=_$$props$enableViewTo===void 0?false:_$$props$enableViewTo;var _$$props$willRenderPr2=$$props.willRenderPresetToolbar,willRenderPresetToolbar=_$$props$willRenderPr2===void 0?undefined:_$$props$willRenderPr2;var _$$props$willStartInt2=$$props.willStartInteraction,willStartInteraction=_$$props$willStartInt2===void 0?undefined:_$$props$willStartInt2;var _$$props$shapePresets=$$props.shapePresets,shapePresets=_$$props$shapePresets===void 0?[]:_$$props$shapePresets;var utilKey=$$props.utilKey;var mapScreenPointToImagePoint=$$props.mapScreenPointToImagePoint;var mapImagePointToScreenPoint=$$props.mapImagePointToScreenPoint;var _$$props$imageRotatio=$$props.imageRotation,imageRotation=_$$props$imageRotatio===void 0?0:_$$props$imageRotatio;var _$$props$imageFlipX=$$props.imageFlipX,imageFlipX=_$$props$imageFlipX===void 0?false:_$$props$imageFlipX;var _$$props$imageFlipY=$$props.imageFlipY,imageFlipY=_$$props$imageFlipY===void 0?false:_$$props$imageFlipY;var parentRect=$$props.parentRect;$$subscribe_parentRect();var _$$props$hooks=$$props.hooks,hooks=_$$props$hooks===void 0?{}:_$$props$hooks;// context
var isAnimated=getContext('isAnimated');component_subscribe($$self,isAnimated,function(value){return $$invalidate(111,$isAnimated=value);});var elasticityMultiplier=getContext('elasticityMultiplier');component_subscribe($$self,elasticityMultiplier,function(value){return $$invalidate(114,$elasticityMultiplier=value);});var ui=getContext('ui');component_subscribe($$self,ui,function(value){return $$invalidate(140,$ui=value);});// this makes sure tool shapes are only updated when a new tool shapes object is set
var activeToolShapes;// stores
var _stores6=stores,env=_stores6.env,history=_stores6.history,rootRect=_stores6.rootRect,rootColorSecondary=_stores6.rootColorSecondary,enablePanInput=_stores6.enablePanInput,enablePanInputStatus=_stores6.enablePanInputStatus,enableZoomInput=_stores6.enableZoomInput,stageRect=_stores6.stageRect,utilRectPadded=_stores6.utilRectPadded,scrollElasticity=_stores6.scrollElasticity,imageOverlayMarkup=_stores6.imageOverlayMarkup,imagePreviewModifiers=_stores6.imagePreviewModifiers,imageCropRect=_stores6.imageCropRect,shapePreprocessor=_stores6.shapePreprocessor,stageScalar=_stores6.stageScalar,imageSelectionRect=_stores6.imageSelectionRect,imageSelectionZoomCurrent=_stores6.imageSelectionZoomCurrent,imageSelectionPan=_stores6.imageSelectionPan,allowPan=_stores6.allowPan,allowZoom=_stores6.allowZoom,allowZoomControls=_stores6.allowZoomControls;component_subscribe($$self,env,function(value){return $$invalidate(112,$env=value);});component_subscribe($$self,rootRect,function(value){return $$invalidate(43,$rootRect=value);});component_subscribe($$self,rootColorSecondary,function(value){return $$invalidate(46,$rootColorSecondary=value);});component_subscribe($$self,enablePanInputStatus,function(value){return $$invalidate(28,$enablePanInputStatus=value);});component_subscribe($$self,stageRect,function(value){return $$invalidate(115,$stageRect=value);});component_subscribe($$self,utilRectPadded,function(value){return $$invalidate(30,$utilRectPadded=value);});component_subscribe($$self,imageOverlayMarkup,function(value){return $$invalidate(44,$imageOverlayMarkup=value);});component_subscribe($$self,imagePreviewModifiers,function(value){return $$invalidate(119,$imagePreviewModifiers=value);});component_subscribe($$self,imageCropRect,function(value){return $$invalidate(139,$imageCropRect=value);});component_subscribe($$self,shapePreprocessor,function(value){return $$invalidate(117,$shapePreprocessor=value);});component_subscribe($$self,stageScalar,function(value){return $$invalidate(137,$stageScalar=value);});component_subscribe($$self,imageSelectionRect,function(value){return $$invalidate(138,$imageSelectionRect=value);});component_subscribe($$self,imageSelectionZoomCurrent,function(value){return $$invalidate(42,$imageSelectionZoomCurrent=value);});component_subscribe($$self,imageSelectionPan,function(value){return $$invalidate(136,$imageSelectionPan=value);});// remove presets tool if no shape presets defined
var filterTools=function filterTools(toolbar,_ref432){var willRenderPresetToolbar=_ref432.willRenderPresetToolbar,shapePresets=_ref432.shapePresets,enableViewTool=_ref432.enableViewTool,enableMoveTool=_ref432.enableMoveTool;// enableMoveTool
var tools=shapePresets.length===0&&!willRenderPresetToolbar?toolbar.filter(function(tool){return tool[0]!=='preset';}):toolbar;// filter move tool
tools=enableMoveTool?tools:tools.filter(function(tool){return tool[0]!=='move';});// filter view tool
return enableViewTool?tools:tools.filter(function(tool){return tool[0]!=='view';});};var keysPressedStore=getContext('keysPressed');component_subscribe($$self,keysPressedStore,function(value){return $$invalidate(116,$keysPressedStore=value);});var updateActiveTool=function updateActiveTool(_ref433,event){var value=_ref433.value;$$invalidate(0,toolActive=value);// if is keyboard navigating or should add shape
if(enableSelectToolToAddShape||/enter/i.test(event.key)){AddToolDefaultShape(value);}};var AddToolDefaultShape=function AddToolDefaultShape(tool){var _activeToolShapes$too=_slicedToArray(activeToolShapes[tool],2),shape=_activeToolShapes$too[0],options=_activeToolShapes$too[1];var isRelative=options.position==='relative';var shapeToAdd;var size;var x=isRelative?'0%':0;var y=isRelative?'0%':0;if(shapeIsRect(shape)||shapeIsText(shape)){size=isRelative?'20%':$parentRect.width*0.2;shapeToAdd=shapeDeepCopy(shape);shapeToAdd.x=x;shapeToAdd.y=y;shapeUpdateProps(shapeToAdd,{width:size,height:size},$parentRect);}else if(shapeIsEllipse(shape)){size=isRelative?'10%':$parentRect.width*0.1;shapeToAdd=shapeDeepCopy(shape);shapeToAdd.x=x;shapeToAdd.y=y;shapeUpdateProps(shapeToAdd,{rx:size,ry:size},$parentRect);}else if(shapeIsLine(shape)){size=isRelative?'10%':$parentRect.width*0.1;shapeToAdd=shapeDeepCopy(shape);shapeToAdd.x1=x;shapeToAdd.y1=y;shapeToAdd.x2=x;shapeToAdd.y2=y;}if(!shapeToAdd)return;Promise.resolve().then(function(){addShape(createShapeAtPosition(shapeToAdd,undefined,size));});};var mapScreenEventToImagePoint=function mapScreenEventToImagePoint(e){return mapScreenPointToImagePoint(getEventPositionInEditor(e,$rootRect));};// A reference to the markup editor, we need this so we can call exported functions
var markupEditor;// the current tool styles
var markupToolStyles={};//
// Create new shape
//
var interactionHandler;var handleInteractionStart=function handleInteractionStart(e){if(toolActive==='eraser'){interactionHandler=markupEditor.eraseShape();}else if(toolActive&&activeToolShapes[toolActive]){var _activeToolShapes$too2=_slicedToArray(activeToolShapes[toolActive],2),shape=_activeToolShapes$too2[0],options=_activeToolShapes$too2[1];interactionHandler=markupEditor.createShape(_objectSpread(_objectSpread({},shape),markupToolStylesComputed),options);}else{interactionHandler=undefined;}if(!interactionHandler)return false;interactionHandler.start(e);return true;};var handleInteractionUpdate=function handleInteractionUpdate(e){if(!interactionHandler)return false;interactionHandler.update(e);return true;};var handleInteractionRelease=function handleInteractionRelease(e){if(!interactionHandler)return false;interactionHandler.release(e);return true;};var handleInteractionCancel=function handleInteractionCancel(e){if(!interactionHandler)return false;interactionHandler.cancel(e);interactionHandler=undefined;return true;};var handleInteractionEnd=function handleInteractionEnd(e){if(!interactionHandler)return false;interactionHandler.end(e);interactionHandler=undefined;// when a shape is built with multiple clicks a draft might still be active
var draft=markupEditor.getMarkupItemDraft();// always fall back to move when done with current tool
var canSwitchToMoveTool=enableMoveTool&&(enableAutoSelectMoveTool===true||Array.isArray(enableAutoSelectMoveTool)&&enableAutoSelectMoveTool.includes(toolActive));// should switch back to move tool if draft is finished OR if draft is there and is text editing
if((!draft||draft.isEditing)&&canSwitchToMoveTool){$$invalidate(0,toolActive='move');}return true;};var confirmDraft=function confirmDraft(draft){var isPolygon=shapeIsPath(draft)&&hasProp(draft,'pathClose');if(!isPolygon)return;//  show stroke color
var strokeColor=_toConsumableArray(draft.strokeColor);strokeColor[3]=1;// update the draft shape
markupEditor.updateMarkupShape(draft,{// don't close this path
pathClose:false,// wait with sync till confirm
// set opaque stroke color
strokeColor:strokeColor},false);// wait with sync till confirm
markupEditor.removeMarkupShapeProps(draft,['backgroundColor'],false);// wait with sync till confirm
markupEditor.confirmMarkupItemDraft();markupEditor.selectShape(draft);};var handleKey=function handleKey(e){var key=e.key;var draft=markupEditor.getMarkupItemDraft();if(/escape/i.test(key)&&draft){e.preventDefault();e.stopPropagation();markupEditor.discardMarkupItemDraft();interactionHandler=undefined;}if(/enter/i.test(key)&&draft){e.preventDefault();e.stopPropagation();confirmDraft(draft);interactionHandler=undefined;}};var blurOnToolSwitch=function blurOnToolSwitch(){if(!markupEditor||toolActive==='move')return;markupEditor.blurShapes();};var getStoredStyles=function getStoredStyles(){return $ui[utilKey]?$ui[utilKey][toolActive]:{};};// if toolShapes are updated we reset the current tool styles as chose by the user, this allows us to set styles programatically
var didUpdateToolShapes=function didUpdateToolShapes(){$$invalidate(96,markupToolStyles={});};var updateInterfaceState=function updateInterfaceState(util,tool,computedStyles){var utilObj=$ui[util];var toolObj=utilObj?utilObj[tool]:{};ui.set(_objectSpread(_objectSpread({},$ui),{},_defineProperty({},util,_objectSpread(_objectSpread({},utilObj),{},_defineProperty({},tool,_objectSpread(_objectSpread({},toolObj),computedStyles))))));};var resetInterfaceState=function resetInterfaceState(util){ui.set(_defineProperty({},util,{}));};var updateWriteHistoryTimeoutId;function handleUpdateSelectedMarkupShape(props){// remember style for when creating or styling other element
Object.keys(props).forEach(function(key){return $$invalidate(96,markupToolStyles[key]=props[key],markupToolStyles);});// fire event
ping('selectstyle',props);// it's possible we're only updating default styles
if(!markupSelected)return;// update element
markupEditor.updateMarkupShape(markupSelected,props);// update markup style with delay so we don't write every state change to history (mainly relevant for color changes when dragging color)
clearTimeout(updateWriteHistoryTimeoutId);updateWriteHistoryTimeoutId=setTimeout(function(){handleMarkupUpdate();},200);}var hoverShape;/*

let eraserShape = {
    id: 'markup-eraser',
    x: 0,
    y: 0,
    rx: 0,
    ry: 0,
    strokeWidth: 0.5,
    strokeColor: [0, 0, 0],
};

const handleHoverCanvas = (canvasPosition, imagePosition) => {
    $imageOverlayMarkup = [
        ...$imageOverlayMarkup.filter((shape) => shape.id !== 'markup-eraser'),
    ];

    if (!vectorInSize(imagePosition, $imageSize)) return;

    const computedEraserRadius = toolEraseRadius * $presentationScalar;

    if (toolActive !== 'eraser' || computedEraserRadius < 8) return;

    const shape = { ...eraserShape };
    shape.x = canvasPosition.x;
    shape.y = canvasPosition.y;
    shape.rx = shape.ry = computedEraserRadius;

    const shapeShadow = { ...eraserShape };
    shapeShadow.x = canvasPosition.x;
    shapeShadow.y = canvasPosition.y;
    shapeShadow.strokeWidth = 3;
    shapeShadow.strokeColor = [1, 1, 1];
    shapeShadow.opacity = 0.25;
    shapeShadow.rx = shapeShadow.ry = shape.rx;

    $imageOverlayMarkup = [
        ...$imageOverlayMarkup.filter((shape) => shape.id !== 'markup-eraser'),
        shapeShadow,
        shape,
    ];
};
*/var handleTapCanvas=function handleTapCanvas(details){return ping('markuptap',details);};var handleHoverShape=function handleHoverShape(shape){return $$invalidate(97,hoverShape=shape);};var getCursor=function getCursor(shapeUnderPointer,shapeSelected,panInputEnabled,isPanning,currentActiveTool)// computedEraserRadius
{// hide cursor if eraser radius is set
if(panInputEnabled)return isPanning?'grabbing':'grab';// no shape, return crosshair
if(!shapeUnderPointer)return currentActiveTool==='move'?'default':'crosshair';// treat both as the same shape
var shape=shapeUnderPointer||shapeSelected;// can select (else won't hover)
if(!shapeIsSelected(shape))return'default';// show text input cursor
if(shapeIsEditing(shape)){if(textInputMode==='modal')return'default';return'text';}// show move cursor
if(shapeCanMove(shape))return'move';// can't move
return'default';};var createShapeAtPosition=function createShapeAtPosition(shape,position,size){// position defaults to crop center
var positionIsCenter=false;if(!position){// is centering to stage
positionIsCenter=true;// calculate image or rect position
position=shouldStickToImage?mapScreenPointToImagePoint(rectCenter($stageRect)):rectCenter($imageCropRect);}// adjust offset if parent rect is image crop rect
position.x-=$parentRect.x||0;position.y-=$parentRect.y||0;// de-flip shape
if(imageFlipX||imageFlipY){shape.flipX=imageFlipX;shape.flipY=imageFlipY;}// reposition if there's already shapes at position and shape isn't full screen
var shapesAlreadyAtPosition=markupEditor.getShapesNearPosition(position);if(positionIsCenter&&shapesAlreadyAtPosition.length){var dist=Math.min($imageCropRect.width,$imageCropRect.height)*0.1;position.x+=Math.round(-dist+Math.random()*dist*2);position.y+=Math.round(-dist+Math.random()*dist*2);}// de-rotate shape
if(imageRotation!==0){if(imageFlipX&&imageFlipY)shape.rotation=-imageRotation;else if(imageFlipX)shape.rotation=imageRotation;else if(imageFlipY)shape.rotation=imageRotation;else shape.rotation=-imageRotation;}if(hasProp(shape,'width')&&hasProp(shape,'height')){var _shapeGetPropsPixelVa=shapeGetPropsPixelValues(shape,['width','height'],$parentRect),_width9=_shapeGetPropsPixelVa.width,_height9=_shapeGetPropsPixelVa.height;shapeUpdateProps(shape,{x:position.x-_width9*0.5,y:position.y-_height9*0.5},$parentRect);}else if(shapeIsEllipse(shape)){shapeUpdateProps(shape,{x:position.x,y:position.y},$parentRect);}else if(shapeIsLine(shape)){var _shapeGetPropsPixelVa2=shapeGetPropsPixelValues(shape,['x1','y1','x2','y2'],$parentRect),x1=_shapeGetPropsPixelVa2.x1,y1=_shapeGetPropsPixelVa2.y1,x2=_shapeGetPropsPixelVa2.x2,y2=_shapeGetPropsPixelVa2.y2;var _dist=vectorDistance(vectorCreate(x1,y1),vectorCreate(x2,y2));var l=isString(size)?toPixelValue(size,$parentRect.width):_dist;shapeUpdateProps(shape,{x1:position.x-l,y1:position.y+l,x2:position.x+l,y2:position.y-l},$parentRect);}else if(shapeIsPath(shape)){var _shapeGetPropsPixelVa3=shapeGetPropsPixelValues(shape,['points'],$parentRect),points=_shapeGetPropsPixelVa3.points;var center=vectorCenter(points);shapeUpdateProps(shape,{points:points.map(function(point){return{x:point.x+position.x-center.x,y:point.y+position.y-center.y};})},$parentRect);}return shape;};var addPreset=function addPreset(preset,position){var shape=createShapeAtPosition(shapeCreateFromPreset(preset,$imageCropRect),position);// force position
if(preset.shape){if(hasProp(preset.shape,'x'))shape.x=preset.shape.x;if(hasProp(preset.shape,'y'))shape.y=preset.shape.y;}return addShape(shape);};var addShape=function addShape(shape){var _hooks=hooks,_hooks$beforeAddShape=_hooks.beforeAddShape,beforeAddShape=_hooks$beforeAddShape===void 0?function(){return true;}:_hooks$beforeAddShape;if(!beforeAddShape(shape))return;markupEditor.addShape(shape);markupEditor.selectShape(shape);history.write();ping('addshape',shape);return shape;};var dragCancelled=false;var handleGrabPreset=function handleGrabPreset(){dragCancelled=false;};var handleDragPreset=function handleDragPreset(preset,e){if(dragCancelled)return;var _hooks2=hooks,_hooks2$beforeAddShap=_hooks2.beforeAddShape,beforeAddShape=_hooks2$beforeAddShap===void 0?function(){return true;}:_hooks2$beforeAddShap;var position=mapScreenEventToImagePoint(e);// create or update if is inside image
var draft=markupEditor.getMarkupItemDraft();var inCropRect=rectContainsPoint($imageCropRect,{// adjust offset if parent rect is image crop rect
x:position.x+($parentRect.x||0),y:position.y+($parentRect.y||0)});// remove draft if not dragging inside image
if(draft&&!inCropRect)markupEditor.discardMarkupItemDraft();// stop here if we're not in the crop rect
if(!inCropRect)return;// create draft shape
if(!draft){var presetShape=shapeCreateFromPreset(preset,$imageCropRect);var shape=createShapeAtPosition(presetShape,position);if(!beforeAddShape(shape)){dragCancelled=true;e.preventDefault();return;}shapeMakeDraft(shape);markupEditor.addShape(shape);return;}// center shape on pointer if it has dimensions
if(shapeIsRect(draft)){position.x-=draft.width*0.5;position.y-=draft.height*0.5;}// force position
if(preset.shape){if(hasProp(preset.shape,'x'))position.x=preset.shape.x;if(hasProp(preset.shape,'y'))position.y=preset.shape.y;}// update the draft shape
markupEditor.updateMarkupShape(draft,position);};var handleDropPreset=function handleDropPreset(_,e){if(dragCancelled)return;var position=mapScreenEventToImagePoint(e);if(!rectContainsPoint($imageCropRect,{x:position.x+($parentRect.x||0),y:position.y+($parentRect.y||0)})){markupEditor.discardMarkupItemDraft();return;}// confirm shape
var shape=markupEditor.confirmMarkupItemDraft();markupEditor.selectShape(shape);// shape added
ping('addshape',shape);// update history
history.write();};var handleAddPreset=function handleAddPreset(preset){return addPreset(preset);};var handleAddFiles=function handleAddFiles(files,position){return files.forEach(function(file){return addPreset(file,position);});};var handleDropFiles=function handleDropFiles(e){return handleAddFiles(e.detail.resources,mapScreenEventToImagePoint(e.detail.event));};//#endregion
var handleWillStartInteraction=function handleWillStartInteraction(position){if(!willStartInteraction)return true;// calculate current image selection rect
var selectionRect=rectClone($imageSelectionRect);rectScale(selectionRect,1/$stageScalar);rectTranslate(selectionRect,$imageSelectionPan);rectScale(selectionRect,$imageSelectionZoomCurrent);// should return true if interaction is allowed
return willStartInteraction(position,_objectSpread(_objectSpread({},selectionRect),{},{x:selectionRect.x+$stageRect.x,y:selectionRect.y+$stageRect.y}));};//
// History
//
var handleMarkupUpdate=function handleMarkupUpdate(){history.write();};// used to fire ping events from
var pingHub;var redrawTrigger=getContext('redrawTrigger');component_subscribe($$self,redrawTrigger,function(value){return $$invalidate(113,$redrawTrigger=value);});//
// confirm draft text when leaving view
//
var toggleShapePrerendering=function toggleShapePrerendering(active){if(!shapes)return;shapes.set($shapes.map(function(shape){shape._prerender=active?shapeIsEditing(shape):false;return shape;}));};//
// Footer style
//
var footerOffset=spring($isAnimated?20:0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(110,$footerOffset=value);});function measure_handler_1(event){bubble.call(this,$$self,event);}var func=function func(option){return option[0]===toolActive;};var func_1=function func_1(shape){ping('addshape',shape);handleMarkupUpdate();};var func_2=function func_2(shape){ping('selectshape',shape);};var func_3=function func_3(shape){ping('tapshape',shape);};var func_4=function func_4(shape){ping('updateshape',shape);handleMarkupUpdate();};var func_5=function func_5(shape){ping('removeshape',shape);handleMarkupUpdate();};function shapelayouteditor_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){markupEditor=$$value;$$invalidate(21,markupEditor);});}function shapelayouteditor_markup_binding(value){$shapes=value;shapes.set($shapes);}function shapelayouteditor_ui_binding(value){$imageOverlayMarkup=value;imageOverlayMarkup.set($imageOverlayMarkup);}function div_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){pingHub=$$value;$$invalidate(22,pingHub);});}function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('isActive'in $$props)$$subscribe_isActive($$invalidate(1,isActive=$$props.isActive));if('isActiveFraction'in $$props)$$subscribe_isActiveFraction($$invalidate(2,isActiveFraction=$$props.isActiveFraction));if('isVisible'in $$props)$$subscribe_isVisible($$invalidate(3,isVisible=$$props.isVisible));if('stores'in $$props)$$invalidate(84,stores=$$props.stores);if('locale'in $$props)$$invalidate(4,locale=$$props.locale);if('shapes'in $$props)$$subscribe_shapes($$invalidate(5,shapes=$$props.shapes));if('toolbar'in $$props)$$invalidate(85,toolbar=$$props.toolbar);if('toolShapes'in $$props)$$invalidate(86,toolShapes=$$props.toolShapes);if('toolActive'in $$props)$$invalidate(0,toolActive=$$props.toolActive);if('toolSelectRadius'in $$props)$$invalidate(6,toolSelectRadius=$$props.toolSelectRadius);if('toolRetainStyles'in $$props)$$invalidate(87,toolRetainStyles=$$props.toolRetainStyles);if('textInputMode'in $$props)$$invalidate(7,textInputMode=$$props.textInputMode);if('shapeControls'in $$props)$$invalidate(8,shapeControls=$$props.shapeControls);if('enableButtonFlipVertical'in $$props)$$invalidate(9,enableButtonFlipVertical=$$props.enableButtonFlipVertical);if('enablePresetSelectImage'in $$props)$$invalidate(10,enablePresetSelectImage=$$props.enablePresetSelectImage);if('enablePresetDropImage'in $$props)$$invalidate(11,enablePresetDropImage=$$props.enablePresetDropImage);if('enableSelectToolToAddShape'in $$props)$$invalidate(88,enableSelectToolToAddShape=$$props.enableSelectToolToAddShape);if('enableAutoSelectMoveTool'in $$props)$$invalidate(89,enableAutoSelectMoveTool=$$props.enableAutoSelectMoveTool);if('enableTapToAddText'in $$props)$$invalidate(12,enableTapToAddText=$$props.enableTapToAddText);if('enableMoveTool'in $$props)$$invalidate(90,enableMoveTool=$$props.enableMoveTool);if('enableViewTool'in $$props)$$invalidate(91,enableViewTool=$$props.enableViewTool);if('willRenderPresetToolbar'in $$props)$$invalidate(92,willRenderPresetToolbar=$$props.willRenderPresetToolbar);if('willStartInteraction'in $$props)$$invalidate(93,willStartInteraction=$$props.willStartInteraction);if('shapePresets'in $$props)$$invalidate(13,shapePresets=$$props.shapePresets);if('utilKey'in $$props)$$invalidate(14,utilKey=$$props.utilKey);if('mapScreenPointToImagePoint'in $$props)$$invalidate(15,mapScreenPointToImagePoint=$$props.mapScreenPointToImagePoint);if('mapImagePointToScreenPoint'in $$props)$$invalidate(16,mapImagePointToScreenPoint=$$props.mapImagePointToScreenPoint);if('imageRotation'in $$props)$$invalidate(17,imageRotation=$$props.imageRotation);if('imageFlipX'in $$props)$$invalidate(18,imageFlipX=$$props.imageFlipX);if('imageFlipY'in $$props)$$invalidate(19,imageFlipY=$$props.imageFlipY);if('parentRect'in $$props)$$subscribe_parentRect($$invalidate(20,parentRect=$$props.parentRect));if('hooks'in $$props)$$invalidate(94,hooks=$$props.hooks);};$$self.$$.update=function(){if($$self.$$.dirty[2]&/*toolShapes*/16777216|$$self.$$.dirty[3]&/*activeToolShapes*/4){if(!activeToolShapes||toolShapes!==activeToolShapes){$$invalidate(95,activeToolShapes=toolShapes);}}if($$self.$$.dirty[0]&/*$isActive*/67108864){// enable pan and zoom for shape manipulation plugins
allowPan.set($isActive);}if($$self.$$.dirty[0]&/*$isActive*/67108864){allowZoom.set($isActive);}if($$self.$$.dirty[0]&/*$isActive*/67108864){allowZoomControls.set($isActive);}if($$self.$$.dirty[0]&/*shapePresets*/8192|$$self.$$.dirty[2]&/*toolbar, willRenderPresetToolbar, enableMoveTool, enableViewTool*/1887436800){$$invalidate(25,toolsFiltered=filterTools(toolbar,{willRenderPresetToolbar:willRenderPresetToolbar,shapePresets:shapePresets,enableMoveTool:enableMoveTool,enableViewTool:enableViewTool}));}if($$self.$$.dirty[0]&/*shapeControls*/256){$$invalidate(107,hasShapeControls=Object.keys(shapeControls).length);}if($$self.$$.dirty[0]&/*toolsFiltered*/33554432){$$invalidate(41,showToolbar=toolsFiltered.length>1);}if($$self.$$.dirty[0]&/*toolsFiltered*/33554432){$$invalidate(108,hasTools=!!toolsFiltered.length);}if($$self.$$.dirty[0]&/*toolActive, toolsFiltered*/33554433|$$self.$$.dirty[3]&/*hasTools*/32768){// set to first tool in toolbar list if not defined
if(hasTools&&toolActive===undefined)$$invalidate(0,toolActive=toolsFiltered[0][0]);}if($$self.$$.dirty[0]&/*toolActive*/1){$$invalidate(109,hasActiveTool=toolActive!==undefined);}if($$self.$$.dirty[3]&/*hasActiveTool, hasTools, hasShapeControls*/114688){$$invalidate(40,shouldRenderControls=(!hasActiveTool||hasTools)&&hasShapeControls);}if($$self.$$.dirty[0]&/*pingHub*/4194304){$$invalidate(23,ping=pingHub&&createPingDispatcher(pingHub));}if($$self.$$.dirty[0]&/*$isActive, ping, toolActive*/75497473){$isActive&&ping&&ping('selectcontrol',toolActive);}if($$self.$$.dirty[0]&/*$isActive, utilKey*/67125248|$$self.$$.dirty[3]&/*$imagePreviewModifiers*/67108864){//
// enable seeing the markup outlines outside of the crop area
//
if($isActive){set_store_value(imagePreviewModifiers,$imagePreviewModifiers[utilKey]={maskMarkupOpacity:0.85},$imagePreviewModifiers);}else{delete $imagePreviewModifiers[utilKey];}}if($$self.$$.dirty[0]&/*toolActive, markupEditor*/2097153){if(toolActive&&markupEditor){var draft=markupEditor.getMarkupItemDraft();if(draft)confirmDraft(draft);}}if($$self.$$.dirty[0]&/*toolActive*/1){if(toolActive)blurOnToolSwitch();}if($$self.$$.dirty[0]&/*$isActive*/67108864|$$self.$$.dirty[3]&/*$isVisible*/33554432){$$invalidate(39,shouldRenderShapeEditor=$isActive&&$isVisible);}if($$self.$$.dirty[0]&/*$utilRectPadded*/1073741824|$$self.$$.dirty[3]&/*$stageRect*/4194304){$$invalidate(38,markupOffset=$utilRectPadded&&vectorCreate($stageRect.x-$utilRectPadded.x,$stageRect.y-$utilRectPadded.y));}if($$self.$$.dirty[0]&/*shapeControls*/256){$$invalidate(106,markupShapeKeys=Object.keys(shapeControls));}if($$self.$$.dirty[0]&/*$isActive, $shapes*/201326592){$$invalidate(98,markupSelected=$isActive&&$shapes.filter(shapeIsSelected)[0]);}if($$self.$$.dirty[0]&/*$isActive, $shapes*/201326592){$$invalidate(101,markupEditing=$isActive&&$shapes.find(function(shape){return shapeIsEditing(shape);}));}if($$self.$$.dirty[0]&/*$isActive, toolActive*/67108865|$$self.$$.dirty[3]&/*activeToolShapes*/4){$$invalidate(104,markupToolShape=$isActive&&activeToolShapes[toolActive]?shapeFormat(shapeDeepCopy(_objectSpread(_objectSpread({},activeToolShapes[toolActive][0]),getStoredStyles()))):{});}if($$self.$$.dirty[3]&/*activeToolShapes*/4){if(activeToolShapes)didUpdateToolShapes();}if($$self.$$.dirty[3]&/*markupToolShape, markupShapeKeys, markupToolStyles*/10248){// compute markup styles
$$invalidate(105,markupToolStylesComputed=markupToolShape&&Object.keys(markupToolShape).reduce(function(prev,key){var isDisableStyleProp=key==='disableStyle';var isStylableProp=markupShapeKeys.find(function(shapeKey){return shapeKey.split('_').includes(key);});// skip props that can't be styled, but keep all `disable` props
if(!isDisableStyleProp&&!isStylableProp)return prev;// skip props that are set to undefined, this means they won't auto-inherit current styles (line won't inherit line ends)
if(markupToolShape[key]===undefined)return prev;// apply this style
prev[key]=hasProp(markupToolStyles,key)?markupToolStyles[key]:markupToolShape[key];return prev;},{}));}if($$self.$$.dirty[0]&/*utilKey, toolActive*/16385|$$self.$$.dirty[2]&/*toolRetainStyles*/33554432|$$self.$$.dirty[3]&/*markupToolStylesComputed*/4096){toolRetainStyles?updateInterfaceState(utilKey,toolActive,markupToolStylesComputed):resetInterfaceState(utilKey);}if($$self.$$.dirty[0]&/*$isActive*/67108864|$$self.$$.dirty[3]&/*markupSelected, markupToolStylesComputed*/4128){$$invalidate(24,markupShapeSelected=$isActive?markupSelected||markupToolStylesComputed:undefined);}if($$self.$$.dirty[0]&/*markupShapeSelected*/16777216|$$self.$$.dirty[3]&/*$shapePreprocessor*/16777216){// TODO: remove temporary warning while everyone switches to 8.7.0+
if(markupShapeSelected&&markupShapeSelected.lineEnd&&!$shapePreprocessor){console.warn("Set shapePreprocessor property to draw lineStart and lineEnd styles.\nhttps://pqina.nl/pintura/docs/v8/api/exports/#createshapepreprocessor");}}if($$self.$$.dirty[3]&/*markupToolShape, markupToolStylesComputed*/6144){$$invalidate(37,toolEraseRadius=markupToolShape&&isNumber(markupToolShape.eraseRadius)?(markupToolStylesComputed||markupToolShape).eraseRadius:undefined);}if($$self.$$.dirty[0]&/*toolActive, shapePresets, enablePresetSelectImage*/9217|$$self.$$.dirty[2]&/*willRenderPresetToolbar*/1073741824){//
// presets
//
$$invalidate(36,shouldRenderPresets=toolActive==='preset'&&(shapePresets.length>0||enablePresetSelectImage||willRenderPresetToolbar));}if($$self.$$.dirty[0]&/*$parentRect*/536870912){// if parent rect is a `Size` we're sticking presets to the image context
shouldStickToImage=!hasProp($parentRect,'x')&&!hasProp($parentRect,'y');}if($$self.$$.dirty[0]&/*$isActive*/67108864|$$self.$$.dirty[3]&/*$keysPressedStore*/8388608){//#region Pan and Zoom
$$invalidate(102,userEnabledPanModeWithKeyboard=$isActive&&$keysPressedStore&&$keysPressedStore[0]===32);}if($$self.$$.dirty[0]&/*$isActive, toolActive*/67108865){$$invalidate(103,userEnabledPanModeWithButton=$isActive&&toolActive==='view');}if($$self.$$.dirty[3]&/*userEnabledPanModeWithButton, userEnabledPanModeWithKeyboard*/1536){$$invalidate(100,enablePanMode=userEnabledPanModeWithButton||userEnabledPanModeWithKeyboard);}if($$self.$$.dirty[3]&/*markupEditing*/256){$$invalidate(99,isEditingText=!!markupEditing);}if($$self.$$.dirty[0]&/*$isActive*/67108864|$$self.$$.dirty[3]&/*enablePanMode, isEditingText*/192){enablePanInput.set($isActive?enablePanMode&&!isEditingText:true);}if($$self.$$.dirty[0]&/*$isActive*/67108864|$$self.$$.dirty[3]&/*isEditingText*/64){enableZoomInput.set($isActive?!isEditingText:true);}if($$self.$$.dirty[0]&/*$enablePanInputStatus, toolActive*/268435457|$$self.$$.dirty[3]&/*hoverShape, markupSelected*/48){$$invalidate(35,cursor=getCursor(hoverShape,markupSelected,$enablePanInputStatus,isPanning,toolActive));}if($$self.$$.dirty[3]&/*$elasticityMultiplier*/2097152){//
// scroll components
//
$$invalidate(34,computedScrollElasticity=$elasticityMultiplier*scrollElasticity);}if($$self.$$.dirty[2]&/*willRenderPresetToolbar*/1073741824|$$self.$$.dirty[3]&/*$redrawTrigger, $env*/1572864){$$invalidate(33,runWillRenderPresetToolbarHook=$redrawTrigger&&willRenderPresetToolbar?function(toolbar){return runSafe(function(){return willRenderPresetToolbar(toolbar,addPreset,_objectSpread({},$env),function(){return redrawTrigger.set({});});});}:passthrough);}if($$self.$$.dirty[3]&/*hooks*/2){//
// filter out beforeAdd hook
//
$$invalidate(32,layoutEditorHooks=Object.keys(hooks).reduce(function(prev,curr){if(curr==='beforeAddShape'||hooks[curr]===undefined)return prev;prev[curr]=hooks[curr];return prev;},{}));}if($$self.$$.dirty[0]&/*$isActive*/67108864){toggleShapePrerendering($isActive);}if($$self.$$.dirty[0]&/*$isActive*/67108864|$$self.$$.dirty[3]&/*$isAnimated*/262144){$isAnimated&&footerOffset.set($isActive?0:20);}if($$self.$$.dirty[3]&/*$footerOffset*/131072){$$invalidate(31,footerStyle=$footerOffset?"transform: translateY(".concat($footerOffset,"px)"):undefined);}};return[toolActive,isActive,isActiveFraction,isVisible,locale,shapes,toolSelectRadius,textInputMode,shapeControls,enableButtonFlipVertical,enablePresetSelectImage,enablePresetDropImage,enableTapToAddText,shapePresets,utilKey,mapScreenPointToImagePoint,mapImagePointToScreenPoint,imageRotation,imageFlipX,imageFlipY,parentRect,markupEditor,pingHub,ping,markupShapeSelected,toolsFiltered,$isActive,$shapes,$enablePanInputStatus,$parentRect,$utilRectPadded,footerStyle,layoutEditorHooks,runWillRenderPresetToolbarHook,computedScrollElasticity,cursor,shouldRenderPresets,toolEraseRadius,markupOffset,shouldRenderShapeEditor,shouldRenderControls,showToolbar,$imageSelectionZoomCurrent,$rootRect,$imageOverlayMarkup,$isActiveFraction,$rootColorSecondary,isAnimated,elasticityMultiplier,ui,env,rootRect,rootColorSecondary,enablePanInputStatus,stageRect,utilRectPadded,imageOverlayMarkup,imagePreviewModifiers,imageCropRect,shapePreprocessor,stageScalar,imageSelectionRect,imageSelectionZoomCurrent,imageSelectionPan,keysPressedStore,updateActiveTool,handleInteractionStart,handleInteractionUpdate,handleInteractionRelease,handleInteractionCancel,handleInteractionEnd,handleKey,handleUpdateSelectedMarkupShape,handleTapCanvas,handleHoverShape,handleGrabPreset,handleDragPreset,handleDropPreset,handleAddPreset,handleDropFiles,handleWillStartInteraction,handleMarkupUpdate,redrawTrigger,footerOffset,stores,toolbar,toolShapes,toolRetainStyles,enableSelectToolToAddShape,enableAutoSelectMoveTool,enableMoveTool,enableViewTool,willRenderPresetToolbar,willStartInteraction,hooks,activeToolShapes,markupToolStyles,hoverShape,markupSelected,isEditingText,enablePanMode,markupEditing,userEnabledPanModeWithKeyboard,userEnabledPanModeWithButton,markupToolShape,markupToolStylesComputed,markupShapeKeys,hasShapeControls,hasTools,hasActiveTool,$footerOffset,$isAnimated,$env,$redrawTrigger,$elasticityMultiplier,$stageRect,$keysPressedStore,$shapePreprocessor,$isVisible,$imagePreviewModifiers,measure_handler_1,func,func_1,func_2,func_3,func_4,func_5,shapelayouteditor_binding,shapelayouteditor_markup_binding,shapelayouteditor_ui_binding,div_binding,measure_handler];}var ShapeUtil=/*#__PURE__*/function(_SvelteComponent44){_inherits(ShapeUtil,_SvelteComponent44);var _super45=_createSuper(ShapeUtil);function ShapeUtil(options){var _this46;_classCallCheck(this,ShapeUtil);_this46=_super45.call(this);init(_assertThisInitialized(_this46),options,instance$a,create_fragment$a,safe_not_equal,{isActive:1,isActiveFraction:2,isVisible:3,stores:84,locale:4,shapes:5,toolbar:85,toolShapes:86,toolActive:0,toolSelectRadius:6,toolRetainStyles:87,textInputMode:7,shapeControls:8,enableButtonFlipVertical:9,enablePresetSelectImage:10,enablePresetDropImage:11,enableSelectToolToAddShape:88,enableAutoSelectMoveTool:89,enableTapToAddText:12,enableMoveTool:90,enableViewTool:91,willRenderPresetToolbar:92,willStartInteraction:93,shapePresets:13,utilKey:14,mapScreenPointToImagePoint:15,mapImagePointToScreenPoint:16,imageRotation:17,imageFlipX:18,imageFlipY:19,parentRect:20,hooks:94},null,[-1,-1,-1,-1,-1,-1]);return _this46;}_createClass(ShapeUtil,[{key:"isActive",get:function get(){return this.$$.ctx[1];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"isActiveFraction",get:function get(){return this.$$.ctx[2];},set:function set(isActiveFraction){this.$$set({isActiveFraction:isActiveFraction});flush();}},{key:"isVisible",get:function get(){return this.$$.ctx[3];},set:function set(isVisible){this.$$set({isVisible:isVisible});flush();}},{key:"stores",get:function get(){return this.$$.ctx[84];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"locale",get:function get(){return this.$$.ctx[4];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"shapes",get:function get(){return this.$$.ctx[5];},set:function set(shapes){this.$$set({shapes:shapes});flush();}},{key:"toolbar",get:function get(){return this.$$.ctx[85];},set:function set(toolbar){this.$$set({toolbar:toolbar});flush();}},{key:"toolShapes",get:function get(){return this.$$.ctx[86];},set:function set(toolShapes){this.$$set({toolShapes:toolShapes});flush();}},{key:"toolActive",get:function get(){return this.$$.ctx[0];},set:function set(toolActive){this.$$set({toolActive:toolActive});flush();}},{key:"toolSelectRadius",get:function get(){return this.$$.ctx[6];},set:function set(toolSelectRadius){this.$$set({toolSelectRadius:toolSelectRadius});flush();}},{key:"toolRetainStyles",get:function get(){return this.$$.ctx[87];},set:function set(toolRetainStyles){this.$$set({toolRetainStyles:toolRetainStyles});flush();}},{key:"textInputMode",get:function get(){return this.$$.ctx[7];},set:function set(textInputMode){this.$$set({textInputMode:textInputMode});flush();}},{key:"shapeControls",get:function get(){return this.$$.ctx[8];},set:function set(shapeControls){this.$$set({shapeControls:shapeControls});flush();}},{key:"enableButtonFlipVertical",get:function get(){return this.$$.ctx[9];},set:function set(enableButtonFlipVertical){this.$$set({enableButtonFlipVertical:enableButtonFlipVertical});flush();}},{key:"enablePresetSelectImage",get:function get(){return this.$$.ctx[10];},set:function set(enablePresetSelectImage){this.$$set({enablePresetSelectImage:enablePresetSelectImage});flush();}},{key:"enablePresetDropImage",get:function get(){return this.$$.ctx[11];},set:function set(enablePresetDropImage){this.$$set({enablePresetDropImage:enablePresetDropImage});flush();}},{key:"enableSelectToolToAddShape",get:function get(){return this.$$.ctx[88];},set:function set(enableSelectToolToAddShape){this.$$set({enableSelectToolToAddShape:enableSelectToolToAddShape});flush();}},{key:"enableAutoSelectMoveTool",get:function get(){return this.$$.ctx[89];},set:function set(enableAutoSelectMoveTool){this.$$set({enableAutoSelectMoveTool:enableAutoSelectMoveTool});flush();}},{key:"enableTapToAddText",get:function get(){return this.$$.ctx[12];},set:function set(enableTapToAddText){this.$$set({enableTapToAddText:enableTapToAddText});flush();}},{key:"enableMoveTool",get:function get(){return this.$$.ctx[90];},set:function set(enableMoveTool){this.$$set({enableMoveTool:enableMoveTool});flush();}},{key:"enableViewTool",get:function get(){return this.$$.ctx[91];},set:function set(enableViewTool){this.$$set({enableViewTool:enableViewTool});flush();}},{key:"willRenderPresetToolbar",get:function get(){return this.$$.ctx[92];},set:function set(willRenderPresetToolbar){this.$$set({willRenderPresetToolbar:willRenderPresetToolbar});flush();}},{key:"willStartInteraction",get:function get(){return this.$$.ctx[93];},set:function set(willStartInteraction){this.$$set({willStartInteraction:willStartInteraction});flush();}},{key:"shapePresets",get:function get(){return this.$$.ctx[13];},set:function set(shapePresets){this.$$set({shapePresets:shapePresets});flush();}},{key:"utilKey",get:function get(){return this.$$.ctx[14];},set:function set(utilKey){this.$$set({utilKey:utilKey});flush();}},{key:"mapScreenPointToImagePoint",get:function get(){return this.$$.ctx[15];},set:function set(mapScreenPointToImagePoint){this.$$set({mapScreenPointToImagePoint:mapScreenPointToImagePoint});flush();}},{key:"mapImagePointToScreenPoint",get:function get(){return this.$$.ctx[16];},set:function set(mapImagePointToScreenPoint){this.$$set({mapImagePointToScreenPoint:mapImagePointToScreenPoint});flush();}},{key:"imageRotation",get:function get(){return this.$$.ctx[17];},set:function set(imageRotation){this.$$set({imageRotation:imageRotation});flush();}},{key:"imageFlipX",get:function get(){return this.$$.ctx[18];},set:function set(imageFlipX){this.$$set({imageFlipX:imageFlipX});flush();}},{key:"imageFlipY",get:function get(){return this.$$.ctx[19];},set:function set(imageFlipY){this.$$set({imageFlipY:imageFlipY});flush();}},{key:"parentRect",get:function get(){return this.$$.ctx[20];},set:function set(parentRect){this.$$set({parentRect:parentRect});flush();}},{key:"hooks",get:function get(){return this.$$.ctx[94];},set:function set(hooks){this.$$set({hooks:hooks});flush();}}]);return ShapeUtil;}(SvelteComponent);var _mapImagePointToScreenPoint=function _mapImagePointToScreenPoint(imagePoint,canvasSize,imageSize,imageOrigin,imageTranslation,imageRotation,imageScalar,imageFlipX,imageFlipY){var mappedPoint=vectorClone(imagePoint);var imageCenterX=imageSize.width*0.5;var imageCenterY=imageSize.height*0.5;var canvasCenterX=canvasSize.width*0.5;var canvasCenterY=canvasSize.height*0.5;var imageOffsetX=imageTranslation.x+imageOrigin.x;var imageOffsetY=imageTranslation.y+imageOrigin.y;if(imageFlipX)mappedPoint.x=imageSize.width-mappedPoint.x;if(imageFlipY)mappedPoint.y=imageSize.height-mappedPoint.y;// rotate around image center based on if image is rotated
var c=Math.cos(imageRotation);var s=Math.sin(imageRotation);mappedPoint.x-=imageCenterX;mappedPoint.y-=imageCenterY;var rx=mappedPoint.x*c-mappedPoint.y*s;var ry=mappedPoint.x*s+mappedPoint.y*c;mappedPoint.x=imageCenterX+rx;mappedPoint.y=imageCenterY+ry;// position based on screen transforms
mappedPoint.x*=imageScalar;mappedPoint.y*=imageScalar;mappedPoint.x+=canvasCenterX;mappedPoint.y+=canvasCenterY;mappedPoint.x+=imageOffsetX;mappedPoint.y+=imageOffsetY;mappedPoint.x-=imageCenterX*imageScalar;mappedPoint.y-=imageCenterY*imageScalar;var tx=(imageTranslation.x-imageOffsetX)*imageScalar;var ty=(imageTranslation.y-imageOffsetY)*imageScalar;var rtx=tx*c-ty*s;var rty=tx*s+ty*c;mappedPoint.x+=rtx;mappedPoint.y+=rty;return mappedPoint;};var _mapScreenPointToImagePoint=function _mapScreenPointToImagePoint(screenPoint,canvasSize,imageSize,imageOrigin,imageTranslation,imageRotation,imageScalar,imageFlipX,imageFlipY){var mappedPoint=vectorClone(screenPoint);var imageCenter=sizeCenter(imageSize);var canvasCenter=sizeCenter(canvasSize);var imageOffset=vectorCreate(imageTranslation.x+imageOrigin.x,imageTranslation.y+imageOrigin.y);var c=Math.cos(imageRotation);var s=Math.sin(imageRotation);mappedPoint.x-=canvasCenter.x;mappedPoint.y-=canvasCenter.y;var tx=(imageTranslation.x-imageOffset.x)*imageScalar;var ty=(imageTranslation.y-imageOffset.y)*imageScalar;var rtx=tx*c-ty*s;var rty=tx*s+ty*c;mappedPoint.x-=rtx;mappedPoint.y-=rty;mappedPoint.x-=imageOffset.x;mappedPoint.y-=imageOffset.y;mappedPoint.x/=imageScalar;mappedPoint.y/=imageScalar;var rx=mappedPoint.x*c+mappedPoint.y*s;var ry=mappedPoint.x*s-mappedPoint.y*c;mappedPoint.x=rx;mappedPoint.y=-ry;mappedPoint.x+=imageCenter.x;mappedPoint.y+=imageCenter.y;if(imageFlipX)mappedPoint.x=imageSize.width-mappedPoint.x;if(imageFlipY)mappedPoint.y=imageSize.height-mappedPoint.y;return mappedPoint;};/* src/core/ui/plugins/annotate/index.svelte generated by Svelte v3.52.0 */function create_fragment$9(ctx){var shapeutil;var updating_toolActive;var current;function shapeutil_toolActive_binding(value){/*shapeutil_toolActive_binding*/ctx[51](value);}var shapeutil_props={utilKey:'annotate',stores:/*stores*/ctx[4],locale:/*locale*/ctx[5],isActive:/*isActive*/ctx[1],isActiveFraction:/*isActiveFraction*/ctx[2],isVisible:/*isVisible*/ctx[3],mapScreenPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[36],mapImagePointToScreenPoint:/*mapImagePointToScreenPoint*/ctx[35],imageRotation:/*$imageRotation*/ctx[37],imageFlipX:/*$imageFlipX*/ctx[34],imageFlipY:/*$imageFlipY*/ctx[33],shapes:/*imageAnnotation*/ctx[39],toolbar:/*annotateTools*/ctx[13]||/*markupEditorToolbar*/ctx[6],toolShapes:/*annotateToolShapes*/ctx[14]||/*markupEditorToolStyles*/ctx[7],toolRetainStyles:/*markupEditorToolRetainStyles*/ctx[8],enableSelectToolToAddShape:/*enableSelectToolToAddShape*/ctx[23],enableTapToAddText:/*enableTapToAddText*/ctx[24],enableViewTool:/*enableViewTool*/ctx[22],enableMoveTool:/*enableMoveTool*/ctx[26],enableAutoSelectMoveTool:/*enableAutoSelectMoveTool*/ctx[25],shapeControls:/*annotateShapeControls*/ctx[15]||/*markupEditorShapeStyleControls*/ctx[9],shapePresets:/*annotatePresets*/ctx[19],enableButtonFlipVertical:/*annotateEnableButtonFlipVertical*/ctx[16],parentRect:/*imageSize*/ctx[40],enablePresetDropImage:/*annotateEnableDropImagePreset*/ctx[18],enablePresetSelectImage:/*annotateEnableSelectImagePreset*/ctx[17],toolSelectRadius:/*markupEditorToolSelectRadius*/ctx[10],textInputMode:/*markupEditorTextInputMode*/ctx[11],willStartInteraction:/*markupEditorWillStartInteraction*/ctx[21],willRenderPresetToolbar:/*annotateWillRenderShapePresetToolbar*/ctx[20]||/*willRenderShapePresetToolbar*/ctx[12],hooks:{willRenderShapeControls:/*willRenderShapeControls*/ctx[27],beforeAddShape:/*beforeAddShape*/ctx[28],beforeRemoveShape:/*beforeRemoveShape*/ctx[29],beforeDeselectShape:/*beforeDeselectShape*/ctx[30],beforeSelectShape:/*beforeSelectShape*/ctx[31],beforeUpdateShape:/*beforeUpdateShape*/ctx[32]}};if(/*annotateActiveTool*/ctx[0]!==void 0){shapeutil_props.toolActive=/*annotateActiveTool*/ctx[0];}shapeutil=new ShapeUtil({props:shapeutil_props});binding_callbacks.push(function(){return bind(shapeutil,'toolActive',shapeutil_toolActive_binding);});shapeutil.$on("measure",/*measure_handler*/ctx[52]);return{c:function c(){create_component(shapeutil.$$.fragment);},m:function m(target,anchor){mount_component(shapeutil,target,anchor);current=true;},p:function p(ctx,dirty){var shapeutil_changes={};if(dirty[0]&/*stores*/16)shapeutil_changes.stores=/*stores*/ctx[4];if(dirty[0]&/*locale*/32)shapeutil_changes.locale=/*locale*/ctx[5];if(dirty[0]&/*isActive*/2)shapeutil_changes.isActive=/*isActive*/ctx[1];if(dirty[0]&/*isActiveFraction*/4)shapeutil_changes.isActiveFraction=/*isActiveFraction*/ctx[2];if(dirty[0]&/*isVisible*/8)shapeutil_changes.isVisible=/*isVisible*/ctx[3];if(dirty[1]&/*mapScreenPointToImagePoint*/32)shapeutil_changes.mapScreenPointToImagePoint=/*mapScreenPointToImagePoint*/ctx[36];if(dirty[1]&/*mapImagePointToScreenPoint*/16)shapeutil_changes.mapImagePointToScreenPoint=/*mapImagePointToScreenPoint*/ctx[35];if(dirty[1]&/*$imageRotation*/64)shapeutil_changes.imageRotation=/*$imageRotation*/ctx[37];if(dirty[1]&/*$imageFlipX*/8)shapeutil_changes.imageFlipX=/*$imageFlipX*/ctx[34];if(dirty[1]&/*$imageFlipY*/4)shapeutil_changes.imageFlipY=/*$imageFlipY*/ctx[33];if(dirty[0]&/*annotateTools, markupEditorToolbar*/8256)shapeutil_changes.toolbar=/*annotateTools*/ctx[13]||/*markupEditorToolbar*/ctx[6];if(dirty[0]&/*annotateToolShapes, markupEditorToolStyles*/16512)shapeutil_changes.toolShapes=/*annotateToolShapes*/ctx[14]||/*markupEditorToolStyles*/ctx[7];if(dirty[0]&/*markupEditorToolRetainStyles*/256)shapeutil_changes.toolRetainStyles=/*markupEditorToolRetainStyles*/ctx[8];if(dirty[0]&/*enableSelectToolToAddShape*/8388608)shapeutil_changes.enableSelectToolToAddShape=/*enableSelectToolToAddShape*/ctx[23];if(dirty[0]&/*enableTapToAddText*/16777216)shapeutil_changes.enableTapToAddText=/*enableTapToAddText*/ctx[24];if(dirty[0]&/*enableViewTool*/4194304)shapeutil_changes.enableViewTool=/*enableViewTool*/ctx[22];if(dirty[0]&/*enableMoveTool*/67108864)shapeutil_changes.enableMoveTool=/*enableMoveTool*/ctx[26];if(dirty[0]&/*enableAutoSelectMoveTool*/33554432)shapeutil_changes.enableAutoSelectMoveTool=/*enableAutoSelectMoveTool*/ctx[25];if(dirty[0]&/*annotateShapeControls, markupEditorShapeStyleControls*/33280)shapeutil_changes.shapeControls=/*annotateShapeControls*/ctx[15]||/*markupEditorShapeStyleControls*/ctx[9];if(dirty[0]&/*annotatePresets*/524288)shapeutil_changes.shapePresets=/*annotatePresets*/ctx[19];if(dirty[0]&/*annotateEnableButtonFlipVertical*/65536)shapeutil_changes.enableButtonFlipVertical=/*annotateEnableButtonFlipVertical*/ctx[16];if(dirty[0]&/*annotateEnableDropImagePreset*/262144)shapeutil_changes.enablePresetDropImage=/*annotateEnableDropImagePreset*/ctx[18];if(dirty[0]&/*annotateEnableSelectImagePreset*/131072)shapeutil_changes.enablePresetSelectImage=/*annotateEnableSelectImagePreset*/ctx[17];if(dirty[0]&/*markupEditorToolSelectRadius*/1024)shapeutil_changes.toolSelectRadius=/*markupEditorToolSelectRadius*/ctx[10];if(dirty[0]&/*markupEditorTextInputMode*/2048)shapeutil_changes.textInputMode=/*markupEditorTextInputMode*/ctx[11];if(dirty[0]&/*markupEditorWillStartInteraction*/2097152)shapeutil_changes.willStartInteraction=/*markupEditorWillStartInteraction*/ctx[21];if(dirty[0]&/*annotateWillRenderShapePresetToolbar, willRenderShapePresetToolbar*/1052672)shapeutil_changes.willRenderPresetToolbar=/*annotateWillRenderShapePresetToolbar*/ctx[20]||/*willRenderShapePresetToolbar*/ctx[12];if(dirty[0]&/*willRenderShapeControls, beforeAddShape, beforeRemoveShape, beforeDeselectShape*/2013265920|dirty[1]&/*beforeSelectShape, beforeUpdateShape*/3)shapeutil_changes.hooks={willRenderShapeControls:/*willRenderShapeControls*/ctx[27],beforeAddShape:/*beforeAddShape*/ctx[28],beforeRemoveShape:/*beforeRemoveShape*/ctx[29],beforeDeselectShape:/*beforeDeselectShape*/ctx[30],beforeSelectShape:/*beforeSelectShape*/ctx[31],beforeUpdateShape:/*beforeUpdateShape*/ctx[32]};if(!updating_toolActive&&dirty[0]&/*annotateActiveTool*/1){updating_toolActive=true;shapeutil_changes.toolActive=/*annotateActiveTool*/ctx[0];add_flush_callback(function(){return updating_toolActive=false;});}shapeutil.$set(shapeutil_changes);},i:function i(local){if(current)return;transition_in(shapeutil.$$.fragment,local);current=true;},o:function o(local){transition_out(shapeutil.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapeutil,detaching);}};}function instance$9($$self,$$props,$$invalidate){var mapScreenPointToImagePoint;var mapImagePointToScreenPoint;var $imageFlipY;var $imageFlipX;var $imageTransformsInterpolated;var $imageTransforms;var $imageSize;var $rootRect;var $imageRotation;var name='annotate';var isActive=$$props.isActive;var isActiveFraction=$$props.isActiveFraction;var isVisible=$$props.isVisible;var stores=$$props.stores;var _$$props$locale8=$$props.locale,locale=_$$props$locale8===void 0?{}:_$$props$locale8;var _$$props$markupEditor7=$$props.markupEditorToolbar,markupEditorToolbar=_$$props$markupEditor7===void 0?undefined:_$$props$markupEditor7;var _$$props$markupEditor8=$$props.markupEditorToolStyles,markupEditorToolStyles=_$$props$markupEditor8===void 0?undefined:_$$props$markupEditor8;var _$$props$markupEditor9=$$props.markupEditorToolRetainStyles,markupEditorToolRetainStyles=_$$props$markupEditor9===void 0?undefined:_$$props$markupEditor9;var _$$props$markupEditor10=$$props.markupEditorShapeStyleControls,markupEditorShapeStyleControls=_$$props$markupEditor10===void 0?undefined:_$$props$markupEditor10;var _$$props$markupEditor11=$$props.markupEditorToolSelectRadius,markupEditorToolSelectRadius=_$$props$markupEditor11===void 0?undefined:_$$props$markupEditor11;var _$$props$markupEditor12=$$props.markupEditorTextInputMode,markupEditorTextInputMode=_$$props$markupEditor12===void 0?undefined:_$$props$markupEditor12;var _$$props$willRenderSh2=$$props.willRenderShapePresetToolbar,willRenderShapePresetToolbar=_$$props$willRenderSh2===void 0?undefined:_$$props$willRenderSh2;var _$$props$annotateTool=$$props.annotateTools,annotateTools=_$$props$annotateTool===void 0?undefined:_$$props$annotateTool;var _$$props$annotateTool2=$$props.annotateToolShapes,annotateToolShapes=_$$props$annotateTool2===void 0?undefined:_$$props$annotateTool2;var _$$props$annotateShap=$$props.annotateShapeControls,annotateShapeControls=_$$props$annotateShap===void 0?undefined:_$$props$annotateShap;var _$$props$annotateActi=$$props.annotateActiveTool,annotateActiveTool=_$$props$annotateActi===void 0?undefined:_$$props$annotateActi;var _$$props$annotateEnab=$$props.annotateEnableButtonFlipVertical,annotateEnableButtonFlipVertical=_$$props$annotateEnab===void 0?false:_$$props$annotateEnab;var _$$props$annotateEnab2=$$props.annotateEnableSelectImagePreset,annotateEnableSelectImagePreset=_$$props$annotateEnab2===void 0?false:_$$props$annotateEnab2;var _$$props$annotateEnab3=$$props.annotateEnableDropImagePreset,annotateEnableDropImagePreset=_$$props$annotateEnab3===void 0?true:_$$props$annotateEnab3;var _$$props$annotatePres=$$props.annotatePresets,annotatePresets=_$$props$annotatePres===void 0?[]:_$$props$annotatePres;var _$$props$annotateWill=$$props.annotateWillRenderShapePresetToolbar,annotateWillRenderShapePresetToolbar=_$$props$annotateWill===void 0?undefined:_$$props$annotateWill;var _$$props$markupEditor13=$$props.markupEditorWillStartInteraction,markupEditorWillStartInteraction=_$$props$markupEditor13===void 0?undefined:_$$props$markupEditor13;var _$$props$enableViewTo2=$$props.enableViewTool,enableViewTool=_$$props$enableViewTo2===void 0?undefined:_$$props$enableViewTo2;var _$$props$enableSelect3=$$props.enableSelectToolToAddShape,enableSelectToolToAddShape=_$$props$enableSelect3===void 0?undefined:_$$props$enableSelect3;var _$$props$enableTapToA3=$$props.enableTapToAddText,enableTapToAddText=_$$props$enableTapToA3===void 0?undefined:_$$props$enableTapToA3;var _$$props$enableAutoSe2=$$props.enableAutoSelectMoveTool,enableAutoSelectMoveTool=_$$props$enableAutoSe2===void 0?undefined:_$$props$enableAutoSe2;var _$$props$enableMoveTo2=$$props.enableMoveTool,enableMoveTool=_$$props$enableMoveTo2===void 0?undefined:_$$props$enableMoveTo2;var _$$props$willRenderSh3=$$props.willRenderShapeControls,willRenderShapeControls=_$$props$willRenderSh3===void 0?undefined:_$$props$willRenderSh3;var _$$props$beforeAddSha=$$props.beforeAddShape,beforeAddShape=_$$props$beforeAddSha===void 0?undefined:_$$props$beforeAddSha;var _$$props$beforeRemove2=$$props.beforeRemoveShape,beforeRemoveShape=_$$props$beforeRemove2===void 0?undefined:_$$props$beforeRemove2;var _$$props$beforeDesele2=$$props.beforeDeselectShape,beforeDeselectShape=_$$props$beforeDesele2===void 0?undefined:_$$props$beforeDesele2;var _$$props$beforeSelect2=$$props.beforeSelectShape,beforeSelectShape=_$$props$beforeSelect2===void 0?undefined:_$$props$beforeSelect2;var _$$props$beforeUpdate2=$$props.beforeUpdateShape,beforeUpdateShape=_$$props$beforeUpdate2===void 0?undefined:_$$props$beforeUpdate2;// export let markupEditorInteractionMode = false; // @deprecated
// connect filter choice to stores
var _stores7=stores,rootRect=_stores7.rootRect,imageAnnotation=_stores7.imageAnnotation,imageSize=_stores7.imageSize,imageRotation=_stores7.imageRotation,imageFlipX=_stores7.imageFlipX,imageFlipY=_stores7.imageFlipY,imageTransforms=_stores7.imageTransforms,imageTransformsInterpolated=_stores7.imageTransformsInterpolated;component_subscribe($$self,rootRect,function(value){return $$invalidate(50,$rootRect=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(49,$imageSize=value);});component_subscribe($$self,imageRotation,function(value){return $$invalidate(37,$imageRotation=value);});component_subscribe($$self,imageFlipX,function(value){return $$invalidate(34,$imageFlipX=value);});component_subscribe($$self,imageFlipY,function(value){return $$invalidate(33,$imageFlipY=value);});component_subscribe($$self,imageTransforms,function(value){return $$invalidate(48,$imageTransforms=value);});component_subscribe($$self,imageTransformsInterpolated,function(value){return $$invalidate(47,$imageTransformsInterpolated=value);});function shapeutil_toolActive_binding(value){annotateActiveTool=value;$$invalidate(0,annotateActiveTool);}function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('isActive'in $$props)$$invalidate(1,isActive=$$props.isActive);if('isActiveFraction'in $$props)$$invalidate(2,isActiveFraction=$$props.isActiveFraction);if('isVisible'in $$props)$$invalidate(3,isVisible=$$props.isVisible);if('stores'in $$props)$$invalidate(4,stores=$$props.stores);if('locale'in $$props)$$invalidate(5,locale=$$props.locale);if('markupEditorToolbar'in $$props)$$invalidate(6,markupEditorToolbar=$$props.markupEditorToolbar);if('markupEditorToolStyles'in $$props)$$invalidate(7,markupEditorToolStyles=$$props.markupEditorToolStyles);if('markupEditorToolRetainStyles'in $$props)$$invalidate(8,markupEditorToolRetainStyles=$$props.markupEditorToolRetainStyles);if('markupEditorShapeStyleControls'in $$props)$$invalidate(9,markupEditorShapeStyleControls=$$props.markupEditorShapeStyleControls);if('markupEditorToolSelectRadius'in $$props)$$invalidate(10,markupEditorToolSelectRadius=$$props.markupEditorToolSelectRadius);if('markupEditorTextInputMode'in $$props)$$invalidate(11,markupEditorTextInputMode=$$props.markupEditorTextInputMode);if('willRenderShapePresetToolbar'in $$props)$$invalidate(12,willRenderShapePresetToolbar=$$props.willRenderShapePresetToolbar);if('annotateTools'in $$props)$$invalidate(13,annotateTools=$$props.annotateTools);if('annotateToolShapes'in $$props)$$invalidate(14,annotateToolShapes=$$props.annotateToolShapes);if('annotateShapeControls'in $$props)$$invalidate(15,annotateShapeControls=$$props.annotateShapeControls);if('annotateActiveTool'in $$props)$$invalidate(0,annotateActiveTool=$$props.annotateActiveTool);if('annotateEnableButtonFlipVertical'in $$props)$$invalidate(16,annotateEnableButtonFlipVertical=$$props.annotateEnableButtonFlipVertical);if('annotateEnableSelectImagePreset'in $$props)$$invalidate(17,annotateEnableSelectImagePreset=$$props.annotateEnableSelectImagePreset);if('annotateEnableDropImagePreset'in $$props)$$invalidate(18,annotateEnableDropImagePreset=$$props.annotateEnableDropImagePreset);if('annotatePresets'in $$props)$$invalidate(19,annotatePresets=$$props.annotatePresets);if('annotateWillRenderShapePresetToolbar'in $$props)$$invalidate(20,annotateWillRenderShapePresetToolbar=$$props.annotateWillRenderShapePresetToolbar);if('markupEditorWillStartInteraction'in $$props)$$invalidate(21,markupEditorWillStartInteraction=$$props.markupEditorWillStartInteraction);if('enableViewTool'in $$props)$$invalidate(22,enableViewTool=$$props.enableViewTool);if('enableSelectToolToAddShape'in $$props)$$invalidate(23,enableSelectToolToAddShape=$$props.enableSelectToolToAddShape);if('enableTapToAddText'in $$props)$$invalidate(24,enableTapToAddText=$$props.enableTapToAddText);if('enableAutoSelectMoveTool'in $$props)$$invalidate(25,enableAutoSelectMoveTool=$$props.enableAutoSelectMoveTool);if('enableMoveTool'in $$props)$$invalidate(26,enableMoveTool=$$props.enableMoveTool);if('willRenderShapeControls'in $$props)$$invalidate(27,willRenderShapeControls=$$props.willRenderShapeControls);if('beforeAddShape'in $$props)$$invalidate(28,beforeAddShape=$$props.beforeAddShape);if('beforeRemoveShape'in $$props)$$invalidate(29,beforeRemoveShape=$$props.beforeRemoveShape);if('beforeDeselectShape'in $$props)$$invalidate(30,beforeDeselectShape=$$props.beforeDeselectShape);if('beforeSelectShape'in $$props)$$invalidate(31,beforeSelectShape=$$props.beforeSelectShape);if('beforeUpdateShape'in $$props)$$invalidate(32,beforeUpdateShape=$$props.beforeUpdateShape);};$$self.$$.update=function(){if($$self.$$.dirty[1]&/*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, $imageFlipX, $imageFlipY*/983052){//
// Mapping coordinates
//
$$invalidate(36,mapScreenPointToImagePoint=function mapScreenPointToImagePoint(point){return _mapScreenPointToImagePoint(point,$rootRect,$imageSize,$imageTransformsInterpolated.origin,$imageTransformsInterpolated.translation,$imageTransforms.rotation.z,$imageTransformsInterpolated.scale,$imageFlipX,$imageFlipY);});}if($$self.$$.dirty[1]&/*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, $imageFlipX, $imageFlipY*/983052){$$invalidate(35,mapImagePointToScreenPoint=function mapImagePointToScreenPoint(point){return _mapImagePointToScreenPoint(point,$rootRect,$imageSize,$imageTransformsInterpolated.origin,$imageTransformsInterpolated.translation,$imageTransforms.rotation.z,$imageTransformsInterpolated.scale,$imageFlipX,$imageFlipY);});}};return[annotateActiveTool,isActive,isActiveFraction,isVisible,stores,locale,markupEditorToolbar,markupEditorToolStyles,markupEditorToolRetainStyles,markupEditorShapeStyleControls,markupEditorToolSelectRadius,markupEditorTextInputMode,willRenderShapePresetToolbar,annotateTools,annotateToolShapes,annotateShapeControls,annotateEnableButtonFlipVertical,annotateEnableSelectImagePreset,annotateEnableDropImagePreset,annotatePresets,annotateWillRenderShapePresetToolbar,markupEditorWillStartInteraction,enableViewTool,enableSelectToolToAddShape,enableTapToAddText,enableAutoSelectMoveTool,enableMoveTool,willRenderShapeControls,beforeAddShape,beforeRemoveShape,beforeDeselectShape,beforeSelectShape,beforeUpdateShape,$imageFlipY,$imageFlipX,mapImagePointToScreenPoint,mapScreenPointToImagePoint,$imageRotation,rootRect,imageAnnotation,imageSize,imageRotation,imageFlipX,imageFlipY,imageTransforms,imageTransformsInterpolated,name,$imageTransformsInterpolated,$imageTransforms,$imageSize,$rootRect,shapeutil_toolActive_binding,measure_handler];}var Annotate=/*#__PURE__*/function(_SvelteComponent45){_inherits(Annotate,_SvelteComponent45);var _super46=_createSuper(Annotate);function Annotate(options){var _this47;_classCallCheck(this,Annotate);_this47=_super46.call(this);init(_assertThisInitialized(_this47),options,instance$9,create_fragment$9,safe_not_equal,{name:46,isActive:1,isActiveFraction:2,isVisible:3,stores:4,locale:5,markupEditorToolbar:6,markupEditorToolStyles:7,markupEditorToolRetainStyles:8,markupEditorShapeStyleControls:9,markupEditorToolSelectRadius:10,markupEditorTextInputMode:11,willRenderShapePresetToolbar:12,annotateTools:13,annotateToolShapes:14,annotateShapeControls:15,annotateActiveTool:0,annotateEnableButtonFlipVertical:16,annotateEnableSelectImagePreset:17,annotateEnableDropImagePreset:18,annotatePresets:19,annotateWillRenderShapePresetToolbar:20,markupEditorWillStartInteraction:21,enableViewTool:22,enableSelectToolToAddShape:23,enableTapToAddText:24,enableAutoSelectMoveTool:25,enableMoveTool:26,willRenderShapeControls:27,beforeAddShape:28,beforeRemoveShape:29,beforeDeselectShape:30,beforeSelectShape:31,beforeUpdateShape:32},null,[-1,-1]);return _this47;}_createClass(Annotate,[{key:"name",get:function get(){return this.$$.ctx[46];}},{key:"isActive",get:function get(){return this.$$.ctx[1];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"isActiveFraction",get:function get(){return this.$$.ctx[2];},set:function set(isActiveFraction){this.$$set({isActiveFraction:isActiveFraction});flush();}},{key:"isVisible",get:function get(){return this.$$.ctx[3];},set:function set(isVisible){this.$$set({isVisible:isVisible});flush();}},{key:"stores",get:function get(){return this.$$.ctx[4];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"locale",get:function get(){return this.$$.ctx[5];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"markupEditorToolbar",get:function get(){return this.$$.ctx[6];},set:function set(markupEditorToolbar){this.$$set({markupEditorToolbar:markupEditorToolbar});flush();}},{key:"markupEditorToolStyles",get:function get(){return this.$$.ctx[7];},set:function set(markupEditorToolStyles){this.$$set({markupEditorToolStyles:markupEditorToolStyles});flush();}},{key:"markupEditorToolRetainStyles",get:function get(){return this.$$.ctx[8];},set:function set(markupEditorToolRetainStyles){this.$$set({markupEditorToolRetainStyles:markupEditorToolRetainStyles});flush();}},{key:"markupEditorShapeStyleControls",get:function get(){return this.$$.ctx[9];},set:function set(markupEditorShapeStyleControls){this.$$set({markupEditorShapeStyleControls:markupEditorShapeStyleControls});flush();}},{key:"markupEditorToolSelectRadius",get:function get(){return this.$$.ctx[10];},set:function set(markupEditorToolSelectRadius){this.$$set({markupEditorToolSelectRadius:markupEditorToolSelectRadius});flush();}},{key:"markupEditorTextInputMode",get:function get(){return this.$$.ctx[11];},set:function set(markupEditorTextInputMode){this.$$set({markupEditorTextInputMode:markupEditorTextInputMode});flush();}},{key:"willRenderShapePresetToolbar",get:function get(){return this.$$.ctx[12];},set:function set(willRenderShapePresetToolbar){this.$$set({willRenderShapePresetToolbar:willRenderShapePresetToolbar});flush();}},{key:"annotateTools",get:function get(){return this.$$.ctx[13];},set:function set(annotateTools){this.$$set({annotateTools:annotateTools});flush();}},{key:"annotateToolShapes",get:function get(){return this.$$.ctx[14];},set:function set(annotateToolShapes){this.$$set({annotateToolShapes:annotateToolShapes});flush();}},{key:"annotateShapeControls",get:function get(){return this.$$.ctx[15];},set:function set(annotateShapeControls){this.$$set({annotateShapeControls:annotateShapeControls});flush();}},{key:"annotateActiveTool",get:function get(){return this.$$.ctx[0];},set:function set(annotateActiveTool){this.$$set({annotateActiveTool:annotateActiveTool});flush();}},{key:"annotateEnableButtonFlipVertical",get:function get(){return this.$$.ctx[16];},set:function set(annotateEnableButtonFlipVertical){this.$$set({annotateEnableButtonFlipVertical:annotateEnableButtonFlipVertical});flush();}},{key:"annotateEnableSelectImagePreset",get:function get(){return this.$$.ctx[17];},set:function set(annotateEnableSelectImagePreset){this.$$set({annotateEnableSelectImagePreset:annotateEnableSelectImagePreset});flush();}},{key:"annotateEnableDropImagePreset",get:function get(){return this.$$.ctx[18];},set:function set(annotateEnableDropImagePreset){this.$$set({annotateEnableDropImagePreset:annotateEnableDropImagePreset});flush();}},{key:"annotatePresets",get:function get(){return this.$$.ctx[19];},set:function set(annotatePresets){this.$$set({annotatePresets:annotatePresets});flush();}},{key:"annotateWillRenderShapePresetToolbar",get:function get(){return this.$$.ctx[20];},set:function set(annotateWillRenderShapePresetToolbar){this.$$set({annotateWillRenderShapePresetToolbar:annotateWillRenderShapePresetToolbar});flush();}},{key:"markupEditorWillStartInteraction",get:function get(){return this.$$.ctx[21];},set:function set(markupEditorWillStartInteraction){this.$$set({markupEditorWillStartInteraction:markupEditorWillStartInteraction});flush();}},{key:"enableViewTool",get:function get(){return this.$$.ctx[22];},set:function set(enableViewTool){this.$$set({enableViewTool:enableViewTool});flush();}},{key:"enableSelectToolToAddShape",get:function get(){return this.$$.ctx[23];},set:function set(enableSelectToolToAddShape){this.$$set({enableSelectToolToAddShape:enableSelectToolToAddShape});flush();}},{key:"enableTapToAddText",get:function get(){return this.$$.ctx[24];},set:function set(enableTapToAddText){this.$$set({enableTapToAddText:enableTapToAddText});flush();}},{key:"enableAutoSelectMoveTool",get:function get(){return this.$$.ctx[25];},set:function set(enableAutoSelectMoveTool){this.$$set({enableAutoSelectMoveTool:enableAutoSelectMoveTool});flush();}},{key:"enableMoveTool",get:function get(){return this.$$.ctx[26];},set:function set(enableMoveTool){this.$$set({enableMoveTool:enableMoveTool});flush();}},{key:"willRenderShapeControls",get:function get(){return this.$$.ctx[27];},set:function set(willRenderShapeControls){this.$$set({willRenderShapeControls:willRenderShapeControls});flush();}},{key:"beforeAddShape",get:function get(){return this.$$.ctx[28];},set:function set(beforeAddShape){this.$$set({beforeAddShape:beforeAddShape});flush();}},{key:"beforeRemoveShape",get:function get(){return this.$$.ctx[29];},set:function set(beforeRemoveShape){this.$$set({beforeRemoveShape:beforeRemoveShape});flush();}},{key:"beforeDeselectShape",get:function get(){return this.$$.ctx[30];},set:function set(beforeDeselectShape){this.$$set({beforeDeselectShape:beforeDeselectShape});flush();}},{key:"beforeSelectShape",get:function get(){return this.$$.ctx[31];},set:function set(beforeSelectShape){this.$$set({beforeSelectShape:beforeSelectShape});flush();}},{key:"beforeUpdateShape",get:function get(){return this.$$.ctx[32];},set:function set(beforeUpdateShape){this.$$set({beforeUpdateShape:beforeUpdateShape});flush();}}]);return Annotate;}(SvelteComponent);// @ts-ignore
var _plugin_annotate={util:['annotate',Annotate]};/* src/core/ui/plugins/decorate/index.svelte generated by Svelte v3.52.0 */function create_fragment$8(ctx){var shapeutil;var updating_toolActive;var current;function shapeutil_toolActive_binding(value){/*shapeutil_toolActive_binding*/ctx[43](value);}var shapeutil_props={stores:/*stores*/ctx[4],locale:/*locale*/ctx[5],isActive:/*isActive*/ctx[1],isActiveFraction:/*isActiveFraction*/ctx[2],isVisible:/*isVisible*/ctx[3],mapScreenPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[34],mapImagePointToScreenPoint:/*mapImagePointToScreenPoint*/ctx[33],utilKey:'decorate',shapes:/*imageDecoration*/ctx[36],toolbar:/*decorateTools*/ctx[13]||/*markupEditorToolbar*/ctx[6],toolShapes:/*decorateToolShapes*/ctx[14]||/*markupEditorToolStyles*/ctx[7],toolRetainStyles:/*markupEditorToolRetainStyles*/ctx[8],shapeControls:/*decorateShapeControls*/ctx[15]||/*markupEditorShapeStyleControls*/ctx[9],shapePresets:/*decoratePresets*/ctx[19],enableSelectToolToAddShape:/*enableSelectToolToAddShape*/ctx[21],enableTapToAddText:/*enableTapToAddText*/ctx[22],enableViewTool:/*enableViewTool*/ctx[23],enableMoveTool:/*enableMoveTool*/ctx[24],enableAutoSelectMoveTool:/*enableAutoSelectMoveTool*/ctx[25],enablePresetSelectImage:/*decorateEnableSelectImagePreset*/ctx[17],enablePresetDropImage:/*decorateEnableDropImagePreset*/ctx[18],enableButtonFlipVertical:/*decorateEnableButtonFlipVertical*/ctx[16],parentRect:/*imageCropRect*/ctx[35],toolSelectRadius:/*markupEditorToolSelectRadius*/ctx[10],textInputMode:/*markupEditorTextInputMode*/ctx[11],willStartInteraction:/*markupEditorWillStartInteraction*/ctx[32],willRenderPresetToolbar:/*decorateWillRenderShapePresetToolbar*/ctx[20]||/*willRenderShapePresetToolbar*/ctx[12],hooks:{willRenderShapeControls:/*willRenderShapeControls*/ctx[26],beforeAddShape:/*beforeAddShape*/ctx[27],beforeRemoveShape:/*beforeRemoveShape*/ctx[28],beforeDeselectShape:/*beforeDeselectShape*/ctx[29],beforeSelectShape:/*beforeSelectShape*/ctx[30],beforeUpdateShape:/*beforeUpdateShape*/ctx[31]}};if(/*decorateActiveTool*/ctx[0]!==void 0){shapeutil_props.toolActive=/*decorateActiveTool*/ctx[0];}shapeutil=new ShapeUtil({props:shapeutil_props});binding_callbacks.push(function(){return bind(shapeutil,'toolActive',shapeutil_toolActive_binding);});shapeutil.$on("measure",/*measure_handler*/ctx[44]);return{c:function c(){create_component(shapeutil.$$.fragment);},m:function m(target,anchor){mount_component(shapeutil,target,anchor);current=true;},p:function p(ctx,dirty){var shapeutil_changes={};if(dirty[0]&/*stores*/16)shapeutil_changes.stores=/*stores*/ctx[4];if(dirty[0]&/*locale*/32)shapeutil_changes.locale=/*locale*/ctx[5];if(dirty[0]&/*isActive*/2)shapeutil_changes.isActive=/*isActive*/ctx[1];if(dirty[0]&/*isActiveFraction*/4)shapeutil_changes.isActiveFraction=/*isActiveFraction*/ctx[2];if(dirty[0]&/*isVisible*/8)shapeutil_changes.isVisible=/*isVisible*/ctx[3];if(dirty[1]&/*mapScreenPointToImagePoint*/8)shapeutil_changes.mapScreenPointToImagePoint=/*mapScreenPointToImagePoint*/ctx[34];if(dirty[1]&/*mapImagePointToScreenPoint*/4)shapeutil_changes.mapImagePointToScreenPoint=/*mapImagePointToScreenPoint*/ctx[33];if(dirty[0]&/*decorateTools, markupEditorToolbar*/8256)shapeutil_changes.toolbar=/*decorateTools*/ctx[13]||/*markupEditorToolbar*/ctx[6];if(dirty[0]&/*decorateToolShapes, markupEditorToolStyles*/16512)shapeutil_changes.toolShapes=/*decorateToolShapes*/ctx[14]||/*markupEditorToolStyles*/ctx[7];if(dirty[0]&/*markupEditorToolRetainStyles*/256)shapeutil_changes.toolRetainStyles=/*markupEditorToolRetainStyles*/ctx[8];if(dirty[0]&/*decorateShapeControls, markupEditorShapeStyleControls*/33280)shapeutil_changes.shapeControls=/*decorateShapeControls*/ctx[15]||/*markupEditorShapeStyleControls*/ctx[9];if(dirty[0]&/*decoratePresets*/524288)shapeutil_changes.shapePresets=/*decoratePresets*/ctx[19];if(dirty[0]&/*enableSelectToolToAddShape*/2097152)shapeutil_changes.enableSelectToolToAddShape=/*enableSelectToolToAddShape*/ctx[21];if(dirty[0]&/*enableTapToAddText*/4194304)shapeutil_changes.enableTapToAddText=/*enableTapToAddText*/ctx[22];if(dirty[0]&/*enableViewTool*/8388608)shapeutil_changes.enableViewTool=/*enableViewTool*/ctx[23];if(dirty[0]&/*enableMoveTool*/16777216)shapeutil_changes.enableMoveTool=/*enableMoveTool*/ctx[24];if(dirty[0]&/*enableAutoSelectMoveTool*/33554432)shapeutil_changes.enableAutoSelectMoveTool=/*enableAutoSelectMoveTool*/ctx[25];if(dirty[0]&/*decorateEnableSelectImagePreset*/131072)shapeutil_changes.enablePresetSelectImage=/*decorateEnableSelectImagePreset*/ctx[17];if(dirty[0]&/*decorateEnableDropImagePreset*/262144)shapeutil_changes.enablePresetDropImage=/*decorateEnableDropImagePreset*/ctx[18];if(dirty[0]&/*decorateEnableButtonFlipVertical*/65536)shapeutil_changes.enableButtonFlipVertical=/*decorateEnableButtonFlipVertical*/ctx[16];if(dirty[0]&/*markupEditorToolSelectRadius*/1024)shapeutil_changes.toolSelectRadius=/*markupEditorToolSelectRadius*/ctx[10];if(dirty[0]&/*markupEditorTextInputMode*/2048)shapeutil_changes.textInputMode=/*markupEditorTextInputMode*/ctx[11];if(dirty[1]&/*markupEditorWillStartInteraction*/2)shapeutil_changes.willStartInteraction=/*markupEditorWillStartInteraction*/ctx[32];if(dirty[0]&/*decorateWillRenderShapePresetToolbar, willRenderShapePresetToolbar*/1052672)shapeutil_changes.willRenderPresetToolbar=/*decorateWillRenderShapePresetToolbar*/ctx[20]||/*willRenderShapePresetToolbar*/ctx[12];if(dirty[0]&/*willRenderShapeControls, beforeAddShape, beforeRemoveShape, beforeDeselectShape, beforeSelectShape*/2080374784|dirty[1]&/*beforeUpdateShape*/1)shapeutil_changes.hooks={willRenderShapeControls:/*willRenderShapeControls*/ctx[26],beforeAddShape:/*beforeAddShape*/ctx[27],beforeRemoveShape:/*beforeRemoveShape*/ctx[28],beforeDeselectShape:/*beforeDeselectShape*/ctx[29],beforeSelectShape:/*beforeSelectShape*/ctx[30],beforeUpdateShape:/*beforeUpdateShape*/ctx[31]};if(!updating_toolActive&&dirty[0]&/*decorateActiveTool*/1){updating_toolActive=true;shapeutil_changes.toolActive=/*decorateActiveTool*/ctx[0];add_flush_callback(function(){return updating_toolActive=false;});}shapeutil.$set(shapeutil_changes);},i:function i(local){if(current)return;transition_in(shapeutil.$$.fragment,local);current=true;},o:function o(local){transition_out(shapeutil.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapeutil,detaching);}};}function instance$8($$self,$$props,$$invalidate){var presentationZoom;var mapScreenPointToImagePoint;var mapImagePointToScreenPoint;var $imageSelectionRectPresentation;var $imageTransformsInterpolated;var name='decorate';var isActive=$$props.isActive;var isActiveFraction=$$props.isActiveFraction;var isVisible=$$props.isVisible;var stores=$$props.stores;var _$$props$locale9=$$props.locale,locale=_$$props$locale9===void 0?{}:_$$props$locale9;var _$$props$markupEditor14=$$props.markupEditorToolbar,markupEditorToolbar=_$$props$markupEditor14===void 0?undefined:_$$props$markupEditor14;var _$$props$markupEditor15=$$props.markupEditorToolStyles,markupEditorToolStyles=_$$props$markupEditor15===void 0?undefined:_$$props$markupEditor15;var _$$props$markupEditor16=$$props.markupEditorToolRetainStyles,markupEditorToolRetainStyles=_$$props$markupEditor16===void 0?undefined:_$$props$markupEditor16;var _$$props$markupEditor17=$$props.markupEditorShapeStyleControls,markupEditorShapeStyleControls=_$$props$markupEditor17===void 0?undefined:_$$props$markupEditor17;var _$$props$markupEditor18=$$props.markupEditorToolSelectRadius,markupEditorToolSelectRadius=_$$props$markupEditor18===void 0?undefined:_$$props$markupEditor18;var _$$props$markupEditor19=$$props.markupEditorTextInputMode,markupEditorTextInputMode=_$$props$markupEditor19===void 0?undefined:_$$props$markupEditor19;var _$$props$willRenderSh4=$$props.willRenderShapePresetToolbar,willRenderShapePresetToolbar=_$$props$willRenderSh4===void 0?undefined:_$$props$willRenderSh4;var _$$props$decorateTool=$$props.decorateTools,decorateTools=_$$props$decorateTool===void 0?undefined:_$$props$decorateTool;var _$$props$decorateTool2=$$props.decorateToolShapes,decorateToolShapes=_$$props$decorateTool2===void 0?undefined:_$$props$decorateTool2;var _$$props$decorateShap=$$props.decorateShapeControls,decorateShapeControls=_$$props$decorateShap===void 0?undefined:_$$props$decorateShap;var _$$props$decorateActi=$$props.decorateActiveTool,decorateActiveTool=_$$props$decorateActi===void 0?undefined:_$$props$decorateActi;var _$$props$decorateEnab=$$props.decorateEnableButtonFlipVertical,decorateEnableButtonFlipVertical=_$$props$decorateEnab===void 0?false:_$$props$decorateEnab;var _$$props$decorateEnab2=$$props.decorateEnableSelectImagePreset,decorateEnableSelectImagePreset=_$$props$decorateEnab2===void 0?false:_$$props$decorateEnab2;var _$$props$decorateEnab3=$$props.decorateEnableDropImagePreset,decorateEnableDropImagePreset=_$$props$decorateEnab3===void 0?true:_$$props$decorateEnab3;var _$$props$decoratePres=$$props.decoratePresets,decoratePresets=_$$props$decoratePres===void 0?[]:_$$props$decoratePres;var _$$props$decorateWill=$$props.decorateWillRenderShapePresetToolbar,decorateWillRenderShapePresetToolbar=_$$props$decorateWill===void 0?undefined:_$$props$decorateWill;var _$$props$enableSelect4=$$props.enableSelectToolToAddShape,enableSelectToolToAddShape=_$$props$enableSelect4===void 0?undefined:_$$props$enableSelect4;var _$$props$enableTapToA4=$$props.enableTapToAddText,enableTapToAddText=_$$props$enableTapToA4===void 0?undefined:_$$props$enableTapToA4;var _$$props$enableViewTo3=$$props.enableViewTool,enableViewTool=_$$props$enableViewTo3===void 0?undefined:_$$props$enableViewTo3;var _$$props$enableMoveTo3=$$props.enableMoveTool,enableMoveTool=_$$props$enableMoveTo3===void 0?undefined:_$$props$enableMoveTo3;var _$$props$enableAutoSe3=$$props.enableAutoSelectMoveTool,enableAutoSelectMoveTool=_$$props$enableAutoSe3===void 0?undefined:_$$props$enableAutoSe3;var _$$props$willRenderSh5=$$props.willRenderShapeControls,willRenderShapeControls=_$$props$willRenderSh5===void 0?undefined:_$$props$willRenderSh5;var _$$props$beforeAddSha2=$$props.beforeAddShape,beforeAddShape=_$$props$beforeAddSha2===void 0?undefined:_$$props$beforeAddSha2;var _$$props$beforeRemove3=$$props.beforeRemoveShape,beforeRemoveShape=_$$props$beforeRemove3===void 0?undefined:_$$props$beforeRemove3;var _$$props$beforeDesele3=$$props.beforeDeselectShape,beforeDeselectShape=_$$props$beforeDesele3===void 0?undefined:_$$props$beforeDesele3;var _$$props$beforeSelect3=$$props.beforeSelectShape,beforeSelectShape=_$$props$beforeSelect3===void 0?undefined:_$$props$beforeSelect3;var _$$props$beforeUpdate3=$$props.beforeUpdateShape,beforeUpdateShape=_$$props$beforeUpdate3===void 0?undefined:_$$props$beforeUpdate3;var _$$props$markupEditor20=$$props.markupEditorWillStartInteraction,markupEditorWillStartInteraction=_$$props$markupEditor20===void 0?undefined:_$$props$markupEditor20;var _stores8=stores,imageCropRect=_stores8.imageCropRect,imageDecoration=_stores8.imageDecoration,imageSelectionRectPresentation=_stores8.imageSelectionRectPresentation,imageTransformsInterpolated=_stores8.imageTransformsInterpolated;component_subscribe($$self,imageSelectionRectPresentation,function(value){return $$invalidate(41,$imageSelectionRectPresentation=value);});component_subscribe($$self,imageTransformsInterpolated,function(value){return $$invalidate(42,$imageTransformsInterpolated=value);});function shapeutil_toolActive_binding(value){decorateActiveTool=value;$$invalidate(0,decorateActiveTool);}function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('isActive'in $$props)$$invalidate(1,isActive=$$props.isActive);if('isActiveFraction'in $$props)$$invalidate(2,isActiveFraction=$$props.isActiveFraction);if('isVisible'in $$props)$$invalidate(3,isVisible=$$props.isVisible);if('stores'in $$props)$$invalidate(4,stores=$$props.stores);if('locale'in $$props)$$invalidate(5,locale=$$props.locale);if('markupEditorToolbar'in $$props)$$invalidate(6,markupEditorToolbar=$$props.markupEditorToolbar);if('markupEditorToolStyles'in $$props)$$invalidate(7,markupEditorToolStyles=$$props.markupEditorToolStyles);if('markupEditorToolRetainStyles'in $$props)$$invalidate(8,markupEditorToolRetainStyles=$$props.markupEditorToolRetainStyles);if('markupEditorShapeStyleControls'in $$props)$$invalidate(9,markupEditorShapeStyleControls=$$props.markupEditorShapeStyleControls);if('markupEditorToolSelectRadius'in $$props)$$invalidate(10,markupEditorToolSelectRadius=$$props.markupEditorToolSelectRadius);if('markupEditorTextInputMode'in $$props)$$invalidate(11,markupEditorTextInputMode=$$props.markupEditorTextInputMode);if('willRenderShapePresetToolbar'in $$props)$$invalidate(12,willRenderShapePresetToolbar=$$props.willRenderShapePresetToolbar);if('decorateTools'in $$props)$$invalidate(13,decorateTools=$$props.decorateTools);if('decorateToolShapes'in $$props)$$invalidate(14,decorateToolShapes=$$props.decorateToolShapes);if('decorateShapeControls'in $$props)$$invalidate(15,decorateShapeControls=$$props.decorateShapeControls);if('decorateActiveTool'in $$props)$$invalidate(0,decorateActiveTool=$$props.decorateActiveTool);if('decorateEnableButtonFlipVertical'in $$props)$$invalidate(16,decorateEnableButtonFlipVertical=$$props.decorateEnableButtonFlipVertical);if('decorateEnableSelectImagePreset'in $$props)$$invalidate(17,decorateEnableSelectImagePreset=$$props.decorateEnableSelectImagePreset);if('decorateEnableDropImagePreset'in $$props)$$invalidate(18,decorateEnableDropImagePreset=$$props.decorateEnableDropImagePreset);if('decoratePresets'in $$props)$$invalidate(19,decoratePresets=$$props.decoratePresets);if('decorateWillRenderShapePresetToolbar'in $$props)$$invalidate(20,decorateWillRenderShapePresetToolbar=$$props.decorateWillRenderShapePresetToolbar);if('enableSelectToolToAddShape'in $$props)$$invalidate(21,enableSelectToolToAddShape=$$props.enableSelectToolToAddShape);if('enableTapToAddText'in $$props)$$invalidate(22,enableTapToAddText=$$props.enableTapToAddText);if('enableViewTool'in $$props)$$invalidate(23,enableViewTool=$$props.enableViewTool);if('enableMoveTool'in $$props)$$invalidate(24,enableMoveTool=$$props.enableMoveTool);if('enableAutoSelectMoveTool'in $$props)$$invalidate(25,enableAutoSelectMoveTool=$$props.enableAutoSelectMoveTool);if('willRenderShapeControls'in $$props)$$invalidate(26,willRenderShapeControls=$$props.willRenderShapeControls);if('beforeAddShape'in $$props)$$invalidate(27,beforeAddShape=$$props.beforeAddShape);if('beforeRemoveShape'in $$props)$$invalidate(28,beforeRemoveShape=$$props.beforeRemoveShape);if('beforeDeselectShape'in $$props)$$invalidate(29,beforeDeselectShape=$$props.beforeDeselectShape);if('beforeSelectShape'in $$props)$$invalidate(30,beforeSelectShape=$$props.beforeSelectShape);if('beforeUpdateShape'in $$props)$$invalidate(31,beforeUpdateShape=$$props.beforeUpdateShape);if('markupEditorWillStartInteraction'in $$props)$$invalidate(32,markupEditorWillStartInteraction=$$props.markupEditorWillStartInteraction);};$$self.$$.update=function(){if($$self.$$.dirty[1]&/*$imageTransformsInterpolated*/2048){$$invalidate(40,presentationZoom=$imageTransformsInterpolated?$imageTransformsInterpolated.scale:1);}if($$self.$$.dirty[1]&/*$imageSelectionRectPresentation, presentationZoom*/1536){$$invalidate(34,mapScreenPointToImagePoint=function mapScreenPointToImagePoint(screenPoint){var mappedPoint=vectorClone(screenPoint);mappedPoint.x-=$imageSelectionRectPresentation.x;mappedPoint.y-=$imageSelectionRectPresentation.y;mappedPoint.x/=presentationZoom;mappedPoint.y/=presentationZoom;return mappedPoint;});}if($$self.$$.dirty[1]&/*presentationZoom, $imageSelectionRectPresentation*/1536){$$invalidate(33,mapImagePointToScreenPoint=function mapImagePointToScreenPoint(imagePoint){var mappedPoint=vectorClone(imagePoint);mappedPoint.x*=presentationZoom;mappedPoint.y*=presentationZoom;mappedPoint.x+=$imageSelectionRectPresentation.x;mappedPoint.y+=$imageSelectionRectPresentation.y;return mappedPoint;});}};return[decorateActiveTool,isActive,isActiveFraction,isVisible,stores,locale,markupEditorToolbar,markupEditorToolStyles,markupEditorToolRetainStyles,markupEditorShapeStyleControls,markupEditorToolSelectRadius,markupEditorTextInputMode,willRenderShapePresetToolbar,decorateTools,decorateToolShapes,decorateShapeControls,decorateEnableButtonFlipVertical,decorateEnableSelectImagePreset,decorateEnableDropImagePreset,decoratePresets,decorateWillRenderShapePresetToolbar,enableSelectToolToAddShape,enableTapToAddText,enableViewTool,enableMoveTool,enableAutoSelectMoveTool,willRenderShapeControls,beforeAddShape,beforeRemoveShape,beforeDeselectShape,beforeSelectShape,beforeUpdateShape,markupEditorWillStartInteraction,mapImagePointToScreenPoint,mapScreenPointToImagePoint,imageCropRect,imageDecoration,imageSelectionRectPresentation,imageTransformsInterpolated,name,presentationZoom,$imageSelectionRectPresentation,$imageTransformsInterpolated,shapeutil_toolActive_binding,measure_handler];}var Decorate=/*#__PURE__*/function(_SvelteComponent46){_inherits(Decorate,_SvelteComponent46);var _super47=_createSuper(Decorate);function Decorate(options){var _this48;_classCallCheck(this,Decorate);_this48=_super47.call(this);init(_assertThisInitialized(_this48),options,instance$8,create_fragment$8,safe_not_equal,{name:39,isActive:1,isActiveFraction:2,isVisible:3,stores:4,locale:5,markupEditorToolbar:6,markupEditorToolStyles:7,markupEditorToolRetainStyles:8,markupEditorShapeStyleControls:9,markupEditorToolSelectRadius:10,markupEditorTextInputMode:11,willRenderShapePresetToolbar:12,decorateTools:13,decorateToolShapes:14,decorateShapeControls:15,decorateActiveTool:0,decorateEnableButtonFlipVertical:16,decorateEnableSelectImagePreset:17,decorateEnableDropImagePreset:18,decoratePresets:19,decorateWillRenderShapePresetToolbar:20,enableSelectToolToAddShape:21,enableTapToAddText:22,enableViewTool:23,enableMoveTool:24,enableAutoSelectMoveTool:25,willRenderShapeControls:26,beforeAddShape:27,beforeRemoveShape:28,beforeDeselectShape:29,beforeSelectShape:30,beforeUpdateShape:31,markupEditorWillStartInteraction:32},null,[-1,-1]);return _this48;}_createClass(Decorate,[{key:"name",get:function get(){return this.$$.ctx[39];}},{key:"isActive",get:function get(){return this.$$.ctx[1];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"isActiveFraction",get:function get(){return this.$$.ctx[2];},set:function set(isActiveFraction){this.$$set({isActiveFraction:isActiveFraction});flush();}},{key:"isVisible",get:function get(){return this.$$.ctx[3];},set:function set(isVisible){this.$$set({isVisible:isVisible});flush();}},{key:"stores",get:function get(){return this.$$.ctx[4];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"locale",get:function get(){return this.$$.ctx[5];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"markupEditorToolbar",get:function get(){return this.$$.ctx[6];},set:function set(markupEditorToolbar){this.$$set({markupEditorToolbar:markupEditorToolbar});flush();}},{key:"markupEditorToolStyles",get:function get(){return this.$$.ctx[7];},set:function set(markupEditorToolStyles){this.$$set({markupEditorToolStyles:markupEditorToolStyles});flush();}},{key:"markupEditorToolRetainStyles",get:function get(){return this.$$.ctx[8];},set:function set(markupEditorToolRetainStyles){this.$$set({markupEditorToolRetainStyles:markupEditorToolRetainStyles});flush();}},{key:"markupEditorShapeStyleControls",get:function get(){return this.$$.ctx[9];},set:function set(markupEditorShapeStyleControls){this.$$set({markupEditorShapeStyleControls:markupEditorShapeStyleControls});flush();}},{key:"markupEditorToolSelectRadius",get:function get(){return this.$$.ctx[10];},set:function set(markupEditorToolSelectRadius){this.$$set({markupEditorToolSelectRadius:markupEditorToolSelectRadius});flush();}},{key:"markupEditorTextInputMode",get:function get(){return this.$$.ctx[11];},set:function set(markupEditorTextInputMode){this.$$set({markupEditorTextInputMode:markupEditorTextInputMode});flush();}},{key:"willRenderShapePresetToolbar",get:function get(){return this.$$.ctx[12];},set:function set(willRenderShapePresetToolbar){this.$$set({willRenderShapePresetToolbar:willRenderShapePresetToolbar});flush();}},{key:"decorateTools",get:function get(){return this.$$.ctx[13];},set:function set(decorateTools){this.$$set({decorateTools:decorateTools});flush();}},{key:"decorateToolShapes",get:function get(){return this.$$.ctx[14];},set:function set(decorateToolShapes){this.$$set({decorateToolShapes:decorateToolShapes});flush();}},{key:"decorateShapeControls",get:function get(){return this.$$.ctx[15];},set:function set(decorateShapeControls){this.$$set({decorateShapeControls:decorateShapeControls});flush();}},{key:"decorateActiveTool",get:function get(){return this.$$.ctx[0];},set:function set(decorateActiveTool){this.$$set({decorateActiveTool:decorateActiveTool});flush();}},{key:"decorateEnableButtonFlipVertical",get:function get(){return this.$$.ctx[16];},set:function set(decorateEnableButtonFlipVertical){this.$$set({decorateEnableButtonFlipVertical:decorateEnableButtonFlipVertical});flush();}},{key:"decorateEnableSelectImagePreset",get:function get(){return this.$$.ctx[17];},set:function set(decorateEnableSelectImagePreset){this.$$set({decorateEnableSelectImagePreset:decorateEnableSelectImagePreset});flush();}},{key:"decorateEnableDropImagePreset",get:function get(){return this.$$.ctx[18];},set:function set(decorateEnableDropImagePreset){this.$$set({decorateEnableDropImagePreset:decorateEnableDropImagePreset});flush();}},{key:"decoratePresets",get:function get(){return this.$$.ctx[19];},set:function set(decoratePresets){this.$$set({decoratePresets:decoratePresets});flush();}},{key:"decorateWillRenderShapePresetToolbar",get:function get(){return this.$$.ctx[20];},set:function set(decorateWillRenderShapePresetToolbar){this.$$set({decorateWillRenderShapePresetToolbar:decorateWillRenderShapePresetToolbar});flush();}},{key:"enableSelectToolToAddShape",get:function get(){return this.$$.ctx[21];},set:function set(enableSelectToolToAddShape){this.$$set({enableSelectToolToAddShape:enableSelectToolToAddShape});flush();}},{key:"enableTapToAddText",get:function get(){return this.$$.ctx[22];},set:function set(enableTapToAddText){this.$$set({enableTapToAddText:enableTapToAddText});flush();}},{key:"enableViewTool",get:function get(){return this.$$.ctx[23];},set:function set(enableViewTool){this.$$set({enableViewTool:enableViewTool});flush();}},{key:"enableMoveTool",get:function get(){return this.$$.ctx[24];},set:function set(enableMoveTool){this.$$set({enableMoveTool:enableMoveTool});flush();}},{key:"enableAutoSelectMoveTool",get:function get(){return this.$$.ctx[25];},set:function set(enableAutoSelectMoveTool){this.$$set({enableAutoSelectMoveTool:enableAutoSelectMoveTool});flush();}},{key:"willRenderShapeControls",get:function get(){return this.$$.ctx[26];},set:function set(willRenderShapeControls){this.$$set({willRenderShapeControls:willRenderShapeControls});flush();}},{key:"beforeAddShape",get:function get(){return this.$$.ctx[27];},set:function set(beforeAddShape){this.$$set({beforeAddShape:beforeAddShape});flush();}},{key:"beforeRemoveShape",get:function get(){return this.$$.ctx[28];},set:function set(beforeRemoveShape){this.$$set({beforeRemoveShape:beforeRemoveShape});flush();}},{key:"beforeDeselectShape",get:function get(){return this.$$.ctx[29];},set:function set(beforeDeselectShape){this.$$set({beforeDeselectShape:beforeDeselectShape});flush();}},{key:"beforeSelectShape",get:function get(){return this.$$.ctx[30];},set:function set(beforeSelectShape){this.$$set({beforeSelectShape:beforeSelectShape});flush();}},{key:"beforeUpdateShape",get:function get(){return this.$$.ctx[31];},set:function set(beforeUpdateShape){this.$$set({beforeUpdateShape:beforeUpdateShape});flush();}},{key:"markupEditorWillStartInteraction",get:function get(){return this.$$.ctx[32];},set:function set(markupEditorWillStartInteraction){this.$$set({markupEditorWillStartInteraction:markupEditorWillStartInteraction});flush();}}]);return Decorate;}(SvelteComponent);// @ts-ignore
var _plugin_decorate={util:['decorate',Decorate]};/* src/core/ui/plugins/sticker/index.svelte generated by Svelte v3.52.0 */function create_fragment$7(ctx){var shapeutil;var current;shapeutil=new ShapeUtil({props:{stores:/*stores*/ctx[3],locale:/*locale*/ctx[4],isActive:/*isActive*/ctx[0],isActiveFraction:/*isActiveFraction*/ctx[1],isVisible:/*isVisible*/ctx[2],mapScreenPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[24],mapImagePointToScreenPoint:/*mapImagePointToScreenPoint*/ctx[23],utilKey:'sticker',shapePresets:/*stickers*/ctx[5],shapes:/*stickerStickToImage*/ctx[6]?/*imageAnnotation*/ctx[30]:/*imageDecoration*/ctx[31],toolActive:'preset',imageFlipX:/*stickerStickToImage*/ctx[6]?/*$imageFlipX*/ctx[22]:false,imageFlipY:/*stickerStickToImage*/ctx[6]?/*$imageFlipY*/ctx[21]:false,imageRotation:/*stickerStickToImage*/ctx[6]?/*$imageRotation*/ctx[26]:0,parentRect:/*stickerStickToImage*/ctx[6]?/*imageSize*/ctx[32]:/*imageCropRect*/ctx[28],enablePresetDropImage:/*stickerEnableDropImagePreset*/ctx[7],enablePresetSelectImage:/*enablePresetSelectImage*/ctx[25],enableButtonFlipVertical:/*stickersEnableButtonFlipVertical*/ctx[10]||/*stickerEnableButtonFlipVertical*/ctx[8],toolSelectRadius:/*markupEditorToolSelectRadius*/ctx[13],willStartInteraction:/*markupEditorWillStartInteraction*/ctx[20],willRenderPresetToolbar:/*stickersWillRenderShapePresetToolbar*/ctx[11]||/*stickerWillRenderShapePresetToolbar*/ctx[9]||/*willRenderShapePresetToolbar*/ctx[14],hooks:{willRenderShapeControls:/*willRenderShapeControls*/ctx[12],beforeAddShape:/*beforeAddShape*/ctx[15],beforeRemoveShape:/*beforeRemoveShape*/ctx[16],beforeDeselectShape:/*beforeDeselectShape*/ctx[17],beforeSelectShape:/*beforeSelectShape*/ctx[18],beforeUpdateShape:/*beforeUpdateShape*/ctx[19]}}});shapeutil.$on("measure",/*measure_handler*/ctx[47]);return{c:function c(){create_component(shapeutil.$$.fragment);},m:function m(target,anchor){mount_component(shapeutil,target,anchor);current=true;},p:function p(ctx,dirty){var shapeutil_changes={};if(dirty[0]&/*stores*/8)shapeutil_changes.stores=/*stores*/ctx[3];if(dirty[0]&/*locale*/16)shapeutil_changes.locale=/*locale*/ctx[4];if(dirty[0]&/*isActive*/1)shapeutil_changes.isActive=/*isActive*/ctx[0];if(dirty[0]&/*isActiveFraction*/2)shapeutil_changes.isActiveFraction=/*isActiveFraction*/ctx[1];if(dirty[0]&/*isVisible*/4)shapeutil_changes.isVisible=/*isVisible*/ctx[2];if(dirty[0]&/*mapScreenPointToImagePoint*/16777216)shapeutil_changes.mapScreenPointToImagePoint=/*mapScreenPointToImagePoint*/ctx[24];if(dirty[0]&/*mapImagePointToScreenPoint*/8388608)shapeutil_changes.mapImagePointToScreenPoint=/*mapImagePointToScreenPoint*/ctx[23];if(dirty[0]&/*stickers*/32)shapeutil_changes.shapePresets=/*stickers*/ctx[5];if(dirty[0]&/*stickerStickToImage*/64)shapeutil_changes.shapes=/*stickerStickToImage*/ctx[6]?/*imageAnnotation*/ctx[30]:/*imageDecoration*/ctx[31];if(dirty[0]&/*stickerStickToImage, $imageFlipX*/4194368)shapeutil_changes.imageFlipX=/*stickerStickToImage*/ctx[6]?/*$imageFlipX*/ctx[22]:false;if(dirty[0]&/*stickerStickToImage, $imageFlipY*/2097216)shapeutil_changes.imageFlipY=/*stickerStickToImage*/ctx[6]?/*$imageFlipY*/ctx[21]:false;if(dirty[0]&/*stickerStickToImage, $imageRotation*/67108928)shapeutil_changes.imageRotation=/*stickerStickToImage*/ctx[6]?/*$imageRotation*/ctx[26]:0;if(dirty[0]&/*stickerStickToImage*/64)shapeutil_changes.parentRect=/*stickerStickToImage*/ctx[6]?/*imageSize*/ctx[32]:/*imageCropRect*/ctx[28];if(dirty[0]&/*stickerEnableDropImagePreset*/128)shapeutil_changes.enablePresetDropImage=/*stickerEnableDropImagePreset*/ctx[7];if(dirty[0]&/*enablePresetSelectImage*/33554432)shapeutil_changes.enablePresetSelectImage=/*enablePresetSelectImage*/ctx[25];if(dirty[0]&/*stickersEnableButtonFlipVertical, stickerEnableButtonFlipVertical*/1280)shapeutil_changes.enableButtonFlipVertical=/*stickersEnableButtonFlipVertical*/ctx[10]||/*stickerEnableButtonFlipVertical*/ctx[8];if(dirty[0]&/*markupEditorToolSelectRadius*/8192)shapeutil_changes.toolSelectRadius=/*markupEditorToolSelectRadius*/ctx[13];if(dirty[0]&/*markupEditorWillStartInteraction*/1048576)shapeutil_changes.willStartInteraction=/*markupEditorWillStartInteraction*/ctx[20];if(dirty[0]&/*stickersWillRenderShapePresetToolbar, stickerWillRenderShapePresetToolbar, willRenderShapePresetToolbar*/18944)shapeutil_changes.willRenderPresetToolbar=/*stickersWillRenderShapePresetToolbar*/ctx[11]||/*stickerWillRenderShapePresetToolbar*/ctx[9]||/*willRenderShapePresetToolbar*/ctx[14];if(dirty[0]&/*willRenderShapeControls, beforeAddShape, beforeRemoveShape, beforeDeselectShape, beforeSelectShape, beforeUpdateShape*/1019904)shapeutil_changes.hooks={willRenderShapeControls:/*willRenderShapeControls*/ctx[12],beforeAddShape:/*beforeAddShape*/ctx[15],beforeRemoveShape:/*beforeRemoveShape*/ctx[16],beforeDeselectShape:/*beforeDeselectShape*/ctx[17],beforeSelectShape:/*beforeSelectShape*/ctx[18],beforeUpdateShape:/*beforeUpdateShape*/ctx[19]};shapeutil.$set(shapeutil_changes);},i:function i(local){if(current)return;transition_in(shapeutil.$$.fragment,local);current=true;},o:function o(local){transition_out(shapeutil.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapeutil,detaching);}};}function instance$7($$self,$$props,$$invalidate){var presentationZoom;var enablePresetSelectImage;var mapScreenPointToImagePoint;var mapImagePointToScreenPoint;var $imageSelectionRectPresentation;var $imageFlipY;var $imageFlipX;var $imageTransformsInterpolated;var $imageTransforms;var $imageSize;var $rootRect;var $imageRotation;var name='sticker';var isActive=$$props.isActive;var isActiveFraction=$$props.isActiveFraction;var isVisible=$$props.isVisible;var stores=$$props.stores;var _$$props$locale10=$$props.locale,locale=_$$props$locale10===void 0?{}:_$$props$locale10;var _$$props$stickers=$$props.stickers,stickers=_$$props$stickers===void 0?[]:_$$props$stickers;var _$$props$stickerStick=$$props.stickerStickToImage,stickerStickToImage=_$$props$stickerStick===void 0?false:_$$props$stickerStick;var _$$props$stickerEnabl=$$props.stickerEnableSelectImagePreset,stickerEnableSelectImagePreset=_$$props$stickerEnabl===void 0?true:_$$props$stickerEnabl;var _$$props$stickerEnabl2=$$props.stickerEnableDropImagePreset,stickerEnableDropImagePreset=_$$props$stickerEnabl2===void 0?true:_$$props$stickerEnabl2;var _$$props$stickerEnabl3=$$props.stickerEnableButtonFlipVertical,stickerEnableButtonFlipVertical=_$$props$stickerEnabl3===void 0?false:_$$props$stickerEnabl3;var _$$props$stickerWillR=$$props.stickerWillRenderShapePresetToolbar,stickerWillRenderShapePresetToolbar=_$$props$stickerWillR===void 0?undefined:_$$props$stickerWillR;var _$$props$stickerEnabl4=$$props.stickerEnableSelectImage,stickerEnableSelectImage=_$$props$stickerEnabl4===void 0?true:_$$props$stickerEnabl4;var _$$props$stickersEnab=$$props.stickersEnableButtonFlipVertical,stickersEnableButtonFlipVertical=_$$props$stickersEnab===void 0?false:_$$props$stickersEnab;var _$$props$stickersWill=$$props.stickersWillRenderShapePresetToolbar,stickersWillRenderShapePresetToolbar=_$$props$stickersWill===void 0?undefined:_$$props$stickersWill;var _$$props$willRenderSh6=$$props.willRenderShapeControls,willRenderShapeControls=_$$props$willRenderSh6===void 0?undefined:_$$props$willRenderSh6;var _$$props$markupEditor21=$$props.markupEditorToolSelectRadius,markupEditorToolSelectRadius=_$$props$markupEditor21===void 0?undefined:_$$props$markupEditor21;var _$$props$willRenderSh7=$$props.willRenderShapePresetToolbar,willRenderShapePresetToolbar=_$$props$willRenderSh7===void 0?undefined:_$$props$willRenderSh7;var _$$props$beforeAddSha3=$$props.beforeAddShape,beforeAddShape=_$$props$beforeAddSha3===void 0?undefined:_$$props$beforeAddSha3;var _$$props$beforeRemove4=$$props.beforeRemoveShape,beforeRemoveShape=_$$props$beforeRemove4===void 0?undefined:_$$props$beforeRemove4;var _$$props$beforeDesele4=$$props.beforeDeselectShape,beforeDeselectShape=_$$props$beforeDesele4===void 0?undefined:_$$props$beforeDesele4;var _$$props$beforeSelect4=$$props.beforeSelectShape,beforeSelectShape=_$$props$beforeSelect4===void 0?undefined:_$$props$beforeSelect4;var _$$props$beforeUpdate4=$$props.beforeUpdateShape,beforeUpdateShape=_$$props$beforeUpdate4===void 0?undefined:_$$props$beforeUpdate4;var _$$props$markupEditor22=$$props.markupEditorWillStartInteraction,markupEditorWillStartInteraction=_$$props$markupEditor22===void 0?undefined:_$$props$markupEditor22;// connect filter choice to stores
var _stores9=stores,rootRect=_stores9.rootRect,imageCropRect=_stores9.imageCropRect,imageSelectionRectPresentation=_stores9.imageSelectionRectPresentation,imageAnnotation=_stores9.imageAnnotation,imageDecoration=_stores9.imageDecoration,imageSize=_stores9.imageSize,imageTransforms=_stores9.imageTransforms,imageTransformsInterpolated=_stores9.imageTransformsInterpolated,imageRotation=_stores9.imageRotation,imageFlipX=_stores9.imageFlipX,imageFlipY=_stores9.imageFlipY;component_subscribe($$self,rootRect,function(value){return $$invalidate(46,$rootRect=value);});component_subscribe($$self,imageSelectionRectPresentation,function(value){return $$invalidate(42,$imageSelectionRectPresentation=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(45,$imageSize=value);});component_subscribe($$self,imageTransforms,function(value){return $$invalidate(44,$imageTransforms=value);});component_subscribe($$self,imageTransformsInterpolated,function(value){return $$invalidate(43,$imageTransformsInterpolated=value);});component_subscribe($$self,imageRotation,function(value){return $$invalidate(26,$imageRotation=value);});component_subscribe($$self,imageFlipX,function(value){return $$invalidate(22,$imageFlipX=value);});component_subscribe($$self,imageFlipY,function(value){return $$invalidate(21,$imageFlipY=value);});function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('isActive'in $$props)$$invalidate(0,isActive=$$props.isActive);if('isActiveFraction'in $$props)$$invalidate(1,isActiveFraction=$$props.isActiveFraction);if('isVisible'in $$props)$$invalidate(2,isVisible=$$props.isVisible);if('stores'in $$props)$$invalidate(3,stores=$$props.stores);if('locale'in $$props)$$invalidate(4,locale=$$props.locale);if('stickers'in $$props)$$invalidate(5,stickers=$$props.stickers);if('stickerStickToImage'in $$props)$$invalidate(6,stickerStickToImage=$$props.stickerStickToImage);if('stickerEnableSelectImagePreset'in $$props)$$invalidate(39,stickerEnableSelectImagePreset=$$props.stickerEnableSelectImagePreset);if('stickerEnableDropImagePreset'in $$props)$$invalidate(7,stickerEnableDropImagePreset=$$props.stickerEnableDropImagePreset);if('stickerEnableButtonFlipVertical'in $$props)$$invalidate(8,stickerEnableButtonFlipVertical=$$props.stickerEnableButtonFlipVertical);if('stickerWillRenderShapePresetToolbar'in $$props)$$invalidate(9,stickerWillRenderShapePresetToolbar=$$props.stickerWillRenderShapePresetToolbar);if('stickerEnableSelectImage'in $$props)$$invalidate(40,stickerEnableSelectImage=$$props.stickerEnableSelectImage);if('stickersEnableButtonFlipVertical'in $$props)$$invalidate(10,stickersEnableButtonFlipVertical=$$props.stickersEnableButtonFlipVertical);if('stickersWillRenderShapePresetToolbar'in $$props)$$invalidate(11,stickersWillRenderShapePresetToolbar=$$props.stickersWillRenderShapePresetToolbar);if('willRenderShapeControls'in $$props)$$invalidate(12,willRenderShapeControls=$$props.willRenderShapeControls);if('markupEditorToolSelectRadius'in $$props)$$invalidate(13,markupEditorToolSelectRadius=$$props.markupEditorToolSelectRadius);if('willRenderShapePresetToolbar'in $$props)$$invalidate(14,willRenderShapePresetToolbar=$$props.willRenderShapePresetToolbar);if('beforeAddShape'in $$props)$$invalidate(15,beforeAddShape=$$props.beforeAddShape);if('beforeRemoveShape'in $$props)$$invalidate(16,beforeRemoveShape=$$props.beforeRemoveShape);if('beforeDeselectShape'in $$props)$$invalidate(17,beforeDeselectShape=$$props.beforeDeselectShape);if('beforeSelectShape'in $$props)$$invalidate(18,beforeSelectShape=$$props.beforeSelectShape);if('beforeUpdateShape'in $$props)$$invalidate(19,beforeUpdateShape=$$props.beforeUpdateShape);if('markupEditorWillStartInteraction'in $$props)$$invalidate(20,markupEditorWillStartInteraction=$$props.markupEditorWillStartInteraction);};$$self.$$.update=function(){if($$self.$$.dirty[1]&/*$imageTransformsInterpolated*/4096){$$invalidate(41,presentationZoom=$imageTransformsInterpolated?$imageTransformsInterpolated.scale:1);}if($$self.$$.dirty[1]&/*stickerEnableSelectImagePreset, stickerEnableSelectImage*/768){$$invalidate(25,enablePresetSelectImage=stickerEnableSelectImagePreset===false?false:stickerEnableSelectImage);// || stickerEnableSelectImagePreset
}if($$self.$$.dirty[0]&/*stickerStickToImage, $imageFlipX, $imageFlipY*/6291520|$$self.$$.dirty[1]&/*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, $imageSelectionRectPresentation, presentationZoom*/64512){//
// Mapping coordinates
//
$$invalidate(24,mapScreenPointToImagePoint=stickerStickToImage?function(point){return _mapScreenPointToImagePoint(point,$rootRect,$imageSize,$imageTransformsInterpolated.origin,$imageTransformsInterpolated.translation,$imageTransforms.rotation.z,$imageTransformsInterpolated.scale,$imageFlipX,$imageFlipY);}:function(point){var mappedPoint=vectorClone(point);mappedPoint.x-=$imageSelectionRectPresentation.x;mappedPoint.y-=$imageSelectionRectPresentation.y;mappedPoint.x/=presentationZoom;mappedPoint.y/=presentationZoom;return mappedPoint;});}if($$self.$$.dirty[0]&/*stickerStickToImage, $imageFlipX, $imageFlipY*/6291520|$$self.$$.dirty[1]&/*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, presentationZoom, $imageSelectionRectPresentation*/64512){$$invalidate(23,mapImagePointToScreenPoint=stickerStickToImage?function(point){return _mapImagePointToScreenPoint(point,$rootRect,$imageSize,$imageTransformsInterpolated.origin,$imageTransformsInterpolated.translation,$imageTransforms.rotation.z,$imageTransformsInterpolated.scale,$imageFlipX,$imageFlipY);}:function(point){var mappedPoint=vectorClone(point);mappedPoint.x*=presentationZoom;mappedPoint.y*=presentationZoom;mappedPoint.x+=$imageSelectionRectPresentation.x;mappedPoint.y+=$imageSelectionRectPresentation.y;return mappedPoint;});}};return[isActive,isActiveFraction,isVisible,stores,locale,stickers,stickerStickToImage,stickerEnableDropImagePreset,stickerEnableButtonFlipVertical,stickerWillRenderShapePresetToolbar,stickersEnableButtonFlipVertical,stickersWillRenderShapePresetToolbar,willRenderShapeControls,markupEditorToolSelectRadius,willRenderShapePresetToolbar,beforeAddShape,beforeRemoveShape,beforeDeselectShape,beforeSelectShape,beforeUpdateShape,markupEditorWillStartInteraction,$imageFlipY,$imageFlipX,mapImagePointToScreenPoint,mapScreenPointToImagePoint,enablePresetSelectImage,$imageRotation,rootRect,imageCropRect,imageSelectionRectPresentation,imageAnnotation,imageDecoration,imageSize,imageTransforms,imageTransformsInterpolated,imageRotation,imageFlipX,imageFlipY,name,stickerEnableSelectImagePreset,stickerEnableSelectImage,presentationZoom,$imageSelectionRectPresentation,$imageTransformsInterpolated,$imageTransforms,$imageSize,$rootRect,measure_handler];}var Sticker=/*#__PURE__*/function(_SvelteComponent47){_inherits(Sticker,_SvelteComponent47);var _super48=_createSuper(Sticker);function Sticker(options){var _this49;_classCallCheck(this,Sticker);_this49=_super48.call(this);init(_assertThisInitialized(_this49),options,instance$7,create_fragment$7,safe_not_equal,{name:38,isActive:0,isActiveFraction:1,isVisible:2,stores:3,locale:4,stickers:5,stickerStickToImage:6,stickerEnableSelectImagePreset:39,stickerEnableDropImagePreset:7,stickerEnableButtonFlipVertical:8,stickerWillRenderShapePresetToolbar:9,stickerEnableSelectImage:40,stickersEnableButtonFlipVertical:10,stickersWillRenderShapePresetToolbar:11,willRenderShapeControls:12,markupEditorToolSelectRadius:13,willRenderShapePresetToolbar:14,beforeAddShape:15,beforeRemoveShape:16,beforeDeselectShape:17,beforeSelectShape:18,beforeUpdateShape:19,markupEditorWillStartInteraction:20},null,[-1,-1]);return _this49;}_createClass(Sticker,[{key:"name",get:function get(){return this.$$.ctx[38];}},{key:"isActive",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"isActiveFraction",get:function get(){return this.$$.ctx[1];},set:function set(isActiveFraction){this.$$set({isActiveFraction:isActiveFraction});flush();}},{key:"isVisible",get:function get(){return this.$$.ctx[2];},set:function set(isVisible){this.$$set({isVisible:isVisible});flush();}},{key:"stores",get:function get(){return this.$$.ctx[3];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"locale",get:function get(){return this.$$.ctx[4];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"stickers",get:function get(){return this.$$.ctx[5];},set:function set(stickers){this.$$set({stickers:stickers});flush();}},{key:"stickerStickToImage",get:function get(){return this.$$.ctx[6];},set:function set(stickerStickToImage){this.$$set({stickerStickToImage:stickerStickToImage});flush();}},{key:"stickerEnableSelectImagePreset",get:function get(){return this.$$.ctx[39];},set:function set(stickerEnableSelectImagePreset){this.$$set({stickerEnableSelectImagePreset:stickerEnableSelectImagePreset});flush();}},{key:"stickerEnableDropImagePreset",get:function get(){return this.$$.ctx[7];},set:function set(stickerEnableDropImagePreset){this.$$set({stickerEnableDropImagePreset:stickerEnableDropImagePreset});flush();}},{key:"stickerEnableButtonFlipVertical",get:function get(){return this.$$.ctx[8];},set:function set(stickerEnableButtonFlipVertical){this.$$set({stickerEnableButtonFlipVertical:stickerEnableButtonFlipVertical});flush();}},{key:"stickerWillRenderShapePresetToolbar",get:function get(){return this.$$.ctx[9];},set:function set(stickerWillRenderShapePresetToolbar){this.$$set({stickerWillRenderShapePresetToolbar:stickerWillRenderShapePresetToolbar});flush();}},{key:"stickerEnableSelectImage",get:function get(){return this.$$.ctx[40];},set:function set(stickerEnableSelectImage){this.$$set({stickerEnableSelectImage:stickerEnableSelectImage});flush();}},{key:"stickersEnableButtonFlipVertical",get:function get(){return this.$$.ctx[10];},set:function set(stickersEnableButtonFlipVertical){this.$$set({stickersEnableButtonFlipVertical:stickersEnableButtonFlipVertical});flush();}},{key:"stickersWillRenderShapePresetToolbar",get:function get(){return this.$$.ctx[11];},set:function set(stickersWillRenderShapePresetToolbar){this.$$set({stickersWillRenderShapePresetToolbar:stickersWillRenderShapePresetToolbar});flush();}},{key:"willRenderShapeControls",get:function get(){return this.$$.ctx[12];},set:function set(willRenderShapeControls){this.$$set({willRenderShapeControls:willRenderShapeControls});flush();}},{key:"markupEditorToolSelectRadius",get:function get(){return this.$$.ctx[13];},set:function set(markupEditorToolSelectRadius){this.$$set({markupEditorToolSelectRadius:markupEditorToolSelectRadius});flush();}},{key:"willRenderShapePresetToolbar",get:function get(){return this.$$.ctx[14];},set:function set(willRenderShapePresetToolbar){this.$$set({willRenderShapePresetToolbar:willRenderShapePresetToolbar});flush();}},{key:"beforeAddShape",get:function get(){return this.$$.ctx[15];},set:function set(beforeAddShape){this.$$set({beforeAddShape:beforeAddShape});flush();}},{key:"beforeRemoveShape",get:function get(){return this.$$.ctx[16];},set:function set(beforeRemoveShape){this.$$set({beforeRemoveShape:beforeRemoveShape});flush();}},{key:"beforeDeselectShape",get:function get(){return this.$$.ctx[17];},set:function set(beforeDeselectShape){this.$$set({beforeDeselectShape:beforeDeselectShape});flush();}},{key:"beforeSelectShape",get:function get(){return this.$$.ctx[18];},set:function set(beforeSelectShape){this.$$set({beforeSelectShape:beforeSelectShape});flush();}},{key:"beforeUpdateShape",get:function get(){return this.$$.ctx[19];},set:function set(beforeUpdateShape){this.$$set({beforeUpdateShape:beforeUpdateShape});flush();}},{key:"markupEditorWillStartInteraction",get:function get(){return this.$$.ctx[20];},set:function set(markupEditorWillStartInteraction){this.$$set({markupEditorWillStartInteraction:markupEditorWillStartInteraction});flush();}}]);return Sticker;}(SvelteComponent);// @ts-ignore
var _plugin_sticker={util:['sticker',Sticker]};/* src/core/ui/plugins/frame/index.svelte generated by Svelte v3.52.0 */function create_option_slot$1(ctx){var div;var html_tag;var raw_value=(/*getOptionThumb*/ctx[14](/*option*/ctx[33].value)||'')+"";var t0;var span;var t1_value=(isFunction(/*option*/ctx[33].label)?/*option*/ctx[33].label(/*locale*/ctx[1]):/*option*/ctx[33].label)+"";var t1;return{c:function c(){div=element("div");html_tag=new HtmlTag(false);t0=space();span=element("span");t1=text(t1_value);html_tag.a=t0;attr(div,"slot","option");},m:function m(target,anchor){insert(target,div,anchor);html_tag.m(raw_value,div);append(div,t0);append(div,span);append(span,t1);},p:function p(ctx,dirty){if(dirty[1]&/*option*/4&&raw_value!==(raw_value=(/*getOptionThumb*/ctx[14](/*option*/ctx[33].value)||'')+""))html_tag.p(raw_value);if(dirty[0]&/*locale*/2|dirty[1]&/*option*/4&&t1_value!==(t1_value=(isFunction(/*option*/ctx[33].label)?/*option*/ctx[33].label(/*locale*/ctx[1]):/*option*/ctx[33].label)+""))set_data(t1,t1_value);},d:function d(detaching){if(detaching)detach(div);}};}// (157:8) <Scrollable elasticity={scrollElasticity}>
function create_default_slot$3(ctx){var radiogroup;var current;radiogroup=new RadioGroup({props:{locale:/*locale*/ctx[1],"class":"PinturaControlList",layout:"row",options:/*frameOptions*/ctx[2],selectedIndex:/*selectedFrameIndex*/ctx[6],onchange:/*handleChangeFrame*/ctx[12],$$slots:{option:[create_option_slot$1,function(_ref434){var option=_ref434.option;return{33:option};},function(_ref435){var option=_ref435.option;return[0,option?4:0];}]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(radiogroup.$$.fragment);},m:function m(target,anchor){mount_component(radiogroup,target,anchor);current=true;},p:function p(ctx,dirty){var radiogroup_changes={};if(dirty[0]&/*locale*/2)radiogroup_changes.locale=/*locale*/ctx[1];if(dirty[0]&/*frameOptions*/4)radiogroup_changes.options=/*frameOptions*/ctx[2];if(dirty[0]&/*selectedFrameIndex*/64)radiogroup_changes.selectedIndex=/*selectedFrameIndex*/ctx[6];if(dirty[0]&/*locale*/2|dirty[1]&/*$$scope, option*/12){radiogroup_changes.$$scope={dirty:dirty,ctx:ctx};}radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radiogroup,detaching);}};}// (148:4) 
function create_footer_slot$2(ctx){var div;var shapestyleeditor;var t;var scrollable;var current;shapestyleeditor=new ShapeStyleEditor({props:{locale:/*locale*/ctx[1],"class":"PinturaControlPanels",shape:/*$imageFrame*/ctx[4],onchange:/*handleUpdateSelectedFrameShape*/ctx[13],controls:/*markupEditorShapeStyleControls*/ctx[3],scrollElasticity:/*computedScrollElasticity*/ctx[7]}});scrollable=new Scrollable({props:{elasticity:/*scrollElasticity*/ctx[10],$$slots:{"default":[create_default_slot$3]},$$scope:{ctx:ctx}}});return{c:function c(){div=element("div");create_component(shapestyleeditor.$$.fragment);t=space();create_component(scrollable.$$.fragment);attr(div,"slot","footer");attr(div,"style",/*footerStyle*/ctx[5]);},m:function m(target,anchor){insert(target,div,anchor);mount_component(shapestyleeditor,div,null);append(div,t);mount_component(scrollable,div,null);current=true;},p:function p(ctx,dirty){var shapestyleeditor_changes={};if(dirty[0]&/*locale*/2)shapestyleeditor_changes.locale=/*locale*/ctx[1];if(dirty[0]&/*$imageFrame*/16)shapestyleeditor_changes.shape=/*$imageFrame*/ctx[4];if(dirty[0]&/*markupEditorShapeStyleControls*/8)shapestyleeditor_changes.controls=/*markupEditorShapeStyleControls*/ctx[3];if(dirty[0]&/*computedScrollElasticity*/128)shapestyleeditor_changes.scrollElasticity=/*computedScrollElasticity*/ctx[7];shapestyleeditor.$set(shapestyleeditor_changes);var scrollable_changes={};if(dirty[0]&/*locale, frameOptions, selectedFrameIndex*/70|dirty[1]&/*$$scope*/8){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);if(!current||dirty[0]&/*footerStyle*/32){attr(div,"style",/*footerStyle*/ctx[5]);}},i:function i(local){if(current)return;transition_in(shapestyleeditor.$$.fragment,local);transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(shapestyleeditor.$$.fragment,local);transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(shapestyleeditor);destroy_component(scrollable);}};}function create_fragment$6(ctx){var util;var current;util=new Util({props:{$$slots:{footer:[create_footer_slot$2]},$$scope:{ctx:ctx}}});util.$on("measure",/*measure_handler*/ctx[23]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*footerStyle, locale, frameOptions, selectedFrameIndex, $imageFrame, markupEditorShapeStyleControls, computedScrollElasticity*/254|dirty[1]&/*$$scope*/8){util_changes.$$scope={dirty:dirty,ctx:ctx};}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}function instance$6($$self,$$props,$$invalidate){var computedScrollElasticity;var selectedFrameIndex;var footerStyle;var $footerOffset;var $isActive,$$unsubscribe_isActive=noop,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(20,$isActive=$$value);}),isActive;};var $animation;var $imageFrame;var $elasticityMultiplier;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});var name='frame';var isActive=$$props.isActive;$$subscribe_isActive();var stores=$$props.stores;var _$$props$locale11=$$props.locale,locale=_$$props$locale11===void 0?{}:_$$props$locale11;var _$$props$frameStyles=$$props.frameStyles,frameStyles=_$$props$frameStyles===void 0?{}:_$$props$frameStyles;var _$$props$frameOptions=$$props.frameOptions,frameOptions=_$$props$frameOptions===void 0?[]:_$$props$frameOptions;var _$$props$markupEditor23=$$props.markupEditorShapeStyleControls,markupEditorShapeStyleControls=_$$props$markupEditor23===void 0?undefined:_$$props$markupEditor23;//
// context
//
var elasticityMultiplier=getContext('elasticityMultiplier');component_subscribe($$self,elasticityMultiplier,function(value){return $$invalidate(22,$elasticityMultiplier=value);});// connect filter choice to stores
var _stores10=stores,history=_stores10.history,animation=_stores10.animation,scrollElasticity=_stores10.scrollElasticity,imageFrame=_stores10.imageFrame,allowPan=_stores10.allowPan,allowZoom=_stores10.allowZoom,allowZoomControls=_stores10.allowZoomControls;component_subscribe($$self,animation,function(value){return $$invalidate(21,$animation=value);});component_subscribe($$self,imageFrame,function(value){return $$invalidate(4,$imageFrame=value);});// default frame styles
var frameActiveStyles={};var handleChangeFrame=function handleChangeFrame(_ref436){var value=_ref436.value;// get new frame
var frameBase=frameStyles[value];// no new frame selected
if(!frameBase||!frameBase.shape){imageFrame.set(undefined);history.write();return;}var shape=frameBase.shape;// create new base frame
var frame=_objectSpread(_objectSpread({id:value},shapeDeepCopy(shape)),Object.keys(frameActiveStyles).reduce(function(frameStyles,prop){if(!shape[prop])return frameStyles;frameStyles[prop]=frameActiveStyles[prop];return frameStyles;},{}));imageFrame.set(frame);history.write();};var updateWriteHistoryTimeoutId;function handleUpdateSelectedFrameShape(props){// remember color style for when creating or styling other element
if(hasProp(props,'frameColor'))frameActiveStyles.frameColor=props.frameColor;// it's possible we're only updating default styles
if(!$imageFrame)return;// frameSelected
shapeUpdateProps($imageFrame,props);// update shape so ui shape controls are updated
imageFrame.set($imageFrame);// so we don't write every state change to history
clearTimeout(updateWriteHistoryTimeoutId);updateWriteHistoryTimeoutId=setTimeout(function(){history.write();},200);}var isIncompleteSVGMarkup=function isIncompleteSVGMarkup(str){return /rect|path|circle|line|<g>/i.test(str);};var isHTML=function isHTML(str){return /div/i.test(str);};var getThumb=function getThumb(value){if(isHTML(value))return value;// could be full svg
if(isSVGMarkup(value))return value;// could be a partial svg in which case we turn it into a full svg
if(isIncompleteSVGMarkup(value))return"<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" stroke-width=\"1\" stroke=\"currentColor\" fill=\"none\" aria-hidden=\"true\" focusable=\"false\" stroke-linecap=\"round\" stroke-linejoin=\"round\">".concat(value,"</svg>");// if not, must be URL
return"<img src=\"".concat(value,"\" alt=\"\"/>");};var getOptionThumb=function getOptionThumb(key){var frameStyle=frameStyles[key];if(!frameStyle||!frameStyle.thumb)return;return getThumb(frameStyle.thumb);};//
// Footer style
//
var footerOffset=spring($animation?20:0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(19,$footerOffset=value);});function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('isActive'in $$props)$$subscribe_isActive($$invalidate(0,isActive=$$props.isActive));if('stores'in $$props)$$invalidate(17,stores=$$props.stores);if('locale'in $$props)$$invalidate(1,locale=$$props.locale);if('frameStyles'in $$props)$$invalidate(18,frameStyles=$$props.frameStyles);if('frameOptions'in $$props)$$invalidate(2,frameOptions=$$props.frameOptions);if('markupEditorShapeStyleControls'in $$props)$$invalidate(3,markupEditorShapeStyleControls=$$props.markupEditorShapeStyleControls);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*$isActive*/1048576){// enable pan and zoom
allowPan.set($isActive);}if($$self.$$.dirty[0]&/*$isActive*/1048576){allowZoom.set($isActive);}if($$self.$$.dirty[0]&/*$isActive*/1048576){allowZoomControls.set($isActive);}if($$self.$$.dirty[0]&/*$elasticityMultiplier*/4194304){//
// scroll components
//
$$invalidate(7,computedScrollElasticity=$elasticityMultiplier*scrollElasticity);}if($$self.$$.dirty[0]&/*$imageFrame, frameOptions*/20){// current index in frame list
$$invalidate(6,selectedFrameIndex=$imageFrame?frameOptions.findIndex(function(_ref437){var _ref438=_slicedToArray(_ref437,1),id=_ref438[0];return id===$imageFrame.id;}):0);}if($$self.$$.dirty[0]&/*$animation, $isActive*/3145728){$animation&&footerOffset.set($isActive?0:20);}if($$self.$$.dirty[0]&/*$footerOffset*/524288){$$invalidate(5,footerStyle=$footerOffset?"transform: translateY(".concat($footerOffset,"px)"):undefined);}};return[isActive,locale,frameOptions,markupEditorShapeStyleControls,$imageFrame,footerStyle,selectedFrameIndex,computedScrollElasticity,elasticityMultiplier,animation,scrollElasticity,imageFrame,handleChangeFrame,handleUpdateSelectedFrameShape,getOptionThumb,footerOffset,name,stores,frameStyles,$footerOffset,$isActive,$animation,$elasticityMultiplier,measure_handler];}var Frame=/*#__PURE__*/function(_SvelteComponent48){_inherits(Frame,_SvelteComponent48);var _super49=_createSuper(Frame);function Frame(options){var _this50;_classCallCheck(this,Frame);_this50=_super49.call(this);init(_assertThisInitialized(_this50),options,instance$6,create_fragment$6,safe_not_equal,{name:16,isActive:0,stores:17,locale:1,frameStyles:18,frameOptions:2,markupEditorShapeStyleControls:3},null,[-1,-1]);return _this50;}_createClass(Frame,[{key:"name",get:function get(){return this.$$.ctx[16];}},{key:"isActive",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"stores",get:function get(){return this.$$.ctx[17];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"locale",get:function get(){return this.$$.ctx[1];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"frameStyles",get:function get(){return this.$$.ctx[18];},set:function set(frameStyles){this.$$set({frameStyles:frameStyles});flush();}},{key:"frameOptions",get:function get(){return this.$$.ctx[2];},set:function set(frameOptions){this.$$set({frameOptions:frameOptions});flush();}},{key:"markupEditorShapeStyleControls",get:function get(){return this.$$.ctx[3];},set:function set(markupEditorShapeStyleControls){this.$$set({markupEditorShapeStyleControls:markupEditorShapeStyleControls});flush();}}]);return Frame;}(SvelteComponent);// @ts-ignore
var _plugin_frame={util:['frame',Frame,function(_ref439){var duration=_ref439.duration;return!duration;}]};/* src/core/ui/plugins/resize/DimensionInput.svelte generated by Svelte v3.52.0 */function create_fragment$5(ctx){var div;var input;var input_value_value;var t0;var label_1;var t1;var mounted;var dispose;return{c:function c(){div=element("div");input=element("input");t0=space();label_1=element("label");t1=text(/*label*/ctx[1]);attr(input,"id",/*id*/ctx[0]);attr(input,"type","number");attr(input,"min","1");attr(input,"inputmode","numeric");attr(input,"pattern","[0-9]*");attr(input,"data-state",/*state*/ctx[3]);attr(input,"autocomplete","off");attr(input,"placeholder",/*placeholder*/ctx[4]);input.value=input_value_value=/*value*/ctx[5]===undefined?'':/*format*/ctx[7](/*value*/ctx[5]+'');attr(label_1,"for",/*id*/ctx[0]);attr(label_1,"title",/*title*/ctx[2]);attr(label_1,"aria-label",/*title*/ctx[2]);attr(div,"class","PinturaInputDimension");},m:function m(target,anchor){insert(target,div,anchor);append(div,input);append(div,t0);append(div,label_1);append(label_1,t1);if(!mounted){dispose=listen(input,"input",/*input_handler*/ctx[8]);mounted=true;}},p:function p(ctx,_ref440){var _ref441=_slicedToArray(_ref440,1),dirty=_ref441[0];if(dirty&/*id*/1){attr(input,"id",/*id*/ctx[0]);}if(dirty&/*state*/8){attr(input,"data-state",/*state*/ctx[3]);}if(dirty&/*placeholder*/16){attr(input,"placeholder",/*placeholder*/ctx[4]);}if(dirty&/*value, format*/160&&input_value_value!==(input_value_value=/*value*/ctx[5]===undefined?'':/*format*/ctx[7](/*value*/ctx[5]+''))&&input.value!==input_value_value){input.value=input_value_value;}if(dirty&/*label*/2)set_data(t1,/*label*/ctx[1]);if(dirty&/*id*/1){attr(label_1,"for",/*id*/ctx[0]);}if(dirty&/*title*/4){attr(label_1,"title",/*title*/ctx[2]);}if(dirty&/*title*/4){attr(label_1,"aria-label",/*title*/ctx[2]);}},i:noop,o:noop,d:function d(detaching){if(detaching)detach(div);mounted=false;dispose();}};}function instance$5($$self,$$props,$$invalidate){var id=$$props.id;var label=$$props.label;var title=$$props.title;var state=$$props.state;var placeholder=$$props.placeholder;var value=$$props.value;var onchange=$$props.onchange;var _$$props$format=$$props.format,format=_$$props$format===void 0?function(str){return str.replace(/\D/g,'');}:_$$props$format;var input_handler=function input_handler(e){return onchange(format(e.currentTarget.value));};$$self.$$set=function($$props){if('id'in $$props)$$invalidate(0,id=$$props.id);if('label'in $$props)$$invalidate(1,label=$$props.label);if('title'in $$props)$$invalidate(2,title=$$props.title);if('state'in $$props)$$invalidate(3,state=$$props.state);if('placeholder'in $$props)$$invalidate(4,placeholder=$$props.placeholder);if('value'in $$props)$$invalidate(5,value=$$props.value);if('onchange'in $$props)$$invalidate(6,onchange=$$props.onchange);if('format'in $$props)$$invalidate(7,format=$$props.format);};return[id,label,title,state,placeholder,value,onchange,format,input_handler];}var DimensionInput=/*#__PURE__*/function(_SvelteComponent49){_inherits(DimensionInput,_SvelteComponent49);var _super50=_createSuper(DimensionInput);function DimensionInput(options){var _this51;_classCallCheck(this,DimensionInput);_this51=_super50.call(this);init(_assertThisInitialized(_this51),options,instance$5,create_fragment$5,safe_not_equal,{id:0,label:1,title:2,state:3,placeholder:4,value:5,onchange:6,format:7});return _this51;}return _createClass(DimensionInput);}(SvelteComponent);/* src/core/ui/plugins/resize/DimensionLock.svelte generated by Svelte v3.52.0 */function create_default_slot$2(ctx){var g;return{c:function c(){g=svg_element("g");},m:function m(target,anchor){insert(target,g,anchor);g.innerHTML=/*icon*/ctx[2];},p:function p(ctx,dirty){if(dirty&/*icon*/4)g.innerHTML=/*icon*/ctx[2];},d:function d(detaching){if(detaching)detach(g);}};}function create_fragment$4(ctx){var div;var input;var t;var label;var icon_1;var current;var mounted;var dispose;icon_1=new Icon({props:{$$slots:{"default":[create_default_slot$2]},$$scope:{ctx:ctx}}});return{c:function c(){div=element("div");input=element("input");t=space();label=element("label");create_component(icon_1.$$.fragment);attr(input,"id",/*id*/ctx[0]);attr(input,"class","implicit");attr(input,"type","checkbox");input.checked=/*locked*/ctx[1];attr(label,"for",/*id*/ctx[0]);attr(label,"title",/*title*/ctx[3]);},m:function m(target,anchor){insert(target,div,anchor);append(div,input);append(div,t);append(div,label);mount_component(icon_1,label,null);current=true;if(!mounted){dispose=listen(input,"change",/*change_handler*/ctx[5]);mounted=true;}},p:function p(ctx,_ref442){var _ref443=_slicedToArray(_ref442,1),dirty=_ref443[0];if(!current||dirty&/*id*/1){attr(input,"id",/*id*/ctx[0]);}if(!current||dirty&/*locked*/2){input.checked=/*locked*/ctx[1];}var icon_1_changes={};if(dirty&/*$$scope, icon*/68){icon_1_changes.$$scope={dirty:dirty,ctx:ctx};}icon_1.$set(icon_1_changes);if(!current||dirty&/*id*/1){attr(label,"for",/*id*/ctx[0]);}if(!current||dirty&/*title*/8){attr(label,"title",/*title*/ctx[3]);}},i:function i(local){if(current)return;transition_in(icon_1.$$.fragment,local);current=true;},o:function o(local){transition_out(icon_1.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(icon_1);mounted=false;dispose();}};}function instance$4($$self,$$props,$$invalidate){var id=$$props.id;var locked=$$props.locked;var icon=$$props.icon;var title=$$props.title;var onchange=$$props.onchange;var change_handler=function change_handler(e){return onchange(e.currentTarget.checked);};$$self.$$set=function($$props){if('id'in $$props)$$invalidate(0,id=$$props.id);if('locked'in $$props)$$invalidate(1,locked=$$props.locked);if('icon'in $$props)$$invalidate(2,icon=$$props.icon);if('title'in $$props)$$invalidate(3,title=$$props.title);if('onchange'in $$props)$$invalidate(4,onchange=$$props.onchange);};return[id,locked,icon,title,onchange,change_handler];}var DimensionLock=/*#__PURE__*/function(_SvelteComponent50){_inherits(DimensionLock,_SvelteComponent50);var _super51=_createSuper(DimensionLock);function DimensionLock(options){var _this52;_classCallCheck(this,DimensionLock);_this52=_super51.call(this);init(_assertThisInitialized(_this52),options,instance$4,create_fragment$4,safe_not_equal,{id:0,locked:1,icon:2,title:3,onchange:4});return _this52;}return _createClass(DimensionLock);}(SvelteComponent);/* src/core/ui/plugins/resize/index.svelte generated by Svelte v3.52.0 */function create_default_slot$1(ctx){var t;return{c:function c(){t=text("Save");},m:function m(target,anchor){insert(target,t,anchor);},d:function d(detaching){if(detaching)detach(t);}};}// (596:4) 
function create_footer_slot$1(ctx){var form;var div1;var fieldset;var legend;var t0_value=/*locale*/ctx[1].resizeLabelFormCaption+"";var t0;var t1;var div0;var dynamiccomponenttree;var t2;var button;var current;var mounted;var dispose;dynamiccomponenttree=new DynamicComponentTree_1({props:{items:/*tools*/ctx[4]}});button=new Button({props:{type:"submit","class":"implicit",$$slots:{"default":[create_default_slot$1]},$$scope:{ctx:ctx}}});return{c:function c(){form=element("form");div1=element("div");fieldset=element("fieldset");legend=element("legend");t0=text(t0_value);t1=space();div0=element("div");create_component(dynamiccomponenttree.$$.fragment);t2=space();create_component(button.$$.fragment);attr(legend,"class","implicit");attr(div0,"class","PinturaFieldsetInner");attr(div1,"class","PinturaFormInner");attr(form,"slot","footer");attr(form,"style",/*footerStyle*/ctx[3]);},m:function m(target,anchor){insert(target,form,anchor);append(form,div1);append(div1,fieldset);append(fieldset,legend);append(legend,t0);append(fieldset,t1);append(fieldset,div0);mount_component(dynamiccomponenttree,div0,null);/*div0_binding*/ctx[64](div0);append(div1,t2);mount_component(button,div1,null);current=true;if(!mounted){dispose=[listen(div0,"focusin",/*handleFocusIn*/ctx[15]),listen(div0,"focusout",/*handleFocusOut*/ctx[16]),listen(form,"submit",prevent_default(/*handleSubmit*/ctx[17]))];mounted=true;}},p:function p(ctx,dirty){if((!current||dirty[0]&/*locale*/2)&&t0_value!==(t0_value=/*locale*/ctx[1].resizeLabelFormCaption+""))set_data(t0,t0_value);var dynamiccomponenttree_changes={};if(dirty[0]&/*tools*/16)dynamiccomponenttree_changes.items=/*tools*/ctx[4];dynamiccomponenttree.$set(dynamiccomponenttree_changes);var button_changes={};if(dirty[3]&/*$$scope*/4){button_changes.$$scope={dirty:dirty,ctx:ctx};}button.$set(button_changes);if(!current||dirty[0]&/*footerStyle*/8){attr(form,"style",/*footerStyle*/ctx[3]);}},i:function i(local){if(current)return;transition_in(dynamiccomponenttree.$$.fragment,local);transition_in(button.$$.fragment,local);current=true;},o:function o(local){transition_out(dynamiccomponenttree.$$.fragment,local);transition_out(button.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(form);destroy_component(dynamiccomponenttree);/*div0_binding*/ctx[64](null);destroy_component(button);mounted=false;run_all(dispose);}};}function create_fragment$3(ctx){var util;var current;util=new Util({props:{$$slots:{footer:[create_footer_slot$1]},$$scope:{ctx:ctx}}});util.$on("measure",/*measure_handler*/ctx[65]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*footerStyle, fieldsGroup, tools, locale*/30|dirty[3]&/*$$scope*/4){util_changes.$$scope={dirty:dirty,ctx:ctx};}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}function instance$3($$self,$$props,$$invalidate){var sizePresetLabel;var widthPresetLabel;var heightPresetLabel;var canRenderSizePresets;var canRenderWidthPresets;var canRenderHeightPresets;var canRenderSizeInputs;var tools;var footerStyle;var $footerOffset;var $isActive,$$unsubscribe_isActive=noop,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(48,$isActive=$$value);}),isActive;};var $animation;var $env;var $imageCropRect;var $imageCropRectAspectRatio;var $iconActiveFraction;var $heightPresetSelectedIndex;var $formattedResizeHeightPresetOptions;var $widthPresetSelectedIndex;var $formattedResizeWidthPresetOptions;var $sizePresetSelectedIndex;var $formattedResizeSizePresetOptions;var $imageOutputSize;var $imageCropAspectRatio;var $formattedResizeHeightPresetOptionsFlattened;var $formattedResizeWidthPresetOptionsFlattened;var $formattedResizeSizePresetOptionsFlattened;var $imageSize;var $imageSelectionZoom;var $imageSelectionPan;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});var formatValue=function formatValue(value){var min=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var max=arguments.length>2&&arguments[2]!==undefined?arguments[2]:9999;if(isString(value)){value=value.replace(/\D/g,'');if(!value.length)return;}var v=Math.round(value);if(Number.isNaN(v))return;return clamp(v,min,max);};var name='resize';var isActive=$$props.isActive;$$subscribe_isActive();var stores=$$props.stores;var _$$props$locale12=$$props.locale,locale=_$$props$locale12===void 0?{}:_$$props$locale12;var _$$props$resizeMinSiz=$$props.resizeMinSize,resizeMinSize=_$$props$resizeMinSiz===void 0?sizeCreate(1,1):_$$props$resizeMinSiz;var _$$props$resizeMaxSiz=$$props.resizeMaxSize,resizeMaxSize=_$$props$resizeMaxSiz===void 0?sizeCreate(9999,9999):_$$props$resizeMaxSiz;var _$$props$resizeSizePr=$$props.resizeSizePresetOptions,resizeSizePresetOptions=_$$props$resizeSizePr===void 0?undefined:_$$props$resizeSizePr;var _$$props$resizeWidthP=$$props.resizeWidthPresetOptions,resizeWidthPresetOptions=_$$props$resizeWidthP===void 0?undefined:_$$props$resizeWidthP;var _$$props$resizeHeight=$$props.resizeHeightPresetOptions,resizeHeightPresetOptions=_$$props$resizeHeight===void 0?undefined:_$$props$resizeHeight;var _$$props$resizeWillRe=$$props.resizeWillRenderFooter,resizeWillRenderFooter=_$$props$resizeWillRe===void 0?passthrough:_$$props$resizeWillRe;// offset
var iconActiveFraction=spring(0,{stiffness:0.15,damping:0.3});component_subscribe($$self,iconActiveFraction,function(value){return $$invalidate(53,$iconActiveFraction=value);});var _stores11=stores,animation=_stores11.animation,imageSize=_stores11.imageSize,imageCropRect=_stores11.imageCropRect,imageCropRectAspectRatio=_stores11.imageCropRectAspectRatio,imageCropAspectRatio=_stores11.imageCropAspectRatio,imageOutputSize=_stores11.imageOutputSize,imageSelectionZoom=_stores11.imageSelectionZoom,imageSelectionPan=_stores11.imageSelectionPan,history=_stores11.history,env=_stores11.env,allowPan=_stores11.allowPan,allowZoom=_stores11.allowZoom,allowZoomControls=_stores11.allowZoomControls;component_subscribe($$self,animation,function(value){return $$invalidate(49,$animation=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(72,$imageSize=value);});component_subscribe($$self,imageCropRect,function(value){return $$invalidate(51,$imageCropRect=value);});component_subscribe($$self,imageCropRectAspectRatio,function(value){return $$invalidate(52,$imageCropRectAspectRatio=value);});component_subscribe($$self,imageCropAspectRatio,function(value){return $$invalidate(71,$imageCropAspectRatio=value);});component_subscribe($$self,imageOutputSize,function(value){return $$invalidate(60,$imageOutputSize=value);});component_subscribe($$self,imageSelectionZoom,function(value){return $$invalidate(73,$imageSelectionZoom=value);});component_subscribe($$self,imageSelectionPan,function(value){return $$invalidate(74,$imageSelectionPan=value);});component_subscribe($$self,env,function(value){return $$invalidate(50,$env=value);});var formId=getUniqueId();var fieldsGroup;var maintainAspectRatio=false;var width;var height;var activeField;var lastActiveField;var storedImageSelectionPan=vectorCreateEmpty();var storedImageSelectionZoom;var rememberPanZoom=function rememberPanZoom(){storedImageSelectionPan=$imageSelectionPan;storedImageSelectionZoom=$imageSelectionZoom;};// zoom image preview so it scales to show the actual image output size
var updateSelectionScale=function updateSelectionScale(outputSize){// always reset to center
set_store_value(imageSelectionPan,$imageSelectionPan=vectorCreateEmpty(),$imageSelectionPan);// no resizing, zoom to actual size
if(!outputSize||!$imageCropRect){set_store_value(imageSelectionZoom,$imageSelectionZoom=1,$imageSelectionZoom);return;}// zoom image to fit image target size
set_store_value(imageSelectionZoom,$imageSelectionZoom=outputSize.width/$imageCropRect.width||outputSize.height/$imageCropRect.height,$imageSelectionZoom);};var resetSelectionScale=function resetSelectionScale(){set_store_value(imageSelectionPan,$imageSelectionPan=storedImageSelectionPan,$imageSelectionPan);set_store_value(imageSelectionZoom,$imageSelectionZoom=storedImageSelectionZoom,$imageSelectionZoom);};var getState=function getState(value,field,activeField,resizeMinSize,resizeMaxSize){return value!=null&&activeField!==field?value>=resizeMinSize[field]&&value<=resizeMaxSize[field]?'valid':'invalid':'undetermined';};var getWidthPlaceholder=function getWidthPlaceholder(value,cropAspectRatio,cropRect){return Math.round(value!=null?value*cropAspectRatio:cropRect.width);};var getHeightPlaceholder=function getHeightPlaceholder(value,cropAspectRatio,cropRect){return Math.round(value!=null?value/cropAspectRatio:cropRect.height);};// populate active field
var handleFocusIn=function handleFocusIn(e){var id=e.target.id;if(/width/.test(id)){$$invalidate(39,activeField='width');}else if(/height/.test(id)){$$invalidate(39,activeField='height');}else if(/aspectRatio/i.test(id)){$$invalidate(39,activeField='lock');}else{$$invalidate(39,activeField=undefined);}};var handleFocusOut=function handleFocusOut(e){if(!fieldsGroup.contains(e.relatedTarget))handleSubmit();$$invalidate(39,activeField=undefined);};// sync fields if one has a value and aspect ratio should be maintained
var syncFields=function syncFields(){if(!maintainAspectRatio||!width||!height)return;if(activeField==='width'){// sync height field
$$invalidate(38,height=Math.round(width/$imageCropRectAspectRatio));}else if(activeField==='height'){// sync width field
$$invalidate(37,width=Math.round(height*$imageCropRectAspectRatio));}else{if(lastActiveField==='width'){$$invalidate(38,height=Math.round(width/$imageCropRectAspectRatio));}else if(lastActiveField==='height'){$$invalidate(37,width=Math.round(height*$imageCropRectAspectRatio));}consolidateSize();}};// $: if (maintainAspectRatio && width && height) syncFields()
var consolidateSize=function consolidateSize(forcedAspectRatio){// first need to limit values
var inputWidth=formatValue(width);var inputHeight=formatValue(height);var currentWidth=inputWidth;var currentHeight=inputHeight;var bothAxisDefined=currentWidth&&currentHeight;var aspectRatio=forcedAspectRatio||$imageCropRectAspectRatio;// done, no consolidation needed
if(!currentWidth&&!currentHeight)return;// need to fill in missing values
if(currentWidth&&!currentHeight){currentHeight=Math.round(currentWidth/aspectRatio);}else if(currentHeight&&!currentWidth){currentWidth=Math.round(currentHeight*aspectRatio);}aspectRatio=forcedAspectRatio||bothAxisDefined?getAspectRatio(currentWidth,currentHeight):$imageCropRectAspectRatio;// now we have both width and height let's re-fit the min max size
var currentSize=sizeCreate(currentWidth,currentHeight);if(!sizeContains(resizeMaxSize,currentSize)){// too big
currentSize=rectContainRect(resizeMaxSize,aspectRatio);}if(!sizeContains(currentSize,resizeMinSize)){// too small
currentSize=rectCoverRect(resizeMinSize,aspectRatio);}$$invalidate(37,width=inputWidth!=null?Math.round(currentSize.width):undefined);$$invalidate(38,height=inputHeight!=null?Math.round(currentSize.height):undefined);};var handleSubmit=function handleSubmit(){// calculate correct values
consolidateSize();// get curent values so we can check if they were changed (if not, no need to write history or update)
var _ref444=$imageOutputSize||{},currentWidth=_ref444.width,currentHeight=_ref444.height;// no need to update
if(currentWidth===width&&currentHeight===height)return;// update state
if(!width&&!height){// reset image crop
set_store_value(imageCropAspectRatio,$imageCropAspectRatio=$imageSize.width/$imageSize.height,$imageCropAspectRatio);set_store_value(imageCropAspectRatio,$imageCropAspectRatio=undefined,$imageCropAspectRatio);// reset output size
set_store_value(imageOutputSize,$imageOutputSize=undefined,$imageOutputSize);}else{if(width&&height)set_store_value(imageCropAspectRatio,$imageCropAspectRatio=width/height,$imageCropAspectRatio);set_store_value(imageOutputSize,$imageOutputSize=sizeCreate(width,height),$imageOutputSize);}history.write();};// handle external updates to outputSize
var imageOutputSizeUnsub=imageOutputSize.subscribe(function(size){if(!size){$$invalidate(37,width=undefined);$$invalidate(38,height=undefined);return;}$$invalidate(37,width=size.width);$$invalidate(38,height=size.height);// make sure the size conforms to min max
consolidateSize();});// if the crop aspect ratio is changed we need to align width/height
var imageCropAspectRatioUnsub=imageCropAspectRatio.subscribe(function(cropAspectRatio){// exit if no dimensions supplied
if(!width&&!height)return;// no crop aspect ratio has been selected, so all is fine
if(!cropAspectRatio)return;// fix size to match new aspect ratio of the crop
if(width&&height&&getAspectRatio(width,height)!==cropAspectRatio){$$invalidate(38,height=width/cropAspectRatio);consolidateSize(cropAspectRatio);}else{consolidateSize();}});//
// size presets
//
var formatPresetDimensionOption=function formatPresetDimensionOption(option){if(isString(option[0])){option[1]=option[1].map(formatPresetDimensionOption);return option;}return isNumber(option)?[option,''+option]:option;};var formatPresetSizeOption=function formatPresetSizeOption(option){if(isString(option[0])){option[1]=option[1].map(formatPresetSizeOption);return option;}var _option=_slicedToArray(option,2),value=_option[0],label=_option[1];// Size only
if(isNumber(value)&&isNumber(label)){var w=value,_h6=label;label="".concat(w," &times; ").concat(_h6);value=[w,_h6];}return[value,label];};var formattedResizeSizePresetOptions=writable();component_subscribe($$self,formattedResizeSizePresetOptions,function(value){return $$invalidate(59,$formattedResizeSizePresetOptions=value);});var formattedResizeSizePresetOptionsFlattened=writable();component_subscribe($$self,formattedResizeSizePresetOptionsFlattened,function(value){return $$invalidate(63,$formattedResizeSizePresetOptionsFlattened=value);});var formattedResizeWidthPresetOptions=writable();component_subscribe($$self,formattedResizeWidthPresetOptions,function(value){return $$invalidate(57,$formattedResizeWidthPresetOptions=value);});var formattedResizeWidthPresetOptionsFlattened=writable();component_subscribe($$self,formattedResizeWidthPresetOptionsFlattened,function(value){return $$invalidate(62,$formattedResizeWidthPresetOptionsFlattened=value);});var formattedResizeHeightPresetOptions=writable();component_subscribe($$self,formattedResizeHeightPresetOptions,function(value){return $$invalidate(55,$formattedResizeHeightPresetOptions=value);});var formattedResizeHeightPresetOptionsFlattened=writable();component_subscribe($$self,formattedResizeHeightPresetOptionsFlattened,function(value){return $$invalidate(61,$formattedResizeHeightPresetOptionsFlattened=value);});var sizePresetSelectedIndex=derived([imageOutputSize,formattedResizeSizePresetOptionsFlattened],function(_ref445,set){var _ref446=_slicedToArray(_ref445,2),$imageOutputSize=_ref446[0],$formattedResizeSizePresetOptionsFlattened=_ref446[1];if(!$formattedResizeSizePresetOptionsFlattened)return set(-1);var index=$formattedResizeSizePresetOptionsFlattened.findIndex(function(_ref447){var _ref448=_slicedToArray(_ref447,1),value=_ref448[0];if(!value&&!$imageOutputSize)return true;if(!value)return false;var _value3=_slicedToArray(value,2),width=_value3[0],height=_value3[1];return $imageOutputSize.width===width&&$imageOutputSize.height===height;});set(index<0?0:index);});component_subscribe($$self,sizePresetSelectedIndex,function(value){return $$invalidate(58,$sizePresetSelectedIndex=value);});var widthPresetSelectedIndex=derived([imageOutputSize,formattedResizeWidthPresetOptionsFlattened],function(_ref449,set){var _ref450=_slicedToArray(_ref449,2),$imageOutputSize=_ref450[0],$formattedResizeWidthPresetOptionsFlattened=_ref450[1];if(!$formattedResizeWidthPresetOptionsFlattened)return set(-1);var index=$formattedResizeWidthPresetOptionsFlattened.findIndex(function(_ref451){var _ref452=_slicedToArray(_ref451,1),value=_ref452[0];if(!value&&!$imageOutputSize)return true;if(!value)return false;return $imageOutputSize.width===value;});set(index<0?0:index);});component_subscribe($$self,widthPresetSelectedIndex,function(value){return $$invalidate(56,$widthPresetSelectedIndex=value);});var heightPresetSelectedIndex=derived([imageOutputSize,formattedResizeHeightPresetOptionsFlattened],function(_ref453,set){var _ref454=_slicedToArray(_ref453,2),$imageOutputSize=_ref454[0],$formattedResizeHeightPresetOptionsFlattened=_ref454[1];if(!$formattedResizeHeightPresetOptionsFlattened)return set(-1);var index=$formattedResizeHeightPresetOptionsFlattened.findIndex(function(_ref455){var _ref456=_slicedToArray(_ref455,1),value=_ref456[0];if(!value&&!$imageOutputSize)return true;if(!value)return false;return $imageOutputSize.height===value;});set(index<0?0:index);});component_subscribe($$self,heightPresetSelectedIndex,function(value){return $$invalidate(54,$heightPresetSelectedIndex=value);});var storedCropRect=undefined;var storedCropAspectRatio=undefined;var setImageOutputSizeWithArray=function setImageOutputSizeWithArray(size){if(size&&!storedCropRect){storedCropRect=_objectSpread({},$imageCropRect);storedCropAspectRatio=$imageCropAspectRatio;}if(!size){set_store_value(imageCropRect,$imageCropRect=storedCropRect,$imageCropRect);set_store_value(imageCropAspectRatio,$imageCropAspectRatio=storedCropAspectRatio,$imageCropAspectRatio);set_store_value(imageOutputSize,$imageOutputSize=undefined,$imageOutputSize);storedCropRect=undefined;storedCropAspectRatio=undefined;}else{set_store_value(imageCropAspectRatio,$imageCropAspectRatio=getAspectRatio(size[0],size[1]),$imageCropAspectRatio);set_store_value(imageOutputSize,$imageOutputSize=sizeCreateFromArray(size),$imageOutputSize);}history.write();};//
// toolbar
//
var redrawTrigger=getContext('redrawTrigger');//
// Footer
//
var footerOffset=spring($animation?20:0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(47,$footerOffset=value);});//
// Clean up
//
onDestroy(function(){imageOutputSizeUnsub();imageCropAspectRatioUnsub();});function div0_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){fieldsGroup=$$value;$$invalidate(2,fieldsGroup);});}function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('isActive'in $$props)$$subscribe_isActive($$invalidate(0,isActive=$$props.isActive));if('stores'in $$props)$$invalidate(29,stores=$$props.stores);if('locale'in $$props)$$invalidate(1,locale=$$props.locale);if('resizeMinSize'in $$props)$$invalidate(30,resizeMinSize=$$props.resizeMinSize);if('resizeMaxSize'in $$props)$$invalidate(31,resizeMaxSize=$$props.resizeMaxSize);if('resizeSizePresetOptions'in $$props)$$invalidate(32,resizeSizePresetOptions=$$props.resizeSizePresetOptions);if('resizeWidthPresetOptions'in $$props)$$invalidate(33,resizeWidthPresetOptions=$$props.resizeWidthPresetOptions);if('resizeHeightPresetOptions'in $$props)$$invalidate(34,resizeHeightPresetOptions=$$props.resizeHeightPresetOptions);if('resizeWillRenderFooter'in $$props)$$invalidate(35,resizeWillRenderFooter=$$props.resizeWillRenderFooter);};$$self.$$.update=function(){if($$self.$$.dirty[1]&/*$isActive*/131072){// fully disable pan and zoom when resize tool is active
allowPan.set(!$isActive);}if($$self.$$.dirty[1]&/*$isActive*/131072){allowZoom.set(!$isActive);}if($$self.$$.dirty[1]&/*$isActive*/131072){allowZoomControls.set(!$isActive);}if($$self.$$.dirty[1]&/*resizeSizePresetOptions, $formattedResizeSizePresetOptions*/268435458){if(resizeSizePresetOptions){set_store_value(formattedResizeSizePresetOptions,$formattedResizeSizePresetOptions=resizeSizePresetOptions.map(formatPresetSizeOption),$formattedResizeSizePresetOptions);set_store_value(formattedResizeSizePresetOptionsFlattened,$formattedResizeSizePresetOptionsFlattened=flattenOptions($formattedResizeSizePresetOptions),$formattedResizeSizePresetOptionsFlattened);}}if($$self.$$.dirty[1]&/*$formattedResizeSizePresetOptions*/268435456){//
// helper bools
//
$$invalidate(46,canRenderSizePresets=!!$formattedResizeSizePresetOptions);}if($$self.$$.dirty[1]&/*$sizePresetSelectedIndex*/134217728|$$self.$$.dirty[2]&/*$formattedResizeSizePresetOptionsFlattened*/2){$$invalidate(45,sizePresetLabel=$sizePresetSelectedIndex>-1&&$formattedResizeSizePresetOptionsFlattened[$sizePresetSelectedIndex][1]);}if($$self.$$.dirty[1]&/*resizeWidthPresetOptions, $formattedResizeWidthPresetOptions*/67108868){if(resizeWidthPresetOptions){set_store_value(formattedResizeWidthPresetOptions,$formattedResizeWidthPresetOptions=resizeWidthPresetOptions.map(formatPresetDimensionOption),$formattedResizeWidthPresetOptions);set_store_value(formattedResizeWidthPresetOptionsFlattened,$formattedResizeWidthPresetOptionsFlattened=flattenOptions($formattedResizeWidthPresetOptions),$formattedResizeWidthPresetOptionsFlattened);}}if($$self.$$.dirty[1]&/*canRenderSizePresets, $formattedResizeWidthPresetOptions*/67141632){$$invalidate(43,canRenderWidthPresets=!canRenderSizePresets&&$formattedResizeWidthPresetOptions);}if($$self.$$.dirty[1]&/*$widthPresetSelectedIndex*/33554432|$$self.$$.dirty[2]&/*$formattedResizeWidthPresetOptionsFlattened*/1){$$invalidate(44,widthPresetLabel=$widthPresetSelectedIndex>-1&&$formattedResizeWidthPresetOptionsFlattened[$widthPresetSelectedIndex][1]);}if($$self.$$.dirty[1]&/*resizeHeightPresetOptions, $formattedResizeHeightPresetOptions*/16777224){if(resizeHeightPresetOptions){set_store_value(formattedResizeHeightPresetOptions,$formattedResizeHeightPresetOptions=resizeHeightPresetOptions.map(formatPresetDimensionOption),$formattedResizeHeightPresetOptions);set_store_value(formattedResizeHeightPresetOptionsFlattened,$formattedResizeHeightPresetOptionsFlattened=flattenOptions($formattedResizeHeightPresetOptions),$formattedResizeHeightPresetOptionsFlattened);}}if($$self.$$.dirty[1]&/*canRenderSizePresets, $formattedResizeHeightPresetOptions*/16809984){$$invalidate(42,canRenderHeightPresets=!canRenderSizePresets&&$formattedResizeHeightPresetOptions);}if($$self.$$.dirty[1]&/*$heightPresetSelectedIndex, $formattedResizeHeightPresetOptionsFlattened*/1082130432){$$invalidate(41,heightPresetLabel=$heightPresetSelectedIndex>-1&&$formattedResizeHeightPresetOptionsFlattened[$heightPresetSelectedIndex][1]);}if($$self.$$.dirty[1]&/*canRenderSizePresets, canRenderWidthPresets, canRenderHeightPresets*/38912){$$invalidate(40,canRenderSizeInputs=!canRenderSizePresets&&!canRenderWidthPresets&&!canRenderHeightPresets);}if($$self.$$.dirty[0]&/*locale, resizeMinSize*/1073741826|$$self.$$.dirty[1]&/*resizeWillRenderFooter, canRenderSizePresets, sizePresetLabel, $formattedResizeSizePresetOptions, $sizePresetSelectedIndex, canRenderWidthPresets, widthPresetLabel, $formattedResizeWidthPresetOptions, $widthPresetSelectedIndex, canRenderHeightPresets, heightPresetLabel, $formattedResizeHeightPresetOptions, $heightPresetSelectedIndex, canRenderSizeInputs, height, $imageCropRectAspectRatio, $imageCropRect, width, activeField, resizeMaxSize, maintainAspectRatio, $iconActiveFraction, $env*/536412145){$$invalidate(4,tools=redrawTrigger&&runSafe(function(){return resizeWillRenderFooter([canRenderSizePresets&&['Dropdown','size-presets',{label:sizePresetLabel,options:$formattedResizeSizePresetOptions,onchange:function onchange(item){return setImageOutputSizeWithArray(item.value);},selectedIndex:$sizePresetSelectedIndex}],canRenderWidthPresets&&['Dropdown','width-presets',{label:widthPresetLabel,options:$formattedResizeWidthPresetOptions,onchange:function onchange(item){$$invalidate(37,width=item.value);handleSubmit();},selectedIndex:$widthPresetSelectedIndex}],canRenderWidthPresets&&canRenderHeightPresets&&['span','times',{"class":'PinturaResizeLabel',innerHTML:'&times;'}],canRenderHeightPresets&&['Dropdown','height-presets',{label:heightPresetLabel,options:$formattedResizeHeightPresetOptions,onchange:function onchange(item){$$invalidate(38,height=item.value);handleSubmit();},selectedIndex:$heightPresetSelectedIndex}],canRenderSizeInputs&&[DimensionInput,'width-input',{id:"width-".concat(formId),title:locale.resizeTitleInputWidth,label:locale.resizeLabelInputWidth,placeholder:getWidthPlaceholder(formatValue(height),$imageCropRectAspectRatio,$imageCropRect),value:width,state:getState(formatValue(width),'width',activeField,resizeMinSize,resizeMaxSize),onchange:function onchange(value){$$invalidate(37,width=value);syncFields();}}],canRenderSizeInputs&&[DimensionLock,'aspect-ratio-lock',{id:"aspect-ratio-lock-".concat(formId),title:locale.resizeTitleButtonMaintainAspectRatio,icon:isString(locale.resizeIconButtonMaintainAspectRatio)?locale.resizeIconButtonMaintainAspectRatio:locale.resizeIconButtonMaintainAspectRatio(maintainAspectRatio,$iconActiveFraction),locked:maintainAspectRatio,onchange:function onchange(locked){$$invalidate(36,maintainAspectRatio=locked);syncFields();}}],canRenderSizeInputs&&[DimensionInput,'height-input',{id:"height-".concat(formId),title:locale.resizeTitleInputHeight,label:locale.resizeLabelInputHeight,placeholder:getHeightPlaceholder(formatValue(width),$imageCropRectAspectRatio,$imageCropRect),value:height,state:getState(formatValue(height),'height',activeField,resizeMinSize,resizeMaxSize),onchange:function onchange(value){$$invalidate(38,height=value);syncFields();}}]].filter(Boolean),_objectSpread({},$env),function(){return redrawTrigger.set({});});}).filter(Boolean));}if($$self.$$.dirty[1]&/*maintainAspectRatio*/32){iconActiveFraction.set(maintainAspectRatio?1:0);}if($$self.$$.dirty[1]&/*activeField*/256){if(activeField)lastActiveField=activeField;}if($$self.$$.dirty[1]&/*$isActive*/131072){if($isActive)rememberPanZoom();}if($$self.$$.dirty[1]&/*$isActive, $imageOutputSize*/537001984){$isActive?updateSelectionScale($imageOutputSize):resetSelectionScale();}if($$self.$$.dirty[1]&/*$animation, $isActive*/393216){$animation&&footerOffset.set($isActive?0:20);}if($$self.$$.dirty[1]&/*$footerOffset*/65536){$$invalidate(3,footerStyle=$footerOffset?"transform: translateY(".concat($footerOffset,"px)"):undefined);}};return[isActive,locale,fieldsGroup,footerStyle,tools,iconActiveFraction,animation,imageSize,imageCropRect,imageCropRectAspectRatio,imageCropAspectRatio,imageOutputSize,imageSelectionZoom,imageSelectionPan,env,handleFocusIn,handleFocusOut,handleSubmit,formattedResizeSizePresetOptions,formattedResizeSizePresetOptionsFlattened,formattedResizeWidthPresetOptions,formattedResizeWidthPresetOptionsFlattened,formattedResizeHeightPresetOptions,formattedResizeHeightPresetOptionsFlattened,sizePresetSelectedIndex,widthPresetSelectedIndex,heightPresetSelectedIndex,footerOffset,name,stores,resizeMinSize,resizeMaxSize,resizeSizePresetOptions,resizeWidthPresetOptions,resizeHeightPresetOptions,resizeWillRenderFooter,maintainAspectRatio,width,height,activeField,canRenderSizeInputs,heightPresetLabel,canRenderHeightPresets,canRenderWidthPresets,widthPresetLabel,sizePresetLabel,canRenderSizePresets,$footerOffset,$isActive,$animation,$env,$imageCropRect,$imageCropRectAspectRatio,$iconActiveFraction,$heightPresetSelectedIndex,$formattedResizeHeightPresetOptions,$widthPresetSelectedIndex,$formattedResizeWidthPresetOptions,$sizePresetSelectedIndex,$formattedResizeSizePresetOptions,$imageOutputSize,$formattedResizeHeightPresetOptionsFlattened,$formattedResizeWidthPresetOptionsFlattened,$formattedResizeSizePresetOptionsFlattened,div0_binding,measure_handler];}var Resize=/*#__PURE__*/function(_SvelteComponent51){_inherits(Resize,_SvelteComponent51);var _super52=_createSuper(Resize);function Resize(options){var _this53;_classCallCheck(this,Resize);_this53=_super52.call(this);init(_assertThisInitialized(_this53),options,instance$3,create_fragment$3,safe_not_equal,{name:28,isActive:0,stores:29,locale:1,resizeMinSize:30,resizeMaxSize:31,resizeSizePresetOptions:32,resizeWidthPresetOptions:33,resizeHeightPresetOptions:34,resizeWillRenderFooter:35},null,[-1,-1,-1,-1]);return _this53;}_createClass(Resize,[{key:"name",get:function get(){return this.$$.ctx[28];}},{key:"isActive",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"stores",get:function get(){return this.$$.ctx[29];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"locale",get:function get(){return this.$$.ctx[1];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"resizeMinSize",get:function get(){return this.$$.ctx[30];},set:function set(resizeMinSize){this.$$set({resizeMinSize:resizeMinSize});flush();}},{key:"resizeMaxSize",get:function get(){return this.$$.ctx[31];},set:function set(resizeMaxSize){this.$$set({resizeMaxSize:resizeMaxSize});flush();}},{key:"resizeSizePresetOptions",get:function get(){return this.$$.ctx[32];},set:function set(resizeSizePresetOptions){this.$$set({resizeSizePresetOptions:resizeSizePresetOptions});flush();}},{key:"resizeWidthPresetOptions",get:function get(){return this.$$.ctx[33];},set:function set(resizeWidthPresetOptions){this.$$set({resizeWidthPresetOptions:resizeWidthPresetOptions});flush();}},{key:"resizeHeightPresetOptions",get:function get(){return this.$$.ctx[34];},set:function set(resizeHeightPresetOptions){this.$$set({resizeHeightPresetOptions:resizeHeightPresetOptions});flush();}},{key:"resizeWillRenderFooter",get:function get(){return this.$$.ctx[35];},set:function set(resizeWillRenderFooter){this.$$set({resizeWillRenderFooter:resizeWillRenderFooter});flush();}}]);return Resize;}(SvelteComponent);// @ts-ignore
var _plugin_resize={util:['resize',Resize,function(_ref457){var duration=_ref457.duration;return!duration;}]};/* src/core/ui/plugins/redact/index.svelte generated by Svelte v3.52.0 */function create_fragment$2(ctx){var shapeutil;var current;shapeutil=new ShapeUtil({props:{stores:/*stores*/ctx[3],locale:/*locale*/ctx[4],isActive:/*isActive*/ctx[0],isActiveFraction:/*isActiveFraction*/ctx[1],isVisible:/*isVisible*/ctx[2],mapScreenPointToImagePoint:/*mapScreenPointToImagePoint*/ctx[9],mapImagePointToScreenPoint:/*mapImagePointToScreenPoint*/ctx[8],utilKey:'redact',imageRotation:/*$imageRotation*/ctx[10],imageFlipX:/*$imageFlipX*/ctx[7],imageFlipY:/*$imageFlipY*/ctx[6],shapes:/*imageRedaction*/ctx[11],toolbar:['rect'],toolShapes:{rectangle:[{x:0,y:0,width:0,height:0}]},toolActive:'rectangle',parentRect:/*imageSize*/ctx[13],enablePresetDropImage:false,enablePresetSelectImage:false,willStartInteraction:/*markupEditorWillStartInteraction*/ctx[5],hooks:{willRenderShapeControls:/*func*/ctx[24]}}});shapeutil.$on("measure",/*measure_handler*/ctx[25]);return{c:function c(){create_component(shapeutil.$$.fragment);},m:function m(target,anchor){mount_component(shapeutil,target,anchor);current=true;},p:function p(ctx,_ref458){var _ref459=_slicedToArray(_ref458,1),dirty=_ref459[0];var shapeutil_changes={};if(dirty&/*stores*/8)shapeutil_changes.stores=/*stores*/ctx[3];if(dirty&/*locale*/16)shapeutil_changes.locale=/*locale*/ctx[4];if(dirty&/*isActive*/1)shapeutil_changes.isActive=/*isActive*/ctx[0];if(dirty&/*isActiveFraction*/2)shapeutil_changes.isActiveFraction=/*isActiveFraction*/ctx[1];if(dirty&/*isVisible*/4)shapeutil_changes.isVisible=/*isVisible*/ctx[2];if(dirty&/*mapScreenPointToImagePoint*/512)shapeutil_changes.mapScreenPointToImagePoint=/*mapScreenPointToImagePoint*/ctx[9];if(dirty&/*mapImagePointToScreenPoint*/256)shapeutil_changes.mapImagePointToScreenPoint=/*mapImagePointToScreenPoint*/ctx[8];if(dirty&/*$imageRotation*/1024)shapeutil_changes.imageRotation=/*$imageRotation*/ctx[10];if(dirty&/*$imageFlipX*/128)shapeutil_changes.imageFlipX=/*$imageFlipX*/ctx[7];if(dirty&/*$imageFlipY*/64)shapeutil_changes.imageFlipY=/*$imageFlipY*/ctx[6];if(dirty&/*markupEditorWillStartInteraction*/32)shapeutil_changes.willStartInteraction=/*markupEditorWillStartInteraction*/ctx[5];shapeutil.$set(shapeutil_changes);},i:function i(local){if(current)return;transition_in(shapeutil.$$.fragment,local);current=true;},o:function o(local){transition_out(shapeutil.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(shapeutil,detaching);}};}function instance$2($$self,$$props,$$invalidate){var mapScreenPointToImagePoint;var mapImagePointToScreenPoint;var $imageFlipY;var $imageFlipX;var $imageTransformsInterpolated;var $imageTransforms;var $imageSize;var $rootRect;var $imageRotation;var name='redact';var isActive=$$props.isActive;var isActiveFraction=$$props.isActiveFraction;var isVisible=$$props.isVisible;var stores=$$props.stores;var _$$props$locale13=$$props.locale,locale=_$$props$locale13===void 0?{}:_$$props$locale13;var _$$props$markupEditor24=$$props.markupEditorWillStartInteraction,markupEditorWillStartInteraction=_$$props$markupEditor24===void 0?undefined:_$$props$markupEditor24;// connect filter choice to stores
var _stores12=stores,imageRedaction=_stores12.imageRedaction,rootRect=_stores12.rootRect,imageSize=_stores12.imageSize,imageRotation=_stores12.imageRotation,imageFlipX=_stores12.imageFlipX,imageFlipY=_stores12.imageFlipY,imageTransforms=_stores12.imageTransforms,imageTransformsInterpolated=_stores12.imageTransformsInterpolated;component_subscribe($$self,rootRect,function(value){return $$invalidate(23,$rootRect=value);});component_subscribe($$self,imageSize,function(value){return $$invalidate(22,$imageSize=value);});component_subscribe($$self,imageRotation,function(value){return $$invalidate(10,$imageRotation=value);});component_subscribe($$self,imageFlipX,function(value){return $$invalidate(7,$imageFlipX=value);});component_subscribe($$self,imageFlipY,function(value){return $$invalidate(6,$imageFlipY=value);});component_subscribe($$self,imageTransforms,function(value){return $$invalidate(21,$imageTransforms=value);});component_subscribe($$self,imageTransformsInterpolated,function(value){return $$invalidate(20,$imageTransformsInterpolated=value);});var func=function func(controls){var children=getNodeChildren(controls[0]);removeNode('to-front',children);return controls;};function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('isActive'in $$props)$$invalidate(0,isActive=$$props.isActive);if('isActiveFraction'in $$props)$$invalidate(1,isActiveFraction=$$props.isActiveFraction);if('isVisible'in $$props)$$invalidate(2,isVisible=$$props.isVisible);if('stores'in $$props)$$invalidate(3,stores=$$props.stores);if('locale'in $$props)$$invalidate(4,locale=$$props.locale);if('markupEditorWillStartInteraction'in $$props)$$invalidate(5,markupEditorWillStartInteraction=$$props.markupEditorWillStartInteraction);};$$self.$$.update=function(){if($$self.$$.dirty&/*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, $imageFlipX, $imageFlipY*/15728832){//
// Mapping coordinates
//
$$invalidate(9,mapScreenPointToImagePoint=function mapScreenPointToImagePoint(point){return _mapScreenPointToImagePoint(point,$rootRect,$imageSize,$imageTransformsInterpolated.origin,$imageTransformsInterpolated.translation,$imageTransforms.rotation.z,$imageTransformsInterpolated.scale,$imageFlipX,$imageFlipY);});}if($$self.$$.dirty&/*$rootRect, $imageSize, $imageTransformsInterpolated, $imageTransforms, $imageFlipX, $imageFlipY*/15728832){$$invalidate(8,mapImagePointToScreenPoint=function mapImagePointToScreenPoint(point){return _mapImagePointToScreenPoint(point,$rootRect,$imageSize,$imageTransformsInterpolated.origin,$imageTransformsInterpolated.translation,$imageTransforms.rotation.z,$imageTransformsInterpolated.scale,$imageFlipX,$imageFlipY);});}};return[isActive,isActiveFraction,isVisible,stores,locale,markupEditorWillStartInteraction,$imageFlipY,$imageFlipX,mapImagePointToScreenPoint,mapScreenPointToImagePoint,$imageRotation,imageRedaction,rootRect,imageSize,imageRotation,imageFlipX,imageFlipY,imageTransforms,imageTransformsInterpolated,name,$imageTransformsInterpolated,$imageTransforms,$imageSize,$rootRect,func,measure_handler];}var Redact=/*#__PURE__*/function(_SvelteComponent52){_inherits(Redact,_SvelteComponent52);var _super53=_createSuper(Redact);function Redact(options){var _this54;_classCallCheck(this,Redact);_this54=_super53.call(this);init(_assertThisInitialized(_this54),options,instance$2,create_fragment$2,safe_not_equal,{name:19,isActive:0,isActiveFraction:1,isVisible:2,stores:3,locale:4,markupEditorWillStartInteraction:5});return _this54;}_createClass(Redact,[{key:"name",get:function get(){return this.$$.ctx[19];}},{key:"isActive",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"isActiveFraction",get:function get(){return this.$$.ctx[1];},set:function set(isActiveFraction){this.$$set({isActiveFraction:isActiveFraction});flush();}},{key:"isVisible",get:function get(){return this.$$.ctx[2];},set:function set(isVisible){this.$$set({isVisible:isVisible});flush();}},{key:"stores",get:function get(){return this.$$.ctx[3];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"locale",get:function get(){return this.$$.ctx[4];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"markupEditorWillStartInteraction",get:function get(){return this.$$.ctx[5];},set:function set(markupEditorWillStartInteraction){this.$$set({markupEditorWillStartInteraction:markupEditorWillStartInteraction});flush();}}]);return Redact;}(SvelteComponent);// @ts-ignore
var _plugin_redact={util:['redact',Redact,function(_ref460){var duration=_ref460.duration;return!duration;}]};/* src/core/ui/plugins/fill/index.svelte generated by Svelte v3.52.0 */function create_if_block(ctx){var span;var t_value=(isFunction(/*option*/ctx[31].label)?/*option*/ctx[31].label(/*locale*/ctx[1]):/*option*/ctx[31].label)+"";var t;return{c:function c(){span=element("span");t=text(t_value);},m:function m(target,anchor){insert(target,span,anchor);append(span,t);},p:function p(ctx,dirty){if(dirty[0]&/*locale*/2|dirty[1]&/*option*/1&&t_value!==(t_value=(isFunction(/*option*/ctx[31].label)?/*option*/ctx[31].label(/*locale*/ctx[1]):/*option*/ctx[31].label)+""))set_data(t,t_value);},d:function d(detaching){if(detaching)detach(span);}};}// (135:16) 
function create_option_slot(ctx){var div;var html_tag;var raw_value=(/*getOptionThumb*/ctx[11](/*option*/ctx[31].value)||'')+"";var t;var if_block=/*option*/ctx[31].label&&create_if_block(ctx);return{c:function c(){div=element("div");html_tag=new HtmlTag(false);t=space();if(if_block)if_block.c();html_tag.a=t;attr(div,"slot","option");},m:function m(target,anchor){insert(target,div,anchor);html_tag.m(raw_value,div);append(div,t);if(if_block)if_block.m(div,null);},p:function p(ctx,dirty){if(dirty[1]&/*option*/1&&raw_value!==(raw_value=(/*getOptionThumb*/ctx[11](/*option*/ctx[31].value)||'')+""))html_tag.p(raw_value);if(/*option*/ctx[31].label){if(if_block){if_block.p(ctx,dirty);}else{if_block=create_if_block(ctx);if_block.c();if_block.m(div,null);}}else if(if_block){if_block.d(1);if_block=null;}},d:function d(detaching){if(detaching)detach(div);if(if_block)if_block.d();}};}// (125:8) <Scrollable elasticity={computedScrollElasticity}>
function create_default_slot(ctx){var radiogroup;var current;radiogroup=new RadioGroup({props:{locale:/*locale*/ctx[1],"class":"PinturaControlList",layout:"row",options:/*fillOptionsMapped*/ctx[2],selectedIndex:/*selectedFillIndex*/ctx[4],onchange:/*handleChangeFill*/ctx[10],$$slots:{option:[create_option_slot,function(_ref461){var option=_ref461.option;return{31:option};},function(_ref462){var option=_ref462.option;return[0,option?1:0];}]},$$scope:{ctx:ctx}}});return{c:function c(){create_component(radiogroup.$$.fragment);},m:function m(target,anchor){mount_component(radiogroup,target,anchor);current=true;},p:function p(ctx,dirty){var radiogroup_changes={};if(dirty[0]&/*locale*/2)radiogroup_changes.locale=/*locale*/ctx[1];if(dirty[0]&/*fillOptionsMapped*/4)radiogroup_changes.options=/*fillOptionsMapped*/ctx[2];if(dirty[0]&/*selectedFillIndex*/16)radiogroup_changes.selectedIndex=/*selectedFillIndex*/ctx[4];if(dirty[0]&/*locale*/2|dirty[1]&/*$$scope, option*/3){radiogroup_changes.$$scope={dirty:dirty,ctx:ctx};}radiogroup.$set(radiogroup_changes);},i:function i(local){if(current)return;transition_in(radiogroup.$$.fragment,local);current=true;},o:function o(local){transition_out(radiogroup.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(radiogroup,detaching);}};}// (124:4) 
function create_footer_slot(ctx){var div;var scrollable;var current;scrollable=new Scrollable({props:{elasticity:/*computedScrollElasticity*/ctx[5],$$slots:{"default":[create_default_slot]},$$scope:{ctx:ctx}}});return{c:function c(){div=element("div");create_component(scrollable.$$.fragment);attr(div,"slot","footer");attr(div,"style",/*footerStyle*/ctx[3]);},m:function m(target,anchor){insert(target,div,anchor);mount_component(scrollable,div,null);current=true;},p:function p(ctx,dirty){var scrollable_changes={};if(dirty[0]&/*computedScrollElasticity*/32)scrollable_changes.elasticity=/*computedScrollElasticity*/ctx[5];if(dirty[0]&/*locale, fillOptionsMapped, selectedFillIndex*/22|dirty[1]&/*$$scope*/2){scrollable_changes.$$scope={dirty:dirty,ctx:ctx};}scrollable.$set(scrollable_changes);if(!current||dirty[0]&/*footerStyle*/8){attr(div,"style",/*footerStyle*/ctx[3]);}},i:function i(local){if(current)return;transition_in(scrollable.$$.fragment,local);current=true;},o:function o(local){transition_out(scrollable.$$.fragment,local);current=false;},d:function d(detaching){if(detaching)detach(div);destroy_component(scrollable);}};}function create_fragment$1(ctx){var util;var current;util=new Util({props:{$$slots:{footer:[create_footer_slot]},$$scope:{ctx:ctx}}});util.$on("measure",/*measure_handler*/ctx[22]);return{c:function c(){create_component(util.$$.fragment);},m:function m(target,anchor){mount_component(util,target,anchor);current=true;},p:function p(ctx,dirty){var util_changes={};if(dirty[0]&/*footerStyle, computedScrollElasticity, locale, fillOptionsMapped, selectedFillIndex*/62|dirty[1]&/*$$scope*/2){util_changes.$$scope={dirty:dirty,ctx:ctx};}util.$set(util_changes);},i:function i(local){if(current)return;transition_in(util.$$.fragment,local);current=true;},o:function o(local){transition_out(util.$$.fragment,local);current=false;},d:function d(detaching){destroy_component(util,detaching);}};}function instance$1($$self,$$props,$$invalidate){var fillOptionsMapped;var computedScrollElasticity;var selectedFillIndex;var footerStyle;var $footerOffset;var $isActive,$$unsubscribe_isActive=noop,$$subscribe_isActive=function $$subscribe_isActive(){return $$unsubscribe_isActive(),$$unsubscribe_isActive=subscribe(isActive,function($$value){return $$invalidate(17,$isActive=$$value);}),isActive;};var $animation;var $imageBackgroundImage;var $imageBackgroundColor;var $elasticityMultiplier;$$self.$$.on_destroy.push(function(){return $$unsubscribe_isActive();});var name='fill';var isActive=$$props.isActive;$$subscribe_isActive();var stores=$$props.stores;var _$$props$locale14=$$props.locale,locale=_$$props$locale14===void 0?{}:_$$props$locale14;var _$$props$fillOptions=$$props.fillOptions,fillOptions=_$$props$fillOptions===void 0?[]:_$$props$fillOptions;var isItemGroup=function isItemGroup(item){return isArray(item)&&isString(item[0])&&isArray(item[1]);};var mapItem=function mapItem(item){return[// to rgba color
Array.isArray(item)&&item.length===3?[].concat(_toConsumableArray(item),[1]):item,undefined,{disabled:false}];};var mapItems=function mapItems(items){return items.map(function(item){if(isItemGroup(item)){return[item[0],mapItems(item[1]),item[2]];}return mapItem(item);});};//
// context
//
var elasticityMultiplier=getContext('elasticityMultiplier');component_subscribe($$self,elasticityMultiplier,function(value){return $$invalidate(21,$elasticityMultiplier=value);});// connect filter choice to stores
var _stores13=stores,history=_stores13.history,animation=_stores13.animation,scrollElasticity=_stores13.scrollElasticity,imageBackgroundColor=_stores13.imageBackgroundColor,imageBackgroundImage=_stores13.imageBackgroundImage,allowPan=_stores13.allowPan,allowZoom=_stores13.allowZoom,allowZoomControls=_stores13.allowZoomControls;component_subscribe($$self,animation,function(value){return $$invalidate(18,$animation=value);});component_subscribe($$self,imageBackgroundColor,function(value){return $$invalidate(20,$imageBackgroundColor=value);});component_subscribe($$self,imageBackgroundImage,function(value){return $$invalidate(19,$imageBackgroundImage=value);});var handleChangeFill=function handleChangeFill(_ref463){var value=_ref463.value;if(isString(value)){set_store_value(imageBackgroundColor,$imageBackgroundColor=undefined,$imageBackgroundColor);set_store_value(imageBackgroundImage,$imageBackgroundImage=value,$imageBackgroundImage);}if(isArray(value)){set_store_value(imageBackgroundColor,$imageBackgroundColor=value,$imageBackgroundColor);set_store_value(imageBackgroundImage,$imageBackgroundImage=undefined,$imageBackgroundImage);}// store
history.write();};var getOptionThumb=function getOptionThumb(value){if(isString(value)){return"<div class=\"PinturaFillTile\"><img src=\"".concat(value,"\" alt=\"\" width=\"48\" height=\"64\"/></div>");}if(isArray(value)){var _value$map=value.map(function(v,i){return i<3?Math.round(v*255):v;}),_value$map2=_slicedToArray(_value$map,4),_r12=_value$map2[0],g=_value$map2[1],b=_value$map2[2],a=_value$map2[3];return"<div class=\"PinturaFillTile\" data-transparent=\"".concat(a<1,"\"><div style=\"background-color:rgba(").concat(_r12,",").concat(g,",").concat(b,",").concat(a,")\"></div></div>");}return"<div></div>";};//
// Footer style
//
var footerOffset=spring($animation?20:0);component_subscribe($$self,footerOffset,function(value){return $$invalidate(16,$footerOffset=value);});function measure_handler(event){bubble.call(this,$$self,event);}$$self.$$set=function($$props){if('isActive'in $$props)$$subscribe_isActive($$invalidate(0,isActive=$$props.isActive));if('stores'in $$props)$$invalidate(14,stores=$$props.stores);if('locale'in $$props)$$invalidate(1,locale=$$props.locale);if('fillOptions'in $$props)$$invalidate(15,fillOptions=$$props.fillOptions);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*fillOptions*/32768){$$invalidate(2,fillOptionsMapped=mapItems(fillOptions));}if($$self.$$.dirty[0]&/*$isActive*/131072){// enable pan and zoom
allowPan.set($isActive);}if($$self.$$.dirty[0]&/*$isActive*/131072){allowZoom.set($isActive);}if($$self.$$.dirty[0]&/*$isActive*/131072){allowZoomControls.set($isActive);}if($$self.$$.dirty[0]&/*$elasticityMultiplier*/2097152){//
// scroll components
//
$$invalidate(5,computedScrollElasticity=$elasticityMultiplier*scrollElasticity);}if($$self.$$.dirty[0]&/*fillOptionsMapped, $imageBackgroundImage, $imageBackgroundColor*/1572868){// we check background image first as [0,0,0,0] is background color default value so otherwise images are never selected
$$invalidate(4,selectedFillIndex=fillOptionsMapped.findIndex(function(_ref464){var _ref465=_slicedToArray(_ref464,1),value=_ref465[0];if($imageBackgroundImage){return value===$imageBackgroundImage;}if(Array.isArray(value)){return arrayEqual(value,$imageBackgroundColor);}})||0);}if($$self.$$.dirty[0]&/*$animation, $isActive*/393216){$animation&&footerOffset.set($isActive?0:20);}if($$self.$$.dirty[0]&/*$footerOffset*/65536){$$invalidate(3,footerStyle=$footerOffset?"transform: translateY(".concat($footerOffset,"px)"):undefined);}};return[isActive,locale,fillOptionsMapped,footerStyle,selectedFillIndex,computedScrollElasticity,elasticityMultiplier,animation,imageBackgroundColor,imageBackgroundImage,handleChangeFill,getOptionThumb,footerOffset,name,stores,fillOptions,$footerOffset,$isActive,$animation,$imageBackgroundImage,$imageBackgroundColor,$elasticityMultiplier,measure_handler];}var Fill=/*#__PURE__*/function(_SvelteComponent53){_inherits(Fill,_SvelteComponent53);var _super54=_createSuper(Fill);function Fill(options){var _this55;_classCallCheck(this,Fill);_this55=_super54.call(this);init(_assertThisInitialized(_this55),options,instance$1,create_fragment$1,safe_not_equal,{name:13,isActive:0,stores:14,locale:1,fillOptions:15},null,[-1,-1]);return _this55;}_createClass(Fill,[{key:"name",get:function get(){return this.$$.ctx[13];}},{key:"isActive",get:function get(){return this.$$.ctx[0];},set:function set(isActive){this.$$set({isActive:isActive});flush();}},{key:"stores",get:function get(){return this.$$.ctx[14];},set:function set(stores){this.$$set({stores:stores});flush();}},{key:"locale",get:function get(){return this.$$.ctx[1];},set:function set(locale){this.$$set({locale:locale});flush();}},{key:"fillOptions",get:function get(){return this.$$.ctx[15];},set:function set(fillOptions){this.$$set({fillOptions:fillOptions});flush();}}]);return Fill;}(SvelteComponent);// @ts-ignore
var _plugin_fill={util:['fill',Fill,function(_ref466){var duration=_ref466.duration;return!duration;}]};var IconCross='<g fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" stroke-width=".125em"><path d="M18 6L6 18M6 6l12 12"></path></path></g>';var CharacterA='<path fill="none" d="M9 15 L12 9 L15 15 M10 13.5 h3" stroke="currentColor" stroke-width=".125em"/>';var _locale_en_gb={// generic
labelReset:'Reset',labelDefault:'Default',labelAuto:'Auto',labelNone:'None',labelEdit:'Edit',labelClose:'Close',labelSupportError:function labelSupportError(features){return"".concat(features.join(', ')," not supported on this browser");},// defaults
labelColor:'Color',labelWidth:'Width',labelSize:'Size',labelOffset:'Offset',labelAmount:'Amount',labelInset:'Inset',labelRadius:'Radius',// controls
labelColorPalette:'Color palette',// sizes
labelSizeExtraSmall:'Extra small',labelSizeSmall:'Small',labelSizeMediumSmall:'Medium small',labelSizeMedium:'Medium',labelSizeMediumLarge:'Medium large',labelSizeLarge:'Large',labelSizeExtraLarge:'Extra large',// default buttons
labelButtonCancel:'Cancel',labelButtonUndo:'Undo',labelButtonRedo:'Redo',labelButtonRevert:'Revert',labelButtonExport:'Done',// zoom
labelZoomIn:'Zoom in',labelZoomOut:'Zoom out',labelZoomFit:'Fit to view',labelZoomActual:'Actual size',iconZoomIn:'<path stroke="currentColor" stroke-width=".125em" d="M8 12 h8 M12 8 v8" />',iconZoomOut:'<path stroke="currentColor" stroke-width=".125em" d="M9 12 h6" />',// icons
iconSupportError:"<g fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\"/><g><line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\"/><line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/></g>",iconButtonClose:IconCross,iconButtonRevert:"<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M7.388 18.538a8 8 0 10-2.992-9.03\"/><path fill=\"currentColor\" d=\"M2.794 11.696L2.37 6.714l5.088 3.18z\"/><path d=\"M12 8v4M12 12l4 2\"/></g>",iconButtonUndo:"<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M10 8h4c2.485 0 5 2 5 5s-2.515 5-5 5h-4\"/><path fill=\"currentColor\" d=\"M5 8l4-3v6z\"/></g>",iconButtonRedo:"<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M14 8h-4c-2.485 0-5 2-5 5s2.515 5 5 5h4\"/><path fill=\"currentColor\" d=\"M19 8l-4-3v6z\"/></g>",iconButtonExport:"<polyline points=\"20 6 9 17 4 12\" fill=\"none\" stroke=\"currentColor\" stroke-width=\".125em\"></polyline>",// status
statusLabelButtonClose:'Close',statusIconButtonClose:IconCross,statusLabelLoadImage:function statusLabelLoadImage(state){if(!state||!state.task)return'Waiting for image';if(state.error)return state.error.code==='IMAGE_TOO_SMALL'?'Minimum image size is {minWidth} &times; {minHeight}':'Error loading image';if(state.task==='blob-to-bitmap')return'Preparing image&hellip;';return'Loading image&hellip;';},// processing status message
statusLabelProcessImage:function statusLabelProcessImage(state){if(!state||!state.task)return undefined;if(state.task==='store'){if(state.error)return'Error uploading image';return'Uploading image&hellip;';}if(state.error)return'Error processing image';return'Processing image&hellip;';}};var MarkupEditor={shapeLabelButtonSelectSticker:'Select image',shapeIconButtonSelectSticker:"<g fill=\"none\" stroke=\"currentColor\" stroke-width=\"0.0625em\"><path d=\"M8 21 L15 11 L19 15\"/><path d=\"M15 2 v5 h5\"/><path d=\"M8 2 h8 l4 4 v12 q0 4 -4 4 h-8 q-4 0 -4 -4 v-12 q0 -4 4 -4z\"/></g><circle fill=\"currentColor\" cx=\"10\" cy=\"8\" r=\"1.5\"/>",shapeIconButtonFlipHorizontal:"<g stroke=\"currentColor\" stroke-width=\".125em\"><path fill=\"none\" d=\"M6 6.5h5v11H6z\"/><path fill=\"currentColor\" d=\"M15 6.5h3v11h-3z\"/><path d=\"M11 4v16\" fill=\"currentColor\"/></g>",shapeIconButtonFlipVertical:"<g stroke=\"currentColor\" stroke-width=\".125em\"><rect x=\"7\" y=\"8\" width=\"11\" height=\"5\" fill=\"none\"/><rect x=\"7\" y=\"17\" width=\"11\" height=\"2\" fill=\"currentColor\"/><line x1=\"5\" y1=\"13\" x2=\"20\" y2=\"13\"/></g>",shapeIconButtonRemove:"<g fill=\"none\" fill-rule=\"evenodd\"><path stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M7.5 7h9z\"/><path d=\"M7.916 9h8.168a1 1 0 01.99 1.14l-.972 6.862a2 2 0 01-1.473 1.653c-.877.23-1.753.345-2.629.345-.876 0-1.752-.115-2.628-.345a2 2 0 01-1.473-1.653l-.973-6.862A1 1 0 017.916 9z\" fill=\"currentColor\"/><rect fill=\"currentColor\" x=\"10\" y=\"5\" width=\"4\" height=\"3\" rx=\"1\"/></g>",shapeIconButtonDuplicate:"<g fill=\"none\" fill-rule=\"evenodd\"><path d=\"M15 13.994V16a2 2 0 01-2 2H8a2 2 0 01-2-2v-5a2 2 0 012-2h2.142\" stroke=\"currentColor\" stroke-width=\".125em\"/><path d=\"M15 9V8a1 1 0 00-2 0v1h-1a1 1 0 000 2h1v1a1 1 0 002 0v-1h1a1 1 0 000-2h-1zm-4-4h6a2 2 0 012 2v6a2 2 0 01-2 2h-6a2 2 0 01-2-2V7a2 2 0 012-2z\" fill=\"currentColor\"/></g>",shapeIconButtonMoveToFront:"<g fill=\"none\" fill-rule=\"evenodd\"><rect fill=\"currentColor\" x=\"11\" y=\"13\" width=\"8\" height=\"2\" rx=\"1\"/><rect fill=\"currentColor\" x=\"9\" y=\"17\" width=\"10\" height=\"2\" rx=\"1\"/><path d=\"M11.364 8H10a5 5 0 000 10M12 6.5L14.5 8 12 9.5z\" stroke=\"currentColor\" stroke-width=\".125em\" stroke-linecap=\"round\"/></g>",shapeIconButtonTextLayoutAutoWidth:"".concat(CharacterA),shapeIconButtonTextLayoutAutoHeight:"<g fill=\"currentColor\"><circle cx=\"4\" cy=\"12\" r=\"1.5\"/><circle cx=\"20\" cy=\"12\" r=\"1.5\"/></g>".concat(CharacterA),shapeIconButtonTextLayoutFixedSize:"<g fill=\"currentColor\"><circle cx=\"5\" cy=\"6\" r=\"1.5\"/><circle cx=\"19\" cy=\"6\" r=\"1.5\"/><circle cx=\"19\" cy=\"19\" r=\"1.5\"/><circle cx=\"5\" cy=\"19\" r=\"1.5\"/></g>".concat(CharacterA),shapeTitleButtonTextLayoutAutoWidth:'Auto width',shapeTitleButtonTextLayoutAutoHeight:'Auto height',shapeTitleButtonTextLayoutFixedSize:'Fixed size',shapeTitleButtonFlipHorizontal:'Flip Horizontal',shapeTitleButtonFlipVertical:'Flip Vertical',shapeTitleButtonRemove:'Remove',shapeTitleButtonDuplicate:'Duplicate',shapeTitleButtonMoveToFront:'Move to front',shapeLabelInputText:'Edit text',shapeIconInputCancel:"<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M18 6L6 18M6 6l12 12\"/></g>",shapeIconInputConfirm:"<g fill=\"none\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><polyline points=\"20 6 9 17 4 12\"/></g>",shapeLabelInputCancel:'Cancel',shapeLabelInputConfirm:'Confirm',shapeLabelStrokeNone:'No outline',shapeLabelFontStyleNormal:'Normal',shapeLabelFontStyleBold:'Bold',shapeLabelFontStyleItalic:'Italic',shapeLabelFontStyleItalicBold:'Bold Italic',shapeTitleBackgroundColor:'Fill color',shapeTitleCornerRadius:'Corner radius',shapeTitleFontFamily:'Font',shapeTitleFontSize:'Font size',shapeTitleFontStyle:'Font style',shapeTitleLineHeight:'Line height',shapeTitleLineStart:'Start',shapeTitleLineEnd:'End',shapeTitleStrokeWidth:'Line width',shapeTitleStrokeColor:'Line color',shapeTitleLineDecorationBar:'Bar',shapeTitleLineDecorationCircle:'Circle',shapeTitleLineDecorationSquare:'Square',shapeTitleLineDecorationArrow:'Arrow',shapeTitleLineDecorationCircleSolid:'Circle solid',shapeTitleLineDecorationSquareSolid:'Square solid',shapeTitleLineDecorationArrowSolid:'Arrow solid',shapeIconLineDecorationBar:"<g stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\".125em\"><path d=\"M5,12 H16\"/><path d=\"M16,8 V16\"/></g>",shapeIconLineDecorationCircle:"<g stroke=\"currentColor\" stroke-linecap=\"round\"><path stroke-width=\".125em\" d=\"M5,12 H12\"/><circle fill=\"none\" stroke-width=\".125em\" cx=\"16\" cy=\"12\" r=\"4\"/></g>",shapeIconLineDecorationSquare:"<g stroke=\"currentColor\" stroke-linecap=\"round\"><path stroke-width=\".125em\" d=\"M5,12 H12\"/><rect fill=\"none\" stroke-width=\".125em\" x=\"12\" y=\"8\" width=\"8\" height=\"8\"/></g>",shapeIconLineDecorationArrow:"<g stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\".125em\"><path d=\"M5,12 H16 M13,7 l6,5 l-6,5\" fill=\"none\"/></g>",shapeIconLineDecorationCircleSolid:"<g stroke=\"currentColor\" stroke-linecap=\"round\"><path stroke-width=\".125em\" d=\"M5,12 H12\"/><circle fill=\"currentColor\" cx=\"16\" cy=\"12\" r=\"4\"/></g>",shapeIconLineDecorationSquareSolid:"<g stroke=\"currentColor\" stroke-linecap=\"round\"><path stroke-width=\".125em\" d=\"M5,12 H12\"/><rect fill=\"currentColor\" x=\"12\" y=\"8\" width=\"8\" height=\"8\"/></g>",shapeIconLineDecorationArrowSolid:"<g stroke=\"currentColor\" stroke-linecap=\"round\" stroke-width=\".125em\"><path d=\"M5,12 H16\"/><path d=\"M13,7 l6,5 l-6,5z\" fill=\"currentColor\"/></g>",shapeTitleColorTransparent:'Transparent',shapeTitleColorWhite:'White',shapeTitleColorSilver:'Silver',shapeTitleColorGray:'Gray',shapeTitleColorBlack:'Black',shapeTitleColorNavy:'Navy',shapeTitleColorBlue:'Blue',shapeTitleColorAqua:'Aqua',shapeTitleColorTeal:'Teal',shapeTitleColorOlive:'Olive',shapeTitleColorGreen:'Green',shapeTitleColorYellow:'Yellow',shapeTitleColorOrange:'Orange',shapeTitleColorRed:'Red',shapeTitleColorMaroon:'Maroon',shapeTitleColorFuchsia:'Fuchsia',shapeTitleColorPurple:'Purple',shapeTitleTextColor:'Font color',shapeTitleTextAlign:'Text align',shapeTitleTextAlignLeft:'Left align text',shapeTitleTextAlignCenter:'Center align text',shapeTitleTextAlignRight:'Right align text',shapeIconTextAlignLeft:"<g stroke-width=\".125em\" stroke=\"currentColor\"><line x1=\"5\" y1=\"8\" x2=\"15\" y2=\"8\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/><line x1=\"5\" y1=\"16\" x2=\"14\" y2=\"16\"/></g>",shapeIconTextAlignCenter:"<g stroke-width=\".125em\" stroke=\"currentColor\"><line x1=\"7\" y1=\"8\" x2=\"17\" y2=\"8\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/><line x1=\"8\" y1=\"16\" x2=\"16\" y2=\"16\"/></g>",shapeIconTextAlignRight:"<g stroke-width=\".125em\" stroke=\"currentColor\"><line x1=\"9\" y1=\"8\" x2=\"19\" y2=\"8\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/><line x1=\"11\" y1=\"16\" x2=\"19\" y2=\"16\"/></g>",shapeLabelToolMove:'Move',shapeLabelToolView:'View',shapeLabelToolSharpie:'Sharpie',shapeLabelToolEraser:'Eraser',shapeLabelToolPath:'Path',shapeLabelToolRectangle:'Rectangle',shapeLabelToolEllipse:'Ellipse',shapeLabelToolArrow:'Arrow',shapeLabelToolLine:'Line',shapeLabelToolText:'Text',shapeLabelToolPreset:'Stickers',shapeIconToolView:"<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M10.98 9.703V2.567c0-1.19 1.19-1.785 1.784-1.785.595 0 1.784.595 1.784 1.785v3.568\"/><path d=\"M14.548 9.703V4.35c0-1.19 1.19-1.784 1.784-1.784.595 0 1.784.594 1.784 1.784v2.973\"/><path d=\"M18.116 10.244V7.271c0-1.19 1.19-1.784 1.784-1.784.595 0 1.785.595 1.785 1.784 0 1.19 0 8.92-1.19 12.488-1.19 3.569-10.704 4.758-13.678 0-2.973-4.757-2.973-4.757-4.163-6.541-1.189-1.784-1.153-2.974-.594-3.568.558-.595 1.784-1.19 2.973.594 1.277 1.916 2.07 2.907 2.379 2.974V5.487c0-1.19 1.19-1.784 1.784-1.784.595 0 1.784.595 1.784 1.784V8.46\"/></g>",shapeIconToolMove:"<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M6 2 L6 19 L18 13 Z M13 18 L16 24\" stroke=\"currentColor\" stroke-width=\".125em\" fill=\"none\" fill-rule=\"evenodd\" stroke-linejoin=\"round\"/></g>",shapeIconToolSharpie:"<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><path d=\"M2.025 5c5.616-2.732 8.833-3.857 9.65-3.374C12.903 2.351.518 12.666 2.026 14 3.534 15.334 16.536.566 17.73 2.566 18.924 4.566 3.98 17.187 4.831 18c.851.813 9.848-6 11.643-6 1.087 0-2.53 5.11-2.92 7-.086.41 3.323-1.498 4.773-1 .494.17.64 2.317 1.319 3 .439.443 1.332.776 2.679 1\" stroke=\"currentColor\" stroke-width=\".125em\" fill=\"none\" fill-rule=\"evenodd\" stroke-linejoin=\"round\"/></g>",shapeIconToolEraser:"<g stroke-width=\".125em\" stroke=\"currentColor\" stroke-linecap=\"round\" fill=\"none\"><g transform=\"translate(3, 15) rotate(-45)\"><rect x=\"0\" y=\"0\" width=\"18\" height=\"10\" rx=\"3\"/></g><line x1=\"11\" y1=\"21\" x2=\"18\" y2=\"21\"/><line x1=\"20\" y1=\"21\" x2=\"22\" y2=\"21\"/></g>",shapeIconToolPath:"<g stroke-width=\".125em\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" fill=\"none\"><circle cx=\"21\" cy=\"3\" r=\"2\"/><circle cx=\"9\" cy=\"9\" r=\"2\"/><circle cx=\"3\" cy=\"21\" r=\"2\"/><path d=\"M19 4 11 8 M8 11 4 19\"/></g>",shapeIconToolRectangle:"<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><rect x=\"2\" y=\"2\" width=\"20\" height=\"20\" rx=\"3\"/></g>",shapeIconToolEllipse:"<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><circle cx=\"12\" cy=\"12\" r=\"11\"/></g>",shapeIconToolArrow:"<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><line x1=\"20\" y1=\"3\" x2=\"6\" y2=\"21\"/><path d=\"m10 6 L21.5 1 L20 13.5\" fill=\"currentColor\" stroke=\"none\"/></g>",shapeIconToolLine:"<g stroke-width=\".125em\" stroke=\"currentColor\" fill=\"none\"><line x1=\"20\" y1=\"3\" x2=\"6\" y2=\"21\"/></g>",shapeIconToolText:"<g stroke=\"none\" fill=\"currentColor\" transform=\"translate(6,0)\"><path d=\"M8.14 20.085c.459 0 .901-.034 1.329-.102a8.597 8.597 0 001.015-.21v1.984c-.281.135-.695.247-1.242.336a9.328 9.328 0 01-1.477.133c-3.312 0-4.968-1.745-4.968-5.235V6.804H.344v-1.25l2.453-1.078L3.89.819h1.5v3.97h4.97v2.015H5.39v10.078c0 1.031.245 1.823.735 2.375s1.161.828 2.015.828z\"/>",shapeIconToolPreset:"<g fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\"><path d=\"M12 22c2.773 0 1.189-5.177 3-7 1.796-1.808 7-.25 7-3 0-5.523-4.477-10-10-10S2 6.477 2 12s4.477 10 10 10z\"></path><path d=\"M20 17c-3 3-5 5-8 5\"></path></g>"};var _plugin_crop_locale_en_gb={cropLabel:'Crop',cropIcon:'<g stroke-width=".125em" stroke="currentColor" fill="none"><path d="M23 17H9a2 2 0 0 1-2-2v-5m0-3V1 M1 7h14a2 2 0 0 1 2 2v7m0 4v3"/></g>',cropIconButtonRecenter:"<path stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\" stroke-linejoin=\"bevel\" d=\"M1.5 7.5v-6h6M1.5 16.5v6h6M22.5 16.5v6h-6M22.5 7.5v-6h-6\"/><circle cx=\"12\" cy=\"12\" r=\"3.5\" fill=\"currentColor\" stroke=\"none\"/>",cropIconButtonRotateLeft:'<g stroke="none" fill="currentColor"><path fill="none" d="M-1-1h582v402H-1z"/><rect x="3" rx="1" height="12" width="12" y="9"/><path d="M15 5h-1a5 5 0 015 5 1 1 0 002 0 7 7 0 00-7-7h-1.374l.747-.747A1 1 0 0011.958.84L9.603 3.194a1 1 0 000 1.415l2.355 2.355a1 1 0 001.415-1.414l-.55-.55H15z"/></g>',cropIconButtonRotateRight:'<g stroke="none" fill="currentColor"><path fill="none" d="M-1-1h582v402H-1z"/><path d="M11.177 5H10a5 5 0 00-5 5 1 1 0 01-2 0 7 7 0 017-7h1.374l-.747-.747A1 1 0 0112.042.84l2.355 2.355a1 1 0 010 1.415l-2.355 2.354a1 1 0 01-1.415-1.414l.55-.55z"/><rect rx="1" height="12" width="12" y="9" x="9"/></g>',cropIconButtonFlipVertical:'<g stroke="none" fill="currentColor"><path d="M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z"/><path d="M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z" opacity=".6"/></g>',cropIconButtonFlipHorizontal:'<g stroke="none" fill="currentColor"><path d="M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z"/><path d="M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z" opacity=".6"/></g>',cropIconSelectPreset:function cropIconSelectPreset(locale,aspectRatio){var _ref467=!aspectRatio?[0.2,0.3,0.4]:[aspectRatio<1?1:0.3,aspectRatio===1?0.85:0.5,aspectRatio>1?1:0.3],_ref468=_slicedToArray(_ref467,3),a=_ref468[0],b=_ref468[1],c=_ref468[2];return"<g fill=\"currentColor\">\n            <rect opacity=\"".concat(a,"\" x=\"2\" y=\"4\" width=\"10\" height=\"18\" rx=\"1\"/>\n            <rect opacity=\"").concat(b,"\" x=\"4\" y=\"8\" width=\"14\" height=\"14\" rx=\"1\"/>\n            <rect opacity=\"").concat(c,"\" x=\"6\" y=\"12\" width=\"17\" height=\"10\" rx=\"1\"/>\n        </g>");},cropIconCropBoundary:function cropIconCropBoundary(locale,isBoundToImage){var _ref469=isBoundToImage?[0.3,1,0,0]:[0,0,0.3,1],_ref470=_slicedToArray(_ref469,4),a=_ref470[0],b=_ref470[1],c=_ref470[2],d=_ref470[3];return"<g fill=\"currentColor\">\n            <rect opacity=\"".concat(a,"\" x=\"2\" y=\"3\" width=\"20\" height=\"20\" rx=\"1\"/>\n            <rect opacity=\"").concat(b,"\" x=\"7\" y=\"8\" width=\"10\" height=\"10\" rx=\"1\"/>\n            <rect opacity=\"").concat(c,"\" x=\"4\" y=\"8\" width=\"14\" height=\"14\" rx=\"1\"/>\n            <rect opacity=\"").concat(d,"\" x=\"12\" y=\"4\" width=\"10\" height=\"10\" rx=\"1\"/>\n        </g>");},cropLabelButtonRecenter:'Recenter',cropLabelButtonRotateLeft:'Rotate left',cropLabelButtonRotateRight:'Rotate right',cropLabelButtonFlipHorizontal:'Flip horizontal',cropLabelButtonFlipVertical:'Flip vertical',cropLabelSelectPreset:'Crop shape',cropLabelCropBoundary:'Crop boundary',cropLabelCropBoundaryEdge:'Edge of image',cropLabelCropBoundaryNone:'None',cropLabelTabRotation:'Rotation',cropLabelTabZoom:'Scale'};var _plugin_fill_locale_en_gb={fillLabel:'Fill',fillIcon:"\n    <g fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\">\n        <g transform=\"rotate(60, 12, 12)\">\n            <rect x=\"4\" y=\"4\" width=\"14\" height=\"16\" rx=\"3\"/>\n        </g>\n        <path d=\"M21 13 L21 21\"></path>\n        <path d=\"M4.5 12.5 L19 12.5\"></path>\n    </g>\n    "};var _plugin_filter_locale_en_gb={filterLabel:'Filter',filterIcon:'<g stroke-width=".125em" stroke="currentColor" fill="none"><path d="M18.347 9.907a6.5 6.5 0 1 0-1.872 3.306M3.26 11.574a6.5 6.5 0 1 0 2.815-1.417 M10.15 17.897A6.503 6.503 0 0 0 16.5 23a6.5 6.5 0 1 0-6.183-8.51"/></g>',filterLabelChrome:'Chrome',filterLabelFade:'Fade',filterLabelCold:'Cold',filterLabelWarm:'Warm',filterLabelPastel:'Pastel',filterLabelMonoDefault:'Mono',filterLabelMonoNoir:'Noir',filterLabelMonoWash:'Wash',filterLabelMonoStark:'Stark',filterLabelSepiaDefault:'Sepia',filterLabelSepiaBlues:'Blues',filterLabelSepiaRust:'Rust',filterLabelSepiaColor:'Color'};var _plugin_finetune_locale_en_gb={finetuneLabel:'Finetune',finetuneIcon:'<g stroke-width=".125em" stroke="currentColor" fill="none"><path d="M4 1v5.5m0 3.503V23M12 1v10.5m0 3.5v8M20 1v15.5m0 3.5v3M2 7h4M10 12h4M18 17h4"/></g>',finetuneLabelBrightness:'Brightness',finetuneLabelContrast:'Contrast',finetuneLabelSaturation:'Saturation',finetuneLabelExposure:'Exposure',finetuneLabelTemperature:'Temperature',finetuneLabelGamma:'Gamma',finetuneLabelClarity:'Clarity',finetuneLabelVignette:'Vignette'};var _plugin_resize_locale_en_gb={resizeLabel:'Resize',resizeIcon:'<g stroke-width=".125em" stroke="currentColor" fill="none"><rect x="2" y="12" width="10" height="10" rx="2"/><path d="M4 11.5V4a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-5.5"/><path d="M14 10l3.365-3.365M14 6h4v4"/></g>',resizeLabelFormCaption:'Image output size',resizeLabelInputWidth:'w',resizeTitleInputWidth:'Width',resizeLabelInputHeight:'h',resizeTitleInputHeight:'Height',resizeTitleButtonMaintainAspectRatio:'Maintain aspectratio',resizeIconButtonMaintainAspectRatio:function resizeIconButtonMaintainAspectRatio(active,activeFraction){return"\n        <defs>\n            <mask id=\"mask1\" x=\"0\" y=\"0\" width=\"24\" height=\"24\" >\n                <rect x=\"0\" y=\"0\" width=\"24\" height=\"10\" fill=\"#fff\" stroke=\"none\"/>\n            </mask>\n        </defs>\n        <g fill=\"none\" fill-rule=\"evenodd\">\n            <g  mask=\"url(#mask1)\">\n                <path transform=\"translate(0 ".concat((activeFraction-1)*3,")\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" d=\"M9.401 10.205v-.804a2.599 2.599 0 0 1 5.198 0V17\"/>\n            </g>\n            <rect fill=\"currentColor\" x=\"7\" y=\"10\" width=\"10\" height=\"7\" rx=\"1.5\"/>\n        </g>\n    ");}};var _plugin_decorate_locale_en_gb={decorateLabel:'Decorate',decorateIcon:'<g fill="none" fill-rule="evenodd"><path stroke="currentColor" stroke-width=".125em" stroke-linecap="round" stroke-linejoin="round" d="M12 18.5l-6.466 3.4 1.235-7.2-5.23-5.1 7.228-1.05L12 2l3.233 6.55 7.229 1.05-5.231 5.1 1.235 7.2z"/></g>'};var _plugin_annotate_locale_en_gb={annotateLabel:'Annotate',annotateIcon:'<g stroke-width=".125em" stroke="currentColor" fill="none"><path d="M17.086 2.914a2.828 2.828 0 1 1 4 4l-14.5 14.5-5.5 1.5 1.5-5.5 14.5-14.5z"/></g>'};var _plugin_sticker_locale_en_gb={stickerLabel:'Sticker',stickerIcon:'<g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" stroke-width=".125em"><path d="M12 22c2.773 0 1.189-5.177 3-7 1.796-1.808 7-.25 7-3 0-5.523-4.477-10-10-10S2 6.477 2 12s4.477 10 10 10z"/><path d="M20 17c-3 3-5 5-8 5"/></g>'};var _plugin_frame_locale_en_gb={frameLabel:'Frame',frameIcon:"<g fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\">\n            <rect x=\"2\" y=\"2\" width=\"20\" height=\"20\" rx=\"4\"/>\n            <rect x=\"6\" y=\"6\" width=\"12\" height=\"12\" rx=\"1\"/>\n        </g>",frameLabelMatSharp:'Mat',frameLabelMatRound:'Bevel',frameLabelLineSingle:'Line',frameLabelLineMultiple:'Zebra',frameLabelEdgeSeparate:'Inset',frameLabelEdgeOverlap:'Plus',frameLabelEdgeCross:'Lumber',frameLabelCornerHooks:'Hook',frameLabelPolaroid:'Polaroid'};var _plugin_redact_locale_en_gb={redactLabel:'Redact',redactIcon:"<g fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"currentColor\" stroke-width=\".125em\">\n        <path d=\"M 4 5 l 1 -1\"/>\n        <path d=\"M 4 10 l 6 -6\"/>\n        <path d=\"M 4 15 l 11 -11\"/>\n        <path d=\"M 4 20 l 16 -16\"/>\n        <path d=\"M 9 20 l 11 -11\"/>\n        <path d=\"M 14 20 l 6 -6\"/>\n        <path d=\"M 19 20 l 1 -1\"/>\n    </g>"};var hasDefinedCustomElement=function hasDefinedCustomElement(name){return document.createElement(name).constructor!==HTMLElement;};var linkAccessors=function linkAccessors(destination,origin){var descriptors=Object.getOwnPropertyDescriptors(destination);Object.keys(descriptors).forEach(function(key){// props, set new setter and getter
if(!!descriptors[key]['get']){Object.defineProperty(origin,key,{get:function get(){return destination[key];},set:function set(value){return destination[key]=value;}});}// method, copy reference
else{origin[key]=destination[key];}});};var hasDoctype=function hasDoctype(){return isBrowser()&&document.doctype!==null;};var initEditorView=function initEditorView(target){var accessors={};var _pubsub5=pubsub(),sub=_pubsub5.sub,pub=_pubsub5.pub;// catch missing doctype
if(!hasDoctype())console.warn('Browser is in quirks mode, add <!DOCTYPE html> to page to fix render issues');// create editor core
var core=createImageEditor();linkAccessors(core,accessors);// create editor view
var view=attachEditorView(target,core.stores);linkAccessors(view,accessors);// listen for UI interaction and link to editor API (internals)
var unsubs=['loadImage','processImage','abortProcessImage','abortLoadImage'].map(function(event){return view.on(event,function(e){// run core method, if returns a promise, we silence errors as those are passed to the UI via stores
var returned=core[event](e&&e.detail);if(returned instanceof Promise)returned["catch"](noop$1);});});// auto subscribes on each possible publisher
var subscribe=function subscribe(event,cb){var unsubInit=sub(event,cb);var unsubCore=core.on(event,cb);var unsubView=view.on(event,cb);return function(){unsubInit();unsubCore();unsubView();};};// handles every event, useful for routing events from the options object
accessors.handleEvent=noop$1;var handleEventUnsubs=editorEvents.map(function(type){return subscribe(type,function(res){return accessors.handleEvent(type,res);});});// set up new api
defineMethods(accessors,{on:subscribe,updateImage:function updateImage(src){return new Promise(function(resolve,reject){// save history
var storedHistory=accessors.history.get();var storedHistoryIndex=accessors.history.index;// save state
var storedState=accessors.imageState;// update image
core.loadImage(src).then(function(res){// restore history
accessors.history.set(storedHistory);accessors.history.index=storedHistoryIndex;// restore state
accessors.imageState=storedState;// done!
resolve(res);})["catch"](reject);});},close:function close(){pub('close');},destroy:function destroy(){// unsub
[].concat(_toConsumableArray(unsubs),_toConsumableArray(handleEventUnsubs)).forEach(function(unsub){return unsub();});// destroy
view.destroy();core.destroy();// destroyed
pub('destroy');}});setTimeout(function(){return pub('init',accessors);},0);return accessors;};var TAG='pintura-editor';var _defineCustomElements=function _defineCustomElements(){return new Promise(function(resolve){if(!PinturaImageEditorElement)return resolve([]);!hasDefinedCustomElement(TAG)&&customElements.define(TAG,PinturaImageEditorElement);customElements.whenDefined(TAG).then(function(){return resolve(document.querySelectorAll(TAG));});});};var PinturaImageEditorElement=isBrowser()&&/*#__PURE__*/function(_HTMLElement){_inherits(_class,_HTMLElement);var _super55=_createSuper(_class);function _class(){var _this56;_classCallCheck(this,_class);_this56=_super55.call(this);_this56._editor=undefined;_this56._unsubs=undefined;return _this56;}_createClass(_class,[{key:"attributeChangedCallback",value:function attributeChangedCallback(attrName,oldValue,newValue){this[attrName]=newValue;}},{key:"connectedCallback",value:function connectedCallback(){this._editor=initEditorView(this);linkAccessors(this._editor,this);this._editor.src=this.getAttribute('src');this._unsubs=dispatchEditorEvents(this._editor,this);}},{key:"disconnectedCallback",value:function disconnectedCallback(){this._editor.destroy();this._unsubs.forEach(function(unsub){return unsub();});}}],[{key:"observedAttributes",get:function get(){return['src'];}}]);return _class;}(/*#__PURE__*/_wrapNativeSuper(HTMLElement));var CSS_CLASS_NAME='pintura-editor';var _appendEditor=function _appendEditor(target){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var element=isString(target)?document.querySelector(target):target;if(!isElement(element))return undefined;options["class"]=options["class"]?"".concat(CSS_CLASS_NAME," ").concat(options["class"]):CSS_CLASS_NAME;var accessors=initEditorView(element);return Object.assign(accessors,options);};/* src/core/ui/modal/index.svelte generated by Svelte v3.52.0 */var document_1=globals.document,window_1=globals.window;function create_fragment(ctx){var t;var div;var mounted;var dispose;add_render_callback(/*onwindowresize*/ctx[27]);return{c:function c(){t=space();div=element("div");attr(div,"class",/*className*/ctx[4]);attr(div,"style",/*style*/ctx[5]);},m:function m(target,anchor){insert(target,t,anchor);insert(target,div,anchor);/*div_binding*/ctx[28](div);if(!mounted){dispose=[listen(window_1,"keydown",/*handleKey*/ctx[10]),listen(window_1,"orientationchange",/*spawnMeasureElement*/ctx[11]),listen(window_1,"resize",/*onwindowresize*/ctx[27]),listen(document_1.body,"focusin",function(){if(is_function(!/*hidden*/ctx[1]&&/*handleFocusIn*/ctx[7]))(!/*hidden*/ctx[1]&&/*handleFocusIn*/ctx[7]).apply(this,arguments);}),listen(document_1.body,"focusout",function(){if(is_function(/*hasFocussedTextField*/ctx[2]&&/*handleFocusOut*/ctx[8]))(/*hasFocussedTextField*/ctx[2]&&/*handleFocusOut*/ctx[8]).apply(this,arguments);}),listen(div,"wheel",/*handleWheel*/ctx[9],{passive:false})];mounted=true;}},p:function p(new_ctx,dirty){ctx=new_ctx;if(dirty[0]&/*className*/16){attr(div,"class",/*className*/ctx[4]);}if(dirty[0]&/*style*/32){attr(div,"style",/*style*/ctx[5]);}},i:noop,o:noop,d:function d(detaching){if(detaching)detach(t);if(detaching)detach(div);/*div_binding*/ctx[28](null);mounted=false;run_all(dispose);}};}function instance($$self,$$props,$$invalidate){var o;var viewportRules;var isOpaque;var isIOSFooterVisible;var style;var className;var scrollsBodyOnInteraction;var $opacity;var dispatch=createEventDispatcher();var root=$$props.root;var _$$props$preventZoomV=$$props.preventZoomViewport,preventZoomViewport=_$$props$preventZoomV===void 0?true:_$$props$preventZoomV;var _$$props$preventScrol=$$props.preventScrollBodyIfNeeded,preventScrollBodyIfNeeded=_$$props$preventScrol===void 0?true:_$$props$preventScrol;var _$$props$preventFoote=$$props.preventFooterOverlapIfNeeded,preventFooterOverlapIfNeeded=_$$props$preventFoote===void 0?true:_$$props$preventFoote;var _$$props$class16=$$props["class"],klass=_$$props$class16===void 0?undefined:_$$props$class16;var hidden=true;var hiding=false;var showing=false;var doc=isBrowser()&&document.documentElement;var body=isBrowser()&&document.body;var head=isBrowser()&&document.head;var opacity=spring(0,{precision:0.001,damping:0.5});component_subscribe($$self,opacity,function(value){return $$invalidate(26,$opacity=value);});// animate hide and show
var opacityUnsub=opacity.subscribe(function(o){if(showing&&o>=1){$$invalidate(19,showing=false);// now shown
$$invalidate(1,hidden=false);dispatch('show');}else if(hiding&&o<=0){$$invalidate(18,hiding=false);// now hidden
$$invalidate(1,hidden=true);dispatch('hide');}});var hasFocussedTextField=false;var viewportDefaults=undefined;var themeDefaults=undefined;var showTimeoutId=undefined;var getViewPortElement=function getViewPortElement(){return document.querySelector('meta[name=viewport]');};var getThemeElements=function getThemeElements(){return Array.from(document.querySelectorAll('meta[name=theme-color]'));};var show=function show(){// is visible, or busy becoming visible
if(showing||!hidden)return;// now in 'showing' transition
$$invalidate(19,showing=true);// store default viewport element values
var viewportElement=getViewPortElement()||h('meta',{name:'viewport'});viewportDefaults=!viewportDefaults&&viewportElement.getAttribute('content');viewportElement.setAttribute('content',viewportRules+(/cover/.test(viewportDefaults)?',viewport-fit=cover':''));if(!viewportElement.parentNode)head.append(viewportElement);// store default theme element values
var backgroundColor=getComputedStyle(root).getPropertyValue('--color-background');var themeElements=getThemeElements();if(themeElements.length){// store defaults
themeDefaults=themeElements.map(function(element){return element.getAttribute('content');});}else{// create element
var themeElement=h('meta',{name:'theme-color'});head.append(themeElement);themeElements.push(themeElement);}// update colors
themeElements.forEach(function(element){return element.setAttribute('content',"rgb(".concat(backgroundColor,")"));});clearTimeout(showTimeoutId);showTimeoutId=setTimeout(function(){return opacity.set(1);},250);};var hide=function hide(){// is hiding or already hidden
if(hiding||hidden)return;// if previous command was show, we need to prevent the timeout from kicking off
clearTimeout(showTimeoutId);// now in 'hiding' transition
$$invalidate(18,hiding=true);// get a reference to the viewport element, it should be there as we created it earlier,
// we restore defaults if the viewport metatag was defined, if not, we destroy it
var viewportElement=getViewPortElement();if(viewportDefaults)viewportElement.setAttribute('content',viewportDefaults);else viewportElement.remove();// restore colors
var themeElements=getThemeElements();if(themeDefaults){themeElements.forEach(function(element,index){element.setAttribute('content',themeDefaults[index]);});}else themeElements.forEach(function(element){return element.remove();});// let's hide!
opacity.set(0);};//
// handle soft keyboard impact on window height
//
var focusOutTimer;var focusInWindowHeight;var handleFocusIn=function handleFocusIn(e){// test if is text input element
if(!isTextField(e.target))return;// now focussing a field
$$invalidate(2,hasFocussedTextField=true);focusInWindowHeight=windowHeight;};var handleFocusOut=function handleFocusOut(e){// test if is text input element
if(!isTextField(e.target))return;// prevent accidentally setting two timers
clearTimeout(focusOutTimer);// test if window height changed, if not, no soft keyboard appeared and we can set false to focus state immidiately
if(focusInWindowHeight===windowHeight){$$invalidate(2,hasFocussedTextField=false);}else// soft keyboard might have appeared, test for window height change before setting unfocus state
{var windowCurrentHeight=windowHeight;runWhen(function(){return windowHeight!==windowCurrentHeight;},function(){return $$invalidate(2,hasFocussedTextField=false);});}};var runWhen=function runWhen(test,cb){var frame=function frame(){if(test()){cb();return;}requestAnimationFrame(frame);};requestAnimationFrame(frame);};//
// end soft keyboard logic
//
// prevent mousewheel from scrolling content behind modal
var handleWheel=function handleWheel(e){if(e.target&&/PinturaStage/.test(e.target.className))e.preventDefault();};// handle escape to close modal
var handleKey=function handleKey(e){// get key type
var key=e.key;// only deal with escape key
if(!/escape/i.test(key))return;// don't close when in an input or textuarea
var targetElement=e.target;if(targetElement&&/input|textarea/i.test(targetElement.nodeName))return;// only close if I'm the top modal
var modals=document.querySelectorAll('.PinturaModal');if(modals[modals.length-1]!==root)return;// request close
dispatch('close');};// this logic scales modal to fit viewport height
var windowHeight=0;var windowHeightComputed;// iOS measure actual page height so we can make optional use of available space
var measureElement;var measureElementHeight=undefined;var spawnMeasureElement=function spawnMeasureElement(){// can't spawn more than one
if(measureElement)return;// create measure element and append to body
measureElement=h('div',{style:'position:fixed;height:100vh;top:0'});body.append(measureElement);};onMount(function(){// no need to run this logic if is not on iOS
if(!preventFooterOverlapIfNeeded||!isIOS())return;// will be used in first read to determine page height and bottom padding
spawnMeasureElement();});afterUpdate(function(){// will only run on iOS
if(!measureElement)return;// get height and store
$$invalidate(21,measureElementHeight=measureElement.offsetHeight);// remove measure element
measureElement.remove();measureElement=undefined;});//
// document lock style for iOS 15.0
//
var scrollOffsetY=undefined;// syncs height of doc lock with window
var syncHeight=function syncHeight(){return doc.style.setProperty('--pintura-document-height',"".concat(window.innerHeight,"px"));};var toggleDocumentLock=function toggleDocumentLock(isOpaque){if(isOpaque){scrollOffsetY=window.scrollY;// prevents safari on iOS 15.0 from scrolling body and showing footer on drag interaction
doc.classList.add('PinturaDocumentLock');// need to do this to sync height of initial window
syncHeight();// also sync on resize
window.addEventListener('resize',syncHeight);}else{// stop syncing height
window.removeEventListener('resize',syncHeight);// clean up
doc.classList.remove('PinturaDocumentLock');isNumber(scrollOffsetY)&&window.scrollTo(0,scrollOffsetY);scrollOffsetY=undefined;}};//
// clean up when removed
//
onDestroy(function(){// make sure no longer locking body element
doc.classList.remove('PinturaModalBodyLock');// clean up subs
opacityUnsub();});function onwindowresize(){$$invalidate(3,windowHeight=window_1.innerHeight);}function div_binding($$value){binding_callbacks[$$value?'unshift':'push'](function(){root=$$value;$$invalidate(0,root);});}$$self.$$set=function($$props){if('root'in $$props)$$invalidate(0,root=$$props.root);if('preventZoomViewport'in $$props)$$invalidate(12,preventZoomViewport=$$props.preventZoomViewport);if('preventScrollBodyIfNeeded'in $$props)$$invalidate(13,preventScrollBodyIfNeeded=$$props.preventScrollBodyIfNeeded);if('preventFooterOverlapIfNeeded'in $$props)$$invalidate(14,preventFooterOverlapIfNeeded=$$props.preventFooterOverlapIfNeeded);if('class'in $$props)$$invalidate(15,klass=$$props["class"]);};$$self.$$.update=function(){if($$self.$$.dirty[0]&/*showing, hiding, $opacity, hidden*/67895298){$$invalidate(25,o=showing||hiding?$opacity:hidden?0:1);}if($$self.$$.dirty[0]&/*preventZoomViewport*/4096){viewportRules='width=device-width,height=device-height,initial-scale=1'+(preventZoomViewport?',maximum-scale=1,user-scalable=0':'');}if($$self.$$.dirty[0]&/*showing, hidden, hiding*/786434){$$invalidate(22,isOpaque=!showing&&!hidden&&!hiding);}if($$self.$$.dirty[0]&/*hasFocussedTextField, windowHeight*/12){if(!hasFocussedTextField)$$invalidate(20,windowHeightComputed=windowHeight);}if($$self.$$.dirty[0]&/*measureElementHeight, windowHeight*/2097160){$$invalidate(24,isIOSFooterVisible=isNumber(measureElementHeight)?"--viewport-pad-footer:".concat(measureElementHeight>windowHeight?0:1):'');}if($$self.$$.dirty[0]&/*o, windowHeightComputed, isIOSFooterVisible*/51380224){$$invalidate(5,style="opacity:".concat(o,";height:").concat(windowHeightComputed,"px;--editor-modal:1;").concat(isIOSFooterVisible));}if($$self.$$.dirty[0]&/*klass*/32768){$$invalidate(4,className=arrayJoin(['pintura-editor','PinturaModal',klass]));}if($$self.$$.dirty[0]&/*preventScrollBodyIfNeeded*/8192){$$invalidate(23,scrollsBodyOnInteraction=preventScrollBodyIfNeeded&&isIOS()&&/15_/.test(navigator.userAgent));}if($$self.$$.dirty[0]&/*scrollsBodyOnInteraction, isOpaque*/12582912){scrollsBodyOnInteraction&&toggleDocumentLock(isOpaque);}};return[root,hidden,hasFocussedTextField,windowHeight,className,style,opacity,handleFocusIn,handleFocusOut,handleWheel,handleKey,spawnMeasureElement,preventZoomViewport,preventScrollBodyIfNeeded,preventFooterOverlapIfNeeded,klass,show,hide,hiding,showing,windowHeightComputed,measureElementHeight,isOpaque,scrollsBodyOnInteraction,isIOSFooterVisible,o,$opacity,onwindowresize,div_binding];}var Modal=/*#__PURE__*/function(_SvelteComponent54){_inherits(Modal,_SvelteComponent54);var _super56=_createSuper(Modal);function Modal(options){var _this57;_classCallCheck(this,Modal);_this57=_super56.call(this);init(_assertThisInitialized(_this57),options,instance,create_fragment,safe_not_equal,{root:0,preventZoomViewport:12,preventScrollBodyIfNeeded:13,preventFooterOverlapIfNeeded:14,"class":15,show:16,hide:17},null,[-1,-1]);return _this57;}_createClass(Modal,[{key:"root",get:function get(){return this.$$.ctx[0];},set:function set(root){this.$$set({root:root});flush();}},{key:"preventZoomViewport",get:function get(){return this.$$.ctx[12];},set:function set(preventZoomViewport){this.$$set({preventZoomViewport:preventZoomViewport});flush();}},{key:"preventScrollBodyIfNeeded",get:function get(){return this.$$.ctx[13];},set:function set(preventScrollBodyIfNeeded){this.$$set({preventScrollBodyIfNeeded:preventScrollBodyIfNeeded});flush();}},{key:"preventFooterOverlapIfNeeded",get:function get(){return this.$$.ctx[14];},set:function set(preventFooterOverlapIfNeeded){this.$$set({preventFooterOverlapIfNeeded:preventFooterOverlapIfNeeded});flush();}},{key:"class",get:function get(){return this.$$.ctx[15];},set:function set(klass){this.$$set({"class":klass});flush();}},{key:"show",get:function get(){return this.$$.ctx[16];}},{key:"hide",get:function get(){return this.$$.ctx[17];}}]);return Modal;}(SvelteComponent);// we export a function that renders the view as to not export svelte component related code to outside the ui dir
var createModal=function createModal(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var parent=arguments.length>1?arguments[1]:undefined;return new Modal({target:parent||document.body,props:{"class":options["class"],preventZoomViewport:options.preventZoomViewport,preventScrollBodyIfNeeded:options.preventScrollBodyIfNeeded,preventFooterOverlapIfNeeded:options.preventFooterOverlapIfNeeded}});};var _openEditor=function _openEditor(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var parent=arguments.length>1?arguments[1]:undefined;// set up pub/sub for the app layer
var _pubsub6=pubsub(),sub=_pubsub6.sub,pub=_pubsub6.pub;var accessors={};var modal=createModal(options,parent);var hide=function hide(){if(!modal.hide)return;// was destroyed
modal.hide();};var show=function show(){if(!modal.show)return;// was destroyed
modal.show();};var view=initEditorView(modal.root);linkAccessors(view,accessors);// link up handle event
accessors.handleEvent=noop$1;view.handleEvent=function(type,detail){// need to do this so we pass correct accessors
if(type==='init')return accessors.handleEvent(type,accessors);// other events
accessors.handleEvent(type,detail);};// route close request from view to modal
view.on('close',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee58(){var willClose,shouldClose;return _regeneratorRuntime().wrap(function _callee58$(_context59){while(1)switch(_context59.prev=_context59.next){case 0:willClose=options.willClose;if(willClose){_context59.next=3;break;}return _context59.abrupt("return",hide());case 3:_context59.next=5;return willClose();case 5:shouldClose=_context59.sent;if(shouldClose)hide();case 7:case"end":return _context59.stop();}},_callee58);})));var subscribe=function subscribe(event,cb){// capture modal related events
if(/show|hide/.test(event))return sub(event,cb);// route rest of events to view
return view.on(event,cb);};var modalHandleEventUnsubs=['show','hide'].map(function(type){return subscribe(type,function(detail){return accessors.handleEvent(type,detail);});});// cleans up view
var destroy=function destroy(){// unsub
modalHandleEventUnsubs.forEach(function(unsub){return unsub();});// remove
hide();modal.$destroy();view.destroy();};defineMethods(accessors,{on:subscribe,destroy:destroy,hide:hide,show:show});// add element root query
Object.defineProperty(accessors,'modal',{get:function get(){return modal.root;},set:function set(){return undefined;}});// route modal events
modal.$on('close',view.close);modal.$on('show',function(){return pub('show');});modal.$on('hide',function(){pub('hide');if(options.enableAutoDestroy!==false)destroy();});// modal behavior
if(options.enableAutoHide!==false)view.on('process',hide);view.on('loadstart',show);// test if should
if(options.enableButtonClose!==false)options.enableButtonClose=true;// delete class
delete options["class"];// update props
Object.assign(accessors,options);return accessors;};var _overlayEditor=function _overlayEditor(target,options){var editor=_appendEditor(target,_objectSpread(_objectSpread({},options),{},{layout:'overlay'}));return editor;};// helper method to calculate end style params that are passed to lineEnd style functions
var getLineEndParams=function getLineEndParams(start,end,strokeWidth,isSolid){var direction=vectorCreate(end.x-start.x,end.y-start.y);var normal=vectorNormalize(direction);var scaledSize=5*strokeWidth;var scaledSizeHalf;// solid
if(isSolid){scaledSizeHalf=scaledSize*0.5;}// stroke
else{scaledSizeHalf=Math.ceil((scaledSize-1)*0.5);}var offset=vectorMultiply(vectorClone(normal),scaledSizeHalf);return{anchor:vectorClone(start),offset:offset,normal:normal,solid:isSolid,size:scaledSize,sizeHalf:scaledSizeHalf};};// various available styles
var lineEndStyleArrow=function lineEndStyleArrow(_ref472,anchorRef){var anchor=_ref472.anchor,solid=_ref472.solid,normal=_ref472.normal,offset=_ref472.offset,size=_ref472.size,sizeHalf=_ref472.sizeHalf,strokeWidth=_ref472.strokeWidth,strokeColor=_ref472.strokeColor;var x=anchor.x;var y=anchor.y;var tipOffset=vectorMultiply(vectorClone(normal),size);var inset=vectorCreate(x+tipOffset.x,y+tipOffset.y);vectorMultiply(tipOffset,0.55);if(solid){// move back so arrow triangle overlaps with end of line (otherwise line sticks out of triangle tip)
vectorAdd(anchorRef,offset);var arrowOffset=vectorMultiply(vectorClone(normal),sizeHalf*0.5);return[{points:[vectorCreate(x-arrowOffset.x,y-arrowOffset.y),vectorCreate(inset.x-tipOffset.y,inset.y+tipOffset.x),vectorCreate(inset.x+tipOffset.y,inset.y-tipOffset.x)],pathClose:true,backgroundColor:strokeColor}];}else{// this prevents trouble with sharp line rendering in webgl
var p=vectorMultiply(vectorPerpendicular(vectorClone(normal)),0.5);var tipLeft=vectorCreate(x-p.x,y-p.y);var tipRight=vectorCreate(x+p.x,y+p.y);return[{points:[vectorCreate(inset.x+tipOffset.y,inset.y-tipOffset.x),tipLeft,vectorCreate(x,y),tipRight,vectorCreate(inset.x-tipOffset.y,inset.y+tipOffset.x)],pathClose:false,strokeWidth:strokeWidth,strokeColor:strokeColor}];}};var lineEndStyleCircle=function lineEndStyleCircle(_ref473,anchorRef){var anchor=_ref473.anchor,solid=_ref473.solid,offset=_ref473.offset,normal=_ref473.normal,sizeHalf=_ref473.sizeHalf,strokeWidth=_ref473.strokeWidth,strokeColor=_ref473.strokeColor;// update anchor point position
vectorAdd(anchorRef,offset);// if solid, move line slightly towards circle as to make them overlap
if(solid)vectorAdd(anchorRef,vectorInvert(vectorClone(normal)));return[{x:anchor.x,y:anchor.y,rx:sizeHalf,ry:sizeHalf,backgroundColor:solid?strokeColor:undefined,strokeWidth:solid?undefined:strokeWidth,strokeColor:solid?undefined:strokeColor}];};var lineEndStyleBar=function lineEndStyleBar(_ref474){var anchor=_ref474.anchor,offset=_ref474.offset,strokeWidth=_ref474.strokeWidth,strokeColor=_ref474.strokeColor;return[{points:[vectorCreate(anchor.x-offset.y,anchor.y+offset.x),vectorCreate(anchor.x+offset.y,anchor.y-offset.x)],strokeWidth:strokeWidth,strokeColor:strokeColor}];};var lineEndStyleSquare=function lineEndStyleSquare(_ref475,anchorRef){var anchor=_ref475.anchor,solid=_ref475.solid,offset=_ref475.offset,normal=_ref475.normal,sizeHalf=_ref475.sizeHalf,strokeWidth=_ref475.strokeWidth,strokeColor=_ref475.strokeColor;// update anchor point position
vectorAdd(anchorRef,offset);return[{x:anchor.x-sizeHalf,y:anchor.y-sizeHalf,width:sizeHalf*2,height:sizeHalf*2,rotation:vectorAngle(normal),backgroundColor:solid?strokeColor:undefined,strokeWidth:solid?undefined:strokeWidth,strokeColor:solid?undefined:strokeColor}];};// this method parses the shape and checks if lineStart or lineEnd is being used
var createLineEndProcessor=function createLineEndProcessor(){var styles=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return function(shape){if(!hasProp(shape,'lineStart')&&!hasProp(shape,'lineEnd'))return;// resulting shapes
var res=[];var lineStart=shape.lineStart,lineEnd=shape.lineEnd,strokeWidth=shape.strokeWidth,strokeColor=shape.strokeColor;var start=vectorCreate(shape.x1,shape.y1);var end=vectorCreate(shape.x2,shape.y2);var points=[start,end];// handle lineStart
if(lineStart){var _lineStart$split=lineStart.split('-'),_lineStart$split2=_slicedToArray(_lineStart$split,2),_style=_lineStart$split2[0],solid=_lineStart$split2[1];var _process=styles[_style];if(_process){var params=getLineEndParams(start,end,strokeWidth,!!solid);res.push.apply(res,_toConsumableArray(_process(_objectSpread(_objectSpread({},params),{},{strokeColor:strokeColor,strokeWidth:strokeWidth}),start)));}}// handle lineEnd
if(lineEnd){var _lineEnd$split=lineEnd.split('-'),_lineEnd$split2=_slicedToArray(_lineEnd$split,2),_style2=_lineEnd$split2[0],_solid=_lineEnd$split2[1];var _process2=styles[_style2];if(_process2){var _params=getLineEndParams(end,start,strokeWidth,!!_solid);res.push.apply(res,_toConsumableArray(_process2(_objectSpread(_objectSpread({},_params),{},{strokeColor:strokeColor,strokeWidth:strokeWidth}),end)));}}return[// return inner path
{points:points,strokeWidth:strokeWidth,strokeColor:strokeColor}].concat(res);};};// the default line end styles available, can import and extend
var createDefaultLineEndStyles=function createDefaultLineEndStyles(){return{arrow:lineEndStyleArrow,circle:lineEndStyleCircle,square:lineEndStyleSquare,bar:lineEndStyleBar};};var safeFactor=function safeFactor(value,factor){var v=parseFloat(value)*factor;return isString(value)?"".concat(v,"%"):v;};var toValue=function toValue(value,total){return isString(value)?toPixelValue(value,total):value;};var frameStyleSolid=function frameStyleSolid(shape){return[_objectSpread(_objectSpread({},shape),{},{frameStyle:'line',frameInset:0,frameOffset:0,frameSize:shape.frameSize?safeFactor(shape.frameSize,2):'2.5%',frameRadius:shape.frameRound?safeFactor(shape.frameSize,2):0})];};var frameStyleNine=function frameStyleNine(_ref476,_ref477){var contextWidth=_ref476.width,contextHeight=_ref476.height,frameImage=_ref476.frameImage,_ref476$frameSize=_ref476.frameSize,frameSize=_ref476$frameSize===void 0?'15%':_ref476$frameSize,_ref476$frameOutset=_ref476.frameOutset,frameOutset=_ref476$frameOutset===void 0?0:_ref476$frameOutset,_ref476$frameSlices=_ref476.frameSlices,frameSlices=_ref476$frameSlices===void 0?{x1:0.15,y1:0.15,x2:0.85,y2:0.85}:_ref476$frameSlices;var isPreview=_ref477.isPreview;// need a frame image to render a frame
if(!frameImage)return[];var contextSize=Math.sqrt(contextWidth*contextHeight);var size=toValue(frameSize,contextSize);var width=isPreview?size:Math.round(size);var height=width;var outset=toValue(frameOutset,contextSize);var outsetDouble=outset*2;var x1=frameSlices.x1,x2=frameSlices.x2,y1=frameSlices.y1,y2=frameSlices.y2;var shapeCoordinates={x0:0,y0:0,x1:width,y1:height,x2:contextWidth-width,y2:contextHeight-height,x3:contextWidth,y3:contextHeight,cw:width,ch:height,ew:contextWidth-width-width,eh:contextHeight-height-height};var overlap=isPreview?1:0;var overlapDouble=overlap*2;var expandsCanvas=outset>0;var cornerGeneric={expandsCanvas:expandsCanvas,width:shapeCoordinates.cw,height:shapeCoordinates.ch,backgroundImage:frameImage};return[// edges
{// t
expandsCanvas:expandsCanvas,x:shapeCoordinates.x1-overlap-outset,y:shapeCoordinates.y0-outset,width:shapeCoordinates.ew+overlapDouble+outsetDouble,height:shapeCoordinates.ch,backgroundCorners:[{x:x1,y:0},{x:x2,y:0},{x:x2,y:y1},{x:x1,y:y1}],backgroundImage:frameImage},{// b
expandsCanvas:expandsCanvas,x:shapeCoordinates.x1-overlap-outset,y:shapeCoordinates.y2+outset,width:shapeCoordinates.ew+overlapDouble+outsetDouble,height:shapeCoordinates.ch,backgroundCorners:[{x:x1,y:y2},{x:x2,y:y2},{x:x2,y:1},{x:x1,y:1}],backgroundImage:frameImage},{// l
expandsCanvas:expandsCanvas,x:shapeCoordinates.x0-outset,y:shapeCoordinates.y1-overlap-outset,width:shapeCoordinates.cw,height:shapeCoordinates.eh+overlapDouble+outsetDouble,backgroundCorners:[{x:0,y:y1},{x:x1,y:y1},{x:x1,y:y2},{x:0,y:y2}],backgroundImage:frameImage},{// r
expandsCanvas:expandsCanvas,x:shapeCoordinates.x2+outset,y:shapeCoordinates.y1-overlap-outset,width:shapeCoordinates.cw,height:shapeCoordinates.eh+overlapDouble+outsetDouble,backgroundCorners:[{x:x2,y:y1},{x:1,y:y1},{x:1,y:y2},{x:x2,y:y2}],backgroundImage:frameImage},// corners
_objectSpread(_objectSpread({},cornerGeneric),{},{x:shapeCoordinates.x0-outset,y:shapeCoordinates.y0-outset,backgroundCorners:[{x:0,y:0},{x:x1,y:0},{x:x1,y:y1},{x:0,y:y1}]}),_objectSpread(_objectSpread({},cornerGeneric),{},{x:shapeCoordinates.x2+outset,y:shapeCoordinates.y0-outset,backgroundCorners:[{x:x2,y:0},{x:1,y:0},{x:1,y:y1},{x:x2,y:y1}]}),_objectSpread(_objectSpread({},cornerGeneric),{},{x:shapeCoordinates.x2+outset,y:shapeCoordinates.y2+outset,backgroundCorners:[{x:x2,y:y2},{x:1,y:y2},{x:1,y:1},{x:x2,y:1}]}),_objectSpread(_objectSpread({},cornerGeneric),{},{x:shapeCoordinates.x0-outset,y:shapeCoordinates.y2+outset,backgroundCorners:[{x:0,y:y2},{x:x1,y:y2},{x:x1,y:1},{x:0,y:1}]})];};var frameStyleLine=function frameStyleLine(_ref478,_ref479){var x=_ref478.x,y=_ref478.y,width=_ref478.width,height=_ref478.height,_ref478$frameInset=_ref478.frameInset,frameInset=_ref478$frameInset===void 0?'3.5%':_ref478$frameInset,_ref478$frameSize=_ref478.frameSize,frameSize=_ref478$frameSize===void 0?'.25%':_ref478$frameSize,_ref478$frameColor=_ref478.frameColor,frameColor=_ref478$frameColor===void 0?[1,1,1]:_ref478$frameColor,_ref478$frameOffset=_ref478.frameOffset,frameOffset=_ref478$frameOffset===void 0?'5%':_ref478$frameOffset,_ref478$frameAmount=_ref478.frameAmount,frameAmount=_ref478$frameAmount===void 0?1:_ref478$frameAmount,_ref478$frameRadius=_ref478.frameRadius,frameRadius=_ref478$frameRadius===void 0?0:_ref478$frameRadius,_ref478$expandsCanvas=_ref478.expandsCanvas,expandsCanvas=_ref478$expandsCanvas===void 0?false:_ref478$expandsCanvas;var isPreview=_ref479.isPreview;var size=Math.sqrt(width*height);var frameSizeValue=toValue(frameSize,size);var frameInsetValue=toValue(frameInset,size);var frameOffsetValue=toValue(frameOffset,size);var center=0;if(!isPreview){frameSizeValue=Math.max(1,Math.round(frameSizeValue));center=frameSizeValue%2==0?0:0.5;}var r=toValue(safeFactor(frameRadius,frameAmount),size);return new Array(frameAmount).fill(undefined).map(function(_,index){var offset=frameOffsetValue*index;var left=x+frameInsetValue+offset;var top=y+frameInsetValue+offset;var right=x+width-frameInsetValue-offset;var bottom=y+height-frameInsetValue-offset;if(!isPreview){left=Math.round(left);top=Math.round(top);right=Math.round(right);bottom=Math.round(bottom);}var radius=r>0?r-offset:0;return{x:left+center,y:top+center,width:right-left,height:bottom-top,cornerRadius:radius,strokeWidth:frameSizeValue,strokeColor:frameColor,expandsCanvas:expandsCanvas};});};var frameStyleEdge=function frameStyleEdge(_ref480,_ref481){var x=_ref480.x,y=_ref480.y,width=_ref480.width,height=_ref480.height,_ref480$frameSize=_ref480.frameSize,frameSize=_ref480$frameSize===void 0?'.25%':_ref480$frameSize,_ref480$frameOffset=_ref480.frameOffset,frameOffset=_ref480$frameOffset===void 0?0:_ref480$frameOffset,_ref480$frameInset=_ref480.frameInset,frameInset=_ref480$frameInset===void 0?'2.5%':_ref480$frameInset,_ref480$frameColor=_ref480.frameColor,frameColor=_ref480$frameColor===void 0?[1,1,1]:_ref480$frameColor;var isPreview=_ref481.isPreview;var size=Math.sqrt(width*height);var frameSizeValue=toValue(frameSize,size);var frameInsetValue=toValue(frameInset,size);var frameOffsetValue=toValue(frameOffset,size);var center=0;if(!isPreview){frameSizeValue=Math.max(1,Math.round(frameSizeValue));frameInsetValue=Math.round(frameInsetValue);frameOffsetValue=Math.round(frameOffsetValue);center=frameSizeValue%2==0?0:0.5;}var offset=frameOffsetValue-frameInsetValue;var left=x+frameInsetValue+center;var top=y+frameInsetValue+center;var right=x+width-frameInsetValue-center;var bottom=y+height-frameInsetValue-center;return[// top
{points:[vectorCreate(left+offset,top),vectorCreate(right-offset,top)]},{points:[vectorCreate(right,top+offset),vectorCreate(right,bottom-offset)]},{points:[vectorCreate(right-offset,bottom),vectorCreate(left+offset,bottom)]},{points:[vectorCreate(left,bottom-offset),vectorCreate(left,top+offset)]}].map(function(shape){shape.strokeWidth=frameSizeValue;shape.strokeColor=frameColor;return shape;});};var frameStyleHook=function frameStyleHook(_ref482,_ref483){var x=_ref482.x,y=_ref482.y,width=_ref482.width,height=_ref482.height,_ref482$frameSize=_ref482.frameSize,frameSize=_ref482$frameSize===void 0?'.25%':_ref482$frameSize,_ref482$frameInset=_ref482.frameInset,frameInset=_ref482$frameInset===void 0?'2.5%':_ref482$frameInset,_ref482$frameLength=_ref482.frameLength,frameLength=_ref482$frameLength===void 0?'2.5%':_ref482$frameLength,_ref482$frameColor=_ref482.frameColor,frameColor=_ref482$frameColor===void 0?[1,1,1]:_ref482$frameColor;var isPreview=_ref483.isPreview;var size=Math.sqrt(width*height);var frameSizeValue=toValue(frameSize,size);var frameInsetValue=toValue(frameInset,size);var frameLengthValue=toValue(frameLength,size);var center=0;if(!isPreview){frameSizeValue=Math.max(1,Math.round(frameSizeValue));frameInsetValue=Math.round(frameInsetValue);frameLengthValue=Math.round(frameLengthValue);center=frameSizeValue%2==0?0:0.5;}var left=x+frameInsetValue+center;var top=y+frameInsetValue+center;var right=x+width-frameInsetValue-center;var bottom=y+height-frameInsetValue-center;return[// top
{points:[vectorCreate(left,top+frameLengthValue),vectorCreate(left,top),vectorCreate(left+frameLengthValue,top)]},{points:[vectorCreate(right-frameLengthValue,top),vectorCreate(right,top),vectorCreate(right,top+frameLengthValue)]},{points:[vectorCreate(right,bottom-frameLengthValue),vectorCreate(right,bottom),vectorCreate(right-frameLengthValue,bottom)]},{points:[vectorCreate(left+frameLengthValue,bottom),vectorCreate(left,bottom),vectorCreate(left,bottom-frameLengthValue)]}].map(function(shape){shape.strokeWidth=frameSizeValue;shape.strokeColor=frameColor;return shape;});};var frameStylePolaroid=function frameStylePolaroid(_ref484,_ref485){var x=_ref484.x,y=_ref484.y,width=_ref484.width,height=_ref484.height,_ref484$frameColor=_ref484.frameColor,frameColor=_ref484$frameColor===void 0?[1,1,1]:_ref484$frameColor;var isPreview=_ref485.isPreview;var size=Math.sqrt(width*height);var borderWidth=0.1*size;var chinHeight=0.2*size;var overlap=0;var borderWidthHalf=0.5*borderWidth;if(!isPreview){chinHeight=Math.ceil(chinHeight);}else{overlap=1;}// always remove opacity
frameColor.length=3;return[// border
{id:'border',x:x-borderWidthHalf+overlap,y:y-borderWidthHalf+overlap,width:width+borderWidth-overlap*2,height:height+chinHeight-overlap*2,frameStyle:'line',frameInset:0,frameOffset:0,frameSize:borderWidth,frameColor:frameColor,expandsCanvas:true},// chin
{id:'chin',x:x-borderWidthHalf,y:height-overlap,width:width+borderWidth,height:chinHeight,backgroundColor:frameColor,expandsCanvas:true}].filter(Boolean);};var createFrameStyleProcessor=function createFrameStyleProcessor(){var styles=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return function(shape,options){// handle solid frameStyle
if(!hasProp(shape,'frameStyle'))return;var style=shape.frameStyle;// get parser for style
var process=styles[style];if(!process)return;// remove frameStyle property so we don't get endless loops
var frameStyle=shape.frameStyle,shapeReadyToParse=_objectWithoutProperties(shape,_excluded3);return process(shapeReadyToParse,options);};};// the default frame styles available, can import and extend
var createDefaultFrameStyles=function createDefaultFrameStyles(){return{solid:frameStyleSolid,hook:frameStyleHook,line:frameStyleLine,edge:frameStyleEdge,polaroid:frameStylePolaroid,nine:frameStyleNine};};// the default lineEnd parser to use
var createDefaultLineEndProcessors=function createDefaultLineEndProcessors(){return createLineEndProcessor(createDefaultLineEndStyles());};var createDefaultFrameStyleProcessor=function createDefaultFrameStyleProcessor(){return createFrameStyleProcessor(createDefaultFrameStyles());};var createDefaultShapeProcessors=function createDefaultShapeProcessors(){return[createDefaultFrameStyleProcessor(),createDefaultLineEndProcessors()];};var createShapePreprocessor$1=function createShapePreprocessor$1(processors){var processShape=function processShape(shape){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{isPreview:true};var res=processors.map(function(process){var res=process(shape,options);// processor wasn't a match?
if(!res)return;return res.map(function(shape){return processShape(shape,options);});}).filter(Boolean).flat();return!res.length?shape:res.flat();};return processShape;};var createDefaultImageReader=createDefaultImageReader$1;var createDefaultImageWriter=createDefaultImageWriter$1;var createDefaultMediaWriter=createDefaultMediaWriter$1;var createDefaultImageOrienter=function createDefaultImageOrienter(){return{read:getImageOrientationFromFile,apply:orientImageData};};var createDefaultImageScrambler=function createDefaultImageScrambler(){var configurationOptions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};// default configuration
var blurAmount=configurationOptions.blurAmount,dataSizeScalar=configurationOptions.dataSizeScalar,scrambleAmount=configurationOptions.scrambleAmount,backgroundColor=configurationOptions.backgroundColor;// as called from editor ui
return function(imageData,uiOptions){return imageDataScramble(imageData,_objectSpread(_objectSpread({blurAmount:blurAmount,scrambleAmount:scrambleAmount,backgroundColor:backgroundColor},uiOptions),{},{dataSizeScalar:dataSizeScalar||uiOptions.dataSizeScalar}));};};var createEditor=createImageEditor;var getEditorProps=function getEditorProps(){return getEditorProps$1().concat(getEditorViewProps());};// private api for framework components
var createMarkupEditorToolbar=createToolbar;var createMarkupEditorToolStyles=createToolStyles;// markup editor style controls
var createMarkupEditorShapeStyleControls=createShapeStyleControls;var markup_editor_defaults={markupEditorToolbar:createToolbar(),markupEditorToolStyles:createToolStyles(),markupEditorShapeStyleControls:createShapeStyleControls()};var setPlugins=setEditorViewPlugins;var plugin_crop=_plugin_crop;var plugin_filter=_plugin_filter;var plugin_finetune=_plugin_finetune;var plugin_annotate=_plugin_annotate;var plugin_decorate=_plugin_decorate;var plugin_sticker=_plugin_sticker;var plugin_frame=_plugin_frame;var plugin_redact=_plugin_redact;var plugin_resize=_plugin_resize;var plugin_fill=_plugin_fill;var plugin_finetune_defaults=_plugin_finetune_defaults;var plugin_filter_defaults=_plugin_filter_defaults;var plugin_frame_defaults=_plugin_frame_defaults;var locale_en_gb=_locale_en_gb;var markup_editor_locale_en_gb=MarkupEditor;var plugin_crop_locale_en_gb=_plugin_crop_locale_en_gb;var plugin_fill_locale_en_gb=_plugin_fill_locale_en_gb;var plugin_filter_locale_en_gb=_plugin_filter_locale_en_gb;var plugin_finetune_locale_en_gb=_plugin_finetune_locale_en_gb;var plugin_resize_locale_en_gb=_plugin_resize_locale_en_gb;var plugin_decorate_locale_en_gb=_plugin_decorate_locale_en_gb;var plugin_annotate_locale_en_gb=_plugin_annotate_locale_en_gb;var plugin_sticker_locale_en_gb=_plugin_sticker_locale_en_gb;var plugin_frame_locale_en_gb=_plugin_frame_locale_en_gb;var plugin_redact_locale_en_gb=_plugin_redact_locale_en_gb;var elementsToEditor=function elementsToEditor(factory,targets){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var elements=isString(targets)?Array.from(document.querySelectorAll(targets)):targets;return elements.filter(Boolean).map(function(element){return factory(element,deepCopy(options));});};var appendEditor=_appendEditor;var openEditor=_openEditor;var overlayEditor=_overlayEditor;var appendEditors=function appendEditors(targets,options){return elementsToEditor(appendEditor,targets,options);};var createShapePreprocessor=createShapePreprocessor$1;var createDefaultShapePreprocessor=function createDefaultShapePreprocessor(){var customProcessors=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return createShapePreprocessor$1([].concat(_toConsumableArray(createDefaultShapeProcessors()),_toConsumableArray(customProcessors)));};//
// creating default editors
//
var getEditorDefaultReadWriteOptions=function getEditorDefaultReadWriteOptions(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var readerProps=undefined;if(!Array.isArray(options.imageReader)){readerProps=options.imageReader;delete options.imageReader;}var imageWriter;if(!Array.isArray(options.imageWriter)){if(isFunction(options.imageWriter)){imageWriter=options.imageWriter;}else{imageWriter=createDefaultImageWriter(options.imageWriter);}delete options.imageWriter;}else{imageWriter=createDefaultImageWriter();}var scramblerProps=undefined;if(!isFunction(options.imageScrambler)){scramblerProps=options.imageScrambler;delete options.imageScrambler;}return{// default handling of images
imageReader:createDefaultImageReader(readerProps),imageWriter:imageWriter,imageOrienter:createDefaultImageOrienter(),imageScrambler:createDefaultImageScrambler(scramblerProps)};};var processDefaultImage=function processDefaultImage(src){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};// get default read/write options object
var defaultReadWriteOptions=getEditorDefaultReadWriteOptions(options);// handle custom shape preprocessorss
var shapePreprocessor=typeof options.shapePreprocessor==='function'?options.shapePreprocessor:createDefaultShapePreprocessor(options.shapePreprocessor);delete options.shapePreprocessor;// create huge config object
options=mergeObjects([_objectSpread(_objectSpread({},defaultReadWriteOptions),{},{// shape preprocessor
shapePreprocessor:shapePreprocessor,// stickers stick to image by default
stickerStickToImage:true}),options]);return processImage(src,options);};var getEditorDefaults=function getEditorDefaults(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};// load all plugins
setEditorViewPlugins.apply(void 0,_toConsumableArray([plugin_crop,plugin_filter,plugin_finetune,plugin_annotate,plugin_decorate,plugin_sticker,plugin_frame,plugin_redact,plugin_resize,plugin_fill].filter(Boolean)));// auto hide stickers util if no stickers defined
var utils=['trim',// if a video is loaded we show trim plugin at the top
'crop','filter','finetune','annotate','decorate',options.stickers&&'sticker',options.fillOptions&&'fill','frame','redact','resize'].filter(Boolean);// get default read/write options object
var defaultReadWriteOptions=getEditorDefaultReadWriteOptions(options);// locale
var locale=_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({},locale_en_gb),markup_editor_locale_en_gb),plugin_crop_locale_en_gb),plugin_fill_locale_en_gb),plugin_filter_locale_en_gb),plugin_finetune_locale_en_gb),plugin_frame_locale_en_gb),plugin_redact_locale_en_gb),plugin_resize_locale_en_gb),plugin_decorate_locale_en_gb),plugin_annotate_locale_en_gb),plugin_sticker_locale_en_gb),options.locale);delete options.locale;// handle custom shape preprocessorss
var shapePreprocessor=typeof options.shapePreprocessor==='function'?options.shapePreprocessor:createDefaultShapePreprocessor(options.shapePreprocessor);delete options.shapePreprocessor;// create huge config object
return mergeObjects([_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({},defaultReadWriteOptions),{},{// shape preprocessor
shapePreprocessor:shapePreprocessor,// default utils
utils:utils},plugin_finetune_defaults),plugin_filter_defaults),plugin_frame_defaults),markup_editor_defaults),{},{// stickers stick to image by default
stickerStickToImage:true,// locale
locale:locale}),options]);};var defineCustomElements=/*#__PURE__*/function(){var _ref486=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee59(){var options,elements,_args5=arguments;return _regeneratorRuntime().wrap(function _callee59$(_context60){while(1)switch(_context60.prev=_context60.next){case 0:options=_args5.length>0&&_args5[0]!==undefined?_args5[0]:{};_context60.next=3;return _defineCustomElements();case 3:elements=_context60.sent;elements.forEach(function(editor){return Object.assign(editor,deepCopy(options));});return _context60.abrupt("return",elements);case 6:case"end":return _context60.stop();}},_callee59);}));return function defineCustomElements(){return _ref486.apply(this,arguments);};}();var defineDefaultCustomElements=function defineDefaultCustomElements(options){return defineCustomElements(getEditorDefaults(options));};var openDefaultEditor=function openDefaultEditor(options,parent){return openEditor(getEditorDefaults(options),parent);};var appendDefaultEditor=function appendDefaultEditor(element,options){return appendEditor(element,getEditorDefaults(options));};var overlayDefaultEditor=function overlayDefaultEditor(element,options){return overlayEditor(element,getEditorDefaults(options));};var appendDefaultEditors=function appendDefaultEditors(targets,options){return elementsToEditor(appendDefaultEditor,targets,options);};

/***/ }),

/***/ "./src/blocks/photo-block/block.json":
/*!*******************************************!*\
  !*** ./src/blocks/photo-block/block.json ***!
  \*******************************************/
/***/ (function(module) {

"use strict";
module.exports = JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","title":"Photo Block","apiVersion":2,"name":"dlxplugins/photo-block","category":"common","icon":"<svg aria-hidden=\'true\' focusable=\'false\' data-prefix=\'fas\' data-icon=\'share-alt\' className=\'svg-inline--fa fa-share-alt fa-w-14\' role=\'img\' xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 448 512\'><path fill=\'currentColor\' d=\'M352 320c-22.608 0-43.387 7.819-59.79 20.895l-102.486-64.054a96.551 96.551 0 0 0 0-41.683l102.486-64.054C308.613 184.181 329.392 192 352 192c53.019 0 96-42.981 96-96S405.019 0 352 0s-96 42.981-96 96c0 7.158.79 14.13 2.276 20.841L155.79 180.895C139.387 167.819 118.608 160 96 160c-53.019 0-96 42.981-96 96s42.981 96 96 96c22.608 0 43.387-7.819 59.79-20.895l102.486 64.054A96.301 96.301 0 0 0 256 416c0 53.019 42.981 96 96 96s96-42.981 96-96-42.981-96-96-96z\'></path></svg>","description":"An easy-to-use and comprehensive photo block.","keywords":["photo","block","image","picture","photos"],"version":"1.0.0","textdomain":"photo-block","attributes":{"uniqueId":{"type":"string","default":""},"photo":{"type":"object","default":{"id":"","url":"","alt":"","caption":"","link":"","linkTarget":"","width":"","height":""}},"screen":{"type":"string","default":"initial"},"align":{"type":"string","default":"center"},"caption":{"type":"string","default":""},"altText":{"type":"string","default":""},"overlayText":{"type":"string","default":""},"overlayTextPosition":{"type":"string","default":""},"paddingSize":{"type":"object","default":{"mobile":{"top":"","right":"","bottom":"","left":"","unit":null,"unitSync":null},"tablet":{"top":"","right":"","bottom":"","left":"","unit":null,"unitSync":null},"desktop":{"top":"20","right":"20","bottom":"20","left":"20","unit":"px","unitSync":true}}},"marginSize":{"type":"object","default":{"mobile":{"top":"","right":"","bottom":"","left":"","unit":null,"unitSync":null},"tablet":{"top":"","right":"","bottom":"","left":"","unit":null,"unitSync":null},"desktop":{"top":"20","right":"","bottom":"20","left":"","unit":"px","unitSync":true}}},"borderWidth":{"type":"object","default":{"mobile":{"top":"","right":"","bottom":"","left":"","unit":null,"unitSync":null},"tablet":{"top":"","right":"","bottom":"","left":"","unit":null,"unitSync":null},"desktop":{"top":"1","right":"1","bottom":"1","left":"1","unit":"px","unitSync":true}}},"borderRadiusSize":{"type":"object","default":{"mobile":{"top":"","right":"","bottom":"","left":"","unit":null,"unitSync":null},"tablet":{"top":"","right":"","bottom":"","left":"","unit":null,"unitSync":null},"desktop":{"top":"","right":"","bottom":"","left":"","unit":"px","unitSync":true}}},"typographyCaption":{"type":"object","default":{"mobile":{"fontFamily":"","fontFamilySlug":"","fontSize":"","fontSizeUnit":"px","fontWeight":"","lineHeight":"","lineHeightUnit":"em","textTransform":"","letterSpacing":"","letterSpacingUnit":"px","fontFallback":"","fontType":"web"},"tablet":{"fontFamily":"","fontFamilySlug":"","fontSize":"","fontSizeUnit":"px","fontWeight":"","lineHeight":"","lineHeightUnit":"em","textTransform":"","letterSpacing":"","letterSpacingUnit":"px","fontFallback":"","fontType":"web"},"desktop":{"fontFamily":"Arial","fontFamilySlug":"arial","fontSize":"24","fontSizeUnit":"px","fontWeight":"normal","lineHeight":"1.3","lineHeightUnit":"em","textTransform":"none","letterSpacing":"0","letterSpacingUnit":"px","fontFallback":"serif","fontType":"web"}}}},"supports":{"anchor":true,"align":true,"className":true,"alignWide":true,"defaultStylePicker":false},"example":{"attributes":{}},"editorScript":"dlx-photo-block-editor","editorStyle":"dlx-photo-block-editor-css","style":"dlx-photo-block-frontend-and-editor"}');

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	!function() {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = function(module) {
/******/ 			var getter = module && module.__esModule ?
/******/ 				function() { return module['default']; } :
/******/ 				function() { return module; };
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	!function() {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = function(exports, definition) {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	!function() {
/******/ 		__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	!function() {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = function(exports) {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	}();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be in strict mode.
!function() {
"use strict";
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _blocks_photo_block_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./blocks/photo-block/index.js */ "./src/blocks/photo-block/index.js");
/**
 * WordPress Block initialization.
 */

}();
/******/ })()
;
//# sourceMappingURL=index.js.map